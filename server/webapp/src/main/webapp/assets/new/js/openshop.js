/**
 * vars
 *
 */
var OPENSHOP_NAME = '私人定制俱乐部';
var cartQuantity = 0;
var username = '四海';



if (window['console'] === undefined)
console = {log: function(){}};
(function(){var u,n,l,g,j,w,c,r,x,C,E,A,m,y,z;function k(){var F=+new Date()+"",G=Math.floor(Math.random()*(999999-1+1))+1;return F+"_"+G}function o(F){var H,G;if(Object.keys){H=Object.keys(F).length}else{H=0;for(G in F){if(v(F,G)){H++}}}return H}if(typeof Object.create!=="function"){Object.create=function(F){function G(){}G.prototype=F;return new G()}}y=typeof exports==="object"&&typeof module==="object"&&typeof module.exports==="object"&&typeof require==="function";n="undefined";z=Object.prototype;u=this;j=null;w=false;l={};c="3.0.1";x=w;function t(F){return z.toString.call(F)}function b(F){return t(F)==="[object Function]"}function q(F){return t(F)==="[object Array]"}function a(F){x=F}function s(G,F){return[].slice.call(G,F||0)}function v(F,G){return F.hasOwnProperty(G)}function D(L,H,G,K,J){var I,F;I=l[H];if(J&&L.isModuleStarted(H,G)){L.stop(H,G)}if(typeof I!==n){F=p(H);I.instances[G]=F;F.__instance_id__=G;if(typeof K!==n){F.init(K)}else{F.init()}}return F}function d(G,F){var H;for(H in F){if(v(F,H)){G[H]=F[H]}}return G}function f(G,I,H,F){G[I]=(function(K,J){return function(){var M=s(arguments,0);try{return J.apply(this,M)}catch(L){C.log(H,K,L);return false}}}(I,F))}m={global:{}};function i(G,H){var F=[],I;if(typeof G!=="undefined"){for(I in G){if(v(G,I)&&I===H){F=G[I]}}}return F}A={subscribers:function(F,G){return i(m[F],G)},_getChannelEvents:function(K,G,J){var H,F,I;F=K[0];if(F==="global"){H=F;I=K[1]}else{H=G;I=J}if(typeof m[H][I]==="undefined"){m[H][I]=[]}return m[H][I]},_addSubscribers:function(J,H,G,K){var M,L,F,I=H||false;for(M in J){if(v(J,M)){L=M.split(":");if(I&&L[0]!=="global"||!I&&L[0]==="global"){continue}F=this._getChannelEvents(L,G,M);F.push({subscriber:K,handler:J[M]})}}},subscribe:function(F,H,G){if(typeof H.oEventsCallbacks==="undefined"){return false}if(typeof m[F]==="undefined"){m[F]={}}this._addSubscribers(H.oEventsCallbacks,G,F,H);return true},_removeSubscribers:function(H,I){var J,F=0,G=0;if(typeof H!==n){J=H.length;for(;F<J;F++){if(H[F].subscriber===I){G++;H.splice(F,1)}}}return G},_removeSubscribersPerEvent:function(O,M,N,L){var F,K,I,H,G=M||false,J;for(F in O){if(v(O,F)){K=F.split(":");if(G&&K[0]!=="global"||!G&&K[0]==="global"){continue}I=N;H=F;if(K[0]==="global"){I=K[0];H=K[1]}J=this._removeSubscribers(m[I][H],L)}}return J},unsubscribe:function(G,J,H){var F,I=J.oEventsCallbacks;if(typeof I==="undefined"||typeof m[G]==="undefined"){return false}F=this._removeSubscribersPerEvent(I,H,G,J);return F>0},publish:function(H,K,L){var G=this.subscribers(H,K),F=0,J=G.length,I;if(J===0){return false}for(;F<J;F++){I=G[F];I.handler.call(I.subscriber,L);/*C.log(H,K,I)*/}return true},reset:function(){m={global:{}}}};function h(G,I){var H,F;H=l[G].creator(I);H.__module_id__=G;F=H.init||function(){};H.__action__=I;H.oEventsCallbacks=H.oEventsCallbacks||{};H.init=function(){var J=s(arguments,0).concat(g);I.subscribe("global",H,true);F.apply(this,J)};H.handleAction=function(K){var J=this.oEventsCallbacks[K.type];if(typeof J===n){return}J.call(this,K)};H.onDestroy=H.onDestroy||function(){};H.destroy=function(){this.onDestroy();I.unsubscribe("global",H,true)};return H}function p(G){var F,H;if(typeof l[G]===n){throw new Error("The module "+G+" is not registered!")}F=h(G,A);if(!x){for(H in F){if(v(F,H)&&b(F[H])){f(F,H,G,F[H])}}}return F}C=u.console||{log:function(){}};E=function(){};E.prototype={type:"Module",getInstance:p,register:function(G,F){l[G]={creator:F,instances:{}};return l[G]},_setSuper:function(F,G){F.__super__={};F.__super__.__instance__=G;F.__super__.__call__=function(I,J){var H=this;while(v(H,I)===w){H=H.__instance__.__super__}H[I].apply(F,J)}},callInSuper:function(F){return function(){var G=s(arguments,0);F.apply(this,G)}},_mergeModuleExtended:function(G,F){var H;for(H in F){if(v(F,H)){if(typeof G.__super__!==n&&b(G[H])){G.__super__[H]=(this.callInSuper(G[H]))}G[H]=F[H]}}},_mergeModuleBase:function(F,H){var G;for(G in H){if(v(H,G)){if(G!=="__super__"){F[G]=H[G]}}}},_merge:function(H,F){var G={};this._setSuper(G,H);this._mergeModuleBase(G,H);this._mergeModuleExtended(G,F);return G},extend:function(L,H,J){var G,K,O,I,M,F,N;N=this;G=l[L];K=L;O=function(){};if(typeof H==="string"){K=H;O=J}else{O=H}if(typeof G===n){return}M=O(A);I=G.creator(A);l[K]={creator:function(P){F=N._merge(I,M);F.__action__=P;return F},instances:{}}},setInstance:function(H,G,F){var I=l[H];if(!I){throw new Error("The module "+H+" is not registered!")}I.instances[G]=F;return I},setVars:function(F){if(typeof g!==n){g=d(g,F)}else{g=F}},getVars:function(){return d({},g)},_multiModuleStart:function(J,O,G,I){var H,L,N,F,K,M;if(q(O)){H=O.slice(0)}if(q(G)){L=G.slice(0)}if(q(I)){N=I.slice(0)}for(F=0,K=J.length;F<K;F++){M=J[F];O=H&&H[F]||k();G=L&&L[F]||G;I=N&&N[F]||I;D(this,M,O,G,I)}},_singleModuleStart:function(G,F,I,H){if(typeof F!=="string"){I=F;H=I;F=k()}D(this,G,F,I,H)},start:function(H,F,J,I){var G=q(H);if(G){this._multiModuleStart(H.slice(0),F,J,I)}else{this._singleModuleStart(H,F,J,I)}},isModuleStarted:function(H,F){var G=false;if(typeof F===n){G=(typeof l[H]!==n&&o(l[H].instances)>0)}else{G=(typeof l[H]!==n&&typeof l[H].instances[F]!==n)}return G},startAll:function(){var F,G;for(F in l){if(v(l,F)){G=l[F];if(typeof G!==n){this.start(F,k())}}}},_multiModuleStop:function(H){var G,I=H.instances,F;for(G in I){if(v(I,G)){F=I[G];if(typeof H!==n&&typeof F!==n){F.destroy()}}}},_singleModuleStop:function(I,H,F){var G=I.instances[F];if(typeof I!==n&&typeof G!==n){G.destroy()}},stop:function(G,F){var H;H=l[G];if(typeof H===n){return false}if(typeof F!==n){this._singleModuleStop(H,G,F)}else{this._multiModuleStop(H)}return true},_stopOneByOne:function(H,G){var F;for(F in H){if(v(H,F)){this.stop(G,F)}}},stopAll:function(){var F;for(F in l){if(v(l,F)&&typeof l[F]!==n){this._stopOneByOne(l[F].instances,F)}}},_delete:function(F){if(typeof l[F]!==n){delete l[F]}},remove:function(F){var G=l[F];if(typeof G===n){return null}if(typeof G!==n){try{return G}finally{this._delete(F)}}return null}};function e(){return C}function B(F){C=F}r=function(){};r.version=c;r.bus=A;r.errorHandler=e;r.setErrorHandler=B;r.module=new E();r.setDebug=a;r.getDebug=function(){return x};r.extend=function(G,F){if(typeof this[G]===n){this[G]=F}else{this[G]=d(this[G],F)}};r.noConflict=function(G,F,H){if(typeof this[G]!==n){F[H]=this[G];return true}return false};u.Hydra=r;if(y){module.exports=r}else{if(typeof define!=="undefined"){define(function(){return r})}}}.call(this));
/*
 Leaflet, a JavaScript library for mobile-friendly interactive maps. http://leafletjs.com
 (c) 2010-2013, Vladimir Agafonkin
 (c) 2010-2011, CloudMade
*/
!function(t,e,i){var n=t.L,o={};o.version="0.7.2","object"==typeof module&&"object"==typeof module.exports?module.exports=o:"function"==typeof define&&define.amd&&define(o),o.noConflict=function(){return t.L=n,this},t.L=o,o.Util={extend:function(t){var e,i,n,o,s=Array.prototype.slice.call(arguments,1);for(i=0,n=s.length;n>i;i++){o=s[i]||{};for(e in o)o.hasOwnProperty(e)&&(t[e]=o[e])}return t},bind:function(t,e){var i=arguments.length>2?Array.prototype.slice.call(arguments,2):null;return function(){return t.apply(e,i||arguments)}},stamp:function(){var t=0,e="_leaflet_id";return function(i){return i[e]=i[e]||++t,i[e]}}(),invokeEach:function(t,e,i){var n,o;if("object"==typeof t){o=Array.prototype.slice.call(arguments,3);for(n in t)e.apply(i,[n,t[n]].concat(o));return!0}return!1},limitExecByInterval:function(t,e,i){var n,o;return function s(){var a=arguments;return n?void(o=!0):(n=!0,setTimeout(function(){n=!1,o&&(s.apply(i,a),o=!1)},e),void t.apply(i,a))}},falseFn:function(){return!1},formatNum:function(t,e){var i=Math.pow(10,e||5);return Math.round(t*i)/i},trim:function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},splitWords:function(t){return o.Util.trim(t).split(/\s+/)},setOptions:function(t,e){return t.options=o.extend({},t.options,e),t.options},getParamString:function(t,e,i){var n=[];for(var o in t)n.push(encodeURIComponent(i?o.toUpperCase():o)+"="+encodeURIComponent(t[o]));return(e&&-1!==e.indexOf("?")?"&":"?")+n.join("&")},template:function(t,e){return t.replace(/\{ *([\w_]+) *\}/g,function(t,n){var o=e[n];if(o===i)throw new Error("No value provided for variable "+t);return"function"==typeof o&&(o=o(e)),o})},isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},function(){function e(e){var i,n,o=["webkit","moz","o","ms"];for(i=0;i<o.length&&!n;i++)n=t[o[i]+e];return n}function i(e){var i=+new Date,o=Math.max(0,16-(i-n));return n=i+o,t.setTimeout(e,o)}var n=0,s=t.requestAnimationFrame||e("RequestAnimationFrame")||i,a=t.cancelAnimationFrame||e("CancelAnimationFrame")||e("CancelRequestAnimationFrame")||function(e){t.clearTimeout(e)};o.Util.requestAnimFrame=function(e,n,a,r){return e=o.bind(e,n),a&&s===i?void e():s.call(t,e,r)},o.Util.cancelAnimFrame=function(e){e&&a.call(t,e)}}(),o.extend=o.Util.extend,o.bind=o.Util.bind,o.stamp=o.Util.stamp,o.setOptions=o.Util.setOptions,o.Class=function(){},o.Class.extend=function(t){var e=function(){this.initialize&&this.initialize.apply(this,arguments),this._initHooks&&this.callInitHooks()},i=function(){};i.prototype=this.prototype;var n=new i;n.constructor=e,e.prototype=n;for(var s in this)this.hasOwnProperty(s)&&"prototype"!==s&&(e[s]=this[s]);t.statics&&(o.extend(e,t.statics),delete t.statics),t.includes&&(o.Util.extend.apply(null,[n].concat(t.includes)),delete t.includes),t.options&&n.options&&(t.options=o.extend({},n.options,t.options)),o.extend(n,t),n._initHooks=[];var a=this;return e.__super__=a.prototype,n.callInitHooks=function(){if(!this._initHooksCalled){a.prototype.callInitHooks&&a.prototype.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,e=n._initHooks.length;e>t;t++)n._initHooks[t].call(this)}},e},o.Class.include=function(t){o.extend(this.prototype,t)},o.Class.mergeOptions=function(t){o.extend(this.prototype.options,t)},o.Class.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),i="function"==typeof t?t:function(){this[t].apply(this,e)};this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(i)};var s="_leaflet_events";o.Mixin={},o.Mixin.Events={addEventListener:function(t,e,i){if(o.Util.invokeEach(t,this.addEventListener,this,e,i))return this;var n,a,r,h,l,u,c,d=this[s]=this[s]||{},p=i&&i!==this&&o.stamp(i);for(t=o.Util.splitWords(t),n=0,a=t.length;a>n;n++)r={action:e,context:i||this},h=t[n],p?(l=h+"_idx",u=l+"_len",c=d[l]=d[l]||{},c[p]||(c[p]=[],d[u]=(d[u]||0)+1),c[p].push(r)):(d[h]=d[h]||[],d[h].push(r));return this},hasEventListeners:function(t){var e=this[s];return!!e&&(t in e&&e[t].length>0||t+"_idx"in e&&e[t+"_idx_len"]>0)},removeEventListener:function(t,e,i){if(!this[s])return this;if(!t)return this.clearAllEventListeners();if(o.Util.invokeEach(t,this.removeEventListener,this,e,i))return this;var n,a,r,h,l,u,c,d,p,_=this[s],m=i&&i!==this&&o.stamp(i);for(t=o.Util.splitWords(t),n=0,a=t.length;a>n;n++)if(r=t[n],u=r+"_idx",c=u+"_len",d=_[u],e){if(h=m&&d?d[m]:_[r]){for(l=h.length-1;l>=0;l--)h[l].action!==e||i&&h[l].context!==i||(p=h.splice(l,1),p[0].action=o.Util.falseFn);i&&d&&0===h.length&&(delete d[m],_[c]--)}}else delete _[r],delete _[u],delete _[c];return this},clearAllEventListeners:function(){return delete this[s],this},fireEvent:function(t,e){if(!this.hasEventListeners(t))return this;var i,n,a,r,h,l=o.Util.extend({},e,{type:t,target:this}),u=this[s];if(u[t])for(i=u[t].slice(),n=0,a=i.length;a>n;n++)i[n].action.call(i[n].context,l);r=u[t+"_idx"];for(h in r)if(i=r[h].slice())for(n=0,a=i.length;a>n;n++)i[n].action.call(i[n].context,l);return this},addOneTimeEventListener:function(t,e,i){if(o.Util.invokeEach(t,this.addOneTimeEventListener,this,e,i))return this;var n=o.bind(function(){this.removeEventListener(t,e,i).removeEventListener(t,n,i)},this);return this.addEventListener(t,e,i).addEventListener(t,n,i)}},o.Mixin.Events.on=o.Mixin.Events.addEventListener,o.Mixin.Events.off=o.Mixin.Events.removeEventListener,o.Mixin.Events.once=o.Mixin.Events.addOneTimeEventListener,o.Mixin.Events.fire=o.Mixin.Events.fireEvent,function(){var n="ActiveXObject"in t,s=n&&!e.addEventListener,a=navigator.userAgent.toLowerCase(),r=-1!==a.indexOf("webkit"),h=-1!==a.indexOf("chrome"),l=-1!==a.indexOf("phantom"),u=-1!==a.indexOf("android"),c=-1!==a.search("android [23]"),d=-1!==a.indexOf("gecko"),p=typeof orientation!=i+"",_=t.navigator&&t.navigator.msPointerEnabled&&t.navigator.msMaxTouchPoints&&!t.PointerEvent,m=t.PointerEvent&&t.navigator.pointerEnabled&&t.navigator.maxTouchPoints||_,f="devicePixelRatio"in t&&t.devicePixelRatio>1||"matchMedia"in t&&t.matchMedia("(min-resolution:144dpi)")&&t.matchMedia("(min-resolution:144dpi)").matches,g=e.documentElement,v=n&&"transition"in g.style,y="WebKitCSSMatrix"in t&&"m11"in new t.WebKitCSSMatrix&&!c,P="MozPerspective"in g.style,L="OTransition"in g.style,x=!t.L_DISABLE_3D&&(v||y||P||L)&&!l,w=!t.L_NO_TOUCH&&!l&&function(){var t="ontouchstart";if(m||t in g)return!0;var i=e.createElement("div"),n=!1;return i.setAttribute?(i.setAttribute(t,"return;"),"function"==typeof i[t]&&(n=!0),i.removeAttribute(t),i=null,n):!1}();o.Browser={ie:n,ielt9:s,webkit:r,gecko:d&&!r&&!t.opera&&!n,android:u,android23:c,chrome:h,ie3d:v,webkit3d:y,gecko3d:P,opera3d:L,any3d:x,mobile:p,mobileWebkit:p&&r,mobileWebkit3d:p&&y,mobileOpera:p&&t.opera,touch:w,msPointer:_,pointer:m,retina:f}}(),o.Point=function(t,e,i){this.x=i?Math.round(t):t,this.y=i?Math.round(e):e},o.Point.prototype={clone:function(){return new o.Point(this.x,this.y)},add:function(t){return this.clone()._add(o.point(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(o.point(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},distanceTo:function(t){t=o.point(t);var e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},equals:function(t){return t=o.point(t),t.x===this.x&&t.y===this.y},contains:function(t){return t=o.point(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+o.Util.formatNum(this.x)+", "+o.Util.formatNum(this.y)+")"}},o.point=function(t,e,n){return t instanceof o.Point?t:o.Util.isArray(t)?new o.Point(t[0],t[1]):t===i||null===t?t:new o.Point(t,e,n)},o.Bounds=function(t,e){if(t)for(var i=e?[t,e]:t,n=0,o=i.length;o>n;n++)this.extend(i[n])},o.Bounds.prototype={extend:function(t){return t=o.point(t),this.min||this.max?(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(t.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(t.y,this.max.y)):(this.min=t.clone(),this.max=t.clone()),this},getCenter:function(t){return new o.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return new o.Point(this.min.x,this.max.y)},getTopRight:function(){return new o.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,i;return t="number"==typeof t[0]||t instanceof o.Point?o.point(t):o.bounds(t),t instanceof o.Bounds?(e=t.min,i=t.max):e=i=t,e.x>=this.min.x&&i.x<=this.max.x&&e.y>=this.min.y&&i.y<=this.max.y},intersects:function(t){t=o.bounds(t);var e=this.min,i=this.max,n=t.min,s=t.max,a=s.x>=e.x&&n.x<=i.x,r=s.y>=e.y&&n.y<=i.y;return a&&r},isValid:function(){return!(!this.min||!this.max)}},o.bounds=function(t,e){return!t||t instanceof o.Bounds?t:new o.Bounds(t,e)},o.Transformation=function(t,e,i,n){this._a=t,this._b=e,this._c=i,this._d=n},o.Transformation.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new o.Point((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}},o.DomUtil={get:function(t){return"string"==typeof t?e.getElementById(t):t},getStyle:function(t,i){var n=t.style[i];if(!n&&t.currentStyle&&(n=t.currentStyle[i]),(!n||"auto"===n)&&e.defaultView){var o=e.defaultView.getComputedStyle(t,null);n=o?o[i]:null}return"auto"===n?null:n},getViewportOffset:function(t){var i,n=0,s=0,a=t,r=e.body,h=e.documentElement;do{if(n+=a.offsetTop||0,s+=a.offsetLeft||0,n+=parseInt(o.DomUtil.getStyle(a,"borderTopWidth"),10)||0,s+=parseInt(o.DomUtil.getStyle(a,"borderLeftWidth"),10)||0,i=o.DomUtil.getStyle(a,"position"),a.offsetParent===r&&"absolute"===i)break;if("fixed"===i){n+=r.scrollTop||h.scrollTop||0,s+=r.scrollLeft||h.scrollLeft||0;break}if("relative"===i&&!a.offsetLeft){var l=o.DomUtil.getStyle(a,"width"),u=o.DomUtil.getStyle(a,"max-width"),c=a.getBoundingClientRect();("none"!==l||"none"!==u)&&(s+=c.left+a.clientLeft),n+=c.top+(r.scrollTop||h.scrollTop||0);break}a=a.offsetParent}while(a);a=t;do{if(a===r)break;n-=a.scrollTop||0,s-=a.scrollLeft||0,a=a.parentNode}while(a);return new o.Point(s,n)},documentIsLtr:function(){return o.DomUtil._docIsLtrCached||(o.DomUtil._docIsLtrCached=!0,o.DomUtil._docIsLtr="ltr"===o.DomUtil.getStyle(e.body,"direction")),o.DomUtil._docIsLtr},create:function(t,i,n){var o=e.createElement(t);return o.className=i,n&&n.appendChild(o),o},hasClass:function(t,e){if(t.classList!==i)return t.classList.contains(e);var n=o.DomUtil._getClass(t);return n.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(n)},addClass:function(t,e){if(t.classList!==i)for(var n=o.Util.splitWords(e),s=0,a=n.length;a>s;s++)t.classList.add(n[s]);else if(!o.DomUtil.hasClass(t,e)){var r=o.DomUtil._getClass(t);o.DomUtil._setClass(t,(r?r+" ":"")+e)}},removeClass:function(t,e){t.classList!==i?t.classList.remove(e):o.DomUtil._setClass(t,o.Util.trim((" "+o.DomUtil._getClass(t)+" ").replace(" "+e+" "," ")))},_setClass:function(t,e){t.className.baseVal===i?t.className=e:t.className.baseVal=e},_getClass:function(t){return t.className.baseVal===i?t.className:t.className.baseVal},setOpacity:function(t,e){if("opacity"in t.style)t.style.opacity=e;else if("filter"in t.style){var i=!1,n="DXImageTransform.Microsoft.Alpha";try{i=t.filters.item(n)}catch(o){if(1===e)return}e=Math.round(100*e),i?(i.Enabled=100!==e,i.Opacity=e):t.style.filter+=" progid:"+n+"(opacity="+e+")"}},testProp:function(t){for(var i=e.documentElement.style,n=0;n<t.length;n++)if(t[n]in i)return t[n];return!1},getTranslateString:function(t){var e=o.Browser.webkit3d,i="translate"+(e?"3d":"")+"(",n=(e?",0":"")+")";return i+t.x+"px,"+t.y+"px"+n},getScaleString:function(t,e){var i=o.DomUtil.getTranslateString(e.add(e.multiplyBy(-1*t))),n=" scale("+t+") ";return i+n},setPosition:function(t,e,i){t._leaflet_pos=e,!i&&o.Browser.any3d?t.style[o.DomUtil.TRANSFORM]=o.DomUtil.getTranslateString(e):(t.style.left=e.x+"px",t.style.top=e.y+"px")},getPosition:function(t){return t._leaflet_pos}},o.DomUtil.TRANSFORM=o.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),o.DomUtil.TRANSITION=o.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),o.DomUtil.TRANSITION_END="webkitTransition"===o.DomUtil.TRANSITION||"OTransition"===o.DomUtil.TRANSITION?o.DomUtil.TRANSITION+"End":"transitionend",function(){if("onselectstart"in e)o.extend(o.DomUtil,{disableTextSelection:function(){o.DomEvent.on(t,"selectstart",o.DomEvent.preventDefault)},enableTextSelection:function(){o.DomEvent.off(t,"selectstart",o.DomEvent.preventDefault)}});else{var i=o.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);o.extend(o.DomUtil,{disableTextSelection:function(){if(i){var t=e.documentElement.style;this._userSelect=t[i],t[i]="none"}},enableTextSelection:function(){i&&(e.documentElement.style[i]=this._userSelect,delete this._userSelect)}})}o.extend(o.DomUtil,{disableImageDrag:function(){o.DomEvent.on(t,"dragstart",o.DomEvent.preventDefault)},enableImageDrag:function(){o.DomEvent.off(t,"dragstart",o.DomEvent.preventDefault)}})}(),o.LatLng=function(t,e,n){if(t=parseFloat(t),e=parseFloat(e),isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=t,this.lng=e,n!==i&&(this.alt=parseFloat(n))},o.extend(o.LatLng,{DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MAX_MARGIN:1e-9}),o.LatLng.prototype={equals:function(t){if(!t)return!1;t=o.latLng(t);var e=Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng));return e<=o.LatLng.MAX_MARGIN},toString:function(t){return"LatLng("+o.Util.formatNum(this.lat,t)+", "+o.Util.formatNum(this.lng,t)+")"},distanceTo:function(t){t=o.latLng(t);var e=6378137,i=o.LatLng.DEG_TO_RAD,n=(t.lat-this.lat)*i,s=(t.lng-this.lng)*i,a=this.lat*i,r=t.lat*i,h=Math.sin(n/2),l=Math.sin(s/2),u=h*h+l*l*Math.cos(a)*Math.cos(r);return 2*e*Math.atan2(Math.sqrt(u),Math.sqrt(1-u))},wrap:function(t,e){var i=this.lng;return t=t||-180,e=e||180,i=(i+e)%(e-t)+(t>i||i===e?e:t),new o.LatLng(this.lat,i)}},o.latLng=function(t,e){return t instanceof o.LatLng?t:o.Util.isArray(t)?"number"==typeof t[0]||"string"==typeof t[0]?new o.LatLng(t[0],t[1],t[2]):null:t===i||null===t?t:"object"==typeof t&&"lat"in t?new o.LatLng(t.lat,"lng"in t?t.lng:t.lon):e===i?null:new o.LatLng(t,e)},o.LatLngBounds=function(t,e){if(t)for(var i=e?[t,e]:t,n=0,o=i.length;o>n;n++)this.extend(i[n])},o.LatLngBounds.prototype={extend:function(t){if(!t)return this;var e=o.latLng(t);return t=null!==e?e:o.latLngBounds(t),t instanceof o.LatLng?this._southWest||this._northEast?(this._southWest.lat=Math.min(t.lat,this._southWest.lat),this._southWest.lng=Math.min(t.lng,this._southWest.lng),this._northEast.lat=Math.max(t.lat,this._northEast.lat),this._northEast.lng=Math.max(t.lng,this._northEast.lng)):(this._southWest=new o.LatLng(t.lat,t.lng),this._northEast=new o.LatLng(t.lat,t.lng)):t instanceof o.LatLngBounds&&(this.extend(t._southWest),this.extend(t._northEast)),this},pad:function(t){var e=this._southWest,i=this._northEast,n=Math.abs(e.lat-i.lat)*t,s=Math.abs(e.lng-i.lng)*t;return new o.LatLngBounds(new o.LatLng(e.lat-n,e.lng-s),new o.LatLng(i.lat+n,i.lng+s))},getCenter:function(){return new o.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new o.LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new o.LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){t="number"==typeof t[0]||t instanceof o.LatLng?o.latLng(t):o.latLngBounds(t);var e,i,n=this._southWest,s=this._northEast;return t instanceof o.LatLngBounds?(e=t.getSouthWest(),i=t.getNorthEast()):e=i=t,e.lat>=n.lat&&i.lat<=s.lat&&e.lng>=n.lng&&i.lng<=s.lng},intersects:function(t){t=o.latLngBounds(t);var e=this._southWest,i=this._northEast,n=t.getSouthWest(),s=t.getNorthEast(),a=s.lat>=e.lat&&n.lat<=i.lat,r=s.lng>=e.lng&&n.lng<=i.lng;return a&&r},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t){return t?(t=o.latLngBounds(t),this._southWest.equals(t.getSouthWest())&&this._northEast.equals(t.getNorthEast())):!1},isValid:function(){return!(!this._southWest||!this._northEast)}},o.latLngBounds=function(t,e){return!t||t instanceof o.LatLngBounds?t:new o.LatLngBounds(t,e)},o.Projection={},o.Projection.SphericalMercator={MAX_LATITUDE:85.0511287798,project:function(t){var e=o.LatLng.DEG_TO_RAD,i=this.MAX_LATITUDE,n=Math.max(Math.min(i,t.lat),-i),s=t.lng*e,a=n*e;return a=Math.log(Math.tan(Math.PI/4+a/2)),new o.Point(s,a)},unproject:function(t){var e=o.LatLng.RAD_TO_DEG,i=t.x*e,n=(2*Math.atan(Math.exp(t.y))-Math.PI/2)*e;return new o.LatLng(n,i)}},o.Projection.LonLat={project:function(t){return new o.Point(t.lng,t.lat)},unproject:function(t){return new o.LatLng(t.y,t.x)}},o.CRS={latLngToPoint:function(t,e){var i=this.projection.project(t),n=this.scale(e);return this.transformation._transform(i,n)},pointToLatLng:function(t,e){var i=this.scale(e),n=this.transformation.untransform(t,i);return this.projection.unproject(n)},project:function(t){return this.projection.project(t)},scale:function(t){return 256*Math.pow(2,t)},getSize:function(t){var e=this.scale(t);return o.point(e,e)}},o.CRS.Simple=o.extend({},o.CRS,{projection:o.Projection.LonLat,transformation:new o.Transformation(1,0,-1,0),scale:function(t){return Math.pow(2,t)}}),o.CRS.EPSG3857=o.extend({},o.CRS,{code:"EPSG:3857",projection:o.Projection.SphericalMercator,transformation:new o.Transformation(.5/Math.PI,.5,-.5/Math.PI,.5),project:function(t){var e=this.projection.project(t),i=6378137;return e.multiplyBy(i)}}),o.CRS.EPSG900913=o.extend({},o.CRS.EPSG3857,{code:"EPSG:900913"}),o.CRS.EPSG4326=o.extend({},o.CRS,{code:"EPSG:4326",projection:o.Projection.LonLat,transformation:new o.Transformation(1/360,.5,-1/360,.5)}),o.Map=o.Class.extend({includes:o.Mixin.Events,options:{crs:o.CRS.EPSG3857,fadeAnimation:o.DomUtil.TRANSITION&&!o.Browser.android23,trackResize:!0,markerZoomAnimation:o.DomUtil.TRANSITION&&o.Browser.any3d},initialize:function(t,e){e=o.setOptions(this,e),this._initContainer(t),this._initLayout(),this._onResize=o.bind(this._onResize,this),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),e.center&&e.zoom!==i&&this.setView(o.latLng(e.center),e.zoom,{reset:!0}),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._tileLayersNum=0,this.callInitHooks(),this._addLayers(e.layers)},setView:function(t,e){return e=e===i?this.getZoom():e,this._resetView(o.latLng(t),this._limitZoom(e)),this},setZoom:function(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=this._limitZoom(t),this)},zoomIn:function(t,e){return this.setZoom(this._zoom+(t||1),e)},zoomOut:function(t,e){return this.setZoom(this._zoom-(t||1),e)},setZoomAround:function(t,e,i){var n=this.getZoomScale(e),s=this.getSize().divideBy(2),a=t instanceof o.Point?t:this.latLngToContainerPoint(t),r=a.subtract(s).multiplyBy(1-1/n),h=this.containerPointToLatLng(s.add(r));return this.setView(h,e,{zoom:i})},fitBounds:function(t,e){e=e||{},t=t.getBounds?t.getBounds():o.latLngBounds(t);var i=o.point(e.paddingTopLeft||e.padding||[0,0]),n=o.point(e.paddingBottomRight||e.padding||[0,0]),s=this.getBoundsZoom(t,!1,i.add(n)),a=n.subtract(i).divideBy(2),r=this.project(t.getSouthWest(),s),h=this.project(t.getNorthEast(),s),l=this.unproject(r.add(h).divideBy(2).add(a),s);return s=e&&e.maxZoom?Math.min(e.maxZoom,s):s,this.setView(l,s,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t){return this.fire("movestart"),this._rawPanBy(o.point(t)),this.fire("move"),this.fire("moveend")},setMaxBounds:function(t){return t=o.latLngBounds(t),this.options.maxBounds=t,t?(this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds,this)):this.off("moveend",this._panInsideMaxBounds,this)},panInsideBounds:function(t,e){var i=this.getCenter(),n=this._limitCenter(i,this._zoom,t);return i.equals(n)?this:this.panTo(n,e)},addLayer:function(t){var e=o.stamp(t);return this._layers[e]?this:(this._layers[e]=t,!t.options||isNaN(t.options.maxZoom)&&isNaN(t.options.minZoom)||(this._zoomBoundLayers[e]=t,this._updateZoomLevels()),this.options.zoomAnimation&&o.TileLayer&&t instanceof o.TileLayer&&(this._tileLayersNum++,this._tileLayersToLoad++,t.on("load",this._onTileLayerLoad,this)),this._loaded&&this._layerAdd(t),this)},removeLayer:function(t){var e=o.stamp(t);return this._layers[e]?(this._loaded&&t.onRemove(this),delete this._layers[e],this._loaded&&this.fire("layerremove",{layer:t}),this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels()),this.options.zoomAnimation&&o.TileLayer&&t instanceof o.TileLayer&&(this._tileLayersNum--,this._tileLayersToLoad--,t.off("load",this._onTileLayerLoad,this)),this):this},hasLayer:function(t){return t?o.stamp(t)in this._layers:!1},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},invalidateSize:function(t){if(!this._loaded)return this;t=o.extend({animate:!1,pan:!0},t===!0?{animate:!0}:t);var e=this.getSize();this._sizeChanged=!0,this._initialCenter=null;var i=this.getSize(),n=e.divideBy(2).round(),s=i.divideBy(2).round(),a=n.subtract(s);return a.x||a.y?(t.animate&&t.pan?this.panBy(a):(t.pan&&this._rawPanBy(a),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(o.bind(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:e,newSize:i})):this},addHandler:function(t,e){if(!e)return this;var i=this[t]=new e(this);return this._handlers.push(i),this.options[t]&&i.enable(),this},remove:function(){this._loaded&&this.fire("unload"),this._initEvents("off");try{delete this._container._leaflet}catch(t){this._container._leaflet=i}return this._clearPanes(),this._clearControlPos&&this._clearControlPos(),this._clearHandlers(),this},getCenter:function(){return this._checkIfLoaded(),this._initialCenter&&!this._moved()?this._initialCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds(),e=this.unproject(t.getBottomLeft()),i=this.unproject(t.getTopRight());return new o.LatLngBounds(e,i)},getMinZoom:function(){return this.options.minZoom===i?this._layersMinZoom===i?0:this._layersMinZoom:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===i?this._layersMaxZoom===i?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,e,i){t=o.latLngBounds(t);var n,s=this.getMinZoom()-(e?1:0),a=this.getMaxZoom(),r=this.getSize(),h=t.getNorthWest(),l=t.getSouthEast(),u=!0;i=o.point(i||[0,0]);do s++,n=this.project(l,s).subtract(this.project(h,s)).add(i),u=e?n.x<r.x||n.y<r.y:r.contains(n);while(u&&a>=s);return u&&e?null:e?s:s-1},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new o.Point(this._container.clientWidth,this._container.clientHeight),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(){var t=this._getTopLeftPoint();return new o.Bounds(t,t.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._initialTopLeftPoint},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t){var e=this.options.crs;return e.scale(t)/e.scale(this._zoom)},getScaleZoom:function(t){return this._zoom+Math.log(t)/Math.LN2},project:function(t,e){return e=e===i?this._zoom:e,this.options.crs.latLngToPoint(o.latLng(t),e)},unproject:function(t,e){return e=e===i?this._zoom:e,this.options.crs.pointToLatLng(o.point(t),e)},layerPointToLatLng:function(t){var e=o.point(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){var e=this.project(o.latLng(t))._round();return e._subtract(this.getPixelOrigin())},containerPointToLayerPoint:function(t){return o.point(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return o.point(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint(o.point(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(o.latLng(t)))},mouseEventToContainerPoint:function(t){return o.DomEvent.getMousePosition(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=o.DomUtil.get(t);if(!e)throw new Error("Map container not found.");if(e._leaflet)throw new Error("Map container is already initialized.");e._leaflet=!0},_initLayout:function(){var t=this._container;o.DomUtil.addClass(t,"leaflet-container"+(o.Browser.touch?" leaflet-touch":"")+(o.Browser.retina?" leaflet-retina":"")+(o.Browser.ielt9?" leaflet-oldie":"")+(this.options.fadeAnimation?" leaflet-fade-anim":""));var e=o.DomUtil.getStyle(t,"position");"absolute"!==e&&"relative"!==e&&"fixed"!==e&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._mapPane=t.mapPane=this._createPane("leaflet-map-pane",this._container),this._tilePane=t.tilePane=this._createPane("leaflet-tile-pane",this._mapPane),t.objectsPane=this._createPane("leaflet-objects-pane",this._mapPane),t.shadowPane=this._createPane("leaflet-shadow-pane"),t.overlayPane=this._createPane("leaflet-overlay-pane"),t.markerPane=this._createPane("leaflet-marker-pane"),t.popupPane=this._createPane("leaflet-popup-pane");var e=" leaflet-zoom-hide";this.options.markerZoomAnimation||(o.DomUtil.addClass(t.markerPane,e),o.DomUtil.addClass(t.shadowPane,e),o.DomUtil.addClass(t.popupPane,e))},_createPane:function(t,e){return o.DomUtil.create("div",t,e||this._panes.objectsPane)},_clearPanes:function(){this._container.removeChild(this._mapPane)},_addLayers:function(t){t=t?o.Util.isArray(t)?t:[t]:[];for(var e=0,i=t.length;i>e;e++)this.addLayer(t[e])},_resetView:function(t,e,i,n){var s=this._zoom!==e;n||(this.fire("movestart"),s&&this.fire("zoomstart")),this._zoom=e,this._initialCenter=t,this._initialTopLeftPoint=this._getNewTopLeftPoint(t),i?this._initialTopLeftPoint._add(this._getMapPanePos()):o.DomUtil.setPosition(this._mapPane,new o.Point(0,0)),this._tileLayersToLoad=this._tileLayersNum;var a=!this._loaded;this._loaded=!0,a&&(this.fire("load"),this.eachLayer(this._layerAdd,this)),this.fire("viewreset",{hard:!i}),this.fire("move"),(s||n)&&this.fire("zoomend"),this.fire("moveend",{hard:!i})},_rawPanBy:function(t){o.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_updateZoomLevels:function(){var t,e=1/0,n=-1/0,o=this._getZoomSpan();for(t in this._zoomBoundLayers){var s=this._zoomBoundLayers[t];isNaN(s.options.minZoom)||(e=Math.min(e,s.options.minZoom)),isNaN(s.options.maxZoom)||(n=Math.max(n,s.options.maxZoom))}t===i?this._layersMaxZoom=this._layersMinZoom=i:(this._layersMaxZoom=n,this._layersMinZoom=e),o!==this._getZoomSpan()&&this.fire("zoomlevelschange")},_panInsideMaxBounds:function(){this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(e){if(o.DomEvent){e=e||"on",o.DomEvent[e](this._container,"click",this._onMouseClick,this);var i,n,s=["dblclick","mousedown","mouseup","mouseenter","mouseleave","mousemove","contextmenu"];for(i=0,n=s.length;n>i;i++)o.DomEvent[e](this._container,s[i],this._fireMouseEvent,this);this.options.trackResize&&o.DomEvent[e](t,"resize",this._onResize,this)}},_onResize:function(){o.Util.cancelAnimFrame(this._resizeRequest),this._resizeRequest=o.Util.requestAnimFrame(function(){this.invalidateSize({debounceMoveend:!0})},this,!1,this._container)},_onMouseClick:function(t){!this._loaded||!t._simulated&&(this.dragging&&this.dragging.moved()||this.boxZoom&&this.boxZoom.moved())||o.DomEvent._skipped(t)||(this.fire("preclick"),this._fireMouseEvent(t))},_fireMouseEvent:function(t){if(this._loaded&&!o.DomEvent._skipped(t)){var e=t.type;if(e="mouseenter"===e?"mouseover":"mouseleave"===e?"mouseout":e,this.hasEventListeners(e)){"contextmenu"===e&&o.DomEvent.preventDefault(t);var i=this.mouseEventToContainerPoint(t),n=this.containerPointToLayerPoint(i),s=this.layerPointToLatLng(n);this.fire(e,{latlng:s,layerPoint:n,containerPoint:i,originalEvent:t})}}},_onTileLayerLoad:function(){this._tileLayersToLoad--,this._tileLayersNum&&!this._tileLayersToLoad&&this.fire("tilelayersload")},_clearHandlers:function(){for(var t=0,e=this._handlers.length;e>t;t++)this._handlers[t].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,this):this.on("load",t,e),this},_layerAdd:function(t){t.onAdd(this),this.fire("layeradd",{layer:t})},_getMapPanePos:function(){return o.DomUtil.getPosition(this._mapPane)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(){return this.getPixelOrigin().subtract(this._getMapPanePos())},_getNewTopLeftPoint:function(t,e){var i=this.getSize()._divideBy(2);return this.project(t,e)._subtract(i)._round()},_latLngToNewLayerPoint:function(t,e,i){var n=this._getNewTopLeftPoint(i,e).add(this._getMapPanePos());return this.project(t,e)._subtract(n)},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,e,i){if(!i)return t;var n=this.project(t,e),s=this.getSize().divideBy(2),a=new o.Bounds(n.subtract(s),n.add(s)),r=this._getBoundsOffset(a,i,e);return this.unproject(n.add(r),e)},_limitOffset:function(t,e){if(!e)return t;var i=this.getPixelBounds(),n=new o.Bounds(i.min.add(t),i.max.add(t));return t.add(this._getBoundsOffset(n,e))},_getBoundsOffset:function(t,e,i){var n=this.project(e.getNorthWest(),i).subtract(t.min),s=this.project(e.getSouthEast(),i).subtract(t.max),a=this._rebound(n.x,-s.x),r=this._rebound(n.y,-s.y);return new o.Point(a,r)},_rebound:function(t,e){return t+e>0?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))},_limitZoom:function(t){var e=this.getMinZoom(),i=this.getMaxZoom();return Math.max(e,Math.min(i,t))}}),o.map=function(t,e){return new o.Map(t,e)},o.Projection.Mercator={MAX_LATITUDE:85.0840591556,R_MINOR:6356752.314245179,R_MAJOR:6378137,project:function(t){var e=o.LatLng.DEG_TO_RAD,i=this.MAX_LATITUDE,n=Math.max(Math.min(i,t.lat),-i),s=this.R_MAJOR,a=this.R_MINOR,r=t.lng*e*s,h=n*e,l=a/s,u=Math.sqrt(1-l*l),c=u*Math.sin(h);c=Math.pow((1-c)/(1+c),.5*u);var d=Math.tan(.5*(.5*Math.PI-h))/c;return h=-s*Math.log(d),new o.Point(r,h)},unproject:function(t){for(var e,i=o.LatLng.RAD_TO_DEG,n=this.R_MAJOR,s=this.R_MINOR,a=t.x*i/n,r=s/n,h=Math.sqrt(1-r*r),l=Math.exp(-t.y/n),u=Math.PI/2-2*Math.atan(l),c=15,d=1e-7,p=c,_=.1;Math.abs(_)>d&&--p>0;)e=h*Math.sin(u),_=Math.PI/2-2*Math.atan(l*Math.pow((1-e)/(1+e),.5*h))-u,u+=_;
return new o.LatLng(u*i,a)}},o.CRS.EPSG3395=o.extend({},o.CRS,{code:"EPSG:3395",projection:o.Projection.Mercator,transformation:function(){var t=o.Projection.Mercator,e=t.R_MAJOR,i=.5/(Math.PI*e);return new o.Transformation(i,.5,-i,.5)}()}),o.TileLayer=o.Class.extend({includes:o.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",zoomOffset:0,opacity:1,unloadInvisibleTiles:o.Browser.mobile,updateWhenIdle:o.Browser.mobile},initialize:function(t,e){e=o.setOptions(this,e),e.detectRetina&&o.Browser.retina&&e.maxZoom>0&&(e.tileSize=Math.floor(e.tileSize/2),e.zoomOffset++,e.minZoom>0&&e.minZoom--,this.options.maxZoom--),e.bounds&&(e.bounds=o.latLngBounds(e.bounds)),this._url=t;var i=this.options.subdomains;"string"==typeof i&&(this.options.subdomains=i.split(""))},onAdd:function(t){this._map=t,this._animated=t._zoomAnimated,this._initContainer(),t.on({viewreset:this._reset,moveend:this._update},this),this._animated&&t.on({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.updateWhenIdle||(this._limitedUpdate=o.Util.limitExecByInterval(this._update,150,this),t.on("move",this._limitedUpdate,this)),this._reset(),this._update()},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){this._container.parentNode.removeChild(this._container),t.off({viewreset:this._reset,moveend:this._update},this),this._animated&&t.off({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.updateWhenIdle||t.off("move",this._limitedUpdate,this),this._container=null,this._map=null},bringToFront:function(){var t=this._map._panes.tilePane;return this._container&&(t.appendChild(this._container),this._setAutoZIndex(t,Math.max)),this},bringToBack:function(){var t=this._map._panes.tilePane;return this._container&&(t.insertBefore(this._container,t.firstChild),this._setAutoZIndex(t,Math.min)),this},getAttribution:function(){return this.options.attribution},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},setUrl:function(t,e){return this._url=t,e||this.redraw(),this},redraw:function(){return this._map&&(this._reset({hard:!0}),this._update()),this},_updateZIndex:function(){this._container&&this.options.zIndex!==i&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t,e){var i,n,o,s=t.children,a=-e(1/0,-1/0);for(n=0,o=s.length;o>n;n++)s[n]!==this._container&&(i=parseInt(s[n].style.zIndex,10),isNaN(i)||(a=e(a,i)));this.options.zIndex=this._container.style.zIndex=(isFinite(a)?a:0)+e(1,-1)},_updateOpacity:function(){var t,e=this._tiles;if(o.Browser.ielt9)for(t in e)o.DomUtil.setOpacity(e[t],this.options.opacity);else o.DomUtil.setOpacity(this._container,this.options.opacity)},_initContainer:function(){var t=this._map._panes.tilePane;if(!this._container){if(this._container=o.DomUtil.create("div","leaflet-layer"),this._updateZIndex(),this._animated){var e="leaflet-tile-container";this._bgBuffer=o.DomUtil.create("div",e,this._container),this._tileContainer=o.DomUtil.create("div",e,this._container)}else this._tileContainer=this._container;t.appendChild(this._container),this.options.opacity<1&&this._updateOpacity()}},_reset:function(t){for(var e in this._tiles)this.fire("tileunload",{tile:this._tiles[e]});this._tiles={},this._tilesToLoad=0,this.options.reuseTiles&&(this._unusedTiles=[]),this._tileContainer.innerHTML="",this._animated&&t&&t.hard&&this._clearBgBuffer(),this._initContainer()},_getTileSize:function(){var t=this._map,e=t.getZoom()+this.options.zoomOffset,i=this.options.maxNativeZoom,n=this.options.tileSize;return i&&e>i&&(n=Math.round(t.getZoomScale(e)/t.getZoomScale(i)*n)),n},_update:function(){if(this._map){var t=this._map,e=t.getPixelBounds(),i=t.getZoom(),n=this._getTileSize();if(!(i>this.options.maxZoom||i<this.options.minZoom)){var s=o.bounds(e.min.divideBy(n)._floor(),e.max.divideBy(n)._floor());this._addTilesFromCenterOut(s),(this.options.unloadInvisibleTiles||this.options.reuseTiles)&&this._removeOtherTiles(s)}}},_addTilesFromCenterOut:function(t){var i,n,s,a=[],r=t.getCenter();for(i=t.min.y;i<=t.max.y;i++)for(n=t.min.x;n<=t.max.x;n++)s=new o.Point(n,i),this._tileShouldBeLoaded(s)&&a.push(s);var h=a.length;if(0!==h){a.sort(function(t,e){return t.distanceTo(r)-e.distanceTo(r)});var l=e.createDocumentFragment();for(this._tilesToLoad||this.fire("loading"),this._tilesToLoad+=h,n=0;h>n;n++)this._addTile(a[n],l);this._tileContainer.appendChild(l)}},_tileShouldBeLoaded:function(t){if(t.x+":"+t.y in this._tiles)return!1;var e=this.options;if(!e.continuousWorld){var i=this._getWrapTileNum();if(e.noWrap&&(t.x<0||t.x>=i.x)||t.y<0||t.y>=i.y)return!1}if(e.bounds){var n=e.tileSize,o=t.multiplyBy(n),s=o.add([n,n]),a=this._map.unproject(o),r=this._map.unproject(s);if(e.continuousWorld||e.noWrap||(a=a.wrap(),r=r.wrap()),!e.bounds.intersects([a,r]))return!1}return!0},_removeOtherTiles:function(t){var e,i,n,o;for(o in this._tiles)e=o.split(":"),i=parseInt(e[0],10),n=parseInt(e[1],10),(i<t.min.x||i>t.max.x||n<t.min.y||n>t.max.y)&&this._removeTile(o)},_removeTile:function(t){var e=this._tiles[t];this.fire("tileunload",{tile:e,url:e.src}),this.options.reuseTiles?(o.DomUtil.removeClass(e,"leaflet-tile-loaded"),this._unusedTiles.push(e)):e.parentNode===this._tileContainer&&this._tileContainer.removeChild(e),o.Browser.android||(e.onload=null,e.src=o.Util.emptyImageUrl),delete this._tiles[t]},_addTile:function(t,e){var i=this._getTilePos(t),n=this._getTile();o.DomUtil.setPosition(n,i,o.Browser.chrome),this._tiles[t.x+":"+t.y]=n,this._loadTile(n,t),n.parentNode!==this._tileContainer&&e.appendChild(n)},_getZoomForUrl:function(){var t=this.options,e=this._map.getZoom();return t.zoomReverse&&(e=t.maxZoom-e),e+=t.zoomOffset,t.maxNativeZoom?Math.min(e,t.maxNativeZoom):e},_getTilePos:function(t){var e=this._map.getPixelOrigin(),i=this._getTileSize();return t.multiplyBy(i).subtract(e)},getTileUrl:function(t){return o.Util.template(this._url,o.extend({s:this._getSubdomain(t),z:t.z,x:t.x,y:t.y},this.options))},_getWrapTileNum:function(){var t=this._map.options.crs,e=t.getSize(this._map.getZoom());return e.divideBy(this._getTileSize())._floor()},_adjustTilePoint:function(t){var e=this._getWrapTileNum();this.options.continuousWorld||this.options.noWrap||(t.x=(t.x%e.x+e.x)%e.x),this.options.tms&&(t.y=e.y-t.y-1),t.z=this._getZoomForUrl()},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_getTile:function(){if(this.options.reuseTiles&&this._unusedTiles.length>0){var t=this._unusedTiles.pop();return this._resetTile(t),t}return this._createTile()},_resetTile:function(){},_createTile:function(){var t=o.DomUtil.create("img","leaflet-tile");return t.style.width=t.style.height=this._getTileSize()+"px",t.galleryimg="no",t.onselectstart=t.onmousemove=o.Util.falseFn,o.Browser.ielt9&&this.options.opacity!==i&&o.DomUtil.setOpacity(t,this.options.opacity),o.Browser.mobileWebkit3d&&(t.style.WebkitBackfaceVisibility="hidden"),t},_loadTile:function(t,e){t._layer=this,t.onload=this._tileOnLoad,t.onerror=this._tileOnError,this._adjustTilePoint(e),t.src=this.getTileUrl(e),this.fire("tileloadstart",{tile:t,url:t.src})},_tileLoaded:function(){this._tilesToLoad--,this._animated&&o.DomUtil.addClass(this._tileContainer,"leaflet-zoom-animated"),this._tilesToLoad||(this.fire("load"),this._animated&&(clearTimeout(this._clearBgBufferTimer),this._clearBgBufferTimer=setTimeout(o.bind(this._clearBgBuffer,this),500)))},_tileOnLoad:function(){var t=this._layer;this.src!==o.Util.emptyImageUrl&&(o.DomUtil.addClass(this,"leaflet-tile-loaded"),t.fire("tileload",{tile:this,url:this.src})),t._tileLoaded()},_tileOnError:function(){var t=this._layer;t.fire("tileerror",{tile:this,url:this.src});var e=t.options.errorTileUrl;e&&(this.src=e),t._tileLoaded()}}),o.tileLayer=function(t,e){return new o.TileLayer(t,e)},o.TileLayer.WMS=o.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:!1},initialize:function(t,e){this._url=t;var i=o.extend({},this.defaultWmsParams),n=e.tileSize||this.options.tileSize;i.width=i.height=e.detectRetina&&o.Browser.retina?2*n:n;for(var s in e)this.options.hasOwnProperty(s)||"crs"===s||(i[s]=e[s]);this.wmsParams=i,o.setOptions(this,e)},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var e=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[e]=this._crs.code,o.TileLayer.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._map,i=this.options.tileSize,n=t.multiplyBy(i),s=n.add([i,i]),a=this._crs.project(e.unproject(n,t.z)),r=this._crs.project(e.unproject(s,t.z)),h=this._wmsVersion>=1.3&&this._crs===o.CRS.EPSG4326?[r.y,a.x,a.y,r.x].join(","):[a.x,r.y,r.x,a.y].join(","),l=o.Util.template(this._url,{s:this._getSubdomain(t)});return l+o.Util.getParamString(this.wmsParams,l,!0)+"&BBOX="+h},setParams:function(t,e){return o.extend(this.wmsParams,t),e||this.redraw(),this}}),o.tileLayer.wms=function(t,e){return new o.TileLayer.WMS(t,e)},o.TileLayer.Canvas=o.TileLayer.extend({options:{async:!1},initialize:function(t){o.setOptions(this,t)},redraw:function(){this._map&&(this._reset({hard:!0}),this._update());for(var t in this._tiles)this._redrawTile(this._tiles[t]);return this},_redrawTile:function(t){this.drawTile(t,t._tilePoint,this._map._zoom)},_createTile:function(){var t=o.DomUtil.create("canvas","leaflet-tile");return t.width=t.height=this.options.tileSize,t.onselectstart=t.onmousemove=o.Util.falseFn,t},_loadTile:function(t,e){t._layer=this,t._tilePoint=e,this._redrawTile(t),this.options.async||this.tileDrawn(t)},drawTile:function(){},tileDrawn:function(t){this._tileOnLoad.call(t)}}),o.tileLayer.canvas=function(t){return new o.TileLayer.Canvas(t)},o.ImageOverlay=o.Class.extend({includes:o.Mixin.Events,options:{opacity:1},initialize:function(t,e,i){this._url=t,this._bounds=o.latLngBounds(e),o.setOptions(this,i)},onAdd:function(t){this._map=t,this._image||this._initImage(),t._panes.overlayPane.appendChild(this._image),t.on("viewreset",this._reset,this),t.options.zoomAnimation&&o.Browser.any3d&&t.on("zoomanim",this._animateZoom,this),this._reset()},onRemove:function(t){t.getPanes().overlayPane.removeChild(this._image),t.off("viewreset",this._reset,this),t.options.zoomAnimation&&t.off("zoomanim",this._animateZoom,this)},addTo:function(t){return t.addLayer(this),this},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},bringToFront:function(){return this._image&&this._map._panes.overlayPane.appendChild(this._image),this},bringToBack:function(){var t=this._map._panes.overlayPane;return this._image&&t.insertBefore(this._image,t.firstChild),this},setUrl:function(t){this._url=t,this._image.src=this._url},getAttribution:function(){return this.options.attribution},_initImage:function(){this._image=o.DomUtil.create("img","leaflet-image-layer"),this._map.options.zoomAnimation&&o.Browser.any3d?o.DomUtil.addClass(this._image,"leaflet-zoom-animated"):o.DomUtil.addClass(this._image,"leaflet-zoom-hide"),this._updateOpacity(),o.extend(this._image,{galleryimg:"no",onselectstart:o.Util.falseFn,onmousemove:o.Util.falseFn,onload:o.bind(this._onImageLoad,this),src:this._url})},_animateZoom:function(t){var e=this._map,i=this._image,n=e.getZoomScale(t.zoom),s=this._bounds.getNorthWest(),a=this._bounds.getSouthEast(),r=e._latLngToNewLayerPoint(s,t.zoom,t.center),h=e._latLngToNewLayerPoint(a,t.zoom,t.center)._subtract(r),l=r._add(h._multiplyBy(.5*(1-1/n)));i.style[o.DomUtil.TRANSFORM]=o.DomUtil.getTranslateString(l)+" scale("+n+") "},_reset:function(){var t=this._image,e=this._map.latLngToLayerPoint(this._bounds.getNorthWest()),i=this._map.latLngToLayerPoint(this._bounds.getSouthEast())._subtract(e);o.DomUtil.setPosition(t,e),t.style.width=i.x+"px",t.style.height=i.y+"px"},_onImageLoad:function(){this.fire("load")},_updateOpacity:function(){o.DomUtil.setOpacity(this._image,this.options.opacity)}}),o.imageOverlay=function(t,e,i){return new o.ImageOverlay(t,e,i)},o.Icon=o.Class.extend({options:{className:""},initialize:function(t){o.setOptions(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var i=this._getIconUrl(t);if(!i){if("icon"===t)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var n;return n=e&&"IMG"===e.tagName?this._createImg(i,e):this._createImg(i),this._setIconStyles(n,t),n},_setIconStyles:function(t,e){var i,n=this.options,s=o.point(n[e+"Size"]);i=o.point("shadow"===e?n.shadowAnchor||n.iconAnchor:n.iconAnchor),!i&&s&&(i=s.divideBy(2,!0)),t.className="leaflet-marker-"+e+" "+n.className,i&&(t.style.marginLeft=-i.x+"px",t.style.marginTop=-i.y+"px"),s&&(t.style.width=s.x+"px",t.style.height=s.y+"px")},_createImg:function(t,i){return i=i||e.createElement("img"),i.src=t,i},_getIconUrl:function(t){return o.Browser.retina&&this.options[t+"RetinaUrl"]?this.options[t+"RetinaUrl"]:this.options[t+"Url"]}}),o.icon=function(t){return new o.Icon(t)},o.Icon.Default=o.Icon.extend({options:{iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]},_getIconUrl:function(t){var e=t+"Url";if(this.options[e])return this.options[e];o.Browser.retina&&"icon"===t&&(t+="-2x");var i=o.Icon.Default.imagePath;if(!i)throw new Error("Couldn't autodetect L.Icon.Default.imagePath, set it manually.");return i+"/marker-"+t+".png"}}),o.Icon.Default.imagePath=function(){var t,i,n,o,s,a=e.getElementsByTagName("script"),r=/[\/^]leaflet[\-\._]?([\w\-\._]*)\.js\??/;for(t=0,i=a.length;i>t;t++)if(n=a[t].src,o=n.match(r))return s=n.split(r)[0],(s?s+"/":"")+"images"}(),o.Marker=o.Class.extend({includes:o.Mixin.Events,options:{icon:new o.Icon.Default,title:"",alt:"",clickable:!0,draggable:!1,keyboard:!0,zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250},initialize:function(t,e){o.setOptions(this,e),this._latlng=o.latLng(t)},onAdd:function(t){this._map=t,t.on("viewreset",this.update,this),this._initIcon(),this.update(),this.fire("add"),t.options.zoomAnimation&&t.options.markerZoomAnimation&&t.on("zoomanim",this._animateZoom,this)},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){this.dragging&&this.dragging.disable(),this._removeIcon(),this._removeShadow(),this.fire("remove"),t.off({viewreset:this.update,zoomanim:this._animateZoom},this),this._map=null},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=o.latLng(t),this.update(),this.fire("move",{latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update(),this},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup),this},update:function(){if(this._icon){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,e=this._map,i=e.options.zoomAnimation&&e.options.markerZoomAnimation,n=i?"leaflet-zoom-animated":"leaflet-zoom-hide",s=t.icon.createIcon(this._icon),a=!1;s!==this._icon&&(this._icon&&this._removeIcon(),a=!0,t.title&&(s.title=t.title),t.alt&&(s.alt=t.alt)),o.DomUtil.addClass(s,n),t.keyboard&&(s.tabIndex="0"),this._icon=s,this._initInteraction(),t.riseOnHover&&o.DomEvent.on(s,"mouseover",this._bringToFront,this).on(s,"mouseout",this._resetZIndex,this);var r=t.icon.createShadow(this._shadow),h=!1;r!==this._shadow&&(this._removeShadow(),h=!0),r&&o.DomUtil.addClass(r,n),this._shadow=r,t.opacity<1&&this._updateOpacity();var l=this._map._panes;a&&l.markerPane.appendChild(this._icon),r&&h&&l.shadowPane.appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&o.DomEvent.off(this._icon,"mouseover",this._bringToFront).off(this._icon,"mouseout",this._resetZIndex),this._map._panes.markerPane.removeChild(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&this._map._panes.shadowPane.removeChild(this._shadow),this._shadow=null},_setPos:function(t){o.DomUtil.setPosition(this._icon,t),this._shadow&&o.DomUtil.setPosition(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon.style.zIndex=this._zIndex+t},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(e)},_initInteraction:function(){if(this.options.clickable){var t=this._icon,e=["dblclick","mousedown","mouseover","mouseout","contextmenu"];o.DomUtil.addClass(t,"leaflet-clickable"),o.DomEvent.on(t,"click",this._onMouseClick,this),o.DomEvent.on(t,"keypress",this._onKeyPress,this);for(var i=0;i<e.length;i++)o.DomEvent.on(t,e[i],this._fireMouseEvent,this);o.Handler.MarkerDrag&&(this.dragging=new o.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable())}},_onMouseClick:function(t){var e=this.dragging&&this.dragging.moved();(this.hasEventListeners(t.type)||e)&&o.DomEvent.stopPropagation(t),e||(this.dragging&&this.dragging._enabled||!this._map.dragging||!this._map.dragging.moved())&&this.fire(t.type,{originalEvent:t,latlng:this._latlng})},_onKeyPress:function(t){13===t.keyCode&&this.fire("click",{originalEvent:t,latlng:this._latlng})},_fireMouseEvent:function(t){this.fire(t.type,{originalEvent:t,latlng:this._latlng}),"contextmenu"===t.type&&this.hasEventListeners(t.type)&&o.DomEvent.preventDefault(t),"mousedown"!==t.type?o.DomEvent.stopPropagation(t):o.DomEvent.preventDefault(t)},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){o.DomUtil.setOpacity(this._icon,this.options.opacity),this._shadow&&o.DomUtil.setOpacity(this._shadow,this.options.opacity)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)}}),o.marker=function(t,e){return new o.Marker(t,e)},o.DivIcon=o.Icon.extend({options:{iconSize:[12,12],className:"leaflet-div-icon",html:!1},createIcon:function(t){var i=t&&"DIV"===t.tagName?t:e.createElement("div"),n=this.options;return i.innerHTML=n.html!==!1?n.html:"",n.bgPos&&(i.style.backgroundPosition=-n.bgPos.x+"px "+-n.bgPos.y+"px"),this._setIconStyles(i,"icon"),i},createShadow:function(){return null}}),o.divIcon=function(t){return new o.DivIcon(t)},o.Map.mergeOptions({closePopupOnClick:!0}),o.Popup=o.Class.extend({includes:o.Mixin.Events,options:{minWidth:50,maxWidth:300,autoPan:!0,closeButton:!0,offset:[0,7],autoPanPadding:[5,5],keepInView:!1,className:"",zoomAnimation:!0},initialize:function(t,e){o.setOptions(this,t),this._source=e,this._animated=o.Browser.any3d&&this.options.zoomAnimation,this._isOpen=!1},onAdd:function(t){this._map=t,this._container||this._initLayout();var e=t.options.fadeAnimation;e&&o.DomUtil.setOpacity(this._container,0),t._panes.popupPane.appendChild(this._container),t.on(this._getEvents(),this),this.update(),e&&o.DomUtil.setOpacity(this._container,1),this.fire("open"),t.fire("popupopen",{popup:this}),this._source&&this._source.fire("popupopen",{popup:this})},addTo:function(t){return t.addLayer(this),this},openOn:function(t){return t.openPopup(this),this},onRemove:function(t){t._panes.popupPane.removeChild(this._container),o.Util.falseFn(this._container.offsetWidth),t.off(this._getEvents(),this),t.options.fadeAnimation&&o.DomUtil.setOpacity(this._container,0),this._map=null,this.fire("close"),t.fire("popupclose",{popup:this}),this._source&&this._source.fire("popupclose",{popup:this})},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=o.latLng(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},_getEvents:function(){var t={viewreset:this._updatePosition};return this._animated&&(t.zoomanim=this._zoomAnimation),("closeOnClick"in this.options?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this._close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var t,e="leaflet-popup",i=e+" "+this.options.className+" leaflet-zoom-"+(this._animated?"animated":"hide"),n=this._container=o.DomUtil.create("div",i);this.options.closeButton&&(t=this._closeButton=o.DomUtil.create("a",e+"-close-button",n),t.href="#close",t.innerHTML="&#215;",o.DomEvent.disableClickPropagation(t),o.DomEvent.on(t,"click",this._onCloseButtonClick,this));var s=this._wrapper=o.DomUtil.create("div",e+"-content-wrapper",n);o.DomEvent.disableClickPropagation(s),this._contentNode=o.DomUtil.create("div",e+"-content",s),o.DomEvent.disableScrollPropagation(this._contentNode),o.DomEvent.on(s,"contextmenu",o.DomEvent.stopPropagation),this._tipContainer=o.DomUtil.create("div",e+"-tip-container",n),this._tip=o.DomUtil.create("div",e+"-tip",this._tipContainer)},_updateContent:function(){if(this._content){if("string"==typeof this._content)this._contentNode.innerHTML=this._content;else{for(;this._contentNode.hasChildNodes();)this._contentNode.removeChild(this._contentNode.firstChild);this._contentNode.appendChild(this._content)}this.fire("contentupdate")}},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var i=t.offsetWidth;i=Math.min(i,this.options.maxWidth),i=Math.max(i,this.options.minWidth),e.width=i+1+"px",e.whiteSpace="",e.height="";var n=t.offsetHeight,s=this.options.maxHeight,a="leaflet-popup-scrolled";s&&n>s?(e.height=s+"px",o.DomUtil.addClass(t,a)):o.DomUtil.removeClass(t,a),this._containerWidth=this._container.offsetWidth},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=this._animated,i=o.point(this.options.offset);e&&o.DomUtil.setPosition(this._container,t),this._containerBottom=-i.y-(e?0:t.y),this._containerLeft=-Math.round(this._containerWidth/2)+i.x+(e?0:t.x),this._container.style.bottom=this._containerBottom+"px",this._container.style.left=this._containerLeft+"px"}},_zoomAnimation:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);o.DomUtil.setPosition(this._container,e)},_adjustPan:function(){if(this.options.autoPan){var t=this._map,e=this._container.offsetHeight,i=this._containerWidth,n=new o.Point(this._containerLeft,-e-this._containerBottom);this._animated&&n._add(o.DomUtil.getPosition(this._container));var s=t.layerPointToContainerPoint(n),a=o.point(this.options.autoPanPadding),r=o.point(this.options.autoPanPaddingTopLeft||a),h=o.point(this.options.autoPanPaddingBottomRight||a),l=t.getSize(),u=0,c=0;s.x+i+h.x>l.x&&(u=s.x+i-l.x+h.x),s.x-u-r.x<0&&(u=s.x-r.x),s.y+e+h.y>l.y&&(c=s.y+e-l.y+h.y),s.y-c-r.y<0&&(c=s.y-r.y),(u||c)&&t.fire("autopanstart").panBy([u,c])}},_onCloseButtonClick:function(t){this._close(),o.DomEvent.stop(t)}}),o.popup=function(t,e){return new o.Popup(t,e)},o.Map.include({openPopup:function(t,e,i){if(this.closePopup(),!(t instanceof o.Popup)){var n=t;t=new o.Popup(i).setLatLng(e).setContent(n)}return t._isOpen=!0,this._popup=t,this.addLayer(t)},closePopup:function(t){return t&&t!==this._popup||(t=this._popup,this._popup=null),t&&(this.removeLayer(t),t._isOpen=!1),this}}),o.Marker.include({openPopup:function(){return this._popup&&this._map&&!this._map.hasLayer(this._popup)&&(this._popup.setLatLng(this._latlng),this._map.openPopup(this._popup)),this},closePopup:function(){return this._popup&&this._popup._close(),this},togglePopup:function(){return this._popup&&(this._popup._isOpen?this.closePopup():this.openPopup()),this},bindPopup:function(t,e){var i=o.point(this.options.icon.options.popupAnchor||[0,0]);return i=i.add(o.Popup.prototype.options.offset),e&&e.offset&&(i=i.add(e.offset)),e=o.extend({offset:i},e),this._popupHandlersAdded||(this.on("click",this.togglePopup,this).on("remove",this.closePopup,this).on("move",this._movePopup,this),this._popupHandlersAdded=!0),t instanceof o.Popup?(o.setOptions(t,e),this._popup=t):this._popup=new o.Popup(e,this).setContent(t),this},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this.togglePopup,this).off("remove",this.closePopup,this).off("move",this._movePopup,this),this._popupHandlersAdded=!1),this},getPopup:function(){return this._popup},_movePopup:function(t){this._popup.setLatLng(t.latlng)}}),o.LayerGroup=o.Class.extend({initialize:function(t){this._layers={};var e,i;if(t)for(e=0,i=t.length;i>e;e++)this.addLayer(t[e])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){return t?t in this._layers||this.getLayerId(t)in this._layers:!1},clearLayers:function(){return this.eachLayer(this.removeLayer,this),this},invoke:function(t){var e,i,n=Array.prototype.slice.call(arguments,1);for(e in this._layers)i=this._layers[e],i[t]&&i[t].apply(i,n);return this},onAdd:function(t){this._map=t,this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t),this._map=null},addTo:function(t){return t.addLayer(this),this},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];for(var e in this._layers)t.push(this._layers[e]);return t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return o.stamp(t)}}),o.layerGroup=function(t){return new o.LayerGroup(t)},o.FeatureGroup=o.LayerGroup.extend({includes:o.Mixin.Events,statics:{EVENTS:"click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose"},addLayer:function(t){return this.hasLayer(t)?this:("on"in t&&t.on(o.FeatureGroup.EVENTS,this._propagateEvent,this),o.LayerGroup.prototype.addLayer.call(this,t),this._popupContent&&t.bindPopup&&t.bindPopup(this._popupContent,this._popupOptions),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.off(o.FeatureGroup.EVENTS,this._propagateEvent,this),o.LayerGroup.prototype.removeLayer.call(this,t),this._popupContent&&this.invoke("unbindPopup"),this.fire("layerremove",{layer:t})):this},bindPopup:function(t,e){return this._popupContent=t,this._popupOptions=e,this.invoke("bindPopup",t,e)},openPopup:function(t){for(var e in this._layers){this._layers[e].openPopup(t);break}return this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new o.LatLngBounds;return this.eachLayer(function(e){t.extend(e instanceof o.Marker?e.getLatLng():e.getBounds())}),t},_propagateEvent:function(t){t=o.extend({layer:t.target,target:this},t),this.fire(t.type,t)}}),o.featureGroup=function(t){return new o.FeatureGroup(t)},o.Path=o.Class.extend({includes:[o.Mixin.Events],statics:{CLIP_PADDING:function(){var e=o.Browser.mobile?1280:2e3,i=(e/Math.max(t.outerWidth,t.outerHeight)-1)/2;return Math.max(0,Math.min(.5,i))}()},options:{stroke:!0,color:"#0033ff",dashArray:null,lineCap:null,lineJoin:null,weight:5,opacity:.5,fill:!1,fillColor:null,fillOpacity:.2,clickable:!0},initialize:function(t){o.setOptions(this,t)},onAdd:function(t){this._map=t,this._container||(this._initElements(),this._initEvents()),this.projectLatlngs(),this._updatePath(),this._container&&this._map._pathRoot.appendChild(this._container),this.fire("add"),t.on({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){t._pathRoot.removeChild(this._container),this.fire("remove"),this._map=null,o.Browser.vml&&(this._container=null,this._stroke=null,this._fill=null),t.off({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},projectLatlngs:function(){},setStyle:function(t){return o.setOptions(this,t),this._container&&this._updateStyle(),this},redraw:function(){return this._map&&(this.projectLatlngs(),this._updatePath()),this}}),o.Map.include({_updatePathViewport:function(){var t=o.Path.CLIP_PADDING,e=this.getSize(),i=o.DomUtil.getPosition(this._mapPane),n=i.multiplyBy(-1)._subtract(e.multiplyBy(t)._round()),s=n.add(e.multiplyBy(1+2*t)._round());this._pathViewport=new o.Bounds(n,s)}}),o.Path.SVG_NS="http://www.w3.org/2000/svg",o.Browser.svg=!(!e.createElementNS||!e.createElementNS(o.Path.SVG_NS,"svg").createSVGRect),o.Path=o.Path.extend({statics:{SVG:o.Browser.svg},bringToFront:function(){var t=this._map._pathRoot,e=this._container;return e&&t.lastChild!==e&&t.appendChild(e),this},bringToBack:function(){var t=this._map._pathRoot,e=this._container,i=t.firstChild;return e&&i!==e&&t.insertBefore(e,i),this},getPathString:function(){},_createElement:function(t){return e.createElementNS(o.Path.SVG_NS,t)},_initElements:function(){this._map._initPathRoot(),this._initPath(),this._initStyle()},_initPath:function(){this._container=this._createElement("g"),this._path=this._createElement("path"),this.options.className&&o.DomUtil.addClass(this._path,this.options.className),this._container.appendChild(this._path)},_initStyle:function(){this.options.stroke&&(this._path.setAttribute("stroke-linejoin","round"),this._path.setAttribute("stroke-linecap","round")),this.options.fill&&this._path.setAttribute("fill-rule","evenodd"),this.options.pointerEvents&&this._path.setAttribute("pointer-events",this.options.pointerEvents),this.options.clickable||this.options.pointerEvents||this._path.setAttribute("pointer-events","none"),this._updateStyle()},_updateStyle:function(){this.options.stroke?(this._path.setAttribute("stroke",this.options.color),this._path.setAttribute("stroke-opacity",this.options.opacity),this._path.setAttribute("stroke-width",this.options.weight),this.options.dashArray?this._path.setAttribute("stroke-dasharray",this.options.dashArray):this._path.removeAttribute("stroke-dasharray"),this.options.lineCap&&this._path.setAttribute("stroke-linecap",this.options.lineCap),this.options.lineJoin&&this._path.setAttribute("stroke-linejoin",this.options.lineJoin)):this._path.setAttribute("stroke","none"),this.options.fill?(this._path.setAttribute("fill",this.options.fillColor||this.options.color),this._path.setAttribute("fill-opacity",this.options.fillOpacity)):this._path.setAttribute("fill","none")},_updatePath:function(){var t=this.getPathString();t||(t="M0 0"),this._path.setAttribute("d",t)},_initEvents:function(){if(this.options.clickable){(o.Browser.svg||!o.Browser.vml)&&o.DomUtil.addClass(this._path,"leaflet-clickable"),o.DomEvent.on(this._container,"click",this._onMouseClick,this);for(var t=["dblclick","mousedown","mouseover","mouseout","mousemove","contextmenu"],e=0;e<t.length;e++)o.DomEvent.on(this._container,t[e],this._fireMouseEvent,this)}},_onMouseClick:function(t){this._map.dragging&&this._map.dragging.moved()||this._fireMouseEvent(t)},_fireMouseEvent:function(t){if(this.hasEventListeners(t.type)){var e=this._map,i=e.mouseEventToContainerPoint(t),n=e.containerPointToLayerPoint(i),s=e.layerPointToLatLng(n);this.fire(t.type,{latlng:s,layerPoint:n,containerPoint:i,originalEvent:t}),"contextmenu"===t.type&&o.DomEvent.preventDefault(t),"mousemove"!==t.type&&o.DomEvent.stopPropagation(t)}}}),o.Map.include({_initPathRoot:function(){this._pathRoot||(this._pathRoot=o.Path.prototype._createElement("svg"),this._panes.overlayPane.appendChild(this._pathRoot),this.options.zoomAnimation&&o.Browser.any3d?(o.DomUtil.addClass(this._pathRoot,"leaflet-zoom-animated"),this.on({zoomanim:this._animatePathZoom,zoomend:this._endPathZoom})):o.DomUtil.addClass(this._pathRoot,"leaflet-zoom-hide"),this.on("moveend",this._updateSvgViewport),this._updateSvgViewport())
},_animatePathZoom:function(t){var e=this.getZoomScale(t.zoom),i=this._getCenterOffset(t.center)._multiplyBy(-e)._add(this._pathViewport.min);this._pathRoot.style[o.DomUtil.TRANSFORM]=o.DomUtil.getTranslateString(i)+" scale("+e+") ",this._pathZooming=!0},_endPathZoom:function(){this._pathZooming=!1},_updateSvgViewport:function(){if(!this._pathZooming){this._updatePathViewport();var t=this._pathViewport,e=t.min,i=t.max,n=i.x-e.x,s=i.y-e.y,a=this._pathRoot,r=this._panes.overlayPane;o.Browser.mobileWebkit&&r.removeChild(a),o.DomUtil.setPosition(a,e),a.setAttribute("width",n),a.setAttribute("height",s),a.setAttribute("viewBox",[e.x,e.y,n,s].join(" ")),o.Browser.mobileWebkit&&r.appendChild(a)}}}),o.Path.include({bindPopup:function(t,e){return t instanceof o.Popup?this._popup=t:((!this._popup||e)&&(this._popup=new o.Popup(e,this)),this._popup.setContent(t)),this._popupHandlersAdded||(this.on("click",this._openPopup,this).on("remove",this.closePopup,this),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this._openPopup).off("remove",this.closePopup),this._popupHandlersAdded=!1),this},openPopup:function(t){return this._popup&&(t=t||this._latlng||this._latlngs[Math.floor(this._latlngs.length/2)],this._openPopup({latlng:t})),this},closePopup:function(){return this._popup&&this._popup._close(),this},_openPopup:function(t){this._popup.setLatLng(t.latlng),this._map.openPopup(this._popup)}}),o.Browser.vml=!o.Browser.svg&&function(){try{var t=e.createElement("div");t.innerHTML='<v:shape adj="1"/>';var i=t.firstChild;return i.style.behavior="url(#default#VML)",i&&"object"==typeof i.adj}catch(n){return!1}}(),o.Path=o.Browser.svg||!o.Browser.vml?o.Path:o.Path.extend({statics:{VML:!0,CLIP_PADDING:.02},_createElement:function(){try{return e.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return e.createElement("<lvml:"+t+' class="lvml">')}}catch(t){return function(t){return e.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),_initPath:function(){var t=this._container=this._createElement("shape");o.DomUtil.addClass(t,"leaflet-vml-shape"+(this.options.className?" "+this.options.className:"")),this.options.clickable&&o.DomUtil.addClass(t,"leaflet-clickable"),t.coordsize="1 1",this._path=this._createElement("path"),t.appendChild(this._path),this._map._pathRoot.appendChild(t)},_initStyle:function(){this._updateStyle()},_updateStyle:function(){var t=this._stroke,e=this._fill,i=this.options,n=this._container;n.stroked=i.stroke,n.filled=i.fill,i.stroke?(t||(t=this._stroke=this._createElement("stroke"),t.endcap="round",n.appendChild(t)),t.weight=i.weight+"px",t.color=i.color,t.opacity=i.opacity,t.dashStyle=i.dashArray?o.Util.isArray(i.dashArray)?i.dashArray.join(" "):i.dashArray.replace(/( *, *)/g," "):"",i.lineCap&&(t.endcap=i.lineCap.replace("butt","flat")),i.lineJoin&&(t.joinstyle=i.lineJoin)):t&&(n.removeChild(t),this._stroke=null),i.fill?(e||(e=this._fill=this._createElement("fill"),n.appendChild(e)),e.color=i.fillColor||i.color,e.opacity=i.fillOpacity):e&&(n.removeChild(e),this._fill=null)},_updatePath:function(){var t=this._container.style;t.display="none",this._path.v=this.getPathString()+" ",t.display=""}}),o.Map.include(o.Browser.svg||!o.Browser.vml?{}:{_initPathRoot:function(){if(!this._pathRoot){var t=this._pathRoot=e.createElement("div");t.className="leaflet-vml-container",this._panes.overlayPane.appendChild(t),this.on("moveend",this._updatePathViewport),this._updatePathViewport()}}}),o.Browser.canvas=function(){return!!e.createElement("canvas").getContext}(),o.Path=o.Path.SVG&&!t.L_PREFER_CANVAS||!o.Browser.canvas?o.Path:o.Path.extend({statics:{CANVAS:!0,SVG:!1},redraw:function(){return this._map&&(this.projectLatlngs(),this._requestUpdate()),this},setStyle:function(t){return o.setOptions(this,t),this._map&&(this._updateStyle(),this._requestUpdate()),this},onRemove:function(t){t.off("viewreset",this.projectLatlngs,this).off("moveend",this._updatePath,this),this.options.clickable&&(this._map.off("click",this._onClick,this),this._map.off("mousemove",this._onMouseMove,this)),this._requestUpdate(),this._map=null},_requestUpdate:function(){this._map&&!o.Path._updateRequest&&(o.Path._updateRequest=o.Util.requestAnimFrame(this._fireMapMoveEnd,this._map))},_fireMapMoveEnd:function(){o.Path._updateRequest=null,this.fire("moveend")},_initElements:function(){this._map._initPathRoot(),this._ctx=this._map._canvasCtx},_updateStyle:function(){var t=this.options;t.stroke&&(this._ctx.lineWidth=t.weight,this._ctx.strokeStyle=t.color),t.fill&&(this._ctx.fillStyle=t.fillColor||t.color)},_drawPath:function(){var t,e,i,n,s,a;for(this._ctx.beginPath(),t=0,i=this._parts.length;i>t;t++){for(e=0,n=this._parts[t].length;n>e;e++)s=this._parts[t][e],a=(0===e?"move":"line")+"To",this._ctx[a](s.x,s.y);this instanceof o.Polygon&&this._ctx.closePath()}},_checkIfEmpty:function(){return!this._parts.length},_updatePath:function(){if(!this._checkIfEmpty()){var t=this._ctx,e=this.options;this._drawPath(),t.save(),this._updateStyle(),e.fill&&(t.globalAlpha=e.fillOpacity,t.fill()),e.stroke&&(t.globalAlpha=e.opacity,t.stroke()),t.restore()}},_initEvents:function(){this.options.clickable&&(this._map.on("mousemove",this._onMouseMove,this),this._map.on("click",this._onClick,this))},_onClick:function(t){this._containsPoint(t.layerPoint)&&this.fire("click",t)},_onMouseMove:function(t){this._map&&!this._map._animatingZoom&&(this._containsPoint(t.layerPoint)?(this._ctx.canvas.style.cursor="pointer",this._mouseInside=!0,this.fire("mouseover",t)):this._mouseInside&&(this._ctx.canvas.style.cursor="",this._mouseInside=!1,this.fire("mouseout",t)))}}),o.Map.include(o.Path.SVG&&!t.L_PREFER_CANVAS||!o.Browser.canvas?{}:{_initPathRoot:function(){var t,i=this._pathRoot;i||(i=this._pathRoot=e.createElement("canvas"),i.style.position="absolute",t=this._canvasCtx=i.getContext("2d"),t.lineCap="round",t.lineJoin="round",this._panes.overlayPane.appendChild(i),this.options.zoomAnimation&&(this._pathRoot.className="leaflet-zoom-animated",this.on("zoomanim",this._animatePathZoom),this.on("zoomend",this._endPathZoom)),this.on("moveend",this._updateCanvasViewport),this._updateCanvasViewport())},_updateCanvasViewport:function(){if(!this._pathZooming){this._updatePathViewport();var t=this._pathViewport,e=t.min,i=t.max.subtract(e),n=this._pathRoot;o.DomUtil.setPosition(n,e),n.width=i.x,n.height=i.y,n.getContext("2d").translate(-e.x,-e.y)}}}),o.LineUtil={simplify:function(t,e){if(!e||!t.length)return t.slice();var i=e*e;return t=this._reducePoints(t,i),t=this._simplifyDP(t,i)},pointToSegmentDistance:function(t,e,i){return Math.sqrt(this._sqClosestPointOnSegment(t,e,i,!0))},closestPointOnSegment:function(t,e,i){return this._sqClosestPointOnSegment(t,e,i)},_simplifyDP:function(t,e){var n=t.length,o=typeof Uint8Array!=i+""?Uint8Array:Array,s=new o(n);s[0]=s[n-1]=1,this._simplifyDPStep(t,s,e,0,n-1);var a,r=[];for(a=0;n>a;a++)s[a]&&r.push(t[a]);return r},_simplifyDPStep:function(t,e,i,n,o){var s,a,r,h=0;for(a=n+1;o-1>=a;a++)r=this._sqClosestPointOnSegment(t[a],t[n],t[o],!0),r>h&&(s=a,h=r);h>i&&(e[s]=1,this._simplifyDPStep(t,e,i,n,s),this._simplifyDPStep(t,e,i,s,o))},_reducePoints:function(t,e){for(var i=[t[0]],n=1,o=0,s=t.length;s>n;n++)this._sqDist(t[n],t[o])>e&&(i.push(t[n]),o=n);return s-1>o&&i.push(t[s-1]),i},clipSegment:function(t,e,i,n){var o,s,a,r=n?this._lastCode:this._getBitCode(t,i),h=this._getBitCode(e,i);for(this._lastCode=h;;){if(!(r|h))return[t,e];if(r&h)return!1;o=r||h,s=this._getEdgeIntersection(t,e,o,i),a=this._getBitCode(s,i),o===r?(t=s,r=a):(e=s,h=a)}},_getEdgeIntersection:function(t,e,i,n){var s=e.x-t.x,a=e.y-t.y,r=n.min,h=n.max;return 8&i?new o.Point(t.x+s*(h.y-t.y)/a,h.y):4&i?new o.Point(t.x+s*(r.y-t.y)/a,r.y):2&i?new o.Point(h.x,t.y+a*(h.x-t.x)/s):1&i?new o.Point(r.x,t.y+a*(r.x-t.x)/s):void 0},_getBitCode:function(t,e){var i=0;return t.x<e.min.x?i|=1:t.x>e.max.x&&(i|=2),t.y<e.min.y?i|=4:t.y>e.max.y&&(i|=8),i},_sqDist:function(t,e){var i=e.x-t.x,n=e.y-t.y;return i*i+n*n},_sqClosestPointOnSegment:function(t,e,i,n){var s,a=e.x,r=e.y,h=i.x-a,l=i.y-r,u=h*h+l*l;return u>0&&(s=((t.x-a)*h+(t.y-r)*l)/u,s>1?(a=i.x,r=i.y):s>0&&(a+=h*s,r+=l*s)),h=t.x-a,l=t.y-r,n?h*h+l*l:new o.Point(a,r)}},o.Polyline=o.Path.extend({initialize:function(t,e){o.Path.prototype.initialize.call(this,e),this._latlngs=this._convertLatLngs(t)},options:{smoothFactor:1,noClip:!1},projectLatlngs:function(){this._originalPoints=[];for(var t=0,e=this._latlngs.length;e>t;t++)this._originalPoints[t]=this._map.latLngToLayerPoint(this._latlngs[t])},getPathString:function(){for(var t=0,e=this._parts.length,i="";e>t;t++)i+=this._getPathPartStr(this._parts[t]);return i},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._latlngs=this._convertLatLngs(t),this.redraw()},addLatLng:function(t){return this._latlngs.push(o.latLng(t)),this.redraw()},spliceLatLngs:function(){var t=[].splice.apply(this._latlngs,arguments);return this._convertLatLngs(this._latlngs,!0),this.redraw(),t},closestLayerPoint:function(t){for(var e,i,n=1/0,s=this._parts,a=null,r=0,h=s.length;h>r;r++)for(var l=s[r],u=1,c=l.length;c>u;u++){e=l[u-1],i=l[u];var d=o.LineUtil._sqClosestPointOnSegment(t,e,i,!0);n>d&&(n=d,a=o.LineUtil._sqClosestPointOnSegment(t,e,i))}return a&&(a.distance=Math.sqrt(n)),a},getBounds:function(){return new o.LatLngBounds(this.getLatLngs())},_convertLatLngs:function(t,e){var i,n,s=e?t:[];for(i=0,n=t.length;n>i;i++){if(o.Util.isArray(t[i])&&"number"!=typeof t[i][0])return;s[i]=o.latLng(t[i])}return s},_initEvents:function(){o.Path.prototype._initEvents.call(this)},_getPathPartStr:function(t){for(var e,i=o.Path.VML,n=0,s=t.length,a="";s>n;n++)e=t[n],i&&e._round(),a+=(n?"L":"M")+e.x+" "+e.y;return a},_clipPoints:function(){var t,e,i,n=this._originalPoints,s=n.length;if(this.options.noClip)return void(this._parts=[n]);this._parts=[];var a=this._parts,r=this._map._pathViewport,h=o.LineUtil;for(t=0,e=0;s-1>t;t++)i=h.clipSegment(n[t],n[t+1],r,t),i&&(a[e]=a[e]||[],a[e].push(i[0]),(i[1]!==n[t+1]||t===s-2)&&(a[e].push(i[1]),e++))},_simplifyPoints:function(){for(var t=this._parts,e=o.LineUtil,i=0,n=t.length;n>i;i++)t[i]=e.simplify(t[i],this.options.smoothFactor)},_updatePath:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),o.Path.prototype._updatePath.call(this))}}),o.polyline=function(t,e){return new o.Polyline(t,e)},o.PolyUtil={},o.PolyUtil.clipPolygon=function(t,e){var i,n,s,a,r,h,l,u,c,d=[1,4,2,8],p=o.LineUtil;for(n=0,l=t.length;l>n;n++)t[n]._code=p._getBitCode(t[n],e);for(a=0;4>a;a++){for(u=d[a],i=[],n=0,l=t.length,s=l-1;l>n;s=n++)r=t[n],h=t[s],r._code&u?h._code&u||(c=p._getEdgeIntersection(h,r,u,e),c._code=p._getBitCode(c,e),i.push(c)):(h._code&u&&(c=p._getEdgeIntersection(h,r,u,e),c._code=p._getBitCode(c,e),i.push(c)),i.push(r));t=i}return t},o.Polygon=o.Polyline.extend({options:{fill:!0},initialize:function(t,e){o.Polyline.prototype.initialize.call(this,t,e),this._initWithHoles(t)},_initWithHoles:function(t){var e,i,n;if(t&&o.Util.isArray(t[0])&&"number"!=typeof t[0][0])for(this._latlngs=this._convertLatLngs(t[0]),this._holes=t.slice(1),e=0,i=this._holes.length;i>e;e++)n=this._holes[e]=this._convertLatLngs(this._holes[e]),n[0].equals(n[n.length-1])&&n.pop();t=this._latlngs,t.length>=2&&t[0].equals(t[t.length-1])&&t.pop()},projectLatlngs:function(){if(o.Polyline.prototype.projectLatlngs.call(this),this._holePoints=[],this._holes){var t,e,i,n;for(t=0,i=this._holes.length;i>t;t++)for(this._holePoints[t]=[],e=0,n=this._holes[t].length;n>e;e++)this._holePoints[t][e]=this._map.latLngToLayerPoint(this._holes[t][e])}},setLatLngs:function(t){return t&&o.Util.isArray(t[0])&&"number"!=typeof t[0][0]?(this._initWithHoles(t),this.redraw()):o.Polyline.prototype.setLatLngs.call(this,t)},_clipPoints:function(){var t=this._originalPoints,e=[];if(this._parts=[t].concat(this._holePoints),!this.options.noClip){for(var i=0,n=this._parts.length;n>i;i++){var s=o.PolyUtil.clipPolygon(this._parts[i],this._map._pathViewport);s.length&&e.push(s)}this._parts=e}},_getPathPartStr:function(t){var e=o.Polyline.prototype._getPathPartStr.call(this,t);return e+(o.Browser.svg?"z":"x")}}),o.polygon=function(t,e){return new o.Polygon(t,e)},function(){function t(t){return o.FeatureGroup.extend({initialize:function(t,e){this._layers={},this._options=e,this.setLatLngs(t)},setLatLngs:function(e){var i=0,n=e.length;for(this.eachLayer(function(t){n>i?t.setLatLngs(e[i++]):this.removeLayer(t)},this);n>i;)this.addLayer(new t(e[i++],this._options));return this},getLatLngs:function(){var t=[];return this.eachLayer(function(e){t.push(e.getLatLngs())}),t}})}o.MultiPolyline=t(o.Polyline),o.MultiPolygon=t(o.Polygon),o.multiPolyline=function(t,e){return new o.MultiPolyline(t,e)},o.multiPolygon=function(t,e){return new o.MultiPolygon(t,e)}}(),o.Rectangle=o.Polygon.extend({initialize:function(t,e){o.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return t=o.latLngBounds(t),[t.getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}}),o.rectangle=function(t,e){return new o.Rectangle(t,e)},o.Circle=o.Path.extend({initialize:function(t,e,i){o.Path.prototype.initialize.call(this,i),this._latlng=o.latLng(t),this._mRadius=e},options:{fill:!0},setLatLng:function(t){return this._latlng=o.latLng(t),this.redraw()},setRadius:function(t){return this._mRadius=t,this.redraw()},projectLatlngs:function(){var t=this._getLngRadius(),e=this._latlng,i=this._map.latLngToLayerPoint([e.lat,e.lng-t]);this._point=this._map.latLngToLayerPoint(e),this._radius=Math.max(this._point.x-i.x,1)},getBounds:function(){var t=this._getLngRadius(),e=this._mRadius/40075017*360,i=this._latlng;return new o.LatLngBounds([i.lat-e,i.lng-t],[i.lat+e,i.lng+t])},getLatLng:function(){return this._latlng},getPathString:function(){var t=this._point,e=this._radius;return this._checkIfEmpty()?"":o.Browser.svg?"M"+t.x+","+(t.y-e)+"A"+e+","+e+",0,1,1,"+(t.x-.1)+","+(t.y-e)+" z":(t._round(),e=Math.round(e),"AL "+t.x+","+t.y+" "+e+","+e+" 0,23592600")},getRadius:function(){return this._mRadius},_getLatRadius:function(){return this._mRadius/40075017*360},_getLngRadius:function(){return this._getLatRadius()/Math.cos(o.LatLng.DEG_TO_RAD*this._latlng.lat)},_checkIfEmpty:function(){if(!this._map)return!1;var t=this._map._pathViewport,e=this._radius,i=this._point;return i.x-e>t.max.x||i.y-e>t.max.y||i.x+e<t.min.x||i.y+e<t.min.y}}),o.circle=function(t,e,i){return new o.Circle(t,e,i)},o.CircleMarker=o.Circle.extend({options:{radius:10,weight:2},initialize:function(t,e){o.Circle.prototype.initialize.call(this,t,null,e),this._radius=this.options.radius},projectLatlngs:function(){this._point=this._map.latLngToLayerPoint(this._latlng)},_updateStyle:function(){o.Circle.prototype._updateStyle.call(this),this.setRadius(this.options.radius)},setLatLng:function(t){return o.Circle.prototype.setLatLng.call(this,t),this._popup&&this._popup._isOpen&&this._popup.setLatLng(t),this},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius}}),o.circleMarker=function(t,e){return new o.CircleMarker(t,e)},o.Polyline.include(o.Path.CANVAS?{_containsPoint:function(t,e){var i,n,s,a,r,h,l,u=this.options.weight/2;for(o.Browser.touch&&(u+=10),i=0,a=this._parts.length;a>i;i++)for(l=this._parts[i],n=0,r=l.length,s=r-1;r>n;s=n++)if((e||0!==n)&&(h=o.LineUtil.pointToSegmentDistance(t,l[s],l[n]),u>=h))return!0;return!1}}:{}),o.Polygon.include(o.Path.CANVAS?{_containsPoint:function(t){var e,i,n,s,a,r,h,l,u=!1;if(o.Polyline.prototype._containsPoint.call(this,t,!0))return!0;for(s=0,h=this._parts.length;h>s;s++)for(e=this._parts[s],a=0,l=e.length,r=l-1;l>a;r=a++)i=e[a],n=e[r],i.y>t.y!=n.y>t.y&&t.x<(n.x-i.x)*(t.y-i.y)/(n.y-i.y)+i.x&&(u=!u);return u}}:{}),o.Circle.include(o.Path.CANVAS?{_drawPath:function(){var t=this._point;this._ctx.beginPath(),this._ctx.arc(t.x,t.y,this._radius,0,2*Math.PI,!1)},_containsPoint:function(t){var e=this._point,i=this.options.stroke?this.options.weight/2:0;return t.distanceTo(e)<=this._radius+i}}:{}),o.CircleMarker.include(o.Path.CANVAS?{_updateStyle:function(){o.Path.prototype._updateStyle.call(this)}}:{}),o.GeoJSON=o.FeatureGroup.extend({initialize:function(t,e){o.setOptions(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var e,i,n,s=o.Util.isArray(t)?t:t.features;if(s){for(e=0,i=s.length;i>e;e++)n=s[e],(n.geometries||n.geometry||n.features||n.coordinates)&&this.addData(s[e]);return this}var a=this.options;if(!a.filter||a.filter(t)){var r=o.GeoJSON.geometryToLayer(t,a.pointToLayer,a.coordsToLatLng,a);return r.feature=o.GeoJSON.asFeature(t),r.defaultOptions=r.options,this.resetStyle(r),a.onEachFeature&&a.onEachFeature(t,r),this.addLayer(r)}},resetStyle:function(t){var e=this.options.style;e&&(o.Util.extend(t.options,t.defaultOptions),this._setLayerStyle(t,e))},setStyle:function(t){this.eachLayer(function(e){this._setLayerStyle(e,t)},this)},_setLayerStyle:function(t,e){"function"==typeof e&&(e=e(t.feature)),t.setStyle&&t.setStyle(e)}}),o.extend(o.GeoJSON,{geometryToLayer:function(t,e,i,n){var s,a,r,h,l="Feature"===t.type?t.geometry:t,u=l.coordinates,c=[];switch(i=i||this.coordsToLatLng,l.type){case"Point":return s=i(u),e?e(t,s):new o.Marker(s);case"MultiPoint":for(r=0,h=u.length;h>r;r++)s=i(u[r]),c.push(e?e(t,s):new o.Marker(s));return new o.FeatureGroup(c);case"LineString":return a=this.coordsToLatLngs(u,0,i),new o.Polyline(a,n);case"Polygon":if(2===u.length&&!u[1].length)throw new Error("Invalid GeoJSON object.");return a=this.coordsToLatLngs(u,1,i),new o.Polygon(a,n);case"MultiLineString":return a=this.coordsToLatLngs(u,1,i),new o.MultiPolyline(a,n);case"MultiPolygon":return a=this.coordsToLatLngs(u,2,i),new o.MultiPolygon(a,n);case"GeometryCollection":for(r=0,h=l.geometries.length;h>r;r++)c.push(this.geometryToLayer({geometry:l.geometries[r],type:"Feature",properties:t.properties},e,i,n));return new o.FeatureGroup(c);default:throw new Error("Invalid GeoJSON object.")}},coordsToLatLng:function(t){return new o.LatLng(t[1],t[0],t[2])},coordsToLatLngs:function(t,e,i){var n,o,s,a=[];for(o=0,s=t.length;s>o;o++)n=e?this.coordsToLatLngs(t[o],e-1,i):(i||this.coordsToLatLng)(t[o]),a.push(n);return a},latLngToCoords:function(t){var e=[t.lng,t.lat];return t.alt!==i&&e.push(t.alt),e},latLngsToCoords:function(t){for(var e=[],i=0,n=t.length;n>i;i++)e.push(o.GeoJSON.latLngToCoords(t[i]));return e},getFeature:function(t,e){return t.feature?o.extend({},t.feature,{geometry:e}):o.GeoJSON.asFeature(e)},asFeature:function(t){return"Feature"===t.type?t:{type:"Feature",properties:{},geometry:t}}});var a={toGeoJSON:function(){return o.GeoJSON.getFeature(this,{type:"Point",coordinates:o.GeoJSON.latLngToCoords(this.getLatLng())})}};o.Marker.include(a),o.Circle.include(a),o.CircleMarker.include(a),o.Polyline.include({toGeoJSON:function(){return o.GeoJSON.getFeature(this,{type:"LineString",coordinates:o.GeoJSON.latLngsToCoords(this.getLatLngs())})}}),o.Polygon.include({toGeoJSON:function(){var t,e,i,n=[o.GeoJSON.latLngsToCoords(this.getLatLngs())];if(n[0].push(n[0][0]),this._holes)for(t=0,e=this._holes.length;e>t;t++)i=o.GeoJSON.latLngsToCoords(this._holes[t]),i.push(i[0]),n.push(i);return o.GeoJSON.getFeature(this,{type:"Polygon",coordinates:n})}}),function(){function t(t){return function(){var e=[];return this.eachLayer(function(t){e.push(t.toGeoJSON().geometry.coordinates)}),o.GeoJSON.getFeature(this,{type:t,coordinates:e})}}o.MultiPolyline.include({toGeoJSON:t("MultiLineString")}),o.MultiPolygon.include({toGeoJSON:t("MultiPolygon")}),o.LayerGroup.include({toGeoJSON:function(){var e,i=this.feature&&this.feature.geometry,n=[];if(i&&"MultiPoint"===i.type)return t("MultiPoint").call(this);var s=i&&"GeometryCollection"===i.type;return this.eachLayer(function(t){t.toGeoJSON&&(e=t.toGeoJSON(),n.push(s?e.geometry:o.GeoJSON.asFeature(e)))}),s?o.GeoJSON.getFeature(this,{geometries:n,type:"GeometryCollection"}):{type:"FeatureCollection",features:n}}})}(),o.geoJson=function(t,e){return new o.GeoJSON(t,e)},o.DomEvent={addListener:function(t,e,i,n){var s,a,r,h=o.stamp(i),l="_leaflet_"+e+h;return t[l]?this:(s=function(e){return i.call(n||t,e||o.DomEvent._getEvent())},o.Browser.pointer&&0===e.indexOf("touch")?this.addPointerListener(t,e,s,h):(o.Browser.touch&&"dblclick"===e&&this.addDoubleTapListener&&this.addDoubleTapListener(t,s,h),"addEventListener"in t?"mousewheel"===e?(t.addEventListener("DOMMouseScroll",s,!1),t.addEventListener(e,s,!1)):"mouseenter"===e||"mouseleave"===e?(a=s,r="mouseenter"===e?"mouseover":"mouseout",s=function(e){return o.DomEvent._checkMouse(t,e)?a(e):void 0},t.addEventListener(r,s,!1)):"click"===e&&o.Browser.android?(a=s,s=function(t){return o.DomEvent._filterClick(t,a)},t.addEventListener(e,s,!1)):t.addEventListener(e,s,!1):"attachEvent"in t&&t.attachEvent("on"+e,s),t[l]=s,this))},removeListener:function(t,e,i){var n=o.stamp(i),s="_leaflet_"+e+n,a=t[s];return a?(o.Browser.pointer&&0===e.indexOf("touch")?this.removePointerListener(t,e,n):o.Browser.touch&&"dblclick"===e&&this.removeDoubleTapListener?this.removeDoubleTapListener(t,n):"removeEventListener"in t?"mousewheel"===e?(t.removeEventListener("DOMMouseScroll",a,!1),t.removeEventListener(e,a,!1)):"mouseenter"===e||"mouseleave"===e?t.removeEventListener("mouseenter"===e?"mouseover":"mouseout",a,!1):t.removeEventListener(e,a,!1):"detachEvent"in t&&t.detachEvent("on"+e,a),t[s]=null,this):this},stopPropagation:function(t){return t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,o.DomEvent._skipped(t),this},disableScrollPropagation:function(t){var e=o.DomEvent.stopPropagation;return o.DomEvent.on(t,"mousewheel",e).on(t,"MozMousePixelScroll",e)},disableClickPropagation:function(t){for(var e=o.DomEvent.stopPropagation,i=o.Draggable.START.length-1;i>=0;i--)o.DomEvent.on(t,o.Draggable.START[i],e);return o.DomEvent.on(t,"click",o.DomEvent._fakeStop).on(t,"dblclick",e)},preventDefault:function(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this},stop:function(t){return o.DomEvent.preventDefault(t).stopPropagation(t)},getMousePosition:function(t,e){if(!e)return new o.Point(t.clientX,t.clientY);var i=e.getBoundingClientRect();return new o.Point(t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop)},getWheelDelta:function(t){var e=0;return t.wheelDelta&&(e=t.wheelDelta/120),t.detail&&(e=-t.detail/3),e},_skipEvents:{},_fakeStop:function(t){o.DomEvent._skipEvents[t.type]=!0},_skipped:function(t){var e=this._skipEvents[t.type];return this._skipEvents[t.type]=!1,e},_checkMouse:function(t,e){var i=e.relatedTarget;if(!i)return!0;try{for(;i&&i!==t;)i=i.parentNode}catch(n){return!1}return i!==t},_getEvent:function(){var e=t.event;if(!e)for(var i=arguments.callee.caller;i&&(e=i.arguments[0],!e||t.Event!==e.constructor);)i=i.caller;return e},_filterClick:function(t,e){var i=t.timeStamp||t.originalEvent.timeStamp,n=o.DomEvent._lastClick&&i-o.DomEvent._lastClick;return n&&n>100&&1e3>n||t.target._simulatedClick&&!t._simulated?void o.DomEvent.stop(t):(o.DomEvent._lastClick=i,e(t))}},o.DomEvent.on=o.DomEvent.addListener,o.DomEvent.off=o.DomEvent.removeListener,o.Draggable=o.Class.extend({includes:o.Mixin.Events,statics:{START:o.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},initialize:function(t,e){this._element=t,this._dragStartTarget=e||t},enable:function(){if(!this._enabled){for(var t=o.Draggable.START.length-1;t>=0;t--)o.DomEvent.on(this._dragStartTarget,o.Draggable.START[t],this._onDown,this);this._enabled=!0}},disable:function(){if(this._enabled){for(var t=o.Draggable.START.length-1;t>=0;t--)o.DomEvent.off(this._dragStartTarget,o.Draggable.START[t],this._onDown,this);this._enabled=!1,this._moved=!1}},_onDown:function(t){if(this._moved=!1,!(t.shiftKey||1!==t.which&&1!==t.button&&!t.touches||(o.DomEvent.stopPropagation(t),o.Draggable._disabled||(o.DomUtil.disableImageDrag(),o.DomUtil.disableTextSelection(),this._moving)))){var i=t.touches?t.touches[0]:t;this._startPoint=new o.Point(i.clientX,i.clientY),this._startPos=this._newPos=o.DomUtil.getPosition(this._element),o.DomEvent.on(e,o.Draggable.MOVE[t.type],this._onMove,this).on(e,o.Draggable.END[t.type],this._onUp,this)}},_onMove:function(t){if(t.touches&&t.touches.length>1)return void(this._moved=!0);var i=t.touches&&1===t.touches.length?t.touches[0]:t,n=new o.Point(i.clientX,i.clientY),s=n.subtract(this._startPoint);(s.x||s.y)&&(o.DomEvent.preventDefault(t),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=o.DomUtil.getPosition(this._element).subtract(s),o.DomUtil.addClass(e.body,"leaflet-dragging"),o.DomUtil.addClass(t.target||t.srcElement,"leaflet-drag-target")),this._newPos=this._startPos.add(s),this._moving=!0,o.Util.cancelAnimFrame(this._animRequest),this._animRequest=o.Util.requestAnimFrame(this._updatePosition,this,!0,this._dragStartTarget))},_updatePosition:function(){this.fire("predrag"),o.DomUtil.setPosition(this._element,this._newPos),this.fire("drag")},_onUp:function(t){o.DomUtil.removeClass(e.body,"leaflet-dragging"),o.DomUtil.removeClass(t.target||t.srcElement,"leaflet-drag-target");for(var i in o.Draggable.MOVE)o.DomEvent.off(e,o.Draggable.MOVE[i],this._onMove).off(e,o.Draggable.END[i],this._onUp);o.DomUtil.enableImageDrag(),o.DomUtil.enableTextSelection(),this._moved&&this._moving&&(o.Util.cancelAnimFrame(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1}}),o.Handler=o.Class.extend({initialize:function(t){this._map=t},enable:function(){this._enabled||(this._enabled=!0,this.addHooks())},disable:function(){this._enabled&&(this._enabled=!1,this.removeHooks())},enabled:function(){return!!this._enabled}}),o.Map.mergeOptions({dragging:!0,inertia:!o.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,inertiaThreshold:o.Browser.touch?32:18,easeLinearity:.25,worldCopyJump:!1}),o.Map.Drag=o.Handler.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new o.Draggable(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDrag,this),t.on("viewreset",this._onViewReset,this),t.whenReady(this._onViewReset,this))}this._draggable.enable()},removeHooks:function(){this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){var t=this._map;t._panAnim&&t._panAnim.stop(),t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(){if(this._map.options.inertia){var t=this._lastTime=+new Date,e=this._lastPos=this._draggable._newPos;this._positions.push(e),this._times.push(t),t-this._times[0]>200&&(this._positions.shift(),this._times.shift())}this._map.fire("move").fire("drag")},_onViewReset:function(){var t=this._map.getSize()._divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.project([0,180]).x},_onPreDrag:function(){var t=this._worldWidth,e=Math.round(t/2),i=this._initialWorldOffset,n=this._draggable._newPos.x,o=(n-e+i)%t+e-i,s=(n+e+i)%t-e-i,a=Math.abs(o+i)<Math.abs(s+i)?o:s;this._draggable._newPos.x=a},_onDragEnd:function(t){var e=this._map,i=e.options,n=+new Date-this._lastTime,s=!i.inertia||n>i.inertiaThreshold||!this._positions[0];if(e.fire("dragend",t),s)e.fire("moveend");else{var a=this._lastPos.subtract(this._positions[0]),r=(this._lastTime+n-this._times[0])/1e3,h=i.easeLinearity,l=a.multiplyBy(h/r),u=l.distanceTo([0,0]),c=Math.min(i.inertiaMaxSpeed,u),d=l.multiplyBy(c/u),p=c/(i.inertiaDeceleration*h),_=d.multiplyBy(-p/2).round();_.x&&_.y?(_=e._limitOffset(_,e.options.maxBounds),o.Util.requestAnimFrame(function(){e.panBy(_,{duration:p,easeLinearity:h,noMoveStart:!0})})):e.fire("moveend")}}}),o.Map.addInitHook("addHandler","dragging",o.Map.Drag),o.Map.mergeOptions({doubleClickZoom:!0}),o.Map.DoubleClickZoom=o.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var e=this._map,i=e.getZoom()+(t.originalEvent.shiftKey?-1:1);"center"===e.options.doubleClickZoom?e.setZoom(i):e.setZoomAround(t.containerPoint,i)}}),o.Map.addInitHook("addHandler","doubleClickZoom",o.Map.DoubleClickZoom),o.Map.mergeOptions({scrollWheelZoom:!0}),o.Map.ScrollWheelZoom=o.Handler.extend({addHooks:function(){o.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this),o.DomEvent.on(this._map._container,"MozMousePixelScroll",o.DomEvent.preventDefault),this._delta=0},removeHooks:function(){o.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll),o.DomEvent.off(this._map._container,"MozMousePixelScroll",o.DomEvent.preventDefault)},_onWheelScroll:function(t){var e=o.DomEvent.getWheelDelta(t);this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var i=Math.max(40-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(o.bind(this._performZoom,this),i),o.DomEvent.preventDefault(t),o.DomEvent.stopPropagation(t)},_performZoom:function(){var t=this._map,e=this._delta,i=t.getZoom();e=e>0?Math.ceil(e):Math.floor(e),e=Math.max(Math.min(e,4),-4),e=t._limitZoom(i+e)-i,this._delta=0,this._startTime=null,e&&("center"===t.options.scrollWheelZoom?t.setZoom(i+e):t.setZoomAround(this._lastMousePos,i+e))}}),o.Map.addInitHook("addHandler","scrollWheelZoom",o.Map.ScrollWheelZoom),o.extend(o.DomEvent,{_touchstart:o.Browser.msPointer?"MSPointerDown":o.Browser.pointer?"pointerdown":"touchstart",_touchend:o.Browser.msPointer?"MSPointerUp":o.Browser.pointer?"pointerup":"touchend",addDoubleTapListener:function(t,i,n){function s(t){var e;if(o.Browser.pointer?(_.push(t.pointerId),e=_.length):e=t.touches.length,!(e>1)){var i=Date.now(),n=i-(r||i);h=t.touches?t.touches[0]:t,l=n>0&&u>=n,r=i}}function a(t){if(o.Browser.pointer){var e=_.indexOf(t.pointerId);if(-1===e)return;_.splice(e,1)}if(l){if(o.Browser.pointer){var n,s={};for(var a in h)n=h[a],s[a]="function"==typeof n?n.bind(h):n;h=s}h.type="dblclick",i(h),r=null}}var r,h,l=!1,u=250,c="_leaflet_",d=this._touchstart,p=this._touchend,_=[];t[c+d+n]=s,t[c+p+n]=a;var m=o.Browser.pointer?e.documentElement:t;return t.addEventListener(d,s,!1),m.addEventListener(p,a,!1),o.Browser.pointer&&m.addEventListener(o.DomEvent.POINTER_CANCEL,a,!1),this},removeDoubleTapListener:function(t,i){var n="_leaflet_";return t.removeEventListener(this._touchstart,t[n+this._touchstart+i],!1),(o.Browser.pointer?e.documentElement:t).removeEventListener(this._touchend,t[n+this._touchend+i],!1),o.Browser.pointer&&e.documentElement.removeEventListener(o.DomEvent.POINTER_CANCEL,t[n+this._touchend+i],!1),this}}),o.extend(o.DomEvent,{POINTER_DOWN:o.Browser.msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE:o.Browser.msPointer?"MSPointerMove":"pointermove",POINTER_UP:o.Browser.msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL:o.Browser.msPointer?"MSPointerCancel":"pointercancel",_pointers:[],_pointerDocumentListener:!1,addPointerListener:function(t,e,i,n){switch(e){case"touchstart":return this.addPointerListenerStart(t,e,i,n);case"touchend":return this.addPointerListenerEnd(t,e,i,n);case"touchmove":return this.addPointerListenerMove(t,e,i,n);default:throw"Unknown touch event type"}},addPointerListenerStart:function(t,i,n,s){var a="_leaflet_",r=this._pointers,h=function(t){o.DomEvent.preventDefault(t);for(var e=!1,i=0;i<r.length;i++)if(r[i].pointerId===t.pointerId){e=!0;break}e||r.push(t),t.touches=r.slice(),t.changedTouches=[t],n(t)};if(t[a+"touchstart"+s]=h,t.addEventListener(this.POINTER_DOWN,h,!1),!this._pointerDocumentListener){var l=function(t){for(var e=0;e<r.length;e++)if(r[e].pointerId===t.pointerId){r.splice(e,1);
break}};e.documentElement.addEventListener(this.POINTER_UP,l,!1),e.documentElement.addEventListener(this.POINTER_CANCEL,l,!1),this._pointerDocumentListener=!0}return this},addPointerListenerMove:function(t,e,i,n){function o(t){if(t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType||0!==t.buttons){for(var e=0;e<a.length;e++)if(a[e].pointerId===t.pointerId){a[e]=t;break}t.touches=a.slice(),t.changedTouches=[t],i(t)}}var s="_leaflet_",a=this._pointers;return t[s+"touchmove"+n]=o,t.addEventListener(this.POINTER_MOVE,o,!1),this},addPointerListenerEnd:function(t,e,i,n){var o="_leaflet_",s=this._pointers,a=function(t){for(var e=0;e<s.length;e++)if(s[e].pointerId===t.pointerId){s.splice(e,1);break}t.touches=s.slice(),t.changedTouches=[t],i(t)};return t[o+"touchend"+n]=a,t.addEventListener(this.POINTER_UP,a,!1),t.addEventListener(this.POINTER_CANCEL,a,!1),this},removePointerListener:function(t,e,i){var n="_leaflet_",o=t[n+e+i];switch(e){case"touchstart":t.removeEventListener(this.POINTER_DOWN,o,!1);break;case"touchmove":t.removeEventListener(this.POINTER_MOVE,o,!1);break;case"touchend":t.removeEventListener(this.POINTER_UP,o,!1),t.removeEventListener(this.POINTER_CANCEL,o,!1)}return this}}),o.Map.mergeOptions({touchZoom:o.Browser.touch&&!o.Browser.android23,bounceAtZoomLimits:!0}),o.Map.TouchZoom=o.Handler.extend({addHooks:function(){o.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){o.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var i=this._map;if(t.touches&&2===t.touches.length&&!i._animatingZoom&&!this._zooming){var n=i.mouseEventToLayerPoint(t.touches[0]),s=i.mouseEventToLayerPoint(t.touches[1]),a=i._getCenterLayerPoint();this._startCenter=n.add(s)._divideBy(2),this._startDist=n.distanceTo(s),this._moved=!1,this._zooming=!0,this._centerOffset=a.subtract(this._startCenter),i._panAnim&&i._panAnim.stop(),o.DomEvent.on(e,"touchmove",this._onTouchMove,this).on(e,"touchend",this._onTouchEnd,this),o.DomEvent.preventDefault(t)}},_onTouchMove:function(t){var e=this._map;if(t.touches&&2===t.touches.length&&this._zooming){var i=e.mouseEventToLayerPoint(t.touches[0]),n=e.mouseEventToLayerPoint(t.touches[1]);this._scale=i.distanceTo(n)/this._startDist,this._delta=i._add(n)._divideBy(2)._subtract(this._startCenter),1!==this._scale&&(e.options.bounceAtZoomLimits||!(e.getZoom()===e.getMinZoom()&&this._scale<1||e.getZoom()===e.getMaxZoom()&&this._scale>1))&&(this._moved||(o.DomUtil.addClass(e._mapPane,"leaflet-touching"),e.fire("movestart").fire("zoomstart"),this._moved=!0),o.Util.cancelAnimFrame(this._animRequest),this._animRequest=o.Util.requestAnimFrame(this._updateOnMove,this,!0,this._map._container),o.DomEvent.preventDefault(t))}},_updateOnMove:function(){var t=this._map,e=this._getScaleOrigin(),i=t.layerPointToLatLng(e),n=t.getScaleZoom(this._scale);t._animateZoom(i,n,this._startCenter,this._scale,this._delta)},_onTouchEnd:function(){if(!this._moved||!this._zooming)return void(this._zooming=!1);var t=this._map;this._zooming=!1,o.DomUtil.removeClass(t._mapPane,"leaflet-touching"),o.Util.cancelAnimFrame(this._animRequest),o.DomEvent.off(e,"touchmove",this._onTouchMove).off(e,"touchend",this._onTouchEnd);var i=this._getScaleOrigin(),n=t.layerPointToLatLng(i),s=t.getZoom(),a=t.getScaleZoom(this._scale)-s,r=a>0?Math.ceil(a):Math.floor(a),h=t._limitZoom(s+r),l=t.getZoomScale(h)/this._scale;t._animateZoom(n,h,i,l)},_getScaleOrigin:function(){var t=this._centerOffset.subtract(this._delta).divideBy(this._scale);return this._startCenter.add(t)}}),o.Map.addInitHook("addHandler","touchZoom",o.Map.TouchZoom),o.Map.mergeOptions({tap:!0,tapTolerance:15}),o.Map.Tap=o.Handler.extend({addHooks:function(){o.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){o.DomEvent.off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(t.touches){if(o.DomEvent.preventDefault(t),this._fireClick=!0,t.touches.length>1)return this._fireClick=!1,void clearTimeout(this._holdTimeout);var i=t.touches[0],n=i.target;this._startPos=this._newPos=new o.Point(i.clientX,i.clientY),n.tagName&&"a"===n.tagName.toLowerCase()&&o.DomUtil.addClass(n,"leaflet-active"),this._holdTimeout=setTimeout(o.bind(function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",i))},this),1e3),o.DomEvent.on(e,"touchmove",this._onMove,this).on(e,"touchend",this._onUp,this)}},_onUp:function(t){if(clearTimeout(this._holdTimeout),o.DomEvent.off(e,"touchmove",this._onMove,this).off(e,"touchend",this._onUp,this),this._fireClick&&t&&t.changedTouches){var i=t.changedTouches[0],n=i.target;n&&n.tagName&&"a"===n.tagName.toLowerCase()&&o.DomUtil.removeClass(n,"leaflet-active"),this._isTapValid()&&this._simulateEvent("click",i)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(t){var e=t.touches[0];this._newPos=new o.Point(e.clientX,e.clientY)},_simulateEvent:function(i,n){var o=e.createEvent("MouseEvents");o._simulated=!0,n.target._simulatedClick=!0,o.initMouseEvent(i,!0,!0,t,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),n.target.dispatchEvent(o)}}),o.Browser.touch&&!o.Browser.pointer&&o.Map.addInitHook("addHandler","tap",o.Map.Tap),o.Map.mergeOptions({boxZoom:!0}),o.Map.BoxZoom=o.Handler.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane,this._moved=!1},addHooks:function(){o.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){o.DomEvent.off(this._container,"mousedown",this._onMouseDown),this._moved=!1},moved:function(){return this._moved},_onMouseDown:function(t){return this._moved=!1,!t.shiftKey||1!==t.which&&1!==t.button?!1:(o.DomUtil.disableTextSelection(),o.DomUtil.disableImageDrag(),this._startLayerPoint=this._map.mouseEventToLayerPoint(t),void o.DomEvent.on(e,"mousemove",this._onMouseMove,this).on(e,"mouseup",this._onMouseUp,this).on(e,"keydown",this._onKeyDown,this))},_onMouseMove:function(t){this._moved||(this._box=o.DomUtil.create("div","leaflet-zoom-box",this._pane),o.DomUtil.setPosition(this._box,this._startLayerPoint),this._container.style.cursor="crosshair",this._map.fire("boxzoomstart"));var e=this._startLayerPoint,i=this._box,n=this._map.mouseEventToLayerPoint(t),s=n.subtract(e),a=new o.Point(Math.min(n.x,e.x),Math.min(n.y,e.y));o.DomUtil.setPosition(i,a),this._moved=!0,i.style.width=Math.max(0,Math.abs(s.x)-4)+"px",i.style.height=Math.max(0,Math.abs(s.y)-4)+"px"},_finish:function(){this._moved&&(this._pane.removeChild(this._box),this._container.style.cursor=""),o.DomUtil.enableTextSelection(),o.DomUtil.enableImageDrag(),o.DomEvent.off(e,"mousemove",this._onMouseMove).off(e,"mouseup",this._onMouseUp).off(e,"keydown",this._onKeyDown)},_onMouseUp:function(t){this._finish();var e=this._map,i=e.mouseEventToLayerPoint(t);if(!this._startLayerPoint.equals(i)){var n=new o.LatLngBounds(e.layerPointToLatLng(this._startLayerPoint),e.layerPointToLatLng(i));e.fitBounds(n),e.fire("boxzoomend",{boxZoomBounds:n})}},_onKeyDown:function(t){27===t.keyCode&&this._finish()}}),o.Map.addInitHook("addHandler","boxZoom",o.Map.BoxZoom),o.Map.mergeOptions({keyboard:!0,keyboardPanOffset:80,keyboardZoomOffset:1}),o.Map.Keyboard=o.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,173]},initialize:function(t){this._map=t,this._setPanOffset(t.options.keyboardPanOffset),this._setZoomOffset(t.options.keyboardZoomOffset)},addHooks:function(){var t=this._map._container;-1===t.tabIndex&&(t.tabIndex="0"),o.DomEvent.on(t,"focus",this._onFocus,this).on(t,"blur",this._onBlur,this).on(t,"mousedown",this._onMouseDown,this),this._map.on("focus",this._addHooks,this).on("blur",this._removeHooks,this)},removeHooks:function(){this._removeHooks();var t=this._map._container;o.DomEvent.off(t,"focus",this._onFocus,this).off(t,"blur",this._onBlur,this).off(t,"mousedown",this._onMouseDown,this),this._map.off("focus",this._addHooks,this).off("blur",this._removeHooks,this)},_onMouseDown:function(){if(!this._focused){var i=e.body,n=e.documentElement,o=i.scrollTop||n.scrollTop,s=i.scrollLeft||n.scrollLeft;this._map._container.focus(),t.scrollTo(s,o)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanOffset:function(t){var e,i,n=this._panKeys={},o=this.keyCodes;for(e=0,i=o.left.length;i>e;e++)n[o.left[e]]=[-1*t,0];for(e=0,i=o.right.length;i>e;e++)n[o.right[e]]=[t,0];for(e=0,i=o.down.length;i>e;e++)n[o.down[e]]=[0,t];for(e=0,i=o.up.length;i>e;e++)n[o.up[e]]=[0,-1*t]},_setZoomOffset:function(t){var e,i,n=this._zoomKeys={},o=this.keyCodes;for(e=0,i=o.zoomIn.length;i>e;e++)n[o.zoomIn[e]]=t;for(e=0,i=o.zoomOut.length;i>e;e++)n[o.zoomOut[e]]=-t},_addHooks:function(){o.DomEvent.on(e,"keydown",this._onKeyDown,this)},_removeHooks:function(){o.DomEvent.off(e,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){var e=t.keyCode,i=this._map;if(e in this._panKeys){if(i._panAnim&&i._panAnim._inProgress)return;i.panBy(this._panKeys[e]),i.options.maxBounds&&i.panInsideBounds(i.options.maxBounds)}else{if(!(e in this._zoomKeys))return;i.setZoom(i.getZoom()+this._zoomKeys[e])}o.DomEvent.stop(t)}}),o.Map.addInitHook("addHandler","keyboard",o.Map.Keyboard),o.Handler.MarkerDrag=o.Handler.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new o.Draggable(t,t)),this._draggable.on("dragstart",this._onDragStart,this).on("drag",this._onDrag,this).on("dragend",this._onDragEnd,this),this._draggable.enable(),o.DomUtil.addClass(this._marker._icon,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off("dragstart",this._onDragStart,this).off("drag",this._onDrag,this).off("dragend",this._onDragEnd,this),this._draggable.disable(),o.DomUtil.removeClass(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._marker.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(){var t=this._marker,e=t._shadow,i=o.DomUtil.getPosition(t._icon),n=t._map.layerPointToLatLng(i);e&&o.DomUtil.setPosition(e,i),t._latlng=n,t.fire("move",{latlng:n}).fire("drag")},_onDragEnd:function(t){this._marker.fire("moveend").fire("dragend",t)}}),o.Control=o.Class.extend({options:{position:"topright"},initialize:function(t){o.setOptions(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this._map=t;var e=this._container=this.onAdd(t),i=this.getPosition(),n=t._controlCorners[i];return o.DomUtil.addClass(e,"leaflet-control"),-1!==i.indexOf("bottom")?n.insertBefore(e,n.firstChild):n.appendChild(e),this},removeFrom:function(t){var e=this.getPosition(),i=t._controlCorners[e];return i.removeChild(this._container),this._map=null,this.onRemove&&this.onRemove(t),this},_refocusOnMap:function(){this._map&&this._map.getContainer().focus()}}),o.control=function(t){return new o.Control(t)},o.Map.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.removeFrom(this),this},_initControlPos:function(){function t(t,s){var a=i+t+" "+i+s;e[t+s]=o.DomUtil.create("div",a,n)}var e=this._controlCorners={},i="leaflet-",n=this._controlContainer=o.DomUtil.create("div",i+"control-container",this._container);t("top","left"),t("top","right"),t("bottom","left"),t("bottom","right")},_clearControlPos:function(){this._container.removeChild(this._controlContainer)}}),o.Control.Zoom=o.Control.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"-",zoomOutTitle:"Zoom out"},onAdd:function(t){var e="leaflet-control-zoom",i=o.DomUtil.create("div",e+" leaflet-bar");return this._map=t,this._zoomInButton=this._createButton(this.options.zoomInText,this.options.zoomInTitle,e+"-in",i,this._zoomIn,this),this._zoomOutButton=this._createButton(this.options.zoomOutText,this.options.zoomOutTitle,e+"-out",i,this._zoomOut,this),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),i},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},_zoomIn:function(t){this._map.zoomIn(t.shiftKey?3:1)},_zoomOut:function(t){this._map.zoomOut(t.shiftKey?3:1)},_createButton:function(t,e,i,n,s,a){var r=o.DomUtil.create("a",i,n);r.innerHTML=t,r.href="#",r.title=e;var h=o.DomEvent.stopPropagation;return o.DomEvent.on(r,"click",h).on(r,"mousedown",h).on(r,"dblclick",h).on(r,"click",o.DomEvent.preventDefault).on(r,"click",s,a).on(r,"click",this._refocusOnMap,a),r},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";o.DomUtil.removeClass(this._zoomInButton,e),o.DomUtil.removeClass(this._zoomOutButton,e),t._zoom===t.getMinZoom()&&o.DomUtil.addClass(this._zoomOutButton,e),t._zoom===t.getMaxZoom()&&o.DomUtil.addClass(this._zoomInButton,e)}}),o.Map.mergeOptions({zoomControl:!0}),o.Map.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new o.Control.Zoom,this.addControl(this.zoomControl))}),o.control.zoom=function(t){return new o.Control.Zoom(t)},o.Control.Attribution=o.Control.extend({options:{position:"bottomright",prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(t){o.setOptions(this,t),this._attributions={}},onAdd:function(t){this._container=o.DomUtil.create("div","leaflet-control-attribution"),o.DomEvent.disableClickPropagation(this._container);for(var e in t._layers)t._layers[e].getAttribution&&this.addAttribution(t._layers[e].getAttribution());return t.on("layeradd",this._onLayerAdd,this).on("layerremove",this._onLayerRemove,this),this._update(),this._container},onRemove:function(t){t.off("layeradd",this._onLayerAdd).off("layerremove",this._onLayerRemove)},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):void 0},removeAttribution:function(t){return t?(this._attributions[t]&&(this._attributions[t]--,this._update()),this):void 0},_update:function(){if(this._map){var t=[];for(var e in this._attributions)this._attributions[e]&&t.push(e);var i=[];this.options.prefix&&i.push(this.options.prefix),t.length&&i.push(t.join(", ")),this._container.innerHTML=i.join(" | ")}},_onLayerAdd:function(t){t.layer.getAttribution&&this.addAttribution(t.layer.getAttribution())},_onLayerRemove:function(t){t.layer.getAttribution&&this.removeAttribution(t.layer.getAttribution())}}),o.Map.mergeOptions({attributionControl:!0}),o.Map.addInitHook(function(){this.options.attributionControl&&(this.attributionControl=(new o.Control.Attribution).addTo(this))}),o.control.attribution=function(t){return new o.Control.Attribution(t)},o.Control.Scale=o.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0,updateWhenIdle:!1},onAdd:function(t){this._map=t;var e="leaflet-control-scale",i=o.DomUtil.create("div",e),n=this.options;return this._addScales(n,e,i),t.on(n.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),i},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,i){t.metric&&(this._mScale=o.DomUtil.create("div",e+"-line",i)),t.imperial&&(this._iScale=o.DomUtil.create("div",e+"-line",i))},_update:function(){var t=this._map.getBounds(),e=t.getCenter().lat,i=6378137*Math.PI*Math.cos(e*Math.PI/180),n=i*(t.getNorthEast().lng-t.getSouthWest().lng)/180,o=this._map.getSize(),s=this.options,a=0;o.x>0&&(a=n*(s.maxWidth/o.x)),this._updateScales(s,a)},_updateScales:function(t,e){t.metric&&e&&this._updateMetric(e),t.imperial&&e&&this._updateImperial(e)},_updateMetric:function(t){var e=this._getRoundNum(t);this._mScale.style.width=this._getScaleWidth(e/t)+"px",this._mScale.innerHTML=1e3>e?e+" m":e/1e3+" km"},_updateImperial:function(t){var e,i,n,o=3.2808399*t,s=this._iScale;o>5280?(e=o/5280,i=this._getRoundNum(e),s.style.width=this._getScaleWidth(i/e)+"px",s.innerHTML=i+" mi"):(n=this._getRoundNum(o),s.style.width=this._getScaleWidth(n/o)+"px",s.innerHTML=n+" ft")},_getScaleWidth:function(t){return Math.round(this.options.maxWidth*t)-10},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),i=t/e;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:1,e*i}}),o.control.scale=function(t){return new o.Control.Scale(t)},o.Control.Layers=o.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0},initialize:function(t,e,i){o.setOptions(this,i),this._layers={},this._lastZIndex=0,this._handlingClick=!1;for(var n in t)this._addLayer(t[n],n);for(n in e)this._addLayer(e[n],n,!0)},onAdd:function(t){return this._initLayout(),this._update(),t.on("layeradd",this._onLayerChange,this).on("layerremove",this._onLayerChange,this),this._container},onRemove:function(t){t.off("layeradd",this._onLayerChange).off("layerremove",this._onLayerChange)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._update(),this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._update(),this},removeLayer:function(t){var e=o.stamp(t);return delete this._layers[e],this._update(),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=o.DomUtil.create("div",t);e.setAttribute("aria-haspopup",!0),o.Browser.touch?o.DomEvent.on(e,"click",o.DomEvent.stopPropagation):o.DomEvent.disableClickPropagation(e).disableScrollPropagation(e);var i=this._form=o.DomUtil.create("form",t+"-list");if(this.options.collapsed){o.Browser.android||o.DomEvent.on(e,"mouseover",this._expand,this).on(e,"mouseout",this._collapse,this);var n=this._layersLink=o.DomUtil.create("a",t+"-toggle",e);n.href="#",n.title="Layers",o.Browser.touch?o.DomEvent.on(n,"click",o.DomEvent.stop).on(n,"click",this._expand,this):o.DomEvent.on(n,"focus",this._expand,this),o.DomEvent.on(i,"click",function(){setTimeout(o.bind(this._onInputClick,this),0)},this),this._map.on("click",this._collapse,this)}else this._expand();this._baseLayersList=o.DomUtil.create("div",t+"-base",i),this._separator=o.DomUtil.create("div",t+"-separator",i),this._overlaysList=o.DomUtil.create("div",t+"-overlays",i),e.appendChild(i)},_addLayer:function(t,e,i){var n=o.stamp(t);this._layers[n]={layer:t,name:e,overlay:i},this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex))},_update:function(){if(this._container){this._baseLayersList.innerHTML="",this._overlaysList.innerHTML="";var t,e,i=!1,n=!1;for(t in this._layers)e=this._layers[t],this._addItem(e),n=n||e.overlay,i=i||!e.overlay;this._separator.style.display=n&&i?"":"none"}},_onLayerChange:function(t){var e=this._layers[o.stamp(t.layer)];if(e){this._handlingClick||this._update();var i=e.overlay?"layeradd"===t.type?"overlayadd":"overlayremove":"layeradd"===t.type?"baselayerchange":null;i&&this._map.fire(i,e)}},_createRadioElement:function(t,i){var n='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"';i&&(n+=' checked="checked"'),n+="/>";var o=e.createElement("div");return o.innerHTML=n,o.firstChild},_addItem:function(t){var i,n=e.createElement("label"),s=this._map.hasLayer(t.layer);t.overlay?(i=e.createElement("input"),i.type="checkbox",i.className="leaflet-control-layers-selector",i.defaultChecked=s):i=this._createRadioElement("leaflet-base-layers",s),i.layerId=o.stamp(t.layer),o.DomEvent.on(i,"click",this._onInputClick,this);var a=e.createElement("span");a.innerHTML=" "+t.name,n.appendChild(i),n.appendChild(a);var r=t.overlay?this._overlaysList:this._baseLayersList;return r.appendChild(n),n},_onInputClick:function(){var t,e,i,n=this._form.getElementsByTagName("input"),o=n.length;for(this._handlingClick=!0,t=0;o>t;t++)e=n[t],i=this._layers[e.layerId],e.checked&&!this._map.hasLayer(i.layer)?this._map.addLayer(i.layer):!e.checked&&this._map.hasLayer(i.layer)&&this._map.removeLayer(i.layer);this._handlingClick=!1,this._refocusOnMap()},_expand:function(){o.DomUtil.addClass(this._container,"leaflet-control-layers-expanded")},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-layers-expanded","")}}),o.control.layers=function(t,e,i){return new o.Control.Layers(t,e,i)},o.PosAnimation=o.Class.extend({includes:o.Mixin.Events,run:function(t,e,i,n){this.stop(),this._el=t,this._inProgress=!0,this._newPos=e,this.fire("start"),t.style[o.DomUtil.TRANSITION]="all "+(i||.25)+"s cubic-bezier(0,0,"+(n||.5)+",1)",o.DomEvent.on(t,o.DomUtil.TRANSITION_END,this._onTransitionEnd,this),o.DomUtil.setPosition(t,e),o.Util.falseFn(t.offsetWidth),this._stepTimer=setInterval(o.bind(this._onStep,this),50)},stop:function(){this._inProgress&&(o.DomUtil.setPosition(this._el,this._getPos()),this._onTransitionEnd(),o.Util.falseFn(this._el.offsetWidth))},_onStep:function(){var t=this._getPos();return t?(this._el._leaflet_pos=t,void this.fire("step")):void this._onTransitionEnd()},_transformRe:/([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*\)/,_getPos:function(){var e,i,n,s=this._el,a=t.getComputedStyle(s);if(o.Browser.any3d){if(n=a[o.DomUtil.TRANSFORM].match(this._transformRe),!n)return;e=parseFloat(n[1]),i=parseFloat(n[2])}else e=parseFloat(a.left),i=parseFloat(a.top);return new o.Point(e,i,!0)},_onTransitionEnd:function(){o.DomEvent.off(this._el,o.DomUtil.TRANSITION_END,this._onTransitionEnd,this),this._inProgress&&(this._inProgress=!1,this._el.style[o.DomUtil.TRANSITION]="",this._el._leaflet_pos=this._newPos,clearInterval(this._stepTimer),this.fire("step").fire("end"))}}),o.Map.include({setView:function(t,e,n){if(e=e===i?this._zoom:this._limitZoom(e),t=this._limitCenter(o.latLng(t),e,this.options.maxBounds),n=n||{},this._panAnim&&this._panAnim.stop(),this._loaded&&!n.reset&&n!==!0){n.animate!==i&&(n.zoom=o.extend({animate:n.animate},n.zoom),n.pan=o.extend({animate:n.animate},n.pan));var s=this._zoom!==e?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,e,n.zoom):this._tryAnimatedPan(t,n.pan);if(s)return clearTimeout(this._sizeTimer),this}return this._resetView(t,e),this},panBy:function(t,e){if(t=o.point(t).round(),e=e||{},!t.x&&!t.y)return this;if(this._panAnim||(this._panAnim=new o.PosAnimation,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),e.animate!==!1){o.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");var i=this._getMapPanePos().subtract(t);this._panAnim.run(this._mapPane,i,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){o.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){var i=this._getCenterOffset(t)._floor();return(e&&e.animate)===!0||this.getSize().contains(i)?(this.panBy(i,e),!0):!1}}),o.PosAnimation=o.DomUtil.TRANSITION?o.PosAnimation:o.PosAnimation.extend({run:function(t,e,i,n){this.stop(),this._el=t,this._inProgress=!0,this._duration=i||.25,this._easeOutPower=1/Math.max(n||.5,.2),this._startPos=o.DomUtil.getPosition(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(),this._complete())},_animate:function(){this._animId=o.Util.requestAnimFrame(this._animate,this),this._step()},_step:function(){var t=+new Date-this._startTime,e=1e3*this._duration;e>t?this._runFrame(this._easeOut(t/e)):(this._runFrame(1),this._complete())},_runFrame:function(t){var e=this._startPos.add(this._offset.multiplyBy(t));o.DomUtil.setPosition(this._el,e),this.fire("step")},_complete:function(){o.Util.cancelAnimFrame(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),o.Map.mergeOptions({zoomAnimation:!0,zoomAnimationThreshold:4}),o.DomUtil.TRANSITION&&o.Map.addInitHook(function(){this._zoomAnimated=this.options.zoomAnimation&&o.DomUtil.TRANSITION&&o.Browser.any3d&&!o.Browser.android23&&!o.Browser.mobileOpera,this._zoomAnimated&&o.DomEvent.on(this._mapPane,o.DomUtil.TRANSITION_END,this._catchTransitionEnd,this)}),o.Map.include(o.DomUtil.TRANSITION?{_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,e,i){if(this._animatingZoom)return!0;if(i=i||{},!this._zoomAnimated||i.animate===!1||this._nothingToAnimate()||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;var n=this.getZoomScale(e),o=this._getCenterOffset(t)._divideBy(1-1/n),s=this._getCenterLayerPoint()._add(o);return i.animate===!0||this.getSize().contains(o)?(this.fire("movestart").fire("zoomstart"),this._animateZoom(t,e,s,n,null,!0),!0):!1},_animateZoom:function(t,e,i,n,s,a){this._animatingZoom=!0,o.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim"),this._animateToCenter=t,this._animateToZoom=e,o.Draggable&&(o.Draggable._disabled=!0),this.fire("zoomanim",{center:t,zoom:e,origin:i,scale:n,delta:s,backwards:a})},_onZoomTransitionEnd:function(){this._animatingZoom=!1,o.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim"),this._resetView(this._animateToCenter,this._animateToZoom,!0,!0),o.Draggable&&(o.Draggable._disabled=!1)}}:{}),o.TileLayer.include({_animateZoom:function(t){this._animating||(this._animating=!0,this._prepareBgBuffer());var e=this._bgBuffer,i=o.DomUtil.TRANSFORM,n=t.delta?o.DomUtil.getTranslateString(t.delta):e.style[i],s=o.DomUtil.getScaleString(t.scale,t.origin);e.style[i]=t.backwards?s+" "+n:n+" "+s},_endZoomAnim:function(){var t=this._tileContainer,e=this._bgBuffer;t.style.visibility="",t.parentNode.appendChild(t),o.Util.falseFn(e.offsetWidth),this._animating=!1},_clearBgBuffer:function(){var t=this._map;!t||t._animatingZoom||t.touchZoom._zooming||(this._bgBuffer.innerHTML="",this._bgBuffer.style[o.DomUtil.TRANSFORM]="")},_prepareBgBuffer:function(){var t=this._tileContainer,e=this._bgBuffer,i=this._getLoadedTilesPercentage(e),n=this._getLoadedTilesPercentage(t);return e&&i>.5&&.5>n?(t.style.visibility="hidden",void this._stopLoadingImages(t)):(e.style.visibility="hidden",e.style[o.DomUtil.TRANSFORM]="",this._tileContainer=e,e=this._bgBuffer=t,this._stopLoadingImages(e),void clearTimeout(this._clearBgBufferTimer))},_getLoadedTilesPercentage:function(t){var e,i,n=t.getElementsByTagName("img"),o=0;for(e=0,i=n.length;i>e;e++)n[e].complete&&o++;return o/i},_stopLoadingImages:function(t){var e,i,n,s=Array.prototype.slice.call(t.getElementsByTagName("img"));for(e=0,i=s.length;i>e;e++)n=s[e],n.complete||(n.onload=o.Util.falseFn,n.onerror=o.Util.falseFn,n.src=o.Util.emptyImageUrl,n.parentNode.removeChild(n))}}),o.Map.include({_defaultLocateOptions:{watch:!1,setView:!1,maxZoom:1/0,timeout:1e4,maximumAge:0,enableHighAccuracy:!1},locate:function(t){if(t=this._locateOptions=o.extend(this._defaultLocateOptions,t),!navigator.geolocation)return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var e=o.bind(this._handleGeolocationResponse,this),i=o.bind(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(e,i,t):navigator.geolocation.getCurrentPosition(e,i,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){var e=t.code,i=t.message||(1===e?"permission denied":2===e?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+i+"."})},_handleGeolocationResponse:function(t){var e=t.coords.latitude,i=t.coords.longitude,n=new o.LatLng(e,i),s=180*t.coords.accuracy/40075017,a=s/Math.cos(o.LatLng.DEG_TO_RAD*e),r=o.latLngBounds([e-s,i-a],[e+s,i+a]),h=this._locateOptions;if(h.setView){var l=Math.min(this.getBoundsZoom(r),h.maxZoom);this.setView(n,l)}var u={latlng:n,bounds:r,timestamp:t.timestamp};for(var c in t.coords)"number"==typeof t.coords[c]&&(u[c]=t.coords[c]);this.fire("locationfound",u)}})}(window,document);
/*! jQuery v1.8.2 jquery.com | jquery.org/license */
(function(a,b){function G(a){var b=F[a]={};return p.each(a.split(s),function(a,c){b[c]=!0}),b}function J(a,c,d){if(d===b&&a.nodeType===1){var e="data-"+c.replace(I,"-$1").toLowerCase();d=a.getAttribute(e);if(typeof d=="string"){try{d=d==="true"?!0:d==="false"?!1:d==="null"?null:+d+""===d?+d:H.test(d)?p.parseJSON(d):d}catch(f){}p.data(a,c,d)}else d=b}return d}function K(a){var b;for(b in a){if(b==="data"&&p.isEmptyObject(a[b]))continue;if(b!=="toJSON")return!1}return!0}function ba(){return!1}function bb(){return!0}function bh(a){return!a||!a.parentNode||a.parentNode.nodeType===11}function bi(a,b){do a=a[b];while(a&&a.nodeType!==1);return a}function bj(a,b,c){b=b||0;if(p.isFunction(b))return p.grep(a,function(a,d){var e=!!b.call(a,d,a);return e===c});if(b.nodeType)return p.grep(a,function(a,d){return a===b===c});if(typeof b=="string"){var d=p.grep(a,function(a){return a.nodeType===1});if(be.test(b))return p.filter(b,d,!c);b=p.filter(b,d)}return p.grep(a,function(a,d){return p.inArray(a,b)>=0===c})}function bk(a){var b=bl.split("|"),c=a.createDocumentFragment();if(c.createElement)while(b.length)c.createElement(b.pop());return c}function bC(a,b){return a.getElementsByTagName(b)[0]||a.appendChild(a.ownerDocument.createElement(b))}function bD(a,b){if(b.nodeType!==1||!p.hasData(a))return;var c,d,e,f=p._data(a),g=p._data(b,f),h=f.events;if(h){delete g.handle,g.events={};for(c in h)for(d=0,e=h[c].length;d<e;d++)p.event.add(b,c,h[c][d])}g.data&&(g.data=p.extend({},g.data))}function bE(a,b){var c;if(b.nodeType!==1)return;b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase(),c==="object"?(b.parentNode&&(b.outerHTML=a.outerHTML),p.support.html5Clone&&a.innerHTML&&!p.trim(b.innerHTML)&&(b.innerHTML=a.innerHTML)):c==="input"&&bv.test(a.type)?(b.defaultChecked=b.checked=a.checked,b.value!==a.value&&(b.value=a.value)):c==="option"?b.selected=a.defaultSelected:c==="input"||c==="textarea"?b.defaultValue=a.defaultValue:c==="script"&&b.text!==a.text&&(b.text=a.text),b.removeAttribute(p.expando)}function bF(a){return typeof a.getElementsByTagName!="undefined"?a.getElementsByTagName("*"):typeof a.querySelectorAll!="undefined"?a.querySelectorAll("*"):[]}function bG(a){bv.test(a.type)&&(a.defaultChecked=a.checked)}function bY(a,b){if(b in a)return b;var c=b.charAt(0).toUpperCase()+b.slice(1),d=b,e=bW.length;while(e--){b=bW[e]+c;if(b in a)return b}return d}function bZ(a,b){return a=b||a,p.css(a,"display")==="none"||!p.contains(a.ownerDocument,a)}function b$(a,b){var c,d,e=[],f=0,g=a.length;for(;f<g;f++){c=a[f];if(!c.style)continue;e[f]=p._data(c,"olddisplay"),b?(!e[f]&&c.style.display==="none"&&(c.style.display=""),c.style.display===""&&bZ(c)&&(e[f]=p._data(c,"olddisplay",cc(c.nodeName)))):(d=bH(c,"display"),!e[f]&&d!=="none"&&p._data(c,"olddisplay",d))}for(f=0;f<g;f++){c=a[f];if(!c.style)continue;if(!b||c.style.display==="none"||c.style.display==="")c.style.display=b?e[f]||"":"none"}return a}function b_(a,b,c){var d=bP.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function ca(a,b,c,d){var e=c===(d?"border":"content")?4:b==="width"?1:0,f=0;for(;e<4;e+=2)c==="margin"&&(f+=p.css(a,c+bV[e],!0)),d?(c==="content"&&(f-=parseFloat(bH(a,"padding"+bV[e]))||0),c!=="margin"&&(f-=parseFloat(bH(a,"border"+bV[e]+"Width"))||0)):(f+=parseFloat(bH(a,"padding"+bV[e]))||0,c!=="padding"&&(f+=parseFloat(bH(a,"border"+bV[e]+"Width"))||0));return f}function cb(a,b,c){var d=b==="width"?a.offsetWidth:a.offsetHeight,e=!0,f=p.support.boxSizing&&p.css(a,"boxSizing")==="border-box";if(d<=0||d==null){d=bH(a,b);if(d<0||d==null)d=a.style[b];if(bQ.test(d))return d;e=f&&(p.support.boxSizingReliable||d===a.style[b]),d=parseFloat(d)||0}return d+ca(a,b,c||(f?"border":"content"),e)+"px"}function cc(a){if(bS[a])return bS[a];var b=p("<"+a+">").appendTo(e.body),c=b.css("display");b.remove();if(c==="none"||c===""){bI=e.body.appendChild(bI||p.extend(e.createElement("iframe"),{frameBorder:0,width:0,height:0}));if(!bJ||!bI.createElement)bJ=(bI.contentWindow||bI.contentDocument).document,bJ.write("<!doctype html><html><body>"),bJ.close();b=bJ.body.appendChild(bJ.createElement(a)),c=bH(b,"display"),e.body.removeChild(bI)}return bS[a]=c,c}function ci(a,b,c,d){var e;if(p.isArray(b))p.each(b,function(b,e){c||ce.test(a)?d(a,e):ci(a+"["+(typeof e=="object"?b:"")+"]",e,c,d)});else if(!c&&p.type(b)==="object")for(e in b)ci(a+"["+e+"]",b[e],c,d);else d(a,b)}function cz(a){return function(b,c){typeof b!="string"&&(c=b,b="*");var d,e,f,g=b.toLowerCase().split(s),h=0,i=g.length;if(p.isFunction(c))for(;h<i;h++)d=g[h],f=/^\+/.test(d),f&&(d=d.substr(1)||"*"),e=a[d]=a[d]||[],e[f?"unshift":"push"](c)}}function cA(a,c,d,e,f,g){f=f||c.dataTypes[0],g=g||{},g[f]=!0;var h,i=a[f],j=0,k=i?i.length:0,l=a===cv;for(;j<k&&(l||!h);j++)h=i[j](c,d,e),typeof h=="string"&&(!l||g[h]?h=b:(c.dataTypes.unshift(h),h=cA(a,c,d,e,h,g)));return(l||!h)&&!g["*"]&&(h=cA(a,c,d,e,"*",g)),h}function cB(a,c){var d,e,f=p.ajaxSettings.flatOptions||{};for(d in c)c[d]!==b&&((f[d]?a:e||(e={}))[d]=c[d]);e&&p.extend(!0,a,e)}function cC(a,c,d){var e,f,g,h,i=a.contents,j=a.dataTypes,k=a.responseFields;for(f in k)f in d&&(c[k[f]]=d[f]);while(j[0]==="*")j.shift(),e===b&&(e=a.mimeType||c.getResponseHeader("content-type"));if(e)for(f in i)if(i[f]&&i[f].test(e)){j.unshift(f);break}if(j[0]in d)g=j[0];else{for(f in d){if(!j[0]||a.converters[f+" "+j[0]]){g=f;break}h||(h=f)}g=g||h}if(g)return g!==j[0]&&j.unshift(g),d[g]}function cD(a,b){var c,d,e,f,g=a.dataTypes.slice(),h=g[0],i={},j=0;a.dataFilter&&(b=a.dataFilter(b,a.dataType));if(g[1])for(c in a.converters)i[c.toLowerCase()]=a.converters[c];for(;e=g[++j];)if(e!=="*"){if(h!=="*"&&h!==e){c=i[h+" "+e]||i["* "+e];if(!c)for(d in i){f=d.split(" ");if(f[1]===e){c=i[h+" "+f[0]]||i["* "+f[0]];if(c){c===!0?c=i[d]:i[d]!==!0&&(e=f[0],g.splice(j--,0,e));break}}}if(c!==!0)if(c&&a["throws"])b=c(b);else try{b=c(b)}catch(k){return{state:"parsererror",error:c?k:"No conversion from "+h+" to "+e}}}h=e}return{state:"success",data:b}}function cL(){try{return new a.XMLHttpRequest}catch(b){}}function cM(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function cU(){return setTimeout(function(){cN=b},0),cN=p.now()}function cV(a,b){p.each(b,function(b,c){var d=(cT[b]||[]).concat(cT["*"]),e=0,f=d.length;for(;e<f;e++)if(d[e].call(a,b,c))return})}function cW(a,b,c){var d,e=0,f=0,g=cS.length,h=p.Deferred().always(function(){delete i.elem}),i=function(){var b=cN||cU(),c=Math.max(0,j.startTime+j.duration-b),d=1-(c/j.duration||0),e=0,f=j.tweens.length;for(;e<f;e++)j.tweens[e].run(d);return h.notifyWith(a,[j,d,c]),d<1&&f?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:p.extend({},b),opts:p.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:cN||cU(),duration:c.duration,tweens:[],createTween:function(b,c,d){var e=p.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(e),e},stop:function(b){var c=0,d=b?j.tweens.length:0;for(;c<d;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;cX(k,j.opts.specialEasing);for(;e<g;e++){d=cS[e].call(j,a,k,j.opts);if(d)return d}return cV(j,k),p.isFunction(j.opts.start)&&j.opts.start.call(a,j),p.fx.timer(p.extend(i,{anim:j,queue:j.opts.queue,elem:a})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}function cX(a,b){var c,d,e,f,g;for(c in a){d=p.camelCase(c),e=b[d],f=a[c],p.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=p.cssHooks[d];if(g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}}function cY(a,b,c){var d,e,f,g,h,i,j,k,l=this,m=a.style,n={},o=[],q=a.nodeType&&bZ(a);c.queue||(j=p._queueHooks(a,"fx"),j.unqueued==null&&(j.unqueued=0,k=j.empty.fire,j.empty.fire=function(){j.unqueued||k()}),j.unqueued++,l.always(function(){l.always(function(){j.unqueued--,p.queue(a,"fx").length||j.empty.fire()})})),a.nodeType===1&&("height"in b||"width"in b)&&(c.overflow=[m.overflow,m.overflowX,m.overflowY],p.css(a,"display")==="inline"&&p.css(a,"float")==="none"&&(!p.support.inlineBlockNeedsLayout||cc(a.nodeName)==="inline"?m.display="inline-block":m.zoom=1)),c.overflow&&(m.overflow="hidden",p.support.shrinkWrapBlocks||l.done(function(){m.overflow=c.overflow[0],m.overflowX=c.overflow[1],m.overflowY=c.overflow[2]}));for(d in b){f=b[d];if(cP.exec(f)){delete b[d];if(f===(q?"hide":"show"))continue;o.push(d)}}g=o.length;if(g){h=p._data(a,"fxshow")||p._data(a,"fxshow",{}),q?p(a).show():l.done(function(){p(a).hide()}),l.done(function(){var b;p.removeData(a,"fxshow",!0);for(b in n)p.style(a,b,n[b])});for(d=0;d<g;d++)e=o[d],i=l.createTween(e,q?h[e]:0),n[e]=h[e]||p.style(a,e),e in h||(h[e]=i.start,q&&(i.end=i.start,i.start=e==="width"||e==="height"?1:0))}}function cZ(a,b,c,d,e){return new cZ.prototype.init(a,b,c,d,e)}function c$(a,b){var c,d={height:a},e=0;b=b?1:0;for(;e<4;e+=2-b)c=bV[e],d["margin"+c]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}function da(a){return p.isWindow(a)?a:a.nodeType===9?a.defaultView||a.parentWindow:!1}var c,d,e=a.document,f=a.location,g=a.navigator,h=a.jQuery,i=a.$,j=Array.prototype.push,k=Array.prototype.slice,l=Array.prototype.indexOf,m=Object.prototype.toString,n=Object.prototype.hasOwnProperty,o=String.prototype.trim,p=function(a,b){return new p.fn.init(a,b,c)},q=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,r=/\S/,s=/\s+/,t=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,u=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,v=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,w=/^[\],:{}\s]*$/,x=/(?:^|:|,)(?:\s*\[)+/g,y=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,z=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,A=/^-ms-/,B=/-([\da-z])/gi,C=function(a,b){return(b+"").toUpperCase()},D=function(){e.addEventListener?(e.removeEventListener("DOMContentLoaded",D,!1),p.ready()):e.readyState==="complete"&&(e.detachEvent("onreadystatechange",D),p.ready())},E={};p.fn=p.prototype={constructor:p,init:function(a,c,d){var f,g,h,i;if(!a)return this;if(a.nodeType)return this.context=this[0]=a,this.length=1,this;if(typeof a=="string"){a.charAt(0)==="<"&&a.charAt(a.length-1)===">"&&a.length>=3?f=[null,a,null]:f=u.exec(a);if(f&&(f[1]||!c)){if(f[1])return c=c instanceof p?c[0]:c,i=c&&c.nodeType?c.ownerDocument||c:e,a=p.parseHTML(f[1],i,!0),v.test(f[1])&&p.isPlainObject(c)&&this.attr.call(a,c,!0),p.merge(this,a);g=e.getElementById(f[2]);if(g&&g.parentNode){if(g.id!==f[2])return d.find(a);this.length=1,this[0]=g}return this.context=e,this.selector=a,this}return!c||c.jquery?(c||d).find(a):this.constructor(c).find(a)}return p.isFunction(a)?d.ready(a):(a.selector!==b&&(this.selector=a.selector,this.context=a.context),p.makeArray(a,this))},selector:"",jquery:"1.8.2",length:0,size:function(){return this.length},toArray:function(){return k.call(this)},get:function(a){return a==null?this.toArray():a<0?this[this.length+a]:this[a]},pushStack:function(a,b,c){var d=p.merge(this.constructor(),a);return d.prevObject=this,d.context=this.context,b==="find"?d.selector=this.selector+(this.selector?" ":"")+c:b&&(d.selector=this.selector+"."+b+"("+c+")"),d},each:function(a,b){return p.each(this,a,b)},ready:function(a){return p.ready.promise().done(a),this},eq:function(a){return a=+a,a===-1?this.slice(a):this.slice(a,a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(k.apply(this,arguments),"slice",k.call(arguments).join(","))},map:function(a){return this.pushStack(p.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:j,sort:[].sort,splice:[].splice},p.fn.init.prototype=p.fn,p.extend=p.fn.extend=function(){var a,c,d,e,f,g,h=arguments[0]||{},i=1,j=arguments.length,k=!1;typeof h=="boolean"&&(k=h,h=arguments[1]||{},i=2),typeof h!="object"&&!p.isFunction(h)&&(h={}),j===i&&(h=this,--i);for(;i<j;i++)if((a=arguments[i])!=null)for(c in a){d=h[c],e=a[c];if(h===e)continue;k&&e&&(p.isPlainObject(e)||(f=p.isArray(e)))?(f?(f=!1,g=d&&p.isArray(d)?d:[]):g=d&&p.isPlainObject(d)?d:{},h[c]=p.extend(k,g,e)):e!==b&&(h[c]=e)}return h},p.extend({noConflict:function(b){return a.$===p&&(a.$=i),b&&a.jQuery===p&&(a.jQuery=h),p},isReady:!1,readyWait:1,holdReady:function(a){a?p.readyWait++:p.ready(!0)},ready:function(a){if(a===!0?--p.readyWait:p.isReady)return;if(!e.body)return setTimeout(p.ready,1);p.isReady=!0;if(a!==!0&&--p.readyWait>0)return;d.resolveWith(e,[p]),p.fn.trigger&&p(e).trigger("ready").off("ready")},isFunction:function(a){return p.type(a)==="function"},isArray:Array.isArray||function(a){return p.type(a)==="array"},isWindow:function(a){return a!=null&&a==a.window},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return a==null?String(a):E[m.call(a)]||"object"},isPlainObject:function(a){if(!a||p.type(a)!=="object"||a.nodeType||p.isWindow(a))return!1;try{if(a.constructor&&!n.call(a,"constructor")&&!n.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}var d;for(d in a);return d===b||n.call(a,d)},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},error:function(a){throw new Error(a)},parseHTML:function(a,b,c){var d;return!a||typeof a!="string"?null:(typeof b=="boolean"&&(c=b,b=0),b=b||e,(d=v.exec(a))?[b.createElement(d[1])]:(d=p.buildFragment([a],b,c?null:[]),p.merge([],(d.cacheable?p.clone(d.fragment):d.fragment).childNodes)))},parseJSON:function(b){if(!b||typeof b!="string")return null;b=p.trim(b);if(a.JSON&&a.JSON.parse)return a.JSON.parse(b);if(w.test(b.replace(y,"@").replace(z,"]").replace(x,"")))return(new Function("return "+b))();p.error("Invalid JSON: "+b)},parseXML:function(c){var d,e;if(!c||typeof c!="string")return null;try{a.DOMParser?(e=new DOMParser,d=e.parseFromString(c,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c))}catch(f){d=b}return(!d||!d.documentElement||d.getElementsByTagName("parsererror").length)&&p.error("Invalid XML: "+c),d},noop:function(){},globalEval:function(b){b&&r.test(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(A,"ms-").replace(B,C)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,c,d){var e,f=0,g=a.length,h=g===b||p.isFunction(a);if(d){if(h){for(e in a)if(c.apply(a[e],d)===!1)break}else for(;f<g;)if(c.apply(a[f++],d)===!1)break}else if(h){for(e in a)if(c.call(a[e],e,a[e])===!1)break}else for(;f<g;)if(c.call(a[f],f,a[f++])===!1)break;return a},trim:o&&!o.call("﻿ ")?function(a){return a==null?"":o.call(a)}:function(a){return a==null?"":(a+"").replace(t,"")},makeArray:function(a,b){var c,d=b||[];return a!=null&&(c=p.type(a),a.length==null||c==="string"||c==="function"||c==="regexp"||p.isWindow(a)?j.call(d,a):p.merge(d,a)),d},inArray:function(a,b,c){var d;if(b){if(l)return l.call(b,a,c);d=b.length,c=c?c<0?Math.max(0,d+c):c:0;for(;c<d;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,c){var d=c.length,e=a.length,f=0;if(typeof d=="number")for(;f<d;f++)a[e++]=c[f];else while(c[f]!==b)a[e++]=c[f++];return a.length=e,a},grep:function(a,b,c){var d,e=[],f=0,g=a.length;c=!!c;for(;f<g;f++)d=!!b(a[f],f),c!==d&&e.push(a[f]);return e},map:function(a,c,d){var e,f,g=[],h=0,i=a.length,j=a instanceof p||i!==b&&typeof i=="number"&&(i>0&&a[0]&&a[i-1]||i===0||p.isArray(a));if(j)for(;h<i;h++)e=c(a[h],h,d),e!=null&&(g[g.length]=e);else for(f in a)e=c(a[f],f,d),e!=null&&(g[g.length]=e);return g.concat.apply([],g)},guid:1,proxy:function(a,c){var d,e,f;return typeof c=="string"&&(d=a[c],c=a,a=d),p.isFunction(a)?(e=k.call(arguments,2),f=function(){return a.apply(c,e.concat(k.call(arguments)))},f.guid=a.guid=a.guid||p.guid++,f):b},access:function(a,c,d,e,f,g,h){var i,j=d==null,k=0,l=a.length;if(d&&typeof d=="object"){for(k in d)p.access(a,c,k,d[k],1,g,e);f=1}else if(e!==b){i=h===b&&p.isFunction(e),j&&(i?(i=c,c=function(a,b,c){return i.call(p(a),c)}):(c.call(a,e),c=null));if(c)for(;k<l;k++)c(a[k],d,i?e.call(a[k],k,c(a[k],d)):e,h);f=1}return f?a:j?c.call(a):l?c(a[0],d):g},now:function(){return(new Date).getTime()}}),p.ready.promise=function(b){if(!d){d=p.Deferred();if(e.readyState==="complete")setTimeout(p.ready,1);else if(e.addEventListener)e.addEventListener("DOMContentLoaded",D,!1),a.addEventListener("load",p.ready,!1);else{e.attachEvent("onreadystatechange",D),a.attachEvent("onload",p.ready);var c=!1;try{c=a.frameElement==null&&e.documentElement}catch(f){}c&&c.doScroll&&function g(){if(!p.isReady){try{c.doScroll("left")}catch(a){return setTimeout(g,50)}p.ready()}}()}}return d.promise(b)},p.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(a,b){E["[object "+b+"]"]=b.toLowerCase()}),c=p(e);var F={};p.Callbacks=function(a){a=typeof a=="string"?F[a]||G(a):p.extend({},a);var c,d,e,f,g,h,i=[],j=!a.once&&[],k=function(b){c=a.memory&&b,d=!0,h=f||0,f=0,g=i.length,e=!0;for(;i&&h<g;h++)if(i[h].apply(b[0],b[1])===!1&&a.stopOnFalse){c=!1;break}e=!1,i&&(j?j.length&&k(j.shift()):c?i=[]:l.disable())},l={add:function(){if(i){var b=i.length;(function d(b){p.each(b,function(b,c){var e=p.type(c);e==="function"&&(!a.unique||!l.has(c))?i.push(c):c&&c.length&&e!=="string"&&d(c)})})(arguments),e?g=i.length:c&&(f=b,k(c))}return this},remove:function(){return i&&p.each(arguments,function(a,b){var c;while((c=p.inArray(b,i,c))>-1)i.splice(c,1),e&&(c<=g&&g--,c<=h&&h--)}),this},has:function(a){return p.inArray(a,i)>-1},empty:function(){return i=[],this},disable:function(){return i=j=c=b,this},disabled:function(){return!i},lock:function(){return j=b,c||l.disable(),this},locked:function(){return!j},fireWith:function(a,b){return b=b||[],b=[a,b.slice?b.slice():b],i&&(!d||j)&&(e?j.push(b):k(b)),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!d}};return l},p.extend({Deferred:function(a){var b=[["resolve","done",p.Callbacks("once memory"),"resolved"],["reject","fail",p.Callbacks("once memory"),"rejected"],["notify","progress",p.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return p.Deferred(function(c){p.each(b,function(b,d){var f=d[0],g=a[b];e[d[1]](p.isFunction(g)?function(){var a=g.apply(this,arguments);a&&p.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f+"With"](this===e?c:this,[a])}:c[f])}),a=null}).promise()},promise:function(a){return a!=null?p.extend(a,d):d}},e={};return d.pipe=d.then,p.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[a^1][2].disable,b[2][2].lock),e[f[0]]=g.fire,e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=0,c=k.call(arguments),d=c.length,e=d!==1||a&&p.isFunction(a.promise)?d:0,f=e===1?a:p.Deferred(),g=function(a,b,c){return function(d){b[a]=this,c[a]=arguments.length>1?k.call(arguments):d,c===h?f.notifyWith(b,c):--e||f.resolveWith(b,c)}},h,i,j;if(d>1){h=new Array(d),i=new Array(d),j=new Array(d);for(;b<d;b++)c[b]&&p.isFunction(c[b].promise)?c[b].promise().done(g(b,j,c)).fail(f.reject).progress(g(b,i,h)):--e}return e||f.resolveWith(j,c),f.promise()}}),p.support=function(){var b,c,d,f,g,h,i,j,k,l,m,n=e.createElement("div");n.setAttribute("className","t"),n.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",c=n.getElementsByTagName("*"),d=n.getElementsByTagName("a")[0],d.style.cssText="top:1px;float:left;opacity:.5";if(!c||!c.length)return{};f=e.createElement("select"),g=f.appendChild(e.createElement("option")),h=n.getElementsByTagName("input")[0],b={leadingWhitespace:n.firstChild.nodeType===3,tbody:!n.getElementsByTagName("tbody").length,htmlSerialize:!!n.getElementsByTagName("link").length,style:/top/.test(d.getAttribute("style")),hrefNormalized:d.getAttribute("href")==="/a",opacity:/^0.5/.test(d.style.opacity),cssFloat:!!d.style.cssFloat,checkOn:h.value==="on",optSelected:g.selected,getSetAttribute:n.className!=="t",enctype:!!e.createElement("form").enctype,html5Clone:e.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",boxModel:e.compatMode==="CSS1Compat",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},h.checked=!0,b.noCloneChecked=h.cloneNode(!0).checked,f.disabled=!0,b.optDisabled=!g.disabled;try{delete n.test}catch(o){b.deleteExpando=!1}!n.addEventListener&&n.attachEvent&&n.fireEvent&&(n.attachEvent("onclick",m=function(){b.noCloneEvent=!1}),n.cloneNode(!0).fireEvent("onclick"),n.detachEvent("onclick",m)),h=e.createElement("input"),h.value="t",h.setAttribute("type","radio"),b.radioValue=h.value==="t",h.setAttribute("checked","checked"),h.setAttribute("name","t"),n.appendChild(h),i=e.createDocumentFragment(),i.appendChild(n.lastChild),b.checkClone=i.cloneNode(!0).cloneNode(!0).lastChild.checked,b.appendChecked=h.checked,i.removeChild(h),i.appendChild(n);if(n.attachEvent)for(k in{submit:!0,change:!0,focusin:!0})j="on"+k,l=j in n,l||(n.setAttribute(j,"return;"),l=typeof n[j]=="function"),b[k+"Bubbles"]=l;return p(function(){var c,d,f,g,h="padding:0;margin:0;border:0;display:block;overflow:hidden;",i=e.getElementsByTagName("body")[0];if(!i)return;c=e.createElement("div"),c.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",i.insertBefore(c,i.firstChild),d=e.createElement("div"),c.appendChild(d),d.innerHTML="<table><tr><td></td><td>t</td></tr></table>",f=d.getElementsByTagName("td"),f[0].style.cssText="padding:0;margin:0;border:0;display:none",l=f[0].offsetHeight===0,f[0].style.display="",f[1].style.display="none",b.reliableHiddenOffsets=l&&f[0].offsetHeight===0,d.innerHTML="",d.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",b.boxSizing=d.offsetWidth===4,b.doesNotIncludeMarginInBodyOffset=i.offsetTop!==1,a.getComputedStyle&&(b.pixelPosition=(a.getComputedStyle(d,null)||{}).top!=="1%",b.boxSizingReliable=(a.getComputedStyle(d,null)||{width:"4px"}).width==="4px",g=e.createElement("div"),g.style.cssText=d.style.cssText=h,g.style.marginRight=g.style.width="0",d.style.width="1px",d.appendChild(g),b.reliableMarginRight=!parseFloat((a.getComputedStyle(g,null)||{}).marginRight)),typeof d.style.zoom!="undefined"&&(d.innerHTML="",d.style.cssText=h+"width:1px;padding:1px;display:inline;zoom:1",b.inlineBlockNeedsLayout=d.offsetWidth===3,d.style.display="block",d.style.overflow="visible",d.innerHTML="<div></div>",d.firstChild.style.width="5px",b.shrinkWrapBlocks=d.offsetWidth!==3,c.style.zoom=1),i.removeChild(c),c=d=f=g=null}),i.removeChild(n),c=d=f=g=h=i=n=null,b}();var H=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,I=/([A-Z])/g;p.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+(p.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){return a=a.nodeType?p.cache[a[p.expando]]:a[p.expando],!!a&&!K(a)},data:function(a,c,d,e){if(!p.acceptData(a))return;var f,g,h=p.expando,i=typeof c=="string",j=a.nodeType,k=j?p.cache:a,l=j?a[h]:a[h]&&h;if((!l||!k[l]||!e&&!k[l].data)&&i&&d===b)return;l||(j?a[h]=l=p.deletedIds.pop()||p.guid++:l=h),k[l]||(k[l]={},j||(k[l].toJSON=p.noop));if(typeof c=="object"||typeof c=="function")e?k[l]=p.extend(k[l],c):k[l].data=p.extend(k[l].data,c);return f=k[l],e||(f.data||(f.data={}),f=f.data),d!==b&&(f[p.camelCase(c)]=d),i?(g=f[c],g==null&&(g=f[p.camelCase(c)])):g=f,g},removeData:function(a,b,c){if(!p.acceptData(a))return;var d,e,f,g=a.nodeType,h=g?p.cache:a,i=g?a[p.expando]:p.expando;if(!h[i])return;if(b){d=c?h[i]:h[i].data;if(d){p.isArray(b)||(b in d?b=[b]:(b=p.camelCase(b),b in d?b=[b]:b=b.split(" ")));for(e=0,f=b.length;e<f;e++)delete d[b[e]];if(!(c?K:p.isEmptyObject)(d))return}}if(!c){delete h[i].data;if(!K(h[i]))return}g?p.cleanData([a],!0):p.support.deleteExpando||h!=h.window?delete h[i]:h[i]=null},_data:function(a,b,c){return p.data(a,b,c,!0)},acceptData:function(a){var b=a.nodeName&&p.noData[a.nodeName.toLowerCase()];return!b||b!==!0&&a.getAttribute("classid")===b}}),p.fn.extend({data:function(a,c){var d,e,f,g,h,i=this[0],j=0,k=null;if(a===b){if(this.length){k=p.data(i);if(i.nodeType===1&&!p._data(i,"parsedAttrs")){f=i.attributes;for(h=f.length;j<h;j++)g=f[j].name,g.indexOf("data-")||(g=p.camelCase(g.substring(5)),J(i,g,k[g]));p._data(i,"parsedAttrs",!0)}}return k}return typeof a=="object"?this.each(function(){p.data(this,a)}):(d=a.split(".",2),d[1]=d[1]?"."+d[1]:"",e=d[1]+"!",p.access(this,function(c){if(c===b)return k=this.triggerHandler("getData"+e,[d[0]]),k===b&&i&&(k=p.data(i,a),k=J(i,a,k)),k===b&&d[1]?this.data(d[0]):k;d[1]=c,this.each(function(){var b=p(this);b.triggerHandler("setData"+e,d),p.data(this,a,c),b.triggerHandler("changeData"+e,d)})},null,c,arguments.length>1,null,!1))},removeData:function(a){return this.each(function(){p.removeData(this,a)})}}),p.extend({queue:function(a,b,c){var d;if(a)return b=(b||"fx")+"queue",d=p._data(a,b),c&&(!d||p.isArray(c)?d=p._data(a,b,p.makeArray(c)):d.push(c)),d||[]},dequeue:function(a,b){b=b||"fx";var c=p.queue(a,b),d=c.length,e=c.shift(),f=p._queueHooks(a,b),g=function(){p.dequeue(a,b)};e==="inprogress"&&(e=c.shift(),d--),e&&(b==="fx"&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return p._data(a,c)||p._data(a,c,{empty:p.Callbacks("once memory").add(function(){p.removeData(a,b+"queue",!0),p.removeData(a,c,!0)})})}}),p.fn.extend({queue:function(a,c){var d=2;return typeof a!="string"&&(c=a,a="fx",d--),arguments.length<d?p.queue(this[0],a):c===b?this:this.each(function(){var b=p.queue(this,a,c);p._queueHooks(this,a),a==="fx"&&b[0]!=="inprogress"&&p.dequeue(this,a)})},dequeue:function(a){return this.each(function(){p.dequeue(this,a)})},delay:function(a,b){return a=p.fx?p.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){var d,e=1,f=p.Deferred(),g=this,h=this.length,i=function(){--e||f.resolveWith(g,[g])};typeof a!="string"&&(c=a,a=b),a=a||"fx";while(h--)d=p._data(g[h],a+"queueHooks"),d&&d.empty&&(e++,d.empty.add(i));return i(),f.promise(c)}});var L,M,N,O=/[\t\r\n]/g,P=/\r/g,Q=/^(?:button|input)$/i,R=/^(?:button|input|object|select|textarea)$/i,S=/^a(?:rea|)$/i,T=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,U=p.support.getSetAttribute;p.fn.extend({attr:function(a,b){return p.access(this,p.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){p.removeAttr(this,a)})},prop:function(a,b){return p.access(this,p.prop,a,b,arguments.length>1)},removeProp:function(a){return a=p.propFix[a]||a,this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){var b,c,d,e,f,g,h;if(p.isFunction(a))return this.each(function(b){p(this).addClass(a.call(this,b,this.className))});if(a&&typeof a=="string"){b=a.split(s);for(c=0,d=this.length;c<d;c++){e=this[c];if(e.nodeType===1)if(!e.className&&b.length===1)e.className=a;else{f=" "+e.className+" ";for(g=0,h=b.length;g<h;g++)f.indexOf(" "+b[g]+" ")<0&&(f+=b[g]+" ");e.className=p.trim(f)}}}return this},removeClass:function(a){var c,d,e,f,g,h,i;if(p.isFunction(a))return this.each(function(b){p(this).removeClass(a.call(this,b,this.className))});if(a&&typeof a=="string"||a===b){c=(a||"").split(s);for(h=0,i=this.length;h<i;h++){e=this[h];if(e.nodeType===1&&e.className){d=(" "+e.className+" ").replace(O," ");for(f=0,g=c.length;f<g;f++)while(d.indexOf(" "+c[f]+" ")>=0)d=d.replace(" "+c[f]+" "," ");e.className=a?p.trim(d):""}}}return this},toggleClass:function(a,b){var c=typeof a,d=typeof b=="boolean";return p.isFunction(a)?this.each(function(c){p(this).toggleClass(a.call(this,c,this.className,b),b)}):this.each(function(){if(c==="string"){var e,f=0,g=p(this),h=b,i=a.split(s);while(e=i[f++])h=d?h:!g.hasClass(e),g[h?"addClass":"removeClass"](e)}else if(c==="undefined"||c==="boolean")this.className&&p._data(this,"__className__",this.className),this.className=this.className||a===!1?"":p._data(this,"__className__")||""})},hasClass:function(a){var b=" "+a+" ",c=0,d=this.length;for(;c<d;c++)if(this[c].nodeType===1&&(" "+this[c].className+" ").replace(O," ").indexOf(b)>=0)return!0;return!1},val:function(a){var c,d,e,f=this[0];if(!arguments.length){if(f)return c=p.valHooks[f.type]||p.valHooks[f.nodeName.toLowerCase()],c&&"get"in c&&(d=c.get(f,"value"))!==b?d:(d=f.value,typeof d=="string"?d.replace(P,""):d==null?"":d);return}return e=p.isFunction(a),this.each(function(d){var f,g=p(this);if(this.nodeType!==1)return;e?f=a.call(this,d,g.val()):f=a,f==null?f="":typeof f=="number"?f+="":p.isArray(f)&&(f=p.map(f,function(a){return a==null?"":a+""})),c=p.valHooks[this.type]||p.valHooks[this.nodeName.toLowerCase()];if(!c||!("set"in c)||c.set(this,f,"value")===b)this.value=f})}}),p.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){var b,c,d,e,f=a.selectedIndex,g=[],h=a.options,i=a.type==="select-one";if(f<0)return null;c=i?f:0,d=i?f+1:h.length;for(;c<d;c++){e=h[c];if(e.selected&&(p.support.optDisabled?!e.disabled:e.getAttribute("disabled")===null)&&(!e.parentNode.disabled||!p.nodeName(e.parentNode,"optgroup"))){b=p(e).val();if(i)return b;g.push(b)}}return i&&!g.length&&h.length?p(h[f]).val():g},set:function(a,b){var c=p.makeArray(b);return p(a).find("option").each(function(){this.selected=p.inArray(p(this).val(),c)>=0}),c.length||(a.selectedIndex=-1),c}}},attrFn:{},attr:function(a,c,d,e){var f,g,h,i=a.nodeType;if(!a||i===3||i===8||i===2)return;if(e&&p.isFunction(p.fn[c]))return p(a)[c](d);if(typeof a.getAttribute=="undefined")return p.prop(a,c,d);h=i!==1||!p.isXMLDoc(a),h&&(c=c.toLowerCase(),g=p.attrHooks[c]||(T.test(c)?M:L));if(d!==b){if(d===null){p.removeAttr(a,c);return}return g&&"set"in g&&h&&(f=g.set(a,d,c))!==b?f:(a.setAttribute(c,d+""),d)}return g&&"get"in g&&h&&(f=g.get(a,c))!==null?f:(f=a.getAttribute(c),f===null?b:f)},removeAttr:function(a,b){var c,d,e,f,g=0;if(b&&a.nodeType===1){d=b.split(s);for(;g<d.length;g++)e=d[g],e&&(c=p.propFix[e]||e,f=T.test(e),f||p.attr(a,e,""),a.removeAttribute(U?e:c),f&&c in a&&(a[c]=!1))}},attrHooks:{type:{set:function(a,b){if(Q.test(a.nodeName)&&a.parentNode)p.error("type property can't be changed");else if(!p.support.radioValue&&b==="radio"&&p.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}},value:{get:function(a,b){return L&&p.nodeName(a,"button")?L.get(a,b):b in a?a.value:null},set:function(a,b,c){if(L&&p.nodeName(a,"button"))return L.set(a,b,c);a.value=b}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,c,d){var e,f,g,h=a.nodeType;if(!a||h===3||h===8||h===2)return;return g=h!==1||!p.isXMLDoc(a),g&&(c=p.propFix[c]||c,f=p.propHooks[c]),d!==b?f&&"set"in f&&(e=f.set(a,d,c))!==b?e:a[c]=d:f&&"get"in f&&(e=f.get(a,c))!==null?e:a[c]},propHooks:{tabIndex:{get:function(a){var c=a.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):R.test(a.nodeName)||S.test(a.nodeName)&&a.href?0:b}}}}),M={get:function(a,c){var d,e=p.prop(a,c);return e===!0||typeof e!="boolean"&&(d=a.getAttributeNode(c))&&d.nodeValue!==!1?c.toLowerCase():b},set:function(a,b,c){var d;return b===!1?p.removeAttr(a,c):(d=p.propFix[c]||c,d in a&&(a[d]=!0),a.setAttribute(c,c.toLowerCase())),c}},U||(N={name:!0,id:!0,coords:!0},L=p.valHooks.button={get:function(a,c){var d;return d=a.getAttributeNode(c),d&&(N[c]?d.value!=="":d.specified)?d.value:b},set:function(a,b,c){var d=a.getAttributeNode(c);return d||(d=e.createAttribute(c),a.setAttributeNode(d)),d.value=b+""}},p.each(["width","height"],function(a,b){p.attrHooks[b]=p.extend(p.attrHooks[b],{set:function(a,c){if(c==="")return a.setAttribute(b,"auto"),c}})}),p.attrHooks.contenteditable={get:L.get,set:function(a,b,c){b===""&&(b="false"),L.set(a,b,c)}}),p.support.hrefNormalized||p.each(["href","src","width","height"],function(a,c){p.attrHooks[c]=p.extend(p.attrHooks[c],{get:function(a){var d=a.getAttribute(c,2);return d===null?b:d}})}),p.support.style||(p.attrHooks.style={get:function(a){return a.style.cssText.toLowerCase()||b},set:function(a,b){return a.style.cssText=b+""}}),p.support.optSelected||(p.propHooks.selected=p.extend(p.propHooks.selected,{get:function(a){var b=a.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null}})),p.support.enctype||(p.propFix.enctype="encoding"),p.support.checkOn||p.each(["radio","checkbox"],function(){p.valHooks[this]={get:function(a){return a.getAttribute("value")===null?"on":a.value}}}),p.each(["radio","checkbox"],function(){p.valHooks[this]=p.extend(p.valHooks[this],{set:function(a,b){if(p.isArray(b))return a.checked=p.inArray(p(a).val(),b)>=0}})});var V=/^(?:textarea|input|select)$/i,W=/^([^\.]*|)(?:\.(.+)|)$/,X=/(?:^|\s)hover(\.\S+|)\b/,Y=/^key/,Z=/^(?:mouse|contextmenu)|click/,$=/^(?:focusinfocus|focusoutblur)$/,_=function(a){return p.event.special.hover?a:a.replace(X,"mouseenter$1 mouseleave$1")};p.event={add:function(a,c,d,e,f){var g,h,i,j,k,l,m,n,o,q,r;if(a.nodeType===3||a.nodeType===8||!c||!d||!(g=p._data(a)))return;d.handler&&(o=d,d=o.handler,f=o.selector),d.guid||(d.guid=p.guid++),i=g.events,i||(g.events=i={}),h=g.handle,h||(g.handle=h=function(a){return typeof p!="undefined"&&(!a||p.event.triggered!==a.type)?p.event.dispatch.apply(h.elem,arguments):b},h.elem=a),c=p.trim(_(c)).split(" ");for(j=0;j<c.length;j++){k=W.exec(c[j])||[],l=k[1],m=(k[2]||"").split(".").sort(),r=p.event.special[l]||{},l=(f?r.delegateType:r.bindType)||l,r=p.event.special[l]||{},n=p.extend({type:l,origType:k[1],data:e,handler:d,guid:d.guid,selector:f,needsContext:f&&p.expr.match.needsContext.test(f),namespace:m.join(".")},o),q=i[l];if(!q){q=i[l]=[],q.delegateCount=0;if(!r.setup||r.setup.call(a,e,m,h)===!1)a.addEventListener?a.addEventListener(l,h,!1):a.attachEvent&&a.attachEvent("on"+l,h)}r.add&&(r.add.call(a,n),n.handler.guid||(n.handler.guid=d.guid)),f?q.splice(q.delegateCount++,0,n):q.push(n),p.event.global[l]=!0}a=null},global:{},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,q,r=p.hasData(a)&&p._data(a);if(!r||!(m=r.events))return;b=p.trim(_(b||"")).split(" ");for(f=0;f<b.length;f++){g=W.exec(b[f])||[],h=i=g[1],j=g[2];if(!h){for(h in m)p.event.remove(a,h+b[f],c,d,!0);continue}n=p.event.special[h]||{},h=(d?n.delegateType:n.bindType)||h,o=m[h]||[],k=o.length,j=j?new RegExp("(^|\\.)"+j.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null;for(l=0;l<o.length;l++)q=o[l],(e||i===q.origType)&&(!c||c.guid===q.guid)&&(!j||j.test(q.namespace))&&(!d||d===q.selector||d==="**"&&q.selector)&&(o.splice(l--,1),q.selector&&o.delegateCount--,n.remove&&n.remove.call(a,q));o.length===0&&k!==o.length&&((!n.teardown||n.teardown.call(a,j,r.handle)===!1)&&p.removeEvent(a,h,r.handle),delete m[h])}p.isEmptyObject(m)&&(delete r.handle,p.removeData(a,"events",!0))},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(c,d,f,g){if(!f||f.nodeType!==3&&f.nodeType!==8){var h,i,j,k,l,m,n,o,q,r,s=c.type||c,t=[];if($.test(s+p.event.triggered))return;s.indexOf("!")>=0&&(s=s.slice(0,-1),i=!0),s.indexOf(".")>=0&&(t=s.split("."),s=t.shift(),t.sort());if((!f||p.event.customEvent[s])&&!p.event.global[s])return;c=typeof c=="object"?c[p.expando]?c:new p.Event(s,c):new p.Event(s),c.type=s,c.isTrigger=!0,c.exclusive=i,c.namespace=t.join("."),c.namespace_re=c.namespace?new RegExp("(^|\\.)"+t.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,m=s.indexOf(":")<0?"on"+s:"";if(!f){h=p.cache;for(j in h)h[j].events&&h[j].events[s]&&p.event.trigger(c,d,h[j].handle.elem,!0);return}c.result=b,c.target||(c.target=f),d=d!=null?p.makeArray(d):[],d.unshift(c),n=p.event.special[s]||{};if(n.trigger&&n.trigger.apply(f,d)===!1)return;q=[[f,n.bindType||s]];if(!g&&!n.noBubble&&!p.isWindow(f)){r=n.delegateType||s,k=$.test(r+s)?f:f.parentNode;for(l=f;k;k=k.parentNode)q.push([k,r]),l=k;l===(f.ownerDocument||e)&&q.push([l.defaultView||l.parentWindow||a,r])}for(j=0;j<q.length&&!c.isPropagationStopped();j++)k=q[j][0],c.type=q[j][1],o=(p._data(k,"events")||{})[c.type]&&p._data(k,"handle"),o&&o.apply(k,d),o=m&&k[m],o&&p.acceptData(k)&&o.apply&&o.apply(k,d)===!1&&c.preventDefault();return c.type=s,!g&&!c.isDefaultPrevented()&&(!n._default||n._default.apply(f.ownerDocument,d)===!1)&&(s!=="click"||!p.nodeName(f,"a"))&&p.acceptData(f)&&m&&f[s]&&(s!=="focus"&&s!=="blur"||c.target.offsetWidth!==0)&&!p.isWindow(f)&&(l=f[m],l&&(f[m]=null),p.event.triggered=s,f[s](),p.event.triggered=b,l&&(f[m]=l)),c.result}return},dispatch:function(c){c=p.event.fix(c||a.event);var d,e,f,g,h,i,j,l,m,n,o=(p._data(this,"events")||{})[c.type]||[],q=o.delegateCount,r=k.call(arguments),s=!c.exclusive&&!c.namespace,t=p.event.special[c.type]||{},u=[];r[0]=c,c.delegateTarget=this;if(t.preDispatch&&t.preDispatch.call(this,c)===!1)return;if(q&&(!c.button||c.type!=="click"))for(f=c.target;f!=this;f=f.parentNode||this)if(f.disabled!==!0||c.type!=="click"){h={},j=[];for(d=0;d<q;d++)l=o[d],m=l.selector,h[m]===b&&(h[m]=l.needsContext?p(m,this).index(f)>=0:p.find(m,this,null,[f]).length),h[m]&&j.push(l);j.length&&u.push({elem:f,matches:j})}o.length>q&&u.push({elem:this,matches:o.slice(q)});for(d=0;d<u.length&&!c.isPropagationStopped();d++){i=u[d],c.currentTarget=i.elem;for(e=0;e<i.matches.length&&!c.isImmediatePropagationStopped();e++){l=i.matches[e];if(s||!c.namespace&&!l.namespace||c.namespace_re&&c.namespace_re.test(l.namespace))c.data=l.data,c.handleObj=l,g=((p.event.special[l.origType]||{}).handle||l.handler).apply(i.elem,r),g!==b&&(c.result=g,g===!1&&(c.preventDefault(),c.stopPropagation()))}}return t.postDispatch&&t.postDispatch.call(this,c),c.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return a.which==null&&(a.which=b.charCode!=null?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,c){var d,f,g,h=c.button,i=c.fromElement;return a.pageX==null&&c.clientX!=null&&(d=a.target.ownerDocument||e,f=d.documentElement,g=d.body,a.pageX=c.clientX+(f&&f.scrollLeft||g&&g.scrollLeft||0)-(f&&f.clientLeft||g&&g.clientLeft||0),a.pageY=c.clientY+(f&&f.scrollTop||g&&g.scrollTop||0)-(f&&f.clientTop||g&&g.clientTop||0)),!a.relatedTarget&&i&&(a.relatedTarget=i===a.target?c.toElement:i),!a.which&&h!==b&&(a.which=h&1?1:h&2?3:h&4?2:0),a}},fix:function(a){if(a[p.expando])return a;var b,c,d=a,f=p.event.fixHooks[a.type]||{},g=f.props?this.props.concat(f.props):this.props;a=p.Event(d);for(b=g.length;b;)c=g[--b],a[c]=d[c];return a.target||(a.target=d.srcElement||e),a.target.nodeType===3&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey,f.filter?f.filter(a,d):a},special:{load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(a,b,c){p.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(a,b){this.onbeforeunload===b&&(this.onbeforeunload=null)}}},simulate:function(a,b,c,d){var e=p.extend(new p.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?p.event.trigger(e,null,b):p.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},p.event.handle=p.event.dispatch,p.removeEvent=e.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){var d="on"+b;a.detachEvent&&(typeof a[d]=="undefined"&&(a[d]=null),a.detachEvent(d,c))},p.Event=function(a,b){if(this instanceof p.Event)a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?bb:ba):this.type=a,b&&p.extend(this,b),this.timeStamp=a&&a.timeStamp||p.now(),this[p.expando]=!0;else return new p.Event(a,b)},p.Event.prototype={preventDefault:function(){this.isDefaultPrevented=bb;var a=this.originalEvent;if(!a)return;a.preventDefault?a.preventDefault():a.returnValue=!1},stopPropagation:function(){this.isPropagationStopped=bb;var a=this.originalEvent;if(!a)return;a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=bb,this.stopPropagation()},isDefaultPrevented:ba,isPropagationStopped:ba,isImmediatePropagationStopped:ba},p.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){p.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj,g=f.selector;if(!e||e!==d&&!p.contains(d,e))a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b;return c}}}),p.support.submitBubbles||(p.event.special.submit={setup:function(){if(p.nodeName(this,"form"))return!1;p.event.add(this,"click._submit keypress._submit",function(a){var c=a.target,d=p.nodeName(c,"input")||p.nodeName(c,"button")?c.form:b;d&&!p._data(d,"_submit_attached")&&(p.event.add(d,"submit._submit",function(a){a._submit_bubble=!0}),p._data(d,"_submit_attached",!0))})},postDispatch:function(a){a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&p.event.simulate("submit",this.parentNode,a,!0))},teardown:function(){if(p.nodeName(this,"form"))return!1;p.event.remove(this,"._submit")}}),p.support.changeBubbles||(p.event.special.change={setup:function(){if(V.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")p.event.add(this,"propertychange._change",function(a){a.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),p.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1),p.event.simulate("change",this,a,!0)});return!1}p.event.add(this,"beforeactivate._change",function(a){var b=a.target;V.test(b.nodeName)&&!p._data(b,"_change_attached")&&(p.event.add(b,"change._change",function(a){this.parentNode&&!a.isSimulated&&!a.isTrigger&&p.event.simulate("change",this.parentNode,a,!0)}),p._data(b,"_change_attached",!0))})},handle:function(a){var b=a.target;if(this!==b||a.isSimulated||a.isTrigger||b.type!=="radio"&&b.type!=="checkbox")return a.handleObj.handler.apply(this,arguments)},teardown:function(){return p.event.remove(this,"._change"),!V.test(this.nodeName)}}),p.support.focusinBubbles||p.each({focus:"focusin",blur:"focusout"},function(a,b){var c=0,d=function(a){p.event.simulate(b,a.target,p.event.fix(a),!0)};p.event.special[b]={setup:function(){c++===0&&e.addEventListener(a,d,!0)},teardown:function(){--c===0&&e.removeEventListener(a,d,!0)}}}),p.fn.extend({on:function(a,c,d,e,f){var g,h;if(typeof a=="object"){typeof c!="string"&&(d=d||c,c=b);for(h in a)this.on(h,c,d,a[h],f);return this}d==null&&e==null?(e=c,d=c=b):e==null&&(typeof c=="string"?(e=d,d=b):(e=d,d=c,c=b));if(e===!1)e=ba;else if(!e)return this;return f===1&&(g=e,e=function(a){return p().off(a),g.apply(this,arguments)},e.guid=g.guid||(g.guid=p.guid++)),this.each(function(){p.event.add(this,a,e,d,c)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,c,d){var e,f;if(a&&a.preventDefault&&a.handleObj)return e=a.handleObj,p(a.delegateTarget).off(e.namespace?e.origType+"."+e.namespace:e.origType,e.selector,e.handler),this;if(typeof a=="object"){for(f in a)this.off(f,c,a[f]);return this}if(c===!1||typeof c=="function")d=c,c=b;return d===!1&&(d=ba),this.each(function(){p.event.remove(this,a,d,c)})},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},live:function(a,b,c){return p(this.context).on(a,this.selector,b,c),this},die:function(a,b){return p(this.context).off(a,this.selector||"**",b),this},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return arguments.length===1?this.off(a,"**"):this.off(b,a||"**",c)},trigger:function(a,b){return this.each(function(){p.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0])return p.event.trigger(a,b,this[0],!0)},toggle:function(a){var b=arguments,c=a.guid||p.guid++,d=0,e=function(c){var e=(p._data(this,"lastToggle"+a.guid)||0)%d;return p._data(this,"lastToggle"+a.guid,e+1),c.preventDefault(),b[e].apply(this,arguments)||!1};e.guid=c;while(d<b.length)b[d++].guid=c;return this.click(e)},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),p.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){p.fn[b]=function(a,c){return c==null&&(c=a,a=null),arguments.length>0?this.on(b,null,a,c):this.trigger(b)},Y.test(b)&&(p.event.fixHooks[b]=p.event.keyHooks),Z.test(b)&&(p.event.fixHooks[b]=p.event.mouseHooks)}),function(a,b){function bc(a,b,c,d){c=c||[],b=b||r;var e,f,i,j,k=b.nodeType;if(!a||typeof a!="string")return c;if(k!==1&&k!==9)return[];i=g(b);if(!i&&!d)if(e=P.exec(a))if(j=e[1]){if(k===9){f=b.getElementById(j);if(!f||!f.parentNode)return c;if(f.id===j)return c.push(f),c}else if(b.ownerDocument&&(f=b.ownerDocument.getElementById(j))&&h(b,f)&&f.id===j)return c.push(f),c}else{if(e[2])return w.apply(c,x.call(b.getElementsByTagName(a),0)),c;if((j=e[3])&&_&&b.getElementsByClassName)return w.apply(c,x.call(b.getElementsByClassName(j),0)),c}return bp(a.replace(L,"$1"),b,c,d,i)}function bd(a){return function(b){var c=b.nodeName.toLowerCase();return c==="input"&&b.type===a}}function be(a){return function(b){var c=b.nodeName.toLowerCase();return(c==="input"||c==="button")&&b.type===a}}function bf(a){return z(function(b){return b=+b,z(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function bg(a,b,c){if(a===b)return c;var d=a.nextSibling;while(d){if(d===b)return-1;d=d.nextSibling}return 1}function bh(a,b){var c,d,f,g,h,i,j,k=C[o][a];if(k)return b?0:k.slice(0);h=a,i=[],j=e.preFilter;while(h){if(!c||(d=M.exec(h)))d&&(h=h.slice(d[0].length)),i.push(f=[]);c=!1;if(d=N.exec(h))f.push(c=new q(d.shift())),h=h.slice(c.length),c.type=d[0].replace(L," ");for(g in e.filter)(d=W[g].exec(h))&&(!j[g]||(d=j[g](d,r,!0)))&&(f.push(c=new q(d.shift())),h=h.slice(c.length),c.type=g,c.matches=d);if(!c)break}return b?h.length:h?bc.error(a):C(a,i).slice(0)}function bi(a,b,d){var e=b.dir,f=d&&b.dir==="parentNode",g=u++;return b.first?function(b,c,d){while(b=b[e])if(f||b.nodeType===1)return a(b,c,d)}:function(b,d,h){if(!h){var i,j=t+" "+g+" ",k=j+c;while(b=b[e])if(f||b.nodeType===1){if((i=b[o])===k)return b.sizset;if(typeof i=="string"&&i.indexOf(j)===0){if(b.sizset)return b}else{b[o]=k;if(a(b,d,h))return b.sizset=!0,b;b.sizset=!1}}}else while(b=b[e])if(f||b.nodeType===1)if(a(b,d,h))return b}}function bj(a){return a.length>1?function(b,c,d){var e=a.length;while(e--)if(!a[e](b,c,d))return!1;return!0}:a[0]}function bk(a,b,c,d,e){var f,g=[],h=0,i=a.length,j=b!=null;for(;h<i;h++)if(f=a[h])if(!c||c(f,d,e))g.push(f),j&&b.push(h);return g}function bl(a,b,c,d,e,f){return d&&!d[o]&&(d=bl(d)),e&&!e[o]&&(e=bl(e,f)),z(function(f,g,h,i){if(f&&e)return;var j,k,l,m=[],n=[],o=g.length,p=f||bo(b||"*",h.nodeType?[h]:h,[],f),q=a&&(f||!b)?bk(p,m,a,h,i):p,r=c?e||(f?a:o||d)?[]:g:q;c&&c(q,r,h,i);if(d){l=bk(r,n),d(l,[],h,i),j=l.length;while(j--)if(k=l[j])r[n[j]]=!(q[n[j]]=k)}if(f){j=a&&r.length;while(j--)if(k=r[j])f[m[j]]=!(g[m[j]]=k)}else r=bk(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):w.apply(g,r)})}function bm(a){var b,c,d,f=a.length,g=e.relative[a[0].type],h=g||e.relative[" "],i=g?1:0,j=bi(function(a){return a===b},h,!0),k=bi(function(a){return y.call(b,a)>-1},h,!0),m=[function(a,c,d){return!g&&(d||c!==l)||((b=c).nodeType?j(a,c,d):k(a,c,d))}];for(;i<f;i++)if(c=e.relative[a[i].type])m=[bi(bj(m),c)];else{c=e.filter[a[i].type].apply(null,a[i].matches);if(c[o]){d=++i;for(;d<f;d++)if(e.relative[a[d].type])break;return bl(i>1&&bj(m),i>1&&a.slice(0,i-1).join("").replace(L,"$1"),c,i<d&&bm(a.slice(i,d)),d<f&&bm(a=a.slice(d)),d<f&&a.join(""))}m.push(c)}return bj(m)}function bn(a,b){var d=b.length>0,f=a.length>0,g=function(h,i,j,k,m){var n,o,p,q=[],s=0,u="0",x=h&&[],y=m!=null,z=l,A=h||f&&e.find.TAG("*",m&&i.parentNode||i),B=t+=z==null?1:Math.E;y&&(l=i!==r&&i,c=g.el);for(;(n=A[u])!=null;u++){if(f&&n){for(o=0;p=a[o];o++)if(p(n,i,j)){k.push(n);break}y&&(t=B,c=++g.el)}d&&((n=!p&&n)&&s--,h&&x.push(n))}s+=u;if(d&&u!==s){for(o=0;p=b[o];o++)p(x,q,i,j);if(h){if(s>0)while(u--)!x[u]&&!q[u]&&(q[u]=v.call(k));q=bk(q)}w.apply(k,q),y&&!h&&q.length>0&&s+b.length>1&&bc.uniqueSort(k)}return y&&(t=B,l=z),x};return g.el=0,d?z(g):g}function bo(a,b,c,d){var e=0,f=b.length;for(;e<f;e++)bc(a,b[e],c,d);return c}function bp(a,b,c,d,f){var g,h,j,k,l,m=bh(a),n=m.length;if(!d&&m.length===1){h=m[0]=m[0].slice(0);if(h.length>2&&(j=h[0]).type==="ID"&&b.nodeType===9&&!f&&e.relative[h[1].type]){b=e.find.ID(j.matches[0].replace(V,""),b,f)[0];if(!b)return c;a=a.slice(h.shift().length)}for(g=W.POS.test(a)?-1:h.length-1;g>=0;g--){j=h[g];if(e.relative[k=j.type])break;if(l=e.find[k])if(d=l(j.matches[0].replace(V,""),R.test(h[0].type)&&b.parentNode||b,f)){h.splice(g,1),a=d.length&&h.join("");if(!a)return w.apply(c,x.call(d,0)),c;break}}}return i(a,m)(d,b,f,c,R.test(a)),c}function bq(){}var c,d,e,f,g,h,i,j,k,l,m=!0,n="undefined",o=("sizcache"+Math.random()).replace(".",""),q=String,r=a.document,s=r.documentElement,t=0,u=0,v=[].pop,w=[].push,x=[].slice,y=[].indexOf||function(a){var b=0,c=this.length;for(;b<c;b++)if(this[b]===a)return b;return-1},z=function(a,b){return a[o]=b==null||b,a},A=function(){var a={},b=[];return z(function(c,d){return b.push(c)>e.cacheLength&&delete a[b.shift()],a[c]=d},a)},B=A(),C=A(),D=A(),E="[\\x20\\t\\r\\n\\f]",F="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",G=F.replace("w","w#"),H="([*^$|!~]?=)",I="\\["+E+"*("+F+")"+E+"*(?:"+H+E+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+G+")|)|)"+E+"*\\]",J=":("+F+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+I+")|[^:]|\\\\.)*|.*))\\)|)",K=":(even|odd|eq|gt|lt|nth|first|last)(?:\\("+E+"*((?:-\\d)?\\d*)"+E+"*\\)|)(?=[^-]|$)",L=new RegExp("^"+E+"+|((?:^|[^\\\\])(?:\\\\.)*)"+E+"+$","g"),M=new RegExp("^"+E+"*,"+E+"*"),N=new RegExp("^"+E+"*([\\x20\\t\\r\\n\\f>+~])"+E+"*"),O=new RegExp(J),P=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,Q=/^:not/,R=/[\x20\t\r\n\f]*[+~]/,S=/:not\($/,T=/h\d/i,U=/input|select|textarea|button/i,V=/\\(?!\\)/g,W={ID:new RegExp("^#("+F+")"),CLASS:new RegExp("^\\.("+F+")"),NAME:new RegExp("^\\[name=['\"]?("+F+")['\"]?\\]"),TAG:new RegExp("^("+F.replace("w","w*")+")"),ATTR:new RegExp("^"+I),PSEUDO:new RegExp("^"+J),POS:new RegExp(K,"i"),CHILD:new RegExp("^:(only|nth|first|last)-child(?:\\("+E+"*(even|odd|(([+-]|)(\\d*)n|)"+E+"*(?:([+-]|)"+E+"*(\\d+)|))"+E+"*\\)|)","i"),needsContext:new RegExp("^"+E+"*[>+~]|"+K,"i")},X=function(a){var b=r.createElement("div");try{return a(b)}catch(c){return!1}finally{b=null}},Y=X(function(a){return a.appendChild(r.createComment("")),!a.getElementsByTagName("*").length}),Z=X(function(a){return a.innerHTML="<a href='#'></a>",a.firstChild&&typeof a.firstChild.getAttribute!==n&&a.firstChild.getAttribute("href")==="#"}),$=X(function(a){a.innerHTML="<select></select>";var b=typeof a.lastChild.getAttribute("multiple");return b!=="boolean"&&b!=="string"}),_=X(function(a){return a.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",!a.getElementsByClassName||!a.getElementsByClassName("e").length?!1:(a.lastChild.className="e",a.getElementsByClassName("e").length===2)}),ba=X(function(a){a.id=o+0,a.innerHTML="<a name='"+o+"'></a><div name='"+o+"'></div>",s.insertBefore(a,s.firstChild);var b=r.getElementsByName&&r.getElementsByName(o).length===2+r.getElementsByName(o+0).length;return d=!r.getElementById(o),s.removeChild(a),b});try{x.call(s.childNodes,0)[0].nodeType}catch(bb){x=function(a){var b,c=[];for(;b=this[a];a++)c.push(b);return c}}bc.matches=function(a,b){return bc(a,null,null,b)},bc.matchesSelector=function(a,b){return bc(b,null,null,[a]).length>0},f=bc.getText=function(a){var b,c="",d=0,e=a.nodeType;if(e){if(e===1||e===9||e===11){if(typeof a.textContent=="string")return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=f(a)}else if(e===3||e===4)return a.nodeValue}else for(;b=a[d];d++)c+=f(b);return c},g=bc.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?b.nodeName!=="HTML":!1},h=bc.contains=s.contains?function(a,b){var c=a.nodeType===9?a.documentElement:a,d=b&&b.parentNode;return a===d||!!(d&&d.nodeType===1&&c.contains&&c.contains(d))}:s.compareDocumentPosition?function(a,b){return b&&!!(a.compareDocumentPosition(b)&16)}:function(a,b){while(b=b.parentNode)if(b===a)return!0;return!1},bc.attr=function(a,b){var c,d=g(a);return d||(b=b.toLowerCase()),(c=e.attrHandle[b])?c(a):d||$?a.getAttribute(b):(c=a.getAttributeNode(b),c?typeof a[b]=="boolean"?a[b]?b:null:c.specified?c.value:null:null)},e=bc.selectors={cacheLength:50,createPseudo:z,match:W,attrHandle:Z?{}:{href:function(a){return a.getAttribute("href",2)},type:function(a){return a.getAttribute("type")}},find:{ID:d?function(a,b,c){if(typeof b.getElementById!==n&&!c){var d=b.getElementById(a);return d&&d.parentNode?[d]:[]}}:function(a,c,d){if(typeof c.getElementById!==n&&!d){var e=c.getElementById(a);return e?e.id===a||typeof e.getAttributeNode!==n&&e.getAttributeNode("id").value===a?[e]:b:[]}},TAG:Y?function(a,b){if(typeof b.getElementsByTagName!==n)return b.getElementsByTagName(a)}:function(a,b){var c=b.getElementsByTagName(a);if(a==="*"){var d,e=[],f=0;for(;d=c[f];f++)d.nodeType===1&&e.push(d);return e}return c},NAME:ba&&function(a,b){if(typeof b.getElementsByName!==n)return b.getElementsByName(name)},CLASS:_&&function(a,b,c){if(typeof b.getElementsByClassName!==n&&!c)return b.getElementsByClassName(a)}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(V,""),a[3]=(a[4]||a[5]||"").replace(V,""),a[2]==="~="&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),a[1]==="nth"?(a[2]||bc.error(a[0]),a[3]=+(a[3]?a[4]+(a[5]||1):2*(a[2]==="even"||a[2]==="odd")),a[4]=+(a[6]+a[7]||a[2]==="odd")):a[2]&&bc.error(a[0]),a},PSEUDO:function(a){var b,c;if(W.CHILD.test(a[0]))return null;if(a[3])a[2]=a[3];else if(b=a[4])O.test(b)&&(c=bh(b,!0))&&(c=b.indexOf(")",b.length-c)-b.length)&&(b=b.slice(0,c),a[0]=a[0].slice(0,c)),a[2]=b;return a.slice(0,3)}},filter:{ID:d?function(a){return a=a.replace(V,""),function(b){return b.getAttribute("id")===a}}:function(a){return a=a.replace(V,""),function(b){var c=typeof b.getAttributeNode!==n&&b.getAttributeNode("id");return c&&c.value===a}},TAG:function(a){return a==="*"?function(){return!0}:(a=a.replace(V,"").toLowerCase(),function(b){return b.nodeName&&b.nodeName.toLowerCase()===a})},CLASS:function(a){var b=B[o][a];return b||(b=B(a,new RegExp("(^|"+E+")"+a+"("+E+"|$)"))),function(a){return b.test(a.className||typeof a.getAttribute!==n&&a.getAttribute("class")||"")}},ATTR:function(a,b,c){return function(d,e){var f=bc.attr(d,a);return f==null?b==="!=":b?(f+="",b==="="?f===c:b==="!="?f!==c:b==="^="?c&&f.indexOf(c)===0:b==="*="?c&&f.indexOf(c)>-1:b==="$="?c&&f.substr(f.length-c.length)===c:b==="~="?(" "+f+" ").indexOf(c)>-1:b==="|="?f===c||f.substr(0,c.length+1)===c+"-":!1):!0}},CHILD:function(a,b,c,d){return a==="nth"?function(a){var b,e,f=a.parentNode;if(c===1&&d===0)return!0;if(f){e=0;for(b=f.firstChild;b;b=b.nextSibling)if(b.nodeType===1){e++;if(a===b)break}}return e-=d,e===c||e%c===0&&e/c>=0}:function(b){var c=b;switch(a){case"only":case"first":while(c=c.previousSibling)if(c.nodeType===1)return!1;if(a==="first")return!0;c=b;case"last":while(c=c.nextSibling)if(c.nodeType===1)return!1;return!0}}},PSEUDO:function(a,b){var c,d=e.pseudos[a]||e.setFilters[a.toLowerCase()]||bc.error("unsupported pseudo: "+a);return d[o]?d(b):d.length>1?(c=[a,a,"",b],e.setFilters.hasOwnProperty(a.toLowerCase())?z(function(a,c){var e,f=d(a,b),g=f.length;while(g--)e=y.call(a,f[g]),a[e]=!(c[e]=f[g])}):function(a){return d(a,0,c)}):d}},pseudos:{not:z(function(a){var b=[],c=[],d=i(a.replace(L,"$1"));return d[o]?z(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--)if(f=g[h])a[h]=!(b[h]=f)}):function(a,e,f){return b[0]=a,d(b,null,f,c),!c.pop()}}),has:z(function(a){return function(b){return bc(a,b).length>0}}),contains:z(function(a){return function(b){return(b.textContent||b.innerText||f(b)).indexOf(a)>-1}}),enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&!!a.checked||b==="option"&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},parent:function(a){return!e.pseudos.empty(a)},empty:function(a){var b;a=a.firstChild;while(a){if(a.nodeName>"@"||(b=a.nodeType)===3||b===4)return!1;a=a.nextSibling}return!0},header:function(a){return T.test(a.nodeName)},text:function(a){var b,c;return a.nodeName.toLowerCase()==="input"&&(b=a.type)==="text"&&((c=a.getAttribute("type"))==null||c.toLowerCase()===b)},radio:bd("radio"),checkbox:bd("checkbox"),file:bd("file"),password:bd("password"),image:bd("image"),submit:be("submit"),reset:be("reset"),button:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&a.type==="button"||b==="button"},input:function(a){return U.test(a.nodeName)},focus:function(a){var b=a.ownerDocument;return a===b.activeElement&&(!b.hasFocus||b.hasFocus())&&(!!a.type||!!a.href)},active:function(a){return a===a.ownerDocument.activeElement},first:bf(function(a,b,c){return[0]}),last:bf(function(a,b,c){return[b-1]}),eq:bf(function(a,b,c){return[c<0?c+b:c]}),even:bf(function(a,b,c){for(var d=0;d<b;d+=2)a.push(d);return a}),odd:bf(function(a,b,c){for(var d=1;d<b;d+=2)a.push(d);return a}),lt:bf(function(a,b,c){for(var d=c<0?c+b:c;--d>=0;)a.push(d);return a}),gt:bf(function(a,b,c){for(var d=c<0?c+b:c;++d<b;)a.push(d);return a})}},j=s.compareDocumentPosition?function(a,b){return a===b?(k=!0,0):(!a.compareDocumentPosition||!b.compareDocumentPosition?a.compareDocumentPosition:a.compareDocumentPosition(b)&4)?-1:1}:function(a,b){if(a===b)return k=!0,0;if(a.sourceIndex&&b.sourceIndex)return a.sourceIndex-b.sourceIndex;var c,d,e=[],f=[],g=a.parentNode,h=b.parentNode,i=g;if(g===h)return bg(a,b);if(!g)return-1;if(!h)return 1;while(i)e.unshift(i),i=i.parentNode;i=h;while(i)f.unshift(i),i=i.parentNode;c=e.length,d=f.length;for(var j=0;j<c&&j<d;j++)if(e[j]!==f[j])return bg(e[j],f[j]);return j===c?bg(a,f[j],-1):bg(e[j],b,1)},[0,0].sort(j),m=!k,bc.uniqueSort=function(a){var b,c=1;k=m,a.sort(j);if(k)for(;b=a[c];c++)b===a[c-1]&&a.splice(c--,1);return a},bc.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},i=bc.compile=function(a,b){var c,d=[],e=[],f=D[o][a];if(!f){b||(b=bh(a)),c=b.length;while(c--)f=bm(b[c]),f[o]?d.push(f):e.push(f);f=D(a,bn(e,d))}return f},r.querySelectorAll&&function(){var a,b=bp,c=/'|\\/g,d=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,e=[":focus"],f=[":active",":focus"],h=s.matchesSelector||s.mozMatchesSelector||s.webkitMatchesSelector||s.oMatchesSelector||s.msMatchesSelector;X(function(a){a.innerHTML="<select><option selected=''></option></select>",a.querySelectorAll("[selected]").length||e.push("\\["+E+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),a.querySelectorAll(":checked").length||e.push(":checked")}),X(function(a){a.innerHTML="<p test=''></p>",a.querySelectorAll("[test^='']").length&&e.push("[*^$]="+E+"*(?:\"\"|'')"),a.innerHTML="<input type='hidden'/>",a.querySelectorAll(":enabled").length||e.push(":enabled",":disabled")}),e=new RegExp(e.join("|")),bp=function(a,d,f,g,h){if(!g&&!h&&(!e||!e.test(a))){var i,j,k=!0,l=o,m=d,n=d.nodeType===9&&a;if(d.nodeType===1&&d.nodeName.toLowerCase()!=="object"){i=bh(a),(k=d.getAttribute("id"))?l=k.replace(c,"\\$&"):d.setAttribute("id",l),l="[id='"+l+"'] ",j=i.length;while(j--)i[j]=l+i[j].join("");m=R.test(a)&&d.parentNode||d,n=i.join(",")}if(n)try{return w.apply(f,x.call(m.querySelectorAll(n),0)),f}catch(p){}finally{k||d.removeAttribute("id")}}return b(a,d,f,g,h)},h&&(X(function(b){a=h.call(b,"div");try{h.call(b,"[test!='']:sizzle"),f.push("!=",J)}catch(c){}}),f=new RegExp(f.join("|")),bc.matchesSelector=function(b,c){c=c.replace(d,"='$1']");if(!g(b)&&!f.test(c)&&(!e||!e.test(c)))try{var i=h.call(b,c);if(i||a||b.document&&b.document.nodeType!==11)return i}catch(j){}return bc(c,null,null,[b]).length>0})}(),e.pseudos.nth=e.pseudos.eq,e.filters=bq.prototype=e.pseudos,e.setFilters=new bq,bc.attr=p.attr,p.find=bc,p.expr=bc.selectors,p.expr[":"]=p.expr.pseudos,p.unique=bc.uniqueSort,p.text=bc.getText,p.isXMLDoc=bc.isXML,p.contains=bc.contains}(a);var bc=/Until$/,bd=/^(?:parents|prev(?:Until|All))/,be=/^.[^:#\[\.,]*$/,bf=p.expr.match.needsContext,bg={children:!0,contents:!0,next:!0,prev:!0};p.fn.extend({find:function(a){var b,c,d,e,f,g,h=this;if(typeof a!="string")return p(a).filter(function(){for(b=0,c=h.length;b<c;b++)if(p.contains(h[b],this))return!0});g=this.pushStack("","find",a);for(b=0,c=this.length;b<c;b++){d=g.length,p.find(a,this[b],g);if(b>0)for(e=d;e<g.length;e++)for(f=0;f<d;f++)if(g[f]===g[e]){g.splice(e--,1);break}}return g},has:function(a){var b,c=p(a,this),d=c.length;return this.filter(function(){for(b=0;b<d;b++)if(p.contains(this,c[b]))return!0})},not:function(a){return this.pushStack(bj(this,a,!1),"not",a)},filter:function(a){return this.pushStack(bj(this,a,!0),"filter",a)},is:function(a){return!!a&&(typeof a=="string"?bf.test(a)?p(a,this.context).index(this[0])>=0:p.filter(a,this).length>0:this.filter(a).length>0)},closest:function(a,b){var c,d=0,e=this.length,f=[],g=bf.test(a)||typeof a!="string"?p(a,b||this.context):0;for(;d<e;d++){c=this[d];while(c&&c.ownerDocument&&c!==b&&c.nodeType!==11){if(g?g.index(c)>-1:p.find.matchesSelector(c,a)){f.push(c);break}c=c.parentNode}}return f=f.length>1?p.unique(f):f,this.pushStack(f,"closest",a)},index:function(a){return a?typeof a=="string"?p.inArray(this[0],p(a)):p.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(a,b){var c=typeof a=="string"?p(a,b):p.makeArray(a&&a.nodeType?[a]:a),d=p.merge(this.get(),c);return this.pushStack(bh(c[0])||bh(d[0])?d:p.unique(d))},addBack:function(a){return this.add(a==null?this.prevObject:this.prevObject.filter(a))}}),p.fn.andSelf=p.fn.addBack,p.each({parent:function(a){var b=a.parentNode;return b&&b.nodeType!==11?b:null},parents:function(a){return p.dir(a,"parentNode")},parentsUntil:function(a,b,c){return p.dir(a,"parentNode",c)},next:function(a){return bi(a,"nextSibling")},prev:function(a){return bi(a,"previousSibling")},nextAll:function(a){return p.dir(a,"nextSibling")},prevAll:function(a){return p.dir(a,"previousSibling")},nextUntil:function(a,b,c){return p.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return p.dir(a,"previousSibling",c)},siblings:function(a){return p.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return p.sibling(a.firstChild)},contents:function(a){return p.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:p.merge([],a.childNodes)}},function(a,b){p.fn[a]=function(c,d){var e=p.map(this,b,c);return bc.test(a)||(d=c),d&&typeof d=="string"&&(e=p.filter(d,e)),e=this.length>1&&!bg[a]?p.unique(e):e,this.length>1&&bd.test(a)&&(e=e.reverse()),this.pushStack(e,a,k.call(arguments).join(","))}}),p.extend({filter:function(a,b,c){return c&&(a=":not("+a+")"),b.length===1?p.find.matchesSelector(b[0],a)?[b[0]]:[]:p.find.matches(a,b)},dir:function(a,c,d){var e=[],f=a[c];while(f&&f.nodeType!==9&&(d===b||f.nodeType!==1||!p(f).is(d)))f.nodeType===1&&e.push(f),f=f[c];return e},sibling:function(a,b){var c=[];for(;a;a=a.nextSibling)a.nodeType===1&&a!==b&&c.push(a);return c}});var bl="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",bm=/ jQuery\d+="(?:null|\d+)"/g,bn=/^\s+/,bo=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bp=/<([\w:]+)/,bq=/<tbody/i,br=/<|&#?\w+;/,bs=/<(?:script|style|link)/i,bt=/<(?:script|object|embed|option|style)/i,bu=new RegExp("<(?:"+bl+")[\\s/>]","i"),bv=/^(?:checkbox|radio)$/,bw=/checked\s*(?:[^=]|=\s*.checked.)/i,bx=/\/(java|ecma)script/i,by=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,bz={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},bA=bk(e),bB=bA.appendChild(e.createElement("div"));bz.optgroup=bz.option,bz.tbody=bz.tfoot=bz.colgroup=bz.caption=bz.thead,bz.th=bz.td,p.support.htmlSerialize||(bz._default=[1,"X<div>","</div>"]),p.fn.extend({text:function(a){return p.access(this,function(a){return a===b?p.text(this):this.empty().append((this[0]&&this[0].ownerDocument||e).createTextNode(a))},null,a,arguments.length)},wrapAll:function(a){if(p.isFunction(a))return this.each(function(b){p(this).wrapAll(a.call(this,b))});if(this[0]){var b=p(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&a.firstChild.nodeType===1)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return p.isFunction(a)?this.each(function(b){p(this).wrapInner(a.call(this,b))}):this.each(function(){var b=p(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=p.isFunction(a);return this.each(function(c){p(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){p.nodeName(this,"body")||p(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){(this.nodeType===1||this.nodeType===11)&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,!0,function(a){(this.nodeType===1||this.nodeType===11)&&this.insertBefore(a,this.firstChild)})},before:function(){if(!bh(this[0]))return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)});if(arguments.length){var a=p.clean(arguments);return this.pushStack(p.merge(a,this),"before",this.selector)}},after:function(){if(!bh(this[0]))return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)});if(arguments.length){var a=p.clean(arguments);return this.pushStack(p.merge(this,a),"after",this.selector)}},remove:function(a,b){var c,d=0;for(;(c=this[d])!=null;d++)if(!a||p.filter(a,[c]).length)!b&&c.nodeType===1&&(p.cleanData(c.getElementsByTagName("*")),p.cleanData([c])),c.parentNode&&c.parentNode.removeChild(c);return this},empty:function(){var a,b=0;for(;(a=this[b])!=null;b++){a.nodeType===1&&p.cleanData(a.getElementsByTagName("*"));while(a.firstChild)a.removeChild(a.firstChild)}return this},clone:function(a,b){return a=a==null?!1:a,b=b==null?a:b,this.map(function(){return p.clone(this,a,b)})},html:function(a){return p.access(this,function(a){var c=this[0]||{},d=0,e=this.length;if(a===b)return c.nodeType===1?c.innerHTML.replace(bm,""):b;if(typeof a=="string"&&!bs.test(a)&&(p.support.htmlSerialize||!bu.test(a))&&(p.support.leadingWhitespace||!bn.test(a))&&!bz[(bp.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(bo,"<$1></$2>");try{for(;d<e;d++)c=this[d]||{},c.nodeType===1&&(p.cleanData(c.getElementsByTagName("*")),c.innerHTML=a);c=0}catch(f){}}c&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(a){return bh(this[0])?this.length?this.pushStack(p(p.isFunction(a)?a():a),"replaceWith",a):this:p.isFunction(a)?this.each(function(b){var c=p(this),d=c.html();c.replaceWith(a.call(this,b,d))}):(typeof a!="string"&&(a=p(a).detach()),this.each(function(){var b=this.nextSibling,c=this.parentNode;p(this).remove(),b?p(b).before(a):p(c).append(a)}))},detach:function(a){return this.remove(a,!0)},domManip:function(a,c,d){a=[].concat.apply([],a);var e,f,g,h,i=0,j=a[0],k=[],l=this.length;if(!p.support.checkClone&&l>1&&typeof j=="string"&&bw.test(j))return this.each(function(){p(this).domManip(a,c,d)});if(p.isFunction(j))return this.each(function(e){var f=p(this);a[0]=j.call(this,e,c?f.html():b),f.domManip(a,c,d)});if(this[0]){e=p.buildFragment(a,this,k),g=e.fragment,f=g.firstChild,g.childNodes.length===1&&(g=f);if(f){c=c&&p.nodeName(f,"tr");for(h=e.cacheable||l-1;i<l;i++)d.call(c&&p.nodeName(this[i],"table")?bC(this[i],"tbody"):this[i],i===h?g:p.clone(g,!0,!0))}g=f=null,k.length&&p.each(k,function(a,b){b.src?p.ajax?p.ajax({url:b.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):p.error("no ajax"):p.globalEval((b.text||b.textContent||b.innerHTML||"").replace(by,"")),b.parentNode&&b.parentNode.removeChild(b)})}return this}}),p.buildFragment=function(a,c,d){var f,g,h,i=a[0];return c=c||e,c=!c.nodeType&&c[0]||c,c=c.ownerDocument||c,a.length===1&&typeof i=="string"&&i.length<512&&c===e&&i.charAt(0)==="<"&&!bt.test(i)&&(p.support.checkClone||!bw.test(i))&&(p.support.html5Clone||!bu.test(i))&&(g=!0,f=p.fragments[i],h=f!==b),f||(f=c.createDocumentFragment(),p.clean(a,c,f,d),g&&(p.fragments[i]=h&&f)),{fragment:f,cacheable:g}},p.fragments={},p.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){p.fn[a]=function(c){var d,e=0,f=[],g=p(c),h=g.length,i=this.length===1&&this[0].parentNode;if((i==null||i&&i.nodeType===11&&i.childNodes.length===1)&&h===1)return g[b](this[0]),this;for(;e<h;e++)d=(e>0?this.clone(!0):this).get(),p(g[e])[b](d),f=f.concat(d);return this.pushStack(f,a,g.selector)}}),p.extend({clone:function(a,b,c){var d,e,f,g;p.support.html5Clone||p.isXMLDoc(a)||!bu.test("<"+a.nodeName+">")?g=a.cloneNode(!0):(bB.innerHTML=a.outerHTML,bB.removeChild(g=bB.firstChild));if((!p.support.noCloneEvent||!p.support.noCloneChecked)&&(a.nodeType===1||a.nodeType===11)&&!p.isXMLDoc(a)){bE(a,g),d=bF(a),e=bF(g);for(f=0;d[f];++f)e[f]&&bE(d[f],e[f])}if(b){bD(a,g);if(c){d=bF(a),e=bF(g);for(f=0;d[f];++f)bD(d[f],e[f])}}return d=e=null,g},clean:function(a,b,c,d){var f,g,h,i,j,k,l,m,n,o,q,r,s=b===e&&bA,t=[];if(!b||typeof b.createDocumentFragment=="undefined")b=e;for(f=0;(h=a[f])!=null;f++){typeof h=="number"&&(h+="");if(!h)continue;if(typeof h=="string")if(!br.test(h))h=b.createTextNode(h);else{s=s||bk(b),l=b.createElement("div"),s.appendChild(l),h=h.replace(bo,"<$1></$2>"),i=(bp.exec(h)||["",""])[1].toLowerCase(),j=bz[i]||bz._default,k=j[0],l.innerHTML=j[1]+h+j[2];while(k--)l=l.lastChild;if(!p.support.tbody){m=bq.test(h),n=i==="table"&&!m?l.firstChild&&l.firstChild.childNodes:j[1]==="<table>"&&!m?l.childNodes:[];for(g=n.length-1;g>=0;--g)p.nodeName(n[g],"tbody")&&!n[g].childNodes.length&&n[g].parentNode.removeChild(n[g])}!p.support.leadingWhitespace&&bn.test(h)&&l.insertBefore(b.createTextNode(bn.exec(h)[0]),l.firstChild),h=l.childNodes,l.parentNode.removeChild(l)}h.nodeType?t.push(h):p.merge(t,h)}l&&(h=l=s=null);if(!p.support.appendChecked)for(f=0;(h=t[f])!=null;f++)p.nodeName(h,"input")?bG(h):typeof h.getElementsByTagName!="undefined"&&p.grep(h.getElementsByTagName("input"),bG);if(c){q=function(a){if(!a.type||bx.test(a.type))return d?d.push(a.parentNode?a.parentNode.removeChild(a):a):c.appendChild(a)};for(f=0;(h=t[f])!=null;f++)if(!p.nodeName(h,"script")||!q(h))c.appendChild(h),typeof h.getElementsByTagName!="undefined"&&(r=p.grep(p.merge([],h.getElementsByTagName("script")),q),t.splice.apply(t,[f+1,0].concat(r)),f+=r.length)}return t},cleanData:function(a,b){var c,d,e,f,g=0,h=p.expando,i=p.cache,j=p.support.deleteExpando,k=p.event.special;for(;(e=a[g])!=null;g++)if(b||p.acceptData(e)){d=e[h],c=d&&i[d];if(c){if(c.events)for(f in c.events)k[f]?p.event.remove(e,f):p.removeEvent(e,f,c.handle);i[d]&&(delete i[d],j?delete e[h]:e.removeAttribute?e.removeAttribute(h):e[h]=null,p.deletedIds.push(d))}}}}),function(){var a,b;p.uaMatch=function(a){a=a.toLowerCase();var b=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},a=p.uaMatch(g.userAgent),b={},a.browser&&(b[a.browser]=!0,b.version=a.version),b.chrome?b.webkit=!0:b.webkit&&(b.safari=!0),p.browser=b,p.sub=function(){function a(b,c){return new a.fn.init(b,c)}p.extend(!0,a,this),a.superclass=this,a.fn=a.prototype=this(),a.fn.constructor=a,a.sub=this.sub,a.fn.init=function c(c,d){return d&&d instanceof p&&!(d instanceof a)&&(d=a(d)),p.fn.init.call(this,c,d,b)},a.fn.init.prototype=a.fn;var b=a(e);return a}}();var bH,bI,bJ,bK=/alpha\([^)]*\)/i,bL=/opacity=([^)]*)/,bM=/^(top|right|bottom|left)$/,bN=/^(none|table(?!-c[ea]).+)/,bO=/^margin/,bP=new RegExp("^("+q+")(.*)$","i"),bQ=new RegExp("^("+q+")(?!px)[a-z%]+$","i"),bR=new RegExp("^([-+])=("+q+")","i"),bS={},bT={position:"absolute",visibility:"hidden",display:"block"},bU={letterSpacing:0,fontWeight:400},bV=["Top","Right","Bottom","Left"],bW=["Webkit","O","Moz","ms"],bX=p.fn.toggle;p.fn.extend({css:function(a,c){return p.access(this,function(a,c,d){return d!==b?p.style(a,c,d):p.css(a,c)},a,c,arguments.length>1)},show:function(){return b$(this,!0)},hide:function(){return b$(this)},toggle:function(a,b){var c=typeof a=="boolean";return p.isFunction(a)&&p.isFunction(b)?bX.apply(this,arguments):this.each(function(){(c?a:bZ(this))?p(this).show():p(this).hide()})}}),p.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=bH(a,"opacity");return c===""?"1":c}}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":p.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(!a||a.nodeType===3||a.nodeType===8||!a.style)return;var f,g,h,i=p.camelCase(c),j=a.style;c=p.cssProps[i]||(p.cssProps[i]=bY(j,i)),h=p.cssHooks[c]||p.cssHooks[i];if(d===b)return h&&"get"in h&&(f=h.get(a,!1,e))!==b?f:j[c];g=typeof d,g==="string"&&(f=bR.exec(d))&&(d=(f[1]+1)*f[2]+parseFloat(p.css(a,c)),g="number");if(d==null||g==="number"&&isNaN(d))return;g==="number"&&!p.cssNumber[i]&&(d+="px");if(!h||!("set"in h)||(d=h.set(a,d,e))!==b)try{j[c]=d}catch(k){}},css:function(a,c,d,e){var f,g,h,i=p.camelCase(c);return c=p.cssProps[i]||(p.cssProps[i]=bY(a.style,i)),h=p.cssHooks[c]||p.cssHooks[i],h&&"get"in h&&(f=h.get(a,!0,e)),f===b&&(f=bH(a,c)),f==="normal"&&c in bU&&(f=bU[c]),d||e!==b?(g=parseFloat(f),d||p.isNumeric(g)?g||0:f):f},swap:function(a,b,c){var d,e,f={};for(e in b)f[e]=a.style[e],a.style[e]=b[e];d=c.call(a);for(e in b)a.style[e]=f[e];return d}}),a.getComputedStyle?bH=function(b,c){var d,e,f,g,h=a.getComputedStyle(b,null),i=b.style;return h&&(d=h[c],d===""&&!p.contains(b.ownerDocument,b)&&(d=p.style(b,c)),bQ.test(d)&&bO.test(c)&&(e=i.width,f=i.minWidth,g=i.maxWidth,i.minWidth=i.maxWidth=i.width=d,d=h.width,i.width=e,i.minWidth=f,i.maxWidth=g)),d}:e.documentElement.currentStyle&&(bH=function(a,b){var c,d,e=a.currentStyle&&a.currentStyle[b],f=a.style;return e==null&&f&&f[b]&&(e=f[b]),bQ.test(e)&&!bM.test(b)&&(c=f.left,d=a.runtimeStyle&&a.runtimeStyle.left,d&&(a.runtimeStyle.left=a.currentStyle.left),f.left=b==="fontSize"?"1em":e,e=f.pixelLeft+"px",f.left=c,d&&(a.runtimeStyle.left=d)),e===""?"auto":e}),p.each(["height","width"],function(a,b){p.cssHooks[b]={get:function(a,c,d){if(c)return a.offsetWidth===0&&bN.test(bH(a,"display"))?p.swap(a,bT,function(){return cb(a,b,d)}):cb(a,b,d)},set:function(a,c,d){return b_(a,c,d?ca(a,b,d,p.support.boxSizing&&p.css(a,"boxSizing")==="border-box"):0)}}}),p.support.opacity||(p.cssHooks.opacity={get:function(a,b){return bL.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=p.isNumeric(b)?"alpha(opacity="+b*100+")":"",f=d&&d.filter||c.filter||"";c.zoom=1;if(b>=1&&p.trim(f.replace(bK,""))===""&&c.removeAttribute){c.removeAttribute("filter");if(d&&!d.filter)return}c.filter=bK.test(f)?f.replace(bK,e):f+" "+e}}),p(function(){p.support.reliableMarginRight||(p.cssHooks.marginRight={get:function(a,b){return p.swap(a,{display:"inline-block"},function(){if(b)return bH(a,"marginRight")})}}),!p.support.pixelPosition&&p.fn.position&&p.each(["top","left"],function(a,b){p.cssHooks[b]={get:function(a,c){if(c){var d=bH(a,b);return bQ.test(d)?p(a).position()[b]+"px":d}}}})}),p.expr&&p.expr.filters&&(p.expr.filters.hidden=function(a){return a.offsetWidth===0&&a.offsetHeight===0||!p.support.reliableHiddenOffsets&&(a.style&&a.style.display||bH(a,"display"))==="none"},p.expr.filters.visible=function(a){return!p.expr.filters.hidden(a)}),p.each({margin:"",padding:"",border:"Width"},function(a,b){p.cssHooks[a+b]={expand:function(c){var d,e=typeof c=="string"?c.split(" "):[c],f={};for(d=0;d<4;d++)f[a+bV[d]+b]=e[d]||e[d-2]||e[0];return f}},bO.test(a)||(p.cssHooks[a+b].set=b_)});var cd=/%20/g,ce=/\[\]$/,cf=/\r?\n/g,cg=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,ch=/^(?:select|textarea)/i;p.fn.extend({serialize:function(){return p.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?p.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||ch.test(this.nodeName)||cg.test(this.type))}).map(function(a,b){var c=p(this).val();return c==null?null:p.isArray(c)?p.map(c,function(a,c){return{name:b.name,value:a.replace(cf,"\r\n")}}):{name:b.name,value:c.replace(cf,"\r\n")}}).get()}}),p.param=function(a,c){var d,e=[],f=function(a,b){b=p.isFunction(b)?b():b==null?"":b,e[e.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};c===b&&(c=p.ajaxSettings&&p.ajaxSettings.traditional);if(p.isArray(a)||a.jquery&&!p.isPlainObject(a))p.each(a,function(){f(this.name,this.value)});else for(d in a)ci(d,a[d],c,f);return e.join("&").replace(cd,"+")};var cj,ck,cl=/#.*$/,cm=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,cn=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,co=/^(?:GET|HEAD)$/,cp=/^\/\//,cq=/\?/,cr=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,cs=/([?&])_=[^&]*/,ct=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,cu=p.fn.load,cv={},cw={},cx=["*/"]+["*"];try{ck=f.href}catch(cy){ck=e.createElement("a"),ck.href="",ck=ck.href}cj=ct.exec(ck.toLowerCase())||[],p.fn.load=function(a,c,d){if(typeof a!="string"&&cu)return cu.apply(this,arguments);if(!this.length)return this;var e,f,g,h=this,i=a.indexOf(" ");return i>=0&&(e=a.slice(i,a.length),a=a.slice(0,i)),p.isFunction(c)?(d=c,c=b):c&&typeof c=="object"&&(f="POST"),p.ajax({url:a,type:f,dataType:"html",data:c,complete:function(a,b){d&&h.each(d,g||[a.responseText,b,a])}}).done(function(a){g=arguments,h.html(e?p("<div>").append(a.replace(cr,"")).find(e):a)}),this},p.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){p.fn[b]=function(a){return this.on(b,a)}}),p.each(["get","post"],function(a,c){p[c]=function(a,d,e,f){return p.isFunction(d)&&(f=f||e,e=d,d=b),p.ajax({type:c,url:a,data:d,success:e,dataType:f})}}),p.extend({getScript:function(a,c){return p.get(a,b,c,"script")},getJSON:function(a,b,c){return p.get(a,b,c,"json")},ajaxSetup:function(a,b){return b?cB(a,p.ajaxSettings):(b=a,a=p.ajaxSettings),cB(a,b),a},ajaxSettings:{url:ck,isLocal:cn.test(cj[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":cx},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":p.parseJSON,"text xml":p.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:cz(cv),ajaxTransport:cz(cw),ajax:function(a,c){function y(a,c,f,i){var k,s,t,u,w,y=c;if(v===2)return;v=2,h&&clearTimeout(h),g=b,e=i||"",x.readyState=a>0?4:0,f&&(u=cC(l,x,f));if(a>=200&&a<300||a===304)l.ifModified&&(w=x.getResponseHeader("Last-Modified"),w&&(p.lastModified[d]=w),w=x.getResponseHeader("Etag"),w&&(p.etag[d]=w)),a===304?(y="notmodified",k=!0):(k=cD(l,u),y=k.state,s=k.data,t=k.error,k=!t);else{t=y;if(!y||a)y="error",a<0&&(a=0)}x.status=a,x.statusText=(c||y)+"",k?o.resolveWith(m,[s,y,x]):o.rejectWith(m,[x,y,t]),x.statusCode(r),r=b,j&&n.trigger("ajax"+(k?"Success":"Error"),[x,l,k?s:t]),q.fireWith(m,[x,y]),j&&(n.trigger("ajaxComplete",[x,l]),--p.active||p.event.trigger("ajaxStop"))}typeof a=="object"&&(c=a,a=b),c=c||{};var d,e,f,g,h,i,j,k,l=p.ajaxSetup({},c),m=l.context||l,n=m!==l&&(m.nodeType||m instanceof p)?p(m):p.event,o=p.Deferred(),q=p.Callbacks("once memory"),r=l.statusCode||{},t={},u={},v=0,w="canceled",x={readyState:0,setRequestHeader:function(a,b){if(!v){var c=a.toLowerCase();a=u[c]=u[c]||a,t[a]=b}return this},getAllResponseHeaders:function(){return v===2?e:null},getResponseHeader:function(a){var c;if(v===2){if(!f){f={};while(c=cm.exec(e))f[c[1].toLowerCase()]=c[2]}c=f[a.toLowerCase()]}return c===b?null:c},overrideMimeType:function(a){return v||(l.mimeType=a),this},abort:function(a){return a=a||w,g&&g.abort(a),y(0,a),this}};o.promise(x),x.success=x.done,x.error=x.fail,x.complete=q.add,x.statusCode=function(a){if(a){var b;if(v<2)for(b in a)r[b]=[r[b],a[b]];else b=a[x.status],x.always(b)}return this},l.url=((a||l.url)+"").replace(cl,"").replace(cp,cj[1]+"//"),l.dataTypes=p.trim(l.dataType||"*").toLowerCase().split(s),l.crossDomain==null&&(i=ct.exec(l.url.toLowerCase())||!1,l.crossDomain=i&&i.join(":")+(i[3]?"":i[1]==="http:"?80:443)!==cj.join(":")+(cj[3]?"":cj[1]==="http:"?80:443)),l.data&&l.processData&&typeof l.data!="string"&&(l.data=p.param(l.data,l.traditional)),cA(cv,l,c,x);if(v===2)return x;j=l.global,l.type=l.type.toUpperCase(),l.hasContent=!co.test(l.type),j&&p.active++===0&&p.event.trigger("ajaxStart");if(!l.hasContent){l.data&&(l.url+=(cq.test(l.url)?"&":"?")+l.data,delete l.data),d=l.url;if(l.cache===!1){var z=p.now(),A=l.url.replace(cs,"$1_="+z);l.url=A+(A===l.url?(cq.test(l.url)?"&":"?")+"_="+z:"")}}(l.data&&l.hasContent&&l.contentType!==!1||c.contentType)&&x.setRequestHeader("Content-Type",l.contentType),l.ifModified&&(d=d||l.url,p.lastModified[d]&&x.setRequestHeader("If-Modified-Since",p.lastModified[d]),p.etag[d]&&x.setRequestHeader("If-None-Match",p.etag[d])),x.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+(l.dataTypes[0]!=="*"?", "+cx+"; q=0.01":""):l.accepts["*"]);for(k in l.headers)x.setRequestHeader(k,l.headers[k]);if(!l.beforeSend||l.beforeSend.call(m,x,l)!==!1&&v!==2){w="abort";for(k in{success:1,error:1,complete:1})x[k](l[k]);g=cA(cw,l,c,x);if(!g)y(-1,"No Transport");else{x.readyState=1,j&&n.trigger("ajaxSend",[x,l]),l.async&&l.timeout>0&&(h=setTimeout(function(){x.abort("timeout")},l.timeout));try{v=1,g.send(t,y)}catch(B){if(v<2)y(-1,B);else throw B}}return x}return x.abort()},active:0,lastModified:{},etag:{}});var cE=[],cF=/\?/,cG=/(=)\?(?=&|$)|\?\?/,cH=p.now();p.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=cE.pop()||p.expando+"_"+cH++;return this[a]=!0,a}}),p.ajaxPrefilter("json jsonp",function(c,d,e){var f,g,h,i=c.data,j=c.url,k=c.jsonp!==!1,l=k&&cG.test(j),m=k&&!l&&typeof i=="string"&&!(c.contentType||"").indexOf("application/x-www-form-urlencoded")&&cG.test(i);if(c.dataTypes[0]==="jsonp"||l||m)return f=c.jsonpCallback=p.isFunction(c.jsonpCallback)?c.jsonpCallback():c.jsonpCallback,g=a[f],l?c.url=j.replace(cG,"$1"+f):m?c.data=i.replace(cG,"$1"+f):k&&(c.url+=(cF.test(j)?"&":"?")+c.jsonp+"="+f),c.converters["script json"]=function(){return h||p.error(f+" was not called"),h[0]},c.dataTypes[0]="json",a[f]=function(){h=arguments},e.always(function(){a[f]=g,c[f]&&(c.jsonpCallback=d.jsonpCallback,cE.push(f)),h&&p.isFunction(g)&&g(h[0]),h=g=b}),"script"}),p.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){return p.globalEval(a),a}}}),p.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),p.ajaxTransport("script",function(a){if(a.crossDomain){var c,d=e.head||e.getElementsByTagName("head")[0]||e.documentElement;return{send:function(f,g){c=e.createElement("script"),c.async="async",a.scriptCharset&&(c.charset=a.scriptCharset),c.src=a.url,c.onload=c.onreadystatechange=function(a,e){if(e||!c.readyState||/loaded|complete/.test(c.readyState))c.onload=c.onreadystatechange=null,d&&c.parentNode&&d.removeChild(c),c=b,e||g(200,"success")},d.insertBefore(c,d.firstChild)},abort:function(){c&&c.onload(0,1)}}}});var cI,cJ=a.ActiveXObject?function(){for(var a in cI)cI[a](0,1)}:!1,cK=0;p.ajaxSettings.xhr=a.ActiveXObject?function(){return!this.isLocal&&cL()||cM()}:cL,function(a){p.extend(p.support,{ajax:!!a,cors:!!a&&"withCredentials"in a})}(p.ajaxSettings.xhr()),p.support.ajax&&p.ajaxTransport(function(c){if(!c.crossDomain||p.support.cors){var d;return{send:function(e,f){var g,h,i=c.xhr();c.username?i.open(c.type,c.url,c.async,c.username,c.password):i.open(c.type,c.url,c.async);if(c.xhrFields)for(h in c.xhrFields)i[h]=c.xhrFields[h];c.mimeType&&i.overrideMimeType&&i.overrideMimeType(c.mimeType),!c.crossDomain&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");try{for(h in e)i.setRequestHeader(h,e[h])}catch(j){}i.send(c.hasContent&&c.data||null),d=function(a,e){var h,j,k,l,m;try{if(d&&(e||i.readyState===4)){d=b,g&&(i.onreadystatechange=p.noop,cJ&&delete cI[g]);if(e)i.readyState!==4&&i.abort();else{h=i.status,k=i.getAllResponseHeaders(),l={},m=i.responseXML,m&&m.documentElement&&(l.xml=m);try{l.text=i.responseText}catch(a){}try{j=i.statusText}catch(n){j=""}!h&&c.isLocal&&!c.crossDomain?h=l.text?200:404:h===1223&&(h=204)}}}catch(o){e||f(-1,o)}l&&f(h,j,l,k)},c.async?i.readyState===4?setTimeout(d,0):(g=++cK,cJ&&(cI||(cI={},p(a).unload(cJ)),cI[g]=d),i.onreadystatechange=d):d()},abort:function(){d&&d(0,1)}}}});var cN,cO,cP=/^(?:toggle|show|hide)$/,cQ=new RegExp("^(?:([-+])=|)("+q+")([a-z%]*)$","i"),cR=/queueHooks$/,cS=[cY],cT={"*":[function(a,b){var c,d,e=this.createTween(a,b),f=cQ.exec(b),g=e.cur(),h=+g||0,i=1,j=20;if(f){c=+f[2],d=f[3]||(p.cssNumber[a]?"":"px");if(d!=="px"&&h){h=p.css(e.elem,a,!0)||c||1;do i=i||".5",h=h/i,p.style(e.elem,a,h+d);while(i!==(i=e.cur()/g)&&i!==1&&--j)}e.unit=d,e.start=h,e.end=f[1]?h+(f[1]+1)*c:c}return e}]};p.Animation=p.extend(cW,{tweener:function(a,b){p.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");var c,d=0,e=a.length;for(;d<e;d++)c=a[d],cT[c]=cT[c]||[],cT[c].unshift(b)},prefilter:function(a,b){b?cS.unshift(a):cS.push(a)}}),p.Tween=cZ,cZ.prototype={constructor:cZ,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(p.cssNumber[c]?"":"px")},cur:function(){var a=cZ.propHooks[this.prop];return a&&a.get?a.get(this):cZ.propHooks._default.get(this)},run:function(a){var b,c=cZ.propHooks[this.prop];return this.options.duration?this.pos=b=p.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):cZ.propHooks._default.set(this),this}},cZ.prototype.init.prototype=cZ.prototype,cZ.propHooks={_default:{get:function(a){var b;return a.elem[a.prop]==null||!!a.elem.style&&a.elem.style[a.prop]!=null?(b=p.css(a.elem,a.prop,!1,""),!b||b==="auto"?0:b):a.elem[a.prop]},set:function(a){p.fx.step[a.prop]?p.fx.step[a.prop](a):a.elem.style&&(a.elem.style[p.cssProps[a.prop]]!=null||p.cssHooks[a.prop])?p.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},cZ.propHooks.scrollTop=cZ.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},p.each(["toggle","show","hide"],function(a,b){var c=p.fn[b];p.fn[b]=function(d,e,f){return d==null||typeof d=="boolean"||!a&&p.isFunction(d)&&p.isFunction(e)?c.apply(this,arguments):this.animate(c$(b,!0),d,e,f)}}),p.fn.extend({fadeTo:function(a,b,c,d){return this.filter(bZ).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=p.isEmptyObject(a),f=p.speed(b,c,d),g=function(){var b=cW(this,p.extend({},a),f);e&&b.stop(!0)};return e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,c,d){var e=function(a){var b=a.stop;delete a.stop,b(d)};return typeof a!="string"&&(d=c,c=a,a=b),c&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,c=a!=null&&a+"queueHooks",f=p.timers,g=p._data(this);if(c)g[c]&&g[c].stop&&e(g[c]);else for(c in g)g[c]&&g[c].stop&&cR.test(c)&&e(g[c]);for(c=f.length;c--;)f[c].elem===this&&(a==null||f[c].queue===a)&&(f[c].anim.stop(d),b=!1,f.splice(c,1));(b||!d)&&p.dequeue(this,a)})}}),p.each({slideDown:c$("show"),slideUp:c$("hide"),slideToggle:c$("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){p.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),p.speed=function(a,b,c){var d=a&&typeof a=="object"?p.extend({},a):{complete:c||!c&&b||p.isFunction(a)&&a,duration:a,easing:c&&b||b&&!p.isFunction(b)&&b};d.duration=p.fx.off?0:typeof d.duration=="number"?d.duration:d.duration in p.fx.speeds?p.fx.speeds[d.duration]:p.fx.speeds._default;if(d.queue==null||d.queue===!0)d.queue="fx";return d.old=d.complete,d.complete=function(){p.isFunction(d.old)&&d.old.call(this),d.queue&&p.dequeue(this,d.queue)},d},p.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},p.timers=[],p.fx=cZ.prototype.init,p.fx.tick=function(){var a,b=p.timers,c=0;for(;c<b.length;c++)a=b[c],!a()&&b[c]===a&&b.splice(c--,1);b.length||p.fx.stop()},p.fx.timer=function(a){a()&&p.timers.push(a)&&!cO&&(cO=setInterval(p.fx.tick,p.fx.interval))},p.fx.interval=13,p.fx.stop=function(){clearInterval(cO),cO=null},p.fx.speeds={slow:600,fast:200,_default:400},p.fx.step={},p.expr&&p.expr.filters&&(p.expr.filters.animated=function(a){return p.grep(p.timers,function(b){return a===b.elem}).length});var c_=/^(?:body|html)$/i;p.fn.offset=function(a){if(arguments.length)return a===b?this:this.each(function(b){p.offset.setOffset(this,a,b)});var c,d,e,f,g,h,i,j={top:0,left:0},k=this[0],l=k&&k.ownerDocument;if(!l)return;return(d=l.body)===k?p.offset.bodyOffset(k):(c=l.documentElement,p.contains(c,k)?(typeof k.getBoundingClientRect!="undefined"&&(j=k.getBoundingClientRect()),e=da(l),f=c.clientTop||d.clientTop||0,g=c.clientLeft||d.clientLeft||0,h=e.pageYOffset||c.scrollTop,i=e.pageXOffset||c.scrollLeft,{top:j.top+h-f,left:j.left+i-g}):j)},p.offset={bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;return p.support.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat(p.css(a,"marginTop"))||0,c+=parseFloat(p.css(a,"marginLeft"))||0),{top:b,left:c}},setOffset:function(a,b,c){var d=p.css(a,"position");d==="static"&&(a.style.position="relative");var e=p(a),f=e.offset(),g=p.css(a,"top"),h=p.css(a,"left"),i=(d==="absolute"||d==="fixed")&&p.inArray("auto",[g,h])>-1,j={},k={},l,m;i?(k=e.position(),l=k.top,m=k.left):(l=parseFloat(g)||0,m=parseFloat(h)||0),p.isFunction(b)&&(b=b.call(a,c,f)),b.top!=null&&(j.top=b.top-f.top+l),b.left!=null&&(j.left=b.left-f.left+m),"using"in b?b.using.call(a,j):e.css(j)}},p.fn.extend({position:function(){if(!this[0])return;var a=this[0],b=this.offsetParent(),c=this.offset(),d=c_.test(b[0].nodeName)?{top:0,left:0}:b.offset();return c.top-=parseFloat(p.css(a,"marginTop"))||0,c.left-=parseFloat(p.css(a,"marginLeft"))||0,d.top+=parseFloat(p.css(b[0],"borderTopWidth"))||0,d.left+=parseFloat(p.css(b[0],"borderLeftWidth"))||0,{top:c.top-d.top,left:c.left-d.left}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||e.body;while(a&&!c_.test(a.nodeName)&&p.css(a,"position")==="static")a=a.offsetParent;return a||e.body})}}),p.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,c){var d=/Y/.test(c);p.fn[a]=function(e){return p.access(this,function(a,e,f){var g=da(a);if(f===b)return g?c in g?g[c]:g.document.documentElement[e]:a[e];g?g.scrollTo(d?p(g).scrollLeft():f,d?f:p(g).scrollTop()):a[e]=f},a,e,arguments.length,null)}}),p.each({Height:"height",Width:"width"},function(a,c){p.each({padding:"inner"+a,content:c,"":"outer"+a},function(d,e){p.fn[e]=function(e,f){var g=arguments.length&&(d||typeof e!="boolean"),h=d||(e===!0||f===!0?"margin":"border");return p.access(this,function(c,d,e){var f;return p.isWindow(c)?c.document.documentElement["client"+a]:c.nodeType===9?(f=c.documentElement,Math.max(c.body["scroll"+a],f["scroll"+a],c.body["offset"+a],f["offset"+a],f["client"+a])):e===b?p.css(c,d,e,h):p.style(c,d,e,h)},c,g?e:b,g,null)}})}),a.jQuery=a.$=p,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return p})})(window);
function runPinterest()
{
(function(n,o,p,m){var a=n[m.k]={w:n,d:o,n:p,a:m,s:{},f:function(){return{callback:[],get:function(b,c){var d=null;return d=typeof b[c]==="string"?b[c]:b.getAttribute(c)},getData:function(b,c){c=a.a.dataAttributePrefix+c;return a.f.get(b,c)},set:function(b,c,d){if(typeof b[c]==="string")b[c]=d;else b.setAttribute(c,d)},make:function(b){var c=false,d,e;for(d in b)if(b[d].hasOwnProperty){c=a.d.createElement(d);for(e in b[d])b[d][e].hasOwnProperty&&typeof b[d][e]==="string"&&a.f.set(c,e,b[d][e]);break}return c},
kill:function(b){if(typeof b==="string")b=a.d.getElementById(b);b&&b.parentNode&&b.parentNode.removeChild(b)},replace:function(b,c){b.parentNode.insertBefore(c,b);a.f.kill(b)},listen:function(b,c,d){if(typeof a.w.addEventListener!=="undefined")b.addEventListener(c,d,false);else typeof a.w.attachEvent!=="undefined"&&b.attachEvent("on"+c,d)},call:function(b,c){var d,e,f="?";d=a.f.callback.length;e=a.a.k+".f.callback["+d+"]";a.f.callback[d]=function(g){c(g,d);a.f.kill(e)};if(b.match(/\?/))f="&";a.d.b.appendChild(a.f.make({SCRIPT:{id:e,
type:"text/javascript",charset:"utf-8",src:b+f+"callback="+e}}))},debug:function(b){a.v.config.debug&&typeof a.w.console.log==="function"&&a.w.console.log(b)},presentation:function(){var b,c,d;b=a.f.make({STYLE:{type:"text/css"}});c=a.a.cdn[a.w.location.protocol]||a.a.cdn["http:"];d=a.a.rules.join("\n");d=d.replace(/\._/g,"."+m.k+"_");d=d.replace(/;/g,"!important;");d=d.replace(/_cdn/g,c);d=d.replace(/_rez/g,a.v.resolution);if(b.styleSheet)b.styleSheet.cssText=d;else b.appendChild(a.d.createTextNode(d));
a.d.h?a.d.h.appendChild(b):a.d.b.appendChild(b)},click:function(b){b=b||a.w.event;if((b=b.target?b.target.nodeType===3?b.target.parentNode:b.target:b.srcElement)&&b!==a.d.b){if(!a.f.getData(b,"log"))b=b.parentNode;var c=a.f.getData(b,"log");if(c&&b.href.match(/pinterest/)){if(!b.className.match(/hazClick/))b.className=b.className+" "+a.a.k+"_hazClick";a.f.log("&type="+c+"&href="+encodeURIComponent(b.href))}}},behavior:function(){a.f.listen(a.d.b,"click",a.f.click)},getPinCount:function(b){query="?url="+
b+"&ref="+encodeURIComponent(a.v.here)+"&source="+a.a.countSource;a.f.call(a.a.endpoint.count+query,a.f.ping.count)},prettyPinCount:function(b){if(b>999)b=b<1E6?~~(b/1E3)+"K+":b<1E9?~~(b/1E6)+"M+":"++";return b},tile:function(b,c){b.style.display="block";var d={height:a.a.tile.scale.height,width:a.a.tile.scale.width},e=a.f.getData(b,"scale-height");if(e&&e>=a.a.tile.scale.minHeight)d.height=parseInt(e);if((e=a.f.getData(b,"scale-width"))&&e>=a.a.tile.scale.minWidth)d.width=parseInt(e);e=a.f.getData(b,
"board-width")||b.offsetWidth;if(e>b.offsetWidth)e=b.offsetWidth;e=Math.floor(e/(d.width+a.a.tile.style.margin));if(e>a.a.tile.maxColumns)e=a.a.tile.maxColumns;if(e<a.a.tile.minColumns)return false;var f=a.f.make({SPAN:{className:a.a.k+"_embed_board_bd"}});f.style.height=d.height+"px";a.v.renderedWidth=e*(d.width+a.a.tile.style.margin)-a.a.tile.style.margin;f.style.width=a.v.renderedWidth+"px";for(var g=0,j=[],k=0,q=c.length;k<q;k+=1){var i=a.f.make({A:{className:a.a.k+"_embed_board_th",target:"_blank",
href:b.href}});a.f.set(i,a.a.dataAttributePrefix+"log","embed_board");var h={height:c[k].image_medium_size_pixels.height*(d.width/c[k].image_medium_size_pixels.width),width:d.width},l=a.f.make({IMG:{src:c[k].image_medium_url,nopin:"true",height:h.height,width:h.width,className:a.a.k+"_embed_board_img"}});l.style.height=h.height+"px";l.style.width=h.width+"px";l.style.marginTop=0-h.height/a.a.tile.style.margin+"px";if(h.height>d.height)h.height=d.height;i.appendChild(l);i.style.height=h.height+"px";
i.style.width=h.width+"px";j[g]||(j[g]=0);i.style.top=j[g]+"px";i.style.left=g*(d.width+a.a.tile.style.margin)+"px";j[g]=j[g]+h.height+a.a.tile.style.margin;i.appendChild(l);f.appendChild(i);g=(g+1)%e}return f},makeFooter:function(b,c){b=a.f.make({A:{className:a.a.k+"_embed_board_ft",href:b.href,target:"_blank"}});if(a.v.renderedWidth>a.a.tile.minWidthToShowAuxText)b.innerHTML="See On";a.f.set(b,a.a.dataAttributePrefix+"log",c);c=a.f.make({SPAN:{className:a.a.k+"_embed_board_ft_logo"}});b.appendChild(c);
return b},cssHook:function(b,c){if(b=a.f.getData(b,"css-hook"))c.className=c.className+" "+b},ping:{count:function(b,c){if(c=a.d.getElementById(a.a.k+"_pin_count_"+c)){a.f.debug("API replied with count: "+b.count);var d=c.parentNode,e=a.f.getData(d,"config");if(b.count===0)if(e==="above"){a.f.debug("Rendering zero count above.");c.className=a.a.k+"_pin_it_button_count";c.appendChild(a.d.createTextNode("0"))}else a.f.debug("Zero pin count not rendered to the side.");if(b.count>0){a.f.debug("Got "+
b.count+" pins for this page.");e=a.f.getData(d,"config");if(e==="above"||e==="beside"){a.f.debug("Rendering pin count "+e);c.className=a.a.k+"_pin_it_button_count";c.appendChild(a.d.createTextNode(a.f.prettyPinCount(b.count)))}else a.f.debug("No valid pin count position specified; not rendering.")}a.f.cssHook(d,c)}else a.f.debug("Pin It button container not found.")},pin:function(b,c){if((c=a.d.getElementById(a.a.k+"_"+c))&&b.data&&b.data[0]){a.f.debug("API replied with a pin");var d=a.f.make({SPAN:{className:a.a.k+
"_embed_pin"}});if(a.v.config.style!=="plain")d.className=d.className+" "+a.a.k+"_fancy";var e=a.f.make({A:{className:a.a.k+"_embed_pin_link",href:"http://pinterest.com/pin/"+b.data[0].id,target:"_blank"}}),f=a.f.make({IMG:{className:a.a.k+"_embed_pin_img",nopin:"true",src:b.data[0].image_medium_url}});e.appendChild(f);a.f.set(e,a.a.dataAttributePrefix+"log","embed_pin");d.appendChild(e);if(b.data[0].attribution){e=a.f.make({SPAN:{className:a.a.k+"_embed_pin_attrib"}});e.appendChild(a.f.make({IMG:{className:a.a.k+
"_embed_pin_attrib_icon",src:b.data[0].attribution.provider_favicon_url.replace(/\/api/,"")}}));e.appendChild(a.d.createTextNode("by "));e.appendChild(a.f.make({A:{className:a.a.k+"_embed_pin_attrib_author",innerHTML:b.data[0].attribution.author_name,href:b.data[0].attribution.author_url,target:"_blank"}}));d.appendChild(e)}d.appendChild(a.f.make({SPAN:{className:a.a.k+"_embed_pin_description",innerHTML:b.data[0].description||""}}));a.f.cssHook(c,d);a.f.replace(c,d)}},user:function(b,c){if((c=a.d.getElementById(a.a.k+
"_"+c))&&b.data&&b.data.pins&&b.data.pins.length){a.f.debug("API replied with a user");a.f.getData(c,"config");var d=a.f.make({SPAN:{className:a.a.k+"_embed_board"}});if(a.v.config.style!=="plain")d.className=d.className+" "+a.a.k+"_fancy";var e=a.f.make({SPAN:{className:a.a.k+"_embed_board_hd"}}),f=a.f.make({A:{log:"embed_user",className:a.a.k+"_embed_board_title",innerHTML:b.data.user.full_name,target:"_blank",href:c.href}});e.appendChild(f);d.appendChild(e);if(b=a.f.tile(c,b.data.pins)){d.appendChild(b);
c.href+="pins/";d.appendChild(a.f.makeFooter(c,"embed_user"));a.f.cssHook(c,d);a.f.replace(c,d)}}},board:function(b,c){if((c=a.d.getElementById(a.a.k+"_"+c))&&b.data&&b.data.pins&&b.data.pins.length){a.f.debug("API replied with a group of pins");a.f.getData(c,"config");var d=a.f.make({SPAN:{className:a.a.k+"_embed_board"}});if(a.v.config.style!=="plain")d.className=d.className+" "+a.a.k+"_fancy";var e=a.f.tile(c,b.data.pins),f=a.f.make({SPAN:{className:a.a.k+"_embed_board_hd"}}),g=a.f.make({A:{log:"embed_board",
className:a.a.k+"_embed_board_name",innerHTML:b.data.board.name,target:"_blank",href:c.href}});f.appendChild(g);if(a.v.renderedWidth>a.a.tile.minWidthToShowAuxText){b=a.f.make({A:{log:"embed_board",className:a.a.k+"_embed_board_author",innerHTML:b.data.user.full_name,target:"_blank",href:c.href}});f.appendChild(b)}else g.className=a.a.k+"_embed_board_title";d.appendChild(f);if(e){d.appendChild(e);d.appendChild(a.f.makeFooter(c,"embed_board"));a.f.cssHook(c,d);a.f.replace(c,d)}}}},render:{buttonBookmark:function(b){a.f.debug("build bookmarklet button");
var c=a.f.make({A:{href:b.href,className:a.a.k+"_pin_it_button"}});a.f.set(c,a.a.dataAttributePrefix+"log","button_pinit");var d=a.f.getData(b,"config");if(a.a.config.pinItCountPosition[d]===true){a.f.set(c,a.a.dataAttributePrefix+"config",d);c.className=c.className+" "+a.a.k+"_pin_it_"+d}else c.className=c.className+" "+a.a.k+"_pin_it_none";a.f.getPinCount(encodeURIComponent(a.v.here));c.onclick=function(){a.v.firstScript.parentNode.insertBefore(a.f.make({SCRIPT:{type:"text/javascript",charset:"utf-8",
src:a.a.endpoint.bookmark+"?r="+Math.random()*99999999}}),a.v.firstScript);return false};d=a.f.make({SPAN:{className:a.a.k+"_hidden",id:a.a.k+"_pin_count_"+a.f.callback.length,innerHTML:"<i></i>"}});c.appendChild(d);a.f.replace(b,c)},buttonPin:function(b){a.f.debug("build Pin It button");var c=a.f.make({A:{href:b.href,className:a.a.k+"_pin_it_button"}});a.f.set(c,a.a.dataAttributePrefix+"log","button_pinit");var d=a.f.getData(b,"config");if(a.a.config.pinItCountPosition[d]===true){a.f.set(c,a.a.dataAttributePrefix+
"config",d);c.className=c.className+" "+a.a.k+"_pin_it_"+d}else c.className=c.className+" "+a.a.k+"_pin_it_none";c.onclick=function(){a.w.open(this.href,"pin"+(new Date).getTime(),a.a.pop);return false};d=b.href.split("url=");if(d[1]){d=d[1].split("&")[0];var e=a.f.make({SPAN:{className:a.a.k+"_hidden",id:a.a.k+"_pin_count_"+a.f.callback.length,innerHTML:"<i></i>"}});c.appendChild(e);a.f.getPinCount(d);a.f.replace(b,c)}},buttonFollow:function(b){a.f.debug("build follow button");if(b.href.split("/")[3]){a.f.getData(b,
"config");var c=a.f.make({A:{target:"_pinterest",href:b.href,innerHTML:b.innerHTML,className:a.a.k+"_follow_me_button"}});c.appendChild(a.f.make({B:{}}));c.appendChild(a.f.make({I:{}}));a.f.set(c,a.a.dataAttributePrefix+"log","button_follow");a.f.replace(b,c)}},embedPin:function(b){a.f.debug("build embedded pin");(b=b.href.split("/")[4])&&parseInt(b)>0&&a.f.getPinsIn("pin","pins/info/",{pin_ids:b})},embedUser:function(b){a.f.debug("build embedded profile");(b=b.href.split("/")[3])&&a.f.getPinsIn("user",
b+"/pins/")},embedBoard:function(b){a.f.debug("build embedded board");var c=b.href.split("/")[3];b=b.href.split("/")[4];c&&b&&a.f.getPinsIn("board",c+"/"+b+"/pins/")}},getPinsIn:function(b,c,d){var e="",f="?",g;for(g in d)if(d[g].hasOwnProperty){e=e+f+g+"="+d[g];f="&"}a.f.call(a.a.endpoint[b]+c+e,a.f.ping[b])},build:function(b){if(typeof b!=="object"||b===null||!b.parentNode)b=a.d;var c=b.getElementsByTagName("A"),d,e=[];d=0;for(b=c.length;d<b;d+=1)e.push(c[d]);d=0;for(b=e.length;d<b;d+=1)if(e[d].href&&
e[d].href.match(a.a.myDomain)){c=a.f.getData(e[d],"do");if(!c&&e[d].href.match(/pin\/create\/button/)){c="buttonPin";var f=a.f.get(e[d],"count-layout"),g="none";if(f==="vertical")g="above";if(f==="horizontal")g="beside";a.f.set(e[d],"data-pin-config",g)}if(typeof a.f.render[c]==="function"){e[d].id=a.a.k+"_"+a.f.callback.length;a.f.render[c](e[d])}}},config:function(){var b=a.d.getElementsByTagName("SCRIPT"),c=b.length,d,e;e=false;a.v.firstScript=b[0];for(d=0;d<c;d+=1)if(a.a.me&&b[d]&&b[d].src&&b[d].src.match(a.a.me)){if(e===
false){for(e=0;e<a.a.configParam.length;e+=1)a.v.config[a.a.configParam[e]]=a.f.get(b[d],a.a.dataAttributePrefix+a.a.configParam[e]);e=true}a.f.kill(b[d])}if(c===1){a.v.firstScript=a.f.make({SCRIPT:{}});a.d.b.appendChild(a.v.firstScript)}if(typeof a.v.config.build==="string")a.w[a.v.config.build]=function(f){a.f.build(f)};if(a.v.config["do-not-log"]||a.a.doNotLog===true){a.v.doNotLog=true;a.f.debug("Host page or server has asked us not to log.")}else a.f.debug("Logging enabled.");if(a.v.doNotLog===
false){a.v.logUrl=a.a.endpoint.log+"?r="+Math.random()*999999;a.s.log=a.f.make({IFRAME:{src:a.v.logUrl,height:"0",width:"0",frameborder:"0",className:a.a.k+"_log"}});a.w.setTimeout(function(){a.d.b.appendChild(a.s.log);a.s.log.onload=function(){a.f.debug("Logging frame loaded");a.f.log("&type=pidget")}},1E3)}},log:function(b){if(a.v.doNotLog===false){var c=a.v.logUrl+"#via="+encodeURIComponent(a.v.here);if(a.v.config["do-not-track"])c+="&DNT=1";if(b)c+=b;a.s.log.src=c;a.f.debug("Logging ping: "+c)}},
init:function(){a.d.b=a.d.getElementsByTagName("BODY")[0];a.d.h=a.d.getElementsByTagName("HEAD")[0];a.v={doNotLog:false,resolution:1,here:a.d.URL.split("#")[0],config:{}};if(a.w.devicePixelRatio&&a.w.devicePixelRatio>=2)a.v.resolution=2;a.f.config();a.f.build();a.f.presentation();a.f.behavior()}}}()};a.f.init()})(window,document,navigator,{k:"PIN_"+(new Date).getTime(),doNotLog:false,myDomain:/^https?:\/\/pinterest\.com\//,me:/pinit.*?\.js$/,endpoint:{bookmark:"//assets.pinterest.com/js/pinmarklet.js",
count:"//partners-api.pinterest.com/v1/urls/count.json",pin:"//api.pinterest.com/v3/pidgets/",board:"//api.pinterest.com/v3/pidgets/boards/",user:"//api.pinterest.com/v3/pidgets/users/",log:"//assets.pinterest.com/pidget.html"},config:{pinItCountPosition:{none:true,above:true,beside:true}},countSource:6,dataAttributePrefix:"data-pin-",configParam:["build","do-not-track","do-not-log","debug","style"],pop:"status=no,resizable=yes,scrollbars=yes,personalbar=no,directories=no,location=no,toolbar=no,menubar=no,width=632,height=270,left=0,top=0",
cdn:{"https:":"https://s-passets.pinimg.com","http:":"http://passets.pinterest.com"},tile:{scale:{minWidth:60,minHeight:60,width:92,height:175},minWidthToShowAuxText:150,minContentWidth:120,minColumns:1,maxColumns:6,style:{margin:2,padding:10}},rules:["iframe._log: { position: absolute; bottom: -1px; left: -1px; height: 1px; width: 1px; }","a._pin_it_button {  background-image: url(_cdn/images/pidgets/bps_rez.png); background-repeat: none; background-size: 40px 60px; display: inline-block; height: 20px; margin: 0; position: relative; padding: 0; vertical-align: baseline; text-decoration: none; width: 40px; background-position: 0 -20px }",
"a._pin_it_button:hover { background-position: 0 0px}","a._pin_it_button:active, a._pin_it_button._hazClick { background-position: 0 -40px}","a._pin_it_button span._pin_it_button_count { position: absolute; color: #777; text-align: center;  }","a._pin_it_above span._pin_it_button_count { background: transparent url(_cdn/images/pidgets/fpa_rez.png) 0 0 no-repeat; background-size: 40px 29px; position: absolute; bottom: 21px; left: 0px; height: 29px; width: 40px; font: 12px Arial, Helvetica, sans-serif; line-height: 24px; }",
"a._pin_it_beside span._pin_it_button_count, a._pin_it_beside span._pin_it_button_count i { background-color: transparent; background-repeat: no-repeat; background-image: url(_cdn/images/pidgets/fpb_rez.png); }","a._pin_it_beside span._pin_it_button_count { padding: 0 3px 0 10px; background-size: 45px 20px; background-position: 0 0; position: absolute; top: 0; left: 41px; height: 20px; font: 10px Arial, Helvetica, sans-serif; line-height: 20px; }","a._pin_it_beside span._pin_it_button_count i { background-position: 100% 0; position: absolute; top: 0; right: -2px; height: 20px; width: 2px; }",
"a._pin_it_button._pin_it_above { margin-top: 20px; }","a._follow_me_button, a._follow_me_button i { background: transparent url(_cdn/images/pidgets/bfs1.png) 0 0 no-repeat }",'a._follow_me_button { color: #444; display: inline-block; font: bold normal normal 11px/20px "Helvetica Neue",helvetica,arial,san-serif; height: 20px; margin: 0; padding: 0; position: relative; text-decoration: none; text-indent: 19px; vertical-align: baseline;}',"a._follow_me_button:hover { background-position: 0 -20px}",
"a._follow_me_button:active  { background-position: 0 -40px}","a._follow_me_button b { position: absolute; top: 3px; left: 3px; height: 14px; width: 14px; background-size: 14px 14px; background-image: url(_cdn/images/pidgets/log_rez.png); }","a._follow_me_button i { position: absolute; top: 0; right: -4px; height: 20px; width: 4px; background-position: 100% 0px; }","a._follow_me_button:hover i { background-position: 100% -20px;  }","a._follow_me_button:active i { background-position: 100% -40px; }",
"span._embed_pin { display: inline-block; padding: 15px 0; text-align: center; width: 225px; }","span._embed_pin._fancy { background: #fff; box-shadow: 0 0 3px #aaa; border-radius: 3px; }","span._embed_pin a._embed_pin_link { display: block;  margin: 0 auto 10px; padding: 0; position: relative;  line-height: 0;}","span._embed_pin a._embed_pin_link img._embed_pin_img { box-shadow: 0 0 1px #aaa; margin: 0;}","span._embed_pin a._embed_pin_link img._embed_pin_video { left: 50%; margin-left: -25px; margin-top: -25px; position: absolute; top: 50%; }",
'span._embed_pin span._embed_pin_attrib, span._embed_pin span._embed_pin_description { display: block; font: normal 11px/14.85px "Helvetica Neue", arial, sans-serif; margin: 0 15px; text-align: left; }',"span._embed_pin span._embed_pin_attrib { color: #ad9c9c; margin-bottom: 10px; height: 16px; line-height: 16px;}","span._embed_pin span._embed_pin_attrib a._embed_pin_attrib_author { color: #ad9c9c; font-weight: bold; text-decoration: none; }","span._embed_pin span._embed_pin_attrib a._embed_pin_attrib_author:hover { text-decoration: underline; }",
"span._embed_pin span._embed_pin_attrib img._embed_pin_attrib_icon { margin: 0 5px 0 0; height: 16px; width: 16px; vertical-align: middle; display: inline-block; }","span._embed_board { display: inline-block; margin: 0; padding:10px 0; position: relative; text-align: center}","span._embed_board._fancy { background: #fff; box-shadow: 0 0 3px #aaa; border-radius: 3px; }","span._embed_board span._embed_board_hd { display: block; margin: 0 10px; padding: 0; line-height: 20px; height: 25px; position: relative;  }",
"span._embed_board span._embed_board_hd a { cursor: pointer; background: inherit; text-decoration: none; width: 48%; white-space: nowrap; position: absolute; top: 0; overflow: hidden;  text-overflow: ellipsis; }","span._embed_board span._embed_board_hd a:hover { text-decoration: none; background: inherit; }","span._embed_board span._embed_board_hd a:active { text-decoration: none; background: inherit; }","span._embed_board span._embed_board_hd a._embed_board_title { width: 100%; position: absolute; left: 0; text-align: left; font-family: Georgia; font-size: 16px; color:#2b1e1e;}",
"span._embed_board span._embed_board_hd a._embed_board_name { position: absolute; left: 0; text-align: left; font-family: Georgia; font-size: 16px; color:#2b1e1e;}","span._embed_board span._embed_board_hd a._embed_board_author { position: absolute; right: 0; text-align: right; font-family: Helvetica; font-size: 11px; color: #746d6a; font-weight: bold;}",'span._embed_board span._embed_board_hd a._embed_board_author::before { content:"by "; font-weight: normal; }',"span._embed_board span._embed_board_bd { display:block; margin: 0 10px; overflow: hidden; border-radius: 2px; position: relative; }",
"span._embed_board span._embed_board_bd a._embed_board_th { cursor: pointer; display: inline-block; position: absolute; overflow: hidden; }",'span._embed_board span._embed_board_bd a._embed_board_th::before { position: absolute; content:""; z-index: 2; top: 0; left: 0; right: 0; bottom: 0; box-shadow: inset 0 0 2px #888; }',"span._embed_board span._embed_board_bd a._embed_board_th img._embed_board_img { position: absolute; top: 50%; left: 0; }","a._embed_board_ft { text-shadow: 0 1px #fff; display: block; text-align: center; border: 1px solid #ccc; margin: 10px 10px 0; height: 31px; line-height: 30px;border-radius: 2px; text-decoration: none; font-family: Helvetica; font-weight: bold; font-size: 13px; color: #746d6a; background: #f4f4f4 url(_cdn/images/pidgets/board_button_link.png) 0 0 repeat-x}",
"a._embed_board_ft:hover { text-decoration: none; background: #fefefe url(_cdn/images/pidgets/board_button_hover.png) 0 0 repeat-x}","a._embed_board_ft:active { text-decoration: none; background: #e4e4e4 url(_cdn/images/pidgets/board_button_active.png) 0 0 repeat-x}","a._embed_board_ft span._embed_board_ft_logo { vertical-align: top; display: inline-block; margin-left: 2px; height: 30px; width: 66px; background: transparent url(_cdn/images/pidgets/board_button_logo.png) 50% 48% no-repeat; }","._hidden { display:none; }"]});

}
/**
 * jGestures: a jQuery plugin for gesture events
 * Copyright 2010-2011 Neue Digitale / Razorfish GmbH
 * Copyright 2011-2012, Razorfish GmbH
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * @copyright Razorfish GmbH
 * @author martin.krause@razorfish.de
 * @version 0.90-shake
 * @requires jQuery JavaScript Library v1.4.2 - http://jquery.com/- Copyright 2010, John Resig- Dual licensed under the MIT or GPL Version 2 licenses. http://jquery.org/license
 */
(function(c){c.jGestures={};c.jGestures.defaults={};c.jGestures.defaults.thresholdShake={requiredShakes:10,freezeShakes:100,frontback:{sensitivity:10},leftright:{sensitivity:10},updown:{sensitivity:10}};c.jGestures.defaults.thresholdPinchopen=0.05;c.jGestures.defaults.thresholdPinchmove=0.05;c.jGestures.defaults.thresholdPinch=0.05;c.jGestures.defaults.thresholdPinchclose=0.05;c.jGestures.defaults.thresholdRotatecw=5;c.jGestures.defaults.thresholdRotateccw=5;c.jGestures.defaults.thresholdMove=20;c.jGestures.defaults.thresholdSwipe=100;c.jGestures.data={};c.jGestures.data.capableDevicesInUserAgentString=["iPad","iPhone","iPod","Mobile Safari"];c.jGestures.data.hasGestures=(function(){var k;for(k=0;k<c.jGestures.data.capableDevicesInUserAgentString.length;k++){if(navigator.userAgent.indexOf(c.jGestures.data.capableDevicesInUserAgentString[k])!==-1){return true}}return false})();c.hasGestures=c.jGestures.data.hasGestures;c.jGestures.events={touchstart:"jGestures.touchstart",touchendStart:"jGestures.touchend;start",touchendProcessed:"jGestures.touchend;processed",gesturestart:"jGestures.gesturestart",gestureendStart:"jGestures.gestureend;start",gestureendProcessed:"jGestures.gestureend;processed"};jQuery.each({orientationchange_orientationchange01:"orientationchange",gestureend_pinchopen01:"pinchopen",gestureend_pinchclose01:"pinchclose",gestureend_rotatecw01:"rotatecw",gestureend_rotateccw01:"rotateccw",gesturechange_pinch01:"pinch",gesturechange_rotate01:"rotate",touchstart_swipe13:"swipemove",touchstart_swipe01:"swipeone",touchstart_swipe02:"swipetwo",touchstart_swipe03:"swipethree",touchstart_swipe04:"swipefour",touchstart_swipe05:"swipeup",touchstart_swipe06:"swiperightup",touchstart_swipe07:"swiperight",touchstart_swipe08:"swiperightdown",touchstart_swipe09:"swipedown",touchstart_swipe10:"swipeleftdown",touchstart_swipe11:"swipeleft",touchstart_swipe12:"swipeleftup",touchstart_tap01:"tapone",touchstart_tap02:"taptwo",touchstart_tap03:"tapthree",touchstart_tap04:"tapfour",devicemotion_shake01:"shake",devicemotion_shake02:"shakefrontback",devicemotion_shake03:"shakeleftright",devicemotion_shake04:"shakeupdown"},function(l,k){jQuery.event.special[k]={setup:function(){var r=l.split("_");var o=r[0];var m=r[1].slice(0,r[1].length-2);var p=jQuery(this);var q;var n;if(!p.data("ojQueryGestures")||!p.data("ojQueryGestures")[o]){q=p.data("ojQueryGestures")||{};n={};n[o]=true;c.extend(true,q,n);p.data("ojQueryGestures",q);if(c.hasGestures){switch(m){case"orientationchange":p.get(0).addEventListener("orientationchange",a,false);break;case"shake":case"shakefrontback":case"shakeleftright":case"shakeupdown":case"tilt":p.get(0).addEventListener("devicemotion",b,false);break;case"tap":case"swipe":case"swipeup":case"swiperightup":case"swiperight":case"swiperightdown":case"swipedown":case"swipeleftdown":case"swipeleft":p.get(0).addEventListener("touchstart",h,false);break;case"pinchopen":case"pinchclose":case"rotatecw":case"rotateccw":p.get(0).addEventListener("gesturestart",e,false);p.get(0).addEventListener("gestureend",i,false);break;case"pinch":case"rotate":p.get(0).addEventListener("gesturestart",e,false);p.get(0).addEventListener("gesturechange",f,false);break}}else{switch(m){case"tap":case"swipe":p.bind("mousedown",h);break;case"orientationchange":case"pinchopen":case"pinchclose":case"rotatecw":case"rotateccw":case"pinch":case"rotate":case"shake":case"tilt":break}}}return false},add:function(n){var m=jQuery(this);var o=m.data("ojQueryGestures");o[n.type]={originalType:n.type};return false},remove:function(n){var m=jQuery(this);var o=m.data("ojQueryGestures");o[n.type]=false;m.data("ojQueryGestures",o);return false},teardown:function(){var r=l.split("_");var o=r[0];var m=r[1].slice(0,r[1].length-2);var p=jQuery(this);var q;var n;if(!p.data("ojQueryGestures")||!p.data("ojQueryGestures")[o]){q=p.data("ojQueryGestures")||{};n={};n[o]=false;c.extend(true,q,n);p.data("ojQueryGestures",q);if(c.hasGestures){switch(m){case"orientationchange":p.get(0).removeEventListener("orientationchange",a,false);break;case"shake":case"shakefrontback":case"shakeleftright":case"shakeupdown":case"tilt":p.get(0).removeEventListener("devicemotion",b,false);break;case"tap":case"swipe":case"swipeup":case"swiperightup":case"swiperight":case"swiperightdown":case"swipedown":case"swipeleftdown":case"swipeleft":case"swipeleftup":p.get(0).removeEventListener("touchstart",h,false);p.get(0).removeEventListener("touchmove",g,false);p.get(0).removeEventListener("touchend",j,false);break;case"pinchopen":case"pinchclose":case"rotatecw":case"rotateccw":p.get(0).removeEventListener("gesturestart",e,false);p.get(0).removeEventListener("gestureend",i,false);break;case"pinch":case"rotate":p.get(0).removeEventListener("gesturestart",e,false);p.get(0).removeEventListener("gesturechange",f,false);break}}else{switch(m){case"tap":case"swipe":p.unbind("mousedown",h);p.unbind("mousemove",g);p.unbind("mouseup",j);break;case"orientationchange":case"pinchopen":case"pinchclose":case"rotatecw":case"rotateccw":case"pinch":case"rotate":case"shake":case"tilt":break}}}return false}}});function d(k){k.startMove=(k.startMove)?k.startMove:{startX:null,startY:null,timestamp:null};var l=new Date().getTime();var m;var n;if(k.touches){n=[{lastX:k.deltaX,lastY:k.deltaY,moved:null,startX:k.screenX-k.startMove.screenX,startY:k.screenY-k.startMove.screenY}];m={vector:k.vector||null,orientation:window.orientation||null,lastX:((n[0].lastX>0)?+1:((n[0].lastX<0)?-1:0)),lastY:((n[0].lastY>0)?+1:((n[0].lastY<0)?-1:0)),startX:((n[0].startX>0)?+1:((n[0].startX<0)?-1:0)),startY:((n[0].startY>0)?+1:((n[0].startY<0)?-1:0))};n[0].moved=Math.sqrt(Math.pow(Math.abs(n[0].startX),2)+Math.pow(Math.abs(n[0].startY),2))}return{type:k.type||null,originalEvent:k.event||null,delta:n||null,direction:m||{orientation:window.orientation||null,vector:k.vector||null},duration:(k.duration)?k.duration:(k.startMove.timestamp)?l-k.timestamp:null,rotation:k.rotation||null,scale:k.scale||null,description:k.description||[k.type,":",k.touches,":",((n[0].lastX!=0)?((n[0].lastX>0)?"right":"left"):"steady"),":",((n[0].lastY!=0)?((n[0].lastY>0)?"down":"up"):"steady")].join("")}}function a(l){var k=["landscape:clockwise:","portrait:default:","landscape:counterclockwise:","portrait:upsidedown:"];c(window).triggerHandler("orientationchange",{direction:{orientation:window.orientation},description:["orientationchange:",k[((window.orientation/90)+1)],window.orientation].join("")})}function b(r){var k;var t=jQuery(window);var o=t.data("ojQueryGestures");var m=c.jGestures.defaults.thresholdShake;var n=o.oDeviceMotionLastDevicePosition||{accelerationIncludingGravity:{x:0,y:0,z:0},shake:{eventCount:0,intervalsPassed:0,intervalsFreeze:0},shakeleftright:{eventCount:0,intervalsPassed:0,intervalsFreeze:0},shakefrontback:{eventCount:0,intervalsPassed:0,intervalsFreeze:0},shakeupdown:{eventCount:0,intervalsPassed:0,intervalsFreeze:0}};var q={accelerationIncludingGravity:{x:r.accelerationIncludingGravity.x,y:r.accelerationIncludingGravity.y,z:r.accelerationIncludingGravity.z},shake:{eventCount:n.shake.eventCount,intervalsPassed:n.shake.intervalsPassed,intervalsFreeze:n.shake.intervalsFreeze},shakeleftright:{eventCount:n.shakeleftright.eventCount,intervalsPassed:n.shakeleftright.intervalsPassed,intervalsFreeze:n.shakeleftright.intervalsFreeze},shakefrontback:{eventCount:n.shakefrontback.eventCount,intervalsPassed:n.shakefrontback.intervalsPassed,intervalsFreeze:n.shakefrontback.intervalsFreeze},shakeupdown:{eventCount:n.shakeupdown.eventCount,intervalsPassed:n.shakeupdown.intervalsPassed,intervalsFreeze:n.shakeupdown.intervalsFreeze}};var p;var s;var l;for(k in o){switch(k){case"shake":case"shakeleftright":case"shakefrontback":case"shakeupdown":p=[];s=[];p.push(k);if(++q[k].intervalsFreeze>m.freezeShakes&&q[k].intervalsFreeze<(2*m.freezeShakes)){break}q[k].intervalsFreeze=0;q[k].intervalsPassed++;if((k==="shake"||k==="shakeleftright")&&(q.accelerationIncludingGravity.x>m.leftright.sensitivity||q.accelerationIncludingGravity.x<(-1*m.leftright.sensitivity))){p.push("leftright");p.push("x-axis")}if((k==="shake"||k==="shakefrontback")&&(q.accelerationIncludingGravity.y>m.frontback.sensitivity||q.accelerationIncludingGravity.y<(-1*m.frontback.sensitivity))){p.push("frontback");p.push("y-axis")}if((k==="shake"||k==="shakeupdown")&&(q.accelerationIncludingGravity.z+9.81>m.updown.sensitivity||q.accelerationIncludingGravity.z+9.81<(-1*m.updown.sensitivity))){p.push("updown");p.push("z-axis")}if(p.length>1){if(++q[k].eventCount==m.requiredShakes&&(q[k].intervalsPassed)<m.freezeShakes){t.triggerHandler(k,d({type:k,description:p.join(":"),event:r,duration:q[k].intervalsPassed*5}));q[k].eventCount=0;q[k].intervalsPassed=0;q[k].intervalsFreeze=m.freezeShakes+1}else{if(q[k].eventCount==m.requiredShakes&&(q[k].intervalsPassed)>m.freezeShakes){q[k].eventCount=0;q[k].intervalsPassed=0}}}break}l={};l.oDeviceMotionLastDevicePosition=q;t.data("ojQueryGestures",c.extend(true,o,l))}}function h(l){var k=jQuery(l.currentTarget);k.triggerHandler(c.jGestures.events.touchstart,l);if(c.hasGestures){l.currentTarget.addEventListener("touchmove",g,false);l.currentTarget.addEventListener("touchend",j,false)}else{k.bind("mousemove",g);k.bind("mouseup",j)}var n=k.data("ojQueryGestures");var m=(l.touches)?l.touches[0]:l;var o={};o.oLastSwipemove={screenX:m.screenX,screenY:m.screenY,timestamp:new Date().getTime()};o.oStartTouch={screenX:m.screenX,screenY:m.screenY,timestamp:new Date().getTime()};k.data("ojQueryGestures",c.extend(true,n,o))}function g(t){var v=jQuery(t.currentTarget);var s=v.data("ojQueryGestures");var q=!!t.touches;var l=(q)?t.changedTouches[0].screenX:t.screenX;var k=(q)?t.changedTouches[0].screenY:t.screenY;var r=s.oLastSwipemove;var o=l-r.screenX;var n=k-r.screenY;var u;if(!!s.oLastSwipemove){u=d({type:"swipemove",touches:(q)?t.touches.length:"1",screenY:k,screenX:l,deltaY:n,deltaX:o,startMove:r,event:t,timestamp:r.timestamp});v.triggerHandler(u.type,u)}var m={};var p=(t.touches)?t.touches[0]:t;m.oLastSwipemove={screenX:p.screenX,screenY:p.screenY,timestamp:new Date().getTime()};v.data("ojQueryGestures",c.extend(true,s,m))}function j(r){var v=jQuery(r.currentTarget);var x=!!r.changedTouches;var u=(x)?r.changedTouches.length:"1";var p=(x)?r.changedTouches[0].screenX:r.screenX;var o=(x)?r.changedTouches[0].screenY:r.screenY;v.triggerHandler(c.jGestures.events.touchendStart,r);if(c.hasGestures){r.currentTarget.removeEventListener("touchmove",g,false);r.currentTarget.removeEventListener("touchend",j,false)}else{v.unbind("mousemove",g);v.unbind("mouseup",j)}var m=v.data("ojQueryGestures");var y=(Math.abs(m.oStartTouch.screenX-p)>c.jGestures.defaults.thresholdMove||Math.abs(m.oStartTouch.screenY-o)>c.jGestures.defaults.thresholdMove)?true:false;var B=(Math.abs(m.oStartTouch.screenX-p)>c.jGestures.defaults.thresholdSwipe||Math.abs(m.oStartTouch.screenY-o)>c.jGestures.defaults.thresholdSwipe)?true:false;var A;var t;var n;var l;var k;var q;var w=["zero","one","two","three","four"];var s;for(A in m){t=m.oStartTouch;n={};p=(x)?r.changedTouches[0].screenX:r.screenX;o=(x)?r.changedTouches[0].screenY:r.screenY;l=p-t.screenX;k=o-t.screenY;q=d({type:"swipe",touches:u,screenY:o,screenX:p,deltaY:k,deltaX:l,startMove:t,event:r,timestamp:t.timestamp});s=false;switch(A){case"swipeone":if(x===false&&u==1&&y===false){break}if(x===false||(u==1&&y===true&&B===true)){s=true;q.type=["swipe",w[u]].join("");v.triggerHandler(q.type,q)}break;case"swipetwo":if((x&&u==2&&y===true&&B===true)){s=true;q.type=["swipe",w[u]].join("");v.triggerHandler(q.type,q)}break;case"swipethree":if((x&&u==3&&y===true&&B===true)){s=true;q.type=["swipe",w[u]].join("");v.triggerHandler(q.type,q)}break;case"swipefour":if((x&&u==4&&y===true&&B===true)){s=true;q.type=["swipe",w[u]].join("");v.triggerHandler(q.type,q)}break;case"swipeup":case"swiperightup":case"swiperight":case"swiperightdown":case"swipedown":case"swipeleftdown":case"swipeleft":case"swipeleftup":if(x&&y===true&&B===true){s=true;q.type=["swipe",((q.delta[0].lastX!=0)?((q.delta[0].lastX>0)?"right":"left"):""),((q.delta[0].lastY!=0)?((q.delta[0].lastY>0)?"down":"up"):"")].join("");v.triggerHandler(q.type,q)}break;case"tapone":case"taptwo":case"tapthree":case"tapfour":if((y!==true&&s!==true)&&(w[u]==A.slice(3))){q.description=["tap",w[u]].join("");q.type=["tap",w[u]].join("");v.triggerHandler(q.type,q)}break}var z={};v.data("ojQueryGestures",c.extend(true,m,z));v.data("ojQueryGestures",c.extend(true,m,z))}v.triggerHandler(c.jGestures.events.touchendProcessed,r)}function e(l){var k=jQuery(l.currentTarget);k.triggerHandler(c.jGestures.events.gesturestart,l);var m=k.data("ojQueryGestures");var n={};n.oStartTouch={timestamp:new Date().getTime()};k.data("ojQueryGestures",c.extend(true,m,n))}function f(l){var k=jQuery(l.currentTarget);var p,m,r,o;var q=k.data("ojQueryGestures");var n;for(n in q){switch(n){case"pinch":p=l.scale;if(((p<1)&&(p%1)<(1-c.jGestures.defaults.thresholdPinchclose))||((p>1)&&(p%1)>(c.jGestures.defaults.thresholdPinchopen))){m=(p<1)?-1:+1;o=d({type:"pinch",scale:p,touches:null,startMove:q.oStartTouch,event:l,timestamp:q.oStartTouch.timestamp,vector:m,description:["pinch:",m,":",((p<1)?"close":"open")].join("")});k.triggerHandler(o.type,o)}break;case"rotate":p=l.rotation;if(((p<1)&&(-1*(p)>c.jGestures.defaults.thresholdRotateccw))||((p>1)&&(p>c.jGestures.defaults.thresholdRotatecw))){m=(p<1)?-1:+1;o=d({type:"rotate",rotation:p,touches:null,startMove:q.oStartTouch,event:l,timestamp:q.oStartTouch.timestamp,vector:m,description:["rotate:",m,":",((p<1)?"counterclockwise":"clockwise")].join("")});k.triggerHandler(o.type,o)}break}}}function i(l){var k=jQuery(l.currentTarget);k.triggerHandler(c.jGestures.events.gestureendStart,l);var n;var o=k.data("ojQueryGestures");var m;for(m in o){switch(m){case"pinchclose":n=l.scale;if((n<1)&&(n%1)<(1-c.jGestures.defaults.thresholdPinchclose)){k.triggerHandler("pinchclose",d({type:"pinchclose",scale:n,vector:-1,touches:null,startMove:o.oStartTouch,event:l,timestamp:o.oStartTouch.timestamp,description:"pinch:-1:close"}))}break;case"pinchopen":n=l.scale;if((n>1)&&(n%1)>(c.jGestures.defaults.thresholdPinchopen)){k.triggerHandler("pinchopen",d({type:"pinchopen",scale:n,vector:+1,touches:null,startMove:o.oStartTouch,event:l,timestamp:o.oStartTouch.timestamp,description:"pinch:+1:open"}))}break;case"rotatecw":n=l.rotation;if((n>1)&&(n>c.jGestures.defaults.thresholdRotatecw)){k.triggerHandler("rotatecw",d({type:"rotatecw",rotation:n,vector:+1,touches:null,startMove:o.oStartTouch,event:l,timestamp:o.oStartTouch.timestamp,description:"rotate:+1:clockwise"}))}break;case"rotateccw":n=l.rotation;if((n<1)&&(-1*(n)>c.jGestures.defaults.thresholdRotateccw)){k.triggerHandler("rotateccw",d({type:"rotateccw",rotation:n,vector:-1,touches:null,startMove:o.oStartTouch,event:l,timestamp:o.oStartTouch.timestamp,description:"rotate:-1:counterclockwise"}))}break}}k.triggerHandler(c.jGestures.events.gestureendProcessed,l)}})(jQuery);
var DragCursor = {};
(function($)
{
	var browser;
	if ($.browser.msie)
	browser = 'ie';
	else if ($.browser.opera)
	browser = 'opera';
	else 
	browser = 'standard';
	
	DragCursor.open = function($element, arrows)
	{
		$element.removeClass('drag-closed-' + browser);
		$element.addClass('drag-open-' + browser);
		$element.removeClass('dragging');
		if (arrows) $element.addClass('drag-arrows');
		else $element.removeClass('drag-arrows');
	}
	
	DragCursor.closed = function($element, arrows)
	{
		$element.removeClass('drag-open-' + browser);
		$element.addClass('drag-closed-' + browser);
		$element.addClass('dragging');
		if (arrows) $element.addClass('drag-arrows');
		else $element.removeClass('drag-arrows');
	}
	
	DragCursor.clear = function($element)
	{
		$element.removeClass('drag-open-' + browser);
		$element.removeClass('drag-closed-' + browser);
		$element.removeClass('dragging');
		$element.removeClass('drag-arrows');
	}
}
)(jQuery);
jQuery(document).bind("dragstart", function(e)
{
	var tagName = e.target.nodeName.toUpperCase();
    if (tagName == "IMG" || tagName == "A")
	{
        return false;
    }
});
/* Modernizr 2.6.2 (Custom Build) | MIT & BSD
 * Build: http://modernizr.com/download/#-fontface-backgroundsize-borderimage-borderradius-boxshadow-flexbox-flexboxlegacy-hsla-multiplebgs-opacity-rgba-textshadow-cssanimations-csscolumns-generatedcontent-cssgradients-cssreflections-csstransforms-csstransforms3d-csstransitions-applicationcache-canvas-canvastext-draganddrop-hashchange-history-audio-video-indexeddb-input-inputtypes-localstorage-postmessage-sessionstorage-websockets-websqldatabase-webworkers-geolocation-inlinesvg-smil-svg-svgclippaths-touch-webgl-teststyles-testprop-testallprops-hasevent-prefixes-domprefixes
 */
;window.Modernizr=function(a,b,c){function B(a){i.cssText=a}function C(a,b){return B(m.join(a+";")+(b||""))}function D(a,b){return typeof a===b}function E(a,b){return!!~(""+a).indexOf(b)}function F(a,b){for(var d in a){var e=a[d];if(!E(e,"-")&&i[e]!==c)return b=="pfx"?e:!0}return!1}function G(a,b,d){for(var e in a){var f=b[a[e]];if(f!==c)return d===!1?a[e]:D(f,"function")?f.bind(d||b):f}return!1}function H(a,b,c){var d=a.charAt(0).toUpperCase()+a.slice(1),e=(a+" "+o.join(d+" ")+d).split(" ");return D(b,"string")||D(b,"undefined")?F(e,b):(e=(a+" "+p.join(d+" ")+d).split(" "),G(e,b,c))}function I(){e.input=function(c){for(var d=0,e=c.length;d<e;d++)t[c[d]]=c[d]in j;return t.list&&(t.list=!!b.createElement("datalist")&&!!a.HTMLDataListElement),t}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),e.inputtypes=function(a){for(var d=0,e,g,h,i=a.length;d<i;d++)j.setAttribute("type",g=a[d]),e=j.type!=="text",e&&(j.value=k,j.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(g)&&j.style.WebkitAppearance!==c?(f.appendChild(j),h=b.defaultView,e=h.getComputedStyle&&h.getComputedStyle(j,null).WebkitAppearance!=="textfield"&&j.offsetHeight!==0,f.removeChild(j)):/^(search|tel)$/.test(g)||(/^(url|email)$/.test(g)?e=j.checkValidity&&j.checkValidity()===!1:e=j.value!=k)),s[a[d]]=!!e;return s}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var d="2.6.2",e={},f=b.documentElement,g="modernizr",h=b.createElement(g),i=h.style,j=b.createElement("input"),k=":)",l={}.toString,m=" -webkit- -moz- -o- -ms- ".split(" "),n="Webkit Moz O ms",o=n.split(" "),p=n.toLowerCase().split(" "),q={svg:"http://www.w3.org/2000/svg"},r={},s={},t={},u=[],v=u.slice,w,x=function(a,c,d,e){var h,i,j,k,l=b.createElement("div"),m=b.body,n=m||b.createElement("body");if(parseInt(d,10))while(d--)j=b.createElement("div"),j.id=e?e[d]:g+(d+1),l.appendChild(j);return h=["&#173;",'<style id="s',g,'">',a,"</style>"].join(""),l.id=g,(m?l:n).innerHTML+=h,n.appendChild(l),m||(n.style.background="",n.style.overflow="hidden",k=f.style.overflow,f.style.overflow="hidden",f.appendChild(n)),i=c(l,a),m?l.parentNode.removeChild(l):(n.parentNode.removeChild(n),f.style.overflow=k),!!i},y=function(){function d(d,e){e=e||b.createElement(a[d]||"div"),d="on"+d;var f=d in e;return f||(e.setAttribute||(e=b.createElement("div")),e.setAttribute&&e.removeAttribute&&(e.setAttribute(d,""),f=D(e[d],"function"),D(e[d],"undefined")||(e[d]=c),e.removeAttribute(d))),e=null,f}var a={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return d}(),z={}.hasOwnProperty,A;!D(z,"undefined")&&!D(z.call,"undefined")?A=function(a,b){return z.call(a,b)}:A=function(a,b){return b in a&&D(a.constructor.prototype[b],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(b){var c=this;if(typeof c!="function")throw new TypeError;var d=v.call(arguments,1),e=function(){if(this instanceof e){var a=function(){};a.prototype=c.prototype;var f=new a,g=c.apply(f,d.concat(v.call(arguments)));return Object(g)===g?g:f}return c.apply(b,d.concat(v.call(arguments)))};return e}),r.flexbox=function(){return H("flexWrap")},r.flexboxlegacy=function(){return H("boxDirection")},r.canvas=function(){var a=b.createElement("canvas");return!!a.getContext&&!!a.getContext("2d")},r.canvastext=function(){return!!e.canvas&&!!D(b.createElement("canvas").getContext("2d").fillText,"function")},r.webgl=function(){return!!a.WebGLRenderingContext},r.touch=function(){var c;return"ontouchstart"in a||a.DocumentTouch&&b instanceof DocumentTouch?c=!0:x(["@media (",m.join("touch-enabled),("),g,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(a){c=a.offsetTop===9}),c},r.geolocation=function(){return"geolocation"in navigator},r.postmessage=function(){return!!a.postMessage},r.websqldatabase=function(){return!!a.openDatabase},r.indexedDB=function(){return!!H("indexedDB",a)},r.hashchange=function(){return y("hashchange",a)&&(b.documentMode===c||b.documentMode>7)},r.history=function(){return!!a.history&&!!history.pushState},r.draganddrop=function(){var a=b.createElement("div");return"draggable"in a||"ondragstart"in a&&"ondrop"in a},r.websockets=function(){return"WebSocket"in a||"MozWebSocket"in a},r.rgba=function(){return B("background-color:rgba(150,255,150,.5)"),E(i.backgroundColor,"rgba")},r.hsla=function(){return B("background-color:hsla(120,40%,100%,.5)"),E(i.backgroundColor,"rgba")||E(i.backgroundColor,"hsla")},r.multiplebgs=function(){return B("background:url(https://),url(https://),red url(https://)"),/(url\s*\(.*?){3}/.test(i.background)},r.backgroundsize=function(){return H("backgroundSize")},r.borderimage=function(){return H("borderImage")},r.borderradius=function(){return H("borderRadius")},r.boxshadow=function(){return H("boxShadow")},r.textshadow=function(){return b.createElement("div").style.textShadow===""},r.opacity=function(){return C("opacity:.55"),/^0.55$/.test(i.opacity)},r.cssanimations=function(){return H("animationName")},r.csscolumns=function(){return H("columnCount")},r.cssgradients=function(){var a="background-image:",b="gradient(linear,left top,right bottom,from(#9f9),to(white));",c="linear-gradient(left top,#9f9, white);";return B((a+"-webkit- ".split(" ").join(b+a)+m.join(c+a)).slice(0,-a.length)),E(i.backgroundImage,"gradient")},r.cssreflections=function(){return H("boxReflect")},r.csstransforms=function(){return!!H("transform")},r.csstransforms3d=function(){var a=!!H("perspective");return a&&"webkitPerspective"in f.style&&x("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(b,c){a=b.offsetLeft===9&&b.offsetHeight===3}),a},r.csstransitions=function(){return H("transition")},r.fontface=function(){var a;return x('@font-face {font-family:"font";src:url("https://")}',function(c,d){var e=b.getElementById("smodernizr"),f=e.sheet||e.styleSheet,g=f?f.cssRules&&f.cssRules[0]?f.cssRules[0].cssText:f.cssText||"":"";a=/src/i.test(g)&&g.indexOf(d.split(" ")[0])===0}),a},r.generatedcontent=function(){var a;return x(["#",g,"{font:0/0 a}#",g,':after{content:"',k,'";visibility:hidden;font:3px/1 a}'].join(""),function(b){a=b.offsetHeight>=3}),a},r.video=function(){var a=b.createElement("video"),c=!1;try{if(c=!!a.canPlayType)c=new Boolean(c),c.ogg=a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),c.h264=a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),c.webm=a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")}catch(d){}return c},r.audio=function(){var a=b.createElement("audio"),c=!1;try{if(c=!!a.canPlayType)c=new Boolean(c),c.ogg=a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),c.mp3=a.canPlayType("audio/mpeg;").replace(/^no$/,""),c.wav=a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),c.m4a=(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/aac;")).replace(/^no$/,"")}catch(d){}return c},r.localstorage=function(){try{return localStorage.setItem(g,g),localStorage.removeItem(g),!0}catch(a){return!1}},r.sessionstorage=function(){try{return sessionStorage.setItem(g,g),sessionStorage.removeItem(g),!0}catch(a){return!1}},r.webworkers=function(){return!!a.Worker},r.applicationcache=function(){return!!a.applicationCache},r.svg=function(){return!!b.createElementNS&&!!b.createElementNS(q.svg,"svg").createSVGRect},r.inlinesvg=function(){var a=b.createElement("div");return a.innerHTML="<svg/>",(a.firstChild&&a.firstChild.namespaceURI)==q.svg},r.smil=function(){return!!b.createElementNS&&/SVGAnimate/.test(l.call(b.createElementNS(q.svg,"animate")))},r.svgclippaths=function(){return!!b.createElementNS&&/SVGClipPath/.test(l.call(b.createElementNS(q.svg,"clipPath")))};for(var J in r)A(r,J)&&(w=J.toLowerCase(),e[w]=r[J](),u.push((e[w]?"":"no-")+w));return e.input||I(),e.addTest=function(a,b){if(typeof a=="object")for(var d in a)A(a,d)&&e.addTest(d,a[d]);else{a=a.toLowerCase();if(e[a]!==c)return e;b=typeof b=="function"?b():b,typeof enableClasses!="undefined"&&enableClasses&&(f.className+=" "+(b?"":"no-")+a),e[a]=b}return e},B(""),h=j=null,e._version=d,e._prefixes=m,e._domPrefixes=p,e._cssomPrefixes=o,e.hasEvent=y,e.testProp=function(a){return F([a])},e.testAllProps=H,e.testStyles=x,e}(this,this.document);
/*
 * jQuery Easing v1.3 - http://gsgd.co.uk/sandbox/jquery/easing/
 *
 * Uses the built in easing capabilities added In jQuery 1.1
 * to offer multiple easing options
 *
 * TERMS OF USE - jQuery Easing
 * 
 * Open source under the BSD License. 
 * 
 * Copyright © 2008 George McGinley Smith
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without modification, 
 * are permitted provided that the following conditions are met:
 * 
 * Redistributions of source code must retain the above copyright notice, this list of 
 * conditions and the following disclaimer.
 * Redistributions in binary form must reproduce the above copyright notice, this list 
 * of conditions and the following disclaimer in the documentation and/or other materials 
 * provided with the distribution.
 * 
 * Neither the name of the author nor the names of contributors may be used to endorse 
 * or promote products derived from this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY 
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
 *  COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 *  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
 *  GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED 
 * AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 *  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED 
 * OF THE POSSIBILITY OF SUCH DAMAGE. 
 *
*/

// t: current time, b: begInnIng value, c: change In value, d: duration
jQuery.easing['jswing'] = jQuery.easing['swing'];

jQuery.extend( jQuery.easing,
{
	def: 'easeOutQuad',
	swing: function (x, t, b, c, d) {
		//alert(jQuery.easing.default);
		return jQuery.easing[jQuery.easing.def](x, t, b, c, d);
	},
	easeInQuad: function (x, t, b, c, d) {
		return c*(t/=d)*t + b;
	},
	easeOutQuad: function (x, t, b, c, d) {
		return -c *(t/=d)*(t-2) + b;
	},
	easeInOutQuad: function (x, t, b, c, d) {
		if ((t/=d/2) < 1) return c/2*t*t + b;
		return -c/2 * ((--t)*(t-2) - 1) + b;
	},
	easeInCubic: function (x, t, b, c, d) {
		return c*(t/=d)*t*t + b;
	},
	easeOutCubic: function (x, t, b, c, d) {
		return c*((t=t/d-1)*t*t + 1) + b;
	},
	easeInOutCubic: function (x, t, b, c, d) {
		if ((t/=d/2) < 1) return c/2*t*t*t + b;
		return c/2*((t-=2)*t*t + 2) + b;
	},
	easeInQuart: function (x, t, b, c, d) {
		return c*(t/=d)*t*t*t + b;
	},
	easeOutQuart: function (x, t, b, c, d) {
		return -c * ((t=t/d-1)*t*t*t - 1) + b;
	},
	easeInOutQuart: function (x, t, b, c, d) {
		if ((t/=d/2) < 1) return c/2*t*t*t*t + b;
		return -c/2 * ((t-=2)*t*t*t - 2) + b;
	},
	easeInQuint: function (x, t, b, c, d) {
		return c*(t/=d)*t*t*t*t + b;
	},
	easeOutQuint: function (x, t, b, c, d) {
		return c*((t=t/d-1)*t*t*t*t + 1) + b;
	},
	easeInOutQuint: function (x, t, b, c, d) {
		if ((t/=d/2) < 1) return c/2*t*t*t*t*t + b;
		return c/2*((t-=2)*t*t*t*t + 2) + b;
	},
	easeInSine: function (x, t, b, c, d) {
		return -c * Math.cos(t/d * (Math.PI/2)) + c + b;
	},
	easeOutSine: function (x, t, b, c, d) {
		return c * Math.sin(t/d * (Math.PI/2)) + b;
	},
	easeInOutSine: function (x, t, b, c, d) {
		return -c/2 * (Math.cos(Math.PI*t/d) - 1) + b;
	},
	easeInExpo: function (x, t, b, c, d) {
		return (t==0) ? b : c * Math.pow(2, 10 * (t/d - 1)) + b;
	},
	easeOutExpo: function (x, t, b, c, d) {
		return (t==d) ? b+c : c * (-Math.pow(2, -10 * t/d) + 1) + b;
	},
	easeInOutExpo: function (x, t, b, c, d) {
		if (t==0) return b;
		if (t==d) return b+c;
		if ((t/=d/2) < 1) return c/2 * Math.pow(2, 10 * (t - 1)) + b;
		return c/2 * (-Math.pow(2, -10 * --t) + 2) + b;
	},
	easeInCirc: function (x, t, b, c, d) {
		return -c * (Math.sqrt(1 - (t/=d)*t) - 1) + b;
	},
	easeOutCirc: function (x, t, b, c, d) {
		return c * Math.sqrt(1 - (t=t/d-1)*t) + b;
	},
	easeInOutCirc: function (x, t, b, c, d) {
		if ((t/=d/2) < 1) return -c/2 * (Math.sqrt(1 - t*t) - 1) + b;
		return c/2 * (Math.sqrt(1 - (t-=2)*t) + 1) + b;
	},
	easeInElastic: function (x, t, b, c, d) {
		var s=1.70158;var p=0;var a=c;
		if (t==0) return b;  if ((t/=d)==1) return b+c;  if (!p) p=d*.3;
		if (a < Math.abs(c)) { a=c; var s=p/4; }
		else var s = p/(2*Math.PI) * Math.asin (c/a);
		return -(a*Math.pow(2,10*(t-=1)) * Math.sin( (t*d-s)*(2*Math.PI)/p )) + b;
	},
	easeOutElastic: function (x, t, b, c, d) {
		var s=1.70158;var p=0;var a=c;
		if (t==0) return b;  if ((t/=d)==1) return b+c;  if (!p) p=d*.3;
		if (a < Math.abs(c)) { a=c; var s=p/4; }
		else var s = p/(2*Math.PI) * Math.asin (c/a);
		return a*Math.pow(2,-10*t) * Math.sin( (t*d-s)*(2*Math.PI)/p ) + c + b;
	},
	easeInOutElastic: function (x, t, b, c, d) {
		var s=1.70158;var p=0;var a=c;
		if (t==0) return b;  if ((t/=d/2)==2) return b+c;  if (!p) p=d*(.3*1.5);
		if (a < Math.abs(c)) { a=c; var s=p/4; }
		else var s = p/(2*Math.PI) * Math.asin (c/a);
		if (t < 1) return -.5*(a*Math.pow(2,10*(t-=1)) * Math.sin( (t*d-s)*(2*Math.PI)/p )) + b;
		return a*Math.pow(2,-10*(t-=1)) * Math.sin( (t*d-s)*(2*Math.PI)/p )*.5 + c + b;
	},
	easeInBack: function (x, t, b, c, d, s) {
		if (s == undefined) s = 1.70158;
		return c*(t/=d)*t*((s+1)*t - s) + b;
	},
	easeOutBack: function (x, t, b, c, d, s) {
		if (s == undefined) s = 1.70158;
		return c*((t=t/d-1)*t*((s+1)*t + s) + 1) + b;
	},
	easeInOutBack: function (x, t, b, c, d, s) {
		if (s == undefined) s = 1.70158; 
		if ((t/=d/2) < 1) return c/2*(t*t*(((s*=(1.525))+1)*t - s)) + b;
		return c/2*((t-=2)*t*(((s*=(1.525))+1)*t + s) + 2) + b;
	},
	easeInBounce: function (x, t, b, c, d) {
		return c - jQuery.easing.easeOutBounce (x, d-t, 0, c, d) + b;
	},
	easeOutBounce: function (x, t, b, c, d) {
		if ((t/=d) < (1/2.75)) {
			return c*(7.5625*t*t) + b;
		} else if (t < (2/2.75)) {
			return c*(7.5625*(t-=(1.5/2.75))*t + .75) + b;
		} else if (t < (2.5/2.75)) {
			return c*(7.5625*(t-=(2.25/2.75))*t + .9375) + b;
		} else {
			return c*(7.5625*(t-=(2.625/2.75))*t + .984375) + b;
		}
	},
	easeInOutBounce: function (x, t, b, c, d) {
		if (t < d/2) return jQuery.easing.easeInBounce (x, t*2, 0, c, d) * .5 + b;
		return jQuery.easing.easeOutBounce (x, t*2-d, 0, c, d) * .5 + c*.5 + b;
	}
});

/*
 *
 * TERMS OF USE - EASING EQUATIONS
 * 
 * Open source under the BSD License. 
 * 
 * Copyright © 2001 Robert Penner
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without modification, 
 * are permitted provided that the following conditions are met:
 * 
 * Redistributions of source code must retain the above copyright notice, this list of 
 * conditions and the following disclaimer.
 * Redistributions in binary form must reproduce the above copyright notice, this list 
 * of conditions and the following disclaimer in the documentation and/or other materials 
 * provided with the distribution.
 * 
 * Neither the name of the author nor the names of contributors may be used to endorse 
 * or promote products derived from this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY 
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
 *  COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 *  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
 *  GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED 
 * AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 *  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED 
 * OF THE POSSIBILITY OF SUCH DAMAGE. 
 *
 */
/*!
 * jQuery Cookie Plugin v1.3
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2011, Klaus Hartl
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.opensource.org/licenses/GPL-2.0
 */
(function ($, document, undefined) {

	var pluses = /\+/g;

	function raw(s) {
		return s;
	}

	function decoded(s) {
		return decodeURIComponent(s.replace(pluses, ' '));
	}

	var config = $.cookie = function (key, value, options) {

		// write
		if (value !== undefined) {
			options = $.extend({}, config.defaults, options);

			if (value === null) {
				options.expires = -1;
			}

			if (typeof options.expires === 'number') {
				var days = options.expires, t = options.expires = new Date();
				t.setDate(t.getDate() + days);
			}

			value = config.json ? JSON.stringify(value) : String(value);

			return (document.cookie = [
				encodeURIComponent(key), '=', config.raw ? value : encodeURIComponent(value),
				options.expires ? '; expires=' + options.expires.toUTCString() : '', // use expires attribute, max-age is not supported by IE
				options.path    ? '; path=' + options.path : '',
				options.domain  ? '; domain=' + options.domain : '',
				options.secure  ? '; secure' : ''
			].join(''));
		}

		// read
		var decode = config.raw ? raw : decoded;
		var cookies = document.cookie.split('; ');
		for (var i = 0, l = cookies.length; i < l; i++) {
			var parts = cookies[i].split('=');
			if (decode(parts.shift()) === key) {
				var cookie = decode(parts.join('='));
				return config.json ? JSON.parse(cookie) : cookie;
			}
		}

		return null;
	};

	config.defaults = {};

	$.removeCookie = function (key, options) {
		if ($.cookie(key) !== null) {
			$.cookie(key, null, options);
			return true;
		}
		return false;
	};

})(jQuery, document);

/*! jQuery UI - v1.9.2 - 2012-12-06
* http://jqueryui.com
* Includes: jquery.ui.core.js, jquery.ui.widget.js, jquery.ui.mouse.js, jquery.ui.position.js, jquery.ui.draggable.js, jquery.ui.slider.js
* Copyright (c) 2012 jQuery Foundation and other contributors Licensed MIT */

(function(e,t){function i(t,n){var r,i,o,u=t.nodeName.toLowerCase();return"area"===u?(r=t.parentNode,i=r.name,!t.href||!i||r.nodeName.toLowerCase()!=="map"?!1:(o=e("img[usemap=#"+i+"]")[0],!!o&&s(o))):(/input|select|textarea|button|object/.test(u)?!t.disabled:"a"===u?t.href||n:n)&&s(t)}function s(t){return e.expr.filters.visible(t)&&!e(t).parents().andSelf().filter(function(){return e.css(this,"visibility")==="hidden"}).length}var n=0,r=/^ui-id-\d+$/;e.ui=e.ui||{};if(e.ui.version)return;e.extend(e.ui,{version:"1.9.2",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({_focus:e.fn.focus,focus:function(t,n){return typeof t=="number"?this.each(function(){var r=this;setTimeout(function(){e(r).focus(),n&&n.call(r)},t)}):this._focus.apply(this,arguments)},scrollParent:function(){var t;return e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?t=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):t=this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length){var r=e(this[0]),i,s;while(r.length&&r[0]!==document){i=r.css("position");if(i==="absolute"||i==="relative"||i==="fixed"){s=parseInt(r.css("zIndex"),10);if(!isNaN(s)&&s!==0)return s}r=r.parent()}}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++n)})},removeUniqueId:function(){return this.each(function(){r.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,r){return!!e.data(t,r[3])},focusable:function(t){return i(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var n=e.attr(t,"tabindex"),r=isNaN(n);return(r||n>=0)&&i(t,!r)}}),e(function(){var t=document.body,n=t.appendChild(n=document.createElement("div"));n.offsetHeight,e.extend(n.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),e.support.minHeight=n.offsetHeight===100,e.support.selectstart="onselectstart"in n,t.removeChild(n).style.display="none"}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(n,r){function u(t,n,r,s){return e.each(i,function(){n-=parseFloat(e.css(t,"padding"+this))||0,r&&(n-=parseFloat(e.css(t,"border"+this+"Width"))||0),s&&(n-=parseFloat(e.css(t,"margin"+this))||0)}),n}var i=r==="Width"?["Left","Right"]:["Top","Bottom"],s=r.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+r]=function(n){return n===t?o["inner"+r].call(this):this.each(function(){e(this).css(s,u(this,n)+"px")})},e.fn["outer"+r]=function(t,n){return typeof t!="number"?o["outer"+r].call(this,t):this.each(function(){e(this).css(s,u(this,t,!0,n)+"px")})}}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(n){return arguments.length?t.call(this,e.camelCase(n)):t.call(this)}}(e.fn.removeData)),function(){var t=/msie ([\w.]+)/.exec(navigator.userAgent.toLowerCase())||[];e.ui.ie=t.length?!0:!1,e.ui.ie6=parseFloat(t[1],10)===6}(),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,n,r){var i,s=e.ui[t].prototype;for(i in r)s.plugins[i]=s.plugins[i]||[],s.plugins[i].push([n,r[i]])},call:function(e,t,n){var r,i=e.plugins[t];if(!i||!e.element[0].parentNode||e.element[0].parentNode.nodeType===11)return;for(r=0;r<i.length;r++)e.options[i[r][0]]&&i[r][1].apply(e.element,n)}},contains:e.contains,hasScroll:function(t,n){if(e(t).css("overflow")==="hidden")return!1;var r=n&&n==="left"?"scrollLeft":"scrollTop",i=!1;return t[r]>0?!0:(t[r]=1,i=t[r]>0,t[r]=0,i)},isOverAxis:function(e,t,n){return e>t&&e<t+n},isOver:function(t,n,r,i,s,o){return e.ui.isOverAxis(t,r,s)&&e.ui.isOverAxis(n,i,o)}})})(jQuery);(function(e,t){var n=0,r=Array.prototype.slice,i=e.cleanData;e.cleanData=function(t){for(var n=0,r;(r=t[n])!=null;n++)try{e(r).triggerHandler("remove")}catch(s){}i(t)},e.widget=function(t,n,r){var i,s,o,u,a=t.split(".")[0];t=t.split(".")[1],i=a+"-"+t,r||(r=n,n=e.Widget),e.expr[":"][i.toLowerCase()]=function(t){return!!e.data(t,i)},e[a]=e[a]||{},s=e[a][t],o=e[a][t]=function(e,t){if(!this._createWidget)return new o(e,t);arguments.length&&this._createWidget(e,t)},e.extend(o,s,{version:r.version,_proto:e.extend({},r),_childConstructors:[]}),u=new n,u.options=e.widget.extend({},u.options),e.each(r,function(t,i){e.isFunction(i)&&(r[t]=function(){var e=function(){return n.prototype[t].apply(this,arguments)},r=function(e){return n.prototype[t].apply(this,e)};return function(){var t=this._super,n=this._superApply,s;return this._super=e,this._superApply=r,s=i.apply(this,arguments),this._super=t,this._superApply=n,s}}())}),o.prototype=e.widget.extend(u,{widgetEventPrefix:s?u.widgetEventPrefix:t},r,{constructor:o,namespace:a,widgetName:t,widgetBaseClass:i,widgetFullName:i}),s?(e.each(s._childConstructors,function(t,n){var r=n.prototype;e.widget(r.namespace+"."+r.widgetName,o,n._proto)}),delete s._childConstructors):n._childConstructors.push(o),e.widget.bridge(t,o)},e.widget.extend=function(n){var i=r.call(arguments,1),s=0,o=i.length,u,a;for(;s<o;s++)for(u in i[s])a=i[s][u],i[s].hasOwnProperty(u)&&a!==t&&(e.isPlainObject(a)?n[u]=e.isPlainObject(n[u])?e.widget.extend({},n[u],a):e.widget.extend({},a):n[u]=a);return n},e.widget.bridge=function(n,i){var s=i.prototype.widgetFullName||n;e.fn[n]=function(o){var u=typeof o=="string",a=r.call(arguments,1),f=this;return o=!u&&a.length?e.widget.extend.apply(null,[o].concat(a)):o,u?this.each(function(){var r,i=e.data(this,s);if(!i)return e.error("cannot call methods on "+n+" prior to initialization; "+"attempted to call method '"+o+"'");if(!e.isFunction(i[o])||o.charAt(0)==="_")return e.error("no such method '"+o+"' for "+n+" widget instance");r=i[o].apply(i,a);if(r!==i&&r!==t)return f=r&&r.jquery?f.pushStack(r.get()):r,!1}):this.each(function(){var t=e.data(this,s);t?t.option(o||{})._init():e.data(this,s,new i(o,this))}),f}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,r){r=e(r||this.defaultElement||this)[0],this.element=e(r),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),r!==this&&(e.data(r,this.widgetName,this),e.data(r,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===r&&this.destroy()}}),this.document=e(r.style?r.ownerDocument:r.document||r),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(n,r){var i=n,s,o,u;if(arguments.length===0)return e.widget.extend({},this.options);if(typeof n=="string"){i={},s=n.split("."),n=s.shift();if(s.length){o=i[n]=e.widget.extend({},this.options[n]);for(u=0;u<s.length-1;u++)o[s[u]]=o[s[u]]||{},o=o[s[u]];n=s.pop();if(r===t)return o[n]===t?null:o[n];o[n]=r}else{if(r===t)return this.options[n]===t?null:this.options[n];i[n]=r}}return this._setOptions(i),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,e==="disabled"&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,n,r){var i,s=this;typeof t!="boolean"&&(r=n,n=t,t=!1),r?(n=i=e(n),this.bindings=this.bindings.add(n)):(r=n,n=this.element,i=this.widget()),e.each(r,function(r,o){function u(){if(!t&&(s.options.disabled===!0||e(this).hasClass("ui-state-disabled")))return;return(typeof o=="string"?s[o]:o).apply(s,arguments)}typeof o!="string"&&(u.guid=o.guid=o.guid||u.guid||e.guid++);var a=r.match(/^(\w+)\s*(.*)$/),f=a[1]+s.eventNamespace,l=a[2];l?i.delegate(l,f,u):n.bind(f,u)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return(typeof e=="string"?r[e]:e).apply(r,arguments)}var r=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,r){var i,s,o=this.options[t];r=r||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],s=n.originalEvent;if(s)for(i in s)i in n||(n[i]=s[i]);return this.element.trigger(n,r),!(e.isFunction(o)&&o.apply(this.element[0],[n].concat(r))===!1||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(r,i,s){typeof i=="string"&&(i={effect:i});var o,u=i?i===!0||typeof i=="number"?n:i.effect||n:t;i=i||{},typeof i=="number"&&(i={duration:i}),o=!e.isEmptyObject(i),i.complete=s,i.delay&&r.delay(i.delay),o&&e.effects&&(e.effects.effect[u]||e.uiBackCompat!==!1&&e.effects[u])?r[t](i):u!==t&&r[u]?r[u](i.duration,i.easing,s):r.queue(function(n){e(this)[t](),s&&s.call(r[0]),n()})}}),e.uiBackCompat!==!1&&(e.Widget.prototype._getCreateOptions=function(){return e.metadata&&e.metadata.get(this.element[0])[this.widgetName]})})(jQuery);(function(e,t){var n=!1;e(document).mouseup(function(e){n=!1}),e.widget("ui.mouse",{version:"1.9.2",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(n){if(!0===e.data(n.target,t.widgetName+".preventClickEvent"))return e.removeData(n.target,t.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(n)return;this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var r=this,i=t.which===1,s=typeof this.options.cancel=="string"&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;if(!i||s||!this._mouseCapture(t))return!0;this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){r.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)){this._mouseStarted=this._mouseStart(t)!==!1;if(!this._mouseStarted)return t.preventDefault(),!0}return!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return r._mouseMove(e)},this._mouseUpDelegate=function(e){return r._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),n=!0,!0},_mouseMove:function(t){return!e.ui.ie||document.documentMode>=9||!!t.button?this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted):this._mouseUp(t)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(e){return this.mouseDelayMet},_mouseStart:function(e){},_mouseDrag:function(e){},_mouseStop:function(e){},_mouseCapture:function(e){return!0}})})(jQuery);(function(e,t){function h(e,t,n){return[parseInt(e[0],10)*(l.test(e[0])?t/100:1),parseInt(e[1],10)*(l.test(e[1])?n/100:1)]}function p(t,n){return parseInt(e.css(t,n),10)||0}e.ui=e.ui||{};var n,r=Math.max,i=Math.abs,s=Math.round,o=/left|center|right/,u=/top|center|bottom/,a=/[\+\-]\d+%?/,f=/^\w+/,l=/%$/,c=e.fn.position;e.position={scrollbarWidth:function(){if(n!==t)return n;var r,i,s=e("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=s.children()[0];return e("body").append(s),r=o.offsetWidth,s.css("overflow","scroll"),i=o.offsetWidth,r===i&&(i=s[0].clientWidth),s.remove(),n=r-i},getScrollInfo:function(t){var n=t.isWindow?"":t.element.css("overflow-x"),r=t.isWindow?"":t.element.css("overflow-y"),i=n==="scroll"||n==="auto"&&t.width<t.element[0].scrollWidth,s=r==="scroll"||r==="auto"&&t.height<t.element[0].scrollHeight;return{width:i?e.position.scrollbarWidth():0,height:s?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var n=e(t||window),r=e.isWindow(n[0]);return{element:n,isWindow:r,offset:n.offset()||{left:0,top:0},scrollLeft:n.scrollLeft(),scrollTop:n.scrollTop(),width:r?n.width():n.outerWidth(),height:r?n.height():n.outerHeight()}}},e.fn.position=function(t){if(!t||!t.of)return c.apply(this,arguments);t=e.extend({},t);var n,l,d,v,m,g=e(t.of),y=e.position.getWithinInfo(t.within),b=e.position.getScrollInfo(y),w=g[0],E=(t.collision||"flip").split(" "),S={};return w.nodeType===9?(l=g.width(),d=g.height(),v={top:0,left:0}):e.isWindow(w)?(l=g.width(),d=g.height(),v={top:g.scrollTop(),left:g.scrollLeft()}):w.preventDefault?(t.at="left top",l=d=0,v={top:w.pageY,left:w.pageX}):(l=g.outerWidth(),d=g.outerHeight(),v=g.offset()),m=e.extend({},v),e.each(["my","at"],function(){var e=(t[this]||"").split(" "),n,r;e.length===1&&(e=o.test(e[0])?e.concat(["center"]):u.test(e[0])?["center"].concat(e):["center","center"]),e[0]=o.test(e[0])?e[0]:"center",e[1]=u.test(e[1])?e[1]:"center",n=a.exec(e[0]),r=a.exec(e[1]),S[this]=[n?n[0]:0,r?r[0]:0],t[this]=[f.exec(e[0])[0],f.exec(e[1])[0]]}),E.length===1&&(E[1]=E[0]),t.at[0]==="right"?m.left+=l:t.at[0]==="center"&&(m.left+=l/2),t.at[1]==="bottom"?m.top+=d:t.at[1]==="center"&&(m.top+=d/2),n=h(S.at,l,d),m.left+=n[0],m.top+=n[1],this.each(function(){var o,u,a=e(this),f=a.outerWidth(),c=a.outerHeight(),w=p(this,"marginLeft"),x=p(this,"marginTop"),T=f+w+p(this,"marginRight")+b.width,N=c+x+p(this,"marginBottom")+b.height,C=e.extend({},m),k=h(S.my,a.outerWidth(),a.outerHeight());t.my[0]==="right"?C.left-=f:t.my[0]==="center"&&(C.left-=f/2),t.my[1]==="bottom"?C.top-=c:t.my[1]==="center"&&(C.top-=c/2),C.left+=k[0],C.top+=k[1],e.support.offsetFractions||(C.left=s(C.left),C.top=s(C.top)),o={marginLeft:w,marginTop:x},e.each(["left","top"],function(r,i){e.ui.position[E[r]]&&e.ui.position[E[r]][i](C,{targetWidth:l,targetHeight:d,elemWidth:f,elemHeight:c,collisionPosition:o,collisionWidth:T,collisionHeight:N,offset:[n[0]+k[0],n[1]+k[1]],my:t.my,at:t.at,within:y,elem:a})}),e.fn.bgiframe&&a.bgiframe(),t.using&&(u=function(e){var n=v.left-C.left,s=n+l-f,o=v.top-C.top,u=o+d-c,h={target:{element:g,left:v.left,top:v.top,width:l,height:d},element:{element:a,left:C.left,top:C.top,width:f,height:c},horizontal:s<0?"left":n>0?"right":"center",vertical:u<0?"top":o>0?"bottom":"middle"};l<f&&i(n+s)<l&&(h.horizontal="center"),d<c&&i(o+u)<d&&(h.vertical="middle"),r(i(n),i(s))>r(i(o),i(u))?h.important="horizontal":h.important="vertical",t.using.call(this,e,h)}),a.offset(e.extend(C,{using:u}))})},e.ui.position={fit:{left:function(e,t){var n=t.within,i=n.isWindow?n.scrollLeft:n.offset.left,s=n.width,o=e.left-t.collisionPosition.marginLeft,u=i-o,a=o+t.collisionWidth-s-i,f;t.collisionWidth>s?u>0&&a<=0?(f=e.left+u+t.collisionWidth-s-i,e.left+=u-f):a>0&&u<=0?e.left=i:u>a?e.left=i+s-t.collisionWidth:e.left=i:u>0?e.left+=u:a>0?e.left-=a:e.left=r(e.left-o,e.left)},top:function(e,t){var n=t.within,i=n.isWindow?n.scrollTop:n.offset.top,s=t.within.height,o=e.top-t.collisionPosition.marginTop,u=i-o,a=o+t.collisionHeight-s-i,f;t.collisionHeight>s?u>0&&a<=0?(f=e.top+u+t.collisionHeight-s-i,e.top+=u-f):a>0&&u<=0?e.top=i:u>a?e.top=i+s-t.collisionHeight:e.top=i:u>0?e.top+=u:a>0?e.top-=a:e.top=r(e.top-o,e.top)}},flip:{left:function(e,t){var n=t.within,r=n.offset.left+n.scrollLeft,s=n.width,o=n.isWindow?n.scrollLeft:n.offset.left,u=e.left-t.collisionPosition.marginLeft,a=u-o,f=u+t.collisionWidth-s-o,l=t.my[0]==="left"?-t.elemWidth:t.my[0]==="right"?t.elemWidth:0,c=t.at[0]==="left"?t.targetWidth:t.at[0]==="right"?-t.targetWidth:0,h=-2*t.offset[0],p,d;if(a<0){p=e.left+l+c+h+t.collisionWidth-s-r;if(p<0||p<i(a))e.left+=l+c+h}else if(f>0){d=e.left-t.collisionPosition.marginLeft+l+c+h-o;if(d>0||i(d)<f)e.left+=l+c+h}},top:function(e,t){var n=t.within,r=n.offset.top+n.scrollTop,s=n.height,o=n.isWindow?n.scrollTop:n.offset.top,u=e.top-t.collisionPosition.marginTop,a=u-o,f=u+t.collisionHeight-s-o,l=t.my[1]==="top",c=l?-t.elemHeight:t.my[1]==="bottom"?t.elemHeight:0,h=t.at[1]==="top"?t.targetHeight:t.at[1]==="bottom"?-t.targetHeight:0,p=-2*t.offset[1],d,v;a<0?(v=e.top+c+h+p+t.collisionHeight-s-r,e.top+c+h+p>a&&(v<0||v<i(a))&&(e.top+=c+h+p)):f>0&&(d=e.top-t.collisionPosition.marginTop+c+h+p-o,e.top+c+h+p>f&&(d>0||i(d)<f)&&(e.top+=c+h+p))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,n,r,i,s,o=document.getElementsByTagName("body")[0],u=document.createElement("div");t=document.createElement(o?"div":"body"),r={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},o&&e.extend(r,{position:"absolute",left:"-1000px",top:"-1000px"});for(s in r)t.style[s]=r[s];t.appendChild(u),n=o||document.documentElement,n.insertBefore(t,n.firstChild),u.style.cssText="position: absolute; left: 10.7432222px;",i=e(u).offset().left,e.support.offsetFractions=i>10&&i<11,t.innerHTML="",n.removeChild(t)}(),e.uiBackCompat!==!1&&function(e){var n=e.fn.position;e.fn.position=function(r){if(!r||!r.offset)return n.call(this,r);var i=r.offset.split(" "),s=r.at.split(" ");return i.length===1&&(i[1]=i[0]),/^\d/.test(i[0])&&(i[0]="+"+i[0]),/^\d/.test(i[1])&&(i[1]="+"+i[1]),s.length===1&&(/left|center|right/.test(s[0])?s[1]="center":(s[1]=s[0],s[0]="center")),n.call(this,e.extend(r,{at:s[0]+i[0]+" "+s[1]+i[1],offset:t}))}}(jQuery)})(jQuery);(function(e,t){e.widget("ui.draggable",e.ui.mouse,{version:"1.9.2",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){this.options.helper=="original"&&!/^(?:r|a|f)/.test(this.element.css("position"))&&(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(t){var n=this.options;return this.helper||n.disabled||e(t.target).is(".ui-resizable-handle")?!1:(this.handle=this._getHandle(t),this.handle?(e(n.iframeFix===!0?"iframe":n.iframeFix).each(function(){e('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(t){var n=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),n.containment&&this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,n){this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute");if(!n){var r=this._uiHash();if(this._trigger("drag",t,r)===!1)return this._mouseUp({}),!1;this.position=r.position}if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";return e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var n=!1;e.ui.ddmanager&&!this.options.dropBehaviour&&(n=e.ui.ddmanager.drop(this,t)),this.dropped&&(n=this.dropped,this.dropped=!1);var r=this.element[0],i=!1;while(r&&(r=r.parentNode))r==document&&(i=!0);if(!i&&this.options.helper==="original")return!1;if(this.options.revert=="invalid"&&!n||this.options.revert=="valid"&&n||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,n)){var s=this;e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){s._trigger("stop",t)!==!1&&s._clear()})}else this._trigger("stop",t)!==!1&&this._clear();return!1},_mouseUp:function(t){return e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){var n=!this.options.handle||!e(this.options.handle,this.element).length?!0:!1;return e(this.options.handle,this.element).find("*").andSelf().each(function(){this==t.target&&(n=!0)}),n},_createHelper:function(t){var n=this.options,r=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t])):n.helper=="clone"?this.element.clone().removeAttr("id"):this.element;return r.parents("body").length||r.appendTo(n.appendTo=="parent"?this.element[0].parentNode:n.appendTo),r[0]!=this.element[0]&&!/(fixed|absolute)/.test(r.css("position"))&&r.css("position","absolute"),r},_adjustOffsetFromHelper:function(t){typeof t=="string"&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&e.ui.ie)t={top:0,left:0};return{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;t.containment=="parent"&&(t.containment=this.helper[0].parentNode);if(t.containment=="document"||t.containment=="window")this.containment=[t.containment=="document"?0:e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t.containment=="document"?0:e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,(t.containment=="document"?0:e(window).scrollLeft())+e(t.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(t.containment=="document"?0:e(window).scrollTop())+(e(t.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(t.containment)&&t.containment.constructor!=Array){var n=e(t.containment),r=n[0];if(!r)return;var i=n.offset(),s=e(r).css("overflow")!="hidden";this.containment=[(parseInt(e(r).css("borderLeftWidth"),10)||0)+(parseInt(e(r).css("paddingLeft"),10)||0),(parseInt(e(r).css("borderTopWidth"),10)||0)+(parseInt(e(r).css("paddingTop"),10)||0),(s?Math.max(r.scrollWidth,r.offsetWidth):r.offsetWidth)-(parseInt(e(r).css("borderLeftWidth"),10)||0)-(parseInt(e(r).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(s?Math.max(r.scrollHeight,r.offsetHeight):r.offsetHeight)-(parseInt(e(r).css("borderTopWidth"),10)||0)-(parseInt(e(r).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=n}else t.containment.constructor==Array&&(this.containment=t.containment)},_convertPositionTo:function(t,n){n||(n=this.position);var r=t=="absolute"?1:-1,i=this.options,s=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(s[0].tagName);return{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():o?0:s.scrollTop())*r,left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():o?0:s.scrollLeft())*r}},_generatePosition:function(t){var n=this.options,r=this.cssPosition!="absolute"||this.scrollParent[0]!=document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(r[0].tagName),s=t.pageX,o=t.pageY;if(this.originalPosition){var u;if(this.containment){if(this.relative_container){var a=this.relative_container.offset();u=[this.containment[0]+a.left,this.containment[1]+a.top,this.containment[2]+a.left,this.containment[3]+a.top]}else u=this.containment;t.pageX-this.offset.click.left<u[0]&&(s=u[0]+this.offset.click.left),t.pageY-this.offset.click.top<u[1]&&(o=u[1]+this.offset.click.top),t.pageX-this.offset.click.left>u[2]&&(s=u[2]+this.offset.click.left),t.pageY-this.offset.click.top>u[3]&&(o=u[3]+this.offset.click.top)}if(n.grid){var f=n.grid[1]?this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1]:this.originalPageY;o=u?f-this.offset.click.top<u[1]||f-this.offset.click.top>u[3]?f-this.offset.click.top<u[1]?f+n.grid[1]:f-n.grid[1]:f:f;var l=n.grid[0]?this.originalPageX+Math.round((s-this.originalPageX)/n.grid[0])*n.grid[0]:this.originalPageX;s=u?l-this.offset.click.left<u[0]||l-this.offset.click.left>u[2]?l-this.offset.click.left<u[0]?l+n.grid[0]:l-n.grid[0]:l:l}}return{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():i?0:r.scrollTop()),left:s-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():i?0:r.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,n,r){return r=r||this._uiHash(),e.ui.plugin.call(this,t,[n,r]),t=="drag"&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,n,r)},plugins:{},_uiHash:function(e){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,n){var r=e(this).data("draggable"),i=r.options,s=e.extend({},n,{item:r.element});r.sortables=[],e(i.connectToSortable).each(function(){var n=e.data(this,"sortable");n&&!n.options.disabled&&(r.sortables.push({instance:n,shouldRevert:n.options.revert}),n.refreshPositions(),n._trigger("activate",t,s))})},stop:function(t,n){var r=e(this).data("draggable"),i=e.extend({},n,{item:r.element});e.each(r.sortables,function(){this.instance.isOver?(this.instance.isOver=0,r.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,r.options.helper=="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,i))})},drag:function(t,n){var r=e(this).data("draggable"),i=this,s=function(t){var n=this.offset.click.top,r=this.offset.click.left,i=this.positionAbs.top,s=this.positionAbs.left,o=t.height,u=t.width,a=t.top,f=t.left;return e.ui.isOver(i+n,s+r,a,f,o,u)};e.each(r.sortables,function(s){var o=!1,u=this;this.instance.positionAbs=r.positionAbs,this.instance.helperProportions=r.helperProportions,this.instance.offset.click=r.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(o=!0,e.each(r.sortables,function(){return this.instance.positionAbs=r.positionAbs,this.instance.helperProportions=r.helperProportions,this.instance.offset.click=r.offset.click,this!=u&&this.instance._intersectsWith(this.instance.containerCache)&&e.ui.contains(u.instance.element[0],this.instance.element[0])&&(o=!1),o})),o?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(i).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return n.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=r.offset.click.top,this.instance.offset.click.left=r.offset.click.left,this.instance.offset.parent.left-=r.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=r.offset.parent.top-this.instance.offset.parent.top,r._trigger("toSortable",t),r.dropped=this.instance.element,r.currentItem=r.element,this.instance.fromOutside=r),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),r._trigger("fromSortable",t),r.dropped=!1)})}}),e.ui.plugin.add("draggable","cursor",{start:function(t,n){var r=e("body"),i=e(this).data("draggable").options;r.css("cursor")&&(i._cursor=r.css("cursor")),r.css("cursor",i.cursor)},stop:function(t,n){var r=e(this).data("draggable").options;r._cursor&&e("body").css("cursor",r._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,n){var r=e(n.helper),i=e(this).data("draggable").options;r.css("opacity")&&(i._opacity=r.css("opacity")),r.css("opacity",i.opacity)},stop:function(t,n){var r=e(this).data("draggable").options;r._opacity&&e(n.helper).css("opacity",r._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(t,n){var r=e(this).data("draggable");r.scrollParent[0]!=document&&r.scrollParent[0].tagName!="HTML"&&(r.overflowOffset=r.scrollParent.offset())},drag:function(t,n){var r=e(this).data("draggable"),i=r.options,s=!1;if(r.scrollParent[0]!=document&&r.scrollParent[0].tagName!="HTML"){if(!i.axis||i.axis!="x")r.overflowOffset.top+r.scrollParent[0].offsetHeight-t.pageY<i.scrollSensitivity?r.scrollParent[0].scrollTop=s=r.scrollParent[0].scrollTop+i.scrollSpeed:t.pageY-r.overflowOffset.top<i.scrollSensitivity&&(r.scrollParent[0].scrollTop=s=r.scrollParent[0].scrollTop-i.scrollSpeed);if(!i.axis||i.axis!="y")r.overflowOffset.left+r.scrollParent[0].offsetWidth-t.pageX<i.scrollSensitivity?r.scrollParent[0].scrollLeft=s=r.scrollParent[0].scrollLeft+i.scrollSpeed:t.pageX-r.overflowOffset.left<i.scrollSensitivity&&(r.scrollParent[0].scrollLeft=s=r.scrollParent[0].scrollLeft-i.scrollSpeed)}else{if(!i.axis||i.axis!="x")t.pageY-e(document).scrollTop()<i.scrollSensitivity?s=e(document).scrollTop(e(document).scrollTop()-i.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<i.scrollSensitivity&&(s=e(document).scrollTop(e(document).scrollTop()+i.scrollSpeed));if(!i.axis||i.axis!="y")t.pageX-e(document).scrollLeft()<i.scrollSensitivity?s=e(document).scrollLeft(e(document).scrollLeft()-i.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<i.scrollSensitivity&&(s=e(document).scrollLeft(e(document).scrollLeft()+i.scrollSpeed))}s!==!1&&e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(r,t)}}),e.ui.plugin.add("draggable","snap",{start:function(t,n){var r=e(this).data("draggable"),i=r.options;r.snapElements=[],e(i.snap.constructor!=String?i.snap.items||":data(draggable)":i.snap).each(function(){var t=e(this),n=t.offset();this!=r.element[0]&&r.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:n.top,left:n.left})})},drag:function(t,n){var r=e(this).data("draggable"),i=r.options,s=i.snapTolerance,o=n.offset.left,u=o+r.helperProportions.width,a=n.offset.top,f=a+r.helperProportions.height;for(var l=r.snapElements.length-1;l>=0;l--){var c=r.snapElements[l].left,h=c+r.snapElements[l].width,p=r.snapElements[l].top,d=p+r.snapElements[l].height;if(!(c-s<o&&o<h+s&&p-s<a&&a<d+s||c-s<o&&o<h+s&&p-s<f&&f<d+s||c-s<u&&u<h+s&&p-s<a&&a<d+s||c-s<u&&u<h+s&&p-s<f&&f<d+s)){r.snapElements[l].snapping&&r.options.snap.release&&r.options.snap.release.call(r.element,t,e.extend(r._uiHash(),{snapItem:r.snapElements[l].item})),r.snapElements[l].snapping=!1;continue}if(i.snapMode!="inner"){var v=Math.abs(p-f)<=s,m=Math.abs(d-a)<=s,g=Math.abs(c-u)<=s,y=Math.abs(h-o)<=s;v&&(n.position.top=r._convertPositionTo("relative",{top:p-r.helperProportions.height,left:0}).top-r.margins.top),m&&(n.position.top=r._convertPositionTo("relative",{top:d,left:0}).top-r.margins.top),g&&(n.position.left=r._convertPositionTo("relative",{top:0,left:c-r.helperProportions.width}).left-r.margins.left),y&&(n.position.left=r._convertPositionTo("relative",{top:0,left:h}).left-r.margins.left)}var b=v||m||g||y;if(i.snapMode!="outer"){var v=Math.abs(p-a)<=s,m=Math.abs(d-f)<=s,g=Math.abs(c-o)<=s,y=Math.abs(h-u)<=s;v&&(n.position.top=r._convertPositionTo("relative",{top:p,left:0}).top-r.margins.top),m&&(n.position.top=r._convertPositionTo("relative",{top:d-r.helperProportions.height,left:0}).top-r.margins.top),g&&(n.position.left=r._convertPositionTo("relative",{top:0,left:c}).left-r.margins.left),y&&(n.position.left=r._convertPositionTo("relative",{top:0,left:h-r.helperProportions.width}).left-r.margins.left)}!r.snapElements[l].snapping&&(v||m||g||y||b)&&r.options.snap.snap&&r.options.snap.snap.call(r.element,t,e.extend(r._uiHash(),{snapItem:r.snapElements[l].item})),r.snapElements[l].snapping=v||m||g||y||b}}}),e.ui.plugin.add("draggable","stack",{start:function(t,n){var r=e(this).data("draggable").options,i=e.makeArray(e(r.stack)).sort(function(t,n){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(n).css("zIndex"),10)||0)});if(!i.length)return;var s=parseInt(i[0].style.zIndex)||0;e(i).each(function(e){this.style.zIndex=s+e}),this[0].style.zIndex=s+i.length}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,n){var r=e(n.helper),i=e(this).data("draggable").options;r.css("zIndex")&&(i._zIndex=r.css("zIndex")),r.css("zIndex",i.zIndex)},stop:function(t,n){var r=e(this).data("draggable").options;r._zIndex&&e(n.helper).css("zIndex",r._zIndex)}})})(jQuery);(function(e,t){var n=5;e.widget("ui.slider",e.ui.mouse,{version:"1.9.2",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null},_create:function(){var t,r,i=this.options,s=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),o="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",u=[];this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"+(i.disabled?" ui-slider-disabled ui-disabled":"")),this.range=e([]),i.range&&(i.range===!0&&(i.values||(i.values=[this._valueMin(),this._valueMin()]),i.values.length&&i.values.length!==2&&(i.values=[i.values[0],i.values[0]])),this.range=e("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+(i.range==="min"||i.range==="max"?" ui-slider-range-"+i.range:""))),r=i.values&&i.values.length||1;for(t=s.length;t<r;t++)u.push(o);this.handles=s.add(e(u.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.add(this.range).filter("a").click(function(e){e.preventDefault()}).mouseenter(function(){i.disabled||e(this).addClass("ui-state-hover")}).mouseleave(function(){e(this).removeClass("ui-state-hover")}).focus(function(){i.disabled?e(this).blur():(e(".ui-slider .ui-state-focus").removeClass("ui-state-focus"),e(this).addClass("ui-state-focus"))}).blur(function(){e(this).removeClass("ui-state-focus")}),this.handles.each(function(t){e(this).data("ui-slider-handle-index",t)}),this._on(this.handles,{keydown:function(t){var r,i,s,o,u=e(t.target).data("ui-slider-handle-index");switch(t.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:t.preventDefault();if(!this._keySliding){this._keySliding=!0,e(t.target).addClass("ui-state-active"),r=this._start(t,u);if(r===!1)return}}o=this.options.step,this.options.values&&this.options.values.length?i=s=this.values(u):i=s=this.value();switch(t.keyCode){case e.ui.keyCode.HOME:s=this._valueMin();break;case e.ui.keyCode.END:s=this._valueMax();break;case e.ui.keyCode.PAGE_UP:s=this._trimAlignValue(i+(this._valueMax()-this._valueMin())/n);break;case e.ui.keyCode.PAGE_DOWN:s=this._trimAlignValue(i-(this._valueMax()-this._valueMin())/n);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(i===this._valueMax())return;s=this._trimAlignValue(i+o);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(i===this._valueMin())return;s=this._trimAlignValue(i-o)}this._slide(t,u,s)},keyup:function(t){var n=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,n),this._change(t,n),e(t.target).removeClass("ui-state-active"))}}),this._refreshValue(),this._animateOff=!1},_destroy:function(){this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(t){var n,r,i,s,o,u,a,f,l=this,c=this.options;return c.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),n={x:t.pageX,y:t.pageY},r=this._normValueFromMouse(n),i=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var n=Math.abs(r-l.values(t));i>n&&(i=n,s=e(this),o=t)}),c.range===!0&&this.values(1)===c.min&&(o+=1,s=e(this.handles[o])),u=this._start(t,o),u===!1?!1:(this._mouseSliding=!0,this._handleIndex=o,s.addClass("ui-state-active").focus(),a=s.offset(),f=!e(t.target).parents().andSelf().is(".ui-slider-handle"),this._clickOffset=f?{left:0,top:0}:{left:t.pageX-a.left-s.width()/2,top:t.pageY-a.top-s.height()/2-(parseInt(s.css("borderTopWidth"),10)||0)-(parseInt(s.css("borderBottomWidth"),10)||0)+(parseInt(s.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,o,r),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},n=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,n),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation=this.options.orientation==="vertical"?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,n,r,i,s;return this.orientation==="horizontal"?(t=this.elementSize.width,n=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,n=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),r=n/t,r>1&&(r=1),r<0&&(r=0),this.orientation==="vertical"&&(r=1-r),i=this._valueMax()-this._valueMin(),s=this._valueMin()+r*i,this._trimAlignValue(s)},_start:function(e,t){var n={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("start",e,n)},_slide:function(e,t,n){var r,i,s;this.options.values&&this.options.values.length?(r=this.values(t?0:1),this.options.values.length===2&&this.options.range===!0&&(t===0&&n>r||t===1&&n<r)&&(n=r),n!==this.values(t)&&(i=this.values(),i[t]=n,s=this._trigger("slide",e,{handle:this.handles[t],value:n,values:i}),r=this.values(t?0:1),s!==!1&&this.values(t,n,!0))):n!==this.value()&&(s=this._trigger("slide",e,{handle:this.handles[t],value:n}),s!==!1&&this.value(n))},_stop:function(e,t){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("stop",e,n)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("change",e,n)}},value:function(e){if(arguments.length){this.options.value=this._trimAlignValue(e),this._refreshValue(),this._change(null,0);return}return this._value()},values:function(t,n){var r,i,s;if(arguments.length>1){this.options.values[t]=this._trimAlignValue(n),this._refreshValue(),this._change(null,t);return}if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();r=this.options.values,i=arguments[0];for(s=0;s<r.length;s+=1)r[s]=this._trimAlignValue(i[s]),this._change(null,s);this._refreshValue()},_setOption:function(t,n){var r,i=0;e.isArray(this.options.values)&&(i=this.options.values.length),e.Widget.prototype._setOption.apply(this,arguments);switch(t){case"disabled":n?(this.handles.filter(".ui-state-focus").blur(),this.handles.removeClass("ui-state-hover"),this.handles.prop("disabled",!0),this.element.addClass("ui-disabled")):(this.handles.prop("disabled",!1),this.element.removeClass("ui-disabled"));break;case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":this._animateOff=!0,this._refreshValue();for(r=0;r<i;r+=1)this._change(null,r);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e),e},_values:function(e){var t,n,r;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t),t;n=this.options.values.slice();for(r=0;r<n.length;r+=1)n[r]=this._trimAlignValue(n[r]);return n},_trimAlignValue:function(e){if(e<=this._valueMin())return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,n=(e-this._valueMin())%t,r=e-n;return Math.abs(n)*2>=t&&(r+=n>0?t:-t),parseFloat(r.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var t,n,r,i,s,o=this.options.range,u=this.options,a=this,f=this._animateOff?!1:u.animate,l={};this.options.values&&this.options.values.length?this.handles.each(function(r){n=(a.values(r)-a._valueMin())/(a._valueMax()-a._valueMin())*100,l[a.orientation==="horizontal"?"left":"bottom"]=n+"%",e(this).stop(1,1)[f?"animate":"css"](l,u.animate),a.options.range===!0&&(a.orientation==="horizontal"?(r===0&&a.range.stop(1,1)[f?"animate":"css"]({left:n+"%"},u.animate),r===1&&a.range[f?"animate":"css"]({width:n-t+"%"},{queue:!1,duration:u.animate})):(r===0&&a.range.stop(1,1)[f?"animate":"css"]({bottom:n+"%"},u.animate),r===1&&a.range[f?"animate":"css"]({height:n-t+"%"},{queue:!1,duration:u.animate}))),t=n}):(r=this.value(),i=this._valueMin(),s=this._valueMax(),n=s!==i?(r-i)/(s-i)*100:0,l[this.orientation==="horizontal"?"left":"bottom"]=n+"%",this.handle.stop(1,1)[f?"animate":"css"](l,u.animate),o==="min"&&this.orientation==="horizontal"&&this.range.stop(1,1)[f?"animate":"css"]({width:n+"%"},u.animate),o==="max"&&this.orientation==="horizontal"&&this.range[f?"animate":"css"]({width:100-n+"%"},{queue:!1,duration:u.animate}),o==="min"&&this.orientation==="vertical"&&this.range.stop(1,1)[f?"animate":"css"]({height:n+"%"},u.animate),o==="max"&&this.orientation==="vertical"&&this.range[f?"animate":"css"]({height:100-n+"%"},{queue:!1,duration:u.animate}))}})})(jQuery);
// jquery.event.move
//
// 1.3.1
//
// Stephen Band
//
// Triggers 'movestart', 'move' and 'moveend' events after
// mousemoves following a mousedown cross a distance threshold,
// similar to the native 'dragstart', 'drag' and 'dragend' events.
// Move events are throttled to animation frames. Move event objects
// have the properties:
//
// pageX:
// pageY:   Page coordinates of pointer.
// startX:
// startY:  Page coordinates of pointer at movestart.
// distX:
// distY:  Distance the pointer has moved since movestart.
// deltaX:
// deltaY:  Distance the finger has moved since last event.
// velocityX:
// velocityY:  Average velocity over last few events.


(function (module) {
	if (typeof define === 'function' && define.amd) {
		// AMD. Register as an anonymous module.
		define(['jquery'], module);
	} else {
		// Browser globals
		module(jQuery);
	}
})(function(jQuery, undefined){

	var // Number of pixels a pressed pointer travels before movestart
	    // event is fired.
	    threshold = 6,
	
	    add = jQuery.event.add,
	
	    remove = jQuery.event.remove,

	    // Just sugar, so we can have arguments in the same order as
	    // add and remove.
	    trigger = function(node, type, data) {
	    	jQuery.event.trigger(type, data, node);
	    },

	    // Shim for requestAnimationFrame, falling back to timer. See:
	    // see http://paulirish.com/2011/requestanimationframe-for-smart-animating/
	    requestFrame = (function(){
	    	return (
	    		window.requestAnimationFrame ||
	    		window.webkitRequestAnimationFrame ||
	    		window.mozRequestAnimationFrame ||
	    		window.oRequestAnimationFrame ||
	    		window.msRequestAnimationFrame ||
	    		function(fn, element){
	    			return window.setTimeout(function(){
	    				fn();
	    			}, 25);
	    		}
	    	);
	    })(),
	    
	    ignoreTags = {
	    	textarea: true,
	    	input: true,
	    	select: true,
	    	button: true
	    },
	    
	    mouseevents = {
	    	move: 'mousemove',
	    	cancel: 'mouseup dragstart',
	    	end: 'mouseup'
	    },
	    
	    touchevents = {
	    	move: 'touchmove',
	    	cancel: 'touchend',
	    	end: 'touchend'
	    };


	// Constructors
	
	function Timer(fn){
		var callback = fn,
				active = false,
				running = false;
		
		function trigger(time) {
			if (active){
				callback();
				requestFrame(trigger);
				running = true;
				active = false;
			}
			else {
				running = false;
			}
		}
		
		this.kick = function(fn) {
			active = true;
			if (!running) { trigger(); }
		};
		
		this.end = function(fn) {
			var cb = callback;
			
			if (!fn) { return; }
			
			// If the timer is not running, simply call the end callback.
			if (!running) {
				fn();
			}
			// If the timer is running, and has been kicked lately, then
			// queue up the current callback and the end callback, otherwise
			// just the end callback.
			else {
				callback = active ?
					function(){ cb(); fn(); } : 
					fn ;
				
				active = true;
			}
		};
	}


	// Functions
	
	function returnTrue() {
		return true;
	}
	
	function returnFalse() {
		return false;
	}
	
	function preventDefault(e) {
		e.preventDefault();
	}
	
	function preventIgnoreTags(e) {
		// Don't prevent interaction with form elements.
		if (ignoreTags[ e.target.tagName.toLowerCase() ]) { return; }
		
		e.preventDefault();
	}

	function isLeftButton(e) {
		// Ignore mousedowns on any button other than the left (or primary)
		// mouse button, or when a modifier key is pressed.
		return (e.which === 1 && !e.ctrlKey && !e.altKey);
	}

	function identifiedTouch(touchList, id) {
		var i, l;

		if (touchList.identifiedTouch) {
			return touchList.identifiedTouch(id);
		}
		
		// touchList.identifiedTouch() does not exist in
		// webkit yet… we must do the search ourselves...
		
		i = -1;
		l = touchList.length;
		
		while (++i < l) {
			if (touchList[i].identifier === id) {
				return touchList[i];
			}
		}
	}

	function changedTouch(e, event) {
		var touch = identifiedTouch(e.changedTouches, event.identifier);

		// This isn't the touch you're looking for.
		if (!touch) { return; }

		// Chrome Android (at least) includes touches that have not
		// changed in e.changedTouches. That's a bit annoying. Check
		// that this touch has changed.
		if (touch.pageX === event.pageX && touch.pageY === event.pageY) { return; }

		return touch;
	}


	// Handlers that decide when the first movestart is triggered
	
	function mousedown(e){
		var data;

		if (!isLeftButton(e)) { return; }

		data = {
			target: e.target,
			startX: e.pageX,
			startY: e.pageY,
			timeStamp: e.timeStamp
		};

		add(document, mouseevents.move, mousemove, data);
		add(document, mouseevents.cancel, mouseend, data);
	}

	function mousemove(e){
		var data = e.data;

		checkThreshold(e, data, e, removeMouse);
	}

	function mouseend(e) {
		removeMouse();
	}

	function removeMouse() {
		remove(document, mouseevents.move, mousemove);
		remove(document, mouseevents.cancel, removeMouse);
	}

	function touchstart(e) {
		var touch, template;

		// Don't get in the way of interaction with form elements.
		if (ignoreTags[ e.target.tagName.toLowerCase() ]) { return; }

		touch = e.changedTouches[0];
		
		// iOS live updates the touch objects whereas Android gives us copies.
		// That means we can't trust the touchstart object to stay the same,
		// so we must copy the data. This object acts as a template for
		// movestart, move and moveend event objects.
		template = {
			target: touch.target,
			startX: touch.pageX,
			startY: touch.pageY,
			timeStamp: e.timeStamp,
			identifier: touch.identifier
		};

		// Use the touch identifier as a namespace, so that we can later
		// remove handlers pertaining only to this touch.
		add(document, touchevents.move + '.' + touch.identifier, touchmove, template);
		add(document, touchevents.cancel + '.' + touch.identifier, touchend, template);
	}

	function touchmove(e){
		var data = e.data,
		    touch = changedTouch(e, data);

		if (!touch) { return; }

		checkThreshold(e, data, touch, removeTouch);
	}

	function touchend(e) {
		var template = e.data,
		    touch = identifiedTouch(e.changedTouches, template.identifier);

		if (!touch) { return; }

		removeTouch(template.identifier);
	}

	function removeTouch(identifier) {
		remove(document, '.' + identifier, touchmove);
		remove(document, '.' + identifier, touchend);
	}


	// Logic for deciding when to trigger a movestart.

	function checkThreshold(e, template, touch, fn) {
		var distX = touch.pageX - template.startX,
		    distY = touch.pageY - template.startY;

		// Do nothing if the threshold has not been crossed.
		if ((distX * distX) + (distY * distY) < (threshold * threshold)) { return; }

		triggerStart(e, template, touch, distX, distY, fn);
	}

	function handled() {
		// this._handled should return false once, and after return true.
		this._handled = returnTrue;
		return false;
	}

	function flagAsHandled(e) {
		e._handled();
	}

	function triggerStart(e, template, touch, distX, distY, fn) {
		var node = template.target,
		    touches, time;

		touches = e.targetTouches;
		time = e.timeStamp - template.timeStamp;

		// Create a movestart object with some special properties that
		// are passed only to the movestart handlers.
		template.type = 'movestart';
		template.distX = distX;
		template.distY = distY;
		template.deltaX = distX;
		template.deltaY = distY;
		template.pageX = touch.pageX;
		template.pageY = touch.pageY;
		template.velocityX = distX / time;
		template.velocityY = distY / time;
		template.targetTouches = touches;
		template.finger = touches ?
			touches.length :
			1 ;

		// The _handled method is fired to tell the default movestart
		// handler that one of the move events is bound.
		template._handled = handled;
			
		// Pass the touchmove event so it can be prevented if or when
		// movestart is handled.
		template._preventTouchmoveDefault = function() {
			e.preventDefault();
		};

		// Trigger the movestart event.
		trigger(template.target, template);

		// Unbind handlers that tracked the touch or mouse up till now.
		fn(template.identifier);
	}


	// Handlers that control what happens following a movestart

	function activeMousemove(e) {
		var event = e.data.event,
		    timer = e.data.timer;

		updateEvent(event, e, e.timeStamp, timer);
	}

	function activeMouseend(e) {
		var event = e.data.event,
		    timer = e.data.timer;
		
		removeActiveMouse();

		endEvent(event, timer, function() {
			// Unbind the click suppressor, waiting until after mouseup
			// has been handled.
			setTimeout(function(){
				remove(event.target, 'click', returnFalse);
			}, 0);
		});
	}

	function removeActiveMouse(event) {
		remove(document, mouseevents.move, activeMousemove);
		remove(document, mouseevents.end, activeMouseend);
	}

	function activeTouchmove(e) {
		var event = e.data.event,
		    timer = e.data.timer,
		    touch = changedTouch(e, event);

		if (!touch) { return; }

		// Stop the interface from gesturing
		e.preventDefault();

		event.targetTouches = e.targetTouches;
		updateEvent(event, touch, e.timeStamp, timer);
	}

	function activeTouchend(e) {
		var event = e.data.event,
		    timer = e.data.timer,
		    touch = identifiedTouch(e.changedTouches, event.identifier);

		// This isn't the touch you're looking for.
		if (!touch) { return; }

		removeActiveTouch(event);
		endEvent(event, timer);
	}

	function removeActiveTouch(event) {
		remove(document, '.' + event.identifier, activeTouchmove);
		remove(document, '.' + event.identifier, activeTouchend);
	}


	// Logic for triggering move and moveend events

	function updateEvent(event, touch, timeStamp, timer) {
		var time = timeStamp - event.timeStamp;

		event.type = 'move';
		event.distX =  touch.pageX - event.startX;
		event.distY =  touch.pageY - event.startY;
		event.deltaX = touch.pageX - event.pageX;
		event.deltaY = touch.pageY - event.pageY;
		
		// Average the velocity of the last few events using a decay
		// curve to even out spurious jumps in values.
		event.velocityX = 0.3 * event.velocityX + 0.7 * event.deltaX / time;
		event.velocityY = 0.3 * event.velocityY + 0.7 * event.deltaY / time;
		event.pageX =  touch.pageX;
		event.pageY =  touch.pageY;

		timer.kick();
	}

	function endEvent(event, timer, fn) {
		timer.end(function(){
			event.type = 'moveend';

			trigger(event.target, event);
			
			return fn && fn();
		});
	}


	// jQuery special event definition

	function setup(data, namespaces, eventHandle) {
		// Stop the node from being dragged
		//add(this, 'dragstart.move drag.move', preventDefault);
		
		// Prevent text selection and touch interface scrolling
		//add(this, 'mousedown.move', preventIgnoreTags);
		
		// Tell movestart default handler that we've handled this
		add(this, 'movestart.move', flagAsHandled);

		// Don't bind to the DOM. For speed.
		return true;
	}
	
	function teardown(namespaces) {
		remove(this, 'dragstart drag', preventDefault);
		remove(this, 'mousedown touchstart', preventIgnoreTags);
		remove(this, 'movestart', flagAsHandled);
		
		// Don't bind to the DOM. For speed.
		return true;
	}
	
	function addMethod(handleObj) {
		// We're not interested in preventing defaults for handlers that
		// come from internal move or moveend bindings
		if (handleObj.namespace === "move" || handleObj.namespace === "moveend") {
			return;
		}
		
		// Stop the node from being dragged
		add(this, 'dragstart.' + handleObj.guid + ' drag.' + handleObj.guid, preventDefault, undefined, handleObj.selector);
		
		// Prevent text selection and touch interface scrolling
		add(this, 'mousedown.' + handleObj.guid, preventIgnoreTags, undefined, handleObj.selector);
	}
	
	function removeMethod(handleObj) {
		if (handleObj.namespace === "move" || handleObj.namespace === "moveend") {
			return;
		}
		
		remove(this, 'dragstart.' + handleObj.guid + ' drag.' + handleObj.guid);
		remove(this, 'mousedown.' + handleObj.guid);
	}
	
	jQuery.event.special.movestart = {
		setup: setup,
		teardown: teardown,
		add: addMethod,
		remove: removeMethod,

		_default: function(e) {
			var template, data;
			
			// If no move events were bound to any ancestors of this
			// target, high tail it out of here.
			if (!e._handled()) { return; }

			template = {
				target: e.target,
				startX: e.startX,
				startY: e.startY,
				pageX: e.pageX,
				pageY: e.pageY,
				distX: e.distX,
				distY: e.distY,
				deltaX: e.deltaX,
				deltaY: e.deltaY,
				velocityX: e.velocityX,
				velocityY: e.velocityY,
				timeStamp: e.timeStamp,
				identifier: e.identifier,
				targetTouches: e.targetTouches,
				finger: e.finger
			};

			data = {
				event: template,
				timer: new Timer(function(time){
					trigger(e.target, template);
				})
			};
			
			if (e.identifier === undefined) {
				// We're dealing with a mouse
				// Stop clicks from propagating during a move
				add(e.target, 'click', returnFalse);
				add(document, mouseevents.move, activeMousemove, data);
				add(document, mouseevents.end, activeMouseend, data);
			}
			else {
				// We're dealing with a touch. Stop touchmove doing
				// anything defaulty.
				e._preventTouchmoveDefault();
				add(document, touchevents.move + '.' + e.identifier, activeTouchmove, data);
				add(document, touchevents.end + '.' + e.identifier, activeTouchend, data);
			}
		}
	};

	jQuery.event.special.move = {
		setup: function() {
			// Bind a noop to movestart. Why? It's the movestart
			// setup that decides whether other move events are fired.
			add(this, 'movestart.move', jQuery.noop);
		},
		
		teardown: function() {
			remove(this, 'movestart.move', jQuery.noop);
		}
	};
	
	jQuery.event.special.moveend = {
		setup: function() {
			// Bind a noop to movestart. Why? It's the movestart
			// setup that decides whether other move events are fired.
			add(this, 'movestart.moveend', jQuery.noop);
		},
		
		teardown: function() {
			remove(this, 'movestart.moveend', jQuery.noop);
		}
	};

	add(document, 'mousedown.move', mousedown);
	add(document, 'touchstart.move', touchstart);

	// Make jQuery copy touch event properties over to the jQuery event
	// object, if they are not already listed. But only do the ones we
	// really need. IE7/8 do not have Array#indexOf(), but nor do they
	// have touch events, so let's assume we can ignore them.
	if (typeof Array.prototype.indexOf === 'function') {
		(function(jQuery, undefined){
			var props = ["changedTouches", "targetTouches"],
			    l = props.length;
			
			while (l--) {
				if (jQuery.event.props.indexOf(props[l]) === -1) {
					jQuery.event.props.push(props[l]);
				}
			}
		})(jQuery);
	};
});
// jQuery.event.swipe
// 0.5
// Stephen Band

// Dependencies
// jQuery.event.move 1.2

// One of swipeleft, swiperight, swipeup or swipedown is triggered on
// moveend, when the move has covered a threshold ratio of the dimension
// of the target node, or has gone really fast. Threshold and velocity
// sensitivity changed with:
//
// jQuery.event.special.swipe.settings.threshold
// jQuery.event.special.swipe.settings.sensitivity

(function (module) {
	if (typeof define === 'function' && define.amd) {
		// AMD. Register as an anonymous module.
		define(['jquery'], module);
	} else {
		// Browser globals
		module(jQuery);
	}
})(function(jQuery, undefined){
	var add = jQuery.event.add,
	   
	    remove = jQuery.event.remove,

	    // Just sugar, so we can have arguments in the same order as
	    // add and remove.
	    trigger = function(node, type, data) {
	    	jQuery.event.trigger(type, data, node);
	    },

	    settings = {
	    	// Ratio of distance over target finger must travel to be
	    	// considered a swipe.
	    	threshold: 0.4,
	    	// Faster fingers can travel shorter distances to be considered
	    	// swipes. 'sensitivity' controls how much. Bigger is shorter.
	    	sensitivity: 6
	    };

	function moveend(e) {
		var w, h, event;

		w = e.target.offsetWidth;
		h = e.target.offsetHeight;

		// Copy over some useful properties from the move event
		event = {
			distX: e.distX,
			distY: e.distY,
			velocityX: e.velocityX,
			velocityY: e.velocityY,
			finger: e.finger
		};

		// Find out which of the four directions was swiped
		if (e.distX > e.distY) {
			if (e.distX > -e.distY) {
				if (e.distX/w > settings.threshold || e.velocityX * e.distX/w * settings.sensitivity > 1) {
					event.type = 'swiperight';
					trigger(e.currentTarget, event);
				}
			}
			else {
				if (-e.distY/h > settings.threshold || e.velocityY * e.distY/w * settings.sensitivity > 1) {
					event.type = 'swipeup';
					trigger(e.currentTarget, event);
				}
			}
		}
		else {
			if (e.distX > -e.distY) {
				if (e.distY/h > settings.threshold || e.velocityY * e.distY/w * settings.sensitivity > 1) {
					event.type = 'swipedown';
					trigger(e.currentTarget, event);
				}
			}
			else {
				if (-e.distX/w > settings.threshold || e.velocityX * e.distX/w * settings.sensitivity > 1) {
					event.type = 'swipeleft';
					trigger(e.currentTarget, event);
				}
			}
		}
	}

	function getData(node) {
		var data = jQuery.data(node, 'event_swipe');
		
		if (!data) {
			data = { count: 0 };
			jQuery.data(node, 'event_swipe', data);
		}
		
		return data;
	}

	jQuery.event.special.swipe =
	jQuery.event.special.swipeleft =
	jQuery.event.special.swiperight =
	jQuery.event.special.swipeup =
	jQuery.event.special.swipedown = {
		setup: function( data, namespaces, eventHandle ) {
			var data = getData(this);

			// If another swipe event is already setup, don't setup again.
			if (data.count++ > 0) { return; }

			add(this, 'moveend', moveend);

			return true;
		},

		teardown: function() {
			var data = getData(this);

			// If another swipe event is still setup, don't teardown.
			if (--data.count > 0) { return; }

			remove(this, 'moveend', moveend);

			return true;
		},

		settings: settings
	};
});
var preload;
(function($)
{
	var imgList = [];
	
	jQuery.extend({
		preload: function(imgArr, option) {
			if (imgList)
			{
				for (var i=0; i<imgList.length; i++)
				{
					imgList[i].unbind("load");
				}
				
				imgList.slice(1,imgList.length);
				imgList=undefined;
			}
			
			imgList=new Array();
			var setting = $.extend({
				init: function(loaded, total) {},
				loaded: function(img, loaded, total) {},
				loaded_all: function(loaded, total) {}
			}, option);
			var total = imgArr.length;
			var loaded = 0;
			
			setting.init(0, total);
			for(var i in imgArr) {
				
				imgList.push($("<img src='"+imgArr[i]+"'></img>").unbind("load").bind("load", function(){
					loaded++;
					setting.loaded(this, loaded, total);
					if(loaded == total) {
						setting.loaded_all(loaded, total);
					}	
				}));
			}
			
		}
	});
	
}
)(jQuery);		
/*!
 * iScroll v4.2.5 ~ Copyright (c) 2012 Matteo Spinelli, http://cubiq.org
 * Released under MIT license, http://cubiq.org/license
 */
(function(window, doc){
var m = Math,
	dummyStyle = doc.createElement('div').style,
	vendor = (function () {
		var vendors = 't,webkitT,MozT,msT,OT'.split(','),
			t,
			i = 0,
			l = vendors.length;

		for ( ; i < l; i++ ) {
			t = vendors[i] + 'ransform';
			if ( t in dummyStyle ) {
				return vendors[i].substr(0, vendors[i].length - 1);
			}
		}

		return false;
	})(),
	cssVendor = vendor ? '-' + vendor.toLowerCase() + '-' : '',

	// Style properties
	transform = prefixStyle('transform'),
	transitionProperty = prefixStyle('transitionProperty'),
	transitionDuration = prefixStyle('transitionDuration'),
	transformOrigin = prefixStyle('transformOrigin'),
	transitionTimingFunction = prefixStyle('transitionTimingFunction'),
	transitionDelay = prefixStyle('transitionDelay'),

    // Browser capabilities
	isAndroid = (/android/gi).test(navigator.appVersion),
	isIDevice = (/iphone|ipad/gi).test(navigator.appVersion),
	isTouchPad = (/hp-tablet/gi).test(navigator.appVersion),

    has3d = prefixStyle('perspective') in dummyStyle,
    hasTouch = 'ontouchstart' in window && !isTouchPad,
    hasTransform = vendor !== false,
    hasTransitionEnd = prefixStyle('transition') in dummyStyle,

	RESIZE_EV = 'onorientationchange' in window ? 'orientationchange' : 'resize',
	START_EV = hasTouch ? 'touchstart' : 'mousedown',
	MOVE_EV = hasTouch ? 'touchmove' : 'mousemove',
	END_EV = hasTouch ? 'touchend' : 'mouseup',
	CANCEL_EV = hasTouch ? 'touchcancel' : 'mouseup',
	TRNEND_EV = (function () {
		if ( vendor === false ) return false;

		var transitionEnd = {
				''			: 'transitionend',
				'webkit'	: 'webkitTransitionEnd',
				'Moz'		: 'transitionend',
				'O'			: 'otransitionend',
				'ms'		: 'MSTransitionEnd'
			};

		return transitionEnd[vendor];
	})(),

	nextFrame = (function() {
		return window.requestAnimationFrame ||
			window.webkitRequestAnimationFrame ||
			window.mozRequestAnimationFrame ||
			window.oRequestAnimationFrame ||
			window.msRequestAnimationFrame ||
			function(callback) { return setTimeout(callback, 1); };
	})(),
	cancelFrame = (function () {
		return window.cancelRequestAnimationFrame ||
			window.webkitCancelAnimationFrame ||
			window.webkitCancelRequestAnimationFrame ||
			window.mozCancelRequestAnimationFrame ||
			window.oCancelRequestAnimationFrame ||
			window.msCancelRequestAnimationFrame ||
			clearTimeout;
	})(),

	// Helpers
	translateZ = has3d ? ' translateZ(0)' : '',

	// Constructor
	iScroll = function (el, options) {
		var that = this,
			i;

		that.wrapper = typeof el == 'object' ? el : doc.getElementById(el);
		that.wrapper.style.overflow = 'hidden';
		that.scroller = that.wrapper.children[0];

		// Default options
		that.options = {
			hScroll: true,
			vScroll: true,
			x: 0,
			y: 0,
			bounce: true,
			bounceLock: false,
			momentum: true,
			lockDirection: true,
			useTransform: true,
			useTransition: false,
			topOffset: 0,
			checkDOMChanges: false,		// Experimental
			handleClick: true,

			// Scrollbar
			hScrollbar: true,
			vScrollbar: true,
			fixedScrollbar: isAndroid,
			hideScrollbar: isIDevice,
			fadeScrollbar: isIDevice && has3d,
			scrollbarClass: '',

			// Zoom
			zoom: false,
			zoomMin: 1,
			zoomMax: 4,
			doubleTapZoom: 2,
			wheelAction: 'scroll',

			// Snap
			snap: false,
			snapThreshold: 1,

			// Events
			onRefresh: null,
			onBeforeScrollStart: function (e) { e.preventDefault(); },
			onScrollStart: null,
			onBeforeScrollMove: null,
			onScrollMove: null,
			onBeforeScrollEnd: null,
			onScrollEnd: null,
			onTouchEnd: null,
			onDestroy: null,
			onZoomStart: null,
			onZoom: null,
			onZoomEnd: null
		};

		// User defined options
		for (i in options) that.options[i] = options[i];
		
		// Set starting position
		that.x = that.options.x;
		that.y = that.options.y;

		// Normalize options
		that.options.useTransform = hasTransform && that.options.useTransform;
		that.options.hScrollbar = that.options.hScroll && that.options.hScrollbar;
		that.options.vScrollbar = that.options.vScroll && that.options.vScrollbar;
		that.options.zoom = that.options.useTransform && that.options.zoom;
		that.options.useTransition = hasTransitionEnd && that.options.useTransition;

		// Helpers FIX ANDROID BUG!
		// translate3d and scale doesn't work together!
		// Ignoring 3d ONLY WHEN YOU SET that.options.zoom
		if ( that.options.zoom && isAndroid ){
			translateZ = '';
		}
		
		// Set some default styles
		that.scroller.style[transitionProperty] = that.options.useTransform ? cssVendor + 'transform' : 'top left';
		that.scroller.style[transitionDuration] = '0';
		that.scroller.style[transformOrigin] = '0 0';
		if (that.options.useTransition) that.scroller.style[transitionTimingFunction] = 'cubic-bezier(0.33,0.66,0.66,1)';
		
		if (that.options.useTransform) that.scroller.style[transform] = 'translate(' + that.x + 'px,' + that.y + 'px)' + translateZ;
		else that.scroller.style.cssText += ';position:absolute;top:' + that.y + 'px;left:' + that.x + 'px';

		if (that.options.useTransition) that.options.fixedScrollbar = true;

		that.refresh();

		that._bind(RESIZE_EV, window);
		that._bind(START_EV);
		if (!hasTouch) {
			if (that.options.wheelAction != 'none') {
				that._bind('DOMMouseScroll');
				that._bind('mousewheel');
			}
		}

		if (that.options.checkDOMChanges) that.checkDOMTime = setInterval(function () {
			that._checkDOMChanges();
		}, 500);
	};

// Prototype
iScroll.prototype = {
	enabled: true,
	x: 0,
	y: 0,
	steps: [],
	scale: 1,
	currPageX: 0, currPageY: 0,
	pagesX: [], pagesY: [],
	aniTime: null,
	wheelZoomCount: 0,
	
	handleEvent: function (e) {
		var that = this;
		switch(e.type) {
			case START_EV:
				if (!hasTouch && e.button !== 0) return;
				that._start(e);
				break;
			case MOVE_EV: that._move(e); break;
			case END_EV:
			case CANCEL_EV: that._end(e); break;
			case RESIZE_EV: that._resize(); break;
			case 'DOMMouseScroll': case 'mousewheel': that._wheel(e); break;
			case TRNEND_EV: that._transitionEnd(e); break;
		}
	},
	
	_checkDOMChanges: function () {
		if (this.moved || this.zoomed || this.animating ||
			(this.scrollerW == this.scroller.offsetWidth * this.scale && this.scrollerH == this.scroller.offsetHeight * this.scale)) return;

		this.refresh();
	},
	
	_scrollbar: function (dir) {
		var that = this,
			bar;

		if (!that[dir + 'Scrollbar']) {
			if (that[dir + 'ScrollbarWrapper']) {
				if (hasTransform) that[dir + 'ScrollbarIndicator'].style[transform] = '';
				that[dir + 'ScrollbarWrapper'].parentNode.removeChild(that[dir + 'ScrollbarWrapper']);
				that[dir + 'ScrollbarWrapper'] = null;
				that[dir + 'ScrollbarIndicator'] = null;
			}

			return;
		}

		if (!that[dir + 'ScrollbarWrapper']) {
			// Create the scrollbar wrapper
			bar = doc.createElement('div');

			if (that.options.scrollbarClass) bar.className = that.options.scrollbarClass + dir.toUpperCase();
			else bar.style.cssText = 'position:absolute;z-index:100;' + (dir == 'h' ? 'height:7px;bottom:1px;left:2px;right:' + (that.vScrollbar ? '7' : '2') + 'px' : 'width:7px;bottom:' + (that.hScrollbar ? '7' : '2') + 'px;top:2px;right:1px');

			bar.style.cssText += ';pointer-events:none;' + cssVendor + 'transition-property:opacity;' + cssVendor + 'transition-duration:' + (that.options.fadeScrollbar ? '350ms' : '0') + ';overflow:hidden;opacity:' + (that.options.hideScrollbar ? '0' : '1');

			that.wrapper.appendChild(bar);
			that[dir + 'ScrollbarWrapper'] = bar;

			// Create the scrollbar indicator
			bar = doc.createElement('div');
			if (!that.options.scrollbarClass) {
				bar.style.cssText = 'position:absolute;z-index:100;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);' + cssVendor + 'background-clip:padding-box;' + cssVendor + 'box-sizing:border-box;' + (dir == 'h' ? 'height:100%' : 'width:100%') + ';' + cssVendor + 'border-radius:3px;border-radius:3px';
			}
			bar.style.cssText += ';pointer-events:none;' + cssVendor + 'transition-property:' + cssVendor + 'transform;' + cssVendor + 'transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);' + cssVendor + 'transition-duration:0;' + cssVendor + 'transform: translate(0,0)' + translateZ;
			if (that.options.useTransition) bar.style.cssText += ';' + cssVendor + 'transition-timing-function:cubic-bezier(0.33,0.66,0.66,1)';

			that[dir + 'ScrollbarWrapper'].appendChild(bar);
			that[dir + 'ScrollbarIndicator'] = bar;
		}

		if (dir == 'h') {
			that.hScrollbarSize = that.hScrollbarWrapper.clientWidth;
			that.hScrollbarIndicatorSize = m.max(m.round(that.hScrollbarSize * that.hScrollbarSize / that.scrollerW), 8);
			that.hScrollbarIndicator.style.width = that.hScrollbarIndicatorSize + 'px';
			that.hScrollbarMaxScroll = that.hScrollbarSize - that.hScrollbarIndicatorSize;
			that.hScrollbarProp = that.hScrollbarMaxScroll / that.maxScrollX;
		} else {
			that.vScrollbarSize = that.vScrollbarWrapper.clientHeight;
			that.vScrollbarIndicatorSize = m.max(m.round(that.vScrollbarSize * that.vScrollbarSize / that.scrollerH), 8);
			that.vScrollbarIndicator.style.height = that.vScrollbarIndicatorSize + 'px';
			that.vScrollbarMaxScroll = that.vScrollbarSize - that.vScrollbarIndicatorSize;
			that.vScrollbarProp = that.vScrollbarMaxScroll / that.maxScrollY;
		}

		// Reset position
		that._scrollbarPos(dir, true);
	},
	
	_resize: function () {
		var that = this;
		setTimeout(function () { that.refresh(); }, isAndroid ? 200 : 0);
	},
	
	_pos: function (x, y) {
		if (this.zoomed) return;

		x = this.hScroll ? x : 0;
		y = this.vScroll ? y : 0;


		var w = Number(String(this.scroller.style.width).replace("px", ""));
		if (this.options.useTransform) {
			//if (x>150) x = 150;
			//if (x < 0-(w-$window.width())-150) x = 0-(w - $window.width())-150;
			this.scroller.style[transform] = 'translate(' + x + 'px,' + y + 'px) scale(' + this.scale + ')' + translateZ;
		} else {
			x = m.round(x);
			y = m.round(y);
			this.scroller.style.left = x + 'px';
			this.scroller.style.top = y + 'px';
		}

		this.x = x;
		this.y = y;

		this._scrollbarPos('h');
		this._scrollbarPos('v');
	},

	_scrollbarPos: function (dir, hidden) {
		var that = this,
			pos = dir == 'h' ? that.x : that.y,
			size;

		if (!that[dir + 'Scrollbar']) return;

		pos = that[dir + 'ScrollbarProp'] * pos;

		if (pos < 0) {
			if (!that.options.fixedScrollbar) {
				size = that[dir + 'ScrollbarIndicatorSize'] + m.round(pos * 3);
				if (size < 8) size = 8;
				that[dir + 'ScrollbarIndicator'].style[dir == 'h' ? 'width' : 'height'] = size + 'px';
			}
			pos = 0;
		} else if (pos > that[dir + 'ScrollbarMaxScroll']) {
			if (!that.options.fixedScrollbar) {
				size = that[dir + 'ScrollbarIndicatorSize'] - m.round((pos - that[dir + 'ScrollbarMaxScroll']) * 3);
				if (size < 8) size = 8;
				that[dir + 'ScrollbarIndicator'].style[dir == 'h' ? 'width' : 'height'] = size + 'px';
				pos = that[dir + 'ScrollbarMaxScroll'] + (that[dir + 'ScrollbarIndicatorSize'] - size);
			} else {
				pos = that[dir + 'ScrollbarMaxScroll'];
			}
		}

		that[dir + 'ScrollbarWrapper'].style[transitionDelay] = '0';
		that[dir + 'ScrollbarWrapper'].style.opacity = hidden && that.options.hideScrollbar ? '0' : '1';
		that[dir + 'ScrollbarIndicator'].style[transform] = 'translate(' + (dir == 'h' ? pos + 'px,0)' : '0,' + pos + 'px)') + translateZ;
	},
	
	_start: function (e) {
		var that = this,
			point = hasTouch ? e.touches[0] : e,
			matrix, x, y,
			c1, c2;
		//console.log(this);

		if (!that.enabled) return;

		if (that.options.onBeforeScrollStart) that.options.onBeforeScrollStart.call(that, e);

		if (that.options.useTransition || that.options.zoom) that._transitionTime(0);

		that.moved = false;
		that.animating = false;
		that.zoomed = false;
		that.distX = 0;
		that.distY = 0;
		that.absDistX = 0;
		that.absDistY = 0;
		that.dirX = 0;
		that.dirY = 0;

		// Gesture start
		if (that.options.zoom && hasTouch && e.touches.length > 1) {
			c1 = m.abs(e.touches[0].pageX-e.touches[1].pageX);
			c2 = m.abs(e.touches[0].pageY-e.touches[1].pageY);
			that.touchesDistStart = m.sqrt(c1 * c1 + c2 * c2);

			that.originX = m.abs(e.touches[0].pageX + e.touches[1].pageX - that.wrapperOffsetLeft * 2) / 2 - that.x;
			that.originY = m.abs(e.touches[0].pageY + e.touches[1].pageY - that.wrapperOffsetTop * 2) / 2 - that.y;

			if (that.options.onZoomStart) that.options.onZoomStart.call(that, e);
		}

		if (that.options.momentum) {
			if (that.options.useTransform) {
				// Very lame general purpose alternative to CSSMatrix
				matrix = getComputedStyle(that.scroller, null)[transform].replace(/[^0-9\-.,]/g, '').split(',');
				x = +(matrix[12] || matrix[4]);
				y = +(matrix[13] || matrix[5]);
			} else {
				x = +getComputedStyle(that.scroller, null).left.replace(/[^0-9-]/g, '');
				y = +getComputedStyle(that.scroller, null).top.replace(/[^0-9-]/g, '');
			}
			
			if (x != that.x || y != that.y) {
				if (that.options.useTransition) that._unbind(TRNEND_EV);
				else cancelFrame(that.aniTime);
				that.steps = [];
				that._pos(x, y);
				if (that.options.onScrollEnd) that.options.onScrollEnd.call(that);
			}
		}

		that.absStartX = that.x;	// Needed by snap threshold
		that.absStartY = that.y;

		that.startX = that.x;
		that.startY = that.y;
		that.pointX = point.pageX;
		that.pointY = point.pageY;

		that.startTime = e.timeStamp || Date.now();

		if (that.options.onScrollStart) that.options.onScrollStart.call(that, e);

		that._bind(MOVE_EV, window);
		that._bind(END_EV, window);
		that._bind(CANCEL_EV, window);
	},
	
	_move: function (e) {
		
		var that = this,
			point = hasTouch ? e.touches[0] : e,
			deltaX = point.pageX - that.pointX,
			deltaY = point.pageY - that.pointY,
			newX = that.x + deltaX,
			newY = that.y + deltaY,
			c1, c2, scale,
			timestamp = e.timeStamp || Date.now();

		if (that.options.onBeforeScrollMove) that.options.onBeforeScrollMove.call(that, e);

		// Zoom
		if (that.options.zoom && hasTouch && e.touches.length > 1) {
			c1 = m.abs(e.touches[0].pageX - e.touches[1].pageX);
			c2 = m.abs(e.touches[0].pageY - e.touches[1].pageY);
			that.touchesDist = m.sqrt(c1*c1+c2*c2);

			that.zoomed = true;

			scale = 1 / that.touchesDistStart * that.touchesDist * this.scale;

			if (scale < that.options.zoomMin) scale = 0.5 * that.options.zoomMin * Math.pow(2.0, scale / that.options.zoomMin);
			else if (scale > that.options.zoomMax) scale = 2.0 * that.options.zoomMax * Math.pow(0.5, that.options.zoomMax / scale);

			that.lastScale = scale / this.scale;

			newX = this.originX - this.originX * that.lastScale + this.x,
			newY = this.originY - this.originY * that.lastScale + this.y;

			this.scroller.style[transform] = 'translate(' + newX + 'px,' + newY + 'px) scale(' + scale + ')' + translateZ;

			if (that.options.onZoom) that.options.onZoom.call(that, e);
			return;
		}

		that.pointX = point.pageX;
		that.pointY = point.pageY;

		// Slow down if outside of the boundaries
		if (newX > 0 || newX < that.maxScrollX) {
			newX = that.options.bounce ? that.x + (deltaX / 2) : newX >= 0 || that.maxScrollX >= 0 ? 0 : that.maxScrollX;
		}
		if (newY > that.minScrollY || newY < that.maxScrollY) {
			newY = that.options.bounce ? that.y + (deltaY / 2) : newY >= that.minScrollY || that.maxScrollY >= 0 ? that.minScrollY : that.maxScrollY;
		}

		that.distX += deltaX;
		that.distY += deltaY;
		that.absDistX = m.abs(that.distX);
		that.absDistY = m.abs(that.distY);

		if (that.absDistX < 6 && that.absDistY < 6) {
			return;
		}

		// Lock direction
		if (that.options.lockDirection) {
			if (that.absDistX > that.absDistY + 5) {
				newY = that.y;
				deltaY = 0;
			} else if (that.absDistY > that.absDistX + 5) {
				newX = that.x;
				deltaX = 0;
			}
		}

		that.moved = true;
		that._pos(newX, newY);
		that.dirX = deltaX > 0 ? -1 : deltaX < 0 ? 1 : 0;
		that.dirY = deltaY > 0 ? -1 : deltaY < 0 ? 1 : 0;

		if (timestamp - that.startTime > 300) {
			that.startTime = timestamp;
			that.startX = that.x;
			that.startY = that.y;
		}
		
		if (that.options.onScrollMove) that.options.onScrollMove.call(that, e);
	},
	
	_end: function (e) {
		if (hasTouch && e.touches.length !== 0) return;

		var that = this,
			point = hasTouch ? e.changedTouches[0] : e,
			target, ev,
			momentumX = { dist:0, time:0 },
			momentumY = { dist:0, time:0 },
			duration = (e.timeStamp || Date.now()) - that.startTime,
			newPosX = that.x,
			newPosY = that.y,
			distX, distY,
			newDuration,
			snap,
			scale;

		that._unbind(MOVE_EV, window);
		that._unbind(END_EV, window);
		that._unbind(CANCEL_EV, window);

		if (that.options.onBeforeScrollEnd) that.options.onBeforeScrollEnd.call(that, e);

		if (that.zoomed) {
			scale = that.scale * that.lastScale;
			scale = Math.max(that.options.zoomMin, scale);
			scale = Math.min(that.options.zoomMax, scale);
			that.lastScale = scale / that.scale;
			that.scale = scale;

			that.x = that.originX - that.originX * that.lastScale + that.x;
			that.y = that.originY - that.originY * that.lastScale + that.y;
			
			that.scroller.style[transitionDuration] = '200ms';
			that.scroller.style[transform] = 'translate(' + that.x + 'px,' + that.y + 'px) scale(' + that.scale + ')' + translateZ;
			
			that.zoomed = false;
			that.refresh();

			if (that.options.onZoomEnd) that.options.onZoomEnd.call(that, e);
			return;
		}

		if (!that.moved) {
			if (hasTouch) {
				if (that.doubleTapTimer && that.options.zoom) {
					// Double tapped
					clearTimeout(that.doubleTapTimer);
					that.doubleTapTimer = null;
					if (that.options.onZoomStart) that.options.onZoomStart.call(that, e);
					that.zoom(that.pointX, that.pointY, that.scale == 1 ? that.options.doubleTapZoom : 1);
					if (that.options.onZoomEnd) {
						setTimeout(function() {
							that.options.onZoomEnd.call(that, e);
						}, 200); // 200 is default zoom duration
					}
				} else if (this.options.handleClick) {
					that.doubleTapTimer = setTimeout(function () {
						that.doubleTapTimer = null;

						// Find the last touched element
						target = point.target;
						while (target.nodeType != 1) target = target.parentNode;

						if (target.tagName != 'SELECT' && target.tagName != 'INPUT' && target.tagName != 'TEXTAREA') {
							ev = doc.createEvent('MouseEvents');
							ev.initMouseEvent('click', true, true, e.view, 1,
								point.screenX, point.screenY, point.clientX, point.clientY,
								e.ctrlKey, e.altKey, e.shiftKey, e.metaKey,
								0, null);
							ev._fake = true;
							target.dispatchEvent(ev);
						}
					}, that.options.zoom ? 250 : 0);
				}
			}

			that._resetPos(400);

			if (that.options.onTouchEnd) that.options.onTouchEnd.call(that, e);
			return;
		}

		if (duration < 300 && that.options.momentum) {
			momentumX = newPosX ? that._momentum(newPosX - that.startX, duration, -that.x, that.scrollerW - that.wrapperW + that.x, that.options.bounce ? that.wrapperW : 0) : momentumX;
			momentumY = newPosY ? that._momentum(newPosY - that.startY, duration, -that.y, (that.maxScrollY < 0 ? that.scrollerH - that.wrapperH + that.y - that.minScrollY : 0), that.options.bounce ? that.wrapperH : 0) : momentumY;

			/** FIX MOMENTUM **/
			if (momentumX.dist > 700) momentumX.dist = 700;
			if (momentumX.dist < -700) momentumX.dist = -700;

			newPosX = that.x + momentumX.dist;
			newPosY = that.y + momentumY.dist;

			if ((that.x > 0 && newPosX > 0) || (that.x < that.maxScrollX && newPosX < that.maxScrollX)) momentumX = { dist:0, time:0 };
			if ((that.y > that.minScrollY && newPosY > that.minScrollY) || (that.y < that.maxScrollY && newPosY < that.maxScrollY)) momentumY = { dist:0, time:0 };
		}

		if (momentumX.dist || momentumY.dist) {
			newDuration = m.max(m.max(momentumX.time, momentumY.time), 10);

			// Do we need to snap?
			if (that.options.snap) {
				distX = newPosX - that.absStartX;
				distY = newPosY - that.absStartY;
				if (m.abs(distX) < that.options.snapThreshold && m.abs(distY) < that.options.snapThreshold) { that.scrollTo(that.absStartX, that.absStartY, 200); }
				else {
					snap = that._snap(newPosX, newPosY);
					newPosX = snap.x;
					newPosY = snap.y;
					newDuration = m.max(snap.time, newDuration);
				}
			}

			that.scrollTo(m.round(newPosX), m.round(newPosY), newDuration);

			if (that.options.onTouchEnd) that.options.onTouchEnd.call(that, e);
			return;
		}

		// Do we need to snap?
		if (that.options.snap) {
			distX = newPosX - that.absStartX;
			distY = newPosY - that.absStartY;
			if (m.abs(distX) < that.options.snapThreshold && m.abs(distY) < that.options.snapThreshold) that.scrollTo(that.absStartX, that.absStartY, 200);
			else {
				snap = that._snap(that.x, that.y);
				if (snap.x != that.x || snap.y != that.y) that.scrollTo(snap.x, snap.y, snap.time);
			}

			if (that.options.onTouchEnd) that.options.onTouchEnd.call(that, e);
			return;
		}

		that._resetPos(200);
		if (that.options.onTouchEnd) that.options.onTouchEnd.call(that, e);
	},
	
	_resetPos: function (time) {
		var that = this,
			resetX = that.x >= 0 ? 0 : that.x < that.maxScrollX ? that.maxScrollX : that.x,
			resetY = that.y >= that.minScrollY || that.maxScrollY > 0 ? that.minScrollY : that.y < that.maxScrollY ? that.maxScrollY : that.y;

		if (resetX == that.x && resetY == that.y) {
			if (that.moved) {
				that.moved = false;
				if (that.options.onScrollEnd) that.options.onScrollEnd.call(that);		// Execute custom code on scroll end
			}

			if (that.hScrollbar && that.options.hideScrollbar) {
				if (vendor == 'webkit') that.hScrollbarWrapper.style[transitionDelay] = '300ms';
				that.hScrollbarWrapper.style.opacity = '0';
			}
			if (that.vScrollbar && that.options.hideScrollbar) {
				if (vendor == 'webkit') that.vScrollbarWrapper.style[transitionDelay] = '300ms';
				that.vScrollbarWrapper.style.opacity = '0';
			}

			return;
		}

		that.scrollTo(resetX, resetY, time || 0);
	},

	_wheel: function (e) {
		var that = this,
			wheelDeltaX, wheelDeltaY,
			deltaX, deltaY,
			deltaScale;

		if ('wheelDeltaX' in e) {
			wheelDeltaX = e.wheelDeltaX / 12;
			wheelDeltaY = e.wheelDeltaY / 12;
		} else if('wheelDelta' in e) {
			wheelDeltaX = wheelDeltaY = e.wheelDelta / 12;
		} else if ('detail' in e) {
			wheelDeltaX = wheelDeltaY = -e.detail * 3;
		} else {
			return;
		}
		
		if (that.options.wheelAction == 'zoom') {
			deltaScale = that.scale * Math.pow(2, 1/3 * (wheelDeltaY ? wheelDeltaY / Math.abs(wheelDeltaY) : 0));
			if (deltaScale < that.options.zoomMin) deltaScale = that.options.zoomMin;
			if (deltaScale > that.options.zoomMax) deltaScale = that.options.zoomMax;
			
			if (deltaScale != that.scale) {
				if (!that.wheelZoomCount && that.options.onZoomStart) that.options.onZoomStart.call(that, e);
				that.wheelZoomCount++;
				
				that.zoom(e.pageX, e.pageY, deltaScale, 400);
				
				setTimeout(function() {
					that.wheelZoomCount--;
					if (!that.wheelZoomCount && that.options.onZoomEnd) that.options.onZoomEnd.call(that, e);
				}, 400);
			}
			
			return;
		}
		
		deltaX = that.x + wheelDeltaX;
		deltaY = that.y + wheelDeltaY;

		if (deltaX > 0) deltaX = 0;
		else if (deltaX < that.maxScrollX) deltaX = that.maxScrollX;

		if (deltaY > that.minScrollY) deltaY = that.minScrollY;
		else if (deltaY < that.maxScrollY) deltaY = that.maxScrollY;
    
		if (that.maxScrollY < 0) {
			that.scrollTo(deltaX, deltaY, 0);
		}
	},
	
	_transitionEnd: function (e) {
		var that = this;

		if (e.target != that.scroller) return;

		that._unbind(TRNEND_EV);
		
		that._startAni();
	},


	/**
	*
	* Utilities
	*
	*/
	_startAni: function () {
		var that = this,
			startX = that.x, startY = that.y,
			startTime = Date.now(),
			step, easeOut,
			animate;

		if (that.animating) return;
		
		if (!that.steps.length) {
			that._resetPos(400);
			return;
		}
		
		step = that.steps.shift();
		
		if (step.x == startX && step.y == startY) step.time = 0;

		that.animating = true;
		that.moved = true;
		
		if (that.options.useTransition) {
			that._transitionTime(step.time);
			that._pos(step.x, step.y);
			that.animating = false;
			if (step.time) that._bind(TRNEND_EV);
			else that._resetPos(0);
			return;
		}

		animate = function () {
			var now = Date.now(),
				newX, newY;

			if (now >= startTime + step.time) {
				that._pos(step.x, step.y);
				that.animating = false;
				if (that.options.onAnimationEnd) that.options.onAnimationEnd.call(that);			// Execute custom code on animation end
				that._startAni();
				return;
			}

			now = (now - startTime) / step.time - 1;
			easeOut = m.sqrt(1 - now * now);
			newX = (step.x - startX) * easeOut + startX;
			newY = (step.y - startY) * easeOut + startY;
			that._pos(newX, newY);
			if (that.animating) that.aniTime = nextFrame(animate);
		};

		animate();
	},

	_transitionTime: function (time) {
		time += 'ms';
		this.scroller.style[transitionDuration] = time;
		if (this.hScrollbar) this.hScrollbarIndicator.style[transitionDuration] = time;
		if (this.vScrollbar) this.vScrollbarIndicator.style[transitionDuration] = time;
	},

	_momentum: function (dist, time, maxDistUpper, maxDistLower, size) {
		var deceleration = 0.0006,
			speed = m.abs(dist) / time,
			newDist = (speed * speed) / (2 * deceleration),
			newTime = 0, outsideDist = 0;

		// Proportinally reduce speed if we are outside of the boundaries
		if (dist > 0 && newDist > maxDistUpper) {
			outsideDist = size / (6 / (newDist / speed * deceleration));
			maxDistUpper = maxDistUpper + outsideDist;
			speed = speed * maxDistUpper / newDist;
			newDist = maxDistUpper;
		} else if (dist < 0 && newDist > maxDistLower) {
			outsideDist = size / (6 / (newDist / speed * deceleration));
			maxDistLower = maxDistLower + outsideDist;
			speed = speed * maxDistLower / newDist;
			newDist = maxDistLower;
		}

		newDist = newDist * (dist < 0 ? -1 : 1);
		newTime = speed / deceleration;

		return { dist: newDist, time: m.round(newTime) };
	},

	_offset: function (el) {
		var left = -el.offsetLeft,
			top = -el.offsetTop;
			
		while (el = el.offsetParent) {
			left -= el.offsetLeft;
			top -= el.offsetTop;
		}
		
		if (el != this.wrapper) {
			left *= this.scale;
			top *= this.scale;
		}

		return { left: left, top: top };
	},

	_snap: function (x, y) {
		var that = this,
			i, l,
			page, time,
			sizeX, sizeY;

		// Check page X
		page = that.pagesX.length - 1;
		for (i=0, l=that.pagesX.length; i<l; i++) {
			if (x >= that.pagesX[i]) {
				page = i;
				break;
			}
		}
		if (page == that.currPageX && page > 0 && that.dirX < 0) page--;
		x = that.pagesX[page];
		sizeX = m.abs(x - that.pagesX[that.currPageX]);
		sizeX = sizeX ? m.abs(that.x - x) / sizeX * 500 : 0;
		that.currPageX = page;

		// Check page Y
		page = that.pagesY.length-1;
		for (i=0; i<page; i++) {
			if (y >= that.pagesY[i]) {
				page = i;
				break;
			}
		}
		if (page == that.currPageY && page > 0 && that.dirY < 0) page--;
		y = that.pagesY[page];
		sizeY = m.abs(y - that.pagesY[that.currPageY]);
		sizeY = sizeY ? m.abs(that.y - y) / sizeY * 500 : 0;
		that.currPageY = page;

		// Snap with constant speed (proportional duration)
		time = m.round(m.max(sizeX, sizeY)) || 200;

		return { x: x, y: y, time: time };
	},

	_bind: function (type, el, bubble) {
		(el || this.scroller).addEventListener(type, this, !!bubble);
	},

	_unbind: function (type, el, bubble) {
		(el || this.scroller).removeEventListener(type, this, !!bubble);
	},


	/**
	*
	* Public methods
	*
	*/
	destroy: function () {
		var that = this;

		that.scroller.style[transform] = '';

		// Remove the scrollbars
		that.hScrollbar = false;
		that.vScrollbar = false;
		that._scrollbar('h');
		that._scrollbar('v');

		// Remove the event listeners
		that._unbind(RESIZE_EV, window);
		that._unbind(START_EV);
		that._unbind(MOVE_EV, window);
		that._unbind(END_EV, window);
		that._unbind(CANCEL_EV, window);
		
		if (!that.options.hasTouch) {
			that._unbind('DOMMouseScroll');
			that._unbind('mousewheel');
		}
		
		if (that.options.useTransition) that._unbind(TRNEND_EV);
		
		if (that.options.checkDOMChanges) clearInterval(that.checkDOMTime);
		
		if (that.options.onDestroy) that.options.onDestroy.call(that);
	},

	refresh: function () {
		var that = this,
			offset,
			i, l,
			els,
			pos = 0,
			page = 0;

		if (that.scale < that.options.zoomMin) that.scale = that.options.zoomMin;
		that.wrapperW = that.wrapper.clientWidth || 1;
		that.wrapperH = that.wrapper.clientHeight || 1;

		that.minScrollY = -that.options.topOffset || 0;
		that.scrollerW = m.round(that.scroller.offsetWidth * that.scale);
		that.scrollerH = m.round((that.scroller.offsetHeight + that.minScrollY) * that.scale);
		that.maxScrollX = that.wrapperW - that.scrollerW;
		that.maxScrollY = that.wrapperH - that.scrollerH + that.minScrollY;
		that.dirX = 0;
		that.dirY = 0;

		if (that.options.onRefresh) that.options.onRefresh.call(that);

		that.hScroll = that.options.hScroll && that.maxScrollX < 0;
		that.vScroll = that.options.vScroll && (!that.options.bounceLock && !that.hScroll || that.scrollerH > that.wrapperH);

		that.hScrollbar = that.hScroll && that.options.hScrollbar;
		that.vScrollbar = that.vScroll && that.options.vScrollbar && that.scrollerH > that.wrapperH;

		offset = that._offset(that.wrapper);
		that.wrapperOffsetLeft = -offset.left;
		that.wrapperOffsetTop = -offset.top;

		// Prepare snap
		if (typeof that.options.snap == 'string') {
			that.pagesX = [];
			that.pagesY = [];
			els = that.scroller.querySelectorAll(that.options.snap);
			for (i=0, l=els.length; i<l; i++) {
				pos = that._offset(els[i]);
				pos.left += that.wrapperOffsetLeft;
				pos.top += that.wrapperOffsetTop;
				that.pagesX[i] = pos.left < that.maxScrollX ? that.maxScrollX : pos.left * that.scale;
				that.pagesY[i] = pos.top < that.maxScrollY ? that.maxScrollY : pos.top * that.scale;
			}
		} else if (that.options.snap) {
			that.pagesX = [];
			while (pos >= that.maxScrollX) {
				that.pagesX[page] = pos;
				pos = pos - that.wrapperW;
				page++;
			}
			if (that.maxScrollX%that.wrapperW) that.pagesX[that.pagesX.length] = that.maxScrollX - that.pagesX[that.pagesX.length-1] + that.pagesX[that.pagesX.length-1];

			pos = 0;
			page = 0;
			that.pagesY = [];
			while (pos >= that.maxScrollY) {
				that.pagesY[page] = pos;
				pos = pos - that.wrapperH;
				page++;
			}
			if (that.maxScrollY%that.wrapperH) that.pagesY[that.pagesY.length] = that.maxScrollY - that.pagesY[that.pagesY.length-1] + that.pagesY[that.pagesY.length-1];
		}

		// Prepare the scrollbars
		that._scrollbar('h');
		that._scrollbar('v');

		if (!that.zoomed) {
			that.scroller.style[transitionDuration] = '0';
			that._resetPos(400);
		}
	},

	scrollTo: function (x, y, time, relative) {
		var that = this,
			step = x,
			i, l;

		that.stop();

		if (!step.length) step = [{ x: x, y: y, time: time, relative: relative }];
		
		for (i=0, l=step.length; i<l; i++) {
			if (step[i].relative) { step[i].x = that.x - step[i].x; step[i].y = that.y - step[i].y; }
			that.steps.push({ x: step[i].x, y: step[i].y, time: step[i].time || 0 });
		}

		that._startAni();
	},


	getScrollY: function () {
		var that = this;
		return that.y;
	},  

	 

	getScrollX: function () {
		var that = this;
		return that.x;
	 },  

	scrollToElement: function (el, time) {
		var that = this, pos;
		el = el.nodeType ? el : that.scroller.querySelector(el);
		if (!el) return;

		pos = that._offset(el);
		pos.left += that.wrapperOffsetLeft;
		pos.top += that.wrapperOffsetTop;

		pos.left = pos.left > 0 ? 0 : pos.left < that.maxScrollX ? that.maxScrollX : pos.left;
		pos.top = pos.top > that.minScrollY ? that.minScrollY : pos.top < that.maxScrollY ? that.maxScrollY : pos.top;
		time = time === undefined ? m.max(m.abs(pos.left)*2, m.abs(pos.top)*2) : time;

		that.scrollTo(pos.left, pos.top, time);
	},

	scrollToPage: function (pageX, pageY, time) {
		var that = this, x, y;
		
		time = time === undefined ? 400 : time;

		if (that.options.onScrollStart) that.options.onScrollStart.call(that);

		if (that.options.snap) {
			pageX = pageX == 'next' ? that.currPageX+1 : pageX == 'prev' ? that.currPageX-1 : pageX;
			pageY = pageY == 'next' ? that.currPageY+1 : pageY == 'prev' ? that.currPageY-1 : pageY;

			pageX = pageX < 0 ? 0 : pageX > that.pagesX.length-1 ? that.pagesX.length-1 : pageX;
			pageY = pageY < 0 ? 0 : pageY > that.pagesY.length-1 ? that.pagesY.length-1 : pageY;

			that.currPageX = pageX;
			that.currPageY = pageY;
			x = that.pagesX[pageX];
			y = that.pagesY[pageY];
		} else {
			x = -that.wrapperW * pageX;
			y = -that.wrapperH * pageY;
			if (x < that.maxScrollX) x = that.maxScrollX;
			if (y < that.maxScrollY) y = that.maxScrollY;
		}

		that.scrollTo(x, y, time);
	},

	disable: function () {
		this.stop();
		this._resetPos(0);
		this.enabled = false;

		// If disabled after touchstart we make sure that there are no left over events
		this._unbind(MOVE_EV, window);
		this._unbind(END_EV, window);
		this._unbind(CANCEL_EV, window);
	},
	
	enable: function () {
		this.enabled = true;
	},
	
	stop: function () {
		if (this.options.useTransition) this._unbind(TRNEND_EV);
		else cancelFrame(this.aniTime);
		this.steps = [];
		this.moved = false;
		this.animating = false;
	},
	
	zoom: function (x, y, scale, time) {
		var that = this,
			relScale = scale / that.scale;

		if (!that.options.useTransform) return;

		that.zoomed = true;
		time = time === undefined ? 200 : time;
		x = x - that.wrapperOffsetLeft - that.x;
		y = y - that.wrapperOffsetTop - that.y;
		that.x = x - x * relScale + that.x;
		that.y = y - y * relScale + that.y;

		that.scale = scale;
		that.refresh();

		that.x = that.x > 0 ? 0 : that.x < that.maxScrollX ? that.maxScrollX : that.x;
		that.y = that.y > that.minScrollY ? that.minScrollY : that.y < that.maxScrollY ? that.maxScrollY : that.y;

		that.scroller.style[transitionDuration] = time + 'ms';
		that.scroller.style[transform] = 'translate(' + that.x + 'px,' + that.y + 'px) scale(' + scale + ')' + translateZ;
		that.zoomed = false;
	},
	
	isReady: function () {
		return !this.moved && !this.zoomed && !this.animating;
	}
};

function prefixStyle (style) {
	if ( vendor === '' ) return style;

	style = style.charAt(0).toUpperCase() + style.substr(1);
	return vendor + style;
}

dummyStyle = null;	// for the sake of it

if (typeof exports !== 'undefined') exports.iScroll = iScroll;
else window.iScroll = iScroll;

})(window, document);
﻿/* http://keith-wood.name/backgroundPos.html
   Background position animation for jQuery v1.1.0.
   Written by Keith Wood (kbwood{at}iinet.com.au) November 2010.
   Dual licensed under the GPL (http://dev.jquery.com/browser/trunk/jquery/GPL-LICENSE.txt) and 
   MIT (http://dev.jquery.com/browser/trunk/jquery/MIT-LICENSE.txt) licenses. 
   Please attribute the author if you use it. */
(function($){var g='bgPos';var h=!!$.Tween;if(h){$.Tween.propHooks['backgroundPosition']={get:function(a){return parseBackgroundPosition($(a.elem).css(a.prop))},set:function(a){setBackgroundPosition(a)}}}else{$.fx.step['backgroundPosition']=setBackgroundPosition};function parseBackgroundPosition(c){var d=(c||'').split(/ /);var e={center:'50%',left:'0%',right:'100%',top:'0%',bottom:'100%'};var f=function(a){var b=(e[d[a]]||d[a]||'50%').match(/^([+-]=)?([+-]?\d+(\.\d*)?)(.*)$/);d[a]=[b[1],parseFloat(b[2]),b[4]||'px']};if(d.length==1&&$.inArray(d[0],['top','bottom'])>-1){d[1]=d[0];d[0]='50%'}f(0);f(1);return d}function setBackgroundPosition(a){if(!a.set){initBackgroundPosition(a)}$(a.elem).css('background-position',((a.pos*(a.end[0][1]-a.start[0][1])+a.start[0][1])+a.end[0][2])+' '+((a.pos*(a.end[1][1]-a.start[1][1])+a.start[1][1])+a.end[1][2]))}function initBackgroundPosition(a){var b=$(a.elem);var c=b.data(g);b.css('backgroundPosition',c);a.start=parseBackgroundPosition(c);a.end=parseBackgroundPosition($.fn.jquery>='1.6'?a.end:a.options.curAnim['backgroundPosition']||a.options.curAnim['background-position']);for(var i=0;i<a.end.length;i++){if(a.end[i][0]){a.end[i][1]=a.start[i][1]+(a.end[i][0]=='-='?-1:+1)*a.end[i][1]}}a.set=true}$.fn.animate=function(e){return function(a,b,c,d){if(a['backgroundPosition']||a['background-position']){this.data(g,this.css('backgroundPosition')||'left top')}return e.apply(this,[a,b,c,d])}}($.fn.animate)})(jQuery);
/*!
 * jQuery Transit - CSS3 transitions and transformations
 * (c) 2011-2012 Rico Sta. Cruz <rico@ricostacruz.com>
 * MIT Licensed.
 *
 * http://ricostacruz.com/jquery.transit
 * http://github.com/rstacruz/jquery.transit
 */
(function(d){function m(a){if(a in j.style)return a;var b=["Moz","Webkit","O","ms"],c=a.charAt(0).toUpperCase()+a.substr(1);if(a in j.style)return a;for(a=0;a<b.length;++a){var d=b[a]+c;if(d in j.style)return d}}function l(a){"string"===typeof a&&this.parse(a);return this}function q(a,b,c,e){var h=[];d.each(a,function(a){a=d.camelCase(a);a=d.transit.propertyMap[a]||d.cssProps[a]||a;a=a.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()});-1===d.inArray(a,h)&&h.push(a)});d.cssEase[c]&&(c=d.cssEase[c]);
var f=""+n(b)+" "+c;0<parseInt(e,10)&&(f+=" "+n(e));var g=[];d.each(h,function(a,b){g.push(b+" "+f)});return g.join(", ")}function f(a,b){b||(d.cssNumber[a]=!0);d.transit.propertyMap[a]=e.transform;d.cssHooks[a]={get:function(b){return d(b).css("transit:transform").get(a)},set:function(b,e){var h=d(b).css("transit:transform");h.setFromString(a,e);d(b).css({"transit:transform":h})}}}function g(a,b){return"string"===typeof a&&!a.match(/^[\-0-9\.]+$/)?a:""+a+b}function n(a){d.fx.speeds[a]&&(a=d.fx.speeds[a]);
return g(a,"ms")}d.transit={version:"0.9.9",propertyMap:{marginLeft:"margin",marginRight:"margin",marginBottom:"margin",marginTop:"margin",paddingLeft:"padding",paddingRight:"padding",paddingBottom:"padding",paddingTop:"padding"},enabled:!0,useTransitionEnd:!1};var j=document.createElement("div"),e={},r=-1<navigator.userAgent.toLowerCase().indexOf("chrome");e.transition=m("transition");e.transitionDelay=m("transitionDelay");e.transform=m("transform");e.transformOrigin=m("transformOrigin");j.style[e.transform]=
"";j.style[e.transform]="rotateY(90deg)";e.transform3d=""!==j.style[e.transform];var p=e.transitionEnd={transition:"transitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",WebkitTransition:"webkitTransitionEnd",msTransition:"MSTransitionEnd"}[e.transition]||null,k;for(k in e)e.hasOwnProperty(k)&&"undefined"===typeof d.support[k]&&(d.support[k]=e[k]);j=null;d.cssEase={_default:"ease","in":"ease-in",out:"ease-out","in-out":"ease-in-out",snap:"cubic-bezier(0,1,.5,1)",easeOutCubic:"cubic-bezier(.215,.61,.355,1)",
easeInOutCubic:"cubic-bezier(.645,.045,.355,1)",easeInCirc:"cubic-bezier(.6,.04,.98,.335)",easeOutCirc:"cubic-bezier(.075,.82,.165,1)",easeInOutCirc:"cubic-bezier(.785,.135,.15,.86)",easeInExpo:"cubic-bezier(.95,.05,.795,.035)",easeOutExpo:"cubic-bezier(.19,1,.22,1)",easeInOutExpo:"cubic-bezier(1,0,0,1)",easeInQuad:"cubic-bezier(.55,.085,.68,.53)",easeOutQuad:"cubic-bezier(.25,.46,.45,.94)",easeInOutQuad:"cubic-bezier(.455,.03,.515,.955)",easeInQuart:"cubic-bezier(.895,.03,.685,.22)",easeOutQuart:"cubic-bezier(.165,.84,.44,1)",
easeInOutQuart:"cubic-bezier(.77,0,.175,1)",easeInQuint:"cubic-bezier(.755,.05,.855,.06)",easeOutQuint:"cubic-bezier(.23,1,.32,1)",easeInOutQuint:"cubic-bezier(.86,0,.07,1)",easeInSine:"cubic-bezier(.47,0,.745,.715)",easeOutSine:"cubic-bezier(.39,.575,.565,1)",easeInOutSine:"cubic-bezier(.445,.05,.55,.95)",easeInBack:"cubic-bezier(.6,-.28,.735,.045)",easeOutBack:"cubic-bezier(.175, .885,.32,1.275)",easeInOutBack:"cubic-bezier(.68,-.55,.265,1.55)"};d.cssHooks["transit:transform"]={get:function(a){return d(a).data("transform")||
new l},set:function(a,b){var c=b;c instanceof l||(c=new l(c));a.style[e.transform]="WebkitTransform"===e.transform&&!r?c.toString(!0):c.toString();d(a).data("transform",c)}};d.cssHooks.transform={set:d.cssHooks["transit:transform"].set};"1.8">d.fn.jquery&&(d.cssHooks.transformOrigin={get:function(a){return a.style[e.transformOrigin]},set:function(a,b){a.style[e.transformOrigin]=b}},d.cssHooks.transition={get:function(a){return a.style[e.transition]},set:function(a,b){a.style[e.transition]=b}});f("scale");
f("translate");f("rotate");f("rotateX");f("rotateY");f("rotate3d");f("perspective");f("skewX");f("skewY");f("x",!0);f("y",!0);l.prototype={setFromString:function(a,b){var c="string"===typeof b?b.split(","):b.constructor===Array?b:[b];c.unshift(a);l.prototype.set.apply(this,c)},set:function(a){var b=Array.prototype.slice.apply(arguments,[1]);this.setter[a]?this.setter[a].apply(this,b):this[a]=b.join(",")},get:function(a){return this.getter[a]?this.getter[a].apply(this):this[a]||0},setter:{rotate:function(a){this.rotate=
g(a,"deg")},rotateX:function(a){this.rotateX=g(a,"deg")},rotateY:function(a){this.rotateY=g(a,"deg")},scale:function(a,b){void 0===b&&(b=a);this.scale=a+","+b},skewX:function(a){this.skewX=g(a,"deg")},skewY:function(a){this.skewY=g(a,"deg")},perspective:function(a){this.perspective=g(a,"px")},x:function(a){this.set("translate",a,null)},y:function(a){this.set("translate",null,a)},translate:function(a,b){void 0===this._translateX&&(this._translateX=0);void 0===this._translateY&&(this._translateY=0);
null!==a&&void 0!==a&&(this._translateX=g(a,"px"));null!==b&&void 0!==b&&(this._translateY=g(b,"px"));this.translate=this._translateX+","+this._translateY}},getter:{x:function(){return this._translateX||0},y:function(){return this._translateY||0},scale:function(){var a=(this.scale||"1,1").split(",");a[0]&&(a[0]=parseFloat(a[0]));a[1]&&(a[1]=parseFloat(a[1]));return a[0]===a[1]?a[0]:a},rotate3d:function(){for(var a=(this.rotate3d||"0,0,0,0deg").split(","),b=0;3>=b;++b)a[b]&&(a[b]=parseFloat(a[b]));
a[3]&&(a[3]=g(a[3],"deg"));return a}},parse:function(a){var b=this;a.replace(/([a-zA-Z0-9]+)\((.*?)\)/g,function(a,d,e){b.setFromString(d,e)})},toString:function(a){var b=[],c;for(c in this)if(this.hasOwnProperty(c)&&(e.transform3d||!("rotateX"===c||"rotateY"===c||"perspective"===c||"transformOrigin"===c)))"_"!==c[0]&&(a&&"scale"===c?b.push(c+"3d("+this[c]+",1)"):a&&"translate"===c?b.push(c+"3d("+this[c]+",0)"):b.push(c+"("+this[c]+")"));return b.join(" ")}};d.fn.transition=d.fn.transit=function(a,
b,c,f){var h=this,g=0,j=!0;"function"===typeof b&&(f=b,b=void 0);"function"===typeof c&&(f=c,c=void 0);"undefined"!==typeof a.easing&&(c=a.easing,delete a.easing);"undefined"!==typeof a.duration&&(b=a.duration,delete a.duration);"undefined"!==typeof a.complete&&(f=a.complete,delete a.complete);"undefined"!==typeof a.queue&&(j=a.queue,delete a.queue);"undefined"!==typeof a.delay&&(g=a.delay,delete a.delay);"undefined"===typeof b&&(b=d.fx.speeds._default);"undefined"===typeof c&&(c=d.cssEase._default);
b=n(b);var l=q(a,b,c,g),k=d.transit.enabled&&e.transition?parseInt(b,10)+parseInt(g,10):0;if(0===k)return b=j,c=function(b){h.css(a);f&&f.apply(h);b&&b()},!0===b?h.queue(c):b?h.queue(b,c):c(),h;var m={};b=j;c=function(b){this.offsetWidth;var c=!1,g=function(){c&&h.unbind(p,g);0<k&&h.each(function(){this.style[e.transition]=m[this]||null});"function"===typeof f&&f.apply(h);"function"===typeof b&&b()};0<k&&p&&d.transit.useTransitionEnd?(c=!0,h.bind(p,g)):window.setTimeout(g,k);h.each(function(){0<k&&
(this.style[e.transition]=l);d(this).css(a)})};!0===b?h.queue(c):b?h.queue(b,c):c();return this};d.transit.getTransitionValue=q})(jQuery);

(function($)
{
	$.fn.removeTransition = function()
	{
		return this.each(function() {

			var $this = $(this);
			
			$this
			.css('transition', '')
			.css('-webkit-transition', '')
			.css('-moz-transition', '')
			.css('-ms-transition', '')
			.css('-o-transition', '');
		});
	};
}
)(jQuery);
(function() {
	
	var BrowserDetect = {
		init: function () {
			this.browser = this.searchString(this.dataBrowser) || "An unknown browser";
			this.version = this.searchVersion(navigator.userAgent)
				|| this.searchVersion(navigator.appVersion)
				|| "an unknown version";
			this.OS = this.searchString(this.dataOS) || "an unknown OS";
		},
		searchString: function (data) {
			for (var i=0;i<data.length;i++)	{
				var dataString = data[i].string;
				var dataProp = data[i].prop;
				this.versionSearchString = data[i].versionSearch || data[i].identity;
				if (dataString) {
					if (dataString.indexOf(data[i].subString) != -1)
						return data[i].identity;
				}
				else if (dataProp)
					return data[i].identity;
			}
		},
		searchVersion: function (dataString) {
			var index = dataString.indexOf(this.versionSearchString);
			if (index == -1) return;
			return parseFloat(dataString.substring(index+this.versionSearchString.length+1));
		},
		dataBrowser: [
			{
				string: navigator.userAgent,
				subString: "Chrome",
				identity: "Chrome"
			},
			{ 	string: navigator.userAgent,
				subString: "OmniWeb",
				versionSearch: "OmniWeb/",
				identity: "OmniWeb"
			},
			{
				string: navigator.vendor,
				subString: "Apple",
				identity: "Safari",
				versionSearch: "Version"
			},
			{
				prop: window.opera,
				identity: "Opera"
			},
			{
				string: navigator.vendor,
				subString: "iCab",
				identity: "iCab"
			},
			{
				string: navigator.vendor,
				subString: "KDE",
				identity: "Konqueror"
			},
			{
				string: navigator.userAgent,
				subString: "Firefox",
				identity: "Firefox"
			},
			{
				string: navigator.vendor,
				subString: "Camino",
				identity: "Camino"
			},
			{		// for newer Netscapes (6+)
				string: navigator.userAgent,
				subString: "Netscape",
				identity: "Netscape"
			},
			{
				string: navigator.userAgent,
				subString: "MSIE",
				identity: "Explorer",
				versionSearch: "MSIE"
			},
			{
				string: navigator.userAgent,
				subString: "Gecko",
				identity: "Mozilla",
				versionSearch: "rv"
			},
			{ 		// for older Netscapes (4-)
				string: navigator.userAgent,
				subString: "Mozilla",
				identity: "Netscape",
				versionSearch: "Mozilla"
			}
		],
		dataOS : [
			{
				string: navigator.platform,
				subString: "Win",
				identity: "Windows"
			},
			{
				string: navigator.platform,
				subString: "Mac",
				identity: "Mac"
			},
			{
				string: navigator.userAgent,
				subString: "iPhone",
				identity: "iPhone/iPod"
		    },
			{
				string: navigator.platform,
				subString: "Linux",
				identity: "Linux"
			}
		]
	
	};
	
	BrowserDetect.init();
	
	window.$.client = { os : BrowserDetect.OS, browser : BrowserDetect.browser };
	
})();
/*	
 *	jQuery dotdotdot 1.5.4
 *	
 *	Copyright (c) 2013 Fred Heusschen
 *	www.frebsite.nl
 *
 *	Plugin website:
 *	dotdotdot.frebsite.nl
 *
 *	Dual licensed under the MIT and GPL licenses.
 *	http://en.wikipedia.org/wiki/MIT_License
 *	http://en.wikipedia.org/wiki/GNU_General_Public_License
 */


(function( $ )
{
	if ( $.fn.dotdotdot )
	{
		return;
	}

	$.fn.dotdotdot = function( o )
	{
		
		if ( this.length == 0 )
		{
			debug( true, 'No element found for "' + this.selector + '".' );
			return this;
		}
		if ( this.length > 1 )
		{
			return this.each(
				function()
				{
					$(this).dotdotdot( o );
				}
			);
		}


		var $dot = this;

		if ( $dot.data( 'dotdotdot' ) )
		{
			$dot.trigger( 'destroy.dot' );
		}

		$dot.bind_events = function()
		{
			$dot.bind(
				'update.dot',
				function( e, c )
				{
					e.preventDefault();
					e.stopPropagation();

					opts.maxHeight = ( typeof opts.height == 'number' ) 
						? opts.height 
						: getTrueInnerHeight( $dot );

					opts.maxHeight += opts.tolerance;

					if ( typeof c != 'undefined' )
					{
						if ( typeof c == 'string' || c instanceof HTMLElement )
						{
					 		c = $('<div />').append( c ).contents();
						}
						if ( c instanceof $ )
						{
							orgContent = c;
						}
					}
					$inr = $dot.wrapInner( '<div class="dotdotdot" />' ).children();
					$inr.empty()
						.append( orgContent.clone( true ) )
						.css({
							'height'	: 'auto',
							'width'		: 'auto',
							'border'	: 'none',
							'padding'	: 0,
							'margin'	: 0
						});

					var after = false,
						trunc = false;

					if ( conf.afterElement )
					{
						after = conf.afterElement.clone( true );
						conf.afterElement.remove();
					}
					if ( test( $inr, opts ) )
					{
						if ( opts.wrap == 'children' )
						{
							trunc = children( $inr, opts, after );
						}
						else
						{
							trunc = ellipsis( $inr, $dot, $inr, opts, after );
						}
					}
					$inr.replaceWith( $inr.contents() );
					$inr = null;
					
					if ( $.isFunction( opts.callback ) )
					{
						opts.callback.call( $dot[ 0 ], trunc, orgContent );
					}

					conf.isTruncated = trunc;
					return trunc;
				}

			).bind(
				'isTruncated.dot',
				function( e, fn )
				{
					e.preventDefault();
					e.stopPropagation();

					if ( typeof fn == 'function' )
					{
						fn.call( $dot[ 0 ], conf.isTruncated );
					}
					return conf.isTruncated;
				}

			).bind(
				'originalContent.dot',
				function( e, fn )
				{
					e.preventDefault();
					e.stopPropagation();

					if ( typeof fn == 'function' )
					{
						fn.call( $dot[ 0 ], orgContent );
					}
					return orgContent;
				}

			).bind(
				'destroy.dot',
				function( e )
				{
					e.preventDefault();
					e.stopPropagation();

					$dot.unwatch()
						.unbind_events()
						.empty()
						.append( orgContent )
						.data( 'dotdotdot', false );
				}
			);
			return $dot;
		};	//	/bind_events

		$dot.unbind_events = function()
		{
			$dot.unbind('.dot');
			return $dot;
		};	//	/unbind_events

		$dot.watch = function()
		{
			$dot.unwatch();
			if ( opts.watch == 'window' )
			{
				var $window = $(window),
					_wWidth = $window.width(),
					_wHeight = $window.height(); 

				$window.bind(
					'resize.dot' + conf.dotId,
					function()
					{
						if ( _wWidth != $window.width() || _wHeight != $window.height() || !opts.windowResizeFix )
						{
							_wWidth = $window.width();
							_wHeight = $window.height();
	
							if ( watchInt )
							{
								clearInterval( watchInt );
							}
							watchInt = setTimeout(
								function()
								{
									$dot.trigger( 'update.dot' );
								}, 10
							);
						}
					}
				);
			}
			else
			{
				watchOrg = getSizes( $dot );
				watchInt = setInterval(
					function()
					{
						var watchNew = getSizes( $dot );
						if ( watchOrg.width  != watchNew.width ||
							 watchOrg.height != watchNew.height )
						{
							$dot.trigger( 'update.dot' );
							watchOrg = getSizes( $dot );
						}
					}, 100
				);
			}
			return $dot;
		};
		$dot.unwatch = function()
		{
			$(window).unbind( 'resize.dot' + conf.dotId );
			if ( watchInt )
			{
				clearInterval( watchInt );
			}
			return $dot;
		};

		var	orgContent	= $dot.contents(),
			opts 		= $.extend( true, {}, $.fn.dotdotdot.defaults, o ),
			conf		= {},
			watchOrg	= {},
			watchInt	= null,
			$inr		= null;

		conf.afterElement	= getElement( opts.after, $dot );
		conf.isTruncated	= false;
		conf.dotId			= dotId++;


		$dot.data( 'dotdotdot', true )
			.bind_events()
			.trigger( 'update.dot' );

		if ( opts.watch )
		{
			$dot.watch();
		}

		return $dot;
	};


	//	public
	$.fn.dotdotdot.defaults = {
		'ellipsis'	: '... ',
		'wrap'		: 'word',
		'lastCharacter': {
			'remove'		: [ ' ', ',', ';', '.', '!', '?' ],
			'noEllipsis'	: []
		},
		'tolerance'	: 0,
		'callback'	: null,
		'after'		: null,
		'height'	: null,
		'watch'		: false,
		'windowResizeFix': true,
		'debug'		: false
	};
	

	//	private
	var dotId = 1;

	function children( $elem, o, after )
	{
		var $elements 	= $elem.children(),
			isTruncated	= false;

		$elem.empty();

		for ( var a = 0, l = $elements.length; a < l; a++ )
		{
			var $e = $elements.eq( a );
			$elem.append( $e );
			if ( after )
			{
				$elem.append( after );
			}
			if ( test( $elem, o ) )
			{
				$e.remove();
				isTruncated = true;
				break;
			}
			else
			{
				if ( after )
				{
					after.remove();
				}
			}
		}
		return isTruncated;
	}
	function ellipsis( $elem, $d, $i, o, after )
	{
		var $elements 	= $elem.contents(),
			isTruncated	= false;

		$elem.empty();

		var notx = 'table, thead, tbody, tfoot, tr, col, colgroup, object, embed, param, ol, ul, dl, select, optgroup, option, textarea, script, style';
		for ( var a = 0, l = $elements.length; a < l; a++ )
		{

			if ( isTruncated )
			{
				break;
			}

			var e	= $elements[ a ],
				$e	= $(e);

			if ( typeof e == 'undefined' )
			{
				continue;
			}

			$elem.append( $e );
			if ( after )
			{
				$elem[ ( $elem.is( notx ) ) ? 'after' : 'append' ]( after );
			}
			if ( e.nodeType == 3 )
			{
				if ( test( $i, o ) )
				{
					isTruncated = ellipsisElement( $e, $d, $i, o, after );
				}
			}
			else
			{
				isTruncated = ellipsis( $e, $d, $i, o, after );
			}

			if ( !isTruncated )
			{
				if ( after )
				{
					after.remove();
				}
			}
		}
		return isTruncated;
	}
	function ellipsisElement( $e, $d, $i, o, after )
	{
		var isTruncated	= false,
			e = $e[ 0 ];

		if ( typeof e == 'undefined' )
		{
			return false;
		}

		var seporator	= ( o.wrap == 'letter' ) ? '' : ' ',
			textArr		= getTextContent( e ).split( seporator ),
			position 	= -1,
			midPos		= -1,
			startPos	= 0,
			endPos		= textArr.length - 1;

		while ( startPos <= endPos )
		{
			var m = Math.floor( ( startPos + endPos ) / 2 );
			if ( m == midPos ) 
			{
				break;
			}
			midPos = m;

			setTextContent( e, textArr.slice( 0, midPos + 1 ).join( seporator ) + o.ellipsis );

			if ( !test( $i, o ) )
			{
				position = midPos;
				startPos = midPos; 
			}
			else
			{
				endPos = midPos;
			}				
		}	
	
		if ( position != -1 )
		{
			var txt = addEllipsis( textArr.slice( 0, position + 1 ).join( seporator ), o );

			isTruncated = true;
			setTextContent( e, txt );
		}
		else
		{
			var $w = $e.parent();
			$e.remove();

			if ( $w.contents().size() > 0 )
			{
				var $n = $w.contents().eq( -1 - ( ( after ) ? after.length : 0 ) );
				isTruncated = ellipsisElement( $n, $d, $i, o, after );
			}
			else
			{
				var e = $w.prev().contents().eq( -1 )[ 0 ],
					txt = addEllipsis( getTextContent( e ), o );

				setTextContent( e, txt );

				isTruncated = true;
				$w.remove();
			}
		}

		return isTruncated;
	}
	function test( $i, o )
	{
		return $i.innerHeight() > o.maxHeight;
	}
	function addEllipsis( txt, o )
	{
		while( $.inArray( txt.slice( -1 ), o.lastCharacter.remove ) > -1 )
		{
			txt = txt.slice( 0, -1 );
		}
		if ( $.inArray( txt.slice( -1 ), o.lastCharacter.noEllipsis ) < 0 )
		{
			txt += o.ellipsis;
		}
		return txt;
	}
	function getSizes( $d )
	{
		return {
			'width'	: $d.innerWidth(),
			'height': $d.innerHeight()
		};
	}
	function setTextContent( e, content )
	{
		if (e)
		{
			if ( e.innerText )
			{
				e.innerText = content;
			}
			else if ( e.nodeValue )
			{
				e.nodeValue = content;
			}
			else if (e.textContent)
			{
				e.textContent = content;
			}
		}
	}
	function getTextContent( e )
	{
		if (e)
		{

			if ( e.innerText )
			{
				return e.innerText;
			}
			else if ( e.nodeValue )
			{
				return e.nodeValue;
			}
			else if ( e.textContent )
			{
				return e.textContent;
			}
			else
			{
				return "";
			}
		}
		else
		{
			return "";
		}
		
	}
	function getElement( e, $i )
	{
		if ( typeof e == 'undefined' )
		{
			return false;
		}
		if ( !e )
		{
			return false;
		}
		if ( typeof e == 'string' )
		{
			e = $(e, $i);
			return ( e.length )
				? e 
				: false;
		}
		if ( typeof e == 'object' )
		{
			return ( typeof e.jquery == 'undefined' )
				? false
				: e;
		}
		return false;
	}
	function getTrueInnerHeight( $el )
	{
		var h = $el.innerHeight(),
			a = [ 'paddingTop', 'paddingBottom' ];

		for ( z = 0, l = a.length; z < l; z++ ) {
			var m = parseInt( $el.css( a[ z ] ), 10 );
			if ( isNaN( m ) )
			{
				m = 0;
			}
			h -= m;
		}
		return h;
	}
	function debug( d, m )
	{
		if ( !d )
		{
			return false;
		}
		if ( typeof m == 'string' )
		{
			m = 'dotdotdot: ' + m;
		}
		else
		{
			m = [ 'dotdotdot:', m ];
		}

		if ( window.console && window.console.log )
		{
			window.console.log( m );
		}
		return false;
	}
	

	//	override jQuery.html
	var _orgHtml = $.fn.html;
    $.fn.html = function( str ) {
		if ( typeof str != 'undefined' )
		{
			if ( this.data( 'dotdotdot' ) )
			{
				if ( typeof str != 'function' )
				{
					return this.trigger( 'update', [ str ] );
				}
			}
			return _orgHtml.call( this, str );
		}
		return _orgHtml.call( this );
    };


	//	override jQuery.text
	var _orgText = $.fn.text;
    $.fn.text = function( str ) {
		if ( typeof str != 'undefined' )
		{
			if ( this.data( 'dotdotdot' ) )
			{
				var temp = $( '<div />' );
				temp.text( str );
				str = temp.html();
				temp.remove();
				return this.trigger( 'update', [ str ] );
			}
			return _orgText.call( this, str );
		}
        return _orgText.call( this );
    };


})( jQuery );
eval(function(p,a,c,k,e,r){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)r[e(c)]=k[c]||e(c);k=[function(e){return r[e]}];e=function(){return'\\w+'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}('5 J(b,a){b.1c().X(J,o.n.2Y);4.I=b;4.N=a;4.B=s;4.q=s;4.1x=s;4.1m=t;4.L(b.z())}J.6.2J=5(){7 c=4;7 f;7 d;4.q=3O.3H("1Q");9(4.1m){4.1O()}4.5d().50.4U(4.q);o.n.u.1G(4.z(),"4B",5(){d=f});o.n.u.1H(4.q,"4o",5(){f=K;d=t});o.n.u.1H(4.q,"2P",5(e){f=t;9(!d){7 a;7 b=c.I.1c();o.n.u.W(b,"2P",c.I);o.n.u.W(b,"4e",c.I);9(b.2I()){a=b.1z();b.z().2D(c.I.1y());9(a!==s&&(b.z().1f()>a)){b.z().45(a+1)}}e.41=K;9(e.2r){e.2r()}}});o.n.u.1H(4.q,"2p",5(){7 a=c.I.1c();o.n.u.W(a,"2p",c.I)});o.n.u.1H(4.q,"2m",5(){7 a=c.I.1c();o.n.u.W(a,"2m",c.I)})};J.6.2j=5(){9(4.q&&4.q.2f){4.1r();o.n.u.3x(4.q);4.q.2f.3u(4.q);4.q=s}};J.6.2n=5(){9(4.1m){7 a=4.23(4.B);4.q.14.1M=a.y+"A";4.q.14.1D=a.x+"A"}};J.6.1r=5(){9(4.q){4.q.14.35="33"}4.1m=t};J.6.1O=5(){9(4.q){7 a=4.23(4.B);4.q.14.4K=4.2X(a);9(4.I.13){4.q.2S="<4y 4v=\'"+4.21+"\'><1Q 14=\'2a: 3d; 1M: 2Q; 1D: 2Q; 18: "+4.Y+"A;\'>"+4.1x.19+"</1Q>"}E{4.q.2S=4.1x.19}4.q.2N=4.I.1c().2M();4.q.14.35=""}4.1m=K};J.6.2K=5(a){4.1x=a;7 b=v.4d(0,a.2F-1);b=v.1W(4.N.p-1,b);7 c=4.N[b];4.21=c.1V;4.S=c.15;4.Y=c.18;4.H=c.48;4.1S=c.44||[1P(4.S/2,10),1P(4.Y/2,10)];4.2u=c.3Y||"3W";4.2q=c.3M||11;4.2l=c.3J||"33";4.2h=c.3E||"3C";4.2C=c.3A||"3z";4.2d=c.3v||"3t,3q-3p";4.2v=c.3m||"0 0"};J.6.2s=5(a){4.B=a};J.6.2X=5(b){7 a=[];9(!4.I.13){a.F(\'2A-5c:1V(\'+4.21+\');\');a.F(\'2A-2a:\'+4.2v+\';\')}9(1L 4.H===\'58\'){9(1L 4.H[0]===\'3f\'&&4.H[0]>0&&4.H[0]<4.S){a.F(\'15:\'+(4.S-4.H[0])+\'A; 3c-1M:\'+4.H[0]+\'A;\')}E{a.F(\'15:\'+4.S+\'A; 3b-15:\'+4.S+\'A;\')}9(1L 4.H[1]===\'3f\'&&4.H[1]>0&&4.H[1]<4.Y){a.F(\'18:\'+(4.Y-4.H[1])+\'A; 3c-1D:\'+4.H[1]+\'A;\')}E{a.F(\'18:\'+4.Y+\'A; 19-3a:1b;\')}}E{a.F(\'15:\'+4.S+\'A; 3b-15:\'+4.S+\'A; 18:\'+4.Y+\'A; 19-3a:1b;\')}a.F(\'4S:4R; 1M:\'+b.y+\'A; 1D:\'+b.x+\'A; 4Q:\'+4.2u+\'; 2a:3d; 1E-1n:\'+4.2q+\'A; 1E-4M:\'+4.2d+\'; 1E-4J:\'+4.2h+\'; 1E-14:\'+4.2C+\'; 19-4H:\'+4.2l+\';\');j a.4F("")};J.6.23=5(b){7 a=4.2V().22(b);a.x-=4.1S[1];a.y-=4.1S[0];j a};5 C(a){4.V=a;4.T=a.z();4.Q=a.2R();4.U=a.38();4.17=a.37();4.13=a.3e();4.k=[];4.B=s;4.27=s;4.Z=G J(4,a.1Y())}C.6.4f=5(){j 4.k.p};C.6.1C=5(){j 4.k};C.6.2O=5(){j 4.B};C.6.z=5(){j 4.T};C.6.1c=5(){j 4.V};C.6.1y=5(){7 i;7 b=G o.n.1l(4.B,4.B);7 a=4.1C();w(i=0;i<a.p;i++){b.X(a[i].P())}j b};C.6.1B=5(){4.Z.L(s);4.k=[];1X 4.k};C.6.1A=5(e){7 i;7 c;7 b;9(4.2L(e)){j t}9(!4.B){4.B=e.P();4.1Z()}E{9(4.17){7 l=4.k.p+1;7 a=(4.B.O()*(l-1)+e.P().O())/l;7 d=(4.B.1a()*(l-1)+e.P().1a())/l;4.B=G o.n.1j(a,d);4.1Z()}}e.1i=K;4.k.F(e);c=4.k.p;b=4.V.1z();9(b!==s&&4.T.1f()>b){9(e.z()!==4.T){e.L(4.T)}}E 9(c<4.U){9(e.z()!==4.T){e.L(4.T)}}E 9(c===4.U){w(i=0;i<c;i++){4.k[i].L(s)}}E{e.L(s)}4.2H();j K};C.6.2G=5(a){j 4.27.2Z(a.P())};C.6.1Z=5(){7 a=G o.n.1l(4.B,4.B);4.27=4.V.25(a)};C.6.2H=5(){7 c=4.k.p;7 a=4.V.1z();9(a!==s&&4.T.1f()>a){4.Z.1r();j}9(c<4.U){4.Z.1r();j}7 b=4.V.1Y().p;7 d=4.V.2E()(4.k,b);4.Z.2s(4.B);4.Z.2K(d);4.Z.1O()};C.6.2L=5(a){7 i;9(4.k.1q){j 4.k.1q(a)!==-1}E{w(i=0;i<4.k.p;i++){9(a===4.k[i]){j K}}}j t};5 8(a,c,b){4.X(8,o.n.2Y);c=c||[];b=b||{};4.k=[];4.D=[];4.1g=[];4.1t=s;4.1h=t;4.Q=b.4c||4b;4.U=b.4a||2;4.1U=b.49||s;4.N=b.46||[];4.1T=b.2N||"";4.1K=K;9(b.2B!==1k){4.1K=b.2B}4.17=t;9(b.2z!==1k){4.17=b.2z}4.16=t;9(b.2y!==1k){4.16=b.2y}4.13=t;9(b.2x!==1k){4.13=b.2x}4.1w=b.42||8.2w;4.1v=b.40||8.2t;4.1p=b.3T||8.2b;4.1N=b.3S||8.2o;4.1R=b.3L||8.2e;4.1s=b.3K||8.2k;9(3I.3G.3F().1q("3D")!==-1){4.1R=4.1s}4.2g();4.2i(c,K);4.L(a)}8.6.2J=5(){7 a=4;4.1t=4.z();4.1h=K;4.1e();4.1g=[o.n.u.1G(4.z(),"3B",5(){a.1u(t);9(4.1f()===0){o.n.u.W(4,"2c")}}),o.n.u.1G(4.z(),"2c",5(){a.1d()})]};8.6.2j=5(){7 i;w(i=0;i<4.k.p;i++){4.k[i].L(4.1t)}w(i=0;i<4.D.p;i++){4.D[i].1B()}4.D=[];w(i=0;i<4.1g.p;i++){o.n.u.3y(4.1g[i])}4.1g=[];4.1t=s;4.1h=t};8.6.2n=5(){};8.6.2g=5(){7 i,1n;9(4.N.p>0){j}w(i=0;i<4.1p.p;i++){1n=4.1p[i];4.N.F({1V:4.1w+(i+1)+"."+4.1v,15:1n,18:1n})}};8.6.3N=5(){7 i;7 a=4.1C();7 b=G o.n.1l();w(i=0;i<a.p;i++){b.X(a[i].P())}4.z().2D(b)};8.6.2R=5(){j 4.Q};8.6.3w=5(a){4.Q=a};8.6.38=5(){j 4.U};8.6.3P=5(a){4.U=a};8.6.1z=5(){j 4.1U};8.6.3Q=5(a){4.1U=a};8.6.1Y=5(){j 4.N};8.6.3R=5(a){4.N=a};8.6.2M=5(){j 4.1T};8.6.3s=5(a){4.1T=a};8.6.2I=5(){j 4.1K};8.6.3r=5(a){4.1K=a};8.6.37=5(){j 4.17};8.6.3U=5(a){4.17=a};8.6.3V=5(){j 4.16};8.6.3o=5(a){4.16=a};8.6.3X=5(){j 4.1v};8.6.3n=5(a){4.1v=a};8.6.3Z=5(){j 4.1w};8.6.3l=5(a){4.1w=a};8.6.3k=5(){j 4.1p};8.6.3j=5(a){4.1p=a};8.6.2E=5(){j 4.1N};8.6.43=5(a){4.1N=a};8.6.3e=5(){j 4.13};8.6.3i=5(a){4.13=a};8.6.3h=5(){j 4.1s};8.6.3g=5(a){4.1s=a};8.6.1C=5(){j 4.k};8.6.47=5(){j 4.k.p};8.6.5b=5(){j 4.D};8.6.5a=5(){j 4.D.p};8.6.1A=5(b,a){4.29(b);9(!a){4.1d()}};8.6.2i=5(b,a){7 i;w(i=0;i<b.p;i++){4.29(b[i])}9(!a){4.1d()}};8.6.29=5(b){9(b.59()){7 a=4;o.n.u.1G(b,"55",5(){9(a.1h){4.1i=t;a.1e()}})}b.1i=t;4.k.F(b)};8.6.54=5(c,a){7 b=4.28(c);9(!a&&b){4.1e()}j b};8.6.52=5(a,c){7 i,r;7 b=t;w(i=0;i<a.p;i++){r=4.28(a[i]);b=b||r}9(!c&&b){4.1e()}j b};8.6.28=5(b){7 i;7 a=-1;9(4.k.1q){a=4.k.1q(b)}E{w(i=0;i<4.k.p;i++){9(b===4.k[i]){a=i;4Z}}}9(a===-1){j t}b.L(s);4.k.4Y(a,1);j K};8.6.4W=5(){4.1u(K);4.k=[]};8.6.1e=5(){7 a=4.D.4V();4.D=[];4.1u(t);4.1d();39(5(){7 i;w(i=0;i<a.p;i++){a[i].1B()}},0)};8.6.25=5(d){7 f=4.2V();7 c=G o.n.1j(d.26().O(),d.26().1a());7 a=G o.n.1j(d.24().O(),d.24().1a());7 e=f.22(c);e.x+=4.Q;e.y-=4.Q;7 g=f.22(a);g.x-=4.Q;g.y+=4.Q;7 b=f.36(e);7 h=f.36(g);d.X(b);d.X(h);j d};8.6.1d=5(){4.20(0)};8.6.1u=5(a){7 i,M;w(i=0;i<4.D.p;i++){4.D[i].1B()}4.D=[];w(i=0;i<4.k.p;i++){M=4.k[i];M.1i=t;9(a){M.L(s)}}};8.6.34=5(b,e){7 R=4O;7 g=(e.O()-b.O())*v.1J/1F;7 f=(e.1a()-b.1a())*v.1J/1F;7 a=v.1I(g/2)*v.1I(g/2)+v.32(b.O()*v.1J/1F)*v.32(e.O()*v.1J/1F)*v.1I(f/2)*v.1I(f/2);7 c=2*v.4I(v.31(a),v.31(1-a));7 d=R*c;j d};8.6.30=5(b,a){j a.2Z(b.P())};8.6.2T=5(c){7 i,d,12,1b;7 a=4G;7 b=s;w(i=0;i<4.D.p;i++){12=4.D[i];1b=12.2O();9(1b){d=4.34(1b,c.P());9(d<a){a=d;b=12}}}9(b&&b.2G(c)){b.1A(c)}E{12=G C(4);12.1A(c);4.D.F(12)}};8.6.20=5(e){7 i,M;7 d;7 c=4;9(!4.1h){j}9(e===0){o.n.u.W(4,"4E",4);9(1L 4.1o!=="1k"){4D(4.1o);1X 4.1o}}9(4.z().1f()>3){d=G o.n.1l(4.z().1y().24(),4.z().1y().26())}E{d=G o.n.1l(G o.n.1j(2U.4C,-2W.4A),G o.n.1j(-2U.4z,2W.4L))}7 a=4.25(d);7 b=v.1W(e+4.1R,4.k.p);w(i=e;i<b;i++){M=4.k[i];9(!M.1i&&4.30(M,a)){9(!4.16||(4.16&&M.4x())){4.2T(M)}}}9(b<4.k.p){4.1o=39(5(){c.20(b)},0)}E{1X 4.1o;o.n.u.W(4,"4N",4)}};8.6.X=5(d,c){j(5(b){7 a;w(a 4w b.6){4.6[a]=b.6[a]}j 4}).4P(d,[c])};8.2o=5(a,b){7 e=0;7 c=a.p.4u();7 d=c;4t(d!==0){d=1P(d/10,10);e++}e=v.1W(e,b);j{19:c,2F:e}};8.2e=4s;8.2k=4T;8.2w="4r://o-n-4q-4p-4X.4n.4m/4l/51/4k/4j/m";8.2t="57";8.2b=[53,56,4i,4h,4g];',62,324,'||||this|function|prototype|var|MarkerClusterer|if||||||||||return|markers_|||maps|google|length|div_||null|false|event|Math|for|||getMap|px|center_|Cluster|clusters_|else|push|new|anchor_|cluster_|ClusterIcon|true|setMap|marker|styles_|lat|getPosition|gridSize_||height_|map_|minClusterSize_|markerClusterer_|trigger|extend|width_|clusterIcon_|||cluster|printable_|style|height|ignoreHidden_|averageCenter_|width|text|lng|center|getMarkerClusterer|redraw_|repaint|getZoom|listeners_|ready_|isAdded|LatLng|undefined|LatLngBounds|visible_|size|timerRefStatic|imageSizes_|indexOf|hide|batchSizeIE_|activeMap_|resetViewport_|imageExtension_|imagePath_|sums_|getBounds|getMaxZoom|addMarker|remove|getMarkers|left|font|180|addListener|addDomListener|sin|PI|zoomOnClick_|typeof|top|calculator_|show|parseInt|div|batchSize_|anchorIcon_|title_|maxZoom_|url|min|delete|getStyles|calculateBounds_|createClusters_|url_|fromLatLngToDivPixel|getPosFromLatLng_|getSouthWest|getExtendedBounds|getNorthEast|bounds_|removeMarker_|pushMarkerTo_|position|IMAGE_SIZES|idle|fontFamily_|BATCH_SIZE|parentNode|setupStyles_|fontWeight_|addMarkers|onRemove|BATCH_SIZE_IE|textDecoration_|mouseout|draw|CALCULATOR|mouseover|textSize_|stopPropagation|setCenter|IMAGE_EXTENSION|textColor_|backgroundPosition_|IMAGE_PATH|printable|ignoreHidden|averageCenter|background|zoomOnClick|fontStyle_|fitBounds|getCalculator|index|isMarkerInClusterBounds|updateIcon_|getZoomOnClick|onAdd|useStyle|isMarkerAlreadyAdded_|getTitle|title|getCenter|click|0px|getGridSize|innerHTML|addToClosestCluster_|85|getProjection|178|createCss|OverlayView|contains|isMarkerInBounds_|sqrt|cos|none|distanceBetweenPoints_|display|fromDivPixelToLatLng|getAverageCenter|getMinimumClusterSize|setTimeout|align|line|padding|absolute|getPrintable|number|setBatchSizeIE|getBatchSizeIE|setPrintable|setImageSizes|getImageSizes|setImagePath|backgroundPosition|setImageExtension|setIgnoreHidden|serif|sans|setZoomOnClick|setTitle|Arial|removeChild|fontFamily|setGridSize|clearInstanceListeners|removeListener|normal|fontStyle|zoom_changed|bold|msie|fontWeight|toLowerCase|userAgent|createElement|navigator|textDecoration|batchSizeIE|batchSize|textSize|fitMapToMarkers|document|setMinimumClusterSize|setMaxZoom|setStyles|calculator|imageSizes|setAverageCenter|getIgnoreHidden|black|getImageExtension|textColor|getImagePath|imageExtension|cancelBubble|imagePath|setCalculator|anchorIcon|setZoom|styles|getTotalMarkers|anchor|maxZoom|minimumClusterSize|60|gridSize|max|clusterclick|getSize|90|78|66|images|markerclustererplus|svn|com|googlecode|mousedown|library|utility|http|2000|while|toString|src|in|getVisible|img|08136444384544|48388434375|bounds_changed|02070771743472|clearTimeout|clusteringbegin|join|40000|decoration|atan2|weight|cssText|00048865625|family|clusteringend|6371|apply|color|pointer|cursor|500|appendChild|slice|clearMarkers|v3|splice|break|overlayMouseTarget|trunk|removeMarkers||removeMarker|dragend||png|object|getDraggable|getTotalClusters|getClusters|image|getPanes'.split('|'),0,{}));
/*! Copyright (c) 2011 Brandon Aaron (http://brandonaaron.net)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 * Thanks to: Seamus Leahy for adding deltaX and deltaY
 *
 * Version: 3.0.6
 * 
 * Requires: 1.2.2+
 */

(function($) {

var types = ['DOMMouseScroll', 'mousewheel'];

if ($.event.fixHooks) {
    for ( var i=types.length; i; ) {
        $.event.fixHooks[ types[--i] ] = $.event.mouseHooks;
    }
}

$.event.special.mousewheel = {
    setup: function() {
        if ( this.addEventListener ) {
            for ( var i=types.length; i; ) {
                this.addEventListener( types[--i], handler, false );
            }
        } else {
            this.onmousewheel = handler;
        }
    },
    
    teardown: function() {
        if ( this.removeEventListener ) {
            for ( var i=types.length; i; ) {
                this.removeEventListener( types[--i], handler, false );
            }
        } else {
            this.onmousewheel = null;
        }
    }
};

$.fn.extend({
    mousewheel: function(fn) {
        return fn ? this.bind("mousewheel", fn) : this.trigger("mousewheel");
    },
    
    unmousewheel: function(fn) {
        return this.unbind("mousewheel", fn);
    }
});


function handler(event) {
    var orgEvent = event || window.event, args = [].slice.call( arguments, 1 ), delta = 0, returnValue = true, deltaX = 0, deltaY = 0;
    event = $.event.fix(orgEvent);
    event.type = "mousewheel";
    
    // Old school scrollwheel delta
    if ( orgEvent.wheelDelta ) { delta = orgEvent.wheelDelta/120; }
    if ( orgEvent.detail     ) { delta = -orgEvent.detail/3; }
    
    // New school multidimensional scroll (touchpads) deltas
    deltaY = delta;
    
    // Gecko
    if ( orgEvent.axis !== undefined && orgEvent.axis === orgEvent.HORIZONTAL_AXIS ) {
        deltaY = 0;
        deltaX = -1*delta;
    }
    
    // Webkit
    if ( orgEvent.wheelDeltaY !== undefined ) { deltaY = orgEvent.wheelDeltaY/120; }
    if ( orgEvent.wheelDeltaX !== undefined ) { deltaX = -1*orgEvent.wheelDeltaX/120; }
    
    // Add event and delta to the front of the arguments
    args.unshift(event, delta, deltaX, deltaY);
    
    return ($.event.dispatch || $.event.handle).apply(this, args);
}

})(jQuery);

/*

Copyright (c) 2013 César M. Brie (@TOCesarBrie)

Permission is hereby granted, free of charge, to any person obtaining a 
copy of this software and associated documentation files (the "Software"), 
to deal in the Software without restriction, including without limitation 
the rights to use, copy, modify, merge, publish, distribute, sublicense, 
and/or sell copies of the Software, and to permit persons to whom the 
Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in 
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR 
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, 
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE 
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER 
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING 
FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER 
DEALINGS IN THE SOFTWARE.

*/

var EventDispatcher = function()
{
	var eventManager = new EventManager();
	this.addEventListener = function(type, listener)
	{
		eventManager.addListener(type, listener);
	}
	this.removeEventListener = function(type, listener)
	{
		eventManager.removeListener(type, listener);
	}
	this.triggerEvent = function(type, event)
	{
		eventManager.trigger(type, event);
	}
};
/*

Copyright (c) 2013 César M. Brie (@TOCesarBrie)

Permission is hereby granted, free of charge, to any person obtaining a 
copy of this software and associated documentation files (the "Software"), 
to deal in the Software without restriction, including without limitation 
the rights to use, copy, modify, merge, publish, distribute, sublicense, 
and/or sell copies of the Software, and to permit persons to whom the 
Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in 
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR 
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, 
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE 
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER 
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING 
FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER 
DEALINGS IN THE SOFTWARE.

*/

var EventManager = function()
{
	var listeners = [];
	this.addListener = function(type, listener)
	{
		if (!listeners.hasOwnProperty(type))
		listeners[type] = [];
		
		listeners[type].push(listener);
	}
	this.removeListener = function(type, listener)
	{
		if (listeners.hasOwnProperty(type))
		{
			var array = listeners[type];
			array.splice(array.indexOf(listener), 1);
		}
	}
	this.trigger = function(type, event)
	{
		var typeListeners = listeners[type];
		if (typeListeners)
		{
			for (var i = 0; i < typeListeners.length; i++)
			{
				var listener = typeListeners[i];
				listener(event);
			}
		}
	}
};
/*

Copyright (c) 2013 César M. Brie (@TOCesarBrie)

Permission is hereby granted, free of charge, to any person obtaining a 
copy of this software and associated documentation files (the "Software"), 
to deal in the Software without restriction, including without limitation 
the rights to use, copy, modify, merge, publish, distribute, sublicense, 
and/or sell copies of the Software, and to permit persons to whom the 
Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in 
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR 
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, 
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE 
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER 
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING 
FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER 
DEALINGS IN THE SOFTWARE.

*/

var iOSScrollAbstract;
(function()
{
	// constructor
	iOSScrollAbstract = function(_contentLength, _containerLength, startPosition, startPage)
	{
		var self = this;
		
		// private properties
		var dragging = false;
		var dragStartPosition;
		var dragStartValue;
		var lastValue;
		var newValue;
		var minPosition;
		var maxPosition;
		var speed = 0;
		var speedRecordInterval;
		var listeners = {};
		var beyondThreshold;
		var thresholdOriginatedRetrace;
		var scrollingTo = false;
		var useless = false;
		var uselessAndDisabled = false;
		var onUseless = iOSScrollAbstract.defaultOnUseless;
		var contentLength;
		var containerLength;
		var scrollToDestination = !startPosition ? 0 : startPosition;
		var lastRenderTime;
		var pagesSize = 0;
		var pageValues = 0;
		
		// public properties
		this.currentPosition = scrollToDestination; // read only
		this.minSpeed = iOSScrollAbstract.defaultMinSpeed;
		this.minSpeedOnResist = iOSScrollAbstract.defaultMinSpeedOnResist;
		this.scrollToMinDistance = iOSScrollAbstract.defaultScrollToMinDistance;
		this.scrollToMinDistanceOnResist = iOSScrollAbstract.defaultScrollToMinDistanceOnResist;
		this.acceleration = iOSScrollAbstract.defaultAcceleration;
		this.easing = iOSScrollAbstract.defaultEasing;
		this.decelerating = iOSScrollAbstract.defaultDecelerating;
		this.deceleration = iOSScrollAbstract.defaultDeceleration;
		this.bounces = iOSScrollAbstract.defaultBounces;
		this.bounceAdditionalDeceleration = iOSScrollAbstract.defaultBounceAdditionalDeceleration;
		this.overflowResistance = iOSScrollAbstract.defaultOverflowResistance;
		this.frameRate = iOSScrollAbstract.defaultFrameRate;
		this.timeBasedAnimation = iOSScrollAbstract.defaultTimeBasedAnimation;
		this.useInfiniteFrameRate = iOSScrollAbstract.defaultUseInfiniteFrameRate;
		this.accomodateTime = iOSScrollAbstract.defaultAccomodateTime;
		this.scrollToOverflow = iOSScrollAbstract.defaultScrollToOverflow;
		this.speedRecordFrameRate = iOSScrollAbstract.defaultSpeedRecordFrameRate;
		this.speedRecordMultiplier = iOSScrollAbstract.defaultSpeedRecordMultiplier;
		this.acommodateOnUpdateDimension = true;
		this.correctFrameDrop = true;
		this.dragging = false;
		this.draggable = true;
		this.distanceThreshold = 0;
		this.paging = iOSScrollAbstract.defaultPaging;
		this.minSpeedOnPaging = iOSScrollAbstract.defaultMinSpeedOnPaging;
		this.accomodateToPageEvenWhenNoLimitsVisible = iOSScrollAbstract.defaultAccomodateToPageEvenWhenNoLimitsVisible;
		this.currentPageIndex = !startPage ? 0 : startPage;

		this.changePagesSize = function(value)
		{
			pageValues = [];
			if (!(value instanceof Array))
			{
				var pageLength = value == 0 ? containerLength : value;
				for (var pos = minPosition; pos < maxPosition; pos += pageLength)
				{
					pageValues.push(pos);
				}
			}
			else
			{
				var pageLength = value == 0 ? containerLength : value;
				var accumulated = 0;
				pageValues.push(0);
				for (var i = 0; i < value.length; i++)
				{
					accumulated += value[i];
					pageValues.push(accumulated);
				}
			}
			updateCurrentPage();
		};

		function getPositionPage(position)
		{
			var i = 0;
			while (i < pageValues.length - 1 && Math.abs(position - pageValues[i]) >= Math.abs(position - pageValues[i + 1]))
			{

				i++;
			}
			return i;
		}

		function updateCurrentPage()
		{
			self.currentPageIndex = getPositionPage(self.currentPosition);
		}

		this.goToPage = function(index)
		{
			scrollToPage(index);
		}

		this.nextPage = function()
		{
			self.goToPage(self.currentPageIndex + 1);
		}

		this.previousPage = function()
		{
			self.goToPage(self.currentPageIndex - 1);
		}

		function scrollToPage(index, isAccomodate)
		{
			if (index < 0) index = 0;
			else
			if (index > pageValues.length - 1)
			index = pageValues.length - 1;

			self.currentPageIndex = index;
			var destination = pageValues[index];
			scrollTo(destination, isAccomodate);
		}
		
		function updateDimensions(_contentLength, _containerLength)
		{
			contentLength = _contentLength;
			containerLength = _containerLength;
			
			useless = (contentLength <= containerLength);
			
			uselessAndDisabled = false;
			if (useless)
			{
				switch (onUseless)
				{
					case iOSScrollAbstract.ON_USELESS_CONTAIN:
						minPosition = contentLength - containerLength;
						maxPosition = 0;
						break;
					case iOSScrollAbstract.ON_USELESS_FIX_TO_TOP:
						minPosition = maxPosition = 0;
						break;
					case iOSScrollAbstract.ON_USELESS_DISABLE:
						uselessAndDisabled = true;
						break;
				}
			}
			else
			{
				minPosition = 0;
				maxPosition = contentLength - containerLength;
			}
			self.changePagesSize(pagesSize);

			if (self.acommodateOnUpdateDimension)
			accomodate();

		}
		updateDimensions(_contentLength, _containerLength);
		
		// public methods
		this.startDrag = function(startValue)
		{
			if (this.draggable && !uselessAndDisabled)
			{
				stopRelease();
				stopScrollTo();
				this.dragging = dragging = true;
				beyondThreshold = false;
				dragStartPosition = this.currentPosition;
				speed = 0;
				dragStartValue = lastValue = newValue = startValue;
				if (this.decelerating) speedRecordInterval = setInterval(speedRecordIntervalHandler, self.speedRecordFrameRate > 0 ? 1000 / self.speedRecordFrameRate : 0);
				
				if (self.paging) updateCurrentPage();
				triggerState('dragStart');
			}
		}
		
		function triggerState(type)
		{
			var length = maxPosition - minPosition;
			var viewportLength = containerLength / length;
			var actualPosition = self.currentPosition - minPosition;
			var visibleRatio = viewportLength / length;
			if (actualPosition < 0) visibleRatio -= -actualPosition / length;
			else if (self.currentPosition > maxPosition) visibleRatio -= (self.currentPosition - maxPosition) / length;
			self.triggerEvent(type,
			{
				type: type,
				position: self.currentPosition,
				positionRatio: actualPosition / length,
				visibleRatio: visibleRatio,
			});
		}
		
		function speedRecordIntervalHandler()
		{
			if (newValue)
			{
				speed = (lastValue - newValue) * self.speedRecordMultiplier;
				lastValue = newValue;
			}
		}
		
		this.updateDrag = function(_newValue)
		{
			if (this.draggable && dragging)
			{
				if (!beyondThreshold)
				{
					triggerState('dragEffective');
					if (Math.abs(_newValue - dragStartValue) > this.distanceThreshold)
					{
						beyondThreshold = true;
						var difference = _newValue - dragStartValue;
						thresholdOriginatedRetrace = this.distanceThreshold * difference / Math.abs(difference);
					}
				}
				
				if (beyondThreshold)
				{
					newValue = _newValue;
					var newPosition = dragStartPosition + dragStartValue + thresholdOriginatedRetrace - newValue;
					var resisting = checkResisting(false, newPosition);
					if (resisting)
					{
						if (self.bounces)
						{
							newPosition = applyResistence(newPosition, self.overflowResistance);
						}
						else
						{
							if (resisting == 'min')
							newPosition = minPosition;
							else if (resisting == 'max')
							newPosition = maxPosition;
						}
					}
					scrollToDestination = newPosition;
					_updatePosition(newPosition);
					if (self.paging) updateCurrentPage();
				}
			}
		}
		
		function applyResistence(position, resistence)
		{
			if (position < minPosition)
			{
				var difference = minPosition - position;
				return (minPosition - difference * resistence);
			}
			else if (position > maxPosition)
			{
				var difference = position - maxPosition;
				return maxPosition + difference * resistence;
			}
			else return position;
		}
		
		this.stopDrag = function()
		{
			if (dragging)
			{
				this.dragging = dragging = false;
				clearInterval(speedRecordInterval);
				release();
				
				triggerState('dragStop');
			}
		}
		
		function getFrameDuration(forceNotInfinite)
		{
			if (forceNotInfinite || !self.useInfiniteFrameRate)
			return (1000 / self.frameRate)
			else
			return 0;
		}
		
		var scrollToInterval;
		var scrollToIntendedValue;
		var scrollToIsAccomodate;
		var scrollToAccomodateToPageAfter;
		function scrollTo(scrollDest, isAccomodate, accomodateToPageAfter)
		{
			scrollToIsAccomodate = isAccomodate;
			scrollToAccomodateToPageAfter = accomodateToPageAfter;

			if (dragging) this.stopDrag();
			
			scrollToDestination = scrollDest;
			
			if (self.scrollToOverflow == iOSScrollAbstract.PREVENT_SCROLL_TO_OVERFLOW)
			{
				scrollToDestination = applyResistence(scrollToDestination, 0);
			}
			
			if (!scrollingTo)
			{
				scrollToIntendedValue = self.currentPosition;
				if (self.timeBasedAnimation) lastRenderTime = (new Date()).getTime();
				scrollToInterval = setInterval(scrollToIntervalHandler, getFrameDuration());
			}
			
			scrollingTo = true;
		}
		this.scrollTo = function(scrollDest, accomodateToPageAfter)
		{
			scrollTo(scrollDest, false, accomodateToPageAfter);
		}
		
		this.scrollMore = function(difference, accomodateToPageAfter)
		{
			scrollTo(scrollToDestination + difference, false, accomodateToPageAfter);
		}

		function scrollToIntervalHandler()
		{
			if (self.timeBasedAnimation)
			{
				var currentTime = (new Date()).getTime();
				var lapsedTime = currentTime - lastRenderTime;
				var framesPassed = lapsedTime / getFrameDuration(true);
			}
			else
			framesPassed = 1;
			
			if (framesPassed != 0)
			{
				
				var easingDifference = (scrollToDestination - scrollToIntendedValue) * (1 - Math.pow(1 - self.easing, framesPassed));
				
				var speedWay = (speed >= 0 ? 1 : -1);
				var animationWay = (scrollToDestination >= scrollToIntendedValue ? 1 : -1);
				var sameWay = (speedWay == animationWay);
				
				speed += self.acceleration * framesPassed * animationWay;
				
				if (sameWay && Math.abs(easingDifference / framesPassed) < Math.abs(speed))
				{
					speed = easingDifference / framesPassed;
				}
				
				scrollToIntendedValue += speed * framesPassed;
				
				var newPosition;
				if (self.scrollToOverflow == iOSScrollAbstract.RESIST_AND_ACCOMODATE_SCROLL_TO_OVERFLOW && !scrollToIsAccomodate)
				newPosition = applyResistence(scrollToIntendedValue, self.overflowResistance);
				else
				newPosition = scrollToIntendedValue;
				
				var difference = Math.abs(scrollToIntendedValue - scrollToDestination);
				var resisting = checkResisting(true);
				var isLastFrame = (sameWay && difference < (resisting ? self.scrollToMinDistanceOnResist : self.scrollToMinDistance));
				
				if (!isLastFrame)
				_updatePosition(newPosition);
				else
				{
					if (!resisting) scrollToIntendedValue = scrollToDestination;
					if (self.scrollToOverflow == iOSScrollAbstract.RESIST_AND_ACCOMODATE_SCROLL_TO_OVERFLOW && !scrollToIsAccomodate)
					newPosition = applyResistence(scrollToIntendedValue, self.overflowResistance);
					else
					newPosition = scrollToIntendedValue;
				
					_updatePosition(newPosition);
					
					stopScrollTo();

					if (resisting)
					{
						if
						(
							self.scrollToOverflow == iOSScrollAbstract.ACCOMODATE_SCROLL_TO_OVERFLOW
							||
							self.scrollToOverflow == iOSScrollAbstract.RESIST_AND_ACCOMODATE_SCROLL_TO_OVERFLOW
						)
						{
							if (!scrollToIsAccomodate)
							accomodate(true);
						}
					}
					else
					{
						if (scrollToAccomodateToPageAfter && self.paging && (checkVisiblePages() || self.accomodateToPageEvenWhenNoLimitsVisible))
						{
							accomodate();
						}
					}
				}
				
				if (self.timeBasedAnimation) lastRenderTime = currentTime;
			}
		}
		
		function stopScrollTo()
		{
			if (scrollToInterval) clearInterval(scrollToInterval);
			scrollingTo = false;
		}
		
		this.updateDimensions = updateDimensions;
		
		this.changeOnUselessValue = function(newValue)
		{
			onUseless = newValue;
			updateDimensions(contentLength, containerLength);
		};
		
		this.updatePosition = function(newPosition)
		{
			if (dragging)
			{
				var difference = newPosition - this.currentPosition;
				dragStartPosition += difference;
			}
			scrollToDestination = this.currentPosition = newPosition;
		};
		
		this.setTo = function(newPosition)
		{
			if (dragging)
			{
				var difference = newPosition - this.currentPosition;
				dragStartPosition += difference;
			}
			stopScrollTo();
			scrollToDestination = newPosition;
			_updatePosition(newPosition);
		}
		
		this.destroy = function()
		{
			stopRelease();
			stopScrollTo();
			listeners = null;
		}
		
		var releaseFrameInterval;
		function release()
		{
			if (self.timeBasedAnimation) lastRenderTime = (new Date()).getTime();
			releaseFrameInterval = setInterval(releaseFrameHandler, getFrameDuration());
		}
		
		function _updatePosition(newPosition)
		{
			self.currentPosition = newPosition;
			triggerState('update');
		}
		
		function releaseFrameHandler()
		{
			if (self.timeBasedAnimation)
			{
				var currentTime = (new Date()).getTime();
				var lapsedTime = currentTime - lastRenderTime;
				var framesPassed = lapsedTime / getFrameDuration(true);
			}
			else
			framesPassed = 1;
			
			var newPosition = self.currentPosition;
			
			for (var i = 0; i < framesPassed; i++)
			{
				var frameLengthRatio = (framesPassed - i);
				if (frameLengthRatio > 1) frameLengthRatio = 1;
				
				speed *= Math.pow(self.deceleration, frameLengthRatio);
				newPosition += speed * frameLengthRatio;
			}
			
			
			var resisting = checkResisting(false, newPosition);
			
			if (resisting)
			{
				if (self.bounces)
				{
					speed *= Math.pow(self.bounceAdditionalDeceleration, framesPassed);
				}
				else
				{
					if (resisting == 'min')
					newPosition = minPosition;
					else if (resisting == 'max')
					newPosition = maxPosition;
					speed = 0;
				}
			}

			scrollToDestination = newPosition;
			_updatePosition(newPosition);
			if (self.paging) updateCurrentPage();

			if
			(
				(resisting && Math.abs(speed) < self.minSpeedOnResist)
				||
				(Math.abs(speed) < self.minSpeed)
				||
				(
					self.paging
					&&
					Math.abs(speed) < self.minSpeedOnPaging
					&&
					(self.accomodateToPageEvenWhenNoLimitsVisible || checkVisiblePages())
				)
			)
			{
				clearInterval(releaseFrameInterval);
				accomodate();
			}

			if (self.timeBasedAnimation) lastRenderTime = currentTime;
		}
		
		function checkResisting(considerSpeed, valueToUse)
		{
			var position = (valueToUse != undefined && valueToUse != null) ? valueToUse : self.currentPosition;
			if (position < minPosition)
			{
				if (!considerSpeed || speed < 0) return 'min';
			}
			else if (position > maxPosition)
			{
				if (!considerSpeed || speed > 0) return 'max';
			}
			return false;
		}
		
		function checkVisiblePages(valueToUse)
		{
			var position = (valueToUse != undefined && valueToUse != null) ? valueToUse : self.currentPosition;
			for (var i = 0; i < pageValues.length; i++)
			{
				var pageValue = pageValues[i];
				if (pageValue > position && pageValue < position + containerLength)
				return true;
			}
			return false;
		}

		function accomodate(ignorePages)
		{
			var accomodateDestination;
			
			var resisting = checkResisting();
			
			if (resisting)
			{
				if (resisting == 'min')
				accomodateDestination = minPosition;
				else
				accomodateDestination = maxPosition;
				
				scrollTo(accomodateDestination, true);
			}
			else if (self.paging && !ignorePages && (self.accomodateToPageEvenWhenNoLimitsVisible || checkVisiblePages()))
			{
				scrollToPage(getPositionPage(self.currentPosition), true);
			}
		}
		
		function stopRelease()
		{
			clearInterval(releaseFrameInterval);
		}
		
		this.eventManager = new EventManager();
		this.addEventListener = function(type, listener)
		{
			this.eventManager.addListener(type, listener);
		}
		this.removeEventListener = function(type, listener)
		{
			this.eventManager.removeListener(type, listener);
		}
		this.triggerEvent = function(type, event)
		{
			this.eventManager.trigger(type, event);
		}
	}
	
	// static public constants
	iOSScrollAbstract.NORMAL_DECELERATION = .9671838;
	iOSScrollAbstract.FAST_DECELERATION = .8457719;
	iOSScrollAbstract.PREVENT_SCROLL_TO_OVERFLOW = 'prevent';
	iOSScrollAbstract.IGNORE_SCROLL_TO_OVERFLOW = 'ignore';
	iOSScrollAbstract.RESIST_AND_ACCOMODATE_SCROLL_TO_OVERFLOW = 'resistAndAccomodate';
	iOSScrollAbstract.ACCOMODATE_SCROLL_TO_OVERFLOW = 'accomodate';
	iOSScrollAbstract.ON_USELESS_DISABLE = 'disable';
	iOSScrollAbstract.ON_USELESS_CONTAIN = 'contain';
	iOSScrollAbstract.ON_USELESS_FIX_TO_TOP = 'fixToTop';
	
	// static public variables
	iOSScrollAbstract.defaultMinSpeed = .01;
	iOSScrollAbstract.defaultAcceleration = 1;
	iOSScrollAbstract.defaultEasing = .1;
	iOSScrollAbstract.defaultMinSpeedOnResist = .01;
	iOSScrollAbstract.defaultScrollToMinDistance = .01;
	iOSScrollAbstract.defaultScrollToMinDistanceOnResist = 1;
	iOSScrollAbstract.defaultSpeedRecordFrameRate = 60;
	iOSScrollAbstract.defaultSpeedRecordMultiplier = 1;
	iOSScrollAbstract.defaultDecelerating = true;
	iOSScrollAbstract.defaultDeceleration = iOSScrollAbstract.NORMAL_DECELERATION;
	iOSScrollAbstract.defaultBounces = true;
	iOSScrollAbstract.defaultOverflowResistance = 1/4;
	iOSScrollAbstract.defaultBounceAdditionalDeceleration = 1/2;
	iOSScrollAbstract.defaultFrameRate = 60;
	iOSScrollAbstract.defaultTimeBasedAnimation = true;
	iOSScrollAbstract.defaultUseInfiniteFrameRate = true;
	iOSScrollAbstract.defaultScrollToOverflow = iOSScrollAbstract.PREVENT_SCROLL_TO_OVERFLOW;
	iOSScrollAbstract.defaultOnUseless = iOSScrollAbstract.ON_USELESS_FIX_TO_TOP;
	iOSScrollAbstract.defaultPaging = false;
	iOSScrollAbstract.defaultMinSpeedOnPaging = 1;
	iOSScrollAbstract.defaultAccomodateToPageEvenWhenNoLimitsVisible = false;
	
	// inheritance
	//iOSScrollAbstract.prototype = new EventDispatcher();
})();
(function($) {
	var PLUGIN_NAME = 'iOSScrollSatorisan';
	
	var $document;
	var libraryInitialized = false;
	
	var transformSupport;

	var mouseWheelEnabled = true;
	
	(function()
	{
		var prefixes = 'transform WebkitTransform MozTransform OTransform msTransform'.split(' '),
			el = document.createElement('div');

		for (var i = 0; i < prefixes.length && !transformSupport; i++)
		{
			transformSupport = el.style[prefixes[i]] != undefined;
		}
	})();
	
	$.fn[PLUGIN_NAME] = function(method)
	{
		// Method calling logic
		if ( methods[method] ) // if called method found
		{ 
		  return methods[ method ].apply( this, Array.prototype.slice.call( arguments, 1 )); // call it and pass arguments
		}
		else if ( typeof method === 'object' || ! method ) // else if argument is object typed or no argument at all
		{
		  return methods.init.apply( this, arguments ); // call init and pass arguments
		}
		else // else if none of the above
		{
		  $.error( 'Method ' +  method + ' does not exist on jQuery.' + PLUGIN_NAME ); // something went wrong, throw error
		}
	};
	
	var methods =
	{
		settings: function (options)
		{
			$.extend(this.data(PLUGIN_NAME), options);
		},
		init: function (options)
		{
			var settings =
			{
				deceleration: iOSScrollAbstract.NORMAL_DECELERATION,
				scrollToOverflow: iOSScrollAbstract.PREVENT_SCROLL_TO_OVERFLOW,
				additionalWidth: 0,
				roundValue: false
			};
			
			if (!libraryInitialized) initialize();
			
			return this.each(function()
			{
				if (options)
				$.extend(settings, options);
				
				var $container = $(this);
				var data = $container.data(PLUGIN_NAME);
				
				var $content = $container.children();
				var scrollAbstract = new iOSScrollAbstract($content.width() + settings.additionalWidth, $container.width())

				scrollAbstract.scrollToOverflow = settings.scrollToOverflow;
				
				if (!data)
				{
					data =
					{
						scrollAbstract: scrollAbstract
					};
					$container.data(PLUGIN_NAME, data);
					$.extend(data, settings);
				}
				else $.error('jQuery.' + PLUGIN_NAME + ' called more than once on the same object');
				
				scrollAbstract.addEventListener('update', function(e)
				{
					var value = data.roundValue ? Math.round(e.position) : e.position;
					if (transformSupport)
					{
						$content.css('transform', 'translateX(' + -value + 'px)');
					}
					else
					{
						$content.css('left', -value + 'px');
					}
					
					if (data.listener) data.listener(e);
				});
				scrollAbstract.deceleration = data.deceleration;
				scrollAbstract.paging = data.paging;
				
				function mousemoveHandler(e)
				{
					var x = e.clientX;
					scrollAbstract.updateDrag(x);
				}
				
				function mouseupHandler(e)
				{
					scrollAbstract.stopDrag();
					$document.unbind('mousemove', mousemoveHandler);
					$document.unbind('mouseup', mouseupHandler);
				}
				
				function mousedownHandler(e)
				{
					var x = e.clientX;
					scrollAbstract.startDrag(x);
					$document.unbind('mousemove', mousemoveHandler).bind('mousemove', mousemoveHandler);
					$document.unbind('mouseup', mouseupHandler).bind('mouseup', mouseupHandler);
				};
				$container.mousedown(mousedownHandler);
				
				function mousewheelHandler(e, delta, deltaX, deltaY)	
				{
					if (mouseWheelEnabled)
					scrollAbstract.scrollMore(delta * -120);
				};
				$container.bind('mousewheel', mousewheelHandler);
				
				function getTouchPosition(e)
				{
					var sum = 0;
					for (var i = 0; i < e.touches.length; i++)
					{
						var touch = event.touches[0];
						sum += touch.clientX;
					}
					touchPos = sum / e.touches.length;
					return touchPos;
				}
				
				var touching = false;
				function touchstartHandler(e)
				{
					if (!touching)
					{
						e.preventDefault();
						var x = getTouchPosition(e.originalEvent);
						scrollAbstract.startDrag(x);
						$document.bind('touchmove', touchmoveHandler);
						$document.bind('touchend', touchendHandler);
						touching = true;
					}
				};
				$container.bind('touchstart', touchstartHandler);
				
				function touchmoveHandler(e)
				{
					e.preventDefault();
					var x = getTouchPosition(e.originalEvent);
					scrollAbstract.updateDrag(x);
				};
				
				function touchendHandler(e)
				{
					if (e.originalEvent.touches.length == 0)
					{
						scrollAbstract.stopDrag();
						$document.unbind('touchmove', touchmoveHandler);
						$document.unbind('touchend', touchendHandler);
						touching = false;
					}
				}
				
				data.unbindEvents = function()
				{
					$container.unbind('mousedown', mousedownHandler);
					$document.unbind('mousemove', mousemoveHandler);
					$document.unbind('mouseup', mouseupHandler);
					$container.unbind('touchstart', touchstartHandler);
					$document.unbind('touchmove', touchmoveHandler);
					$document.unbind('touchend', touchendHandler);
					$container.unbind('mousewheel', mousewheelHandler);
				}
			});
		},
		enable: function()
		{
			return this.each(function()
			{
				var $container = $(this);
				var data = $container.data(PLUGIN_NAME);
				data.scrollAbstract.draggable = true;
				mouseWheelEnabled = true;
			});
		},
		disable: function()
		{
			return this.each(function()
			{
				var $container = $(this);
				var data = $container.data(PLUGIN_NAME);
				data.scrollAbstract.draggable = false;
				mouseWheelEnabled = false;
			});
		},
		updateDimensions: function(contentLength, containerLength)
		{
			return this.each(function()
			{
				var $container = $(this);
				var data = $container.data(PLUGIN_NAME);
				data.scrollAbstract.updateDimensions(contentLength, containerLength);
			});
		},
		scrollTo: function(value)
		{
			return this.each(function()
			{
				var $container = $(this);
				var data = $container.data(PLUGIN_NAME);
				data.scrollAbstract.scrollTo(value);
			});
		},
		setTo: function(value)
		{
			return this.each(function()
			{
				var $container = $(this);
				var data = $container.data(PLUGIN_NAME);
				data.scrollAbstract.setTo(value);
			});
		},
		goToPage: function(value)
		{
			return this.each(function()
			{
				var $container = $(this);
				var data = $container.data(PLUGIN_NAME);
				data.scrollAbstract.goToPage(value);
			});
		},
		changePagesSize: function(value)
		{
			return this.each(function()
			{
				var $container = $(this);
				var data = $container.data(PLUGIN_NAME);
				data.scrollAbstract.changePagesSize(value);
			});
		},
		onUpdate: function(listener)
		{
			return this.each(function()
			{
				var $container = $(this);
				var data = $container.data(PLUGIN_NAME);
				data.listener = listener;
			});
		},
		addListener: function(type, listener)
		{
			return this.each(function()
			{
				var $container = $(this);
				var data = $container.data(PLUGIN_NAME);
				data.scrollAbstract.addEventListener(type, listener);
			});
		},
		removeListener: function(type, listener)
		{
			return this.each(function()
			{
				var $container = $(this);
				var data = $container.data(PLUGIN_NAME);
				data.scrollAbstract.removeEventListener(type, listener);
			});
		},
		getAbstract: function()
		{
			var data = this.data(PLUGIN_NAME);
			return data.scrollAbstract;
		},
		destroy: function()
		{
			return this.each(function()
			{
				var $container = $(this);
				var data = $container.data(PLUGIN_NAME);
				data.scrollAbstract.destroy();
				data.unbindEvents();
				$container.removeData(PLUGIN_NAME)
			});
		}
	}
	
	function initialize()
	{
		libraryInitialized = true;
		$document = $(document);
	}
}
)(jQuery);
/*	SWFObject v2.2 <http://code.google.com/p/swfobject/> 
	is released under the MIT License <http://www.opensource.org/licenses/mit-license.php> 
*/
var swfobject=function(){var D="undefined",r="object",S="Shockwave Flash",W="ShockwaveFlash.ShockwaveFlash",q="application/x-shockwave-flash",R="SWFObjectExprInst",x="onreadystatechange",O=window,j=document,t=navigator,T=false,U=[h],o=[],N=[],I=[],l,Q,E,B,J=false,a=false,n,G,m=true,M=function(){var aa=typeof j.getElementById!=D&&typeof j.getElementsByTagName!=D&&typeof j.createElement!=D,ah=t.userAgent.toLowerCase(),Y=t.platform.toLowerCase(),ae=Y?/win/.test(Y):/win/.test(ah),ac=Y?/mac/.test(Y):/mac/.test(ah),af=/webkit/.test(ah)?parseFloat(ah.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,X=!+"\v1",ag=[0,0,0],ab=null;if(typeof t.plugins!=D&&typeof t.plugins[S]==r){ab=t.plugins[S].description;if(ab&&!(typeof t.mimeTypes!=D&&t.mimeTypes[q]&&!t.mimeTypes[q].enabledPlugin)){T=true;X=false;ab=ab.replace(/^.*\s+(\S+\s+\S+$)/,"$1");ag[0]=parseInt(ab.replace(/^(.*)\..*$/,"$1"),10);ag[1]=parseInt(ab.replace(/^.*\.(.*)\s.*$/,"$1"),10);ag[2]=/[a-zA-Z]/.test(ab)?parseInt(ab.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof O.ActiveXObject!=D){try{var ad=new ActiveXObject(W);if(ad){ab=ad.GetVariable("$version");if(ab){X=true;ab=ab.split(" ")[1].split(",");ag=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)]}}}catch(Z){}}}return{w3:aa,pv:ag,wk:af,ie:X,win:ae,mac:ac}}(),k=function(){if(!M.w3){return}if((typeof j.readyState!=D&&j.readyState=="complete")||(typeof j.readyState==D&&(j.getElementsByTagName("body")[0]||j.body))){f()}if(!J){if(typeof j.addEventListener!=D){j.addEventListener("DOMContentLoaded",f,false)}if(M.ie&&M.win){j.attachEvent(x,function(){if(j.readyState=="complete"){j.detachEvent(x,arguments.callee);f()}});if(O==top){(function(){if(J){return}try{j.documentElement.doScroll("left")}catch(X){setTimeout(arguments.callee,0);return}f()})()}}if(M.wk){(function(){if(J){return}if(!/loaded|complete/.test(j.readyState)){setTimeout(arguments.callee,0);return}f()})()}s(f)}}();function f(){if(J){return}try{var Z=j.getElementsByTagName("body")[0].appendChild(C("span"));Z.parentNode.removeChild(Z)}catch(aa){return}J=true;var X=U.length;for(var Y=0;Y<X;Y++){U[Y]()}}function K(X){if(J){X()}else{U[U.length]=X}}function s(Y){if(typeof O.addEventListener!=D){O.addEventListener("load",Y,false)}else{if(typeof j.addEventListener!=D){j.addEventListener("load",Y,false)}else{if(typeof O.attachEvent!=D){i(O,"onload",Y)}else{if(typeof O.onload=="function"){var X=O.onload;O.onload=function(){X();Y()}}else{O.onload=Y}}}}}function h(){if(T){V()}else{H()}}function V(){var X=j.getElementsByTagName("body")[0];var aa=C(r);aa.setAttribute("type",q);var Z=X.appendChild(aa);if(Z){var Y=0;(function(){if(typeof Z.GetVariable!=D){var ab=Z.GetVariable("$version");if(ab){ab=ab.split(" ")[1].split(",");M.pv=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)]}}else{if(Y<10){Y++;setTimeout(arguments.callee,10);return}}X.removeChild(aa);Z=null;H()})()}else{H()}}function H(){var ag=o.length;if(ag>0){for(var af=0;af<ag;af++){var Y=o[af].id;var ab=o[af].callbackFn;var aa={success:false,id:Y};if(M.pv[0]>0){var ae=c(Y);if(ae){if(F(o[af].swfVersion)&&!(M.wk&&M.wk<312)){w(Y,true);if(ab){aa.success=true;aa.ref=z(Y);ab(aa)}}else{if(o[af].expressInstall&&A()){var ai={};ai.data=o[af].expressInstall;ai.width=ae.getAttribute("width")||"0";ai.height=ae.getAttribute("height")||"0";if(ae.getAttribute("class")){ai.styleclass=ae.getAttribute("class")}if(ae.getAttribute("align")){ai.align=ae.getAttribute("align")}var ah={};var X=ae.getElementsByTagName("param");var ac=X.length;for(var ad=0;ad<ac;ad++){if(X[ad].getAttribute("name").toLowerCase()!="movie"){ah[X[ad].getAttribute("name")]=X[ad].getAttribute("value")}}P(ai,ah,Y,ab)}else{p(ae);if(ab){ab(aa)}}}}}else{w(Y,true);if(ab){var Z=z(Y);if(Z&&typeof Z.SetVariable!=D){aa.success=true;aa.ref=Z}ab(aa)}}}}}function z(aa){var X=null;var Y=c(aa);if(Y&&Y.nodeName=="OBJECT"){if(typeof Y.SetVariable!=D){X=Y}else{var Z=Y.getElementsByTagName(r)[0];if(Z){X=Z}}}return X}function A(){return !a&&F("6.0.65")&&(M.win||M.mac)&&!(M.wk&&M.wk<312)}function P(aa,ab,X,Z){a=true;E=Z||null;B={success:false,id:X};var ae=c(X);if(ae){if(ae.nodeName=="OBJECT"){l=g(ae);Q=null}else{l=ae;Q=X}aa.id=R;if(typeof aa.width==D||(!/%$/.test(aa.width)&&parseInt(aa.width,10)<310)){aa.width="310"}if(typeof aa.height==D||(!/%$/.test(aa.height)&&parseInt(aa.height,10)<137)){aa.height="137"}j.title=j.title.slice(0,47)+" - Flash Player Installation";var ad=M.ie&&M.win?"ActiveX":"PlugIn",ac="MMredirectURL="+O.location.toString().replace(/&/g,"%26")+"&MMplayerType="+ad+"&MMdoctitle="+j.title;if(typeof ab.flashvars!=D){ab.flashvars+="&"+ac}else{ab.flashvars=ac}if(M.ie&&M.win&&ae.readyState!=4){var Y=C("div");X+="SWFObjectNew";Y.setAttribute("id",X);ae.parentNode.insertBefore(Y,ae);ae.style.display="none";(function(){if(ae.readyState==4){ae.parentNode.removeChild(ae)}else{setTimeout(arguments.callee,10)}})()}u(aa,ab,X)}}function p(Y){if(M.ie&&M.win&&Y.readyState!=4){var X=C("div");Y.parentNode.insertBefore(X,Y);X.parentNode.replaceChild(g(Y),X);Y.style.display="none";(function(){if(Y.readyState==4){Y.parentNode.removeChild(Y)}else{setTimeout(arguments.callee,10)}})()}else{Y.parentNode.replaceChild(g(Y),Y)}}function g(ab){var aa=C("div");if(M.win&&M.ie){aa.innerHTML=ab.innerHTML}else{var Y=ab.getElementsByTagName(r)[0];if(Y){var ad=Y.childNodes;if(ad){var X=ad.length;for(var Z=0;Z<X;Z++){if(!(ad[Z].nodeType==1&&ad[Z].nodeName=="PARAM")&&!(ad[Z].nodeType==8)){aa.appendChild(ad[Z].cloneNode(true))}}}}}return aa}function u(ai,ag,Y){var X,aa=c(Y);if(M.wk&&M.wk<312){return X}if(aa){if(typeof ai.id==D){ai.id=Y}if(M.ie&&M.win){var ah="";for(var ae in ai){if(ai[ae]!=Object.prototype[ae]){if(ae.toLowerCase()=="data"){ag.movie=ai[ae]}else{if(ae.toLowerCase()=="styleclass"){ah+=' class="'+ai[ae]+'"'}else{if(ae.toLowerCase()!="classid"){ah+=" "+ae+'="'+ai[ae]+'"'}}}}}var af="";for(var ad in ag){if(ag[ad]!=Object.prototype[ad]){af+='<param name="'+ad+'" value="'+ag[ad]+'" />'}}aa.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+ah+">"+af+"</object>";N[N.length]=ai.id;X=c(ai.id)}else{var Z=C(r);Z.setAttribute("type",q);for(var ac in ai){if(ai[ac]!=Object.prototype[ac]){if(ac.toLowerCase()=="styleclass"){Z.setAttribute("class",ai[ac])}else{if(ac.toLowerCase()!="classid"){Z.setAttribute(ac,ai[ac])}}}}for(var ab in ag){if(ag[ab]!=Object.prototype[ab]&&ab.toLowerCase()!="movie"){e(Z,ab,ag[ab])}}aa.parentNode.replaceChild(Z,aa);X=Z}}return X}function e(Z,X,Y){var aa=C("param");aa.setAttribute("name",X);aa.setAttribute("value",Y);Z.appendChild(aa)}function y(Y){var X=c(Y);if(X&&X.nodeName=="OBJECT"){if(M.ie&&M.win){X.style.display="none";(function(){if(X.readyState==4){b(Y)}else{setTimeout(arguments.callee,10)}})()}else{X.parentNode.removeChild(X)}}}function b(Z){var Y=c(Z);if(Y){for(var X in Y){if(typeof Y[X]=="function"){Y[X]=null}}Y.parentNode.removeChild(Y)}}function c(Z){var X=null;try{X=j.getElementById(Z)}catch(Y){}return X}function C(X){return j.createElement(X)}function i(Z,X,Y){Z.attachEvent(X,Y);I[I.length]=[Z,X,Y]}function F(Z){var Y=M.pv,X=Z.split(".");X[0]=parseInt(X[0],10);X[1]=parseInt(X[1],10)||0;X[2]=parseInt(X[2],10)||0;return(Y[0]>X[0]||(Y[0]==X[0]&&Y[1]>X[1])||(Y[0]==X[0]&&Y[1]==X[1]&&Y[2]>=X[2]))?true:false}function v(ac,Y,ad,ab){if(M.ie&&M.mac){return}var aa=j.getElementsByTagName("head")[0];if(!aa){return}var X=(ad&&typeof ad=="string")?ad:"screen";if(ab){n=null;G=null}if(!n||G!=X){var Z=C("style");Z.setAttribute("type","text/css");Z.setAttribute("media",X);n=aa.appendChild(Z);if(M.ie&&M.win&&typeof j.styleSheets!=D&&j.styleSheets.length>0){n=j.styleSheets[j.styleSheets.length-1]}G=X}if(M.ie&&M.win){if(n&&typeof n.addRule==r){n.addRule(ac,Y)}}else{if(n&&typeof j.createTextNode!=D){n.appendChild(j.createTextNode(ac+" {"+Y+"}"))}}}function w(Z,X){if(!m){return}var Y=X?"visible":"hidden";if(J&&c(Z)){c(Z).style.visibility=Y}else{v("#"+Z,"visibility:"+Y)}}function L(Y){var Z=/[\\\"<>\.;]/;var X=Z.exec(Y)!=null;return X&&typeof encodeURIComponent!=D?encodeURIComponent(Y):Y}var d=function(){if(M.ie&&M.win){window.attachEvent("onunload",function(){var ac=I.length;for(var ab=0;ab<ac;ab++){I[ab][0].detachEvent(I[ab][1],I[ab][2])}var Z=N.length;for(var aa=0;aa<Z;aa++){y(N[aa])}for(var Y in M){M[Y]=null}M=null;for(var X in swfobject){swfobject[X]=null}swfobject=null})}}();return{registerObject:function(ab,X,aa,Z){if(M.w3&&ab&&X){var Y={};Y.id=ab;Y.swfVersion=X;Y.expressInstall=aa;Y.callbackFn=Z;o[o.length]=Y;w(ab,false)}else{if(Z){Z({success:false,id:ab})}}},getObjectById:function(X){if(M.w3){return z(X)}},embedSWF:function(ab,ah,ae,ag,Y,aa,Z,ad,af,ac){var X={success:false,id:ah};if(M.w3&&!(M.wk&&M.wk<312)&&ab&&ah&&ae&&ag&&Y){w(ah,false);K(function(){ae+="";ag+="";var aj={};if(af&&typeof af===r){for(var al in af){aj[al]=af[al]}}aj.data=ab;aj.width=ae;aj.height=ag;var am={};if(ad&&typeof ad===r){for(var ak in ad){am[ak]=ad[ak]}}if(Z&&typeof Z===r){for(var ai in Z){if(typeof am.flashvars!=D){am.flashvars+="&"+ai+"="+Z[ai]}else{am.flashvars=ai+"="+Z[ai]}}}if(F(Y)){var an=u(aj,am,ah);if(aj.id==ah){w(ah,true)}X.success=true;X.ref=an}else{if(aa&&A()){aj.data=aa;P(aj,am,ah,ac);return}else{w(ah,true)}}if(ac){ac(X)}})}else{if(ac){ac(X)}}},switchOffAutoHideShow:function(){m=false},ua:M,getFlashPlayerVersion:function(){return{major:M.pv[0],minor:M.pv[1],release:M.pv[2]}},hasFlashPlayerVersion:F,createSWF:function(Z,Y,X){if(M.w3){return u(Z,Y,X)}else{return undefined}},showExpressInstall:function(Z,aa,X,Y){if(M.w3&&A()){P(Z,aa,X,Y)}},removeSWF:function(X){if(M.w3){y(X)}},createCSS:function(aa,Z,Y,X){if(M.w3){v(aa,Z,Y,X)}},addDomLoadEvent:K,addLoadEvent:s,getQueryParamValue:function(aa){var Z=j.location.search||j.location.hash;if(Z){if(/\?/.test(Z)){Z=Z.split("?")[1]}if(aa==null){return L(Z)}var Y=Z.split("&");for(var X=0;X<Y.length;X++){if(Y[X].substring(0,Y[X].indexOf("="))==aa){return L(Y[X].substring((Y[X].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(a){var X=c(R);if(X&&l){X.parentNode.replaceChild(l,X);if(Q){w(Q,true);if(M.ie&&M.win){l.style.display="block"}}if(E){E(B)}}a=false}}}}();
/*!
 * Masonry PACKAGED v3.1.5
 * Cascading grid layout library
 * http://masonry.desandro.com
 * MIT License
 * by David DeSandro
 */

!function(a){function b(){}function c(a){function c(b){b.prototype.option||(b.prototype.option=function(b){a.isPlainObject(b)&&(this.options=a.extend(!0,this.options,b))})}function e(b,c){a.fn[b]=function(e){if("string"==typeof e){for(var g=d.call(arguments,1),h=0,i=this.length;i>h;h++){var j=this[h],k=a.data(j,b);if(k)if(a.isFunction(k[e])&&"_"!==e.charAt(0)){var l=k[e].apply(k,g);if(void 0!==l)return l}else f("no such method '"+e+"' for "+b+" instance");else f("cannot call methods on "+b+" prior to initialization; attempted to call '"+e+"'")}return this}return this.each(function(){var d=a.data(this,b);d?(d.option(e),d._init()):(d=new c(this,e),a.data(this,b,d))})}}if(a){var f="undefined"==typeof console?b:function(a){console.error(a)};return a.bridget=function(a,b){c(b),e(a,b)},a.bridget}}var d=Array.prototype.slice;"function"==typeof define&&define.amd?define("jquery-bridget/jquery.bridget",["jquery"],c):c(a.jQuery)}(window),function(a){function b(b){var c=a.event;return c.target=c.target||c.srcElement||b,c}var c=document.documentElement,d=function(){};c.addEventListener?d=function(a,b,c){a.addEventListener(b,c,!1)}:c.attachEvent&&(d=function(a,c,d){a[c+d]=d.handleEvent?function(){var c=b(a);d.handleEvent.call(d,c)}:function(){var c=b(a);d.call(a,c)},a.attachEvent("on"+c,a[c+d])});var e=function(){};c.removeEventListener?e=function(a,b,c){a.removeEventListener(b,c,!1)}:c.detachEvent&&(e=function(a,b,c){a.detachEvent("on"+b,a[b+c]);try{delete a[b+c]}catch(d){a[b+c]=void 0}});var f={bind:d,unbind:e};"function"==typeof define&&define.amd?define("eventie/eventie",f):"object"==typeof exports?module.exports=f:a.eventie=f}(this),function(a){function b(a){"function"==typeof a&&(b.isReady?a():f.push(a))}function c(a){var c="readystatechange"===a.type&&"complete"!==e.readyState;if(!b.isReady&&!c){b.isReady=!0;for(var d=0,g=f.length;g>d;d++){var h=f[d];h()}}}function d(d){return d.bind(e,"DOMContentLoaded",c),d.bind(e,"readystatechange",c),d.bind(a,"load",c),b}var e=a.document,f=[];b.isReady=!1,"function"==typeof define&&define.amd?(b.isReady="function"==typeof requirejs,define("doc-ready/doc-ready",["eventie/eventie"],d)):a.docReady=d(a.eventie)}(this),function(){function a(){}function b(a,b){for(var c=a.length;c--;)if(a[c].listener===b)return c;return-1}function c(a){return function(){return this[a].apply(this,arguments)}}var d=a.prototype,e=this,f=e.EventEmitter;d.getListeners=function(a){var b,c,d=this._getEvents();if(a instanceof RegExp){b={};for(c in d)d.hasOwnProperty(c)&&a.test(c)&&(b[c]=d[c])}else b=d[a]||(d[a]=[]);return b},d.flattenListeners=function(a){var b,c=[];for(b=0;b<a.length;b+=1)c.push(a[b].listener);return c},d.getListenersAsObject=function(a){var b,c=this.getListeners(a);return c instanceof Array&&(b={},b[a]=c),b||c},d.addListener=function(a,c){var d,e=this.getListenersAsObject(a),f="object"==typeof c;for(d in e)e.hasOwnProperty(d)&&-1===b(e[d],c)&&e[d].push(f?c:{listener:c,once:!1});return this},d.on=c("addListener"),d.addOnceListener=function(a,b){return this.addListener(a,{listener:b,once:!0})},d.once=c("addOnceListener"),d.defineEvent=function(a){return this.getListeners(a),this},d.defineEvents=function(a){for(var b=0;b<a.length;b+=1)this.defineEvent(a[b]);return this},d.removeListener=function(a,c){var d,e,f=this.getListenersAsObject(a);for(e in f)f.hasOwnProperty(e)&&(d=b(f[e],c),-1!==d&&f[e].splice(d,1));return this},d.off=c("removeListener"),d.addListeners=function(a,b){return this.manipulateListeners(!1,a,b)},d.removeListeners=function(a,b){return this.manipulateListeners(!0,a,b)},d.manipulateListeners=function(a,b,c){var d,e,f=a?this.removeListener:this.addListener,g=a?this.removeListeners:this.addListeners;if("object"!=typeof b||b instanceof RegExp)for(d=c.length;d--;)f.call(this,b,c[d]);else for(d in b)b.hasOwnProperty(d)&&(e=b[d])&&("function"==typeof e?f.call(this,d,e):g.call(this,d,e));return this},d.removeEvent=function(a){var b,c=typeof a,d=this._getEvents();if("string"===c)delete d[a];else if(a instanceof RegExp)for(b in d)d.hasOwnProperty(b)&&a.test(b)&&delete d[b];else delete this._events;return this},d.removeAllListeners=c("removeEvent"),d.emitEvent=function(a,b){var c,d,e,f,g=this.getListenersAsObject(a);for(e in g)if(g.hasOwnProperty(e))for(d=g[e].length;d--;)c=g[e][d],c.once===!0&&this.removeListener(a,c.listener),f=c.listener.apply(this,b||[]),f===this._getOnceReturnValue()&&this.removeListener(a,c.listener);return this},d.trigger=c("emitEvent"),d.emit=function(a){var b=Array.prototype.slice.call(arguments,1);return this.emitEvent(a,b)},d.setOnceReturnValue=function(a){return this._onceReturnValue=a,this},d._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},d._getEvents=function(){return this._events||(this._events={})},a.noConflict=function(){return e.EventEmitter=f,a},"function"==typeof define&&define.amd?define("eventEmitter/EventEmitter",[],function(){return a}):"object"==typeof module&&module.exports?module.exports=a:this.EventEmitter=a}.call(this),function(a){function b(a){if(a){if("string"==typeof d[a])return a;a=a.charAt(0).toUpperCase()+a.slice(1);for(var b,e=0,f=c.length;f>e;e++)if(b=c[e]+a,"string"==typeof d[b])return b}}var c="Webkit Moz ms Ms O".split(" "),d=document.documentElement.style;"function"==typeof define&&define.amd?define("get-style-property/get-style-property",[],function(){return b}):"object"==typeof exports?module.exports=b:a.getStyleProperty=b}(window),function(a){function b(a){var b=parseFloat(a),c=-1===a.indexOf("%")&&!isNaN(b);return c&&b}function c(){for(var a={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},b=0,c=g.length;c>b;b++){var d=g[b];a[d]=0}return a}function d(a){function d(a){if("string"==typeof a&&(a=document.querySelector(a)),a&&"object"==typeof a&&a.nodeType){var d=f(a);if("none"===d.display)return c();var e={};e.width=a.offsetWidth,e.height=a.offsetHeight;for(var k=e.isBorderBox=!(!j||!d[j]||"border-box"!==d[j]),l=0,m=g.length;m>l;l++){var n=g[l],o=d[n];o=h(a,o);var p=parseFloat(o);e[n]=isNaN(p)?0:p}var q=e.paddingLeft+e.paddingRight,r=e.paddingTop+e.paddingBottom,s=e.marginLeft+e.marginRight,t=e.marginTop+e.marginBottom,u=e.borderLeftWidth+e.borderRightWidth,v=e.borderTopWidth+e.borderBottomWidth,w=k&&i,x=b(d.width);x!==!1&&(e.width=x+(w?0:q+u));var y=b(d.height);return y!==!1&&(e.height=y+(w?0:r+v)),e.innerWidth=e.width-(q+u),e.innerHeight=e.height-(r+v),e.outerWidth=e.width+s,e.outerHeight=e.height+t,e}}function h(a,b){if(e||-1===b.indexOf("%"))return b;var c=a.style,d=c.left,f=a.runtimeStyle,g=f&&f.left;return g&&(f.left=a.currentStyle.left),c.left=b,b=c.pixelLeft,c.left=d,g&&(f.left=g),b}var i,j=a("boxSizing");return function(){if(j){var a=document.createElement("div");a.style.width="200px",a.style.padding="1px 2px 3px 4px",a.style.borderStyle="solid",a.style.borderWidth="1px 2px 3px 4px",a.style[j]="border-box";var c=document.body||document.documentElement;c.appendChild(a);var d=f(a);i=200===b(d.width),c.removeChild(a)}}(),d}var e=a.getComputedStyle,f=e?function(a){return e(a,null)}:function(a){return a.currentStyle},g=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"];"function"==typeof define&&define.amd?define("get-size/get-size",["get-style-property/get-style-property"],d):"object"==typeof exports?module.exports=d(require("get-style-property")):a.getSize=d(a.getStyleProperty)}(window),function(a,b){function c(a,b){return a[h](b)}function d(a){if(!a.parentNode){var b=document.createDocumentFragment();b.appendChild(a)}}function e(a,b){d(a);for(var c=a.parentNode.querySelectorAll(b),e=0,f=c.length;f>e;e++)if(c[e]===a)return!0;return!1}function f(a,b){return d(a),c(a,b)}var g,h=function(){if(b.matchesSelector)return"matchesSelector";for(var a=["webkit","moz","ms","o"],c=0,d=a.length;d>c;c++){var e=a[c],f=e+"MatchesSelector";if(b[f])return f}}();if(h){var i=document.createElement("div"),j=c(i,"div");g=j?c:f}else g=e;"function"==typeof define&&define.amd?define("matches-selector/matches-selector",[],function(){return g}):window.matchesSelector=g}(this,Element.prototype),function(a){function b(a,b){for(var c in b)a[c]=b[c];return a}function c(a){for(var b in a)return!1;return b=null,!0}function d(a){return a.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()})}function e(a,e,f){function h(a,b){a&&(this.element=a,this.layout=b,this.position={x:0,y:0},this._create())}var i=f("transition"),j=f("transform"),k=i&&j,l=!!f("perspective"),m={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"otransitionend",transition:"transitionend"}[i],n=["transform","transition","transitionDuration","transitionProperty"],o=function(){for(var a={},b=0,c=n.length;c>b;b++){var d=n[b],e=f(d);e&&e!==d&&(a[d]=e)}return a}();b(h.prototype,a.prototype),h.prototype._create=function(){this._transn={ingProperties:{},clean:{},onEnd:{}},this.css({position:"absolute"})},h.prototype.handleEvent=function(a){var b="on"+a.type;this[b]&&this[b](a)},h.prototype.getSize=function(){this.size=e(this.element)},h.prototype.css=function(a){var b=this.element.style;for(var c in a){var d=o[c]||c;b[d]=a[c]}},h.prototype.getPosition=function(){var a=g(this.element),b=this.layout.options,c=b.isOriginLeft,d=b.isOriginTop,e=parseInt(a[c?"left":"right"],10),f=parseInt(a[d?"top":"bottom"],10);e=isNaN(e)?0:e,f=isNaN(f)?0:f;var h=this.layout.size;e-=c?h.paddingLeft:h.paddingRight,f-=d?h.paddingTop:h.paddingBottom,this.position.x=e,this.position.y=f},h.prototype.layoutPosition=function(){var a=this.layout.size,b=this.layout.options,c={};b.isOriginLeft?(c.left=this.position.x+a.paddingLeft+"px",c.right=""):(c.right=this.position.x+a.paddingRight+"px",c.left=""),b.isOriginTop?(c.top=this.position.y+a.paddingTop+"px",c.bottom=""):(c.bottom=this.position.y+a.paddingBottom+"px",c.top=""),this.css(c),this.emitEvent("layout",[this])};var p=l?function(a,b){return"translate3d("+a+"px, "+b+"px, 0)"}:function(a,b){return"translate("+a+"px, "+b+"px)"};h.prototype._transitionTo=function(a,b){this.getPosition();var c=this.position.x,d=this.position.y,e=parseInt(a,10),f=parseInt(b,10),g=e===this.position.x&&f===this.position.y;if(this.setPosition(a,b),g&&!this.isTransitioning)return void this.layoutPosition();var h=a-c,i=b-d,j={},k=this.layout.options;h=k.isOriginLeft?h:-h,i=k.isOriginTop?i:-i,j.transform=p(h,i),this.transition({to:j,onTransitionEnd:{transform:this.layoutPosition},isCleaning:!0})},h.prototype.goTo=function(a,b){this.setPosition(a,b),this.layoutPosition()},h.prototype.moveTo=k?h.prototype._transitionTo:h.prototype.goTo,h.prototype.setPosition=function(a,b){this.position.x=parseInt(a,10),this.position.y=parseInt(b,10)},h.prototype._nonTransition=function(a){this.css(a.to),a.isCleaning&&this._removeStyles(a.to);for(var b in a.onTransitionEnd)a.onTransitionEnd[b].call(this)},h.prototype._transition=function(a){if(!parseFloat(this.layout.options.transitionDuration))return void this._nonTransition(a);var b=this._transn;for(var c in a.onTransitionEnd)b.onEnd[c]=a.onTransitionEnd[c];for(c in a.to)b.ingProperties[c]=!0,a.isCleaning&&(b.clean[c]=!0);if(a.from){this.css(a.from);var d=this.element.offsetHeight;d=null}this.enableTransition(a.to),this.css(a.to),this.isTransitioning=!0};var q=j&&d(j)+",opacity";h.prototype.enableTransition=function(){this.isTransitioning||(this.css({transitionProperty:q,transitionDuration:this.layout.options.transitionDuration}),this.element.addEventListener(m,this,!1))},h.prototype.transition=h.prototype[i?"_transition":"_nonTransition"],h.prototype.onwebkitTransitionEnd=function(a){this.ontransitionend(a)},h.prototype.onotransitionend=function(a){this.ontransitionend(a)};var r={"-webkit-transform":"transform","-moz-transform":"transform","-o-transform":"transform"};h.prototype.ontransitionend=function(a){if(a.target===this.element){var b=this._transn,d=r[a.propertyName]||a.propertyName;if(delete b.ingProperties[d],c(b.ingProperties)&&this.disableTransition(),d in b.clean&&(this.element.style[a.propertyName]="",delete b.clean[d]),d in b.onEnd){var e=b.onEnd[d];e.call(this),delete b.onEnd[d]}this.emitEvent("transitionEnd",[this])}},h.prototype.disableTransition=function(){this.removeTransitionStyles(),this.element.removeEventListener(m,this,!1),this.isTransitioning=!1},h.prototype._removeStyles=function(a){var b={};for(var c in a)b[c]="";this.css(b)};var s={transitionProperty:"",transitionDuration:""};return h.prototype.removeTransitionStyles=function(){this.css(s)},h.prototype.removeElem=function(){this.element.parentNode.removeChild(this.element),this.emitEvent("remove",[this])},h.prototype.remove=function(){if(!i||!parseFloat(this.layout.options.transitionDuration))return void this.removeElem();var a=this;this.on("transitionEnd",function(){return a.removeElem(),!0}),this.hide()},h.prototype.reveal=function(){delete this.isHidden,this.css({display:""});var a=this.layout.options;this.transition({from:a.hiddenStyle,to:a.visibleStyle,isCleaning:!0})},h.prototype.hide=function(){this.isHidden=!0,this.css({display:""});var a=this.layout.options;this.transition({from:a.visibleStyle,to:a.hiddenStyle,isCleaning:!0,onTransitionEnd:{opacity:function(){this.isHidden&&this.css({display:"none"})}}})},h.prototype.destroy=function(){this.css({position:"",left:"",right:"",top:"",bottom:"",transition:"",transform:""})},h}var f=a.getComputedStyle,g=f?function(a){return f(a,null)}:function(a){return a.currentStyle};"function"==typeof define&&define.amd?define("outlayer/item",["eventEmitter/EventEmitter","get-size/get-size","get-style-property/get-style-property"],e):(a.Outlayer={},a.Outlayer.Item=e(a.EventEmitter,a.getSize,a.getStyleProperty))}(window),function(a){function b(a,b){for(var c in b)a[c]=b[c];return a}function c(a){return"[object Array]"===l.call(a)}function d(a){var b=[];if(c(a))b=a;else if(a&&"number"==typeof a.length)for(var d=0,e=a.length;e>d;d++)b.push(a[d]);else b.push(a);return b}function e(a,b){var c=n(b,a);-1!==c&&b.splice(c,1)}function f(a){return a.replace(/(.)([A-Z])/g,function(a,b,c){return b+"-"+c}).toLowerCase()}function g(c,g,l,n,o,p){function q(a,c){if("string"==typeof a&&(a=h.querySelector(a)),!a||!m(a))return void(i&&i.error("Bad "+this.constructor.namespace+" element: "+a));this.element=a,this.options=b({},this.constructor.defaults),this.option(c);var d=++r;this.element.outlayerGUID=d,s[d]=this,this._create(),this.options.isInitLayout&&this.layout()}var r=0,s={};return q.namespace="outlayer",q.Item=p,q.defaults={containerStyle:{position:"relative"},isInitLayout:!0,isOriginLeft:!0,isOriginTop:!0,isResizeBound:!0,isResizingContainer:!0,transitionDuration:"0.4s",hiddenStyle:{opacity:0,transform:"scale(0.001)"},visibleStyle:{opacity:1,transform:"scale(1)"}},b(q.prototype,l.prototype),q.prototype.option=function(a){b(this.options,a)},q.prototype._create=function(){this.reloadItems(),this.stamps=[],this.stamp(this.options.stamp),b(this.element.style,this.options.containerStyle),this.options.isResizeBound&&this.bindResize()},q.prototype.reloadItems=function(){this.items=this._itemize(this.element.children)},q.prototype._itemize=function(a){for(var b=this._filterFindItemElements(a),c=this.constructor.Item,d=[],e=0,f=b.length;f>e;e++){var g=b[e],h=new c(g,this);d.push(h)}return d},q.prototype._filterFindItemElements=function(a){a=d(a);for(var b=this.options.itemSelector,c=[],e=0,f=a.length;f>e;e++){var g=a[e];if(m(g))if(b){o(g,b)&&c.push(g);for(var h=g.querySelectorAll(b),i=0,j=h.length;j>i;i++)c.push(h[i])}else c.push(g)}return c},q.prototype.getItemElements=function(){for(var a=[],b=0,c=this.items.length;c>b;b++)a.push(this.items[b].element);return a},q.prototype.layout=function(){this._resetLayout(),this._manageStamps();var a=void 0!==this.options.isLayoutInstant?this.options.isLayoutInstant:!this._isLayoutInited;this.layoutItems(this.items,a),this._isLayoutInited=!0},q.prototype._init=q.prototype.layout,q.prototype._resetLayout=function(){this.getSize()},q.prototype.getSize=function(){this.size=n(this.element)},q.prototype._getMeasurement=function(a,b){var c,d=this.options[a];d?("string"==typeof d?c=this.element.querySelector(d):m(d)&&(c=d),this[a]=c?n(c)[b]:d):this[a]=0},q.prototype.layoutItems=function(a,b){a=this._getItemsForLayout(a),this._layoutItems(a,b),this._postLayout()},q.prototype._getItemsForLayout=function(a){for(var b=[],c=0,d=a.length;d>c;c++){var e=a[c];e.isIgnored||b.push(e)}return b},q.prototype._layoutItems=function(a,b){function c(){d.emitEvent("layoutComplete",[d,a])}var d=this;if(!a||!a.length)return void c();this._itemsOn(a,"layout",c);for(var e=[],f=0,g=a.length;g>f;f++){var h=a[f],i=this._getItemLayoutPosition(h);i.item=h,i.isInstant=b||h.isLayoutInstant,e.push(i)}this._processLayoutQueue(e)},q.prototype._getItemLayoutPosition=function(){return{x:0,y:0}},q.prototype._processLayoutQueue=function(a){for(var b=0,c=a.length;c>b;b++){var d=a[b];this._positionItem(d.item,d.x,d.y,d.isInstant)}},q.prototype._positionItem=function(a,b,c,d){d?a.goTo(b,c):a.moveTo(b,c)},q.prototype._postLayout=function(){this.resizeContainer()},q.prototype.resizeContainer=function(){if(this.options.isResizingContainer){var a=this._getContainerSize();a&&(this._setContainerMeasure(a.width,!0),this._setContainerMeasure(a.height,!1))}},q.prototype._getContainerSize=k,q.prototype._setContainerMeasure=function(a,b){if(void 0!==a){var c=this.size;c.isBorderBox&&(a+=b?c.paddingLeft+c.paddingRight+c.borderLeftWidth+c.borderRightWidth:c.paddingBottom+c.paddingTop+c.borderTopWidth+c.borderBottomWidth),a=Math.max(a,0),this.element.style[b?"width":"height"]=a+"px"}},q.prototype._itemsOn=function(a,b,c){function d(){return e++,e===f&&c.call(g),!0}for(var e=0,f=a.length,g=this,h=0,i=a.length;i>h;h++){var j=a[h];j.on(b,d)}},q.prototype.ignore=function(a){var b=this.getItem(a);b&&(b.isIgnored=!0)},q.prototype.unignore=function(a){var b=this.getItem(a);b&&delete b.isIgnored},q.prototype.stamp=function(a){if(a=this._find(a)){this.stamps=this.stamps.concat(a);for(var b=0,c=a.length;c>b;b++){var d=a[b];this.ignore(d)}}},q.prototype.unstamp=function(a){if(a=this._find(a))for(var b=0,c=a.length;c>b;b++){var d=a[b];e(d,this.stamps),this.unignore(d)}},q.prototype._find=function(a){return a?("string"==typeof a&&(a=this.element.querySelectorAll(a)),a=d(a)):void 0},q.prototype._manageStamps=function(){if(this.stamps&&this.stamps.length){this._getBoundingRect();for(var a=0,b=this.stamps.length;b>a;a++){var c=this.stamps[a];this._manageStamp(c)}}},q.prototype._getBoundingRect=function(){var a=this.element.getBoundingClientRect(),b=this.size;this._boundingRect={left:a.left+b.paddingLeft+b.borderLeftWidth,top:a.top+b.paddingTop+b.borderTopWidth,right:a.right-(b.paddingRight+b.borderRightWidth),bottom:a.bottom-(b.paddingBottom+b.borderBottomWidth)}},q.prototype._manageStamp=k,q.prototype._getElementOffset=function(a){var b=a.getBoundingClientRect(),c=this._boundingRect,d=n(a),e={left:b.left-c.left-d.marginLeft,top:b.top-c.top-d.marginTop,right:c.right-b.right-d.marginRight,bottom:c.bottom-b.bottom-d.marginBottom};return e},q.prototype.handleEvent=function(a){var b="on"+a.type;this[b]&&this[b](a)},q.prototype.bindResize=function(){this.isResizeBound||(c.bind(a,"resize",this),this.isResizeBound=!0)},q.prototype.unbindResize=function(){this.isResizeBound&&c.unbind(a,"resize",this),this.isResizeBound=!1},q.prototype.onresize=function(){function a(){b.resize(),delete b.resizeTimeout}this.resizeTimeout&&clearTimeout(this.resizeTimeout);var b=this;this.resizeTimeout=setTimeout(a,100)},q.prototype.resize=function(){this.isResizeBound&&this.needsResizeLayout()&&this.layout()},q.prototype.needsResizeLayout=function(){var a=n(this.element),b=this.size&&a;return b&&a.innerWidth!==this.size.innerWidth},q.prototype.addItems=function(a){var b=this._itemize(a);return b.length&&(this.items=this.items.concat(b)),b},q.prototype.appended=function(a){var b=this.addItems(a);b.length&&(this.layoutItems(b,!0),this.reveal(b))},q.prototype.prepended=function(a){var b=this._itemize(a);if(b.length){var c=this.items.slice(0);this.items=b.concat(c),this._resetLayout(),this._manageStamps(),this.layoutItems(b,!0),this.reveal(b),this.layoutItems(c)}},q.prototype.reveal=function(a){var b=a&&a.length;if(b)for(var c=0;b>c;c++){var d=a[c];d.reveal()}},q.prototype.hide=function(a){var b=a&&a.length;if(b)for(var c=0;b>c;c++){var d=a[c];d.hide()}},q.prototype.getItem=function(a){for(var b=0,c=this.items.length;c>b;b++){var d=this.items[b];if(d.element===a)return d}},q.prototype.getItems=function(a){if(a&&a.length){for(var b=[],c=0,d=a.length;d>c;c++){var e=a[c],f=this.getItem(e);f&&b.push(f)}return b}},q.prototype.remove=function(a){a=d(a);var b=this.getItems(a);if(b&&b.length){this._itemsOn(b,"remove",function(){this.emitEvent("removeComplete",[this,b])});for(var c=0,f=b.length;f>c;c++){var g=b[c];g.remove(),e(g,this.items)}}},q.prototype.destroy=function(){var a=this.element.style;a.height="",a.position="",a.width="";for(var b=0,c=this.items.length;c>b;b++){var d=this.items[b];d.destroy()}this.unbindResize(),delete this.element.outlayerGUID,j&&j.removeData(this.element,this.constructor.namespace)},q.data=function(a){var b=a&&a.outlayerGUID;return b&&s[b]},q.create=function(a,c){function d(){q.apply(this,arguments)}return Object.create?d.prototype=Object.create(q.prototype):b(d.prototype,q.prototype),d.prototype.constructor=d,d.defaults=b({},q.defaults),b(d.defaults,c),d.prototype.settings={},d.namespace=a,d.data=q.data,d.Item=function(){p.apply(this,arguments)},d.Item.prototype=new p,g(function(){for(var b=f(a),c=h.querySelectorAll(".js-"+b),e="data-"+b+"-options",g=0,k=c.length;k>g;g++){var l,m=c[g],n=m.getAttribute(e);try{l=n&&JSON.parse(n)}catch(o){i&&i.error("Error parsing "+e+" on "+m.nodeName.toLowerCase()+(m.id?"#"+m.id:"")+": "+o);continue}var p=new d(m,l);j&&j.data(m,a,p)}}),j&&j.bridget&&j.bridget(a,d),d},q.Item=p,q}var h=a.document,i=a.console,j=a.jQuery,k=function(){},l=Object.prototype.toString,m="object"==typeof HTMLElement?function(a){return a instanceof HTMLElement}:function(a){return a&&"object"==typeof a&&1===a.nodeType&&"string"==typeof a.nodeName},n=Array.prototype.indexOf?function(a,b){return a.indexOf(b)}:function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1};"function"==typeof define&&define.amd?define("outlayer/outlayer",["eventie/eventie","doc-ready/doc-ready","eventEmitter/EventEmitter","get-size/get-size","matches-selector/matches-selector","./item"],g):a.Outlayer=g(a.eventie,a.docReady,a.EventEmitter,a.getSize,a.matchesSelector,a.Outlayer.Item)}(window),function(a){function b(a,b){var d=a.create("masonry");return d.prototype._resetLayout=function(){this.getSize(),this._getMeasurement("columnWidth","outerWidth"),this._getMeasurement("gutter","outerWidth"),this.measureColumns();var a=this.cols;for(this.colYs=[];a--;)this.colYs.push(0);this.maxY=0},d.prototype.measureColumns=function(){if(this.getContainerWidth(),!this.columnWidth){var a=this.items[0],c=a&&a.element;this.columnWidth=c&&b(c).outerWidth||this.containerWidth}this.columnWidth+=this.gutter,this.cols=Math.floor((this.containerWidth+this.gutter)/this.columnWidth),this.cols=Math.max(this.cols,1)},d.prototype.getContainerWidth=function(){var a=this.options.isFitWidth?this.element.parentNode:this.element,c=b(a);this.containerWidth=c&&c.innerWidth},d.prototype._getItemLayoutPosition=function(a){a.getSize();var b=a.size.outerWidth%this.columnWidth,d=b&&1>b?"round":"ceil",e=Math[d](a.size.outerWidth/this.columnWidth);e=Math.min(e,this.cols);for(var f=this._getColGroup(e),g=Math.min.apply(Math,f),h=c(f,g),i={x:this.columnWidth*h,y:g},j=g+a.size.outerHeight,k=this.cols+1-f.length,l=0;k>l;l++)this.colYs[h+l]=j;return i},d.prototype._getColGroup=function(a){if(2>a)return this.colYs;for(var b=[],c=this.cols+1-a,d=0;c>d;d++){var e=this.colYs.slice(d,d+a);b[d]=Math.max.apply(Math,e)}return b},d.prototype._manageStamp=function(a){var c=b(a),d=this._getElementOffset(a),e=this.options.isOriginLeft?d.left:d.right,f=e+c.outerWidth,g=Math.floor(e/this.columnWidth);g=Math.max(0,g);var h=Math.floor(f/this.columnWidth);h-=f%this.columnWidth?0:1,h=Math.min(this.cols-1,h);for(var i=(this.options.isOriginTop?d.top:d.bottom)+c.outerHeight,j=g;h>=j;j++)this.colYs[j]=Math.max(i,this.colYs[j])},d.prototype._getContainerSize=function(){this.maxY=Math.max.apply(Math,this.colYs);var a={height:this.maxY};return this.options.isFitWidth&&(a.width=this._getContainerFitWidth()),a},d.prototype._getContainerFitWidth=function(){for(var a=0,b=this.cols;--b&&0===this.colYs[b];)a++;return(this.cols-a)*this.columnWidth-this.gutter},d.prototype.needsResizeLayout=function(){var a=this.containerWidth;return this.getContainerWidth(),a!==this.containerWidth},d}var c=Array.prototype.indexOf?function(a,b){return a.indexOf(b)}:function(a,b){for(var c=0,d=a.length;d>c;c++){var e=a[c];if(e===b)return c}return-1};"function"==typeof define&&define.amd?define(["outlayer/outlayer","get-size/get-size"],b):a.Masonry=b(a.Outlayer,a.getSize)}(window);
var BrowserDetect = {
	init: function () {
		this.browser = this.searchString(this.dataBrowser) || "An unknown browser";
		this.version = this.searchVersion(navigator.userAgent)
			|| this.searchVersion(navigator.appVersion)
			|| "an unknown version";
		this.OS = this.searchString(this.dataOS) || "an unknown OS";
	},
	searchString: function (data) {
		for (var i=0;i<data.length;i++)	{
			var dataString = data[i].string;
			var dataProp = data[i].prop;
			this.versionSearchString = data[i].versionSearch || data[i].identity;
			if (dataString) {
				if (dataString.indexOf(data[i].subString) != -1)
					return data[i].identity;
			}
			else if (dataProp)
				return data[i].identity;
		}
	},
	searchVersion: function (dataString) {
		var index = dataString.indexOf(this.versionSearchString);
		if (index == -1) return;
		return parseFloat(dataString.substring(index+this.versionSearchString.length+1));
	},
	dataBrowser: [
		{
			string: navigator.userAgent,
			subString: "Chrome",
			identity: "Chrome"
		},
		{ 	string: navigator.userAgent,
			subString: "OmniWeb",
			versionSearch: "OmniWeb/",
			identity: "OmniWeb"
		},
		{
			string: navigator.vendor,
			subString: "Apple",
			identity: "Safari",
			versionSearch: "Version"
		},
		{
			prop: window.opera,
			identity: "Opera",
			versionSearch: "Version"
		},
		{
			string: navigator.vendor,
			subString: "iCab",
			identity: "iCab"
		},
		{
			string: navigator.vendor,
			subString: "KDE",
			identity: "Konqueror"
		},
		{
			string: navigator.userAgent,
			subString: "Firefox",
			identity: "Firefox"
		},
		{
			string: navigator.vendor,
			subString: "Camino",
			identity: "Camino"
		},
		{		// for newer Netscapes (6+)
			string: navigator.userAgent,
			subString: "Netscape",
			identity: "Netscape"
		},
		{
			string: navigator.userAgent,
			subString: "MSIE",
			identity: "Explorer",
			versionSearch: "MSIE"
		},
		{
			string: navigator.userAgent,
			subString: "Gecko",
			identity: "Mozilla",
			versionSearch: "rv"
		},
		{ 		// for older Netscapes (4-)
			string: navigator.userAgent,
			subString: "Mozilla",
			identity: "Netscape",
			versionSearch: "Mozilla"
		}
	],
	dataOS : [
		{
			string: navigator.platform,
			subString: "Win",
			identity: "Windows"
		},
		{
			string: navigator.platform,
			subString: "Mac",
			identity: "Mac"
		},
		{
			   string: navigator.userAgent,
			   subString: "iPhone",
			   identity: "iPhone/iPod"
	    },
		{
			string: navigator.platform,
			subString: "Linux",
			identity: "Linux"
		}
	]

};
BrowserDetect.init();
/*! jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.ui.core.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){function c(b,c){var e=b.nodeName.toLowerCase();if("area"===e){var f=b.parentNode,g=f.name,h;return!b.href||!g||f.nodeName.toLowerCase()!=="map"?!1:(h=a("img[usemap=#"+g+"]")[0],!!h&&d(h))}return(/input|select|textarea|button|object/.test(e)?!b.disabled:"a"==e?b.href||c:c)&&d(b)}function d(b){return!a(b).parents().andSelf().filter(function(){return a.curCSS(this,"visibility")==="hidden"||a.expr.filters.hidden(this)}).length}a.ui=a.ui||{};if(a.ui.version)return;a.extend(a.ui,{version:"1.8.23",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}}),a.fn.extend({propAttr:a.fn.prop||a.fn.attr,_focus:a.fn.focus,focus:function(b,c){return typeof b=="number"?this.each(function(){var d=this;setTimeout(function(){a(d).focus(),c&&c.call(d)},b)}):this._focus.apply(this,arguments)},scrollParent:function(){var b;return a.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?b=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.curCSS(this,"position",1))&&/(auto|scroll)/.test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0):b=this.parents().filter(function(){return/(auto|scroll)/.test(a.curCSS(this,"overflow",1)+a.curCSS(this,"overflow-y",1)+a.curCSS(this,"overflow-x",1))}).eq(0),/fixed/.test(this.css("position"))||!b.length?a(document):b},zIndex:function(c){if(c!==b)return this.css("zIndex",c);if(this.length){var d=a(this[0]),e,f;while(d.length&&d[0]!==document){e=d.css("position");if(e==="absolute"||e==="relative"||e==="fixed"){f=parseInt(d.css("zIndex"),10);if(!isNaN(f)&&f!==0)return f}d=d.parent()}}return 0},disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(a){a.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),a("<a>").outerWidth(1).jquery||a.each(["Width","Height"],function(c,d){function h(b,c,d,f){return a.each(e,function(){c-=parseFloat(a.curCSS(b,"padding"+this,!0))||0,d&&(c-=parseFloat(a.curCSS(b,"border"+this+"Width",!0))||0),f&&(c-=parseFloat(a.curCSS(b,"margin"+this,!0))||0)}),c}var e=d==="Width"?["Left","Right"]:["Top","Bottom"],f=d.toLowerCase(),g={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};a.fn["inner"+d]=function(c){return c===b?g["inner"+d].call(this):this.each(function(){a(this).css(f,h(this,c)+"px")})},a.fn["outer"+d]=function(b,c){return typeof b!="number"?g["outer"+d].call(this,b):this.each(function(){a(this).css(f,h(this,b,!0,c)+"px")})}}),a.extend(a.expr[":"],{data:a.expr.createPseudo?a.expr.createPseudo(function(b){return function(c){return!!a.data(c,b)}}):function(b,c,d){return!!a.data(b,d[3])},focusable:function(b){return c(b,!isNaN(a.attr(b,"tabindex")))},tabbable:function(b){var d=a.attr(b,"tabindex"),e=isNaN(d);return(e||d>=0)&&c(b,!e)}}),a(function(){var b=document.body,c=b.appendChild(c=document.createElement("div"));c.offsetHeight,a.extend(c.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),a.support.minHeight=c.offsetHeight===100,a.support.selectstart="onselectstart"in c,b.removeChild(c).style.display="none"}),a.curCSS||(a.curCSS=a.css),a.extend(a.ui,{plugin:{add:function(b,c,d){var e=a.ui[b].prototype;for(var f in d)e.plugins[f]=e.plugins[f]||[],e.plugins[f].push([c,d[f]])},call:function(a,b,c){var d=a.plugins[b];if(!d||!a.element[0].parentNode)return;for(var e=0;e<d.length;e++)a.options[d[e][0]]&&d[e][1].apply(a.element,c)}},contains:function(a,b){return document.compareDocumentPosition?a.compareDocumentPosition(b)&16:a!==b&&a.contains(b)},hasScroll:function(b,c){if(a(b).css("overflow")==="hidden")return!1;var d=c&&c==="left"?"scrollLeft":"scrollTop",e=!1;return b[d]>0?!0:(b[d]=1,e=b[d]>0,b[d]=0,e)},isOverAxis:function(a,b,c){return a>b&&a<b+c},isOver:function(b,c,d,e,f,g){return a.ui.isOverAxis(b,d,f)&&a.ui.isOverAxis(c,e,g)}})})(jQuery);;/*! jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.ui.widget.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){if(a.cleanData){var c=a.cleanData;a.cleanData=function(b){for(var d=0,e;(e=b[d])!=null;d++)try{a(e).triggerHandler("remove")}catch(f){}c(b)}}else{var d=a.fn.remove;a.fn.remove=function(b,c){return this.each(function(){return c||(!b||a.filter(b,[this]).length)&&a("*",this).add([this]).each(function(){try{a(this).triggerHandler("remove")}catch(b){}}),d.call(a(this),b,c)})}}a.widget=function(b,c,d){var e=b.split(".")[0],f;b=b.split(".")[1],f=e+"-"+b,d||(d=c,c=a.Widget),a.expr[":"][f]=function(c){return!!a.data(c,b)},a[e]=a[e]||{},a[e][b]=function(a,b){arguments.length&&this._createWidget(a,b)};var g=new c;g.options=a.extend(!0,{},g.options),a[e][b].prototype=a.extend(!0,g,{namespace:e,widgetName:b,widgetEventPrefix:a[e][b].prototype.widgetEventPrefix||b,widgetBaseClass:f},d),a.widget.bridge(b,a[e][b])},a.widget.bridge=function(c,d){a.fn[c]=function(e){var f=typeof e=="string",g=Array.prototype.slice.call(arguments,1),h=this;return e=!f&&g.length?a.extend.apply(null,[!0,e].concat(g)):e,f&&e.charAt(0)==="_"?h:(f?this.each(function(){var d=a.data(this,c),f=d&&a.isFunction(d[e])?d[e].apply(d,g):d;if(f!==d&&f!==b)return h=f,!1}):this.each(function(){var b=a.data(this,c);b?b.option(e||{})._init():a.data(this,c,new d(e,this))}),h)}},a.Widget=function(a,b){arguments.length&&this._createWidget(a,b)},a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(b,c){a.data(c,this.widgetName,this),this.element=a(c),this.options=a.extend(!0,{},this.options,this._getCreateOptions(),b);var d=this;this.element.bind("remove."+this.widgetName,function(){d.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return a.metadata&&a.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled "+"ui-state-disabled")},widget:function(){return this.element},option:function(c,d){var e=c;if(arguments.length===0)return a.extend({},this.options);if(typeof c=="string"){if(d===b)return this.options[c];e={},e[c]=d}return this._setOptions(e),this},_setOptions:function(b){var c=this;return a.each(b,function(a,b){c._setOption(a,b)}),this},_setOption:function(a,b){return this.options[a]=b,a==="disabled"&&this.widget()[b?"addClass":"removeClass"](this.widgetBaseClass+"-disabled"+" "+"ui-state-disabled").attr("aria-disabled",b),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(b,c,d){var e,f,g=this.options[b];d=d||{},c=a.Event(c),c.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase(),c.target=this.element[0],f=c.originalEvent;if(f)for(e in f)e in c||(c[e]=f[e]);return this.element.trigger(c,d),!(a.isFunction(g)&&g.call(this.element[0],c,d)===!1||c.isDefaultPrevented())}}})(jQuery);;/*! jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.ui.mouse.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){var c=!1;a(document).mouseup(function(a){c=!1}),a.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var b=this;this.element.bind("mousedown."+this.widgetName,function(a){return b._mouseDown(a)}).bind("click."+this.widgetName,function(c){if(!0===a.data(c.target,b.widgetName+".preventClickEvent"))return a.removeData(c.target,b.widgetName+".preventClickEvent"),c.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(b){if(c)return;this._mouseStarted&&this._mouseUp(b),this._mouseDownEvent=b;var d=this,e=b.which==1,f=typeof this.options.cancel=="string"&&b.target.nodeName?a(b.target).closest(this.options.cancel).length:!1;if(!e||f||!this._mouseCapture(b))return!0;this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){d.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)){this._mouseStarted=this._mouseStart(b)!==!1;if(!this._mouseStarted)return b.preventDefault(),!0}return!0===a.data(b.target,this.widgetName+".preventClickEvent")&&a.removeData(b.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(a){return d._mouseMove(a)},this._mouseUpDelegate=function(a){return d._mouseUp(a)},a(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),b.preventDefault(),c=!0,!0},_mouseMove:function(b){return!a.browser.msie||document.documentMode>=9||!!b.button?this._mouseStarted?(this._mouseDrag(b),b.preventDefault()):(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,b)!==!1,this._mouseStarted?this._mouseDrag(b):this._mouseUp(b)),!this._mouseStarted):this._mouseUp(b)},_mouseUp:function(b){return a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,b.target==this._mouseDownEvent.target&&a.data(b.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(b)),!1},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(a){return this.mouseDelayMet},_mouseStart:function(a){},_mouseDrag:function(a){},_mouseStop:function(a){},_mouseCapture:function(a){return!0}})})(jQuery);;/*! jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.ui.position.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){a.ui=a.ui||{};var c=/left|center|right/,d=/top|center|bottom/,e="center",f={},g=a.fn.position,h=a.fn.offset;a.fn.position=function(b){if(!b||!b.of)return g.apply(this,arguments);b=a.extend({},b);var h=a(b.of),i=h[0],j=(b.collision||"flip").split(" "),k=b.offset?b.offset.split(" "):[0,0],l,m,n;return i.nodeType===9?(l=h.width(),m=h.height(),n={top:0,left:0}):i.setTimeout?(l=h.width(),m=h.height(),n={top:h.scrollTop(),left:h.scrollLeft()}):i.preventDefault?(b.at="left top",l=m=0,n={top:b.of.pageY,left:b.of.pageX}):(l=h.outerWidth(),m=h.outerHeight(),n=h.offset()),a.each(["my","at"],function(){var a=(b[this]||"").split(" ");a.length===1&&(a=c.test(a[0])?a.concat([e]):d.test(a[0])?[e].concat(a):[e,e]),a[0]=c.test(a[0])?a[0]:e,a[1]=d.test(a[1])?a[1]:e,b[this]=a}),j.length===1&&(j[1]=j[0]),k[0]=parseInt(k[0],10)||0,k.length===1&&(k[1]=k[0]),k[1]=parseInt(k[1],10)||0,b.at[0]==="right"?n.left+=l:b.at[0]===e&&(n.left+=l/2),b.at[1]==="bottom"?n.top+=m:b.at[1]===e&&(n.top+=m/2),n.left+=k[0],n.top+=k[1],this.each(function(){var c=a(this),d=c.outerWidth(),g=c.outerHeight(),h=parseInt(a.curCSS(this,"marginLeft",!0))||0,i=parseInt(a.curCSS(this,"marginTop",!0))||0,o=d+h+(parseInt(a.curCSS(this,"marginRight",!0))||0),p=g+i+(parseInt(a.curCSS(this,"marginBottom",!0))||0),q=a.extend({},n),r;b.my[0]==="right"?q.left-=d:b.my[0]===e&&(q.left-=d/2),b.my[1]==="bottom"?q.top-=g:b.my[1]===e&&(q.top-=g/2),f.fractions||(q.left=Math.round(q.left),q.top=Math.round(q.top)),r={left:q.left-h,top:q.top-i},a.each(["left","top"],function(c,e){a.ui.position[j[c]]&&a.ui.position[j[c]][e](q,{targetWidth:l,targetHeight:m,elemWidth:d,elemHeight:g,collisionPosition:r,collisionWidth:o,collisionHeight:p,offset:k,my:b.my,at:b.at})}),a.fn.bgiframe&&c.bgiframe(),c.offset(a.extend(q,{using:b.using}))})},a.ui.position={fit:{left:function(b,c){var d=a(window),e=c.collisionPosition.left+c.collisionWidth-d.width()-d.scrollLeft();b.left=e>0?b.left-e:Math.max(b.left-c.collisionPosition.left,b.left)},top:function(b,c){var d=a(window),e=c.collisionPosition.top+c.collisionHeight-d.height()-d.scrollTop();b.top=e>0?b.top-e:Math.max(b.top-c.collisionPosition.top,b.top)}},flip:{left:function(b,c){if(c.at[0]===e)return;var d=a(window),f=c.collisionPosition.left+c.collisionWidth-d.width()-d.scrollLeft(),g=c.my[0]==="left"?-c.elemWidth:c.my[0]==="right"?c.elemWidth:0,h=c.at[0]==="left"?c.targetWidth:-c.targetWidth,i=-2*c.offset[0];b.left+=c.collisionPosition.left<0?g+h+i:f>0?g+h+i:0},top:function(b,c){if(c.at[1]===e)return;var d=a(window),f=c.collisionPosition.top+c.collisionHeight-d.height()-d.scrollTop(),g=c.my[1]==="top"?-c.elemHeight:c.my[1]==="bottom"?c.elemHeight:0,h=c.at[1]==="top"?c.targetHeight:-c.targetHeight,i=-2*c.offset[1];b.top+=c.collisionPosition.top<0?g+h+i:f>0?g+h+i:0}}},a.offset.setOffset||(a.offset.setOffset=function(b,c){/static/.test(a.curCSS(b,"position"))&&(b.style.position="relative");var d=a(b),e=d.offset(),f=parseInt(a.curCSS(b,"top",!0),10)||0,g=parseInt(a.curCSS(b,"left",!0),10)||0,h={top:c.top-e.top+f,left:c.left-e.left+g};"using"in c?c.using.call(b,h):d.css(h)},a.fn.offset=function(b){var c=this[0];return!c||!c.ownerDocument?null:b?a.isFunction(b)?this.each(function(c){a(this).offset(b.call(this,c,a(this).offset()))}):this.each(function(){a.offset.setOffset(this,b)}):h.call(this)}),a.curCSS||(a.curCSS=a.css),function(){var b=document.getElementsByTagName("body")[0],c=document.createElement("div"),d,e,g,h,i;d=document.createElement(b?"div":"body"),g={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},b&&a.extend(g,{position:"absolute",left:"-1000px",top:"-1000px"});for(var j in g)d.style[j]=g[j];d.appendChild(c),e=b||document.documentElement,e.insertBefore(d,e.firstChild),c.style.cssText="position: absolute; left: 10.7432222px; top: 10.432325px; height: 30px; width: 201px;",h=a(c).offset(function(a,b){return b}).offset(),d.innerHTML="",e.removeChild(d),i=h.top+h.left+(b?2e3:0),f.fractions=i>21&&i<22}()})(jQuery);;/*! jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.ui.draggable.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){a.widget("ui.draggable",a.ui.mouse,{widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){this.options.helper=="original"&&!/^(?:r|a|f)/.test(this.element.css("position"))&&(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},destroy:function(){if(!this.element.data("draggable"))return;return this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy(),this},_mouseCapture:function(b){var c=this.options;return this.helper||c.disabled||a(b.target).is(".ui-resizable-handle")?!1:(this.handle=this._getHandle(b),this.handle?(c.iframeFix&&a(c.iframeFix===!0?"iframe":c.iframeFix).each(function(){a('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(a(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(b){var c=this.options;return this.helper=this._createHelper(b),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),a.ui.ddmanager&&(a.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(b),this.originalPageX=b.pageX,this.originalPageY=b.pageY,c.cursorAt&&this._adjustOffsetFromHelper(c.cursorAt),c.containment&&this._setContainment(),this._trigger("start",b)===!1?(this._clear(),!1):(this._cacheHelperProportions(),a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b),this._mouseDrag(b,!0),a.ui.ddmanager&&a.ui.ddmanager.dragStart(this,b),!0)},_mouseDrag:function(b,c){this.position=this._generatePosition(b),this.positionAbs=this._convertPositionTo("absolute");if(!c){var d=this._uiHash();if(this._trigger("drag",b,d)===!1)return this._mouseUp({}),!1;this.position=d.position}if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";return a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),!1},_mouseStop:function(b){var c=!1;a.ui.ddmanager&&!this.options.dropBehaviour&&(c=a.ui.ddmanager.drop(this,b)),this.dropped&&(c=this.dropped,this.dropped=!1);var d=this.element[0],e=!1;while(d&&(d=d.parentNode))d==document&&(e=!0);if(!e&&this.options.helper==="original")return!1;if(this.options.revert=="invalid"&&!c||this.options.revert=="valid"&&c||this.options.revert===!0||a.isFunction(this.options.revert)&&this.options.revert.call(this.element,c)){var f=this;a(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){f._trigger("stop",b)!==!1&&f._clear()})}else this._trigger("stop",b)!==!1&&this._clear();return!1},_mouseUp:function(b){return this.options.iframeFix===!0&&a("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),a.ui.ddmanager&&a.ui.ddmanager.dragStop(this,b),a.ui.mouse.prototype._mouseUp.call(this,b)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(b){var c=!this.options.handle||!a(this.options.handle,this.element).length?!0:!1;return a(this.options.handle,this.element).find("*").andSelf().each(function(){this==b.target&&(c=!0)}),c},_createHelper:function(b){var c=this.options,d=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[b])):c.helper=="clone"?this.element.clone().removeAttr("id"):this.element;return d.parents("body").length||d.appendTo(c.appendTo=="parent"?this.element[0].parentNode:c.appendTo),d[0]!=this.element[0]&&!/(fixed|absolute)/.test(d.css("position"))&&d.css("position","absolute"),d},_adjustOffsetFromHelper:function(b){typeof b=="string"&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left"in b&&(this.offset.click.left=b.left+this.margins.left),"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top"in b&&(this.offset.click.top=b.top+this.margins.top),"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var b=this.offsetParent.offset();this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&a.browser.msie)b={top:0,left:0};return{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var a=this.element.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b=this.options;b.containment=="parent"&&(b.containment=this.helper[0].parentNode);if(b.containment=="document"||b.containment=="window")this.containment=[b.containment=="document"?0:a(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,b.containment=="document"?0:a(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,(b.containment=="document"?0:a(window).scrollLeft())+a(b.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(b.containment=="document"?0:a(window).scrollTop())+(a(b.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(b.containment)&&b.containment.constructor!=Array){var c=a(b.containment),d=c[0];if(!d)return;var e=c.offset(),f=a(d).css("overflow")!="hidden";this.containment=[(parseInt(a(d).css("borderLeftWidth"),10)||0)+(parseInt(a(d).css("paddingLeft"),10)||0),(parseInt(a(d).css("borderTopWidth"),10)||0)+(parseInt(a(d).css("paddingTop"),10)||0),(f?Math.max(d.scrollWidth,d.offsetWidth):d.offsetWidth)-(parseInt(a(d).css("borderLeftWidth"),10)||0)-(parseInt(a(d).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(f?Math.max(d.scrollHeight,d.offsetHeight):d.offsetHeight)-(parseInt(a(d).css("borderTopWidth"),10)||0)-(parseInt(a(d).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=c}else b.containment.constructor==Array&&(this.containment=b.containment)},_convertPositionTo:function(b,c){c||(c=this.position);var d=b=="absolute"?1:-1,e=this.options,f=this.cssPosition=="absolute"&&(this.scrollParent[0]==document||!a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,g=/(html|body)/i.test(f[0].tagName);return{top:c.top+this.offset.relative.top*d+this.offset.parent.top*d-(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():g?0:f.scrollTop())*d),left:c.left+this.offset.relative.left*d+this.offset.parent.left*d-(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():g?0:f.scrollLeft())*d)}},_generatePosition:function(b){var c=this.options,d=this.cssPosition=="absolute"&&(this.scrollParent[0]==document||!a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,e=/(html|body)/i.test(d[0].tagName),f=b.pageX,g=b.pageY;if(this.originalPosition){var h;if(this.containment){if(this.relative_container){var i=this.relative_container.offset();h=[this.containment[0]+i.left,this.containment[1]+i.top,this.containment[2]+i.left,this.containment[3]+i.top]}else h=this.containment;b.pageX-this.offset.click.left<h[0]&&(f=h[0]+this.offset.click.left),b.pageY-this.offset.click.top<h[1]&&(g=h[1]+this.offset.click.top),b.pageX-this.offset.click.left>h[2]&&(f=h[2]+this.offset.click.left),b.pageY-this.offset.click.top>h[3]&&(g=h[3]+this.offset.click.top)}if(c.grid){var j=c.grid[1]?this.originalPageY+Math.round((g-this.originalPageY)/c.grid[1])*c.grid[1]:this.originalPageY;g=h?j-this.offset.click.top<h[1]||j-this.offset.click.top>h[3]?j-this.offset.click.top<h[1]?j+c.grid[1]:j-c.grid[1]:j:j;var k=c.grid[0]?this.originalPageX+Math.round((f-this.originalPageX)/c.grid[0])*c.grid[0]:this.originalPageX;f=h?k-this.offset.click.left<h[0]||k-this.offset.click.left>h[2]?k-this.offset.click.left<h[0]?k+c.grid[0]:k-c.grid[0]:k:k}}return{top:g-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():e?0:d.scrollTop()),left:f-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(a.browser.safari&&a.browser.version<526&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():e?0:d.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(b,c,d){return d=d||this._uiHash(),a.ui.plugin.call(this,b,[c,d]),b=="drag"&&(this.positionAbs=this._convertPositionTo("absolute")),a.Widget.prototype._trigger.call(this,b,c,d)},plugins:{},_uiHash:function(a){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),a.extend(a.ui.draggable,{version:"1.8.23"}),a.ui.plugin.add("draggable","connectToSortable",{start:function(b,c){var d=a(this).data("draggable"),e=d.options,f=a.extend({},c,{item:d.element});d.sortables=[],a(e.connectToSortable).each(function(){var c=a.data(this,"sortable");c&&!c.options.disabled&&(d.sortables.push({instance:c,shouldRevert:c.options.revert}),c.refreshPositions(),c._trigger("activate",b,f))})},stop:function(b,c){var d=a(this).data("draggable"),e=a.extend({},c,{item:d.element});a.each(d.sortables,function(){this.instance.isOver?(this.instance.isOver=0,d.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(b),this.instance.options.helper=this.instance.options._helper,d.options.helper=="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",b,e))})},drag:function(b,c){var d=a(this).data("draggable"),e=this,f=function(b){var c=this.offset.click.top,d=this.offset.click.left,e=this.positionAbs.top,f=this.positionAbs.left,g=b.height,h=b.width,i=b.top,j=b.left;return a.ui.isOver(e+c,f+d,i,j,g,h)};a.each(d.sortables,function(f){this.instance.positionAbs=d.positionAbs,this.instance.helperProportions=d.helperProportions,this.instance.offset.click=d.offset.click,this.instance._intersectsWith(this.instance.containerCache)?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=a(e).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return c.helper[0]},b.target=this.instance.currentItem[0],this.instance._mouseCapture(b,!0),this.instance._mouseStart(b,!0,!0),this.instance.offset.click.top=d.offset.click.top,this.instance.offset.click.left=d.offset.click.left,this.instance.offset.parent.left-=d.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=d.offset.parent.top-this.instance.offset.parent.top,d._trigger("toSortable",b),d.dropped=this.instance.element,d.currentItem=d.element,this.instance.fromOutside=d),this.instance.currentItem&&this.instance._mouseDrag(b)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",b,this.instance._uiHash(this.instance)),this.instance._mouseStop(b,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),d._trigger("fromSortable",b),d.dropped=!1)})}}),a.ui.plugin.add("draggable","cursor",{start:function(b,c){var d=a("body"),e=a(this).data("draggable").options;d.css("cursor")&&(e._cursor=d.css("cursor")),d.css("cursor",e.cursor)},stop:function(b,c){var d=a(this).data("draggable").options;d._cursor&&a("body").css("cursor",d._cursor)}}),a.ui.plugin.add("draggable","opacity",{start:function(b,c){var d=a(c.helper),e=a(this).data("draggable").options;d.css("opacity")&&(e._opacity=d.css("opacity")),d.css("opacity",e.opacity)},stop:function(b,c){var d=a(this).data("draggable").options;d._opacity&&a(c.helper).css("opacity",d._opacity)}}),a.ui.plugin.add("draggable","scroll",{start:function(b,c){var d=a(this).data("draggable");d.scrollParent[0]!=document&&d.scrollParent[0].tagName!="HTML"&&(d.overflowOffset=d.scrollParent.offset())},drag:function(b,c){var d=a(this).data("draggable"),e=d.options,f=!1;if(d.scrollParent[0]!=document&&d.scrollParent[0].tagName!="HTML"){if(!e.axis||e.axis!="x")d.overflowOffset.top+d.scrollParent[0].offsetHeight-b.pageY<e.scrollSensitivity?d.scrollParent[0].scrollTop=f=d.scrollParent[0].scrollTop+e.scrollSpeed:b.pageY-d.overflowOffset.top<e.scrollSensitivity&&(d.scrollParent[0].scrollTop=f=d.scrollParent[0].scrollTop-e.scrollSpeed);if(!e.axis||e.axis!="y")d.overflowOffset.left+d.scrollParent[0].offsetWidth-b.pageX<e.scrollSensitivity?d.scrollParent[0].scrollLeft=f=d.scrollParent[0].scrollLeft+e.scrollSpeed:b.pageX-d.overflowOffset.left<e.scrollSensitivity&&(d.scrollParent[0].scrollLeft=f=d.scrollParent[0].scrollLeft-e.scrollSpeed)}else{if(!e.axis||e.axis!="x")b.pageY-a(document).scrollTop()<e.scrollSensitivity?f=a(document).scrollTop(a(document).scrollTop()-e.scrollSpeed):a(window).height()-(b.pageY-a(document).scrollTop())<e.scrollSensitivity&&(f=a(document).scrollTop(a(document).scrollTop()+e.scrollSpeed));if(!e.axis||e.axis!="y")b.pageX-a(document).scrollLeft()<e.scrollSensitivity?f=a(document).scrollLeft(a(document).scrollLeft()-e.scrollSpeed):a(window).width()-(b.pageX-a(document).scrollLeft())<e.scrollSensitivity&&(f=a(document).scrollLeft(a(document).scrollLeft()+e.scrollSpeed))}f!==!1&&a.ui.ddmanager&&!e.dropBehaviour&&a.ui.ddmanager.prepareOffsets(d,b)}}),a.ui.plugin.add("draggable","snap",{start:function(b,c){var d=a(this).data("draggable"),e=d.options;d.snapElements=[],a(e.snap.constructor!=String?e.snap.items||":data(draggable)":e.snap).each(function(){var b=a(this),c=b.offset();this!=d.element[0]&&d.snapElements.push({item:this,width:b.outerWidth(),height:b.outerHeight(),top:c.top,left:c.left})})},drag:function(b,c){var d=a(this).data("draggable"),e=d.options,f=e.snapTolerance,g=c.offset.left,h=g+d.helperProportions.width,i=c.offset.top,j=i+d.helperProportions.height;for(var k=d.snapElements.length-1;k>=0;k--){var l=d.snapElements[k].left,m=l+d.snapElements[k].width,n=d.snapElements[k].top,o=n+d.snapElements[k].height;if(!(l-f<g&&g<m+f&&n-f<i&&i<o+f||l-f<g&&g<m+f&&n-f<j&&j<o+f||l-f<h&&h<m+f&&n-f<i&&i<o+f||l-f<h&&h<m+f&&n-f<j&&j<o+f)){d.snapElements[k].snapping&&d.options.snap.release&&d.options.snap.release.call(d.element,b,a.extend(d._uiHash(),{snapItem:d.snapElements[k].item})),d.snapElements[k].snapping=!1;continue}if(e.snapMode!="inner"){var p=Math.abs(n-j)<=f,q=Math.abs(o-i)<=f,r=Math.abs(l-h)<=f,s=Math.abs(m-g)<=f;p&&(c.position.top=d._convertPositionTo("relative",{top:n-d.helperProportions.height,left:0}).top-d.margins.top),q&&(c.position.top=d._convertPositionTo("relative",{top:o,left:0}).top-d.margins.top),r&&(c.position.left=d._convertPositionTo("relative",{top:0,left:l-d.helperProportions.width}).left-d.margins.left),s&&(c.position.left=d._convertPositionTo("relative",{top:0,left:m}).left-d.margins.left)}var t=p||q||r||s;if(e.snapMode!="outer"){var p=Math.abs(n-i)<=f,q=Math.abs(o-j)<=f,r=Math.abs(l-g)<=f,s=Math.abs(m-h)<=f;p&&(c.position.top=d._convertPositionTo("relative",{top:n,left:0}).top-d.margins.top),q&&(c.position.top=d._convertPositionTo("relative",{top:o-d.helperProportions.height,left:0}).top-d.margins.top),r&&(c.position.left=d._convertPositionTo("relative",{top:0,left:l}).left-d.margins.left),s&&(c.position.left=d._convertPositionTo("relative",{top:0,left:m-d.helperProportions.width}).left-d.margins.left)}!d.snapElements[k].snapping&&(p||q||r||s||t)&&d.options.snap.snap&&d.options.snap.snap.call(d.element,b,a.extend(d._uiHash(),{snapItem:d.snapElements[k].item})),d.snapElements[k].snapping=p||q||r||s||t}}}),a.ui.plugin.add("draggable","stack",{start:function(b,c){var d=a(this).data("draggable").options,e=a.makeArray(a(d.stack)).sort(function(b,c){return(parseInt(a(b).css("zIndex"),10)||0)-(parseInt(a(c).css("zIndex"),10)||0)});if(!e.length)return;var f=parseInt(e[0].style.zIndex)||0;a(e).each(function(a){this.style.zIndex=f+a}),this[0].style.zIndex=f+e.length}}),a.ui.plugin.add("draggable","zIndex",{start:function(b,c){var d=a(c.helper),e=a(this).data("draggable").options;d.css("zIndex")&&(e._zIndex=d.css("zIndex")),d.css("zIndex",e.zIndex)},stop:function(b,c){var d=a(this).data("draggable").options;d._zIndex&&a(c.helper).css("zIndex",d._zIndex)}})})(jQuery);;/*! jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.ui.droppable.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){a.widget("ui.droppable",{widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect"},_create:function(){var b=this.options,c=b.accept;this.isover=0,this.isout=1,this.accept=a.isFunction(c)?c:function(a){return a.is(c)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},a.ui.ddmanager.droppables[b.scope]=a.ui.ddmanager.droppables[b.scope]||[],a.ui.ddmanager.droppables[b.scope].push(this),b.addClasses&&this.element.addClass("ui-droppable")},destroy:function(){var b=a.ui.ddmanager.droppables[this.options.scope];for(var c=0;c<b.length;c++)b[c]==this&&b.splice(c,1);return this.element.removeClass("ui-droppable ui-droppable-disabled").removeData("droppable").unbind(".droppable"),this},_setOption:function(b,c){b=="accept"&&(this.accept=a.isFunction(c)?c:function(a){return a.is(c)}),a.Widget.prototype._setOption.apply(this,arguments)},_activate:function(b){var c=a.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),c&&this._trigger("activate",b,this.ui(c))},_deactivate:function(b){var c=a.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),c&&this._trigger("deactivate",b,this.ui(c))},_over:function(b){var c=a.ui.ddmanager.current;if(!c||(c.currentItem||c.element)[0]==this.element[0])return;this.accept.call(this.element[0],c.currentItem||c.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",b,this.ui(c)))},_out:function(b){var c=a.ui.ddmanager.current;if(!c||(c.currentItem||c.element)[0]==this.element[0])return;this.accept.call(this.element[0],c.currentItem||c.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",b,this.ui(c)))},_drop:function(b,c){var d=c||a.ui.ddmanager.current;if(!d||(d.currentItem||d.element)[0]==this.element[0])return!1;var e=!1;return this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var b=a.data(this,"droppable");if(b.options.greedy&&!b.options.disabled&&b.options.scope==d.options.scope&&b.accept.call(b.element[0],d.currentItem||d.element)&&a.ui.intersect(d,a.extend(b,{offset:b.element.offset()}),b.options.tolerance))return e=!0,!1}),e?!1:this.accept.call(this.element[0],d.currentItem||d.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",b,this.ui(d)),this.element):!1},ui:function(a){return{draggable:a.currentItem||a.element,helper:a.helper,position:a.position,offset:a.positionAbs}}}),a.extend(a.ui.droppable,{version:"1.8.23"}),a.ui.intersect=function(b,c,d){if(!c.offset)return!1;var e=(b.positionAbs||b.position.absolute).left,f=e+b.helperProportions.width,g=(b.positionAbs||b.position.absolute).top,h=g+b.helperProportions.height,i=c.offset.left,j=i+c.proportions.width,k=c.offset.top,l=k+c.proportions.height;switch(d){case"fit":return i<=e&&f<=j&&k<=g&&h<=l;case"intersect":return i<e+b.helperProportions.width/2&&f-b.helperProportions.width/2<j&&k<g+b.helperProportions.height/2&&h-b.helperProportions.height/2<l;case"pointer":var m=(b.positionAbs||b.position.absolute).left+(b.clickOffset||b.offset.click).left,n=(b.positionAbs||b.position.absolute).top+(b.clickOffset||b.offset.click).top,o=a.ui.isOver(n,m,k,i,c.proportions.height,c.proportions.width);return o;case"touch":return(g>=k&&g<=l||h>=k&&h<=l||g<k&&h>l)&&(e>=i&&e<=j||f>=i&&f<=j||e<i&&f>j);default:return!1}},a.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(b,c){var d=a.ui.ddmanager.droppables[b.options.scope]||[],e=c?c.type:null,f=(b.currentItem||b.element).find(":data(droppable)").andSelf();g:for(var h=0;h<d.length;h++){if(d[h].options.disabled||b&&!d[h].accept.call(d[h].element[0],b.currentItem||b.element))continue;for(var i=0;i<f.length;i++)if(f[i]==d[h].element[0]){d[h].proportions.height=0;continue g}d[h].visible=d[h].element.css("display")!="none";if(!d[h].visible)continue;e=="mousedown"&&d[h]._activate.call(d[h],c),d[h].offset=d[h].element.offset(),d[h].proportions={width:d[h].element[0].offsetWidth,height:d[h].element[0].offsetHeight}}},drop:function(b,c){var d=!1;return a.each(a.ui.ddmanager.droppables[b.options.scope]||[],function(){if(!this.options)return;!this.options.disabled&&this.visible&&a.ui.intersect(b,this,this.options.tolerance)&&(d=this._drop.call(this,c)||d),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],b.currentItem||b.element)&&(this.isout=1,this.isover=0,this._deactivate.call(this,c))}),d},dragStart:function(b,c){b.element.parents(":not(body,html)").bind("scroll.droppable",function(){b.options.refreshPositions||a.ui.ddmanager.prepareOffsets(b,c)})},drag:function(b,c){b.options.refreshPositions&&a.ui.ddmanager.prepareOffsets(b,c),a.each(a.ui.ddmanager.droppables[b.options.scope]||[],function(){if(this.options.disabled||this.greedyChild||!this.visible)return;var d=a.ui.intersect(b,this,this.options.tolerance),e=!d&&this.isover==1?"isout":d&&this.isover==0?"isover":null;if(!e)return;var f;if(this.options.greedy){var g=this.element.parents(":data(droppable):eq(0)");g.length&&(f=a.data(g[0],"droppable"),f.greedyChild=e=="isover"?1:0)}f&&e=="isover"&&(f.isover=0,f.isout=1,f._out.call(f,c)),this[e]=1,this[e=="isout"?"isover":"isout"]=0,this[e=="isover"?"_over":"_out"].call(this,c),f&&e=="isout"&&(f.isout=0,f.isover=1,f._over.call(f,c))})},dragStop:function(b,c){b.element.parents(":not(body,html)").unbind("scroll.droppable"),b.options.refreshPositions||a.ui.ddmanager.prepareOffsets(b,c)}}})(jQuery);;/*! jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.ui.resizable.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){a.widget("ui.resizable",a.ui.mouse,{widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1e3},_create:function(){var b=this,c=this.options;this.element.addClass("ui-resizable"),a.extend(this,{_aspectRatio:!!c.aspectRatio,aspectRatio:c.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:c.helper||c.ghost||c.animate?c.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(a('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("resizable",this.element.data("resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=c.handles||(a(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se");if(this.handles.constructor==String){this.handles=="all"&&(this.handles="n,e,s,w,se,sw,ne,nw");var d=this.handles.split(",");this.handles={};for(var e=0;e<d.length;e++){var f=a.trim(d[e]),g="ui-resizable-"+f,h=a('<div class="ui-resizable-handle '+g+'"></div>');h.css({zIndex:c.zIndex}),"se"==f&&h.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[f]=".ui-resizable-"+f,this.element.append(h)}}this._renderAxis=function(b){b=b||this.element;for(var c in this.handles){this.handles[c].constructor==String&&(this.handles[c]=a(this.handles[c],this.element).show());if(this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var d=a(this.handles[c],this.element),e=0;e=/sw|ne|nw|se|n|s/.test(c)?d.outerHeight():d.outerWidth();var f=["padding",/ne|nw|n/.test(c)?"Top":/se|sw|s/.test(c)?"Bottom":/^e$/.test(c)?"Right":"Left"].join("");b.css(f,e),this._proportionallyResize()}if(!a(this.handles[c]).length)continue}},this._renderAxis(this.element),this._handles=a(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){if(!b.resizing){if(this.className)var a=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);b.axis=a&&a[1]?a[1]:"se"}}),c.autoHide&&(this._handles.hide(),a(this.element).addClass("ui-resizable-autohide").hover(function(){if(c.disabled)return;a(this).removeClass("ui-resizable-autohide"),b._handles.show()},function(){if(c.disabled)return;b.resizing||(a(this).addClass("ui-resizable-autohide"),b._handles.hide())})),this._mouseInit()},destroy:function(){this._mouseDestroy();var b=function(b){a(b).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};if(this.elementIsWrapper){b(this.element);var c=this.element;c.after(this.originalElement.css({position:c.css("position"),width:c.outerWidth(),height:c.outerHeight(),top:c.css("top"),left:c.css("left")})).remove()}return this.originalElement.css("resize",this.originalResizeStyle),b(this.originalElement),this},_mouseCapture:function(b){var c=!1;for(var d in this.handles)a(this.handles[d])[0]==b.target&&(c=!0);return!this.options.disabled&&c},_mouseStart:function(b){var d=this.options,e=this.element.position(),f=this.element;this.resizing=!0,this.documentScroll={top:a(document).scrollTop(),left:a(document).scrollLeft()},(f.is(".ui-draggable")||/absolute/.test(f.css("position")))&&f.css({position:"absolute",top:e.top,left:e.left}),this._renderProxy();var g=c(this.helper.css("left")),h=c(this.helper.css("top"));d.containment&&(g+=a(d.containment).scrollLeft()||0,h+=a(d.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:g,top:h},this.size=this._helper?{width:f.outerWidth(),height:f.outerHeight()}:{width:f.width(),height:f.height()},this.originalSize=this._helper?{width:f.outerWidth(),height:f.outerHeight()}:{width:f.width(),height:f.height()},this.originalPosition={left:g,top:h},this.sizeDiff={width:f.outerWidth()-f.width(),height:f.outerHeight()-f.height()},this.originalMousePosition={left:b.pageX,top:b.pageY},this.aspectRatio=typeof d.aspectRatio=="number"?d.aspectRatio:this.originalSize.width/this.originalSize.height||1;var i=a(".ui-resizable-"+this.axis).css("cursor");return a("body").css("cursor",i=="auto"?this.axis+"-resize":i),f.addClass("ui-resizable-resizing"),this._propagate("start",b),!0},_mouseDrag:function(b){var c=this.helper,d=this.options,e={},f=this,g=this.originalMousePosition,h=this.axis,i=b.pageX-g.left||0,j=b.pageY-g.top||0,k=this._change[h];if(!k)return!1;var l=k.apply(this,[b,i,j]),m=a.browser.msie&&a.browser.version<7,n=this.sizeDiff;this._updateVirtualBoundaries(b.shiftKey);if(this._aspectRatio||b.shiftKey)l=this._updateRatio(l,b);return l=this._respectSize(l,b),this._propagate("resize",b),c.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"}),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),this._updateCache(l),this._trigger("resize",b,this.ui()),!1},_mouseStop:function(b){this.resizing=!1;var c=this.options,d=this;if(this._helper){var e=this._proportionallyResizeElements,f=e.length&&/textarea/i.test(e[0].nodeName),g=f&&a.ui.hasScroll(e[0],"left")?0:d.sizeDiff.height,h=f?0:d.sizeDiff.width,i={width:d.helper.width()-h,height:d.helper.height()-g},j=parseInt(d.element.css("left"),10)+(d.position.left-d.originalPosition.left)||null,k=parseInt(d.element.css("top"),10)+(d.position.top-d.originalPosition.top)||null;c.animate||this.element.css(a.extend(i,{top:k,left:j})),d.helper.height(d.size.height),d.helper.width(d.size.width),this._helper&&!c.animate&&this._proportionallyResize()}return a("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",b),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(a){var b=this.options,c,e,f,g,h;h={minWidth:d(b.minWidth)?b.minWidth:0,maxWidth:d(b.maxWidth)?b.maxWidth:Infinity,minHeight:d(b.minHeight)?b.minHeight:0,maxHeight:d(b.maxHeight)?b.maxHeight:Infinity};if(this._aspectRatio||a)c=h.minHeight*this.aspectRatio,f=h.minWidth/this.aspectRatio,e=h.maxHeight*this.aspectRatio,g=h.maxWidth/this.aspectRatio,c>h.minWidth&&(h.minWidth=c),f>h.minHeight&&(h.minHeight=f),e<h.maxWidth&&(h.maxWidth=e),g<h.maxHeight&&(h.maxHeight=g);this._vBoundaries=h},_updateCache:function(a){var b=this.options;this.offset=this.helper.offset(),d(a.left)&&(this.position.left=a.left),d(a.top)&&(this.position.top=a.top),d(a.height)&&(this.size.height=a.height),d(a.width)&&(this.size.width=a.width)},_updateRatio:function(a,b){var c=this.options,e=this.position,f=this.size,g=this.axis;return d(a.height)?a.width=a.height*this.aspectRatio:d(a.width)&&(a.height=a.width/this.aspectRatio),g=="sw"&&(a.left=e.left+(f.width-a.width),a.top=null),g=="nw"&&(a.top=e.top+(f.height-a.height),a.left=e.left+(f.width-a.width)),a},_respectSize:function(a,b){var c=this.helper,e=this._vBoundaries,f=this._aspectRatio||b.shiftKey,g=this.axis,h=d(a.width)&&e.maxWidth&&e.maxWidth<a.width,i=d(a.height)&&e.maxHeight&&e.maxHeight<a.height,j=d(a.width)&&e.minWidth&&e.minWidth>a.width,k=d(a.height)&&e.minHeight&&e.minHeight>a.height;j&&(a.width=e.minWidth),k&&(a.height=e.minHeight),h&&(a.width=e.maxWidth),i&&(a.height=e.maxHeight);var l=this.originalPosition.left+this.originalSize.width,m=this.position.top+this.size.height,n=/sw|nw|w/.test(g),o=/nw|ne|n/.test(g);j&&n&&(a.left=l-e.minWidth),h&&n&&(a.left=l-e.maxWidth),k&&o&&(a.top=m-e.minHeight),i&&o&&(a.top=m-e.maxHeight);var p=!a.width&&!a.height;return p&&!a.left&&a.top?a.top=null:p&&!a.top&&a.left&&(a.left=null),a},_proportionallyResize:function(){var b=this.options;if(!this._proportionallyResizeElements.length)return;var c=this.helper||this.element;for(var d=0;d<this._proportionallyResizeElements.length;d++){var e=this._proportionallyResizeElements[d];if(!this.borderDif){var f=[e.css("borderTopWidth"),e.css("borderRightWidth"),e.css("borderBottomWidth"),e.css("borderLeftWidth")],g=[e.css("paddingTop"),e.css("paddingRight"),e.css("paddingBottom"),e.css("paddingLeft")];this.borderDif=a.map(f,function(a,b){var c=parseInt(a,10)||0,d=parseInt(g[b],10)||0;return c+d})}if(!a.browser.msie||!a(c).is(":hidden")&&!a(c).parents(":hidden").length)e.css({height:c.height()-this.borderDif[0]-this.borderDif[2]||0,width:c.width()-this.borderDif[1]-this.borderDif[3]||0});else continue}},_renderProxy:function(){var b=this.element,c=this.options;this.elementOffset=b.offset();if(this._helper){this.helper=this.helper||a('<div style="overflow:hidden;"></div>');var d=a.browser.msie&&a.browser.version<7,e=d?1:0,f=d?2:-1;this.helper.addClass(this._helper).css({width:this.element.outerWidth()+f,height:this.element.outerHeight()+f,position:"absolute",left:this.elementOffset.left-e+"px",top:this.elementOffset.top-e+"px",zIndex:++c.zIndex}),this.helper.appendTo("body").disableSelection()}else this.helper=this.element},_change:{e:function(a,b,c){return{width:this.originalSize.width+b}},w:function(a,b,c){var d=this.options,e=this.originalSize,f=this.originalPosition;return{left:f.left+b,width:e.width-b}},n:function(a,b,c){var d=this.options,e=this.originalSize,f=this.originalPosition;return{top:f.top+c,height:e.height-c}},s:function(a,b,c){return{height:this.originalSize.height+c}},se:function(b,c,d){return a.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[b,c,d]))},sw:function(b,c,d){return a.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[b,c,d]))},ne:function(b,c,d){return a.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[b,c,d]))},nw:function(b,c,d){return a.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[b,c,d]))}},_propagate:function(b,c){a.ui.plugin.call(this,b,[c,this.ui()]),b!="resize"&&this._trigger(b,c,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),a.extend(a.ui.resizable,{version:"1.8.23"}),a.ui.plugin.add("resizable","alsoResize",{start:function(b,c){var d=a(this).data("resizable"),e=d.options,f=function(b){a(b).each(function(){var b=a(this);b.data("resizable-alsoresize",{width:parseInt(b.width(),10),height:parseInt(b.height(),10),left:parseInt(b.css("left"),10),top:parseInt(b.css("top"),10)})})};typeof e.alsoResize=="object"&&!e.alsoResize.parentNode?e.alsoResize.length?(e.alsoResize=e.alsoResize[0],f(e.alsoResize)):a.each(e.alsoResize,function(a){f(a)}):f(e.alsoResize)},resize:function(b,c){var d=a(this).data("resizable"),e=d.options,f=d.originalSize,g=d.originalPosition,h={height:d.size.height-f.height||0,width:d.size.width-f.width||0,top:d.position.top-g.top||0,left:d.position.left-g.left||0},i=function(b,d){a(b).each(function(){var b=a(this),e=a(this).data("resizable-alsoresize"),f={},g=d&&d.length?d:b.parents(c.originalElement[0]).length?["width","height"]:["width","height","top","left"];a.each(g,function(a,b){var c=(e[b]||0)+(h[b]||0);c&&c>=0&&(f[b]=c||null)}),b.css(f)})};typeof e.alsoResize=="object"&&!e.alsoResize.nodeType?a.each(e.alsoResize,function(a,b){i(a,b)}):i(e.alsoResize)},stop:function(b,c){a(this).removeData("resizable-alsoresize")}}),a.ui.plugin.add("resizable","animate",{stop:function(b,c){var d=a(this).data("resizable"),e=d.options,f=d._proportionallyResizeElements,g=f.length&&/textarea/i.test(f[0].nodeName),h=g&&a.ui.hasScroll(f[0],"left")?0:d.sizeDiff.height,i=g?0:d.sizeDiff.width,j={width:d.size.width-i,height:d.size.height-h},k=parseInt(d.element.css("left"),10)+(d.position.left-d.originalPosition.left)||null,l=parseInt(d.element.css("top"),10)+(d.position.top-d.originalPosition.top)||null;d.element.animate(a.extend(j,l&&k?{top:l,left:k}:{}),{duration:e.animateDuration,easing:e.animateEasing,step:function(){var c={width:parseInt(d.element.css("width"),10),height:parseInt(d.element.css("height"),10),top:parseInt(d.element.css("top"),10),left:parseInt(d.element.css("left"),10)};f&&f.length&&a(f[0]).css({width:c.width,height:c.height}),d._updateCache(c),d._propagate("resize",b)}})}}),a.ui.plugin.add("resizable","containment",{start:function(b,d){var e=a(this).data("resizable"),f=e.options,g=e.element,h=f.containment,i=h instanceof a?h.get(0):/parent/.test(h)?g.parent().get(0):h;if(!i)return;e.containerElement=a(i);if(/document/.test(h)||h==document)e.containerOffset={left:0,top:0},e.containerPosition={left:0,top:0},e.parentData={element:a(document),left:0,top:0,width:a(document).width(),height:a(document).height()||document.body.parentNode.scrollHeight};else{var j=a(i),k=[];a(["Top","Right","Left","Bottom"]).each(function(a,b){k[a]=c(j.css("padding"+b))}),e.containerOffset=j.offset(),e.containerPosition=j.position(),e.containerSize={height:j.innerHeight()-k[3],width:j.innerWidth()-k[1]};var l=e.containerOffset,m=e.containerSize.height,n=e.containerSize.width,o=a.ui.hasScroll(i,"left")?i.scrollWidth:n,p=a.ui.hasScroll(i)?i.scrollHeight:m;e.parentData={element:i,left:l.left,top:l.top,width:o,height:p}}},resize:function(b,c){var d=a(this).data("resizable"),e=d.options,f=d.containerSize,g=d.containerOffset,h=d.size,i=d.position,j=d._aspectRatio||b.shiftKey,k={top:0,left:0},l=d.containerElement;l[0]!=document&&/static/.test(l.css("position"))&&(k=g),i.left<(d._helper?g.left:0)&&(d.size.width=d.size.width+(d._helper?d.position.left-g.left:d.position.left-k.left),j&&(d.size.height=d.size.width/d.aspectRatio),d.position.left=e.helper?g.left:0),i.top<(d._helper?g.top:0)&&(d.size.height=d.size.height+(d._helper?d.position.top-g.top:d.position.top),j&&(d.size.width=d.size.height*d.aspectRatio),d.position.top=d._helper?g.top:0),d.offset.left=d.parentData.left+d.position.left,d.offset.top=d.parentData.top+d.position.top;var m=Math.abs((d._helper?d.offset.left-k.left:d.offset.left-k.left)+d.sizeDiff.width),n=Math.abs((d._helper?d.offset.top-k.top:d.offset.top-g.top)+d.sizeDiff.height),o=d.containerElement.get(0)==d.element.parent().get(0),p=/relative|absolute/.test(d.containerElement.css("position"));o&&p&&(m-=d.parentData.left),m+d.size.width>=d.parentData.width&&(d.size.width=d.parentData.width-m,j&&(d.size.height=d.size.width/d.aspectRatio)),n+d.size.height>=d.parentData.height&&(d.size.height=d.parentData.height-n,j&&(d.size.width=d.size.height*d.aspectRatio))},stop:function(b,c){var d=a(this).data("resizable"),e=d.options,f=d.position,g=d.containerOffset,h=d.containerPosition,i=d.containerElement,j=a(d.helper),k=j.offset(),l=j.outerWidth()-d.sizeDiff.width,m=j.outerHeight()-d.sizeDiff.height;d._helper&&!e.animate&&/relative/.test(i.css("position"))&&a(this).css({left:k.left-h.left-g.left,width:l,height:m}),d._helper&&!e.animate&&/static/.test(i.css("position"))&&a(this).css({left:k.left-h.left-g.left,width:l,height:m})}}),a.ui.plugin.add("resizable","ghost",{start:function(b,c){var d=a(this).data("resizable"),e=d.options,f=d.size;d.ghost=d.originalElement.clone(),d.ghost.css({opacity:.25,display:"block",position:"relative",height:f.height,width:f.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass(typeof e.ghost=="string"?e.ghost:""),d.ghost.appendTo(d.helper)},resize:function(b,c){var d=a(this).data("resizable"),e=d.options;d.ghost&&d.ghost.css({position:"relative",height:d.size.height,width:d.size.width})},stop:function(b,c){var d=a(this).data("resizable"),e=d.options;d.ghost&&d.helper&&d.helper.get(0).removeChild(d.ghost.get(0))}}),a.ui.plugin.add("resizable","grid",{resize:function(b,c){var d=a(this).data("resizable"),e=d.options,f=d.size,g=d.originalSize,h=d.originalPosition,i=d.axis,j=e._aspectRatio||b.shiftKey;e.grid=typeof e.grid=="number"?[e.grid,e.grid]:e.grid;var k=Math.round((f.width-g.width)/(e.grid[0]||1))*(e.grid[0]||1),l=Math.round((f.height-g.height)/(e.grid[1]||1))*(e.grid[1]||1);/^(se|s|e)$/.test(i)?(d.size.width=g.width+k,d.size.height=g.height+l):/^(ne)$/.test(i)?(d.size.width=g.width+k,d.size.height=g.height+l,d.position.top=h.top-l):/^(sw)$/.test(i)?(d.size.width=g.width+k,d.size.height=g.height+l,d.position.left=h.left-k):(d.size.width=g.width+k,d.size.height=g.height+l,d.position.top=h.top-l,d.position.left=h.left-k)}});var c=function(a){return parseInt(a,10)||0},d=function(a){return!isNaN(parseInt(a,10))}})(jQuery);;/*! jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.ui.selectable.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){a.widget("ui.selectable",a.ui.mouse,{options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch"},_create:function(){var b=this;this.element.addClass("ui-selectable"),this.dragged=!1;var c;this.refresh=function(){c=a(b.options.filter,b.element[0]),c.addClass("ui-selectee"),c.each(function(){var b=a(this),c=b.offset();a.data(this,"selectable-item",{element:this,$element:b,left:c.left,top:c.top,right:c.left+b.outerWidth(),bottom:c.top+b.outerHeight(),startselected:!1,selected:b.hasClass("ui-selected"),selecting:b.hasClass("ui-selecting"),unselecting:b.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=c.addClass("ui-selectee"),this._mouseInit(),this.helper=a("<div class='ui-selectable-helper'></div>")},destroy:function(){return this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled").removeData("selectable").unbind(".selectable"),this._mouseDestroy(),this},_mouseStart:function(b){var c=this;this.opos=[b.pageX,b.pageY];if(this.options.disabled)return;var d=this.options;this.selectees=a(d.filter,this.element[0]),this._trigger("start",b),a(d.appendTo).append(this.helper),this.helper.css({left:b.clientX,top:b.clientY,width:0,height:0}),d.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var d=a.data(this,"selectable-item");d.startselected=!0,!b.metaKey&&!b.ctrlKey&&(d.$element.removeClass("ui-selected"),d.selected=!1,d.$element.addClass("ui-unselecting"),d.unselecting=!0,c._trigger("unselecting",b,{unselecting:d.element}))}),a(b.target).parents().andSelf().each(function(){var d=a.data(this,"selectable-item");if(d){var e=!b.metaKey&&!b.ctrlKey||!d.$element.hasClass("ui-selected");return d.$element.removeClass(e?"ui-unselecting":"ui-selected").addClass(e?"ui-selecting":"ui-unselecting"),d.unselecting=!e,d.selecting=e,d.selected=e,e?c._trigger("selecting",b,{selecting:d.element}):c._trigger("unselecting",b,{unselecting:d.element}),!1}})},_mouseDrag:function(b){var c=this;this.dragged=!0;if(this.options.disabled)return;var d=this.options,e=this.opos[0],f=this.opos[1],g=b.pageX,h=b.pageY;if(e>g){var i=g;g=e,e=i}if(f>h){var i=h;h=f,f=i}return this.helper.css({left:e,top:f,width:g-e,height:h-f}),this.selectees.each(function(){var i=a.data(this,"selectable-item");if(!i||i.element==c.element[0])return;var j=!1;d.tolerance=="touch"?j=!(i.left>g||i.right<e||i.top>h||i.bottom<f):d.tolerance=="fit"&&(j=i.left>e&&i.right<g&&i.top>f&&i.bottom<h),j?(i.selected&&(i.$element.removeClass("ui-selected"),i.selected=!1),i.unselecting&&(i.$element.removeClass("ui-unselecting"),i.unselecting=!1),i.selecting||(i.$element.addClass("ui-selecting"),i.selecting=!0,c._trigger("selecting",b,{selecting:i.element}))):(i.selecting&&((b.metaKey||b.ctrlKey)&&i.startselected?(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.$element.addClass("ui-selected"),i.selected=!0):(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.startselected&&(i.$element.addClass("ui-unselecting"),i.unselecting=!0),c._trigger("unselecting",b,{unselecting:i.element}))),i.selected&&!b.metaKey&&!b.ctrlKey&&!i.startselected&&(i.$element.removeClass("ui-selected"),i.selected=!1,i.$element.addClass("ui-unselecting"),i.unselecting=!0,c._trigger("unselecting",b,{unselecting:i.element})))}),!1},_mouseStop:function(b){var c=this;this.dragged=!1;var d=this.options;return a(".ui-unselecting",this.element[0]).each(function(){var d=a.data(this,"selectable-item");d.$element.removeClass("ui-unselecting"),d.unselecting=!1,d.startselected=!1,c._trigger("unselected",b,{unselected:d.element})}),a(".ui-selecting",this.element[0]).each(function(){var d=a.data(this,"selectable-item");d.$element.removeClass("ui-selecting").addClass("ui-selected"),d.selecting=!1,d.selected=!0,d.startselected=!0,c._trigger("selected",b,{selected:d.element})}),this._trigger("stop",b),this.helper.remove(),!1}}),a.extend(a.ui.selectable,{version:"1.8.23"})})(jQuery);;/*! jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.ui.sortable.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){a.widget("ui.sortable",a.ui.mouse,{widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3},_create:function(){var a=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?a.axis==="x"||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},destroy:function(){a.Widget.prototype.destroy.call(this),this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var b=this.items.length-1;b>=0;b--)this.items[b].item.removeData(this.widgetName+"-item");return this},_setOption:function(b,c){b==="disabled"?(this.options[b]=c,this.widget()[c?"addClass":"removeClass"]("ui-sortable-disabled")):a.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(b,c){var d=this;if(this.reverting)return!1;if(this.options.disabled||this.options.type=="static")return!1;this._refreshItems(b);var e=null,f=this,g=a(b.target).parents().each(function(){if(a.data(this,d.widgetName+"-item")==f)return e=a(this),!1});a.data(b.target,d.widgetName+"-item")==f&&(e=a(b.target));if(!e)return!1;if(this.options.handle&&!c){var h=!1;a(this.options.handle,e).find("*").andSelf().each(function(){this==b.target&&(h=!0)});if(!h)return!1}return this.currentItem=e,this._removeCurrentsFromItems(),!0},_mouseStart:function(b,c,d){var e=this.options,f=this;this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(b),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(b),this.originalPageX=b.pageX,this.originalPageY=b.pageY,e.cursorAt&&this._adjustOffsetFromHelper(e.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!=this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),e.containment&&this._setContainment(),e.cursor&&(a("body").css("cursor")&&(this._storedCursor=a("body").css("cursor")),a("body").css("cursor",e.cursor)),e.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",e.opacity)),e.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",e.zIndex)),this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",b,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions();if(!d)for(var g=this.containers.length-1;g>=0;g--)this.containers[g]._trigger("activate",b,f._uiHash(this));return a.ui.ddmanager&&(a.ui.ddmanager.current=this),a.ui.ddmanager&&!e.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(b),!0},_mouseDrag:function(b){this.position=this._generatePosition(b),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs);if(this.options.scroll){var c=this.options,d=!1;this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-b.pageY<c.scrollSensitivity?this.scrollParent[0].scrollTop=d=this.scrollParent[0].scrollTop+c.scrollSpeed:b.pageY-this.overflowOffset.top<c.scrollSensitivity&&(this.scrollParent[0].scrollTop=d=this.scrollParent[0].scrollTop-c.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-b.pageX<c.scrollSensitivity?this.scrollParent[0].scrollLeft=d=this.scrollParent[0].scrollLeft+c.scrollSpeed:b.pageX-this.overflowOffset.left<c.scrollSensitivity&&(this.scrollParent[0].scrollLeft=d=this.scrollParent[0].scrollLeft-c.scrollSpeed)):(b.pageY-a(document).scrollTop()<c.scrollSensitivity?d=a(document).scrollTop(a(document).scrollTop()-c.scrollSpeed):a(window).height()-(b.pageY-a(document).scrollTop())<c.scrollSensitivity&&(d=a(document).scrollTop(a(document).scrollTop()+c.scrollSpeed)),b.pageX-a(document).scrollLeft()<c.scrollSensitivity?d=a(document).scrollLeft(a(document).scrollLeft()-c.scrollSpeed):a(window).width()-(b.pageX-a(document).scrollLeft())<c.scrollSensitivity&&(d=a(document).scrollLeft(a(document).scrollLeft()+c.scrollSpeed))),d!==!1&&a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b)}this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";for(var e=this.items.length-1;e>=0;e--){var f=this.items[e],g=f.item[0],h=this._intersectsWithPointer(f);if(!h)continue;if(g!=this.currentItem[0]&&this.placeholder[h==1?"next":"prev"]()[0]!=g&&!a.ui.contains(this.placeholder[0],g)&&(this.options.type=="semi-dynamic"?!a.ui.contains(this.element[0],g):!0)){this.direction=h==1?"down":"up";if(this.options.tolerance=="pointer"||this._intersectsWithSides(f))this._rearrange(b,f);else break;this._trigger("change",b,this._uiHash());break}}return this._contactContainers(b),a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),this._trigger("sort",b,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(b,c){if(!b)return;a.ui.ddmanager&&!this.options.dropBehaviour&&a.ui.ddmanager.drop(this,b);if(this.options.revert){var d=this,e=d.placeholder.offset();d.reverting=!0,a(this.helper).animate({left:e.left-this.offset.parent.left-d.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:e.top-this.offset.parent.top-d.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){d._clear(b)})}else this._clear(b,c);return!1},cancel:function(){var b=this;if(this.dragging){this._mouseUp({target:null}),this.options.helper=="original"?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var c=this.containers.length-1;c>=0;c--)this.containers[c]._trigger("deactivate",null,b._uiHash(this)),this.containers[c].containerCache.over&&(this.containers[c]._trigger("out",null,b._uiHash(this)),this.containers[c].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.options.helper!="original"&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),a.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?a(this.domPosition.prev).after(this.currentItem):a(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(b){var c=this._getItemsAsjQuery(b&&b.connected),d=[];return b=b||{},a(c).each(function(){var c=(a(b.item||this).attr(b.attribute||"id")||"").match(b.expression||/(.+)[-=_](.+)/);c&&d.push((b.key||c[1]+"[]")+"="+(b.key&&b.expression?c[1]:c[2]))}),!d.length&&b.key&&d.push(b.key+"="),d.join("&")},toArray:function(b){var c=this._getItemsAsjQuery(b&&b.connected),d=[];return b=b||{},c.each(function(){d.push(a(b.item||this).attr(b.attribute||"id")||"")}),d},_intersectsWith:function(a){var b=this.positionAbs.left,c=b+this.helperProportions.width,d=this.positionAbs.top,e=d+this.helperProportions.height,f=a.left,g=f+a.width,h=a.top,i=h+a.height,j=this.offset.click.top,k=this.offset.click.left,l=d+j>h&&d+j<i&&b+k>f&&b+k<g;return this.options.tolerance=="pointer"||this.options.forcePointerForContainers||this.options.tolerance!="pointer"&&this.helperProportions[this.floating?"width":"height"]>a[this.floating?"width":"height"]?l:f<b+this.helperProportions.width/2&&c-this.helperProportions.width/2<g&&h<d+this.helperProportions.height/2&&e-this.helperProportions.height/2<i},_intersectsWithPointer:function(b){var c=this.options.axis==="x"||a.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,b.top,b.height),d=this.options.axis==="y"||a.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,b.left,b.width),e=c&&d,f=this._getDragVerticalDirection(),g=this._getDragHorizontalDirection();return e?this.floating?g&&g=="right"||f=="down"?2:1:f&&(f=="down"?2:1):!1},_intersectsWithSides:function(b){var c=a.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,b.top+b.height/2,b.height),d=a.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,b.left+b.width/2,b.width),e=this._getDragVerticalDirection(),f=this._getDragHorizontalDirection();return this.floating&&f?f=="right"&&d||f=="left"&&!d:e&&(e=="down"&&c||e=="up"&&!c)},_getDragVerticalDirection:function(){var a=this.positionAbs.top-this.lastPositionAbs.top;return a!=0&&(a>0?"down":"up")},_getDragHorizontalDirection:function(){var a=this.positionAbs.left-this.lastPositionAbs.left;return a!=0&&(a>0?"right":"left")},refresh:function(a){return this._refreshItems(a),this.refreshPositions(),this},_connectWith:function(){var a=this.options;return a.connectWith.constructor==String?[a.connectWith]:a.connectWith},_getItemsAsjQuery:function(b){var c=this,d=[],e=[],f=this._connectWith();if(f&&b)for(var g=f.length-1;g>=0;g--){var h=a(f[g]);for(var i=h.length-1;i>=0;i--){var j=a.data(h[i],this.widgetName);j&&j!=this&&!j.options.disabled&&e.push([a.isFunction(j.options.items)?j.options.items.call(j.element):a(j.options.items,j.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),j])}}e.push([a.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):a(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(var g=e.length-1;g>=0;g--)e[g][0].each(function(){d.push(this)});return a(d)},_removeCurrentsFromItems:function(){var a=this.currentItem.find(":data("+this.widgetName+"-item)");for(var b=0;b<this.items.length;b++)for(var c=0;c<a.length;c++)a[c]==this.items[b].item[0]&&this.items.splice(b,1)},_refreshItems:function(b){this.items=[],this.containers=[this];var c=this.items,d=this,e=[[a.isFunction(this.options.items)?this.options.items.call(this.element[0],b,{item:this.currentItem}):a(this.options.items,this.element),this]],f=this._connectWith();if(f&&this.ready)for(var g=f.length-1;g>=0;g--){var h=a(f[g]);for(var i=h.length-1;i>=0;i--){var j=a.data(h[i],this.widgetName);j&&j!=this&&!j.options.disabled&&(e.push([a.isFunction(j.options.items)?j.options.items.call(j.element[0],b,{item:this.currentItem}):a(j.options.items,j.element),j]),this.containers.push(j))}}for(var g=e.length-1;g>=0;g--){var k=e[g][1],l=e[g][0];for(var i=0,m=l.length;i<m;i++){var n=a(l[i]);n.data(this.widgetName+"-item",k),c.push({item:n,instance:k,width:0,height:0,left:0,top:0})}}},refreshPositions:function(b){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());for(var c=this.items.length-1;c>=0;c--){var d=this.items[c];if(d.instance!=this.currentContainer&&this.currentContainer&&d.item[0]!=this.currentItem[0])continue;var e=this.options.toleranceElement?a(this.options.toleranceElement,d.item):d.item;b||(d.width=e.outerWidth(),d.height=e.outerHeight());var f=e.offset();d.left=f.left,d.top=f.top}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(var c=this.containers.length-1;c>=0;c--){var f=this.containers[c].element.offset();this.containers[c].containerCache.left=f.left,this.containers[c].containerCache.top=f.top,this.containers[c].containerCache.width=this.containers[c].element.outerWidth(),this.containers[c].containerCache.height=this.containers[c].element.outerHeight()}return this},_createPlaceholder:function(b){var c=b||this,d=c.options;if(!d.placeholder||d.placeholder.constructor==String){var e=d.placeholder;d.placeholder={element:function(){var b=a(document.createElement(c.currentItem[0].nodeName)).addClass(e||c.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];return e||(b.style.visibility="hidden"),b},update:function(a,b){if(e&&!d.forcePlaceholderSize)return;b.height()||b.height(c.currentItem.innerHeight()-parseInt(c.currentItem.css("paddingTop")||0,10)-parseInt(c.currentItem.css("paddingBottom")||0,10)),b.width()||b.width(c.currentItem.innerWidth()-parseInt(c.currentItem.css("paddingLeft")||0,10)-parseInt(c.currentItem.css("paddingRight")||0,10))}}}c.placeholder=a(d.placeholder.element.call(c.element,c.currentItem)),c.currentItem.after(c.placeholder),d.placeholder.update(c,c.placeholder)},_contactContainers:function(b){var c=null,d=null;for(var e=this.containers.length-1;e>=0;e--){if(a.ui.contains(this.currentItem[0],this.containers[e].element[0]))continue;if(this._intersectsWith(this.containers[e].containerCache)){if(c&&a.ui.contains(this.containers[e].element[0],c.element[0]))continue;c=this.containers[e],d=e}else this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",b,this._uiHash(this)),this.containers[e].containerCache.over=0)}if(!c)return;if(this.containers.length===1)this.containers[d]._trigger("over",b,this._uiHash(this)),this.containers[d].containerCache.over=1;else if(this.currentContainer!=this.containers[d]){var f=1e4,g=null,h=this.positionAbs[this.containers[d].floating?"left":"top"];for(var i=this.items.length-1;i>=0;i--){if(!a.ui.contains(this.containers[d].element[0],this.items[i].item[0]))continue;var j=this.containers[d].floating?this.items[i].item.offset().left:this.items[i].item.offset().top;Math.abs(j-h)<f&&(f=Math.abs(j-h),g=this.items[i],this.direction=j-h>0?"down":"up")}if(!g&&!this.options.dropOnEmpty)return;this.currentContainer=this.containers[d],g?this._rearrange(b,g,null,!0):this._rearrange(b,null,this.containers[d].element,!0),this._trigger("change",b,this._uiHash()),this.containers[d]._trigger("change",b,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[d]._trigger("over",b,this._uiHash(this)),this.containers[d].containerCache.over=1}},_createHelper:function(b){var c=this.options,d=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[b,this.currentItem])):c.helper=="clone"?this.currentItem.clone():this.currentItem;return d.parents("body").length||a(c.appendTo!="parent"?c.appendTo:this.currentItem[0].parentNode)[0].appendChild(d[0]),d[0]==this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(d[0].style.width==""||c.forceHelperSize)&&d.width(this.currentItem.width()),(d[0].style.height==""||c.forceHelperSize)&&d.height(this.currentItem.height()),d},_adjustOffsetFromHelper:function(b){typeof b=="string"&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left"in b&&(this.offset.click.left=b.left+this.margins.left),"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top"in b&&(this.offset.click.top=b.top+this.margins.top),"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var b=this.offsetParent.offset();this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&a.browser.msie)b={top:0,left:0};return{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var a=this.currentItem.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b=this.options;b.containment=="parent"&&(b.containment=this.helper[0].parentNode);if(b.containment=="document"||b.containment=="window")this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,a(b.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(a(b.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(b.containment)){var c=a(b.containment)[0],d=a(b.containment).offset(),e=a(c).css("overflow")!="hidden";this.containment=[d.left+(parseInt(a(c).css("borderLeftWidth"),10)||0)+(parseInt(a(c).css("paddingLeft"),10)||0)-this.margins.left,d.top+(parseInt(a(c).css("borderTopWidth"),10)||0)+(parseInt(a(c).css("paddingTop"),10)||0)-this.margins.top,d.left+(e?Math.max(c.scrollWidth,c.offsetWidth):c.offsetWidth)-(parseInt(a(c).css("borderLeftWidth"),10)||0)-(parseInt(a(c).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,d.top+(e?Math.max(c.scrollHeight,c.offsetHeight):c.offsetHeight)-(parseInt(a(c).css("borderTopWidth"),10)||0)-(parseInt(a(c).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(b,c){c||(c=this.position);var d=b=="absolute"?1:-1,e=this.options,f=this.cssPosition=="absolute"&&(this.scrollParent[0]==document||!a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,g=/(html|body)/i.test(f[0].tagName);return{top:c.top+this.offset.relative.top*d+this.offset.parent.top*d-(a.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():g?0:f.scrollTop())*d),left:c.left+this.offset.relative.left*d+this.offset.parent.left*d-(a.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():g?0:f.scrollLeft())*d)}},_generatePosition:function(b){var c=this.options,d=this.cssPosition=="absolute"&&(this.scrollParent[0]==document||!a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,e=/(html|body)/i.test(d[0].tagName);this.cssPosition=="relative"&&(this.scrollParent[0]==document||this.scrollParent[0]==this.offsetParent[0])&&(this.offset.relative=this._getRelativeOffset());var f=b.pageX,g=b.pageY;if(this.originalPosition){this.containment&&(b.pageX-this.offset.click.left<this.containment[0]&&(f=this.containment[0]+this.offset.click.left),b.pageY-this.offset.click.top<this.containment[1]&&(g=this.containment[1]+this.offset.click.top),b.pageX-this.offset.click.left>this.containment[2]&&(f=this.containment[2]+this.offset.click.left),b.pageY-this.offset.click.top>this.containment[3]&&(g=this.containment[3]+this.offset.click.top));if(c.grid){var h=this.originalPageY+Math.round((g-this.originalPageY)/c.grid[1])*c.grid[1];g=this.containment?h-this.offset.click.top<this.containment[1]||h-this.offset.click.top>this.containment[3]?h-this.offset.click.top<this.containment[1]?h+c.grid[1]:h-c.grid[1]:h:h;var i=this.originalPageX+Math.round((f-this.originalPageX)/c.grid[0])*c.grid[0];f=this.containment?i-this.offset.click.left<this.containment[0]||i-this.offset.click.left>this.containment[2]?i-this.offset.click.left<this.containment[0]?i+c.grid[0]:i-c.grid[0]:i:i}}return{top:g-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(a.browser.safari&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():e?0:d.scrollTop()),left:f-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(a.browser.safari&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():e?0:d.scrollLeft())}},_rearrange:function(a,b,c,d){c?c[0].appendChild(this.placeholder[0]):b.item[0].parentNode.insertBefore(this.placeholder[0],this.direction=="down"?b.item[0]:b.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var e=this,f=this.counter;window.setTimeout(function(){f==e.counter&&e.refreshPositions(!d)},0)},_clear:function(b,c){this.reverting=!1;var d=[],e=this;!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null;if(this.helper[0]==this.currentItem[0]){for(var f in this._storedCSS)if(this._storedCSS[f]=="auto"||this._storedCSS[f]=="static")this._storedCSS[f]="";this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!c&&d.push(function(a){this._trigger("receive",a,this._uiHash(this.fromOutside))}),(this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!=this.currentItem.parent()[0])&&!c&&d.push(function(a){this._trigger("update",a,this._uiHash())});if(!a.ui.contains(this.element[0],this.currentItem[0])){c||d.push(function(a){this._trigger("remove",a,this._uiHash())});for(var f=this.containers.length-1;f>=0;f--)a.ui.contains(this.containers[f].element[0],this.currentItem[0])&&!c&&(d.push(function(a){return function(b){a._trigger("receive",b,this._uiHash(this))}}.call(this,this.containers[f])),d.push(function(a){return function(b){a._trigger("update",b,this._uiHash(this))}}.call(this,this.containers[f])))}for(var f=this.containers.length-1;f>=0;f--)c||d.push(function(a){return function(b){a._trigger("deactivate",b,this._uiHash(this))}}.call(this,this.containers[f])),this.containers[f].containerCache.over&&(d.push(function(a){return function(b){a._trigger("out",b,this._uiHash(this))}}.call(this,this.containers[f])),this.containers[f].containerCache.over=0);this._storedCursor&&a("body").css("cursor",this._storedCursor),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex",this._storedZIndex=="auto"?"":this._storedZIndex),this.dragging=!1;if(this.cancelHelperRemoval){if(!c){this._trigger("beforeStop",b,this._uiHash());for(var f=0;f<d.length;f++)d[f].call(this,b);this._trigger("stop",b,this._uiHash())}return this.fromOutside=!1,!1}c||this._trigger("beforeStop",b,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!=this.currentItem[0]&&this.helper.remove(),this.helper=null;if(!c){for(var f=0;f<d.length;f++)d[f].call(this,b);this._trigger("stop",b,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){a.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(b){var c=b||this;return{helper:c.helper,placeholder:c.placeholder||a([]),position:c.position,originalPosition:c.originalPosition,offset:c.positionAbs,item:c.currentItem,sender:b?b.element:null}}}),a.extend(a.ui.sortable,{version:"1.8.23"})})(jQuery);;/*! jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.ui.accordion.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){a.widget("ui.accordion",{options:{active:0,animated:"slide",autoHeight:!0,clearStyle:!1,collapsible:!1,event:"click",fillSpace:!1,header:"> li > :first-child,> :not(li):even",icons:{header:"ui-icon-triangle-1-e",headerSelected:"ui-icon-triangle-1-s"},navigation:!1,navigationFilter:function(){return this.href.toLowerCase()===location.href.toLowerCase()}},_create:function(){var b=this,c=b.options;b.running=0,b.element.addClass("ui-accordion ui-widget ui-helper-reset").children("li").addClass("ui-accordion-li-fix"),b.headers=b.element.find(c.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all").bind("mouseenter.accordion",function(){if(c.disabled)return;a(this).addClass("ui-state-hover")}).bind("mouseleave.accordion",function(){if(c.disabled)return;a(this).removeClass("ui-state-hover")}).bind("focus.accordion",function(){if(c.disabled)return;a(this).addClass("ui-state-focus")}).bind("blur.accordion",function(){if(c.disabled)return;a(this).removeClass("ui-state-focus")}),b.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom");if(c.navigation){var d=b.element.find("a").filter(c.navigationFilter).eq(0);if(d.length){var e=d.closest(".ui-accordion-header");e.length?b.active=e:b.active=d.closest(".ui-accordion-content").prev()}}b.active=b._findActive(b.active||c.active).addClass("ui-state-default ui-state-active").toggleClass("ui-corner-all").toggleClass("ui-corner-top"),b.active.next().addClass("ui-accordion-content-active"),b._createIcons(),b.resize(),b.element.attr("role","tablist"),b.headers.attr("role","tab").bind("keydown.accordion",function(a){return b._keydown(a)}).next().attr("role","tabpanel"),b.headers.not(b.active||"").attr({"aria-expanded":"false","aria-selected":"false",tabIndex:-1}).next().hide(),b.active.length?b.active.attr({"aria-expanded":"true","aria-selected":"true",tabIndex:0}):b.headers.eq(0).attr("tabIndex",0),a.browser.safari||b.headers.find("a").attr("tabIndex",-1),c.event&&b.headers.bind(c.event.split(" ").join(".accordion ")+".accordion",function(a){b._clickHandler.call(b,a,this),a.preventDefault()})},_createIcons:function(){var b=this.options;b.icons&&(a("<span></span>").addClass("ui-icon "+b.icons.header).prependTo(this.headers),this.active.children(".ui-icon").toggleClass(b.icons.header).toggleClass(b.icons.headerSelected),this.element.addClass("ui-accordion-icons"))},_destroyIcons:function(){this.headers.children(".ui-icon").remove(),this.element.removeClass("ui-accordion-icons")},destroy:function(){var b=this.options;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.unbind(".accordion").removeClass("ui-accordion-header ui-accordion-disabled ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("tabIndex"),this.headers.find("a").removeAttr("tabIndex"),this._destroyIcons();var c=this.headers.next().css("display","").removeAttr("role").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-accordion-disabled ui-state-disabled");return(b.autoHeight||b.fillHeight)&&c.css("height",""),a.Widget.prototype.destroy.call(this)},_setOption:function(b,c){a.Widget.prototype._setOption.apply(this,arguments),b=="active"&&this.activate(c),b=="icons"&&(this._destroyIcons(),c&&this._createIcons()),b=="disabled"&&this.headers.add(this.headers.next())[c?"addClass":"removeClass"]("ui-accordion-disabled ui-state-disabled")},_keydown:function(b){if(this.options.disabled||b.altKey||b.ctrlKey)return;var c=a.ui.keyCode,d=this.headers.length,e=this.headers.index(b.target),f=!1;switch(b.keyCode){case c.RIGHT:case c.DOWN:f=this.headers[(e+1)%d];break;case c.LEFT:case c.UP:f=this.headers[(e-1+d)%d];break;case c.SPACE:case c.ENTER:this._clickHandler({target:b.target},b.target),b.preventDefault()}return f?(a(b.target).attr("tabIndex",-1),a(f).attr("tabIndex",0),f.focus(),!1):!0},resize:function(){var b=this.options,c;if(b.fillSpace){if(a.browser.msie){var d=this.element.parent().css("overflow");this.element.parent().css("overflow","hidden")}c=this.element.parent().height(),a.browser.msie&&this.element.parent().css("overflow",d),this.headers.each(function(){c-=a(this).outerHeight(!0)}),this.headers.next().each(function(){a(this).height(Math.max(0,c-a(this).innerHeight()+a(this).height()))}).css("overflow","auto")}else b.autoHeight&&(c=0,this.headers.next().each(function(){c=Math.max(c,a(this).height("").height())}).height(c));return this},activate:function(a){this.options.active=a;var b=this._findActive(a)[0];return this._clickHandler({target:b},b),this},_findActive:function(b){return b?typeof b=="number"?this.headers.filter(":eq("+b+")"):this.headers.not(this.headers.not(b)):b===!1?a([]):this.headers.filter(":eq(0)")},_clickHandler:function(b,c){var d=this.options;if(d.disabled)return;if(!b.target){if(!d.collapsible)return;this.active.removeClass("ui-state-active ui-corner-top").addClass("ui-state-default ui-corner-all").children(".ui-icon").removeClass(d.icons.headerSelected).addClass(d.icons.header),this.active.next().addClass("ui-accordion-content-active");var e=this.active.next(),f={options:d,newHeader:a([]),oldHeader:d.active,newContent:a([]),oldContent:e},g=this.active=a([]);this._toggle(g,e,f);return}var h=a(b.currentTarget||c),i=h[0]===this.active[0];d.active=d.collapsible&&i?!1:this.headers.index(h);if(this.running||!d.collapsible&&i)return;var j=this.active,g=h.next(),e=this.active.next(),f={options:d,newHeader:i&&d.collapsible?a([]):h,oldHeader:this.active,newContent:i&&d.collapsible?a([]):g,oldContent:e},k=this.headers.index(this.active[0])>this.headers.index(h[0]);this.active=i?a([]):h,this._toggle(g,e,f,i,k),j.removeClass("ui-state-active ui-corner-top").addClass("ui-state-default ui-corner-all").children(".ui-icon").removeClass(d.icons.headerSelected).addClass(d.icons.header),i||(h.removeClass("ui-state-default ui-corner-all").addClass("ui-state-active ui-corner-top").children(".ui-icon").removeClass(d.icons.header).addClass(d.icons.headerSelected),h.next().addClass("ui-accordion-content-active"));return},_toggle:function(b,c,d,e,f){var g=this,h=g.options;g.toShow=b,g.toHide=c,g.data=d;var i=function(){if(!g)return;return g._completed.apply(g,arguments)};g._trigger("changestart",null,g.data),g.running=c.size()===0?b.size():c.size();if(h.animated){var j={};h.collapsible&&e?j={toShow:a([]),toHide:c,complete:i,down:f,autoHeight:h.autoHeight||h.fillSpace}:j={toShow:b,toHide:c,complete:i,down:f,autoHeight:h.autoHeight||h.fillSpace},h.proxied||(h.proxied=h.animated),h.proxiedDuration||(h.proxiedDuration=h.duration),h.animated=a.isFunction(h.proxied)?h.proxied(j):h.proxied,h.duration=a.isFunction(h.proxiedDuration)?h.proxiedDuration(j):h.proxiedDuration;var k=a.ui.accordion.animations,l=h.duration,m=h.animated;m&&!k[m]&&!a.easing[m]&&(m="slide"),k[m]||(k[m]=function(a){this.slide(a,{easing:m,duration:l||700})}),k[m](j)}else h.collapsible&&e?b.toggle():(c.hide(),b.show()),i(!0);c.prev().attr({"aria-expanded":"false","aria-selected":"false",tabIndex:-1}).blur(),b.prev().attr({"aria-expanded":"true","aria-selected":"true",tabIndex:0}).focus()},_completed:function(a){this.running=a?0:--this.running;if(this.running)return;this.options.clearStyle&&this.toShow.add(this.toHide).css({height:"",overflow:""}),this.toHide.removeClass("ui-accordion-content-active"),this.toHide.length&&(this.toHide.parent()[0].className=this.toHide.parent()[0].className),this._trigger("change",null,this.data)}}),a.extend(a.ui.accordion,{version:"1.8.23",animations:{slide:function(b,c){b=a.extend({easing:"swing",duration:300},b,c);if(!b.toHide.size()){b.toShow.animate({height:"show",paddingTop:"show",paddingBottom:"show"},b);return}if(!b.toShow.size()){b.toHide.animate({height:"hide",paddingTop:"hide",paddingBottom:"hide"},b);return}var d=b.toShow.css("overflow"),e=0,f={},g={},h=["height","paddingTop","paddingBottom"],i,j=b.toShow;i=j[0].style.width,j.width(j.parent().width()-parseFloat(j.css("paddingLeft"))-parseFloat(j.css("paddingRight"))-(parseFloat(j.css("borderLeftWidth"))||0)-(parseFloat(j.css("borderRightWidth"))||0)),a.each(h,function(c,d){g[d]="hide";var e=(""+a.css(b.toShow[0],d)).match(/^([\d+-.]+)(.*)$/);f[d]={value:e[1],unit:e[2]||"px"}}),b.toShow.css({height:0,overflow:"hidden"}).show(),b.toHide.filter(":hidden").each(b.complete).end().filter(":visible").animate(g,{step:function(a,c){c.prop=="height"&&(e=c.end-c.start===0?0:(c.now-c.start)/(c.end-c.start)),b.toShow[0].style[c.prop]=e*f[c.prop].value+f[c.prop].unit},duration:b.duration,easing:b.easing,complete:function(){b.autoHeight||b.toShow.css("height",""),b.toShow.css({width:i,overflow:d}),b.complete()}})},bounceslide:function(a){this.slide(a,{easing:a.down?"easeOutBounce":"swing",duration:a.down?1e3:200})}}})})(jQuery);;/*! jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.ui.autocomplete.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){var c=0;a.widget("ui.autocomplete",{options:{appendTo:"body",autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null},pending:0,_create:function(){var b=this,c=this.element[0].ownerDocument,d;this.isMultiLine=this.element.is("textarea"),this.element.addClass("ui-autocomplete-input").attr("autocomplete","off").attr({role:"textbox","aria-autocomplete":"list","aria-haspopup":"true"}).bind("keydown.autocomplete",function(c){if(b.options.disabled||b.element.propAttr("readOnly"))return;d=!1;var e=a.ui.keyCode;switch(c.keyCode){case e.PAGE_UP:b._move("previousPage",c);break;case e.PAGE_DOWN:b._move("nextPage",c);break;case e.UP:b._keyEvent("previous",c);break;case e.DOWN:b._keyEvent("next",c);break;case e.ENTER:case e.NUMPAD_ENTER:b.menu.active&&(d=!0,c.preventDefault());case e.TAB:if(!b.menu.active)return;b.menu.select(c);break;case e.ESCAPE:b.element.val(b.term),b.close(c);break;default:clearTimeout(b.searching),b.searching=setTimeout(function(){b.term!=b.element.val()&&(b.selectedItem=null,b.search(null,c))},b.options.delay)}}).bind("keypress.autocomplete",function(a){d&&(d=!1,a.preventDefault())}).bind("focus.autocomplete",function(){if(b.options.disabled)return;b.selectedItem=null,b.previous=b.element.val()}).bind("blur.autocomplete",function(a){if(b.options.disabled)return;clearTimeout(b.searching),b.closing=setTimeout(function(){b.close(a),b._change(a)},150)}),this._initSource(),this.menu=a("<ul></ul>").addClass("ui-autocomplete").appendTo(a(this.options.appendTo||"body",c)[0]).mousedown(function(c){var d=b.menu.element[0];a(c.target).closest(".ui-menu-item").length||setTimeout(function(){a(document).one("mousedown",function(c){c.target!==b.element[0]&&c.target!==d&&!a.ui.contains(d,c.target)&&b.close()})},1),setTimeout(function(){clearTimeout(b.closing)},13)}).menu({focus:function(a,c){var d=c.item.data("item.autocomplete");!1!==b._trigger("focus",a,{item:d})&&/^key/.test(a.originalEvent.type)&&b.element.val(d.value)},selected:function(a,d){var e=d.item.data("item.autocomplete"),f=b.previous;b.element[0]!==c.activeElement&&(b.element.focus(),b.previous=f,setTimeout(function(){b.previous=f,b.selectedItem=e},1)),!1!==b._trigger("select",a,{item:e})&&b.element.val(e.value),b.term=b.element.val(),b.close(a),b.selectedItem=e},blur:function(a,c){b.menu.element.is(":visible")&&b.element.val()!==b.term&&b.element.val(b.term)}}).zIndex(this.element.zIndex()+1).css({top:0,left:0}).hide().data("menu"),a.fn.bgiframe&&this.menu.element.bgiframe(),b.beforeunloadHandler=function(){b.element.removeAttr("autocomplete")},a(window).bind("beforeunload",b.beforeunloadHandler)},destroy:function(){this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete").removeAttr("role").removeAttr("aria-autocomplete").removeAttr("aria-haspopup"),this.menu.element.remove(),a(window).unbind("beforeunload",this.beforeunloadHandler),a.Widget.prototype.destroy.call(this)},_setOption:function(b,c){a.Widget.prototype._setOption.apply(this,arguments),b==="source"&&this._initSource(),b==="appendTo"&&this.menu.element.appendTo(a(c||"body",this.element[0].ownerDocument)[0]),b==="disabled"&&c&&this.xhr&&this.xhr.abort()},_initSource:function(){var b=this,c,d;a.isArray(this.options.source)?(c=this.options.source,this.source=function(b,d){d(a.ui.autocomplete.filter(c,b.term))}):typeof this.options.source=="string"?(d=this.options.source,this.source=function(c,e){b.xhr&&b.xhr.abort(),b.xhr=a.ajax({url:d,data:c,dataType:"json",success:function(a,b){e(a)},error:function(){e([])}})}):this.source=this.options.source},search:function(a,b){a=a!=null?a:this.element.val(),this.term=this.element.val();if(a.length<this.options.minLength)return this.close(b);clearTimeout(this.closing);if(this._trigger("search",b)===!1)return;return this._search(a)},_search:function(a){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.source({term:a},this._response())},_response:function(){var a=this,b=++c;return function(d){b===c&&a.__response(d),a.pending--,a.pending||a.element.removeClass("ui-autocomplete-loading")}},__response:function(a){!this.options.disabled&&a&&a.length?(a=this._normalize(a),this._suggest(a),this._trigger("open")):this.close()},close:function(a){clearTimeout(this.closing),this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.deactivate(),this._trigger("close",a))},_change:function(a){this.previous!==this.element.val()&&this._trigger("change",a,{item:this.selectedItem})},_normalize:function(b){return b.length&&b[0].label&&b[0].value?b:a.map(b,function(b){return typeof b=="string"?{label:b,value:b}:a.extend({label:b.label||b.value,value:b.value||b.label},b)})},_suggest:function(b){var c=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(c,b),this.menu.deactivate(),this.menu.refresh(),c.show(),this._resizeMenu(),c.position(a.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next(new a.Event("mouseover"))},_resizeMenu:function(){var a=this.menu.element;a.outerWidth(Math.max(a.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(b,c){var d=this;a.each(c,function(a,c){d._renderItem(b,c)})},_renderItem:function(b,c){return a("<li></li>").data("item.autocomplete",c).append(a("<a></a>").text(c.label)).appendTo(b)},_move:function(a,b){if(!this.menu.element.is(":visible")){this.search(null,b);return}if(this.menu.first()&&/^previous/.test(a)||this.menu.last()&&/^next/.test(a)){this.element.val(this.term),this.menu.deactivate();return}this.menu[a](b)},widget:function(){return this.menu.element},_keyEvent:function(a,b){if(!this.isMultiLine||this.menu.element.is(":visible"))this._move(a,b),b.preventDefault()}}),a.extend(a.ui.autocomplete,{escapeRegex:function(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},filter:function(b,c){var d=new RegExp(a.ui.autocomplete.escapeRegex(c),"i");return a.grep(b,function(a){return d.test(a.label||a.value||a)})}})})(jQuery),function(a){a.widget("ui.menu",{_create:function(){var b=this;this.element.addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr({role:"listbox","aria-activedescendant":"ui-active-menuitem"}).click(function(c){if(!a(c.target).closest(".ui-menu-item a").length)return;c.preventDefault(),b.select(c)}),this.refresh()},refresh:function(){var b=this,c=this.element.children("li:not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","menuitem");c.children("a").addClass("ui-corner-all").attr("tabindex",-1).mouseenter(function(c){b.activate(c,a(this).parent())}).mouseleave(function(){b.deactivate()})},activate:function(a,b){this.deactivate();if(this.hasScroll()){var c=b.offset().top-this.element.offset().top,d=this.element.scrollTop(),e=this.element.height();c<0?this.element.scrollTop(d+c):c>=e&&this.element.scrollTop(d+c-e+b.height())}this.active=b.eq(0).children("a").addClass("ui-state-hover").attr("id","ui-active-menuitem").end(),this._trigger("focus",a,{item:b})},deactivate:function(){if(!this.active)return;this.active.children("a").removeClass("ui-state-hover").removeAttr("id"),this._trigger("blur"),this.active=null},next:function(a){this.move("next",".ui-menu-item:first",a)},previous:function(a){this.move("prev",".ui-menu-item:last",a)},first:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},last:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},move:function(a,b,c){if(!this.active){this.activate(c,this.element.children(b));return}var d=this.active[a+"All"](".ui-menu-item").eq(0);d.length?this.activate(c,d):this.activate(c,this.element.children(b))},nextPage:function(b){if(this.hasScroll()){if(!this.active||this.last()){this.activate(b,this.element.children(".ui-menu-item:first"));return}var c=this.active.offset().top,d=this.element.height(),e=this.element.children(".ui-menu-item").filter(function(){var b=a(this).offset().top-c-d+a(this).height();return b<10&&b>-10});e.length||(e=this.element.children(".ui-menu-item:last")),this.activate(b,e)}else this.activate(b,this.element.children(".ui-menu-item").filter(!this.active||this.last()?":first":":last"))},previousPage:function(b){if(this.hasScroll()){if(!this.active||this.first()){this.activate(b,this.element.children(".ui-menu-item:last"));return}var c=this.active.offset().top,d=this.element.height(),e=this.element.children(".ui-menu-item").filter(function(){var b=a(this).offset().top-c+d-a(this).height();return b<10&&b>-10});e.length||(e=this.element.children(".ui-menu-item:first")),this.activate(b,e)}else this.activate(b,this.element.children(".ui-menu-item").filter(!this.active||this.first()?":last":":first"))},hasScroll:function(){return this.element.height()<this.element[a.fn.prop?"prop":"attr"]("scrollHeight")},select:function(a){this._trigger("selected",a,{item:this.active})}})}(jQuery);;/*! jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.ui.button.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){var c,d,e,f,g="ui-button ui-widget ui-state-default ui-corner-all",h="ui-state-hover ui-state-active ",i="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",j=function(){var b=a(this).find(":ui-button");setTimeout(function(){b.button("refresh")},1)},k=function(b){var c=b.name,d=b.form,e=a([]);return c&&(d?e=a(d).find("[name='"+c+"']"):e=a("[name='"+c+"']",b.ownerDocument).filter(function(){return!this.form})),e};a.widget("ui.button",{options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset.button").bind("reset.button",j),typeof this.options.disabled!="boolean"?this.options.disabled=!!this.element.propAttr("disabled"):this.element.propAttr("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var b=this,h=this.options,i=this.type==="checkbox"||this.type==="radio",l="ui-state-hover"+(i?"":" ui-state-active"),m="ui-state-focus";h.label===null&&(h.label=this.buttonElement.html()),this.buttonElement.addClass(g).attr("role","button").bind("mouseenter.button",function(){if(h.disabled)return;a(this).addClass("ui-state-hover"),this===c&&a(this).addClass("ui-state-active")}).bind("mouseleave.button",function(){if(h.disabled)return;a(this).removeClass(l)}).bind("click.button",function(a){h.disabled&&(a.preventDefault(),a.stopImmediatePropagation())}),this.element.bind("focus.button",function(){b.buttonElement.addClass(m)}).bind("blur.button",function(){b.buttonElement.removeClass(m)}),i&&(this.element.bind("change.button",function(){if(f)return;b.refresh()}),this.buttonElement.bind("mousedown.button",function(a){if(h.disabled)return;f=!1,d=a.pageX,e=a.pageY}).bind("mouseup.button",function(a){if(h.disabled)return;if(d!==a.pageX||e!==a.pageY)f=!0})),this.type==="checkbox"?this.buttonElement.bind("click.button",function(){if(h.disabled||f)return!1;a(this).toggleClass("ui-state-active"),b.buttonElement.attr("aria-pressed",b.element[0].checked)}):this.type==="radio"?this.buttonElement.bind("click.button",function(){if(h.disabled||f)return!1;a(this).addClass("ui-state-active"),b.buttonElement.attr("aria-pressed","true");var c=b.element[0];k(c).not(c).map(function(){return a(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown.button",function(){if(h.disabled)return!1;a(this).addClass("ui-state-active"),c=this,a(document).one("mouseup",function(){c=null})}).bind("mouseup.button",function(){if(h.disabled)return!1;a(this).removeClass("ui-state-active")}).bind("keydown.button",function(b){if(h.disabled)return!1;(b.keyCode==a.ui.keyCode.SPACE||b.keyCode==a.ui.keyCode.ENTER)&&a(this).addClass("ui-state-active")}).bind("keyup.button",function(){a(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(b){b.keyCode===a.ui.keyCode.SPACE&&a(this).click()})),this._setOption("disabled",h.disabled),this._resetButton()},_determineButtonType:function(){this.element.is(":checkbox")?this.type="checkbox":this.element.is(":radio")?this.type="radio":this.element.is("input")?this.type="input":this.type="button";if(this.type==="checkbox"||this.type==="radio"){var a=this.element.parents().filter(":last"),b="label[for='"+this.element.attr("id")+"']";this.buttonElement=a.find(b),this.buttonElement.length||(a=a.length?a.siblings():this.element.siblings(),this.buttonElement=a.filter(b),this.buttonElement.length||(this.buttonElement=a.find(b))),this.element.addClass("ui-helper-hidden-accessible");var c=this.element.is(":checked");c&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.attr("aria-pressed",c)}else this.buttonElement=this.element},widget:function(){return this.buttonElement},destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(g+" "+h+" "+i).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title"),a.Widget.prototype.destroy.call(this)},_setOption:function(b,c){a.Widget.prototype._setOption.apply(this,arguments);if(b==="disabled"){c?this.element.propAttr("disabled",!0):this.element.propAttr("disabled",!1);return}this._resetButton()},refresh:function(){var b=this.element.is(":disabled");b!==this.options.disabled&&this._setOption("disabled",b),this.type==="radio"?k(this.element[0]).each(function(){a(this).is(":checked")?a(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):a(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):this.type==="checkbox"&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if(this.type==="input"){this.options.label&&this.element.val(this.options.label);return}var b=this.buttonElement.removeClass(i),c=a("<span></span>",this.element[0].ownerDocument).addClass("ui-button-text").html(this.options.label).appendTo(b.empty()).text(),d=this.options.icons,e=d.primary&&d.secondary,f=[];d.primary||d.secondary?(this.options.text&&f.push("ui-button-text-icon"+(e?"s":d.primary?"-primary":"-secondary")),d.primary&&b.prepend("<span class='ui-button-icon-primary ui-icon "+d.primary+"'></span>"),d.secondary&&b.append("<span class='ui-button-icon-secondary ui-icon "+d.secondary+"'></span>"),this.options.text||(f.push(e?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||b.attr("title",c))):f.push("ui-button-text-only"),b.addClass(f.join(" "))}}),a.widget("ui.buttonset",{options:{items:":button, :submit, :reset, :checkbox, :radio, a, :data(button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(b,c){b==="disabled"&&this.buttons.button("option",b,c),a.Widget.prototype._setOption.apply(this,arguments)},refresh:function(){var b=this.element.css("direction")==="rtl";this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return a(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(b?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(b?"ui-corner-left":"ui-corner-right").end().end()},destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return a(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy"),a.Widget.prototype.destroy.call(this)}})})(jQuery);;/*! jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.ui.dialog.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){var c="ui-dialog ui-widget ui-widget-content ui-corner-all ",d={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},e={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0};a.widget("ui.dialog",{options:{autoOpen:!0,buttons:{},closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:!1,maxWidth:!1,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",collision:"fit",using:function(b){var c=a(this).css(b).offset().top;c<0&&a(this).css("top",b.top-c)}},resizable:!0,show:null,stack:!0,title:"",width:300,zIndex:1e3},_create:function(){this.originalTitle=this.element.attr("title"),typeof this.originalTitle!="string"&&(this.originalTitle=""),this.options.title=this.options.title||this.originalTitle;var b=this,d=b.options,e=d.title||"&#160;",f=a.ui.dialog.getTitleId(b.element),g=(b.uiDialog=a("<div></div>")).appendTo(document.body).hide().addClass(c+d.dialogClass).css({zIndex:d.zIndex}).attr("tabIndex",-1).css("outline",0).keydown(function(c){d.closeOnEscape&&!c.isDefaultPrevented()&&c.keyCode&&c.keyCode===a.ui.keyCode.ESCAPE&&(b.close(c),c.preventDefault())}).attr({role:"dialog","aria-labelledby":f}).mousedown(function(a){b.moveToTop(!1,a)}),h=b.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(g),i=(b.uiDialogTitlebar=a("<div></div>")).addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(g),j=a('<a href="#"></a>').addClass("ui-dialog-titlebar-close ui-corner-all").attr("role","button").hover(function(){j.addClass("ui-state-hover")},function(){j.removeClass("ui-state-hover")}).focus(function(){j.addClass("ui-state-focus")}).blur(function(){j.removeClass("ui-state-focus")}).click(function(a){return b.close(a),!1}).appendTo(i),k=(b.uiDialogTitlebarCloseText=a("<span></span>")).addClass("ui-icon ui-icon-closethick").text(d.closeText).appendTo(j),l=a("<span></span>").addClass("ui-dialog-title").attr("id",f).html(e).prependTo(i);a.isFunction(d.beforeclose)&&!a.isFunction(d.beforeClose)&&(d.beforeClose=d.beforeclose),i.find("*").add(i).disableSelection(),d.draggable&&a.fn.draggable&&b._makeDraggable(),d.resizable&&a.fn.resizable&&b._makeResizable(),b._createButtons(d.buttons),b._isOpen=!1,a.fn.bgiframe&&g.bgiframe()},_init:function(){this.options.autoOpen&&this.open()},destroy:function(){var a=this;return a.overlay&&a.overlay.destroy(),a.uiDialog.hide(),a.element.unbind(".dialog").removeData("dialog").removeClass("ui-dialog-content ui-widget-content").hide().appendTo("body"),a.uiDialog.remove(),a.originalTitle&&a.element.attr("title",a.originalTitle),a},widget:function(){return this.uiDialog},close:function(b){var c=this,d,e;if(!1===c._trigger("beforeClose",b))return;return c.overlay&&c.overlay.destroy(),c.uiDialog.unbind("keypress.ui-dialog"),c._isOpen=!1,c.options.hide?c.uiDialog.hide(c.options.hide,function(){c._trigger("close",b)}):(c.uiDialog.hide(),c._trigger("close",b)),a.ui.dialog.overlay.resize(),c.options.modal&&(d=0,a(".ui-dialog").each(function(){this!==c.uiDialog[0]&&(e=a(this).css("z-index"),isNaN(e)||(d=Math.max(d,e)))}),a.ui.dialog.maxZ=d),c},isOpen:function(){return this._isOpen},moveToTop:function(b,c){var d=this,e=d.options,f;return e.modal&&!b||!e.stack&&!e.modal?d._trigger("focus",c):(e.zIndex>a.ui.dialog.maxZ&&(a.ui.dialog.maxZ=e.zIndex),d.overlay&&(a.ui.dialog.maxZ+=1,d.overlay.$el.css("z-index",a.ui.dialog.overlay.maxZ=a.ui.dialog.maxZ)),f={scrollTop:d.element.scrollTop(),scrollLeft:d.element.scrollLeft()},a.ui.dialog.maxZ+=1,d.uiDialog.css("z-index",a.ui.dialog.maxZ),d.element.attr(f),d._trigger("focus",c),d)},open:function(){if(this._isOpen)return;var b=this,c=b.options,d=b.uiDialog;return b.overlay=c.modal?new a.ui.dialog.overlay(b):null,b._size(),b._position(c.position),d.show(c.show),b.moveToTop(!0),c.modal&&d.bind("keydown.ui-dialog",function(b){if(b.keyCode!==a.ui.keyCode.TAB)return;var c=a(":tabbable",this),d=c.filter(":first"),e=c.filter(":last");if(b.target===e[0]&&!b.shiftKey)return d.focus(1),!1;if(b.target===d[0]&&b.shiftKey)return e.focus(1),!1}),a(b.element.find(":tabbable").get().concat(d.find(".ui-dialog-buttonpane :tabbable").get().concat(d.get()))).eq(0).focus(),b._isOpen=!0,b._trigger("open"),b},_createButtons:function(b){var c=this,d=!1,e=a("<div></div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),f=a("<div></div>").addClass("ui-dialog-buttonset").appendTo(e);c.uiDialog.find(".ui-dialog-buttonpane").remove(),typeof b=="object"&&b!==null&&a.each(b,function(){return!(d=!0)}),d&&(a.each(b,function(b,d){d=a.isFunction(d)?{click:d,text:b}:d;var e=a('<button type="button"></button>').click(function(){d.click.apply(c.element[0],arguments)}).appendTo(f);a.each(d,function(a,b){if(a==="click")return;a in e?e[a](b):e.attr(a,b)}),a.fn.button&&e.button()}),e.appendTo(c.uiDialog))},_makeDraggable:function(){function f(a){return{position:a.position,offset:a.offset}}var b=this,c=b.options,d=a(document),e;b.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(d,g){e=c.height==="auto"?"auto":a(this).height(),a(this).height(a(this).height()).addClass("ui-dialog-dragging"),b._trigger("dragStart",d,f(g))},drag:function(a,c){b._trigger("drag",a,f(c))},stop:function(g,h){c.position=[h.position.left-d.scrollLeft(),h.position.top-d.scrollTop()],a(this).removeClass("ui-dialog-dragging").height(e),b._trigger("dragStop",g,f(h)),a.ui.dialog.overlay.resize()}})},_makeResizable:function(c){function h(a){return{originalPosition:a.originalPosition,originalSize:a.originalSize,position:a.position,size:a.size}}c=c===b?this.options.resizable:c;var d=this,e=d.options,f=d.uiDialog.css("position"),g=typeof c=="string"?c:"n,e,s,w,se,sw,ne,nw";d.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:d.element,maxWidth:e.maxWidth,maxHeight:e.maxHeight,minWidth:e.minWidth,minHeight:d._minHeight(),handles:g,start:function(b,c){a(this).addClass("ui-dialog-resizing"),d._trigger("resizeStart",b,h(c))},resize:function(a,b){d._trigger("resize",a,h(b))},stop:function(b,c){a(this).removeClass("ui-dialog-resizing"),e.height=a(this).height(),e.width=a(this).width(),d._trigger("resizeStop",b,h(c)),a.ui.dialog.overlay.resize()}}).css("position",f).find(".ui-resizable-se").addClass("ui-icon ui-icon-grip-diagonal-se")},_minHeight:function(){var a=this.options;return a.height==="auto"?a.minHeight:Math.min(a.minHeight,a.height)},_position:function(b){var c=[],d=[0,0],e;if(b){if(typeof b=="string"||typeof b=="object"&&"0"in b)c=b.split?b.split(" "):[b[0],b[1]],c.length===1&&(c[1]=c[0]),a.each(["left","top"],function(a,b){+c[a]===c[a]&&(d[a]=c[a],c[a]=b)}),b={my:c.join(" "),at:c.join(" "),offset:d.join(" ")};b=a.extend({},a.ui.dialog.prototype.options.position,b)}else b=a.ui.dialog.prototype.options.position;e=this.uiDialog.is(":visible"),e||this.uiDialog.show(),this.uiDialog.css({top:0,left:0}).position(a.extend({of:window},b)),e||this.uiDialog.hide()},_setOptions:function(b){var c=this,f={},g=!1;a.each(b,function(a,b){c._setOption(a,b),a in d&&(g=!0),a in e&&(f[a]=b)}),g&&this._size(),this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option",f)},_setOption:function(b,d){var e=this,f=e.uiDialog;switch(b){case"beforeclose":b="beforeClose";break;case"buttons":e._createButtons(d);break;case"closeText":e.uiDialogTitlebarCloseText.text(""+d);break;case"dialogClass":f.removeClass(e.options.dialogClass).addClass(c+d);break;case"disabled":d?f.addClass("ui-dialog-disabled"):f.removeClass("ui-dialog-disabled");break;case"draggable":var g=f.is(":data(draggable)");g&&!d&&f.draggable("destroy"),!g&&d&&e._makeDraggable();break;case"position":e._position(d);break;case"resizable":var h=f.is(":data(resizable)");h&&!d&&f.resizable("destroy"),h&&typeof d=="string"&&f.resizable("option","handles",d),!h&&d!==!1&&e._makeResizable(d);break;case"title":a(".ui-dialog-title",e.uiDialogTitlebar).html(""+(d||"&#160;"))}a.Widget.prototype._setOption.apply(e,arguments)},_size:function(){var b=this.options,c,d,e=this.uiDialog.is(":visible");this.element.show().css({width:"auto",minHeight:0,height:0}),b.minWidth>b.width&&(b.width=b.minWidth),c=this.uiDialog.css({height:"auto",width:b.width}).height(),d=Math.max(0,b.minHeight-c);if(b.height==="auto")if(a.support.minHeight)this.element.css({minHeight:d,height:"auto"});else{this.uiDialog.show();var f=this.element.css("height","auto").height();e||this.uiDialog.hide(),this.element.height(Math.max(f,d))}else this.element.height(Math.max(b.height-c,0));this.uiDialog.is(":data(resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())}}),a.extend(a.ui.dialog,{version:"1.8.23",uuid:0,maxZ:0,getTitleId:function(a){var b=a.attr("id");return b||(this.uuid+=1,b=this.uuid),"ui-dialog-title-"+b},overlay:function(b){this.$el=a.ui.dialog.overlay.create(b)}}),a.extend(a.ui.dialog.overlay,{instances:[],oldInstances:[],maxZ:0,events:a.map("focus,mousedown,mouseup,keydown,keypress,click".split(","),function(a){return a+".dialog-overlay"}).join(" "),create:function(b){this.instances.length===0&&(setTimeout(function(){a.ui.dialog.overlay.instances.length&&a(document).bind(a.ui.dialog.overlay.events,function(b){if(a(b.target).zIndex()<a.ui.dialog.overlay.maxZ)return!1})},1),a(document).bind("keydown.dialog-overlay",function(c){b.options.closeOnEscape&&!c.isDefaultPrevented()&&c.keyCode&&c.keyCode===a.ui.keyCode.ESCAPE&&(b.close(c),c.preventDefault())}),a(window).bind("resize.dialog-overlay",a.ui.dialog.overlay.resize));var c=(this.oldInstances.pop()||a("<div></div>").addClass("ui-widget-overlay")).appendTo(document.body).css({width:this.width(),height:this.height()});return a.fn.bgiframe&&c.bgiframe(),this.instances.push(c),c},destroy:function(b){var c=a.inArray(b,this.instances);c!=-1&&this.oldInstances.push(this.instances.splice(c,1)[0]),this.instances.length===0&&a([document,window]).unbind(".dialog-overlay"),b.remove();var d=0;a.each(this.instances,function(){d=Math.max(d,this.css("z-index"))}),this.maxZ=d},height:function(){var b,c;return a.browser.msie&&a.browser.version<7?(b=Math.max(document.documentElement.scrollHeight,document.body.scrollHeight),c=Math.max(document.documentElement.offsetHeight,document.body.offsetHeight),b<c?a(window).height()+"px":b+"px"):a(document).height()+"px"},width:function(){var b,c;return a.browser.msie?(b=Math.max(document.documentElement.scrollWidth,document.body.scrollWidth),c=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth),b<c?a(window).width()+"px":b+"px"):a(document).width()+"px"},resize:function(){var b=a([]);a.each(a.ui.dialog.overlay.instances,function(){b=b.add(this)}),b.css({width:0,height:0}).css({width:a.ui.dialog.overlay.width(),height:a.ui.dialog.overlay.height()})}}),a.extend(a.ui.dialog.overlay.prototype,{destroy:function(){a.ui.dialog.overlay.destroy(this.$el)}})})(jQuery);;/*! jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.ui.slider.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){var c=5;a.widget("ui.slider",a.ui.mouse,{widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null},_create:function(){var b=this,d=this.options,e=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),f="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",g=d.values&&d.values.length||1,h=[];this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"+(d.disabled?" ui-slider-disabled ui-disabled":"")),this.range=a([]),d.range&&(d.range===!0&&(d.values||(d.values=[this._valueMin(),this._valueMin()]),d.values.length&&d.values.length!==2&&(d.values=[d.values[0],d.values[0]])),this.range=a("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+(d.range==="min"||d.range==="max"?" ui-slider-range-"+d.range:"")));for(var i=e.length;i<g;i+=1)h.push(f);this.handles=e.add(a(h.join("")).appendTo(b.element)),this.handle=this.handles.eq(0),this.handles.add(this.range).filter("a").click(function(a){a.preventDefault()}).hover(function(){d.disabled||a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")}).focus(function(){d.disabled?a(this).blur():(a(".ui-slider .ui-state-focus").removeClass("ui-state-focus"),a(this).addClass("ui-state-focus"))}).blur(function(){a(this).removeClass("ui-state-focus")}),this.handles.each(function(b){a(this).data("index.ui-slider-handle",b)}),this.handles.keydown(function(d){var e=a(this).data("index.ui-slider-handle"),f,g,h,i;if(b.options.disabled)return;switch(d.keyCode){case a.ui.keyCode.HOME:case a.ui.keyCode.END:case a.ui.keyCode.PAGE_UP:case a.ui.keyCode.PAGE_DOWN:case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:d.preventDefault();if(!b._keySliding){b._keySliding=!0,a(this).addClass("ui-state-active"),f=b._start(d,e);if(f===!1)return}}i=b.options.step,b.options.values&&b.options.values.length?g=h=b.values(e):g=h=b.value();switch(d.keyCode){case a.ui.keyCode.HOME:h=b._valueMin();break;case a.ui.keyCode.END:h=b._valueMax();break;case a.ui.keyCode.PAGE_UP:h=b._trimAlignValue(g+(b._valueMax()-b._valueMin())/c);break;case a.ui.keyCode.PAGE_DOWN:h=b._trimAlignValue(g-(b._valueMax()-b._valueMin())/c);break;case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:if(g===b._valueMax())return;h=b._trimAlignValue(g+i);break;case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:if(g===b._valueMin())return;h=b._trimAlignValue(g-i)}b._slide(d,e,h)}).keyup(function(c){var d=a(this).data("index.ui-slider-handle");b._keySliding&&(b._keySliding=!1,b._stop(c,d),b._change(c,d),a(this).removeClass("ui-state-active"))}),this._refreshValue(),this._animateOff=!1},destroy:function(){return this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all").removeData("slider").unbind(".slider"),this._mouseDestroy(),this},_mouseCapture:function(b){var c=this.options,d,e,f,g,h,i,j,k,l;return c.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),d={x:b.pageX,y:b.pageY},e=this._normValueFromMouse(d),f=this._valueMax()-this._valueMin()+1,h=this,this.handles.each(function(b){var c=Math.abs(e-h.values(b));f>c&&(f=c,g=a(this),i=b)}),c.range===!0&&this.values(1)===c.min&&(i+=1,g=a(this.handles[i])),j=this._start(b,i),j===!1?!1:(this._mouseSliding=!0,h._handleIndex=i,g.addClass("ui-state-active").focus(),k=g.offset(),l=!a(b.target).parents().andSelf().is(".ui-slider-handle"),this._clickOffset=l?{left:0,top:0}:{left:b.pageX-k.left-g.width()/2,top:b.pageY-k.top-g.height()/2-(parseInt(g.css("borderTopWidth"),10)||0)-(parseInt(g.css("borderBottomWidth"),10)||0)+(parseInt(g.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(b,i,e),this._animateOff=!0,!0))},_mouseStart:function(a){return!0},_mouseDrag:function(a){var b={x:a.pageX,y:a.pageY},c=this._normValueFromMouse(b);return this._slide(a,this._handleIndex,c),!1},_mouseStop:function(a){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(a,this._handleIndex),this._change(a,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation=this.options.orientation==="vertical"?"vertical":"horizontal"},_normValueFromMouse:function(a){var b,c,d,e,f;return this.orientation==="horizontal"?(b=this.elementSize.width,c=a.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(b=this.elementSize.height,c=a.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),d=c/b,d>1&&(d=1),d<0&&(d=0),this.orientation==="vertical"&&(d=1-d),e=this._valueMax()-this._valueMin(),f=this._valueMin()+d*e,this._trimAlignValue(f)},_start:function(a,b){var c={handle:this.handles[b],value:this.value()};return this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._trigger("start",a,c)},_slide:function(a,b,c){var d,e,f;this.options.values&&this.options.values.length?(d=this.values(b?0:1),this.options.values.length===2&&this.options.range===!0&&(b===0&&c>d||b===1&&c<d)&&(c=d),c!==this.values(b)&&(e=this.values(),e[b]=c,f=this._trigger("slide",a,{handle:this.handles[b],value:c,values:e}),d=this.values(b?0:1),f!==!1&&this.values(b,c,!0))):c!==this.value()&&(f=this._trigger("slide",a,{handle:this.handles[b],value:c}),f!==!1&&this.value(c))},_stop:function(a,b){var c={handle:this.handles[b],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._trigger("stop",a,c)},_change:function(a,b){if(!this._keySliding&&!this._mouseSliding){var c={handle:this.handles[b],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._trigger("change",a,c)}},value:function(a){if(arguments.length){this.options.value=this._trimAlignValue(a),this._refreshValue(),this._change(null,0);return}return this._value()},values:function(b,c){var d,e,f;if(arguments.length>1){this.options.values[b]=this._trimAlignValue(c),this._refreshValue(),this._change(null,b);return}if(!arguments.length)return this._values();if(!a.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(b):this.value();d=this.options.values,e=arguments[0];for(f=0;f<d.length;f+=1)d[f]=this._trimAlignValue(e[f]),this._change(null,f);this._refreshValue()},_setOption:function(b,c){var d,e=0;a.isArray(this.options.values)&&(e=this.options.values.length),a.Widget.prototype._setOption.apply(this,arguments);switch(b){case"disabled":c?(this.handles.filter(".ui-state-focus").blur(),this.handles.removeClass("ui-state-hover"),this.handles.propAttr("disabled",!0),this.element.addClass("ui-disabled")):(this.handles.propAttr("disabled",!1),this.element.removeClass("ui-disabled"));break;case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":this._animateOff=!0,this._refreshValue();for(d=0;d<e;d+=1)this._change(null,d);this._animateOff=!1}},_value:function(){var a=this.options.value;return a=this._trimAlignValue(a),a},_values:function(a){var b,c,d;if(arguments.length)return b=this.options.values[a],b=this._trimAlignValue(b),b;c=this.options.values.slice();for(d=0;d<c.length;d+=1)c[d]=this._trimAlignValue(c[d]);return c},_trimAlignValue:function(a){if(a<=this._valueMin())return this._valueMin();if(a>=this._valueMax())return this._valueMax();var b=this.options.step>0?this.options.step:1,c=(a-this._valueMin())%b,d=a-c;return Math.abs(c)*2>=b&&(d+=c>0?b:-b),parseFloat(d.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var b=this.options.range,c=this.options,d=this,e=this._animateOff?!1:c.animate,f,g={},h,i,j,k;this.options.values&&this.options.values.length?this.handles.each(function(b,i){f=(d.values(b)-d._valueMin())/(d._valueMax()-d._valueMin())*100,g[d.orientation==="horizontal"?"left":"bottom"]=f+"%",a(this).stop(1,1)[e?"animate":"css"](g,c.animate),d.options.range===!0&&(d.orientation==="horizontal"?(b===0&&d.range.stop(1,1)[e?"animate":"css"]({left:f+"%"},c.animate),b===1&&d.range[e?"animate":"css"]({width:f-h+"%"},{queue:!1,duration:c.animate})):(b===0&&d.range.stop(1,1)[e?"animate":"css"]({bottom:f+"%"},c.animate),b===1&&d.range[e?"animate":"css"]({height:f-h+"%"},{queue:!1,duration:c.animate}))),h=f}):(i=this.value(),j=this._valueMin(),k=this._valueMax(),f=k!==j?(i-j)/(k-j)*100:0,g[d.orientation==="horizontal"?"left":"bottom"]=f+"%",this.handle.stop(1,1)[e?"animate":"css"](g,c.animate),b==="min"&&this.orientation==="horizontal"&&this.range.stop(1,1)[e?"animate":"css"]({width:f+"%"},c.animate),b==="max"&&this.orientation==="horizontal"&&this.range[e?"animate":"css"]({width:100-f+"%"},{queue:!1,duration:c.animate}),b==="min"&&this.orientation==="vertical"&&this.range.stop(1,1)[e?"animate":"css"]({height:f+"%"},c.animate),b==="max"&&this.orientation==="vertical"&&this.range[e?"animate":"css"]({height:100-f+"%"},{queue:!1,duration:c.animate}))}}),a.extend(a.ui.slider,{version:"1.8.23"})})(jQuery);;/*! jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.ui.tabs.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){function e(){return++c}function f(){return++d}var c=0,d=0;a.widget("ui.tabs",{options:{add:null,ajaxOptions:null,cache:!1,cookie:null,collapsible:!1,disable:null,disabled:[],enable:null,event:"click",fx:null,idPrefix:"ui-tabs-",load:null,panelTemplate:"<div></div>",remove:null,select:null,show:null,spinner:"<em>Loading&#8230;</em>",tabTemplate:"<li><a href='#{href}'><span>#{label}</span></a></li>"},_create:function(){this._tabify(!0)},_setOption:function(a,b){if(a=="selected"){if(this.options.collapsible&&b==this.options.selected)return;this.select(b)}else this.options[a]=b,this._tabify()},_tabId:function(a){return a.title&&a.title.replace(/\s/g,"_").replace(/[^\w\u00c0-\uFFFF-]/g,"")||this.options.idPrefix+e()},_sanitizeSelector:function(a){return a.replace(/:/g,"\\:")},_cookie:function(){var b=this.cookie||(this.cookie=this.options.cookie.name||"ui-tabs-"+f());return a.cookie.apply(null,[b].concat(a.makeArray(arguments)))},_ui:function(a,b){return{tab:a,panel:b,index:this.anchors.index(a)}},_cleanup:function(){this.lis.filter(".ui-state-processing").removeClass("ui-state-processing").find("span:data(label.tabs)").each(function(){var b=a(this);b.html(b.data("label.tabs")).removeData("label.tabs")})},_tabify:function(c){function m(b,c){b.css("display",""),!a.support.opacity&&c.opacity&&b[0].style.removeAttribute("filter")}var d=this,e=this.options,f=/^#.+/;this.list=this.element.find("ol,ul").eq(0),this.lis=a(" > li:has(a[href])",this.list),this.anchors=this.lis.map(function(){return a("a",this)[0]}),this.panels=a([]),this.anchors.each(function(b,c){var g=a(c).attr("href"),h=g.split("#")[0],i;h&&(h===location.toString().split("#")[0]||(i=a("base")[0])&&h===i.href)&&(g=c.hash,c.href=g);if(f.test(g))d.panels=d.panels.add(d.element.find(d._sanitizeSelector(g)));else if(g&&g!=="#"){a.data(c,"href.tabs",g),a.data(c,"load.tabs",g.replace(/#.*$/,""));var j=d._tabId(c);c.href="#"+j;var k=d.element.find("#"+j);k.length||(k=a(e.panelTemplate).attr("id",j).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").insertAfter(d.panels[b-1]||d.list),k.data("destroy.tabs",!0)),d.panels=d.panels.add(k)}else e.disabled.push(b)}),c?(this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all"),this.list.addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all"),this.lis.addClass("ui-state-default ui-corner-top"),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom"),e.selected===b?(location.hash&&this.anchors.each(function(a,b){if(b.hash==location.hash)return e.selected=a,!1}),typeof e.selected!="number"&&e.cookie&&(e.selected=parseInt(d._cookie(),10)),typeof e.selected!="number"&&this.lis.filter(".ui-tabs-selected").length&&(e.selected=this.lis.index(this.lis.filter(".ui-tabs-selected"))),e.selected=e.selected||(this.lis.length?0:-1)):e.selected===null&&(e.selected=-1),e.selected=e.selected>=0&&this.anchors[e.selected]||e.selected<0?e.selected:0,e.disabled=a.unique(e.disabled.concat(a.map(this.lis.filter(".ui-state-disabled"),function(a,b){return d.lis.index(a)}))).sort(),a.inArray(e.selected,e.disabled)!=-1&&e.disabled.splice(a.inArray(e.selected,e.disabled),1),this.panels.addClass("ui-tabs-hide"),this.lis.removeClass("ui-tabs-selected ui-state-active"),e.selected>=0&&this.anchors.length&&(d.element.find(d._sanitizeSelector(d.anchors[e.selected].hash)).removeClass("ui-tabs-hide"),this.lis.eq(e.selected).addClass("ui-tabs-selected ui-state-active"),d.element.queue("tabs",function(){d._trigger("show",null,d._ui(d.anchors[e.selected],d.element.find(d._sanitizeSelector(d.anchors[e.selected].hash))[0]))}),this.load(e.selected)),a(window).bind("unload",function(){d.lis.add(d.anchors).unbind(".tabs"),d.lis=d.anchors=d.panels=null})):e.selected=this.lis.index(this.lis.filter(".ui-tabs-selected")),this.element[e.collapsible?"addClass":"removeClass"]("ui-tabs-collapsible"),e.cookie&&this._cookie(e.selected,e.cookie);for(var g=0,h;h=this.lis[g];g++)a(h)[a.inArray(g,e.disabled)!=-1&&!a(h).hasClass("ui-tabs-selected")?"addClass":"removeClass"]("ui-state-disabled");e.cache===!1&&this.anchors.removeData("cache.tabs"),this.lis.add(this.anchors).unbind(".tabs");if(e.event!=="mouseover"){var i=function(a,b){b.is(":not(.ui-state-disabled)")&&b.addClass("ui-state-"+a)},j=function(a,b){b.removeClass("ui-state-"+a)};this.lis.bind("mouseover.tabs",function(){i("hover",a(this))}),this.lis.bind("mouseout.tabs",function(){j("hover",a(this))}),this.anchors.bind("focus.tabs",function(){i("focus",a(this).closest("li"))}),this.anchors.bind("blur.tabs",function(){j("focus",a(this).closest("li"))})}var k,l;e.fx&&(a.isArray(e.fx)?(k=e.fx[0],l=e.fx[1]):k=l=e.fx);var n=l?function(b,c){a(b).closest("li").addClass("ui-tabs-selected ui-state-active"),c.hide().removeClass("ui-tabs-hide").animate(l,l.duration||"normal",function(){m(c,l),d._trigger("show",null,d._ui(b,c[0]))})}:function(b,c){a(b).closest("li").addClass("ui-tabs-selected ui-state-active"),c.removeClass("ui-tabs-hide"),d._trigger("show",null,d._ui(b,c[0]))},o=k?function(a,b){b.animate(k,k.duration||"normal",function(){d.lis.removeClass("ui-tabs-selected ui-state-active"),b.addClass("ui-tabs-hide"),m(b,k),d.element.dequeue("tabs")})}:function(a,b,c){d.lis.removeClass("ui-tabs-selected ui-state-active"),b.addClass("ui-tabs-hide"),d.element.dequeue("tabs")};this.anchors.bind(e.event+".tabs",function(){var b=this,c=a(b).closest("li"),f=d.panels.filter(":not(.ui-tabs-hide)"),g=d.element.find(d._sanitizeSelector(b.hash));if(c.hasClass("ui-tabs-selected")&&!e.collapsible||c.hasClass("ui-state-disabled")||c.hasClass("ui-state-processing")||d.panels.filter(":animated").length||d._trigger("select",null,d._ui(this,g[0]))===!1)return this.blur(),!1;e.selected=d.anchors.index(this),d.abort();if(e.collapsible){if(c.hasClass("ui-tabs-selected"))return e.selected=-1,e.cookie&&d._cookie(e.selected,e.cookie),d.element.queue("tabs",function(){o(b,f)}).dequeue("tabs"),this.blur(),!1;if(!f.length)return e.cookie&&d._cookie(e.selected,e.cookie),d.element.queue("tabs",function(){n(b,g)}),d.load(d.anchors.index(this)),this.blur(),!1}e.cookie&&d._cookie(e.selected,e.cookie);if(g.length)f.length&&d.element.queue("tabs",function(){o(b,f)}),d.element.queue("tabs",function(){n(b,g)}),d.load(d.anchors.index(this));else throw"jQuery UI Tabs: Mismatching fragment identifier.";a.browser.msie&&this.blur()}),this.anchors.bind("click.tabs",function(){return!1})},_getIndex:function(a){return typeof a=="string"&&(a=this.anchors.index(this.anchors.filter("[href$='"+a+"']"))),a},destroy:function(){var b=this.options;return this.abort(),this.element.unbind(".tabs").removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible").removeData("tabs"),this.list.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all"),this.anchors.each(function(){var b=a.data(this,"href.tabs");b&&(this.href=b);var c=a(this).unbind(".tabs");a.each(["href","load","cache"],function(a,b){c.removeData(b+".tabs")})}),this.lis.unbind(".tabs").add(this.panels).each(function(){a.data(this,"destroy.tabs")?a(this).remove():a(this).removeClass(["ui-state-default","ui-corner-top","ui-tabs-selected","ui-state-active","ui-state-hover","ui-state-focus","ui-state-disabled","ui-tabs-panel","ui-widget-content","ui-corner-bottom","ui-tabs-hide"].join(" "))}),b.cookie&&this._cookie(null,b.cookie),this},add:function(c,d,e){e===b&&(e=this.anchors.length);var f=this,g=this.options,h=a(g.tabTemplate.replace(/#\{href\}/g,c).replace(/#\{label\}/g,d)),i=c.indexOf("#")?this._tabId(a("a",h)[0]):c.replace("#","");h.addClass("ui-state-default ui-corner-top").data("destroy.tabs",!0);var j=f.element.find("#"+i);return j.length||(j=a(g.panelTemplate).attr("id",i).data("destroy.tabs",!0)),j.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"),e>=this.lis.length?(h.appendTo(this.list),j.appendTo(this.list[0].parentNode)):(h.insertBefore(this.lis[e]),j.insertBefore(this.panels[e])),g.disabled=a.map(g.disabled,function(a,b){return a>=e?++a:a}),this._tabify(),this.anchors.length==1&&(g.selected=0,h.addClass("ui-tabs-selected ui-state-active"),j.removeClass("ui-tabs-hide"),this.element.queue("tabs",function(){f._trigger("show",null,f._ui(f.anchors[0],f.panels[0]))}),this.load(0)),this._trigger("add",null,this._ui(this.anchors[e],this.panels[e])),this},remove:function(b){b=this._getIndex(b);var c=this.options,d=this.lis.eq(b).remove(),e=this.panels.eq(b).remove();return d.hasClass("ui-tabs-selected")&&this.anchors.length>1&&this.select(b+(b+1<this.anchors.length?1:-1)),c.disabled=a.map(a.grep(c.disabled,function(a,c){return a!=b}),function(a,c){return a>=b?--a:a}),this._tabify(),this._trigger("remove",null,this._ui(d.find("a")[0],e[0])),this},enable:function(b){b=this._getIndex(b);var c=this.options;if(a.inArray(b,c.disabled)==-1)return;return this.lis.eq(b).removeClass("ui-state-disabled"),c.disabled=a.grep(c.disabled,function(a,c){return a!=b}),this._trigger("enable",null,this._ui(this.anchors[b],this.panels[b])),this},disable:function(a){a=this._getIndex(a);var b=this,c=this.options;return a!=c.selected&&(this.lis.eq(a).addClass("ui-state-disabled"),c.disabled.push(a),c.disabled.sort(),this._trigger("disable",null,this._ui(this.anchors[a],this.panels[a]))),this},select:function(a){a=this._getIndex(a);if(a==-1)if(this.options.collapsible&&this.options.selected!=-1)a=this.options.selected;else return this;return this.anchors.eq(a).trigger(this.options.event+".tabs"),this},load:function(b){b=this._getIndex(b);var c=this,d=this.options,e=this.anchors.eq(b)[0],f=a.data(e,"load.tabs");this.abort();if(!f||this.element.queue("tabs").length!==0&&a.data(e,"cache.tabs")){this.element.dequeue("tabs");return}this.lis.eq(b).addClass("ui-state-processing");if(d.spinner){var g=a("span",e);g.data("label.tabs",g.html()).html(d.spinner)}return this.xhr=a.ajax(a.extend({},d.ajaxOptions,{url:f,success:function(f,g){c.element.find(c._sanitizeSelector(e.hash)).html(f),c._cleanup(),d.cache&&a.data(e,"cache.tabs",!0),c._trigger("load",null,c._ui(c.anchors[b],c.panels[b]));try{d.ajaxOptions.success(f,g)}catch(h){}},error:function(a,f,g){c._cleanup(),c._trigger("load",null,c._ui(c.anchors[b],c.panels[b]));try{d.ajaxOptions.error(a,f,b,e)}catch(g){}}})),c.element.dequeue("tabs"),this},abort:function(){return this.element.queue([]),this.panels.stop(!1,!0),this.element.queue("tabs",this.element.queue("tabs").splice(-2,2)),this.xhr&&(this.xhr.abort(),delete this.xhr),this._cleanup(),this},url:function(a,b){return this.anchors.eq(a).removeData("cache.tabs").data("load.tabs",b),this},length:function(){return this.anchors.length}}),a.extend(a.ui.tabs,{version:"1.8.23"}),a.extend(a.ui.tabs.prototype,{rotation:null,rotate:function(a,b){var c=this,d=this.options,e=c._rotate||(c._rotate=function(b){clearTimeout(c.rotation),c.rotation=setTimeout(function(){var a=d.selected;c.select(++a<c.anchors.length?a:0)},a),b&&b.stopPropagation()}),f=c._unrotate||(c._unrotate=b?function(a){e()}:function(a){a.clientX&&c.rotate(null)});return a?(this.element.bind("tabsshow",e),this.anchors.bind(d.event+".tabs",f),e()):(clearTimeout(c.rotation),this.element.unbind("tabsshow",e),this.anchors.unbind(d.event+".tabs",f),delete this._rotate,delete this._unrotate),this}})})(jQuery);;/*! jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.ui.datepicker.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function($,undefined){function Datepicker(){this.debug=!1,this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},$.extend(this._defaults,this.regional[""]),this.dpDiv=bindHover($('<div id="'+this._mainDivId+'" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'))}function bindHover(a){var b="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return a.bind("mouseout",function(a){var c=$(a.target).closest(b);if(!c.length)return;c.removeClass("ui-state-hover ui-datepicker-prev-hover ui-datepicker-next-hover")}).bind("mouseover",function(c){var d=$(c.target).closest(b);if($.datepicker._isDisabledDatepicker(instActive.inline?a.parent()[0]:instActive.input[0])||!d.length)return;d.parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),d.addClass("ui-state-hover"),d.hasClass("ui-datepicker-prev")&&d.addClass("ui-datepicker-prev-hover"),d.hasClass("ui-datepicker-next")&&d.addClass("ui-datepicker-next-hover")})}function extendRemove(a,b){$.extend(a,b);for(var c in b)if(b[c]==null||b[c]==undefined)a[c]=b[c];return a}function isArray(a){return a&&($.browser.safari&&typeof a=="object"&&a.length||a.constructor&&a.constructor.toString().match(/\Array\(\)/))}$.extend($.ui,{datepicker:{version:"1.8.23"}});var PROP_NAME="datepicker",dpuuid=(new Date).getTime(),instActive;$.extend(Datepicker.prototype,{markerClassName:"hasDatepicker",maxRows:4,log:function(){this.debug&&console.log.apply("",arguments)},_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(a){return extendRemove(this._defaults,a||{}),this},_attachDatepicker:function(target,settings){var inlineSettings=null;for(var attrName in this._defaults){var attrValue=target.getAttribute("date:"+attrName);if(attrValue){inlineSettings=inlineSettings||{};try{inlineSettings[attrName]=eval(attrValue)}catch(err){inlineSettings[attrName]=attrValue}}}var nodeName=target.nodeName.toLowerCase(),inline=nodeName=="div"||nodeName=="span";target.id||(this.uuid+=1,target.id="dp"+this.uuid);var inst=this._newInst($(target),inline);inst.settings=$.extend({},settings||{},inlineSettings||{}),nodeName=="input"?this._connectDatepicker(target,inst):inline&&this._inlineDatepicker(target,inst)},_newInst:function(a,b){var c=a[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1");return{id:c,input:a,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:b,dpDiv:b?bindHover($('<div class="'+this._inlineClass+' ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>')):this.dpDiv}},_connectDatepicker:function(a,b){var c=$(a);b.append=$([]),b.trigger=$([]);if(c.hasClass(this.markerClassName))return;this._attachments(c,b),c.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp).bind("setData.datepicker",function(a,c,d){b.settings[c]=d}).bind("getData.datepicker",function(a,c){return this._get(b,c)}),this._autoSize(b),$.data(a,PROP_NAME,b),b.settings.disabled&&this._disableDatepicker(a)},_attachments:function(a,b){var c=this._get(b,"appendText"),d=this._get(b,"isRTL");b.append&&b.append.remove(),c&&(b.append=$('<span class="'+this._appendClass+'">'+c+"</span>"),a[d?"before":"after"](b.append)),a.unbind("focus",this._showDatepicker),b.trigger&&b.trigger.remove();var e=this._get(b,"showOn");(e=="focus"||e=="both")&&a.focus(this._showDatepicker);if(e=="button"||e=="both"){var f=this._get(b,"buttonText"),g=this._get(b,"buttonImage");b.trigger=$(this._get(b,"buttonImageOnly")?$("<img/>").addClass(this._triggerClass).attr({src:g,alt:f,title:f}):$('<button type="button"></button>').addClass(this._triggerClass).html(g==""?f:$("<img/>").attr({src:g,alt:f,title:f}))),a[d?"before":"after"](b.trigger),b.trigger.click(function(){return $.datepicker._datepickerShowing&&$.datepicker._lastInput==a[0]?$.datepicker._hideDatepicker():$.datepicker._datepickerShowing&&$.datepicker._lastInput!=a[0]?($.datepicker._hideDatepicker(),$.datepicker._showDatepicker(a[0])):$.datepicker._showDatepicker(a[0]),!1})}},_autoSize:function(a){if(this._get(a,"autoSize")&&!a.inline){var b=new Date(2009,11,20),c=this._get(a,"dateFormat");if(c.match(/[DM]/)){var d=function(a){var b=0,c=0;for(var d=0;d<a.length;d++)a[d].length>b&&(b=a[d].length,c=d);return c};b.setMonth(d(this._get(a,c.match(/MM/)?"monthNames":"monthNamesShort"))),b.setDate(d(this._get(a,c.match(/DD/)?"dayNames":"dayNamesShort"))+20-b.getDay())}a.input.attr("size",this._formatDate(a,b).length)}},_inlineDatepicker:function(a,b){var c=$(a);if(c.hasClass(this.markerClassName))return;c.addClass(this.markerClassName).append(b.dpDiv).bind("setData.datepicker",function(a,c,d){b.settings[c]=d}).bind("getData.datepicker",function(a,c){return this._get(b,c)}),$.data(a,PROP_NAME,b),this._setDate(b,this._getDefaultDate(b),!0),this._updateDatepicker(b),this._updateAlternate(b),b.settings.disabled&&this._disableDatepicker(a),b.dpDiv.css("display","block")},_dialogDatepicker:function(a,b,c,d,e){var f=this._dialogInst;if(!f){this.uuid+=1;var g="dp"+this.uuid;this._dialogInput=$('<input type="text" id="'+g+'" style="position: absolute; top: -100px; width: 0px;"/>'),this._dialogInput.keydown(this._doKeyDown),$("body").append(this._dialogInput),f=this._dialogInst=this._newInst(this._dialogInput,!1),f.settings={},$.data(this._dialogInput[0],PROP_NAME,f)}extendRemove(f.settings,d||{}),b=b&&b.constructor==Date?this._formatDate(f,b):b,this._dialogInput.val(b),this._pos=e?e.length?e:[e.pageX,e.pageY]:null;if(!this._pos){var h=document.documentElement.clientWidth,i=document.documentElement.clientHeight,j=document.documentElement.scrollLeft||document.body.scrollLeft,k=document.documentElement.scrollTop||document.body.scrollTop;this._pos=[h/2-100+j,i/2-150+k]}return this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),f.settings.onSelect=c,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),$.blockUI&&$.blockUI(this.dpDiv),$.data(this._dialogInput[0],PROP_NAME,f),this},_destroyDatepicker:function(a){var b=$(a),c=$.data(a,PROP_NAME);if(!b.hasClass(this.markerClassName))return;var d=a.nodeName.toLowerCase();$.removeData(a,PROP_NAME),d=="input"?(c.append.remove(),c.trigger.remove(),b.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):(d=="div"||d=="span")&&b.removeClass(this.markerClassName).empty()},_enableDatepicker:function(a){var b=$(a),c=$.data(a,PROP_NAME);if(!b.hasClass(this.markerClassName))return;var d=a.nodeName.toLowerCase();if(d=="input")a.disabled=!1,c.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""});else if(d=="div"||d=="span"){var e=b.children("."+this._inlineClass);e.children().removeClass("ui-state-disabled"),e.find("select.ui-datepicker-month, select.ui-datepicker-year").removeAttr("disabled")}this._disabledInputs=$.map(this._disabledInputs,function(b){return b==a?null:b})},_disableDatepicker:function(a){var b=$(a),c=$.data(a,PROP_NAME);if(!b.hasClass(this.markerClassName))return;var d=a.nodeName.toLowerCase();if(d=="input")a.disabled=!0,c.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"});else if(d=="div"||d=="span"){var e=b.children("."+this._inlineClass);e.children().addClass("ui-state-disabled"),e.find("select.ui-datepicker-month, select.ui-datepicker-year").attr("disabled","disabled")}this._disabledInputs=$.map(this._disabledInputs,function(b){return b==a?null:b}),this._disabledInputs[this._disabledInputs.length]=a},_isDisabledDatepicker:function(a){if(!a)return!1;for(var b=0;b<this._disabledInputs.length;b++)if(this._disabledInputs[b]==a)return!0;return!1},_getInst:function(a){try{return $.data(a,PROP_NAME)}catch(b){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(a,b,c){var d=this._getInst(a);if(arguments.length==2&&typeof b=="string")return b=="defaults"?$.extend({},$.datepicker._defaults):d?b=="all"?$.extend({},d.settings):this._get(d,b):null;var e=b||{};typeof b=="string"&&(e={},e[b]=c);if(d){this._curInst==d&&this._hideDatepicker();var f=this._getDateDatepicker(a,!0),g=this._getMinMaxDate(d,"min"),h=this._getMinMaxDate(d,"max");extendRemove(d.settings,e),g!==null&&e.dateFormat!==undefined&&e.minDate===undefined&&(d.settings.minDate=this._formatDate(d,g)),h!==null&&e.dateFormat!==undefined&&e.maxDate===undefined&&(d.settings.maxDate=this._formatDate(d,h)),this._attachments($(a),d),this._autoSize(d),this._setDate(d,f),this._updateAlternate(d),this._updateDatepicker(d)}},_changeDatepicker:function(a,b,c){this._optionDatepicker(a,b,c)},_refreshDatepicker:function(a){var b=this._getInst(a);b&&this._updateDatepicker(b)},_setDateDatepicker:function(a,b){var c=this._getInst(a);c&&(this._setDate(c,b),this._updateDatepicker(c),this._updateAlternate(c))},_getDateDatepicker:function(a,b){var c=this._getInst(a);return c&&!c.inline&&this._setDateFromField(c,b),c?this._getDate(c):null},_doKeyDown:function(a){var b=$.datepicker._getInst(a.target),c=!0,d=b.dpDiv.is(".ui-datepicker-rtl");b._keyEvent=!0;if($.datepicker._datepickerShowing)switch(a.keyCode){case 9:$.datepicker._hideDatepicker(),c=!1;break;case 13:var e=$("td."+$.datepicker._dayOverClass+":not(."+$.datepicker._currentClass+")",b.dpDiv);e[0]&&$.datepicker._selectDay(a.target,b.selectedMonth,b.selectedYear,e[0]);var f=$.datepicker._get(b,"onSelect");if(f){var g=$.datepicker._formatDate(b);f.apply(b.input?b.input[0]:null,[g,b])}else $.datepicker._hideDatepicker();return!1;case 27:$.datepicker._hideDatepicker();break;case 33:$.datepicker._adjustDate(a.target,a.ctrlKey?-$.datepicker._get(b,"stepBigMonths"):-$.datepicker._get(b,"stepMonths"),"M");break;case 34:$.datepicker._adjustDate(a.target,a.ctrlKey?+$.datepicker._get(b,"stepBigMonths"):+$.datepicker._get(b,"stepMonths"),"M");break;case 35:(a.ctrlKey||a.metaKey)&&$.datepicker._clearDate(a.target),c=a.ctrlKey||a.metaKey;break;case 36:(a.ctrlKey||a.metaKey)&&$.datepicker._gotoToday(a.target),c=a.ctrlKey||a.metaKey;break;case 37:(a.ctrlKey||a.metaKey)&&$.datepicker._adjustDate(a.target,d?1:-1,"D"),c=a.ctrlKey||a.metaKey,a.originalEvent.altKey&&$.datepicker._adjustDate(a.target,a.ctrlKey?-$.datepicker._get(b,"stepBigMonths"):-$.datepicker._get(b,"stepMonths"),"M");break;case 38:(a.ctrlKey||a.metaKey)&&$.datepicker._adjustDate(a.target,-7,"D"),c=a.ctrlKey||a.metaKey;break;case 39:(a.ctrlKey||a.metaKey)&&$.datepicker._adjustDate(a.target,d?-1:1,"D"),c=a.ctrlKey||a.metaKey,a.originalEvent.altKey&&$.datepicker._adjustDate(a.target,a.ctrlKey?+$.datepicker._get(b,"stepBigMonths"):+$.datepicker._get(b,"stepMonths"),"M");break;case 40:(a.ctrlKey||a.metaKey)&&$.datepicker._adjustDate(a.target,7,"D"),c=a.ctrlKey||a.metaKey;break;default:c=!1}else a.keyCode==36&&a.ctrlKey?$.datepicker._showDatepicker(this):c=!1;c&&(a.preventDefault(),a.stopPropagation())},_doKeyPress:function(a){var b=$.datepicker._getInst(a.target);if($.datepicker._get(b,"constrainInput")){var c=$.datepicker._possibleChars($.datepicker._get(b,"dateFormat")),d=String.fromCharCode(a.charCode==undefined?a.keyCode:a.charCode);return a.ctrlKey||a.metaKey||d<" "||!c||c.indexOf(d)>-1}},_doKeyUp:function(a){var b=$.datepicker._getInst(a.target);if(b.input.val()!=b.lastVal)try{var c=$.datepicker.parseDate($.datepicker._get(b,"dateFormat"),b.input?b.input.val():null,$.datepicker._getFormatConfig(b));c&&($.datepicker._setDateFromField(b),$.datepicker._updateAlternate(b),$.datepicker._updateDatepicker(b))}catch(d){$.datepicker.log(d)}return!0},_showDatepicker:function(a){a=a.target||a,a.nodeName.toLowerCase()!="input"&&(a=$("input",a.parentNode)[0]);if($.datepicker._isDisabledDatepicker(a)||$.datepicker._lastInput==a)return;var b=$.datepicker._getInst(a);$.datepicker._curInst&&$.datepicker._curInst!=b&&($.datepicker._curInst.dpDiv.stop(!0,!0),b&&$.datepicker._datepickerShowing&&$.datepicker._hideDatepicker($.datepicker._curInst.input[0]));var c=$.datepicker._get(b,"beforeShow"),d=c?c.apply(a,[a,b]):{};if(d===!1)return;extendRemove(b.settings,d),b.lastVal=null,$.datepicker._lastInput=a,$.datepicker._setDateFromField(b),$.datepicker._inDialog&&(a.value=""),$.datepicker._pos||($.datepicker._pos=$.datepicker._findPos(a),$.datepicker._pos[1]+=a.offsetHeight);var e=!1;$(a).parents().each(function(){return e|=$(this).css("position")=="fixed",!e}),e&&$.browser.opera&&($.datepicker._pos[0]-=document.documentElement.scrollLeft,$.datepicker._pos[1]-=document.documentElement.scrollTop);var f={left:$.datepicker._pos[0],top:$.datepicker._pos[1]};$.datepicker._pos=null,b.dpDiv.empty(),b.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),$.datepicker._updateDatepicker(b),f=$.datepicker._checkOffset(b,f,e),b.dpDiv.css({position:$.datepicker._inDialog&&$.blockUI?"static":e?"fixed":"absolute",display:"none",left:f.left+"px",top:f.top+"px"});if(!b.inline){var g=$.datepicker._get(b,"showAnim"),h=$.datepicker._get(b,"duration"),i=function(){var a=b.dpDiv.find("iframe.ui-datepicker-cover");if(!!a.length){var c=$.datepicker._getBorders(b.dpDiv);a.css({left:-c[0],top:-c[1],width:b.dpDiv.outerWidth(),height:b.dpDiv.outerHeight()})}};b.dpDiv.zIndex($(a).zIndex()+1),$.datepicker._datepickerShowing=!0,$.effects&&$.effects[g]?b.dpDiv.show(g,$.datepicker._get(b,"showOptions"),h,i):b.dpDiv[g||"show"](g?h:null,i),(!g||!h)&&i(),b.input.is(":visible")&&!b.input.is(":disabled")&&b.input.focus(),$.datepicker._curInst=b}},_updateDatepicker:function(a){var b=this;b.maxRows=4;var c=$.datepicker._getBorders(a.dpDiv);instActive=a,a.dpDiv.empty().append(this._generateHTML(a)),this._attachHandlers(a);var d=a.dpDiv.find("iframe.ui-datepicker-cover");!d.length||d.css({left:-c[0],top:-c[1],width:a.dpDiv.outerWidth(),height:a.dpDiv.outerHeight()}),a.dpDiv.find("."+this._dayOverClass+" a").mouseover();var e=this._getNumberOfMonths(a),f=e[1],g=17;a.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),f>1&&a.dpDiv.addClass("ui-datepicker-multi-"+f).css("width",g*f+"em"),a.dpDiv[(e[0]!=1||e[1]!=1?"add":"remove")+"Class"]("ui-datepicker-multi"),a.dpDiv[(this._get(a,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),a==$.datepicker._curInst&&$.datepicker._datepickerShowing&&a.input&&a.input.is(":visible")&&!a.input.is(":disabled")&&a.input[0]!=document.activeElement&&a.input.focus();if(a.yearshtml){var h=a.yearshtml;setTimeout(function(){h===a.yearshtml&&a.yearshtml&&a.dpDiv.find("select.ui-datepicker-year:first").replaceWith(a.yearshtml),h=a.yearshtml=null},0)}},_getBorders:function(a){var b=function(a){return{thin:1,medium:2,thick:3}[a]||a};return[parseFloat(b(a.css("border-left-width"))),parseFloat(b(a.css("border-top-width")))]},_checkOffset:function(a,b,c){var d=a.dpDiv.outerWidth(),e=a.dpDiv.outerHeight(),f=a.input?a.input.outerWidth():0,g=a.input?a.input.outerHeight():0,h=document.documentElement.clientWidth+(c?0:$(document).scrollLeft()),i=document.documentElement.clientHeight+(c?0:$(document).scrollTop());return b.left-=this._get(a,"isRTL")?d-f:0,b.left-=c&&b.left==a.input.offset().left?$(document).scrollLeft():0,b.top-=c&&b.top==a.input.offset().top+g?$(document).scrollTop():0,b.left-=Math.min(b.left,b.left+d>h&&h>d?Math.abs(b.left+d-h):0),b.top-=Math.min(b.top,b.top+e>i&&i>e?Math.abs(e+g):0),b},_findPos:function(a){var b=this._getInst(a),c=this._get(b,"isRTL");while(a&&(a.type=="hidden"||a.nodeType!=1||$.expr.filters.hidden(a)))a=a[c?"previousSibling":"nextSibling"];var d=$(a).offset();return[d.left,d.top]},_hideDatepicker:function(a){var b=this._curInst;if(!b||a&&b!=$.data(a,PROP_NAME))return;if(this._datepickerShowing){var c=this._get(b,"showAnim"),d=this._get(b,"duration"),e=function(){$.datepicker._tidyDialog(b)};$.effects&&$.effects[c]?b.dpDiv.hide(c,$.datepicker._get(b,"showOptions"),d,e):b.dpDiv[c=="slideDown"?"slideUp":c=="fadeIn"?"fadeOut":"hide"](c?d:null,e),c||e(),this._datepickerShowing=!1;var f=this._get(b,"onClose");f&&f.apply(b.input?b.input[0]:null,[b.input?b.input.val():"",b]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),$.blockUI&&($.unblockUI(),$("body").append(this.dpDiv))),this._inDialog=!1}},_tidyDialog:function(a){a.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(a){if(!$.datepicker._curInst)return;var b=$(a.target),c=$.datepicker._getInst(b[0]);(b[0].id!=$.datepicker._mainDivId&&b.parents("#"+$.datepicker._mainDivId).length==0&&!b.hasClass($.datepicker.markerClassName)&&!b.closest("."+$.datepicker._triggerClass).length&&$.datepicker._datepickerShowing&&(!$.datepicker._inDialog||!$.blockUI)||b.hasClass($.datepicker.markerClassName)&&$.datepicker._curInst!=c)&&$.datepicker._hideDatepicker()},_adjustDate:function(a,b,c){var d=$(a),e=this._getInst(d[0]);if(this._isDisabledDatepicker(d[0]))return;this._adjustInstDate(e,b+(c=="M"?this._get(e,"showCurrentAtPos"):0),c),this._updateDatepicker(e)},_gotoToday:function(a){var b=$(a),c=this._getInst(b[0]);if(this._get(c,"gotoCurrent")&&c.currentDay)c.selectedDay=c.currentDay,c.drawMonth=c.selectedMonth=c.currentMonth,c.drawYear=c.selectedYear=c.currentYear;else{var d=new Date;c.selectedDay=d.getDate(),c.drawMonth=c.selectedMonth=d.getMonth(),c.drawYear=c.selectedYear=d.getFullYear()}this._notifyChange(c),this._adjustDate(b)},_selectMonthYear:function(a,b,c){var d=$(a),e=this._getInst(d[0]);e["selected"+(c=="M"?"Month":"Year")]=e["draw"+(c=="M"?"Month":"Year")]=parseInt(b.options[b.selectedIndex].value,10),this._notifyChange(e),this._adjustDate(d)},_selectDay:function(a,b,c,d){var e=$(a);if($(d).hasClass(this._unselectableClass)||this._isDisabledDatepicker(e[0]))return;var f=this._getInst(e[0]);f.selectedDay=f.currentDay=$("a",d).html(),f.selectedMonth=f.currentMonth=b,f.selectedYear=f.currentYear=c,this._selectDate(a,this._formatDate(f,f.currentDay,f.currentMonth,f.currentYear))},_clearDate:function(a){var b=$(a),c=this._getInst(b[0]);this._selectDate(b,"")},_selectDate:function(a,b){var c=$(a),d=this._getInst(c[0]);b=b!=null?b:this._formatDate(d),d.input&&d.input.val(b),this._updateAlternate(d);var e=this._get(d,"onSelect");e?e.apply(d.input?d.input[0]:null,[b,d]):d.input&&d.input.trigger("change"),d.inline?this._updateDatepicker(d):(this._hideDatepicker(),this._lastInput=d.input[0],typeof d.input[0]!="object"&&d.input.focus(),this._lastInput=null)},_updateAlternate:function(a){var b=this._get(a,"altField");if(b){var c=this._get(a,"altFormat")||this._get(a,"dateFormat"),d=this._getDate(a),e=this.formatDate(c,d,this._getFormatConfig(a));$(b).each(function(){$(this).val(e)})}},noWeekends:function(a){var b=a.getDay();return[b>0&&b<6,""]},iso8601Week:function(a){var b=new Date(a.getTime());b.setDate(b.getDate()+4-(b.getDay()||7));var c=b.getTime();return b.setMonth(0),b.setDate(1),Math.floor(Math.round((c-b)/864e5)/7)+1},parseDate:function(a,b,c){if(a==null||b==null)throw"Invalid arguments";b=typeof b=="object"?b.toString():b+"";if(b=="")return null;var d=(c?c.shortYearCutoff:null)||this._defaults.shortYearCutoff;d=typeof d!="string"?d:(new Date).getFullYear()%100+parseInt(d,10);var e=(c?c.dayNamesShort:null)||this._defaults.dayNamesShort,f=(c?c.dayNames:null)||this._defaults.dayNames,g=(c?c.monthNamesShort:null)||this._defaults.monthNamesShort,h=(c?c.monthNames:null)||this._defaults.monthNames,i=-1,j=-1,k=-1,l=-1,m=!1,n=function(b){var c=s+1<a.length&&a.charAt(s+1)==b;return c&&s++,c},o=function(a){var c=n(a),d=a=="@"?14:a=="!"?20:a=="y"&&c?4:a=="o"?3:2,e=new RegExp("^\\d{1,"+d+"}"),f=b.substring(r).match(e);if(!f)throw"Missing number at position "+r;return r+=f[0].length,parseInt(f[0],10)},p=function(a,c,d){var e=$.map(n(a)?d:c,function(a,b){return[[b,a]]}).sort(function(a,b){return-(a[1].length-b[1].length)}),f=-1;$.each(e,function(a,c){var d=c[1];if(b.substr(r,d.length).toLowerCase()==d.toLowerCase())return f=c[0],r+=d.length,!1});if(f!=-1)return f+1;throw"Unknown name at position "+r},q=function(){if(b.charAt(r)!=a.charAt(s))throw"Unexpected literal at position "+r;r++},r=0;for(var s=0;s<a.length;s++)if(m)a.charAt(s)=="'"&&!n("'")?m=!1:q();else switch(a.charAt(s)){case"d":k=o("d");break;case"D":p("D",e,f);break;case"o":l=o("o");break;case"m":j=o("m");break;case"M":j=p("M",g,h);break;case"y":i=o("y");break;case"@":var t=new Date(o("@"));i=t.getFullYear(),j=t.getMonth()+1,k=t.getDate();break;case"!":var t=new Date((o("!")-this._ticksTo1970)/1e4);i=t.getFullYear(),j=t.getMonth()+1,k=t.getDate();break;case"'":n("'")?q():m=!0;break;default:q()}if(r<b.length)throw"Extra/unparsed characters found in date: "+b.substring(r);i==-1?i=(new Date).getFullYear():i<100&&(i+=(new Date).getFullYear()-(new Date).getFullYear()%100+(i<=d?0:-100));if(l>-1){j=1,k=l;do{var u=this._getDaysInMonth(i,j-1);if(k<=u)break;j++,k-=u}while(!0)}var t=this._daylightSavingAdjust(new Date(i,j-1,k));if(t.getFullYear()!=i||t.getMonth()+1!=j||t.getDate()!=k)throw"Invalid date";return t},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*24*60*60*1e7,formatDate:function(a,b,c){if(!b)return"";var d=(c?c.dayNamesShort:null)||this._defaults.dayNamesShort,e=(c?c.dayNames:null)||this._defaults.dayNames,f=(c?c.monthNamesShort:null)||this._defaults.monthNamesShort,g=(c?c.monthNames:null)||this._defaults.monthNames,h=function(b){var c=m+1<a.length&&a.charAt(m+1)==b;return c&&m++,c},i=function(a,b,c){var d=""+b;if(h(a))while(d.length<c)d="0"+d;return d},j=function(a,b,c,d){return h(a)?d[b]:c[b]},k="",l=!1;if(b)for(var m=0;m<a.length;m++)if(l)a.charAt(m)=="'"&&!h("'")?l=!1:k+=a.charAt(m);else switch(a.charAt(m)){case"d":k+=i("d",b.getDate(),2);break;case"D":k+=j("D",b.getDay(),d,e);break;case"o":k+=i("o",Math.round(((new Date(b.getFullYear(),b.getMonth(),b.getDate())).getTime()-(new Date(b.getFullYear(),0,0)).getTime())/864e5),3);break;case"m":k+=i("m",b.getMonth()+1,2);break;case"M":k+=j("M",b.getMonth(),f,g);break;case"y":k+=h("y")?b.getFullYear():(b.getYear()%100<10?"0":"")+b.getYear()%100;break;case"@":k+=b.getTime();break;case"!":k+=b.getTime()*1e4+this._ticksTo1970;break;case"'":h("'")?k+="'":l=!0;break;default:k+=a.charAt(m)}return k},_possibleChars:function(a){var b="",c=!1,d=function(b){var c=e+1<a.length&&a.charAt(e+1)==b;return c&&e++,c};for(var e=0;e<a.length;e++)if(c)a.charAt(e)=="'"&&!d("'")?c=!1:b+=a.charAt(e);else switch(a.charAt(e)){case"d":case"m":case"y":case"@":b+="0123456789";break;case"D":case"M":return null;case"'":d("'")?b+="'":c=!0;break;default:b+=a.charAt(e)}return b},_get:function(a,b){return a.settings[b]!==undefined?a.settings[b]:this._defaults[b]},_setDateFromField:function(a,b){if(a.input.val()==a.lastVal)return;var c=this._get(a,"dateFormat"),d=a.lastVal=a.input?a.input.val():null,e,f;e=f=this._getDefaultDate(a);var g=this._getFormatConfig(a);try{e=this.parseDate(c,d,g)||f}catch(h){this.log(h),d=b?"":d}a.selectedDay=e.getDate(),a.drawMonth=a.selectedMonth=e.getMonth(),a.drawYear=a.selectedYear=e.getFullYear(),a.currentDay=d?e.getDate():0,a.currentMonth=d?e.getMonth():0,a.currentYear=d?e.getFullYear():0,this._adjustInstDate(a)},_getDefaultDate:function(a){return this._restrictMinMax(a,this._determineDate(a,this._get(a,"defaultDate"),new Date))},_determineDate:function(a,b,c){var d=function(a){var b=new Date;return b.setDate(b.getDate()+a),b},e=function(b){try{return $.datepicker.parseDate($.datepicker._get(a,"dateFormat"),b,$.datepicker._getFormatConfig(a))}catch(c){}var d=(b.toLowerCase().match(/^c/)?$.datepicker._getDate(a):null)||new Date,e=d.getFullYear(),f=d.getMonth(),g=d.getDate(),h=/([+-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,i=h.exec(b);while(i){switch(i[2]||"d"){case"d":case"D":g+=parseInt(i[1],10);break;case"w":case"W":g+=parseInt(i[1],10)*7;break;case"m":case"M":f+=parseInt(i[1],10),g=Math.min(g,$.datepicker._getDaysInMonth(e,f));break;case"y":case"Y":e+=parseInt(i[1],10),g=Math.min(g,$.datepicker._getDaysInMonth(e,f))}i=h.exec(b)}return new Date(e,f,g)},f=b==null||b===""?c:typeof b=="string"?e(b):typeof b=="number"?isNaN(b)?c:d(b):new Date(b.getTime());return f=f&&f.toString()=="Invalid Date"?c:f,f&&(f.setHours(0),f.setMinutes(0),f.setSeconds(0),f.setMilliseconds(0)),this._daylightSavingAdjust(f)},_daylightSavingAdjust:function(a){return a?(a.setHours(a.getHours()>12?a.getHours()+2:0),a):null},_setDate:function(a,b,c){var d=!b,e=a.selectedMonth,f=a.selectedYear,g=this._restrictMinMax(a,this._determineDate(a,b,new Date));a.selectedDay=a.currentDay=g.getDate(),a.drawMonth=a.selectedMonth=a.currentMonth=g.getMonth(),a.drawYear=a.selectedYear=a.currentYear=g.getFullYear(),(e!=a.selectedMonth||f!=a.selectedYear)&&!c&&this._notifyChange(a),this._adjustInstDate(a),a.input&&a.input.val(d?"":this._formatDate(a))},_getDate:function(a){var b=!a.currentYear||a.input&&a.input.val()==""?null:this._daylightSavingAdjust(new Date(a.currentYear,a.currentMonth,a.currentDay));return b},_attachHandlers:function(a){var b=this._get(a,"stepMonths"),c="#"+a.id.replace(/\\\\/g,"\\");a.dpDiv.find("[data-handler]").map(function(){var a={prev:function(){window["DP_jQuery_"+dpuuid].datepicker._adjustDate(c,-b,"M")},next:function(){window["DP_jQuery_"+dpuuid].datepicker._adjustDate(c,+b,"M")},hide:function(){window["DP_jQuery_"+dpuuid].datepicker._hideDatepicker()},today:function(){window["DP_jQuery_"+dpuuid].datepicker._gotoToday(c)},selectDay:function(){return window["DP_jQuery_"+dpuuid].datepicker._selectDay(c,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return window["DP_jQuery_"+dpuuid].datepicker._selectMonthYear(c,this,"M"),!1},selectYear:function(){return window["DP_jQuery_"+dpuuid].datepicker._selectMonthYear(c,this,"Y"),!1}};$(this).bind(this.getAttribute("data-event"),a[this.getAttribute("data-handler")])})},_generateHTML:function(a){var b=new Date;b=this._daylightSavingAdjust(new Date(b.getFullYear(),b.getMonth(),b.getDate()));var c=this._get(a,"isRTL"),d=this._get(a,"showButtonPanel"),e=this._get(a,"hideIfNoPrevNext"),f=this._get(a,"navigationAsDateFormat"),g=this._getNumberOfMonths(a),h=this._get(a,"showCurrentAtPos"),i=this._get(a,"stepMonths"),j=g[0]!=1||g[1]!=1,k=this._daylightSavingAdjust(a.currentDay?new Date(a.currentYear,a.currentMonth,a.currentDay):new Date(9999,9,9)),l=this._getMinMaxDate(a,"min"),m=this._getMinMaxDate(a,"max"),n=a.drawMonth-h,o=a.drawYear;n<0&&(n+=12,o--);if(m){var p=this._daylightSavingAdjust(new Date(m.getFullYear(),m.getMonth()-g[0]*g[1]+1,m.getDate()));p=l&&p<l?l:p;while(this._daylightSavingAdjust(new Date(o,n,1))>p)n--,n<0&&(n=11,o--)}a.drawMonth=n,a.drawYear=o;var q=this._get(a,"prevText");q=f?this.formatDate(q,this._daylightSavingAdjust(new Date(o,n-i,1)),this._getFormatConfig(a)):q;var r=this._canAdjustMonth(a,-1,o,n)?'<a class="ui-datepicker-prev ui-corner-all" data-handler="prev" data-event="click" title="'+q+'"><span class="ui-icon ui-icon-circle-triangle-'+(c?"e":"w")+'">'+q+"</span></a>":e?"":'<a class="ui-datepicker-prev ui-corner-all ui-state-disabled" title="'+q+'"><span class="ui-icon ui-icon-circle-triangle-'+(c?"e":"w")+'">'+q+"</span></a>",s=this._get(a,"nextText");s=f?this.formatDate(s,this._daylightSavingAdjust(new Date(o,n+i,1)),this._getFormatConfig(a)):s;var t=this._canAdjustMonth(a,1,o,n)?'<a class="ui-datepicker-next ui-corner-all" data-handler="next" data-event="click" title="'+s+'"><span class="ui-icon ui-icon-circle-triangle-'+(c?"w":"e")+'">'+s+"</span></a>":e?"":'<a class="ui-datepicker-next ui-corner-all ui-state-disabled" title="'+s+'"><span class="ui-icon ui-icon-circle-triangle-'+(c?"w":"e")+'">'+s+"</span></a>",u=this._get(a,"currentText"),v=this._get(a,"gotoCurrent")&&a.currentDay?k:b;u=f?this.formatDate(u,v,this._getFormatConfig(a)):u;var w=a.inline?"":'<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" data-handler="hide" data-event="click">'+this._get(a,"closeText")+"</button>",x=d?'<div class="ui-datepicker-buttonpane ui-widget-content">'+(c?w:"")+(this._isInRange(a,v)?'<button type="button" class="ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all" data-handler="today" data-event="click">'+u+"</button>":"")+(c?"":w)+"</div>":"",y=parseInt(this._get(a,"firstDay"),10);y=isNaN(y)?0:y;var z=this._get(a,"showWeek"),A=this._get(a,"dayNames"),B=this._get(a,"dayNamesShort"),C=this._get(a,"dayNamesMin"),D=this._get(a,"monthNames"),E=this._get(a,"monthNamesShort"),F=this._get(a,"beforeShowDay"),G=this._get(a,"showOtherMonths"),H=this._get(a,"selectOtherMonths"),I=this._get(a,"calculateWeek")||this.iso8601Week,J=this._getDefaultDate(a),K="";for(var L=0;L<g[0];L++){var M="";this.maxRows=4;for(var N=0;N<g[1];N++){var O=this._daylightSavingAdjust(new Date(o,n,a.selectedDay)),P=" ui-corner-all",Q="";if(j){Q+='<div class="ui-datepicker-group';if(g[1]>1)switch(N){case 0:Q+=" ui-datepicker-group-first",P=" ui-corner-"+(c?"right":"left");break;case g[1]-1:Q+=" ui-datepicker-group-last",P=" ui-corner-"+(c?"left":"right");break;default:Q+=" ui-datepicker-group-middle",P=""}Q+='">'}Q+='<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix'+P+'">'+(/all|left/.test(P)&&L==0?c?t:r:"")+(/all|right/.test(P)&&L==0?c?r:t:"")+this._generateMonthYearHeader(a,n,o,l,m,L>0||N>0,D,E)+'</div><table class="ui-datepicker-calendar"><thead>'+"<tr>";var R=z?'<th class="ui-datepicker-week-col">'+this._get(a,"weekHeader")+"</th>":"";for(var S=0;S<7;S++){var T=(S+y)%7;R+="<th"+((S+y+6)%7>=5?' class="ui-datepicker-week-end"':"")+">"+'<span title="'+A[T]+'">'+C[T]+"</span></th>"}Q+=R+"</tr></thead><tbody>";var U=this._getDaysInMonth(o,n);o==a.selectedYear&&n==a.selectedMonth&&(a.selectedDay=Math.min(a.selectedDay,U));var V=(this._getFirstDayOfMonth(o,n)-y+7)%7,W=Math.ceil((V+U)/7),X=j?this.maxRows>W?this.maxRows:W:W;this.maxRows=X;var Y=this._daylightSavingAdjust(new Date(o,n,1-V));for(var Z=0;Z<X;Z++){Q+="<tr>";var _=z?'<td class="ui-datepicker-week-col">'+this._get(a,"calculateWeek")(Y)+"</td>":"";for(var S=0;S<7;S++){var ba=F?F.apply(a.input?a.input[0]:null,[Y]):[!0,""],bb=Y.getMonth()!=n,bc=bb&&!H||!ba[0]||l&&Y<l||m&&Y>m;_+='<td class="'+((S+y+6)%7>=5?" ui-datepicker-week-end":"")+(bb?" ui-datepicker-other-month":"")+(Y.getTime()==O.getTime()&&n==a.selectedMonth&&a._keyEvent||J.getTime()==Y.getTime()&&J.getTime()==O.getTime()?" "+this._dayOverClass:"")+(bc?" "+this._unselectableClass+" ui-state-disabled":"")+(bb&&!G?"":" "+ba[1]+(Y.getTime()==k.getTime()?" "+this._currentClass:"")+(Y.getTime()==b.getTime()?" ui-datepicker-today":""))+'"'+((!bb||G)&&ba[2]?' title="'+ba[2]+'"':"")+(bc?"":' data-handler="selectDay" data-event="click" data-month="'+Y.getMonth()+'" data-year="'+Y.getFullYear()+'"')+">"+(bb&&!G?"&#xa0;":bc?'<span class="ui-state-default">'+Y.getDate()+"</span>":'<a class="ui-state-default'+(Y.getTime()==b.getTime()?" ui-state-highlight":"")+(Y.getTime()==k.getTime()?" ui-state-active":"")+(bb?" ui-priority-secondary":"")+'" href="#">'+Y.getDate()+"</a>")+"</td>",Y.setDate(Y.getDate()+1),Y=this._daylightSavingAdjust(Y)}Q+=_+"</tr>"}n++,n>11&&(n=0,o++),Q+="</tbody></table>"+(j?"</div>"+(g[0]>0&&N==g[1]-1?'<div class="ui-datepicker-row-break"></div>':""):""),M+=Q}K+=M}return K+=x+($.browser.msie&&parseInt($.browser.version,10)<7&&!a.inline?'<iframe src="javascript:false;" class="ui-datepicker-cover" frameborder="0"></iframe>':""),a._keyEvent=!1,K},_generateMonthYearHeader:function(a,b,c,d,e,f,g,h){var i=this._get(a,"changeMonth"),j=this._get(a,"changeYear"),k=this._get(a,"showMonthAfterYear"),l='<div class="ui-datepicker-title">',m="";if(f||!i)m+='<span class="ui-datepicker-month">'+g[b]+"</span>";else{var n=d&&d.getFullYear()==c,o=e&&e.getFullYear()==c;m+='<select class="ui-datepicker-month" data-handler="selectMonth" data-event="change">';for(var p=0;p<12;p++)(!n||p>=d.getMonth())&&(!o||p<=e.getMonth())&&(m+='<option value="'+p+'"'+(p==b?' selected="selected"':"")+">"+h[p]+"</option>");m+="</select>"}k||(l+=m+(f||!i||!j?"&#xa0;":""));if(!a.yearshtml){a.yearshtml="";if(f||!j)l+='<span class="ui-datepicker-year">'+c+"</span>";else{var q=this._get(a,"yearRange").split(":"),r=(new Date).getFullYear(),s=function(a){var b=a.match(/c[+-].*/)?c+parseInt(a.substring(1),10):a.match(/[+-].*/)?r+parseInt(a,10):parseInt(a,10);return isNaN(b)?r:b},t=s(q[0]),u=Math.max(t,s(q[1]||""));t=d?Math.max(t,d.getFullYear()):t,u=e?Math.min(u,e.getFullYear()):u,a.yearshtml+='<select class="ui-datepicker-year" data-handler="selectYear" data-event="change">';for(;t<=u;t++)a.yearshtml+='<option value="'+t+'"'+(t==c?' selected="selected"':"")+">"+t+"</option>";a.yearshtml+="</select>",l+=a.yearshtml,a.yearshtml=null}}return l+=this._get(a,"yearSuffix"),k&&(l+=(f||!i||!j?"&#xa0;":"")+m),l+="</div>",l},_adjustInstDate:function(a,b,c){var d=a.drawYear+(c=="Y"?b:0),e=a.drawMonth+(c=="M"?b:0),f=Math.min(a.selectedDay,this._getDaysInMonth(d,e))+(c=="D"?b:0),g=this._restrictMinMax(a,this._daylightSavingAdjust(new Date(d,e,f)));a.selectedDay=g.getDate(),a.drawMonth=a.selectedMonth=g.getMonth(),a.drawYear=a.selectedYear=g.getFullYear(),(c=="M"||c=="Y")&&this._notifyChange(a)},_restrictMinMax:function(a,b){var c=this._getMinMaxDate(a,"min"),d=this._getMinMaxDate(a,"max"),e=c&&b<c?c:b;return e=d&&e>d?d:e,e},_notifyChange:function(a){var b=this._get(a,"onChangeMonthYear");b&&b.apply(a.input?a.input[0]:null,[a.selectedYear,a.selectedMonth+1,a])},_getNumberOfMonths:function(a){var b=this._get(a,"numberOfMonths");return b==null?[1,1]:typeof b=="number"?[1,b]:b},_getMinMaxDate:function(a,b){return this._determineDate(a,this._get(a,b+"Date"),null)},_getDaysInMonth:function(a,b){return 32-this._daylightSavingAdjust(new Date(a,b,32)).getDate()},_getFirstDayOfMonth:function(a,b){return(new Date(a,b,1)).getDay()},_canAdjustMonth:function(a,b,c,d){var e=this._getNumberOfMonths(a),f=this._daylightSavingAdjust(new Date(c,d+(b<0?b:e[0]*e[1]),1));return b<0&&f.setDate(this._getDaysInMonth(f.getFullYear(),f.getMonth())),this._isInRange(a,f)},_isInRange:function(a,b){var c=this._getMinMaxDate(a,"min"),d=this._getMinMaxDate(a,"max");return(!c||b.getTime()>=c.getTime())&&(!d||b.getTime()<=d.getTime())},_getFormatConfig:function(a){var b=this._get(a,"shortYearCutoff");return b=typeof b!="string"?b:(new Date).getFullYear()%100+parseInt(b,10),{shortYearCutoff:b,dayNamesShort:this._get(a,"dayNamesShort"),dayNames:this._get(a,"dayNames"),monthNamesShort:this._get(a,"monthNamesShort"),monthNames:this._get(a,"monthNames")}},_formatDate:function(a,b,c,d){b||(a.currentDay=a.selectedDay,a.currentMonth=a.selectedMonth,a.currentYear=a.selectedYear);var e=b?typeof b=="object"?b:this._daylightSavingAdjust(new Date(d,c,b)):this._daylightSavingAdjust(new Date(a.currentYear,a.currentMonth,a.currentDay));return this.formatDate(this._get(a,"dateFormat"),e,this._getFormatConfig(a))}}),$.fn.datepicker=function(a){if(!this.length)return this;$.datepicker.initialized||($(document).mousedown($.datepicker._checkExternalClick).find("body").append($.datepicker.dpDiv),$.datepicker.initialized=!0);var b=Array.prototype.slice.call(arguments,1);return typeof a!="string"||a!="isDisabled"&&a!="getDate"&&a!="widget"?a=="option"&&arguments.length==2&&typeof arguments[1]=="string"?$.datepicker["_"+a+"Datepicker"].apply($.datepicker,[this[0]].concat(b)):this.each(function(){typeof a=="string"?$.datepicker["_"+a+"Datepicker"].apply($.datepicker,[this].concat(b)):$.datepicker._attachDatepicker(this,a)}):$.datepicker["_"+a+"Datepicker"].apply($.datepicker,[this[0]].concat(b))},$.datepicker=new Datepicker,$.datepicker.initialized=!1,$.datepicker.uuid=(new Date).getTime(),$.datepicker.version="1.8.23",window["DP_jQuery_"+dpuuid]=$})(jQuery);;/*! jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.ui.progressbar.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){a.widget("ui.progressbar",{options:{value:0,max:100},min:0,_create:function(){this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min,"aria-valuemax":this.options.max,"aria-valuenow":this._value()}),this.valueDiv=a("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),this.oldValue=this._value(),this._refreshValue()},destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove(),a.Widget.prototype.destroy.apply(this,arguments)},value:function(a){return a===b?this._value():(this._setOption("value",a),this)},_setOption:function(b,c){b==="value"&&(this.options.value=c,this._refreshValue(),this._value()===this.options.max&&this._trigger("complete")),a.Widget.prototype._setOption.apply(this,arguments)},_value:function(){var a=this.options.value;return typeof a!="number"&&(a=0),Math.min(this.options.max,Math.max(this.min,a))},_percentage:function(){return 100*this._value()/this.options.max},_refreshValue:function(){var a=this.value(),b=this._percentage();this.oldValue!==a&&(this.oldValue=a,this._trigger("change")),this.valueDiv.toggle(a>this.min).toggleClass("ui-corner-right",a===this.options.max).width(b.toFixed(0)+"%"),this.element.attr("aria-valuenow",a)}}),a.extend(a.ui.progressbar,{version:"1.8.23"})})(jQuery);;/*! jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.effects.core.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
jQuery.effects||function(a,b){function c(b){var c;return b&&b.constructor==Array&&b.length==3?b:(c=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(b))?[parseInt(c[1],10),parseInt(c[2],10),parseInt(c[3],10)]:(c=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(b))?[parseFloat(c[1])*2.55,parseFloat(c[2])*2.55,parseFloat(c[3])*2.55]:(c=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(b))?[parseInt(c[1],16),parseInt(c[2],16),parseInt(c[3],16)]:(c=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(b))?[parseInt(c[1]+c[1],16),parseInt(c[2]+c[2],16),parseInt(c[3]+c[3],16)]:(c=/rgba\(0, 0, 0, 0\)/.exec(b))?e.transparent:e[a.trim(b).toLowerCase()]}function d(b,d){var e;do{e=(a.curCSS||a.css)(b,d);if(e!=""&&e!="transparent"||a.nodeName(b,"body"))break;d="backgroundColor"}while(b=b.parentNode);return c(e)}function h(){var a=document.defaultView?document.defaultView.getComputedStyle(this,null):this.currentStyle,b={},c,d;if(a&&a.length&&a[0]&&a[a[0]]){var e=a.length;while(e--)c=a[e],typeof a[c]=="string"&&(d=c.replace(/\-(\w)/g,function(a,b){return b.toUpperCase()}),b[d]=a[c])}else for(c in a)typeof a[c]=="string"&&(b[c]=a[c]);return b}function i(b){var c,d;for(c in b)d=b[c],(d==null||a.isFunction(d)||c in g||/scrollbar/.test(c)||!/color/i.test(c)&&isNaN(parseFloat(d)))&&delete b[c];return b}function j(a,b){var c={_:0},d;for(d in b)a[d]!=b[d]&&(c[d]=b[d]);return c}function k(b,c,d,e){typeof b=="object"&&(e=c,d=null,c=b,b=c.effect),a.isFunction(c)&&(e=c,d=null,c={});if(typeof c=="number"||a.fx.speeds[c])e=d,d=c,c={};return a.isFunction(d)&&(e=d,d=null),c=c||{},d=d||c.duration,d=a.fx.off?0:typeof d=="number"?d:d in a.fx.speeds?a.fx.speeds[d]:a.fx.speeds._default,e=e||c.complete,[b,c,d,e]}function l(b){return!b||typeof b=="number"||a.fx.speeds[b]?!0:typeof b=="string"&&!a.effects[b]?!0:!1}a.effects={},a.each(["backgroundColor","borderBottomColor","borderLeftColor","borderRightColor","borderTopColor","borderColor","color","outlineColor"],function(b,e){a.fx.step[e]=function(a){a.colorInit||(a.start=d(a.elem,e),a.end=c(a.end),a.colorInit=!0),a.elem.style[e]="rgb("+Math.max(Math.min(parseInt(a.pos*(a.end[0]-a.start[0])+a.start[0],10),255),0)+","+Math.max(Math.min(parseInt(a.pos*(a.end[1]-a.start[1])+a.start[1],10),255),0)+","+Math.max(Math.min(parseInt(a.pos*(a.end[2]-a.start[2])+a.start[2],10),255),0)+")"}});var e={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0],transparent:[255,255,255]},f=["add","remove","toggle"],g={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};a.effects.animateClass=function(b,c,d,e){return a.isFunction(d)&&(e=d,d=null),this.queue(function(){var g=a(this),k=g.attr("style")||" ",l=i(h.call(this)),m,n=g.attr("class")||"";a.each(f,function(a,c){b[c]&&g[c+"Class"](b[c])}),m=i(h.call(this)),g.attr("class",n),g.animate(j(l,m),{queue:!1,duration:c,easing:d,complete:function(){a.each(f,function(a,c){b[c]&&g[c+"Class"](b[c])}),typeof g.attr("style")=="object"?(g.attr("style").cssText="",g.attr("style").cssText=k):g.attr("style",k),e&&e.apply(this,arguments),a.dequeue(this)}})})},a.fn.extend({_addClass:a.fn.addClass,addClass:function(b,c,d,e){return c?a.effects.animateClass.apply(this,[{add:b},c,d,e]):this._addClass(b)},_removeClass:a.fn.removeClass,removeClass:function(b,c,d,e){return c?a.effects.animateClass.apply(this,[{remove:b},c,d,e]):this._removeClass(b)},_toggleClass:a.fn.toggleClass,toggleClass:function(c,d,e,f,g){return typeof d=="boolean"||d===b?e?a.effects.animateClass.apply(this,[d?{add:c}:{remove:c},e,f,g]):this._toggleClass(c,d):a.effects.animateClass.apply(this,[{toggle:c},d,e,f])},switchClass:function(b,c,d,e,f){return a.effects.animateClass.apply(this,[{add:c,remove:b},d,e,f])}}),a.extend(a.effects,{version:"1.8.23",save:function(a,b){for(var c=0;c<b.length;c++)b[c]!==null&&a.data("ec.storage."+b[c],a[0].style[b[c]])},restore:function(a,b){for(var c=0;c<b.length;c++)b[c]!==null&&a.css(b[c],a.data("ec.storage."+b[c]))},setMode:function(a,b){return b=="toggle"&&(b=a.is(":hidden")?"show":"hide"),b},getBaseline:function(a,b){var c,d;switch(a[0]){case"top":c=0;break;case"middle":c=.5;break;case"bottom":c=1;break;default:c=a[0]/b.height}switch(a[1]){case"left":d=0;break;case"center":d=.5;break;case"right":d=1;break;default:d=a[1]/b.width}return{x:d,y:c}},createWrapper:function(b){if(b.parent().is(".ui-effects-wrapper"))return b.parent();var c={width:b.outerWidth(!0),height:b.outerHeight(!0),"float":b.css("float")},d=a("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),e=document.activeElement;try{e.id}catch(f){e=document.body}return b.wrap(d),(b[0]===e||a.contains(b[0],e))&&a(e).focus(),d=b.parent(),b.css("position")=="static"?(d.css({position:"relative"}),b.css({position:"relative"})):(a.extend(c,{position:b.css("position"),zIndex:b.css("z-index")}),a.each(["top","left","bottom","right"],function(a,d){c[d]=b.css(d),isNaN(parseInt(c[d],10))&&(c[d]="auto")}),b.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),d.css(c).show()},removeWrapper:function(b){var c,d=document.activeElement;return b.parent().is(".ui-effects-wrapper")?(c=b.parent().replaceWith(b),(b[0]===d||a.contains(b[0],d))&&a(d).focus(),c):b},setTransition:function(b,c,d,e){return e=e||{},a.each(c,function(a,c){var f=b.cssUnit(c);f[0]>0&&(e[c]=f[0]*d+f[1])}),e}}),a.fn.extend({effect:function(b,c,d,e){var f=k.apply(this,arguments),g={options:f[1],duration:f[2],callback:f[3]},h=g.options.mode,i=a.effects[b];return a.fx.off||!i?h?this[h](g.duration,g.callback):this.each(function(){g.callback&&g.callback.call(this)}):i.call(this,g)},_show:a.fn.show,show:function(a){if(l(a))return this._show.apply(this,arguments);var b=k.apply(this,arguments);return b[1].mode="show",this.effect.apply(this,b)},_hide:a.fn.hide,hide:function(a){if(l(a))return this._hide.apply(this,arguments);var b=k.apply(this,arguments);return b[1].mode="hide",this.effect.apply(this,b)},__toggle:a.fn.toggle,toggle:function(b){if(l(b)||typeof b=="boolean"||a.isFunction(b))return this.__toggle.apply(this,arguments);var c=k.apply(this,arguments);return c[1].mode="toggle",this.effect.apply(this,c)},cssUnit:function(b){var c=this.css(b),d=[];return a.each(["em","px","%","pt"],function(a,b){c.indexOf(b)>0&&(d=[parseFloat(c),b])}),d}});var m={};a.each(["Quad","Cubic","Quart","Quint","Expo"],function(a,b){m[b]=function(b){return Math.pow(b,a+2)}}),a.extend(m,{Sine:function(a){return 1-Math.cos(a*Math.PI/2)},Circ:function(a){return 1-Math.sqrt(1-a*a)},Elastic:function(a){return a===0||a===1?a:-Math.pow(2,8*(a-1))*Math.sin(((a-1)*80-7.5)*Math.PI/15)},Back:function(a){return a*a*(3*a-2)},Bounce:function(a){var b,c=4;while(a<((b=Math.pow(2,--c))-1)/11);return 1/Math.pow(4,3-c)-7.5625*Math.pow((b*3-2)/22-a,2)}}),a.each(m,function(b,c){a.easing["easeIn"+b]=c,a.easing["easeOut"+b]=function(a){return 1-c(1-a)},a.easing["easeInOut"+b]=function(a){return a<.5?c(a*2)/2:c(a*-2+2)/-2+1}})}(jQuery);;/*! jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.effects.blind.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){a.effects.blind=function(b){return this.queue(function(){var c=a(this),d=["position","top","bottom","left","right"],e=a.effects.setMode(c,b.options.mode||"hide"),f=b.options.direction||"vertical";a.effects.save(c,d),c.show();var g=a.effects.createWrapper(c).css({overflow:"hidden"}),h=f=="vertical"?"height":"width",i=f=="vertical"?g.height():g.width();e=="show"&&g.css(h,0);var j={};j[h]=e=="show"?i:0,g.animate(j,b.duration,b.options.easing,function(){e=="hide"&&c.hide(),a.effects.restore(c,d),a.effects.removeWrapper(c),b.callback&&b.callback.apply(c[0],arguments),c.dequeue()})})}})(jQuery);;/*! jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.effects.bounce.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){a.effects.bounce=function(b){return this.queue(function(){var c=a(this),d=["position","top","bottom","left","right"],e=a.effects.setMode(c,b.options.mode||"effect"),f=b.options.direction||"up",g=b.options.distance||20,h=b.options.times||5,i=b.duration||250;/show|hide/.test(e)&&d.push("opacity"),a.effects.save(c,d),c.show(),a.effects.createWrapper(c);var j=f=="up"||f=="down"?"top":"left",k=f=="up"||f=="left"?"pos":"neg",g=b.options.distance||(j=="top"?c.outerHeight(!0)/3:c.outerWidth(!0)/3);e=="show"&&c.css("opacity",0).css(j,k=="pos"?-g:g),e=="hide"&&(g=g/(h*2)),e!="hide"&&h--;if(e=="show"){var l={opacity:1};l[j]=(k=="pos"?"+=":"-=")+g,c.animate(l,i/2,b.options.easing),g=g/2,h--}for(var m=0;m<h;m++){var n={},p={};n[j]=(k=="pos"?"-=":"+=")+g,p[j]=(k=="pos"?"+=":"-=")+g,c.animate(n,i/2,b.options.easing).animate(p,i/2,b.options.easing),g=e=="hide"?g*2:g/2}if(e=="hide"){var l={opacity:0};l[j]=(k=="pos"?"-=":"+=")+g,c.animate(l,i/2,b.options.easing,function(){c.hide(),a.effects.restore(c,d),a.effects.removeWrapper(c),b.callback&&b.callback.apply(this,arguments)})}else{var n={},p={};n[j]=(k=="pos"?"-=":"+=")+g,p[j]=(k=="pos"?"+=":"-=")+g,c.animate(n,i/2,b.options.easing).animate(p,i/2,b.options.easing,function(){a.effects.restore(c,d),a.effects.removeWrapper(c),b.callback&&b.callback.apply(this,arguments)})}c.queue("fx",function(){c.dequeue()}),c.dequeue()})}})(jQuery);;/*! jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.effects.clip.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){a.effects.clip=function(b){return this.queue(function(){var c=a(this),d=["position","top","bottom","left","right","height","width"],e=a.effects.setMode(c,b.options.mode||"hide"),f=b.options.direction||"vertical";a.effects.save(c,d),c.show();var g=a.effects.createWrapper(c).css({overflow:"hidden"}),h=c[0].tagName=="IMG"?g:c,i={size:f=="vertical"?"height":"width",position:f=="vertical"?"top":"left"},j=f=="vertical"?h.height():h.width();e=="show"&&(h.css(i.size,0),h.css(i.position,j/2));var k={};k[i.size]=e=="show"?j:0,k[i.position]=e=="show"?0:j/2,h.animate(k,{queue:!1,duration:b.duration,easing:b.options.easing,complete:function(){e=="hide"&&c.hide(),a.effects.restore(c,d),a.effects.removeWrapper(c),b.callback&&b.callback.apply(c[0],arguments),c.dequeue()}})})}})(jQuery);;/*! jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.effects.drop.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){a.effects.drop=function(b){return this.queue(function(){var c=a(this),d=["position","top","bottom","left","right","opacity"],e=a.effects.setMode(c,b.options.mode||"hide"),f=b.options.direction||"left";a.effects.save(c,d),c.show(),a.effects.createWrapper(c);var g=f=="up"||f=="down"?"top":"left",h=f=="up"||f=="left"?"pos":"neg",i=b.options.distance||(g=="top"?c.outerHeight(!0)/2:c.outerWidth(!0)/2);e=="show"&&c.css("opacity",0).css(g,h=="pos"?-i:i);var j={opacity:e=="show"?1:0};j[g]=(e=="show"?h=="pos"?"+=":"-=":h=="pos"?"-=":"+=")+i,c.animate(j,{queue:!1,duration:b.duration,easing:b.options.easing,complete:function(){e=="hide"&&c.hide(),a.effects.restore(c,d),a.effects.removeWrapper(c),b.callback&&b.callback.apply(this,arguments),c.dequeue()}})})}})(jQuery);;/*! jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.effects.explode.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){a.effects.explode=function(b){return this.queue(function(){var c=b.options.pieces?Math.round(Math.sqrt(b.options.pieces)):3,d=b.options.pieces?Math.round(Math.sqrt(b.options.pieces)):3;b.options.mode=b.options.mode=="toggle"?a(this).is(":visible")?"hide":"show":b.options.mode;var e=a(this).show().css("visibility","hidden"),f=e.offset();f.top-=parseInt(e.css("marginTop"),10)||0,f.left-=parseInt(e.css("marginLeft"),10)||0;var g=e.outerWidth(!0),h=e.outerHeight(!0);for(var i=0;i<c;i++)for(var j=0;j<d;j++)e.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-j*(g/d),top:-i*(h/c)}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:g/d,height:h/c,left:f.left+j*(g/d)+(b.options.mode=="show"?(j-Math.floor(d/2))*(g/d):0),top:f.top+i*(h/c)+(b.options.mode=="show"?(i-Math.floor(c/2))*(h/c):0),opacity:b.options.mode=="show"?0:1}).animate({left:f.left+j*(g/d)+(b.options.mode=="show"?0:(j-Math.floor(d/2))*(g/d)),top:f.top+i*(h/c)+(b.options.mode=="show"?0:(i-Math.floor(c/2))*(h/c)),opacity:b.options.mode=="show"?1:0},b.duration||500);setTimeout(function(){b.options.mode=="show"?e.css({visibility:"visible"}):e.css({visibility:"visible"}).hide(),b.callback&&b.callback.apply(e[0]),e.dequeue(),a("div.ui-effects-explode").remove()},b.duration||500)})}})(jQuery);;/*! jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.effects.fade.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){a.effects.fade=function(b){return this.queue(function(){var c=a(this),d=a.effects.setMode(c,b.options.mode||"hide");c.animate({opacity:d},{queue:!1,duration:b.duration,easing:b.options.easing,complete:function(){b.callback&&b.callback.apply(this,arguments),c.dequeue()}})})}})(jQuery);;/*! jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.effects.fold.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){a.effects.fold=function(b){return this.queue(function(){var c=a(this),d=["position","top","bottom","left","right"],e=a.effects.setMode(c,b.options.mode||"hide"),f=b.options.size||15,g=!!b.options.horizFirst,h=b.duration?b.duration/2:a.fx.speeds._default/2;a.effects.save(c,d),c.show();var i=a.effects.createWrapper(c).css({overflow:"hidden"}),j=e=="show"!=g,k=j?["width","height"]:["height","width"],l=j?[i.width(),i.height()]:[i.height(),i.width()],m=/([0-9]+)%/.exec(f);m&&(f=parseInt(m[1],10)/100*l[e=="hide"?0:1]),e=="show"&&i.css(g?{height:0,width:f}:{height:f,width:0});var n={},p={};n[k[0]]=e=="show"?l[0]:f,p[k[1]]=e=="show"?l[1]:0,i.animate(n,h,b.options.easing).animate(p,h,b.options.easing,function(){e=="hide"&&c.hide(),a.effects.restore(c,d),a.effects.removeWrapper(c),b.callback&&b.callback.apply(c[0],arguments),c.dequeue()})})}})(jQuery);;/*! jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.effects.highlight.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){a.effects.highlight=function(b){return this.queue(function(){var c=a(this),d=["backgroundImage","backgroundColor","opacity"],e=a.effects.setMode(c,b.options.mode||"show"),f={backgroundColor:c.css("backgroundColor")};e=="hide"&&(f.opacity=0),a.effects.save(c,d),c.show().css({backgroundImage:"none",backgroundColor:b.options.color||"#ffff99"}).animate(f,{queue:!1,duration:b.duration,easing:b.options.easing,complete:function(){e=="hide"&&c.hide(),a.effects.restore(c,d),e=="show"&&!a.support.opacity&&this.style.removeAttribute("filter"),b.callback&&b.callback.apply(this,arguments),c.dequeue()}})})}})(jQuery);;/*! jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.effects.pulsate.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){a.effects.pulsate=function(b){return this.queue(function(){var c=a(this),d=a.effects.setMode(c,b.options.mode||"show"),e=(b.options.times||5)*2-1,f=b.duration?b.duration/2:a.fx.speeds._default/2,g=c.is(":visible"),h=0;g||(c.css("opacity",0).show(),h=1),(d=="hide"&&g||d=="show"&&!g)&&e--;for(var i=0;i<e;i++)c.animate({opacity:h},f,b.options.easing),h=(h+1)%2;c.animate({opacity:h},f,b.options.easing,function(){h==0&&c.hide(),b.callback&&b.callback.apply(this,arguments)}),c.queue("fx",function(){c.dequeue()}).dequeue()})}})(jQuery);;/*! jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.effects.scale.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){a.effects.puff=function(b){return this.queue(function(){var c=a(this),d=a.effects.setMode(c,b.options.mode||"hide"),e=parseInt(b.options.percent,10)||150,f=e/100,g={height:c.height(),width:c.width()};a.extend(b.options,{fade:!0,mode:d,percent:d=="hide"?e:100,from:d=="hide"?g:{height:g.height*f,width:g.width*f}}),c.effect("scale",b.options,b.duration,b.callback),c.dequeue()})},a.effects.scale=function(b){return this.queue(function(){var c=a(this),d=a.extend(!0,{},b.options),e=a.effects.setMode(c,b.options.mode||"effect"),f=parseInt(b.options.percent,10)||(parseInt(b.options.percent,10)==0?0:e=="hide"?0:100),g=b.options.direction||"both",h=b.options.origin;e!="effect"&&(d.origin=h||["middle","center"],d.restore=!0);var i={height:c.height(),width:c.width()};c.from=b.options.from||(e=="show"?{height:0,width:0}:i);var j={y:g!="horizontal"?f/100:1,x:g!="vertical"?f/100:1};c.to={height:i.height*j.y,width:i.width*j.x},b.options.fade&&(e=="show"&&(c.from.opacity=0,c.to.opacity=1),e=="hide"&&(c.from.opacity=1,c.to.opacity=0)),d.from=c.from,d.to=c.to,d.mode=e,c.effect("size",d,b.duration,b.callback),c.dequeue()})},a.effects.size=function(b){return this.queue(function(){var c=a(this),d=["position","top","bottom","left","right","width","height","overflow","opacity"],e=["position","top","bottom","left","right","overflow","opacity"],f=["width","height","overflow"],g=["fontSize"],h=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],i=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],j=a.effects.setMode(c,b.options.mode||"effect"),k=b.options.restore||!1,l=b.options.scale||"both",m=b.options.origin,n={height:c.height(),width:c.width()};c.from=b.options.from||n,c.to=b.options.to||n;if(m){var p=a.effects.getBaseline(m,n);c.from.top=(n.height-c.from.height)*p.y,c.from.left=(n.width-c.from.width)*p.x,c.to.top=(n.height-c.to.height)*p.y,c.to.left=(n.width-c.to.width)*p.x}var q={from:{y:c.from.height/n.height,x:c.from.width/n.width},to:{y:c.to.height/n.height,x:c.to.width/n.width}};if(l=="box"||l=="both")q.from.y!=q.to.y&&(d=d.concat(h),c.from=a.effects.setTransition(c,h,q.from.y,c.from),c.to=a.effects.setTransition(c,h,q.to.y,c.to)),q.from.x!=q.to.x&&(d=d.concat(i),c.from=a.effects.setTransition(c,i,q.from.x,c.from),c.to=a.effects.setTransition(c,i,q.to.x,c.to));(l=="content"||l=="both")&&q.from.y!=q.to.y&&(d=d.concat(g),c.from=a.effects.setTransition(c,g,q.from.y,c.from),c.to=a.effects.setTransition(c,g,q.to.y,c.to)),a.effects.save(c,k?d:e),c.show(),a.effects.createWrapper(c),c.css("overflow","hidden").css(c.from);if(l=="content"||l=="both")h=h.concat(["marginTop","marginBottom"]).concat(g),i=i.concat(["marginLeft","marginRight"]),f=d.concat(h).concat(i),c.find("*[width]").each(function(){var c=a(this);k&&a.effects.save(c,f);var d={height:c.height(),width:c.width()};c.from={height:d.height*q.from.y,width:d.width*q.from.x},c.to={height:d.height*q.to.y,width:d.width*q.to.x},q.from.y!=q.to.y&&(c.from=a.effects.setTransition(c,h,q.from.y,c.from),c.to=a.effects.setTransition(c,h,q.to.y,c.to)),q.from.x!=q.to.x&&(c.from=a.effects.setTransition(c,i,q.from.x,c.from),c.to=a.effects.setTransition(c,i,q.to.x,c.to)),c.css(c.from),c.animate(c.to,b.duration,b.options.easing,function(){k&&a.effects.restore(c,f)})});c.animate(c.to,{queue:!1,duration:b.duration,easing:b.options.easing,complete:function(){c.to.opacity===0&&c.css("opacity",c.from.opacity),j=="hide"&&c.hide(),a.effects.restore(c,k?d:e),a.effects.removeWrapper(c),b.callback&&b.callback.apply(this,arguments),c.dequeue()}})})}})(jQuery);;/*! jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.effects.shake.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){a.effects.shake=function(b){return this.queue(function(){var c=a(this),d=["position","top","bottom","left","right"],e=a.effects.setMode(c,b.options.mode||"effect"),f=b.options.direction||"left",g=b.options.distance||20,h=b.options.times||3,i=b.duration||b.options.duration||140;a.effects.save(c,d),c.show(),a.effects.createWrapper(c);var j=f=="up"||f=="down"?"top":"left",k=f=="up"||f=="left"?"pos":"neg",l={},m={},n={};l[j]=(k=="pos"?"-=":"+=")+g,m[j]=(k=="pos"?"+=":"-=")+g*2,n[j]=(k=="pos"?"-=":"+=")+g*2,c.animate(l,i,b.options.easing);for(var p=1;p<h;p++)c.animate(m,i,b.options.easing).animate(n,i,b.options.easing);c.animate(m,i,b.options.easing).animate(l,i/2,b.options.easing,function(){a.effects.restore(c,d),a.effects.removeWrapper(c),b.callback&&b.callback.apply(this,arguments)}),c.queue("fx",function(){c.dequeue()}),c.dequeue()})}})(jQuery);;/*! jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.effects.slide.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){a.effects.slide=function(b){return this.queue(function(){var c=a(this),d=["position","top","bottom","left","right"],e=a.effects.setMode(c,b.options.mode||"show"),f=b.options.direction||"left";a.effects.save(c,d),c.show(),a.effects.createWrapper(c).css({overflow:"hidden"});var g=f=="up"||f=="down"?"top":"left",h=f=="up"||f=="left"?"pos":"neg",i=b.options.distance||(g=="top"?c.outerHeight(!0):c.outerWidth(!0));e=="show"&&c.css(g,h=="pos"?isNaN(i)?"-"+i:-i:i);var j={};j[g]=(e=="show"?h=="pos"?"+=":"-=":h=="pos"?"-=":"+=")+i,c.animate(j,{queue:!1,duration:b.duration,easing:b.options.easing,complete:function(){e=="hide"&&c.hide(),a.effects.restore(c,d),a.effects.removeWrapper(c),b.callback&&b.callback.apply(this,arguments),c.dequeue()}})})}})(jQuery);;/*! jQuery UI - v1.8.23 - 2012-08-15
* https://github.com/jquery/jquery-ui
* Includes: jquery.effects.transfer.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){a.effects.transfer=function(b){return this.queue(function(){var c=a(this),d=a(b.options.to),e=d.offset(),f={top:e.top,left:e.left,height:d.innerHeight(),width:d.innerWidth()},g=c.offset(),h=a('<div class="ui-effects-transfer"></div>').appendTo(document.body).addClass(b.options.className).css({top:g.top,left:g.left,height:c.innerHeight(),width:c.innerWidth(),position:"absolute"}).animate(f,b.duration,b.options.easing,function(){h.remove(),b.callback&&b.callback.apply(c[0],arguments),c.dequeue()})})}})(jQuery);;
/*
 * jQuery UI Touch Punch 0.2.2
 *
 * Copyright 2011, Dave Furfero
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Depends:
 *  jquery.ui.widget.js
 *  jquery.ui.mouse.js
 */
(function(b){b.support.touch="ontouchend" in document;if(!b.support.touch){return;}var c=b.ui.mouse.prototype,e=c._mouseInit,a;function d(g,h){if(g.originalEvent.touches.length>1){return;}g.preventDefault();var i=g.originalEvent.changedTouches[0],f=document.createEvent("MouseEvents");f.initMouseEvent(h,true,true,window,1,i.screenX,i.screenY,i.clientX,i.clientY,false,false,false,false,0,null);g.target.dispatchEvent(f);}c._touchStart=function(g){var f=this;if(a||!f._mouseCapture(g.originalEvent.changedTouches[0])){return;}a=true;f._touchMoved=false;d(g,"mouseover");d(g,"mousemove");d(g,"mousedown");};c._touchMove=function(f){if(!a){return;}this._touchMoved=true;d(f,"mousemove");};c._touchEnd=function(f){if(!a){return;}d(f,"mouseup");d(f,"mouseout");if(!this._touchMoved){d(f,"click");}a=false;};c._mouseInit=function(){var f=this;f.element.bind("touchstart",b.proxy(f,"_touchStart")).bind("touchmove",b.proxy(f,"_touchMove")).bind("touchend",b.proxy(f,"_touchEnd"));e.call(f);};})(jQuery);
/* jquery.nicescroll
-- version 3.0.0
-- copyright 2011-12 InuYaksa*2012
-- licensed under the MIT
--
-- http://areaaperta.com/nicescroll
-- https://github.com/inuyaksa/jquery.nicescroll
--
*/

(function(jQuery){

  // globals
  var domfocus = false;
  var mousefocus = false;
  var zoomactive = false;
  var tabindexcounter = 5000;
  var ascrailcounter = 2000;
  
  var $ = jQuery;  // sandbox
 
  // http://stackoverflow.com/questions/2161159/get-script-path
  function getScriptPath() {
    var scripts=document.getElementsByTagName('script');
    var path=scripts[scripts.length-1].src.split('?')[0];
    return (path.split('/').length>0) ? path.split('/').slice(0,-1).join('/')+'/' : '';
  }
  var scriptpath = getScriptPath();

  // derived by http://blog.joelambert.co.uk/2011/06/01/a-better-settimeoutsetinterval/
  var setAnimationFrame = (function(){
    return  window.requestAnimationFrame       || 
            window.webkitRequestAnimationFrame || 
            window.mozRequestAnimationFrame    || 
            window.oRequestAnimationFrame      || 
            window.msRequestAnimationFrame     || 
            false;
  })();
  var clearAnimationFrame = (function(){
    return  window.cancelRequestAnimationFrame       || 
            window.webkitCancelRequestAnimationFrame || 
            window.mozCancelRequestAnimationFrame    || 
            window.oCancelRequestAnimationFrame      || 
            window.msCancelRequestAnimationFrame     || 
            false;
  })();  
  
  var browserdetected = false;
  
  var getBrowserDetection = function() {
  
    if (browserdetected) return browserdetected;
  
    var domtest = document.createElement('DIV');

    var d = {};
    
		d.haspointerlock = "pointerLockElement" in document || "mozPointerLockElement" in document || "webkitPointerLockElement" in document;
		
    d.isopera = ("opera" in window);
    d.isopera12 = (d.isopera&&("getUserMedia" in navigator));
    
    d.isie = (("all" in document) && ("attachEvent" in domtest) && !d.isopera);
    d.isieold = (d.isie && !("msInterpolationMode" in domtest.style));  // IE6 and older
    d.isie7 = d.isie&&!d.isieold&&(!("documentMode" in document)||(document.documentMode==7));
    d.isie8 = d.isie&&("documentMode" in document)&&(document.documentMode==8);
    d.isie9 = d.isie&&("performance" in window)&&(document.documentMode>=9);
    d.isie10 = d.isie&&("performance" in window)&&(document.documentMode>=10);
    
    d.isie9mobile = /iemobile.9/i.test(navigator.userAgent);  //wp 7.1 mango
    if (d.isie9mobile) d.isie9 = false;
    d.isie7mobile = (!d.isie9mobile&&d.isie7) && /iemobile/i.test(navigator.userAgent);  //wp 7.0
    
    d.ismozilla = ("MozAppearance" in domtest.style);
		
    d.iswebkit = ("WebkitAppearance" in domtest.style);
    
    d.ischrome = ("chrome" in window);
		d.ischrome22 = (d.ischrome&&d.haspointerlock);
    
    d.cantouch = ("ontouchstart" in document.documentElement);		
    d.hasmstouch = (window.navigator.msPointerEnabled||false);  // IE10+ pointer events
		
    d.ismac = /^mac$/i.test(navigator.platform);
    
    d.isios = (d.cantouch && /iphone|ipad|ipod/i.test(navigator.platform));
    d.isios4 = ((d.isios)&&!("seal" in Object));
    
    d.isandroid = (/android/i.test(navigator.userAgent));
    
    d.trstyle = false;
    d.hastransform = false;
    d.hastranslate3d = false;
    d.transitionstyle = false;
    d.hastransition = false;
    d.transitionend = false;
    
    var check = ['transform','msTransform','webkitTransform','MozTransform','OTransform'];
    for(var a=0;a<check.length;a++){
      if (typeof domtest.style[check[a]] != "undefined") {
        d.trstyle = check[a];
        break;
      }
    }
    d.hastransform = (d.trstyle != false);
    if (d.hastransform) {
      domtest.style[d.trstyle] = "translate3d(1px,2px,3px)";
      d.hastranslate3d = /translate3d/.test(domtest.style[d.trstyle]);
    }
    
    d.transitionstyle = false;
    d.prefixstyle = '';
    d.transitionend = false;
    var check = ['transition','webkitTransition','MozTransition','OTransition','OTransition','msTransition','KhtmlTransition'];
    var prefix = ['','-webkit-','-moz-','-o-','-o','-ms-','-khtml-'];
    var evs = ['transitionend','webkitTransitionEnd','transitionend','otransitionend','oTransitionEnd','msTransitionEnd','KhtmlTransitionEnd'];
    for(var a=0;a<check.length;a++) {
      if (check[a] in domtest.style) {
        d.transitionstyle = check[a];
        d.prefixstyle = prefix[a];
        d.transitionend = evs[a];
        break;
      }
    }
    d.hastransition = (d.transitionstyle);
    
    function detectCursorGrab() {      
      var lst = ['-moz-grab','-webkit-grab','grab'];
      if ((d.ischrome&&!d.ischrome22)||d.isie) lst=[];  // force setting for IE returns false positive and chrome cursor bug
      for(var a=0;a<lst.length;a++) {
        var p = lst[a];
        domtest.style['cursor']=p;
        if (domtest.style['cursor']==p) return p;
      }
      return 'url(http://www.google.com/intl/en_ALL/mapfiles/openhand.cur),n-resize';  // thank you google for custom cursor!
    }
    d.cursorgrabvalue = detectCursorGrab();

    d.hasmousecapture = ("setCapture" in domtest);
    
    domtest = null;  //memory released

    browserdetected = d;
    
    return d;  
  }
  
  var NiceScrollClass = function(myopt,me) {

    var self = this;

    this.version = '3.0.0';
    this.name = 'nicescroll';
    
    this.me = me;
    
    this.opt = {
      doc:$("body"),
      win:false,
      zindex:9000,
      cursoropacitymin:0,
      cursoropacitymax:1,
      cursorcolor:"#424242",
      cursorwidth:"5px",
      cursorborder:"1px solid #fff",
      cursorborderradius:"5px",
      scrollspeed:60,
      mousescrollstep:8*3,
      touchbehavior:false,
      hwacceleration:true,
      usetransition:true,
      boxzoom:false,
      dblclickzoom:true,
      gesturezoom:true,
      grabcursorenabled:true,
      autohidemode:true,
      background:"",
      iframeautoresize:true,
      cursorminheight:32,
      preservenativescrolling:true,
      railoffset:false,
      bouncescroll:true,
      spacebarenabled:true,
      railpadding:{top:0,right:0,left:0,bottom:0},
      disableoutline:true,
      horizrailenabled:true,
      railalign:"right",
      railvalign:"bottom",
      enabletranslate3d:true,
      enablemousewheel:true,
      enablekeyboard:true,
      smoothscroll:true,
      sensitiverail:true
    };
    
// Options for internal use
    this.opt.snapbackspeed = 80;
    
    if (myopt||false) {
      for(var a in self.opt) {
        if (typeof myopt[a] != "undefined") self.opt[a] = myopt[a];
      }
    }
    
    this.doc = self.opt.doc;
    this.iddoc = (this.doc&&this.doc[0])?this.doc[0].id||'':'';    
    this.ispage = /BODY|HTML/.test((self.opt.win)?self.opt.win[0].nodeName:this.doc[0].nodeName);
    this.haswrapper = (self.opt.win!==false);
    this.win = self.opt.win||(this.ispage?$(window):this.doc);
    this.docscroll = (this.ispage&&!this.haswrapper)?$(window):this.win;
    this.body = $("body");
    
    this.isfixed = false;
    
    this.iframe = false;
    this.isiframe = ((this.doc[0].nodeName == 'IFRAME') && (this.win[0].nodeName == 'IFRAME'));
    
    this.istextarea = (this.win[0].nodeName == 'TEXTAREA');
    
    this.forcescreen = false; //force to use screen position on events

    this.canshowonmouseevent = (self.opt.autohidemode!="scroll");
    
// Events jump table    
    this.onmousedown = false;
    this.onmouseup = false;
    this.onmousemove = false;
    this.onmousewheel = false;
    this.onkeypress = false;
    this.ongesturezoom = false;
    this.onclick = false;
    
// Nicescroll custom events
    this.onscrollstart = false;
    this.onscrollend = false;
    this.onscrollcancel = false;    
    
    this.onzoomin = false;
    this.onzoomout = false;
    
// Let's start!  
    this.view = false;
    this.page = false;
    
    this.scroll = {x:0,y:0};
    this.scrollratio = {x:0,y:0};    
    this.cursorheight = 20;
    this.scrollvaluemax = 0;
    
    this.scrollrunning = false;
    
    this.scrollmom = false;
    
    this.observer = false;
    
    do {
      this.id = "ascrail"+(ascrailcounter++);
    } while (document.getElementById(this.id));
    
    this.rail = false;
    this.cursor = false;
    this.cursorfreezed = false;  
    
    this.zoom = false;
    this.zoomactive = false;
    
    this.hasfocus = false;
    this.hasmousefocus = false;
    
    this.visibility = true;
    this.locked = false;
    this.hidden = false; // rails always hidden
    this.cursoractive = true; // user can interact with cursors
    
    this.nativescrollingarea = false;
    
    this.events = [];  // event list for unbind
    
    this.saved = {};
    
    this.delaylist = {};
    this.synclist = {};
    
    this.lastdeltax = 0;
    this.lastdeltay = 0;
    
    var cap = this.detected = getBrowserDetection();    
 
    this.canhwscroll = (cap.hastransform&&self.opt.hwacceleration);
    this.ishwscroll = (this.canhwscroll&&self.haswrapper);
    
    this.istouchcapable = false;  // desktop devices with touch screen support
    
//## Check Chrome 22 bug on touch devices
    if (cap.cantouch&&cap.ischrome&&!cap.isios&&!cap.isandroid) {
      this.istouchcapable = true;
      cap.cantouch = false;  // parse normal desktop events
    }    

//## Firefox 18 nightly build (desktop) false positive
    if (cap.cantouch&&cap.ismozilla&&!cap.isios) {
      this.istouchcapable = true;
      cap.cantouch = false;  // parse normal desktop events
    }    
    
    this.delayed = function(name,fn,tm,lazy) {
      var dd = self.delaylist[name];
      var nw = (new Date()).getTime();
      if (!lazy&&dd&&dd.tt) return false;
      if (dd&&dd.tt) clearTimeout(dd.tt);
      if (dd&&dd.last+tm>nw&&!dd.tt) {      
        self.delaylist[name] = {
          last:nw+tm,
          tt:setTimeout(function(){self.delaylist[name].tt=0;fn.call();},tm)
        }
      }
      else if (!dd||!dd.tt) {
        self.delaylist[name] = {
          last:nw,
          tt:0
        }
        setTimeout(function(){fn.call();},0);
      }
    };
    
    this.synched = function(name,fn) {
    
      function requestSync() {
        if (self.onsync) return;
        setAnimationFrame(function(){
          self.onsync = false;
          for(name in self.synclist){
            var fn = self.synclist[name];
            if (fn) fn.call(self);
            self.synclist[name] = false;
          }
        });
        self.onsync = true;
      };    
    
      self.synclist[name] = fn;
      requestSync();
      return name;
    };
    
    this.unsynched = function(name) {
      if (self.synclist[name]) self.synclist[name] = false;
    }
    
    this.css = function(el,pars) {  // save & set
      for(var n in pars) {
        self.saved.css.push([el,n,el.css(n)]);
        el.css(n,pars[n]);
      }
    };
    
    this.scrollTop = function(val) {
      return (typeof val == "undefined") ? self.getScrollTop() : self.setScrollTop(val);
    };

    this.scrollLeft = function(val) {
      return (typeof val == "undefined") ? self.getScrollLeft() : self.setScrollLeft(val);
    };
    
// derived by by Dan Pupius www.pupius.net
    BezierClass = function(st,ed,spd,p1,p2,p3,p4) {
      this.st = st;
      this.ed = ed;
      this.spd = spd;
      
      this.p1 = p1||0;
      this.p2 = p2||1;
      this.p3 = p3||0;
      this.p4 = p4||1;
      
      this.ts = (new Date()).getTime();
      this.df = this.ed-this.st;
    };
    BezierClass.prototype = {
      B2:function(t){ return 3*t*t*(1-t) },
      B3:function(t){ return 3*t*(1-t)*(1-t) },
      B4:function(t){ return (1-t)*(1-t)*(1-t) },
      getNow:function(){
        var nw = (new Date()).getTime();
        var pc = 1-((nw-this.ts)/this.spd);
        var bz = this.B2(pc) + this.B3(pc) + this.B4(pc);
        return (pc<0) ? this.ed : this.st+Math.round(this.df*bz);
      },
      update:function(ed,spd){
        this.st = this.getNow();
        this.ed = ed;
        this.spd = spd;
        this.ts = (new Date()).getTime();
        this.df = this.ed-this.st;
        return this;
      }
    };
    
    if (this.ishwscroll) {  
    // hw accelerated scroll
      this.doc.translate = {x:0,y:0,tx:"0px",ty:"0px"};
      
      if (cap.hastranslate3d&&cap.isios) this.doc.css("-webkit-backface-visibility","hidden");  // prevent flickering http://stackoverflow.com/questions/3461441/      
      
      //derived from http://stackoverflow.com/questions/11236090/
      function getMatrixValues() {
        var tr = self.doc.css(cap.trstyle);
        if (tr&&(tr.substr(0,6)=="matrix")) {
          return tr.replace(/^.*\((.*)\)$/g, "$1").replace(/px/g,'').split(/, +/);
        }
        return false;
      }
      
      this.getScrollTop = function(last) {
        if (!last) {
          var mtx = getMatrixValues();
          if (mtx) return (mtx.length==16) ? -mtx[13] : -mtx[5];  //matrix3d 16 on IE10
          if (self.timerscroll&&self.timerscroll.bz) return self.timerscroll.bz.getNow();
        }
        return self.doc.translate.y;
      };

      this.getScrollLeft = function(last) {
        if (!last) {
          var mtx = getMatrixValues();          
          if (mtx) return (mtx.length==16) ? -mtx[12] : -mtx[4];  //matrix3d 16 on IE10
          if (self.timerscroll&&self.timerscroll.bh) return self.timerscroll.bh.getNow();
        }
        return self.doc.translate.x;
      };
      
      if (document.createEvent) {
        this.notifyScrollEvent = function(el) {
          var e = document.createEvent("UIEvents");
          e.initUIEvent("scroll", false, true, window, 1);
          el.dispatchEvent(e);
        };
      }
      else if (document.fireEvent) {
        this.notifyScrollEvent = function(el) {
          var e = document.createEventObject();
          el.fireEvent("onscroll");
          e.cancelBubble = true; 
        };
      }
      else {
        this.notifyScrollEvent = function(el,add) {}; //NOPE
      }
      
      if (cap.hastranslate3d&&self.opt.enabletranslate3d) {
        this.setScrollTop = function(val,silent) {
          self.doc.translate.y = val;
          self.doc.translate.ty = (val*-1)+"px";
          self.doc.css(cap.trstyle,"translate3d("+self.doc.translate.tx+","+self.doc.translate.ty+",0px)");          
          if (!silent) self.notifyScrollEvent(self.win[0]);
        };
        this.setScrollLeft = function(val,silent) {          
          self.doc.translate.x = val;
          self.doc.translate.tx = (val*-1)+"px";
          self.doc.css(cap.trstyle,"translate3d("+self.doc.translate.tx+","+self.doc.translate.ty+",0px)");          
          if (!silent) self.notifyScrollEvent(self.win[0]);
        };
      } else {
        this.setScrollTop = function(val,silent) {
          self.doc.translate.y = val;
          self.doc.translate.ty = (val*-1)+"px";
          self.doc.css(cap.trstyle,"translate("+self.doc.translate.tx+","+self.doc.translate.ty+")");
          if (!silent) self.notifyScrollEvent(self.win[0]);          
        };
        this.setScrollLeft = function(val,silent) {        
          self.doc.translate.x = val;
          self.doc.translate.tx = (val*-1)+"px";
          self.doc.css(cap.trstyle,"translate("+self.doc.translate.tx+","+self.doc.translate.ty+")");
          if (!silent) self.notifyScrollEvent(self.win[0]);
        };
      }
    } else {
    // native scroll
      this.getScrollTop = function() {
        return self.docscroll.scrollTop();
      };
      this.setScrollTop = function(val) {        
        return self.docscroll.scrollTop(val);
      };
      this.getScrollLeft = function() {
        return self.docscroll.scrollLeft();
      };
      this.setScrollLeft = function(val) {
        return self.docscroll.scrollLeft(val);
      };
    }
    
    this.getTarget = function(e) {
      if (!e) return false;
      if (e.target) return e.target;
      if (e.srcElement) return e.srcElement;
      return false;
    };
    
    this.hasParent = function(e,id) {
      if (!e) return false;
      var el = e.target||e.srcElement||e||false;
      while (el && el.id != id) {
        el = el.parentNode||false;
      }
      return (el!==false);
    };
    
//inspired by http://forum.jquery.com/topic/width-includes-border-width-when-set-to-thin-medium-thick-in-ie
    var _convertBorderWidth = {"thin":1,"medium":3,"thick":5};
    function getWidthToPixel(dom,prop,chkheight) {
      var wd = dom.css(prop);
      var px = parseFloat(wd);
      if (isNaN(px)) {
        px = _convertBorderWidth[wd]||0;
        var brd = (px==3) ? ((chkheight)?(self.win.outerHeight() - self.win.innerHeight()):(self.win.outerWidth() - self.win.innerWidth())) : 1; //DON'T TRUST CSS
        if (self.isie8&&px) px+=1;
        return (brd) ? px : 0; 
      }
      return px;
    };
    
    this.updateScrollBar = function(len) {
      if (self.ishwscroll) {
        self.rail.css({height:self.win.innerHeight()});
        if (self.railh) self.railh.css({width:self.win.innerWidth()});
      } else {
        var wpos = (self.isfixed) ? {top:parseFloat(self.win.css('top')),left:parseFloat(self.win.css('left'))}  : self.win.offset();        
        var pos = {top:wpos.top,left:wpos.left};
        pos.top+= getWidthToPixel(self.win,'border-top-width',true);
        var brd = (self.win.outerWidth() - self.win.innerWidth())/2;
        pos.left+= (self.rail.align) ? self.win.outerWidth() - getWidthToPixel(self.win,'border-right-width') - self.rail.width : getWidthToPixel(self.win,'border-left-width');
        
        var off = self.opt.railoffset;
        if (off) {
          if (off.top) pos.top+=off.top;
          if (self.rail.align&&off.left) pos.left+=off.left;
        }
        
				if (!self.locked) self.rail.css({top:pos.top,left:pos.left,height:(len)?len.h:self.win.innerHeight()});
				
				if (self.zoom) {				  
				  self.zoom.css({top:pos.top+1,left:(self.rail.align==1) ? pos.left-20 : pos.left+self.rail.width+4});
			  }
				
				if (self.railh&&!self.locked) {
					var pos = {top:wpos.top,left:wpos.left};
					var y = (self.railh.align) ? pos.top + getWidthToPixel(self.win,'border-top-width',true) + self.win.innerHeight() - self.railh.height : pos.top + getWidthToPixel(self.win,'border-top-width',true);
					var x = pos.left + getWidthToPixel(self.win,'border-left-width');
					self.railh.css({top:y,left:x,width:self.railh.width});
				}
		
				
      }
    };
    
    this.doRailClick = function(e,dbl,hr) {

      var fn,pg,cur,pos;
      
      if (self.rail.drag&&self.rail.drag.pt!=1) return;
      if (self.locked) return;
      if (self.rail.drag) return;

      self.cancelScroll();       
      
      self.cancelEvent(e);
      
      if (dbl) {
        fn = (hr) ? self.doScrollLeft : self.doScrollTop;
        cur = (hr) ? ((e.pageX - self.railh.offset().left - (self.cursorwidth/2)) * self.scrollratio.x) : ((e.pageY - self.rail.offset().top - (self.cursorheight/2)) * self.scrollratio.y);
        fn(cur);
      } else {
        fn = (hr) ? self.doScrollLeftBy : self.doScrollBy;
        cur = (hr) ? self.scroll.x : self.scroll.y;
        pos = (hr) ? e.pageX - self.railh.offset().left : e.pageY - self.rail.offset().top;
        pg = (hr) ? self.view.w : self.view.h;        
        (cur>=pos) ? fn(pg) : fn(-pg);
      }
    
    }
    
    self.hasanimationframe = (setAnimationFrame);
    self.hascancelanimationframe = (clearAnimationFrame);
    
    if (!self.hasanimationframe) {
      setAnimationFrame=function(fn){return setTimeout(fn,16)}; // 1000/60)};
      clearAnimationFrame=clearInterval;
    } 
    else if (!self.hascancelanimationframe) clearAnimationFrame=function(){self.cancelAnimationFrame=true};
    
    this.init = function() {

      self.saved.css = [];
      
      if (cap.isie7mobile) return true; // SORRY, DO NOT WORK!
      
      if (cap.hasmstouch) self.css((self.ispage)?$("html"):self.win,{'-ms-touch-action':'none'});
      
/*      
      self.ispage = true;
      self.haswrapper = true;
//      self.win = $(window);
      self.docscroll = $("body");
//      self.doc = $("body");
*/
      
      if (!self.ispage || (!cap.cantouch && !cap.isieold && !cap.isie9mobile)) {
      
        var cont = self.docscroll;
        if (self.ispage) cont = (self.haswrapper)?self.win:self.doc;
        
        if (!cap.isie9mobile) self.css(cont,{'overflow-y':'hidden'});      
        
        if (self.ispage&&cap.isie7) {
          if (self.doc[0].nodeName=='BODY') self.css($("html"),{'overflow-y':'hidden'});  //IE7 double scrollbar issue
          else if (self.doc[0].nodeName=='HTML') self.css($("body"),{'overflow-y':'hidden'});  //IE7 double scrollbar issue
        }
        
        if (cap.isios&&!self.ispage&&!self.haswrapper) self.css($("body"),{"-webkit-overflow-scrolling":"touch"});  //force hw acceleration
        
        var cursor = $(document.createElement('div'));
        cursor.css({
          position:"relative",top:0,"float":"right",width:self.opt.cursorwidth,height:"0px",
          'background-color':self.opt.cursorcolor,
          border:self.opt.cursorborder,
          'background-clip':'padding-box',
          '-webkit-border-radius':self.opt.cursorborderradius,
          '-moz-border-radius':self.opt.cursorborderradius,
          'border-radius':self.opt.cursorborderradius
        });   
        
        cursor.hborder = parseFloat(cursor.outerHeight() - cursor.innerHeight());        
        self.cursor = cursor;        
        
        var rail = $(document.createElement('div'));
        rail.attr('id',self.id);
        
        var v,a,kp = ["left","right"];  //"top","bottom"
        for(var n in kp) {
          a=kp[n];
          v = self.opt.railpadding[a];
          (v) ? rail.css("padding-"+a,v+"px") : self.opt.railpadding[a] = 0;
        }
        
        rail.append(cursor);
        
        rail.width = Math.max(parseFloat(self.opt.cursorwidth),cursor.outerWidth()) + self.opt.railpadding['left'] + self.opt.railpadding['right'];
        rail.css({width:rail.width+"px",'zIndex':(self.ispage)?self.opt.zindex:self.opt.zindex+2,"background":self.opt.background});        
        
        rail.visibility = true;
        rail.scrollable = true;
        
        rail.align = (self.opt.railalign=="left") ? 0 : 1;
        
        self.rail = rail;
        
        self.rail.drag = false;
        
        var zoom = false;
        if (self.opt.boxzoom&&!self.ispage&&!cap.isieold) {
          zoom = document.createElement('div');          
          self.bind(zoom,"click",self.doZoom);
          self.zoom = $(zoom);
          self.zoom.css({"cursor":"pointer",'z-index':self.opt.zindex,'backgroundImage':'url('+scriptpath+'zoomico.png)','height':18,'width':18,'backgroundPosition':'0px 0px'});
          if (self.opt.dblclickzoom) self.bind(self.win,"dblclick",self.doZoom);
          if (cap.cantouch&&self.opt.gesturezoom) {
            self.ongesturezoom = function(e) {
              if (e.scale>1.5) self.doZoomIn(e);
              if (e.scale<0.8) self.doZoomOut(e);
              return self.cancelEvent(e);
            };
            self.bind(self.win,"gestureend",self.ongesturezoom);             
          }
        }
        
// init HORIZ

        self.railh = false;

        if (self.opt.horizrailenabled) {

          self.css(cont,{'overflow-x':'hidden'});

          var cursor = $(document.createElement('div'));
          cursor.css({
            position:"relative",top:0,height:self.opt.cursorwidth,width:"0px",
            'background-color':self.opt.cursorcolor,
            border:self.opt.cursorborder,
            'background-clip':'padding-box',
            '-webkit-border-radius':self.opt.cursorborderradius,
            '-moz-border-radius':self.opt.cursorborderradius,
            'border-radius':self.opt.cursorborderradius
          });   
          
          cursor.wborder = parseFloat(cursor.outerWidth() - cursor.innerWidth());
          self.cursorh = cursor;
          
          var railh = $(document.createElement('div'));
          railh.attr('id',self.id+'-hr');
          railh.height = 1+Math.max(parseFloat(self.opt.cursorwidth),cursor.outerHeight());
          railh.css({height:railh.height+"px",'zIndex':(self.ispage)?self.opt.zindex:self.opt.zindex+2,"background":self.opt.background});
          
          railh.append(cursor);
          
          railh.visibility = true;
          railh.scrollable = true;
          
          railh.align = (self.opt.railvalign=="top") ? 0 : 1;
          
          self.railh = railh;
          
          self.railh.drag = false;
          
        }
        
//        
        
        if (self.ispage) {
          rail.css({position:"fixed",top:"0px",height:"100%"});
          (rail.align) ? rail.css({right:"0px"}) : rail.css({left:"0px"});
          self.body.append(rail);
          if (self.railh) {
            railh.css({position:"fixed",left:"0px",width:"100%"});
            (railh.align) ? railh.css({bottom:"0px"}) : railh.css({top:"0px"});
            self.body.append(railh);
          }
        } else {          
          if (self.ishwscroll) {
            if (self.win.css('position')=='static') self.css(self.win,{'position':'relative'});
            var bd = (self.win[0].nodeName == 'HTML') ? self.body : self.win;
            if (self.zoom) {
              self.zoom.css({position:"absolute",top:1,right:0,"margin-right":rail.width+4});
              bd.append(self.zoom);
            }
            rail.css({position:"absolute",top:0});
            (rail.align) ? rail.css({right:0}) : rail.css({left:0});
            bd.append(rail);
            if (railh) {
              railh.css({position:"absolute",left:0,bottom:0});
              (railh.align) ? railh.css({bottom:0}) : railh.css({top:0});
              bd.append(railh);
            }
          } else {
            self.isfixed = (self.win.css("position")=="fixed");
            var rlpos = (self.isfixed) ? "fixed" : "absolute";
            (rail.align) ? rail.css({right:"0px"}) : rail.css({left:"0px"});
            rail.css({position:rlpos});
            if (self.zoom) self.zoom.css({position:rlpos});
            self.updateScrollBar();
            self.body.append(rail);           
            if (self.zoom) self.body.append(self.zoom);
            if (self.railh) {
              railh.css({position:rlpos});
              self.body.append(railh);           
            }
          }
          
          if (cap.isios) self.css(self.win,{'-webkit-tap-highlight-color':'rgba(0,0,0,0)','-webkit-touch-callout':'none'});  // prevent grey layer on click
          
					if (cap.isie&&self.opt.disableoutline) self.win.attr("hideFocus","true");  // IE, prevent dotted rectangle on focused div
					if (cap.iswebkit&&self.opt.disableoutline) self.win.css({"outline":"none"});
          
        }
        
        if (self.opt.autohidemode===false) {
          self.autohidedom = false;
        }
        else if (self.opt.autohidemode===true) {
          self.autohidedom = $().add(self.rail);
          if (self.railh) self.autohidedom=self.autohidedom.add(self.railh);
        }
        else if (self.opt.autohidemode=="scroll") {
          self.autohidedom = $().add(self.rail);
          if (self.railh) self.autohidedom=self.autohidedom.add(self.railh);
        }
        else if (self.opt.autohidemode=="cursor") {
          self.autohidedom = $().add(self.cursor);
          if (self.railh) self.autohidedom=self.autohidedom.add(self.railh.cursor);
        }
        else if (self.opt.autohidemode=="hidden") {
          self.autohidedom = false;
          self.hide();
          self.locked = false;
        }
        
        if (cap.isie9mobile) {

          self.scrollmom = new ScrollMomentumClass2D(self);        

          /*
          var trace = function(msg) {
            var db = $("#debug");
            if (isNaN(msg)&&(typeof msg != "string")) {
              var x = [];
              for(var a in msg) {
                x.push(a+":"+msg[a]);
              }
              msg ="{"+x.join(",")+"}";
            }
            if (db.children().length>0) {
              db.children().eq(0).before("<div>"+msg+"</div>");
            } else {
              db.append("<div>"+msg+"</div>");
            }
          }
          window.onerror = function(msg,url,ln) {
            trace("ERR: "+msg+" at "+ln);
          }
*/          
  
          self.onmangotouch = function(e) {
            var py = self.getScrollTop();
            var px = self.getScrollLeft();
            
            if ((py == self.scrollmom.lastscrolly)&&(px == self.scrollmom.lastscrollx)) return true;
//            $("#debug").html('DRAG:'+py);

            var dfy = py-self.mangotouch.sy;
            var dfx = px-self.mangotouch.sx;            
            var df = Math.round(Math.sqrt(Math.pow(dfx,2)+Math.pow(dfy,2)));            
            if (df==0) return;
            
            var dry = (dfy<0)?-1:1;
            var drx = (dfx<0)?-1:1;
            
            var tm = +new Date();
            if (self.mangotouch.lazy) clearTimeout(self.mangotouch.lazy);
            
            if (((tm-self.mangotouch.tm)>80)||(self.mangotouch.dry!=dry)||(self.mangotouch.drx!=drx)) {
//              trace('RESET+'+(tm-self.mangotouch.tm));
              self.scrollmom.stop();
              self.scrollmom.reset(px,py);
              self.mangotouch.sy = py;
              self.mangotouch.ly = py;
              self.mangotouch.sx = px;
              self.mangotouch.lx = px;
              self.mangotouch.dry = dry;
              self.mangotouch.drx = drx;
              self.mangotouch.tm = tm;
            } else {
              
              self.scrollmom.stop();
              self.scrollmom.update(self.mangotouch.sx-dfx,self.mangotouch.sy-dfy);
              var gap = tm - self.mangotouch.tm;              
              self.mangotouch.tm = tm;
              
//              trace('MOVE:'+df+" - "+gap);
              
              var ds = Math.max(Math.abs(self.mangotouch.ly-py),Math.abs(self.mangotouch.lx-px));
              self.mangotouch.ly = py;
              self.mangotouch.lx = px;
              
              if (ds>2) {
                self.mangotouch.lazy = setTimeout(function(){
//                  trace('END:'+ds+'+'+gap);                  
                  self.mangotouch.lazy = false;
                  self.mangotouch.dry = 0;
                  self.mangotouch.drx = 0;
                  self.mangotouch.tm = 0;                  
                  self.scrollmom.doMomentum(30);
                },100);
              }
            }
          }
          
          var top = self.getScrollTop();
          var lef = self.getScrollLeft();
          self.mangotouch = {sy:top,ly:top,dry:0,sx:lef,lx:lef,drx:0,lazy:false,tm:0};
          
          self.bind(self.docscroll,"scroll",self.onmangotouch);
        
        } else {
        
          if (cap.cantouch||self.istouchcapable||self.opt.touchbehavior||cap.hasmstouch) {
          
            self.scrollmom = new ScrollMomentumClass2D(self);
          
            self.ontouchstart = function(e) {
              if (e.pointerType&&e.pointerType!=2) return false;
              
              if (!self.locked) {
              
                if (cap.hasmstouch) {
                  var tg = (e.target) ? e.target : false;
                  while (tg) {
                    var nc = $(tg).getNiceScroll();
                    if ((nc.length>0)&&(nc[0].me == self.me)) break;
                    if (nc.length>0) return false;
                    if ((tg.nodeName=='DIV')&&(tg.id==self.id)) break;
                    tg = (tg.parentNode) ? tg.parentNode : false;
                  }
                }
              
                self.cancelScroll();
                
                var tg = self.getTarget(e);
                
                if (tg) {
                  var skp = (/INPUT/i.test(tg.nodeName))&&(/range/i.test(tg.type));
                  if (skp) return self.stopPropagation(e);
                }
                
                if (self.forcescreen) {
                  var le = e;
                  var e = {"original":(e.original)?e.original:e};
                  e.clientX = le.screenX;
                  e.clientY = le.screenY;    
                }
                
                self.rail.drag = {x:e.clientX,y:e.clientY,sx:self.scroll.x,sy:self.scroll.y,st:self.getScrollTop(),sl:self.getScrollLeft(),pt:2};
                
                if (self.opt.touchbehavior&&self.isiframe&&cap.isie) {
                  var wp = self.win.position();
                  self.rail.drag.x+=wp.left;
                  self.rail.drag.y+=wp.top;
                }
                
                self.hasmoving = false;
                self.lastmouseup = false;
                self.scrollmom.reset(e.clientX,e.clientY);
                if (!cap.cantouch&&!this.istouchcapable&&!cap.hasmstouch) {
                  
                  var ip = (tg)?/INPUT|SELECT|TEXTAREA/i.test(tg.nodeName):false;
                  if (!ip) {
                    if (!self.ispage&&cap.hasmousecapture) tg.setCapture();
                    return self.cancelEvent(e);
                  }
                  if (/SUBMIT|CANCEL|BUTTON/i.test($(tg).attr('type'))) {
                    pc = {"tg":tg,"click":false};
                    self.preventclick = pc;
                  }
                }
              }
              
            };
            
            self.ontouchend = function(e) {
              if (e.pointerType&&e.pointerType!=2) return false;
              if (self.rail.drag&&(self.rail.drag.pt==2)) {            
                self.scrollmom.doMomentum();
                self.rail.drag = false;
                if (self.hasmoving) {
                  self.hasmoving = false;
                  self.lastmouseup = true;
                  self.hideCursor();
                  if (cap.hasmousecapture) document.releaseCapture();
                  if (!cap.cantouch) return self.cancelEvent(e);
                }                            
              }                        
              
            };
            
            var moveneedoffset = (self.opt.touchbehavior&&self.isiframe&&!cap.hasmousecapture);
            
            self.ontouchmove = function(e,byiframe) {
              
              if (e.pointerType&&e.pointerType!=2) return false;
    
              if (self.rail.drag&&(self.rail.drag.pt==2)) {
                if (cap.cantouch&&(typeof e.original == "undefined")) return true;  // prevent ios "ghost" events by clickable elements
              
                self.hasmoving = true;

                if (self.preventclick&&!self.preventclick.click) {
                  self.preventclick.click = self.preventclick.tg.onclick||false;                
                  self.preventclick.tg.onclick = self.onpreventclick;
                }
                
                if (self.forcescreen) {
                  var le = e;
                  var e = {"original":(e.original)?e.original:e};
                  e.clientX = le.screenX;
                  e.clientY = le.screenY;      
                }
                
                var ofx = ofy = 0;
                
                if (moveneedoffset&&!byiframe) {
                  var wp = self.win.position();
                  ofx=-wp.left;
                  ofy=-wp.top;
                }                
                
                var fy = e.clientY + ofy;
                var my = (fy-self.rail.drag.y);
                
                var ny = self.rail.drag.st-my;
                
                if (self.ishwscroll&&self.opt.bouncescroll) {
                  if (ny<0) {
                    ny = Math.round(ny/2);
//                    fy = 0;
                  }
                  else if (ny>self.page.maxh) {
                    ny = self.page.maxh+Math.round((ny-self.page.maxh)/2);
//                    fy = 0;
                  }
                } else {
                  if (ny<0) {ny=0;fy=0}
                  if (ny>self.page.maxh) {ny=self.page.maxh;fy=0}
                }
                  
                var fx = e.clientX + ofx;
                  
                if (self.railh&&self.railh.scrollable) {

                  var mx = (fx-self.rail.drag.x);
                  
                  var nx = self.rail.drag.sl-mx;
                  
                  if (self.ishwscroll&&self.opt.bouncescroll) {                  
                    if (nx<0) {
                      nx = Math.round(nx/2);
//                      fx = 0;
                    }
                    else if (nx>self.page.maxw) {
                      nx = self.page.maxw+Math.round((nx-self.page.maxw)/2);
//                      fx = 0;
                    }
                  } else {
                    if (nx<0) {nx=0;fx=0}
                    if (nx>self.page.maxw) {nx=self.page.maxw;fx=0}
                  }
                
                }
                              
                self.synched("touchmove",function(){
                  if (self.rail.drag&&(self.rail.drag.pt==2)) {
                    if (self.prepareTransition) self.prepareTransition(0);
                    if (self.rail.scrollable) self.setScrollTop(ny);
                    self.scrollmom.update(fx,fy);
                    if (self.railh&&self.railh.scrollable) {
                      self.setScrollLeft(nx);
                      self.showCursor(ny,nx);
                    } else {
                      self.showCursor(ny);
                    }
                    if (cap.isie10) document.selection.clear();
                  }
                });

                return self.cancelEvent(e);
              }
              
            };
          
          }
         
          if (cap.cantouch||self.opt.touchbehavior) {
          
            self.onpreventclick = function(e) {
              if (self.preventclick) {
                self.preventclick.tg.onclick = self.preventclick.click;
                self.preventclick = false;            
                return self.cancelEvent(e);
              }
            }
          
            self.onmousedown = self.ontouchstart;
            
            self.onmouseup = self.ontouchend;

            self.onclick = (cap.isios) ? false : function(e) { 
              if (self.lastmouseup) {
                self.lastmouseup = false;
                return self.cancelEvent(e);
              } else {
                return true;
              }
            }; 
            
            self.onmousemove = self.ontouchmove;
            
            if (cap.cursorgrabvalue) {
              self.css((self.ispage)?self.doc:self.win,{'cursor':cap.cursorgrabvalue});            
              self.css(self.rail,{'cursor':cap.cursorgrabvalue});
            }
            
          } else {
          
            self.onmousedown = function(e,hronly) {            
              if (self.rail.drag&&self.rail.drag.pt!=1) return;
              if (self.locked) return self.cancelEvent(e);            
              self.cancelScroll();              
              self.rail.drag = {x:e.clientX,y:e.clientY,sx:self.scroll.x,sy:self.scroll.y,pt:1,hr:(!!hronly)};
              var tg = self.getTarget(e);
              if (!self.ispage&&cap.hasmousecapture) tg.setCapture();
              if (self.isiframe&&!cap.hasmousecapture) {
                self.saved["csspointerevents"] = self.doc.css("pointer-events");
                self.css(self.doc,{"pointer-events":"none"});
              }
              return self.cancelEvent(e);
            };
            self.onmouseup = function(e) {
              if (self.rail.drag) {
                if (cap.hasmousecapture) document.releaseCapture();
                if (self.isiframe&&!cap.hasmousecapture) self.doc.css("pointer-events",self.saved["csspointerevents"]);
                if(self.rail.drag.pt!=1)return;
                self.rail.drag = false;
                //if (!self.rail.active) self.hideCursor();
                return self.cancelEvent(e);
              }
            };        
            self.onmousemove = function(e) {

              if (self.rail.drag) {
                if(self.rail.drag.pt!=1)return;
                
                if (cap.ischrome&&e.which==0) return self.onmouseup(e);
                
                self.cursorfreezed = true;
                    
                if (self.rail.drag.hr) {
                  self.scroll.x = self.rail.drag.sx + (e.clientX-self.rail.drag.x);
                  if (self.scroll.x<0) self.scroll.x=0;
                  var mw = self.scrollvaluemaxw;
                  if (self.scroll.x>mw) self.scroll.x=mw;
                } else {                
                  self.scroll.y = self.rail.drag.sy + (e.clientY-self.rail.drag.y);
                  if (self.scroll.y<0) self.scroll.y=0;
                  var my = self.scrollvaluemax;
                  if (self.scroll.y>my) self.scroll.y=my;
                }
                
                self.synched('mousemove',function(){
                  if (self.rail.drag&&(self.rail.drag.pt==1)) {
                    self.showCursor();
                    if (self.rail.drag.hr) self.doScrollLeft(Math.round(self.scroll.x*self.scrollratio.x));
                    else self.doScrollTop(Math.round(self.scroll.y*self.scrollratio.y));
                  }
                });
                return self.cancelEvent(e);
              } else {
                self.checkarea = true;
              }
              
            };
          }

          if (cap.cantouch||self.opt.touchbehavior) {
            self.bind(self.win,"mousedown",self.onmousedown);
          }
          
          if (cap.hasmstouch) {
            self.css(self.rail,{'-ms-touch-action':'none'});
            self.css(self.cursor,{'-ms-touch-action':'none'});
            
            self.bind(self.win,"MSPointerDown",self.ontouchstart);
            self.bind(document,"MSPointerUp",self.ontouchend);
            self.bind(document,"MSPointerMove",self.ontouchmove);
            self.bind(self.cursor,"MSGestureHold",function(e){e.preventDefault();});
            self.bind(self.cursor,"contextmenu",function(e){e.preventDefault();});
          }

          if (this.istouchcapable) {  //device with screen touch enabled
            self.bind(self.win,"touchstart",self.ontouchstart);
            self.bind(document,"touchend",self.ontouchend);
            self.bind(document,"touchmove",self.ontouchmove);            
          }
          
          self.bind(self.cursor,"mousedown",self.onmousedown);
          self.bind(self.cursor,"mouseup",self.onmouseup);      

          if (self.railh) {
            self.bind(self.cursorh,"mousedown",function(e){self.onmousedown(e,true)});
            self.bind(self.cursorh,"mouseup",function(e){
              if (self.rail.drag&&self.rail.drag.pt==2) return;
              self.rail.drag = false;
              self.hasmoving = false;
              self.hideCursor();
              if (cap.hasmousecapture) document.releaseCapture();
              return self.cancelEvent(e);
            });
          }
          
          self.bind(document,"mouseup",self.onmouseup);
          if (cap.hasmousecapture) self.bind(self.win,"mouseup",self.onmouseup);
          
          self.bind(document,"mousemove",self.onmousemove);
          if (self.onclick) self.bind(document,"click",self.onclick);
		
          if (!cap.cantouch&&!self.opt.touchbehavior) {
					
            self.rail.mouseenter(function() {
              if (self.canshowonmouseevent) self.showCursor();
              self.rail.active = true;
            });
            self.rail.mouseleave(function() { 
              self.rail.active = false;
              if (!self.rail.drag) self.hideCursor();
            });
            
            if (self.opt.sensitiverail) {
              self.rail.click(function(e){self.doRailClick(e,false,false)});
              self.rail.dblclick(function(e){self.doRailClick(e,true,false)});
              self.cursor.click(function(e){self.cancelEvent(e)});
              self.cursor.dblclick(function(e){self.cancelEvent(e)});
            }
            
            if (self.railh) {
              self.railh.mouseenter(function() {
                if (self.canshowonmouseevent) self.showCursor();
                self.rail.active = true;
              });          
              self.railh.mouseleave(function() { 
                self.rail.active = false;
                if (!self.rail.drag) self.hideCursor();
              });
            }

						if (self.zoom) {
							self.zoom.mouseenter(function() {
								if (self.canshowonmouseevent) self.showCursor();
								self.rail.active = true;
							});          
							self.zoom.mouseleave(function() { 
								self.rail.active = false;
								if (!self.rail.drag) self.hideCursor();
							});
						}

          }
						
					if (self.opt.enablemousewheel) {
						if (!self.isiframe) self.bind((cap.isie&&self.ispage) ? document : self.docscroll,"mousewheel",self.onmousewheel);
						self.bind(self.rail,"mousewheel",self.onmousewheel);
						if (self.railh) self.bind(self.railh,"mousewheel",self.onmousewheelhr);
					}						
						
          if (!self.ispage&&!cap.cantouch&&!(/HTML|BODY/.test(self.win[0].nodeName))) {
            if (!self.win.attr("tabindex")) self.win.attr({"tabindex":tabindexcounter++});
            
            self.win.focus(function(e) {
              domfocus = (self.getTarget(e)).id||true;
              self.hasfocus = true;
              if (self.canshowonmouseevent) self.noticeCursor();
            });
            self.win.blur(function(e) {
              domfocus = false;
              self.hasfocus = false;
            });
            
            self.win.mouseenter(function(e) {
              mousefocus = (self.getTarget(e)).id||true;
              self.hasmousefocus = true;
              if (self.canshowonmouseevent) self.noticeCursor();
            });
            self.win.mouseleave(function() {
              mousefocus = false;
              self.hasmousefocus = false;
            });
            
          };
          
        }  // !ie9mobile
        
        //Thanks to http://www.quirksmode.org !!
        self.onkeypress = function(e) {
          if (self.locked&&self.page.maxh==0) return true;
          
          e = (e) ? e : window.e;
          var tg = self.getTarget(e);
          if (tg&&/INPUT|TEXTAREA|SELECT|OPTION/.test(tg.nodeName)) {
            var tp = tg.getAttribute('type')||tg.type||false;            
            if ((!tp)||!(/submit|button|cancel/i.tp)) return true;
          }
          
          if (self.hasfocus||(self.hasmousefocus&&!domfocus)||(self.ispage&&!domfocus&&!mousefocus)) {
            var key = e.keyCode;
            var ctrl = e.ctrlKey||false;
            
            if (self.locked&&key!=27) return self.cancelEvent(e);
            
            var ret = false;
            switch (key) {
              case 38:
              case 63233: //safari
                self.doScrollBy(24*3);
                ret = true;
                break;
              case 40:
              case 63235: //safari
                self.doScrollBy(-24*3);
                ret = true;
                break;
              case 37:
              case 63232: //safari
                if (self.railh) {
                  (ctrl) ? self.doScrollLeft(0) : self.doScrollLeftBy(24*3);
                  ret = true;
                }
                break;
              case 39:
              case 63234: //safari
                if (self.railh) {
                  (ctrl) ? self.doScrollLeft(self.page.maxw) : self.doScrollLeftBy(-24*3);
                  ret = true;
                }
                break;
              case 33:
              case 63276: // safari
                self.doScrollBy(self.view.h);
                ret = true;
                break;
              case 34:
              case 63277: // safari
                self.doScrollBy(-self.view.h);
                ret = true;
                break;
              case 36:
              case 63273: // safari                
                (self.railh&&ctrl) ? self.doScrollPos(0,0) : self.doScrollTo(0);
                ret = true;
                break;
              case 35:
              case 63275: // safari
                (self.railh&&ctrl) ? self.doScrollPos(self.page.maxw,self.page.maxh) : self.doScrollTo(self.page.maxh);
                ret = true;
                break;
              case 32:
                if (self.opt.spacebarenabled) {
                  self.doScrollBy(-self.view.h);
                  ret = true;
                }
                break;
              case 27: // ESC
                if (self.zoomactive) {
                  self.doZoom();
                  ret = true;
                }
                break;
            }
            if (ret) return self.cancelEvent(e);
          }
        };
        
        if (self.opt.enablekeyboard) self.bind(document,(cap.isopera&&!cap.isopera12)?"keypress":"keydown",self.onkeypress);
        
        self.bind(window,'resize',self.resize);
        self.bind(window,'orientationchange',self.resize);
        
        self.bind(window,"load",self.resize);
		
        if (cap.ischrome&&!self.ispage&&!self.haswrapper) { //chrome void scrollbar bug
          var tmp=self.win.attr("style");
					var ww = parseFloat(self.win.css("width"))+1;
          self.win.css('width',ww);
          self.synched("chromefix",function(){self.win.attr("style",tmp)});
        }
        
// Trying a cross-browser implementation - good luck!

        self.onAttributeChange = function(e) {
          self.lazyResize();
        }
        
        if (!self.ispage&&!self.haswrapper) {
          // thanks to Filip http://stackoverflow.com/questions/1882224/        
          if ("WebKitMutationObserver" in window) {
            self.observer = new WebKitMutationObserver(function(mutations) {
              mutations.forEach(self.onAttributeChange);
            });
            self.observer.observe(self.win[0],{attributes:true,subtree:false});
          } else {        
            self.bind(self.win,(cap.isie&&!cap.isie9)?"propertychange":"DOMAttrModified",self.onAttributeChange);
            if (cap.isie9) self.win[0].attachEvent("onpropertychange",self.onAttributeChange); //IE9 DOMAttrModified bug
          }
        }
        
//

        if (!self.ispage&&self.opt.boxzoom) self.bind(window,"resize",self.resizeZoom);
        if (self.istextarea) self.bind(self.win,"mouseup",self.resize);
        
        self.resize();
        
      }
      
      if (this.doc[0].nodeName == 'IFRAME') {
        function oniframeload(e) {
          self.iframexd = false;
          try {
            var doc = 'contentDocument' in this ? this.contentDocument : this.contentWindow.document;
            var a = doc.domain;            
          } catch(e){self.iframexd = true;doc=false};
          
          if (self.iframexd) {
            if ("console" in window) console.log('NiceScroll error: policy restriced iframe');
            return true;  //cross-domain - I can't manage this        
          }
          
          self.forcescreen = true;
          
          if (self.isiframe) {            
            self.iframe = {
              "doc":$(doc),
              "html":self.doc.contents().find('html')[0],
              "body":self.doc.contents().find('body')[0]
            };
            self.getContentSize = function(){
              return {
                w:Math.max(self.iframe.html.scrollWidth,self.iframe.body.scrollWidth),
                h:Math.max(self.iframe.html.scrollHeight,self.iframe.body.scrollHeight)
              }
            }            
            self.docscroll = $(self.iframe.body);//$(this.contentWindow);
          }
          
          if (!cap.isios&&self.opt.iframeautoresize&&!self.isiframe) {
            self.win.scrollTop(0); // reset position
            self.doc.height("");  //reset height to fix browser bug
            var hh=Math.max(doc.getElementsByTagName('html')[0].scrollHeight,doc.body.scrollHeight);
            self.doc.height(hh);          
          }
          self.resize();
          
          if (cap.isie7) self.css($(self.iframe.html),{'overflow-y':'hidden'});
          //self.css($(doc.body),{'overflow-y':'hidden'});
          self.css($(self.iframe.body),{'overflow-y':'hidden'});
          
          if ('contentWindow' in this) {
            self.bind(this.contentWindow,"scroll",self.onscroll);  //IE8 & minor
          } else {          
            self.bind(doc,"scroll",self.onscroll);
          }                    
          
          if (self.opt.enablemousewheel) {
            self.bind(doc,"mousewheel",self.onmousewheel);
          }
          
          if (self.opt.enablekeyboard) self.bind(doc,(cap.isopera)?"keypress":"keydown",self.onkeypress);
          
          if (cap.cantouch||self.opt.touchbehavior) {
            self.bind(doc,"mousedown",self.onmousedown);
            self.bind(doc,"mousemove",function(e){self.onmousemove(e,true)});
            if (cap.cursorgrabvalue) self.css($(doc.body),{'cursor':cap.cursorgrabvalue});
          }
          
          self.bind(doc,"mouseup",self.onmouseup);
          
          if (self.zoom) {
            if (self.opt.dblclickzoom) self.bind(doc,'dblclick',self.doZoom);
            if (self.ongesturezoom) self.bind(doc,"gestureend",self.ongesturezoom);             
          }
        };
        
        if (this.doc[0].readyState&&this.doc[0].readyState=="complete"){
          setTimeout(function(){oniframeload.call(self.doc[0],false)},500);
        }
        self.bind(this.doc,"load",oniframeload);
        
      }
      
    };
    
    this.showCursor = function(py,px) {
      if (self.cursortimeout) {
        clearTimeout(self.cursortimeout);
        self.cursortimeout = 0;
      }
      if (!self.rail) return;
      if (self.autohidedom) {
        self.autohidedom.stop().css({opacity:self.opt.cursoropacitymax});
        self.cursoractive = true;
      }
      
      if ((typeof py != "undefined")&&(py!==false)) {
        self.scroll.y = Math.round(py * 1/self.scrollratio.y);
      }
      if (typeof px != "undefined") {
        self.scroll.x = Math.round(px * 1/self.scrollratio.x);
      }

      self.cursor.css({height:self.cursorheight,top:self.scroll.y}); 
      if (self.cursorh) {
        (!self.rail.align&&self.rail.visibility) ? self.cursorh.css({width:self.cursorwidth,left:self.scroll.x+self.rail.width}) : self.cursorh.css({width:self.cursorwidth,left:self.scroll.x});
        self.cursoractive = true;
      }
      
      if (self.zoom) self.zoom.stop().css({opacity:self.opt.cursoropacitymax});      
    };
    
    this.hideCursor = function(tm) {
      if (self.cursortimeout) return;
      if (!self.rail) return;
      if (!self.autohidedom) return;
      self.cursortimeout = setTimeout(function() {
         if (!self.rail.active||!self.showonmouseevent) {
           self.autohidedom.stop().animate({opacity:self.opt.cursoropacitymin});
           if (self.zoom) self.zoom.stop().animate({opacity:self.opt.cursoropacitymin});
           self.cursoractive = false;
         }
         self.cursortimeout = 0;
      },tm||400);
    };
    
    this.noticeCursor = function(tm,py,px) {
      self.showCursor(py,px);
      if (!self.rail.active) self.hideCursor(tm);
    };
        
    this.getContentSize = 
      (self.ispage) ?
        function(){
          return {
            w:Math.max(document.body.scrollWidth,document.documentElement.scrollWidth),
            h:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)
          }
        }
      : (self.haswrapper) ?
        function(){
          return {
            w:self.doc.outerWidth()+parseInt(self.win.css('paddingLeft'))+parseInt(self.win.css('paddingRight')),
            h:self.doc.outerHeight()+parseInt(self.win.css('paddingTop'))+parseInt(self.win.css('paddingBottom'))
          }
        }
      : function() {        
        return {
          w:self.docscroll[0].scrollWidth,
          h:self.docscroll[0].scrollHeight
        }
      };
  
    this.onResize = function(e,page) {
    
	  if (!self.win) return false;
	
      if (!self.haswrapper&&!self.ispage) {        
        if (self.win.css('display')=='none') {
          if (self.visibility) self.hideRail().hideRailHr();
          return false;
        } else {          
          if (!self.hidden&&!self.visibility) self.showRail().showRailHr();
        }        
      }
    
      var premaxh = self.page.maxh;
      var premaxw = self.page.maxw;

      var preview = {h:self.view.h,w:self.view.w};   
      
      self.view = {
        w:(self.ispage) ? self.win.width() : parseInt(self.win[0].clientWidth),
        h:(self.ispage) ? self.win.height() : parseInt(self.win[0].clientHeight)
      };
      
      self.page = (page) ? page : self.getContentSize();
      
      self.page.maxh = Math.max(0,self.page.h - self.view.h);
      self.page.maxw = Math.max(0,self.page.w - self.view.w);
      
      if ((self.page.maxh==premaxh)&&(self.page.maxw==premaxw)&&(self.view.w==preview.w)) {
        // test position        
        if (!self.ispage) {
          var pos = self.win.offset();
          if (self.lastposition) {
            var lst = self.lastposition;
            if ((lst.top==pos.top)&&(lst.left==pos.left)) return self; //nothing to do            
          }
          self.lastposition = pos;
        } else {
          return self; //nothing to do
        }
      }
      
      if (self.page.maxh==0) {
        self.hideRail();        
        self.scrollvaluemax = 0;
        self.scroll.y = 0;
        self.scrollratio.y = 0;
        self.cursorheight = 0;
        self.setScrollTop(0);
        self.rail.scrollable = false;
      } else {       
        self.rail.scrollable = true;
      }
      
      if (self.page.maxw==0) {
        self.hideRailHr();
        self.scrollvaluemaxw = 0;
        self.scroll.x = 0;
        self.scrollratio.x = 0;
        self.cursorwidth = 0;
        self.setScrollLeft(0);
        self.railh.scrollable = false;
      } else {        
        self.railh.scrollable = true;
      }
  
      self.locked = (self.page.maxh==0)&&(self.page.maxw==0);
      if (self.locked) {
				if (!self.ispage) self.updateScrollBar(self.view);
			  return false;
		  }

      if (!self.hidden&&!self.visibility) {
        self.showRail().showRailHr();
      }      
      else if (!self.hidden&&!self.railh.visibility) self.showRailHr();
      
      if (self.istextarea&&self.win.css('resize')&&self.win.css('resize')!='none') self.view.h-=20;      
      if (!self.ispage) self.updateScrollBar(self.view);

      self.cursorheight = Math.min(self.view.h,Math.round(self.view.h * (self.view.h / self.page.h)));
      self.cursorheight = Math.max(self.opt.cursorminheight,150);
      //self.cursorheight = Math.max(150);

      self.cursorwidth = Math.min(self.view.w,Math.round(self.view.w * (self.view.w / self.page.w)));
      self.cursorwidth = Math.max(self.opt.cursorminheight,self.cursorwidth);
      
      self.scrollvaluemax = self.view.h-self.cursorheight-self.cursor.hborder;
      
      if (self.railh) {
        self.railh.width = (self.page.maxh>0) ? (self.view.w-self.rail.width) : self.view.w;
        self.scrollvaluemaxw = self.railh.width-self.cursorwidth-self.cursorh.wborder;
      }
      
      self.scrollratio = {
        x:(self.page.maxw/self.scrollvaluemaxw),
        y:(self.page.maxh/self.scrollvaluemax)
      };
     
      var sy = self.getScrollTop();
      if (sy>self.page.maxh) {
        self.doScroll(self.page.maxh);
      } else {     
        self.scroll.y = Math.round(self.getScrollTop() * (1/self.scrollratio.y));
        self.scroll.x = Math.round(self.getScrollLeft() * (1/self.scrollratio.x));
        if (self.cursoractive) self.noticeCursor();     
      }      
      
      if (self.scroll.y&&(self.getScrollTop()==0)) self.doScrollTo(Math.floor(self.scroll.y*self.scrollratio.y));
      
      return self;
    };
    
    this.resize = function(){self.delayed('resize',self.onResize,30);return self;} // event debounce
    
    this.lazyResize = function() {
      self.delayed('resize',self.resize,250);
    }
   
    this._bind = function(el,name,fn,bubble) {  // primitive bind
      self.events.push({e:el,n:name,f:fn,b:bubble});
      if (el.addEventListener) {
        el.addEventListener(name,fn,bubble||false);
      }
      else if (el.attachEvent) {
        el.attachEvent("on"+name,fn);
      }
      else {
        el["on"+name] = fn;        
      }        
    };
   
    this.bind = function(dom,name,fn,bubble) {  // touch-oriented & fixing jquery bind
      var el = ("jquery" in dom) ? dom[0] : dom;
      if (el.addEventListener) {
        if (cap.cantouch && /mouseup|mousedown|mousemove/.test(name)) {  // touch device support
          var tt=(name=='mousedown')?'touchstart':(name=='mouseup')?'touchend':'touchmove';
          self._bind(el,tt,function(e){
            if (e.touches) {
              if (e.touches.length<2) {var ev=(e.touches.length)?e.touches[0]:e;ev.original=e;fn.call(this,ev);}
            } 
            else if (e.changedTouches) {var ev=e.changedTouches[0];ev.original=e;fn.call(this,ev);}  //blackberry
          },bubble||false);
        }
        self._bind(el,name,fn,bubble||false);
        if (name=='mousewheel') self._bind(el,"DOMMouseScroll",fn,bubble||false);
        if (cap.cantouch && name=="mouseup") self._bind(el,"touchcancel",fn,bubble||false);
      }
      else {
        self._bind(el,name,function(e) {
          e = e||window.event||false;
          if (e) {
            if (e.srcElement) e.target=e.srcElement;
          }
          return ((fn.call(el,e)===false)||bubble===false) ? self.cancelEvent(e) : true;
        });
      } 
    };
    
    this._unbind = function(el,name,fn,bub) {  // primitive unbind
      if (el.removeEventListener) {
        el.removeEventListener(name,fn,bub);
      }
      else if (el.detachEvent) {
        el.detachEvent('on'+name,fn);
      } else {
        el['on'+name] = false;
      }
    };
    
    this.unbindAll = function() {
      for(var a=0;a<self.events.length;a++) {
        var r = self.events[a];        
        self._unbind(r.e,r.n,r.f,r.b);
      }
    };
    
    // Thanks to http://www.switchonthecode.com !!
    this.cancelEvent = function(e) {
      var e = (e.original) ? e.original : (e) ? e : window.event||false;
      if (!e) return false;      
      if(e.preventDefault) e.preventDefault();
      if(e.stopPropagation) e.stopPropagation();
      if(e.preventManipulation) e.preventManipulation();  //IE10
      e.cancelBubble = true;
      e.cancel = true;
      e.returnValue = false;
      return false;
    };

    this.stopPropagation = function(e) {
      var e = (e.original) ? e.original : (e) ? e : window.event||false;
      if (!e) return false;
      if (e.stopPropagation) return e.stopPropagation();
      if (e.cancelBubble) e.cancelBubble=true;
      return false;
    }
    
    this.showRail = function() {
      if ((self.page.maxh!=0)&&(self.ispage||self.win.css('display')!='none')) {
        self.visibility = true;
        self.rail.visibility = true;
        self.rail.css('display','block');
      }
      return self;
    };

    this.showRailHr = function() {
      if (!self.railh) return self;
      if ((self.page.maxw!=0)&&(self.ispage||self.win.css('display')!='none')) {
        self.railh.visibility = true;
        self.railh.css('display','block');
      }
      return self;
    };
    
    this.hideRail = function() {
      self.visibility = false;
      self.rail.visibility = false;
      self.rail.css('display','none');
      return self;
    };

    this.hideRailHr = function() {
      if (!self.railh) return self;
      self.railh.visibility = false;
      self.railh.css('display','none');
      return self;
    };
    
    this.show = function() {
      self.hidden = false;
      self.locked = false;
      return self.showRail().showRailHr();
    };

    this.hide = function() {
      self.hidden = true;
      self.locked = true;
      return self.hideRail().hideRailHr();
    };
    
    this.remove = function() {
      self.doZoomOut();
      self.unbindAll();      
      if (self.observer !== false) self.observer.disconnect();      
      self.events = [];
      if (self.cursor) {
        self.cursor.remove();
        self.cursor = null;
      }
      if (self.cursorh) {
        self.cursorh.remove();
        self.cursorh = null;
      }
      if (self.rail) {
        self.rail.remove();
        self.rail = null;
      }
      if (self.railh) {
        self.railh.remove();
        self.railh = null;
      }
      if (self.zoom) {
        self.zoom.remove();
        self.zoom = null;
      }
      for(var a=0;a<self.saved.css.length;a++) {
        var d=self.saved.css[a];
        d[0].css(d[1],(typeof d[2]=="undefined") ? '' : d[2]);
      }
      self.saved = false;      
      self.me.data('__nicescroll',''); //erase all traces
	  self.me = null;
	  self.doc = null;
	  self.docscroll = null;
	  self.win = null;
      return self;
    };
    
    this.scrollstart = function(fn) {
      this.onscrollstart = fn;
      return self;
    }
    this.scrollend = function(fn) {
      this.onscrollend = fn;
      return self;
    }
    this.scrollcancel = function(fn) {
      this.onscrollcancel = fn;
      return self;
    }
    
    this.zoomin = function(fn) {
      this.onzoomin = fn;
      return self;
    }
    this.zoomout = function(fn) {
      this.onzoomout = fn;
      return self;
    }
    
    this.isScrollable = function(e) {      
      var dom = (e.target) ? e.target : e;
      while (dom&&(dom.nodeType==1)&&!(/BODY|HTML/.test(dom.nodeName))) {
        var dd = $(dom);
        var ov = dd.css('overflowY')||dd.css('overflowX')||dd.css('overflow')||'';
        if (/scroll|auto/.test(ov)) return (dom.clientHeight!=dom.scrollHeight);
        dom = (dom.parentNode) ? dom.parentNode : false;        
      }
      return false;
    };
    
    function execScrollWheel(e,hr) {
      var px = 0;
      var py = 0;
      if ("wheelDeltaY" in e) {
        px = Math.floor(e.wheelDeltaX/2);
        py = Math.floor(e.wheelDeltaY/2);
      } else {
        var delta = e.detail ? e.detail * -1 : e.wheelDelta / 40;
        if (delta) {
          (hr) ? px = Math.floor(delta*self.opt.mousescrollstep) : py = Math.floor(delta*self.opt.mousescrollstep);
        }
      }      
      if (px) {
        if (self.scrollmom) {self.scrollmom.stop()}
        self.lastdeltax+=px;
        self.synched("mousewheelx",function(){var dt=self.lastdeltax;self.lastdeltax=0;if(!self.rail.drag){self.doScrollLeftBy(dt)}});
      }
      if (py) {
        if (self.scrollmom) {self.scrollmom.stop()}
        self.lastdeltay+=py;
        self.synched("mousewheely",function(){var dt=self.lastdeltay;self.lastdeltay=0;if(!self.rail.drag){self.doScrollBy(dt)}});
      }          
    };
    
    this.onmousewheel = function(e) {
      if (self.locked) return true;
      if (!self.rail.scrollable) {
        if (self.railh&&self.railh.scrollable) {
          return self.onmousewheelhr(e);
        } else {
          return true;
        }
      }
      if (self.opt.preservenativescrolling&&self.checkarea) {
        self.checkarea = false;
        self.nativescrollingarea = self.isScrollable(e); 
      }
      if (self.nativescrollingarea) return true; // this isn't my business
      if (self.locked) return self.cancelEvent(e);
      if (self.rail.drag) return self.cancelEvent(e);
      
      execScrollWheel(e,false);
      
      return self.cancelEvent(e);
    };

    this.onmousewheelhr = function(e) {
      if (self.locked||!self.railh.scrollable) return true;
      if (self.opt.preservenativescrolling&&self.checkarea) {
        self.checkarea = false;
        self.nativescrollingarea = self.isScrollable(e); 
      }
      if (self.nativescrollingarea) return true; // this isn't my business
      if (self.locked) return self.cancelEvent(e);
      if (self.rail.drag) return self.cancelEvent(e);

      execScrollWheel(e,true);
      
      return self.cancelEvent(e);
    };
    
    this.stop = function() {
      self.cancelScroll();
      if (self.scrollmon) self.scrollmon.stop();
      self.cursorfreezed = false;
      self.scroll.y = Math.round(self.getScrollTop() * (1/self.scrollratio.y));      
      self.noticeCursor();
      return self;
    };
    
    this.getTransitionSpeed = function(dif) {
      var sp = Math.round(self.opt.scrollspeed*10);
      var ex = Math.min(sp,Math.round((dif / 20) * self.opt.scrollspeed));
      return (ex>20) ? ex : 0;
    }
    
    if (!self.opt.smoothscroll) {
      this.doScrollLeft = function(x,spd) {  //direct
        var y = self.getScrollTop();
        self.doScrollPos(x,y,spd);
      }      
      this.doScrollTop = function(y,spd) {   //direct
        var x = self.getScrollLeft();
        self.doScrollPos(x,y,spd);
      }
      this.doScrollPos = function(x,y,spd) {  //direct
        var nx = (x>self.page.maxw) ? self.page.maxw : x;
        if (nx<0) nx=0;
        var ny = (y>self.page.maxh) ? self.page.maxh : y;
        if (ny<0) ny=0;
        self.synched('scroll',function(){
          self.setScrollTop(ny);
          self.setScrollLeft(nx);
        });
      }
      this.cancelScroll = function() {}; // direct
    } 
    else if (self.ishwscroll&&cap.hastransition&&self.opt.usetransition) {
      this.prepareTransition = function(dif,istime) {
        var ex = (istime) ? ((dif>20)?dif:0) : self.getTransitionSpeed(dif);        
        var trans = (ex) ? cap.prefixstyle+'transform '+ex+'ms ease-out' : '';
        if (!self.lasttransitionstyle||self.lasttransitionstyle!=trans) {
          self.lasttransitionstyle = trans;
          self.doc.css(cap.transitionstyle,trans);
        }
        return ex;
      };
      
      this.doScrollLeft = function(x,spd) {  //trans
        var y = (self.scrollrunning) ? self.newscrolly : self.getScrollTop();
        self.doScrollPos(x,y,spd);
      }      
      
      this.doScrollTop = function(y,spd) {   //trans
        var x = (self.scrollrunning) ? self.newscrollx : self.getScrollLeft();
        self.doScrollPos(x,y,spd);
      }
      
      this.doScrollPos = function(x,y,spd) {  //trans
   
        var py = self.getScrollTop();
        var px = self.getScrollLeft();        
      
        if (((self.newscrolly-py)*(y-py)<0)||((self.newscrollx-px)*(x-px)<0)) self.cancelScroll();  //inverted movement detection      
        
        self.newscrolly = y;
        self.newscrollx = x;
        
        self.newscrollspeed = spd||false;
        
        if (self.timer) return false;
        
        self.timer = setTimeout(function(){
        
          var top = self.getScrollTop();
          var lft = self.getScrollLeft();
          
          var dst = {};
          dst.x = x-lft;
          dst.y = y-top;
          dst.px = lft;
          dst.py = top;
          
          var dd = Math.round(Math.sqrt(Math.pow(dst.x,2)+Math.pow(dst.y,2)));          
          
          var df = (self.newscrollspeed) ? self.newscrollspeed : dd;          
          var ms = self.prepareTransition(df);
          
          if (self.timerscroll&&self.timerscroll.tm) clearInterval(self.timerscroll.tm);    
          
          if (ms>0) {
          
            if (!self.scrollrunning&&self.onscrollstart) {
              var info = {"type":"scrollstart","current":{"x":lft,"y":top},"request":{"x":x,"y":y},"end":{"x":self.newscrollx,"y":self.newscrolly},"speed":ms};
              self.onscrollstart.call(self,info);
            }
            
            if (cap.transitionend) {
              if (!self.scrollendtrapped) {
                self.scrollendtrapped = true;
                self.bind(self.doc,cap.transitionend,self.onScrollEnd,false); //I have got to do something usefull!!
              }
            } else {              
              if (self.scrollendtrapped) clearTimeout(self.scrollendtrapped);
              self.scrollendtrapped = setTimeout(self.onScrollEnd,ms);  // simulate transitionend event
            }
            
            var py = top;
            var px = lft;
            self.timerscroll = {
              bz: new BezierClass(py,self.newscrolly,ms,0,0,0.58,1),
              bh: new BezierClass(px,self.newscrollx,ms,0,0,0.58,1)
            };            
            if (!self.cursorfreezed) self.timerscroll.tm=setInterval(function(){self.showCursor(self.getScrollTop(),self.getScrollLeft())},60);
            
          }
          
          self.synched("doScroll-set",function(){
            self.timer = 0;
            if (self.scrollendtrapped) self.scrollrunning = true;
            self.setScrollTop(self.newscrolly);
            self.setScrollLeft(self.newscrollx);
            if (!self.scrollendtrapped) self.onScrollEnd();
          });
          
          
        },50);
        
      };
      
      this.cancelScroll = function() {
        if (!self.scrollendtrapped) return true;        
        var py = self.getScrollTop();
        var px = self.getScrollLeft();
        self.scrollrunning = false;
        if (!cap.transitionend) clearTimeout(cap.transitionend);
        self.scrollendtrapped = false;
        self._unbind(self.doc,cap.transitionend,self.onScrollEnd);        
        self.prepareTransition(0);
        self.setScrollTop(py); // fire event onscroll
        if (self.railh) self.setScrollLeft(px);
        if (self.timerscroll&&self.timerscroll.tm) clearInterval(self.timerscroll.tm);
        self.timerscroll = false;
        
        self.cursorfreezed = false;

        //self.noticeCursor(false,py,px);
        self.showCursor(py,px);
        return self;
      };
      this.onScrollEnd = function() {                
        if (self.scrollendtrapped) self._unbind(self.doc,cap.transitionend,self.onScrollEnd);
        self.scrollendtrapped = false;        
        self.prepareTransition(0);
        if (self.timerscroll&&self.timerscroll.tm) clearInterval(self.timerscroll.tm);
        self.timerscroll = false;        
        var py = self.getScrollTop();
        var px = self.getScrollLeft();
        self.setScrollTop(py);  // fire event onscroll        
        if (self.railh) self.setScrollLeft(px);  // fire event onscroll left
        
        self.noticeCursor(false,py,px);     
        
        self.cursorfreezed = false;
        
        if (py<0) py=0
        else if (py>self.page.maxh) py=self.page.maxh;
        if (px<0) px=0
        else if (px>self.page.maxw) px=self.page.maxw;
        if((py!=self.newscrolly)||(px!=self.newscrollx)) return self.doScrollPos(px,py,self.opt.snapbackspeed);
        
        if (self.onscrollend&&self.scrollrunning) {
          var info = {"type":"scrollend","current":{"x":px,"y":py},"end":{"x":self.newscrollx,"y":self.newscrolly}};
          self.onscrollend.call(self,info);
        } 
        self.scrollrunning = false;
        
      };

    } else {

      this.doScrollLeft = function(x) {  //no-trans
        var y = (self.scrollrunning) ? self.newscrolly : self.getScrollTop();
        self.doScrollPos(x,y);
      }

      this.doScrollTop = function(y) {  //no-trans
        var x = (self.scrollrunning) ? self.newscrollx : self.getScrollLeft();
        self.doScrollPos(x,y);
      }

      this.doScrollPos = function(x,y) {  //no-trans
        var y = ((typeof y == "undefined")||(y===false)) ? self.getScrollTop(true) : y;
      
        if  ((self.timer)&&(self.newscrolly==y)&&(self.newscrollx==x)) return true;
      
        if (self.timer) clearAnimationFrame(self.timer);
        self.timer = 0;      

        var py = self.getScrollTop();
        var px = self.getScrollLeft();
        
        if (((self.newscrolly-py)*(y-py)<0)||((self.newscrollx-px)*(x-px)<0)) self.cancelScroll();  //inverted movement detection
        
        self.newscrolly = y;
        self.newscrollx = x;
        
        if (!self.bouncescroll||!self.rail.visibility) {
          if (self.newscrolly<0) {
            self.newscrolly = 0;
          }
          else if (self.newscrolly>self.page.maxh) {
            self.newscrolly = self.page.maxh;
          }
        }
        if (!self.bouncescroll||!self.railh.visibility) {
          if (self.newscrollx<0) {
            self.newscrollx = 0;
          }
          else if (self.newscrollx>self.page.maxw) {
            self.newscrollx = self.page.maxw;
          }
        }

        self.dst = {};
        self.dst.x = x-px;
        self.dst.y = y-py;
        self.dst.px = px;
        self.dst.py = py;
        
        var dst = Math.round(Math.sqrt(Math.pow(self.dst.x,2)+Math.pow(self.dst.y,2)));
        
        self.dst.ax = self.dst.x / dst;
        self.dst.ay = self.dst.y / dst;
        
        var pa = 0;
        var pe = dst;
        
        if (self.dst.x==0) {
          pa = py;
          pe = y;
          self.dst.ay = 1;
          self.dst.py = 0;
        } else if (self.dst.y==0) {
          pa = px;
          pe = x;
          self.dst.ax = 1;
          self.dst.px = 0;
        }

        var ms = self.getTransitionSpeed(dst);
        if (ms>0) {
          self.bzscroll = (self.bzscroll) ? self.bzscroll.update(pe,ms) : new BezierClass(pa,pe,ms,0,1,0,1);
        } else {
          self.bzscroll = false;
        }
        
        if (self.timer) return;
        
        if ((py==self.page.maxh&&y>=self.page.maxh)||(px==self.page.maxw&&x>=self.page.maxw)) self.checkContentSize();
        
        var sync = 1;
        
        function scrolling() {          
          if (self.cancelAnimationFrame) return true;
          
          self.scrollrunning = true;
          
          sync = 1-sync;
          if (sync) return (self.timer = setAnimationFrame(scrolling)||1);

          var done = 0;
          
          var sc = sy = self.getScrollTop();
          if (self.dst.ay) {            
            sc = (self.bzscroll) ? self.dst.py + (self.bzscroll.getNow()*self.dst.ay) : self.newscrolly;
            var dr=sc-sy;          
            if ((dr<0&&sc<self.newscrolly)||(dr>0&&sc>self.newscrolly)) sc = self.newscrolly;
            self.setScrollTop(sc);
            if (sc == self.newscrolly) done=1;
          } else {
            done=1;
          }
          
          var scx = sx = self.getScrollLeft();
          if (self.dst.ax) {            
            scx = (self.bzscroll) ? self.dst.px + (self.bzscroll.getNow()*self.dst.ax) : self.newscrollx;            
            var dr=scx-sx;
            if ((dr<0&&scx<self.newscrollx)||(dr>0&&scx>self.newscrollx)) scx = self.newscrollx;
            self.setScrollLeft(scx);
            if (scx == self.newscrollx) done+=1;
          } else {
            done+=1;
          }
          
          if (done==2) {
            self.timer = 0;
            self.cursorfreezed = false;
            self.bzscroll = false;
            self.scrollrunning = false;
            if (sc<0) sc=0;
            else if (sc>self.page.maxh) sc=self.page.maxh;
            if (scx<0) scx=0;
            else if (scx>self.page.maxw) scx=self.page.maxw;
            if ((scx!=self.newscrollx)||(sc!=self.newscrolly)) self.doScrollPos(scx,sc);
            else {
              if (self.onscrollend) {
                var info = {"type":"scrollend","current":{"x":sx,"y":sy},"end":{"x":self.newscrollx,"y":self.newscrolly}};
                self.onscrollend.call(self,info);
              }             
            } 
          } else {
            self.timer = setAnimationFrame(scrolling)||1;
          }
        };
        self.cancelAnimationFrame=false;
        self.timer = 1;

        if (self.onscrollstart&&!self.scrollrunning) {
          var info = {"type":"scrollstart","current":{"x":px,"y":py},"request":{"x":x,"y":y},"end":{"x":self.newscrollx,"y":self.newscrolly},"speed":ms};
          self.onscrollstart.call(self,info);
        }        

        scrolling();
        
        if ((py==self.page.maxh&&y>=py)||(px==self.page.maxw&&x>=px)) self.checkContentSize();
        
        self.noticeCursor();
      };
  
      this.cancelScroll = function() {        
        if (self.timer) clearAnimationFrame(self.timer);
        self.timer = 0;
        self.bzscroll = false;
        self.scrollrunning = false;
        return self;
      };
      
    }
    
    this.doScrollBy = function(stp,relative) {
      var ny = 0;
      if (relative) {
        ny = Math.floor((self.scroll.y-stp)*self.scrollratio.y)
      } else {        
        var sy = (self.timer) ? self.newscrolly : self.getScrollTop(true);
        ny = sy-stp;
      }
      if (self.bouncescroll) {
        var haf = Math.round(self.view.h/2);
        if (ny<-haf) ny=-haf
        else if (ny>(self.page.maxh+haf)) ny = (self.page.maxh+haf);
      }
      self.cursorfreezed = false;      

      py = self.getScrollTop(true);
      if (ny<0&&py<=0) return self.noticeCursor();      
      else if (ny>self.page.maxh&&py>=self.page.maxh) {
        self.checkContentSize();
        return self.noticeCursor();
      }
      
      self.doScrollTop(ny);
    };

    this.doScrollLeftBy = function(stp,relative) {
      var nx = 0;
      if (relative) {
        nx = Math.floor((self.scroll.x-stp)*self.scrollratio.x)
      } else {
        var sx = (self.timer) ? self.newscrollx : self.getScrollLeft(true);
        nx = sx-stp;
      }
      if (self.bouncescroll) {
        var haf = Math.round(self.view.w/2);
        if (nx<-haf) nx=-haf
        else if (nx>(self.page.maxw+haf)) nx = (self.page.maxw+haf);
      }
      self.cursorfreezed = false;    

      px = self.getScrollLeft(true);
      if (nx<0&&px<=0) return self.noticeCursor();      
      else if (nx>self.page.maxw&&px>=self.page.maxw) return self.noticeCursor();
      
      self.doScrollLeft(nx);
    };
    
    this.doScrollTo = function(pos,relative) {
      var ny = (relative) ? Math.round(pos*self.scrollratio.y) : pos;
      if (ny<0) ny=0
      else if (ny>self.page.maxh) ny = self.page.maxh;
      self.cursorfreezed = false;
      self.doScrollTop(pos);
    };
    
    this.checkContentSize = function() {      
      var pg = self.getContentSize();
      if ((pg.h!=self.page.h)||(pg.w!=self.page.w)) self.resize(false,pg);
    };
    
    self.onscroll = function(e) {    
      if (self.rail.drag) return;
      if (!self.cursorfreezed) {
        self.synched('scroll',function(){
          self.scroll.y = Math.round(self.getScrollTop() * (1/self.scrollratio.y));
          if (self.railh) self.scroll.x = Math.round(self.getScrollLeft() * (1/self.scrollratio.x));
          self.noticeCursor();
        });
      }
    };
    self.bind(self.docscroll,"scroll",self.onscroll);
    
    this.doZoomIn = function(e) {
      if (self.zoomactive) return;
      self.zoomactive = true;
      
      self.zoomrestore = {
        style:{}
      };
      var lst = ['position','top','left','zIndex','backgroundColor','marginTop','marginBottom','marginLeft','marginRight'];
      var win = self.win[0].style;
      for(var a in lst) {
        var pp = lst[a];
        self.zoomrestore.style[pp] = (typeof win[pp]!='undefined') ? win[pp] : '';
      }
      
      self.zoomrestore.style.width = self.win.css('width');
      self.zoomrestore.style.height = self.win.css('height');
      
      self.zoomrestore.padding = {
        w:self.win.outerWidth()-self.win.width(),
        h:self.win.outerHeight()-self.win.height()
      };
      
      if (cap.isios4) {
        self.zoomrestore.scrollTop = $(window).scrollTop();
        $(window).scrollTop(0);
      }
      
      self.win.css({
        "position":(cap.isios4)?"absolute":"fixed",
        "top":0,
        "left":0,
        "z-index":self.opt.zindex+100,
        "margin":"0px"
      });
      var bkg = self.win.css("backgroundColor");      
      if (bkg==""||/transparent|rgba\(0, 0, 0, 0\)|rgba\(0,0,0,0\)/.test(bkg)) self.win.css("backgroundColor","#fff");
      self.rail.css({"z-index":self.opt.zindex+110});
      self.zoom.css({"z-index":self.opt.zindex+112});      
      self.zoom.css('backgroundPosition','0px -18px');
      self.resizeZoom();
      
      if (self.onzoomin) self.onzoomin.call(self);
      
      return self.cancelEvent(e);
    };

    this.doZoomOut = function(e) {
      if (!self.zoomactive) return;
      self.zoomactive = false;
      
      self.win.css("margin","");
      self.win.css(self.zoomrestore.style);
      
      if (cap.isios4) {
        $(window).scrollTop(self.zoomrestore.scrollTop);
      }
      
      self.rail.css({"z-index":(self.ispage)?self.opt.zindex:self.opt.zindex+2});
      self.zoom.css({"z-index":self.opt.zindex});
      self.zoomrestore = false;
      self.zoom.css('backgroundPosition','0px 0px');
      self.onResize();
      
      if (self.onzoomout) self.onzoomout.call(self);
      
      return self.cancelEvent(e);
    };
    
    this.doZoom = function(e) {
      return (self.zoomactive) ? self.doZoomOut(e) : self.doZoomIn(e);
    };
    
    this.resizeZoom = function() {
      if (!self.zoomactive) return;

      var py = self.getScrollTop(); //preserve scrolling position
      self.win.css({
        width:$(window).width()-self.zoomrestore.padding.w+"px",
        height:$(window).height()-self.zoomrestore.padding.h+"px"
      });
      self.onResize();
      self.setScrollTop(Math.min(self.page.maxh,py));
    };
   
    this.init();
    
    $.nicescroll.push(this);

  };
  
// Inspired by the work of Kin Blas
// http://webpro.host.adobe.com/people/jblas/momentum/includes/jquery.momentum.0.7.js  
  
  
  var ScrollMomentumClass2D = function(nc) {
    var self = this;
    this.nc = nc;
    
    this.lastx = 0;
    this.lasty = 0;
    this.speedx = 0;
    this.speedy = 0;
    this.lasttime = 0;
    this.steptime = 0;
    this.snapx = false;
    this.snapy = false;
    this.demulx = 0;
    this.demuly = 0;
    
    this.lastscrollx = -1;
    this.lastscrolly = -1;
    
    this.chkx = 0;
    this.chky = 0;
    
    this.timer = 0;
    
    this.time = function() {
      return +new Date();//beautifull hack
    };
    
    this.reset = function(px,py) {
      self.stop();
      var now = self.time();
      self.steptime = 0;
      self.lasttime = now;
      self.speedx = 0;
      self.speedy = 0;
      self.lastx = px;
      self.lasty = py;
      self.lastscrollx = -1;
      self.lastscrolly = -1;
    };
    
    this.update = function(px,py) {
      var now = self.time();
      self.steptime = now - self.lasttime;
      self.lasttime = now;      
      var dy = py - self.lasty;
      var dx = px - self.lastx;
      var sy = self.nc.getScrollTop();
      var sx = self.nc.getScrollLeft();
      var newy = sy + dy;
      var newx = sx + dx;
      self.snapx = (newx<0)||(newx>self.nc.page.maxw);
      self.snapy = (newy<0)||(newy>self.nc.page.maxh);
      self.speedx = dx;
      self.speedy = dy;
      self.lastx = px;
      self.lasty = py;
    };
    
    this.stop = function() {
      self.nc.unsynched("domomentum2d");
      if (self.timer) clearTimeout(self.timer);
      self.timer = 0;
      self.lastscrollx = -1;
      self.lastscrolly = -1;
    };
    
    this.doSnapy = function(nx,ny) {
      var snap = false;
      
      if (ny<0) {
        ny=0;
        snap=true;        
      } 
      else if (ny>self.nc.page.maxh) {
        ny=self.nc.page.maxh;
        snap=true;
      }

      if (nx<0) {
        nx=0;
        snap=true;        
      } 
      else if (nx>self.nc.page.maxw) {
        nx=self.nc.page.maxw;
        snap=true;
      }
      
      if (snap) self.nc.doScrollPos(nx,ny,self.nc.opt.snapbackspeed);
    };
    
    this.doMomentum = function(gp) {
      var t = self.time();
      var l = (gp) ? t+gp : self.lasttime;

      var sl = self.nc.getScrollLeft();
      var st = self.nc.getScrollTop();
      
      var pageh = self.nc.page.maxh;
      var pagew = self.nc.page.maxw;
      
      self.speedx = (pagew>0) ? Math.min(60,self.speedx) : 0;
      self.speedy = (pageh>0) ? Math.min(60,self.speedy) : 0;
      
      var chk = l && (t - l) <= 50;
      
      if ((st<0)||(st>pageh)||(sl<0)||(sl>pagew)) chk = false;
      
      var sy = (self.speedy && chk) ? self.speedy : false;
      var sx = (self.speedx && chk) ? self.speedx : false;
      
      if (sy||sx) {
        var tm = Math.max(16,self.steptime); //timeout granularity
        
        if (tm>50) {  // do smooth
          var xm = tm/50;
          self.speedx*=xm;
          self.speedy*=xm;
          tm = 50;
        }
        
        self.demulxy = 0;

        self.lastscrollx = self.nc.getScrollLeft();
        self.chkx = self.lastscrollx;
        self.lastscrolly = self.nc.getScrollTop();
        self.chky = self.lastscrolly;
        
        var nx = self.lastscrollx;
        var ny = self.lastscrolly;
        
        var onscroll = function(){
          var df = ((self.time()-t)>600) ? 0.04 : 0.02;
        
          if (self.speedx) {
            nx = Math.floor(self.lastscrollx - (self.speedx*(1-self.demulxy)));
            self.lastscrollx = nx;
            if ((nx<0)||(nx>pagew)) df=0.10;
          }

          if (self.speedy) {
            ny = Math.floor(self.lastscrolly - (self.speedy*(1-self.demulxy)));
            self.lastscrolly = ny;
            if ((ny<0)||(ny>pageh)) df=0.10;
          }
          
          self.demulxy = Math.min(1,self.demulxy+df);
          
          self.nc.synched("domomentum2d",function(){

            if (self.speedx) {
              var scx = self.nc.getScrollLeft();
              if (scx!=self.chkx) self.stop();
              self.chkx=nx;
              self.nc.setScrollLeft(nx);
            }
          
            if (self.speedy) {
              var scy = self.nc.getScrollTop();
              if (scy!=self.chky) self.stop();          
              self.chky=ny;
              self.nc.setScrollTop(ny);
            }
            
            if(!self.timer) {
              self.nc.hideCursor();
              self.doSnapy(nx,ny);
            }
            
          });
          
          if (self.demulxy<1) {            
            self.timer = setTimeout(onscroll,tm);
          } else {
            self.stop();
            self.nc.hideCursor();
            self.doSnapy(nx,ny);
          }
        };
        
        onscroll();
        
      } else {
        self.doSnapy(self.nc.getScrollLeft(),self.nc.getScrollTop());
      }      
      
    }
    
  };

  
// override jQuery scrollTop
 
  var _scrollTop = jQuery.fn.scrollTop; // preserve original function
   
  $.cssHooks["pageYOffset"] = {
    get: function(elem,computed,extra) {      
      var nice = $.data(elem,'__nicescroll')||false;
      return (nice&&nice.ishwscroll) ? nice.getScrollTop() : _scrollTop.call(elem);
    },
    set: function(elem,value) {
      var nice = $.data(elem,'__nicescroll')||false;    
      (nice&&nice.ishwscroll) ? nice.setScrollTop(parseInt(value)) : _scrollTop.call(elem,value);
      return this;
    }
  };

/*  
  $.fx.step["scrollTop"] = function(fx){    
    $.cssHooks["scrollTop"].set( fx.elem, fx.now + fx.unit );
  };
*/  
  
  jQuery.fn.scrollTop = function(value) {
    if (typeof value == "undefined") {
      var nice = (this[0]) ? $.data(this[0],'__nicescroll')||false : false;
      return (nice&&nice.ishwscroll) ? nice.getScrollTop() : _scrollTop.call(this);
    } else {      
      return this.each(function() {
        var nice = $.data(this,'__nicescroll')||false;
        (nice&&nice.ishwscroll) ? nice.setScrollTop(parseInt(value)) : _scrollTop.call($(this),value);
      });
    }
  }

// override jQuery scrollLeft
 
  var _scrollLeft = jQuery.fn.scrollLeft; // preserve original function
   
  $.cssHooks.pageXOffset = {
    get: function(elem,computed,extra) {
      var nice = $.data(elem,'__nicescroll')||false;
      return (nice&&nice.ishwscroll) ? nice.getScrollLeft() : _scrollLeft.call(elem);
    },
    set: function(elem,value) {
      var nice = $.data(elem,'__nicescroll')||false;    
      (nice&&nice.ishwscroll) ? nice.setScrollLeft(parseInt(value)) : _scrollLeft.call(elem,value);
      return this;
    }
  };
  
/*  
  $.fx.step["scrollLeft"] = function(fx){
    $.cssHooks["scrollLeft"].set( fx.elem, fx.now + fx.unit );
  };  
*/  
 
  jQuery.fn.scrollLeft = function(value) {    
    if (typeof value == "undefined") {
      var nice = (this[0]) ? $.data(this[0],'__nicescroll')||false : false;
      return (nice&&nice.ishwscroll) ? nice.getScrollLeft() : _scrollLeft.call(this);
    } else {
      return this.each(function() {     
        var nice = $.data(this,'__nicescroll')||false;
        (nice&&nice.ishwscroll) ? nice.setScrollLeft(parseInt(value)) : _scrollLeft.call($(this),value);
      });
    }
  }
  
  var NiceScrollArray = function(doms) {
    var self = this;
    this.length = 0;
    this.name = "nicescrollarray";
  
    this.each = function(fn) {
      for(var a=0;a<self.length;a++) fn.call(self[a]);
      return self;
    };
    
    this.push = function(nice) {
      self[self.length]=nice;
      self.length++;
    };
    
    this.eq = function(idx) {
      return self[idx];
    };
    
    if (doms) {
      for(a=0;a<doms.length;a++) {
        var nice = $.data(doms[a],'__nicescroll')||false;
        if (nice) {
          this[this.length]=nice;
          this.length++;
        }
      };
    }
    
    return this;
  };
  
  function mplex(el,lst,fn) {
    for(var a=0;a<lst.length;a++) fn(el,lst[a]);
  };  
  mplex(
    NiceScrollArray.prototype,
    ['show','hide','onResize','resize','remove','stop','doScrollPos'],
    function(e,n) {
      e[n] = function(){
        var args = arguments;
        return this.each(function(){          
          this[n].apply(this,args);
        });
      };
    }
  );  
  
  jQuery.fn.getNiceScroll = function(index) {
    if (typeof index == "undefined") {
      return new NiceScrollArray(this);
    } else {
      var nice = $.data(this[index],'__nicescroll')||false;
      return nice;
    }
  };
  
  jQuery.extend(jQuery.expr[':'], {
    nicescroll: function(a) {
      return ($.data(a,'__nicescroll'))?true:false;
    }
  });  
  
  $.fn.niceScroll = function(wrapper,opt) {        
    if (typeof opt=="undefined") {
      if ((typeof wrapper=="object")&&!("jquery" in wrapper)) {
        opt = wrapper;
        wrapper = false;        
      }
    }
    var ret = new NiceScrollArray();
    if (typeof opt=="undefined") opt = {};
    
    if (wrapper||false) {      
      opt.doc = $(wrapper);
      opt.win = $(this);
    }    
    var docundef = !("doc" in opt);   
    if (!docundef&&!("win" in opt)) opt.win = $(this);    
    
    this.each(function() {
      var nice = $(this).data('__nicescroll')||false;
      if (!nice) {
        opt.doc = (docundef) ? $(this) : opt.doc;
        nice = new NiceScrollClass(opt,$(this));        
        $(this).data('__nicescroll',nice);
      }
      ret.push(nice);
    });
    return (ret.length==1) ? ret[0] : ret;
  };
  
  window.NiceScroll = {
    getjQuery:function(){return jQuery}
  };
  
  if (!$.nicescroll) {
   $.nicescroll = new NiceScrollArray();
  }
  
})( jQuery );
  
/* jquery SelectBoxIt - v2.9.9 - 2013-1-20
* http://www.gregfranko.com/jQuery.selectBoxIt.js/
* Copyright (c) 2012 Greg Franko; Licensed MIT */

// Immediately-Invoked Function Expression (IIFE) [Ben Alman Blog Post](http://benalman.com/news/2010/11/immediately-invoked-function-expression/) that calls another IIFE that contains all of the plugin logic.  I used this pattern so that anyone viewing this code would not have to scroll to the bottom of the page to view the local parameters that were passed to the main IIFE.

;(function (selectBoxIt) {

    //ECMAScript 5 Strict Mode: [John Resig Blog Post](http://ejohn.org/blog/ecmascript-5-strict-mode-json-and-more/)
    "use strict";

    // Calls the second IIFE and locally passes in the global jQuery, window, and document objects
    selectBoxIt(window.jQuery, window, document);

}

// Locally passes in `jQuery`, the `window` object, the `document` object, and an `undefined` variable.  The `jQuery`, `window` and `document` objects are passed in locally, to improve performance, since javascript first searches for a variable match within the local variables set before searching the global variables set.  All of the global variables are also passed in locally to be minifier friendly. `undefined` can be passed in locally, because it is not a reserved word in JavaScript.

(function ($, window, document, undefined) {

    // ECMAScript 5 Strict Mode: [John Resig Blog Post](http://ejohn.org/blog/ecmascript-5-strict-mode-json-and-more/)
    "use strict";

    // Calling the jQueryUI Widget Factory Method
    $.widget("selectBox.selectBoxIt", {

        // Plugin version
        VERSION: "2.9.9",

        // These options will be used as defaults
        options: {

            // **showEffect**: Accepts String: "none", "fadeIn", "show", "slideDown", or any of the jQueryUI show effects (i.e. "bounce")
            "showEffect": "none",

            // **showEffectOptions**: Accepts an object literal.  All of the available properties are based on the jqueryUI effect options
            "showEffectOptions": {},

            // **showEffectSpeed**: Accepts Number (milliseconds) or String: "slow", "medium", or "fast"
            "showEffectSpeed": "medium",

            // **hideEffect**: Accepts String: "none", "fadeOut", "hide", "slideUp", or any of the jQueryUI hide effects (i.e. "explode")
            "hideEffect": "none",

            // **hideEffectOptions**: Accepts an object literal.  All of the available properties are based on the jqueryUI effect options
            "hideEffectOptions": {},

            // **hideEffectSpeed**: Accepts Number (milliseconds) or String: "slow", "medium", or "fast"
            "hideEffectSpeed": "medium",

            // **showFirstOption**: Shows the first dropdown list option within the dropdown list options list
            "showFirstOption": true,

            // **defaultText**: Overrides the text used by the dropdown list selected option to allow a user to specify custom text.  Accepts a String.
            "defaultText": "",

            // **defaultIcon**: Overrides the icon used by the dropdown list selected option to allow a user to specify a custom icon.  Accepts a String (CSS class name(s)).
            "defaultIcon": "",

            // **downArrowIcon**: Overrides the default down arrow used by the dropdown list to allow a user to specify a custom image.  Accepts a String (CSS class name(s)).
            "downArrowIcon": "",

            // **theme**: Provides theming support for Twitter Bootstrap and jQueryUI
            "theme": "bootstrap",

            // **keydownOpen**: Opens the dropdown if the up or down key is pressed when the dropdown is focused
            "keydownOpen": true,

            // **isMobile**: Function to determine if a user's browser is a mobile browser
            "isMobile": function() {

                // Adapted from http://www.detectmobilebrowsers.com
                var ua = navigator.userAgent || navigator.vendor || window.opera;

                // Checks for iOs, Android, Blackberry, Opera Mini, and Windows mobile devices
                return (/iPhone|iPod|iPad|Android|BlackBerry|Opera Mini|IEMobile/).test(ua);
                //return false;
            },

            "nostyle": false,

            // **native**: Triggers the native select box when a user interacts with the drop down
            "native": false,

            // **aggressiveChange**: Will select a drop down item (and trigger a change event) when a user navigates to the item via the keyboard (up and down arrow or search), before a user selects an option with a click or the enter key
            "aggressiveChange": false,

            // **selectWhenHidden: Will allow a user to select an option using the keyboard when the drop down list is hidden and focused
            "selectWhenHidden": true

        },

        // _Create
        // -------
        //      Sets the Plugin Instance variables and
        //      constructs the plugin.  Only called once.
        _create: function() {

            var self = this;

            // If the element calling SelectBoxIt is not a select box
            if(!self.element.is("select")) {

                // Exits the plugin
                return;

            }

            // The original select box DOM element
            self.originalElem = self.element[0];

            // The original select box DOM element wrapped in a jQuery object
            self.selectBox = self.element;

            // All of the original select box options
            self.selectItems = self.element.find("option");

            // The first option in the original select box
            self.firstSelectItem = self.element.find("option").slice(0, 1);

            // The index of the currently selected dropdown list option
            self.currentFocus = 0;

            // Keeps track of which blur events will hide the dropdown list options
            self.blur = true;

            // The html document height
            self.documentHeight = $(document).height();

            // Array holding all of the original select box options text
            self.textArray = [];

            // Maintains search order in the `search` method
            self.currentIndex = 0;

            // Whether or not the dropdown list opens up or down (depending on how much room is on the page)
            self.flipped = false;

            self.disabledClasses = (function() {

                if(self.options.theme === "bootstrap") {

                    return "disabled";

                }
                else if(self.options.theme === "jqueryui") {

                    return "ui-state-disabled";

                }
                else if(self.options.theme === "jquerymobile") {

                    return "ui-disabled";

                }
                else {

                    return "selectboxit-disabled";

                }

            }());

            // Creates the dropdown elements that will become the dropdown
            // Creates the ul element that will become the dropdown options list
            // Add's all attributes (excluding id, class names, and unselectable properties) to the drop down and drop down items list
            // Hides the original select box and adds the new plugin DOM elements to the page
            // Adds event handlers to the new dropdown list
            self._createdropdown()._createUnorderedList()._addSelectBoxAttributes()._replaceSelectBox()._eventHandlers();

            if(self.originalElem.disabled && self.disable) {

                // Disables the dropdown list if the original dropdown list had the `disabled` attribute
                self.disable();

            }

            // If the Aria Accessibility Module has been included
            if(self._ariaAccessibility) {

                // Adds ARIA accessibillity tags to the dropdown list
                self._ariaAccessibility();

            }

            if(self.options["theme"] === "bootstrap") {

                // Adds Twitter Bootstrap classes to the dropdown list
                self._twitterbootstrap();

            }

            else if(this.options["theme"] === "jqueryui") {

                // Adds jQueryUI classes to the dropdown list
                self._jqueryui();

            }

            else if(this.options["theme"] === "jquerymobile") {

                // Adds jQueryUI classes to the dropdown list
                self._jquerymobile();

            }

            else {

                // Adds regular classes to the dropdown list
                self._addClasses();

            }

            // Adds mobile support
            self._mobile();

            // If the native option is set to true

            if(self.options["native"]) {

                // Triggers the native select box when a user is interacting with the drop down
                this._applyNativeSelect();

            }

            // Triggers a custom `create` event on the original dropdown list
            self.triggerEvent("create");

            // Maintains chainability
            return self;

        },

        // _Create dropdown
        // ------------
        //      Creates new dropdown and dropdown elements to replace
        //      the original select box with a dropdown list
        _createdropdown: function() {

            var self = this;

            // Creates a dropdown element that contains the dropdown list text value
            self.dropdownText = $("<span/>", {

                // Dynamically sets the dropdown `id` attribute
                "id": (self.originalElem.id || "") && self.originalElem.id + "SelectBoxItText",

                "class": "selectboxit-text",

                // IE specific attribute to not allow the element to be selected
                "unselectable": "on",

                // Sets the dropdown `text` to equal the original select box default value
                "text": self.firstSelectItem.text()

            }).

            // Sets the HTML5 data attribute on the dropdownText `dropdown` element
            attr("data-val", self.originalElem.value);

            // Creates a dropdown element that contains the dropdown list text value
            self.dropdownImage = $("<i/>", {

                // Dynamically sets the dropdown `id` attribute
                "id": (self.originalElem.id || "") && self.originalElem.id + "SelectBoxItDefaultIcon",

                "class": "selectboxit-default-icon",

                // IE specific attribute to not allow the element to be selected
                "unselectable": "on"

            });

            // Creates a dropdown to act as the new dropdown list
            self.dropdown = $("<span/>", {

                // Dynamically sets the dropdown `id` attribute
                "id": (self.originalElem.id || "") && self.originalElem.id + "SelectBoxIt",

                "class": "selectboxit" + " " + (self.selectBox.attr("class") || ""),

                // Sets the dropdown `name` attribute to be the same name as the original select box
                "name": self.originalElem.name,

                // Sets the dropdown `tabindex` attribute to 0 to allow the dropdown to be focusable
                "tabindex": self.selectBox.attr("tabindex") || "0",

                // IE specific attribute to not allow the element to be selected
                "unselectable": "on"

            }).

            // Appends the default text to the inner dropdown list dropdown element
            append(self.dropdownImage).append(self.dropdownText);

            // Create the dropdown container that will hold all of the dropdown list dom elements
            self.dropdownContainer = $("<span/>", {

                "id": (self.originalElem.id || "") && self.originalElem.id + "SelectBoxItContainer",

                "class": "selectboxit-container"

            }).

            // Appends the inner dropdown list dropdown element to the dropdown list container dropdown element
            append(self.dropdown);

            // Maintains chainability
            return self;

        },

        // _Create Unordered List
        // ----------------------
        //      Creates an unordered list element to hold the
        //        new dropdown list options that directly match
        //        the values of the original select box options
        _createUnorderedList: function() {

            // Storing the context of the widget
            var self = this,

                dataDisabled,

                optgroupClass,

                optgroupElement,

                iconClass,

                iconUrl,

                iconUrlClass,

                iconUrlStyle,

                // Declaring the variable that will hold all of the dropdown list option elements
                currentItem = "",

                // Creates an unordered list element
                createdList = $("<ul/>", {

                    // Sets the unordered list `id` attribute
                    "id": (self.originalElem.id || "") && self.originalElem.id + "SelectBoxItOptions",

                    "class": "selectboxit-options",

                    //Sets the unordered list `tabindex` attribute to -1 to prevent the unordered list from being focusable
                    "tabindex": -1

                });

            // Checks the `showFirstOption` plugin option to determine if the first dropdown list option should be shown in the options list.
            if (!self.options["showFirstOption"]) {

                // Excludes the first dropdown list option from the options list
                self.selectItems = self.selectBox.find("option").slice(1);
            }

            // Loops through the original select box options list and copies the text of each
            // into new list item elements of the new dropdown list
            self.selectItems.each(function(index) {

                optgroupClass = "";

                optgroupElement = "";

                dataDisabled = $(this).prop("disabled");

                iconClass = $(this).data("icon") || "";

                iconUrl = $(this).data("iconurl") || "";

                iconUrlClass = iconUrl ? "selectboxit-option-icon-url": "";

                iconUrlStyle = iconUrl ? 'style="background-image:url(\'' + iconUrl + '\');"': "";

                // If the current option being traversed is within an optgroup

                if($(this).parent().is("optgroup")) {

                    optgroupClass = "selectboxit-optgroup-option";

                    if($(this).index() === 0) {

                         optgroupElement = '<span class="selectboxit-optgroup-header" data-disabled="true">' + $(this).parent().first().attr("label") + '</span>';

                    }

                }

                // Uses string concatenation for speed (applies HTML attribute encoding)
                currentItem += optgroupElement + '<li id="' + index + '" data-val="' + self.htmlEscape(this.value) + '" data-disabled="' + dataDisabled + '" class="' + optgroupClass + " selectboxit-option " + ($(this).attr("class") || "") + '"><a class="selectboxit-option-anchor"><i class="selectboxit-option-icon ' + iconClass + ' ' + iconUrlClass + '"' + iconUrlStyle + '></i>' + self.htmlEscape($(this).text()) + '</a></li>';

                // Stores all of the original select box options text inside of an array
                // (Used later in the `searchAlgorithm` method)
                self.textArray[index] = dataDisabled ? "": $(this).text();

                // Checks the original select box option for the `selected` attribute
                if (this.selected) {

                    //Replace the default text with the selected option
                    self.dropdownText.text($(this).text());

                    //Set the currently selected option
                    self.currentFocus = index;
                }

            });

            // If the `defaultText` option is being used
            if ((self.options["defaultText"] || self.selectBox.data("text")) && !self.selectBox.find("option[selected]").length) {

                var defaultedText = self.options["defaultText"] || self.selectBox.data("text");

                //Overrides the current dropdown default text with the value the user specifies in the `defaultText` option
                self.dropdownText.text(defaultedText);

                self.options["defaultText"] = defaultedText;
            }

            // Append the list item to the unordered list
            createdList.append(currentItem);

            // Stores the dropdown list options list inside of the `list` instance variable
            self.list = createdList;

            // Append the dropdown list options list to the dropdown container element
            self.dropdownContainer.append(self.list);

            // Stores the indropdownidual dropdown list options inside of the `listItems` instance variable
            self.listItems = self.list.find("li");

            // Sets the 'selectboxit-option-first' class name on the first drop down option
            self.listItems.first().addClass("selectboxit-option-first");


            // Sets the 'selectboxit-option-last' class name on the last drop down option
            self.listItems.last().addClass("selectboxit-option-last");

            // Set the disabled CSS class for select box options
            self.list.find("li[data-disabled='true']").not(".optgroupHeader").addClass(self.disabledClasses);

            // If the first select box option is disabled, and the user has chosen to not show the first select box option
            if (self.currentFocus === 0 && !self.options["showFirstOption"] && self.listItems.eq(0).hasClass(self.disabledClasses)) {

                //Sets the default value of the dropdown list to the first option that is not disabled
                self.currentFocus = +self.listItems.not(".ui-state-disabled").first().attr("id");

            }

            self.dropdownImage.addClass(self.selectBox.data("icon") || self.options["defaultIcon"] || self.listItems.eq(self.currentFocus).find("i").attr("class"));

            self.dropdownImage.attr("style", self.listItems.eq(self.currentFocus).find("i").attr("style"));

            //Maintains chainability
            return self;

        },

        // _Replace Select Box
        // -------------------
        //      Hides the original dropdown list and inserts
        //        the new DOM elements
        _replaceSelectBox: function() {

            var self = this;

            // Hides the original select box
            self.selectBox.css("display", "none").

            // Adds the new dropdown list to the page directly after the hidden original select box element
            after(self.dropdownContainer);

            // The height of the dropdown list
            var height = self.dropdown.height();

            // The down arrow element of the dropdown list
            self.downArrow = $("<i/>", {

                // Dynamically sets the dropdown `id` attribute of the dropdown list down arrow
                "id": (self.originalElem.id || "") && self.originalElem.id + "SelectBoxItArrow",

                "class": "selectboxit-arrow",

                // IE specific attribute to not allow the dropdown list text to be selected
                "unselectable": "on"

            });

            // The down arrow container element of the dropdown list
            self.downArrowContainer = $("<span/>", {

                // Dynamically sets the dropdown `id` attribute for the down arrow container element
                "id": (self.originalElem.id || "") && self.originalElem.id + "SelectBoxItArrowContainer",

                "class": "selectboxit-arrow-container",

                // IE specific attribute to not allow the dropdown list text to be selected
                "unselectable": "on"

            }).

            // Inserts the down arrow element inside of the down arrow container element
            append(self.downArrow);

            // Appends the down arrow element to the dropdown list
            self.dropdown.append(this.options["nostyle"] ? self.downArrow : self.downArrowContainer);

            if (!self.options["nostyle"]) {

                // The dynamic CSS of the down arrow container element
                self.downArrowContainer.css({

                    "height": height + "px"

                });

                // Dynamically adds the `max-width` and `line-height` CSS styles of the dropdown list text element
                self.dropdownText.css({

                    "line-height": self.dropdown.css("height"),

                    "max-width": self.dropdown.outerWidth() - (self.downArrowContainer.outerWidth() + self.dropdownImage.outerWidth())
                
                });

                self.dropdownImage.css({

                    "margin-top": height / 4

                });

                // Adds the `selectboxit-selected` class name to the currently selected drop down option
                self.listItems.removeClass("selectboxit-selected").eq(self.currentFocus).addClass("selectboxit-selected");

            }

            // Maintains chainability
            return self;

        },

        // _Scroll-To-View
        // ---------------
        //      Updates the dropdown list scrollTop value
        _scrollToView: function(type) {

            var self = this,

                // The current scroll positioning of the dropdown list options list
                listScrollTop = self.list.scrollTop(),

                // The height of the currently selected dropdown list option
                currentItemHeight = self.listItems.eq(self.currentFocus).height(),

                // The relative distance from the currently selected dropdown list option to the the top of the dropdown list options list
                currentTopPosition = self.listItems.eq(self.currentFocus).position().top,

                // The height of the dropdown list option list
                listHeight = self.list.height();

            // Scrolling logic for a text search
            if (type === "search") {

                // Increases the dropdown list options `scrollTop` if a user is searching for an option
                // below the currently selected option that is not visible
                if (listHeight - currentTopPosition < currentItemHeight) {

                    // The selected option will be shown at the very bottom of the visible options list
                    self.list.scrollTop(listScrollTop + (currentTopPosition - (listHeight - currentItemHeight)));

                }

                // Decreases the dropdown list options `scrollTop` if a user is searching for an option above the currently selected option that is not visible
                else if (currentTopPosition < -1) {

                    self.list.scrollTop(currentTopPosition - currentItemHeight);

                }
            }

            // Scrolling logic for the `up` keyboard navigation
            else if (type === "up") {

                // Decreases the dropdown list option list `scrollTop` if a user is navigating to an element that is not visible
                if (currentTopPosition < -1) {

                    self.list.scrollTop(listScrollTop - Math.abs(self.listItems.eq(self.currentFocus).position().top));

                }
            }

            // Scrolling logic for the `down` keyboard navigation
            else if (type === "down") {

                // Increases the dropdown list options `scrollTop` if a user is navigating to an element that is not fully visible
                if (listHeight - currentTopPosition < currentItemHeight) {

                    // Increases the dropdown list options `scrollTop` by the height of the current option item.
                    self.list.scrollTop((listScrollTop + (Math.abs(self.listItems.eq(self.currentFocus).position().top) - listHeight + currentItemHeight)));

                }
            }

            // Maintains chainability
            return self;

        },

        // _Callback
        // ---------
        //      Call the function passed into the method
        _callbackSupport: function(callback) {

            var self = this;

            // Checks to make sure the parameter passed in is a function
            if ($.isFunction(callback)) {

                // Calls the method passed in as a parameter and sets the current `SelectBoxIt` object that is stored in the jQuery data method as the context(allows for `this` to reference the SelectBoxIt API Methods in the callback function. The `dropdown` DOM element that acts as the new dropdown list is also passed as the only parameter to the callback
                callback.call(self, self.dropdown);

            }

            // Maintains chainability
            return self;

        },

        // Open
        // ----
        //      Opens the dropdown list options list
        open: function(callback) {

            var self = this;
        
            if (self._dynamicPositioning) {

                // Dynamically positions the dropdown list options list
                self._dynamicPositioning();

            }

            if(!this.list.is(":visible")) {

                // Triggers a custom "open" event on the original select box
                self.triggerEvent("open");

                // Determines what jQuery effect to use when opening the dropdown list options list
                switch (self.options["showEffect"]) {

                    // Uses `no effect`
                    case "none":

                        // Does not require a callback function because this animation will complete before the call to `scrollToView`
                        self.list.show();

                       // Updates the list `scrollTop` attribute
                       self._scrollToView("search");

                    break;

                    // Uses the jQuery `show` special effect
                    case "show":

                        // Requires a callback function to determine when the `show` animation is complete
                        self.list.show(self.options["showEffectSpeed"], function() {

                            // Updates the list `scrollTop` attribute
                            self._scrollToView("search");

                        });

                    break;

                   // Uses the jQuery `slideDown` special effect
                   case "slideDown":

                       // Requires a callback function to determine when the `slideDown` animation is complete
                       self.list.slideDown(self.options["showEffectSpeed"], function() {

                           // Updates the list `scrollTop` attribute
                           self._scrollToView("search");

                       });

                   break;

                  // Uses the jQuery `fadeIn` special effect
                  case "fadeIn":

                      // Does not require a callback function because this animation will complete before the call to `scrollToView`
                      self.list.fadeIn(self.options["showEffectSpeed"]);

                      // Updates the list `scrollTop` attribute
                      self._scrollToView("search");

                  break;

                  // If none of the above options were passed, then a `jqueryUI show effect` is expected
                  default:

                     // Allows for custom show effects via the [jQueryUI core effects](http://http://jqueryui.com/demos/show/)
                     self.list.show(self.options["showEffect"], self.options["showEffectOptions"], self.options["showEffectSpeed"], function() {

                         // Updates the list `scrollTop` attribute
                         self._scrollToView("search");

                     });

                 break;

                }

            }

            // Provide callback function support
            self._callbackSupport(callback);

            // Maintains chainability
            return self;

        },

        // Close
        // -----
        //      Closes the dropdown list options list
        close: function(callback) {

            var self = this;

            if(self.list.is(":visible")) {

                // Triggers a custom "close" event on the original select box
                self.triggerEvent("close");
                self.list.parent().removeClass("dropup");
                // Determines what jQuery effect to use when closing the dropdown list options list
                switch (self.options["hideEffect"]) {

                    // Uses `no effect`
                    case "none":

                        // Does not require a callback function because this animation will complete before the call to `scrollToView`
                        self.list.hide();

                        // Updates the list `scrollTop` attribute
                        self._scrollToView("search");

                    break;

                    // Uses the jQuery `hide` special effect
                    case "hide":

                        self.list.hide(self.options["hideEffectSpeed"]);

                    break;

                    // Uses the jQuery `slideUp` special effect
                    case "slideUp":

                    self.list.slideUp(self.options["hideEffectSpeed"]);

                    break;

                    // Uses the jQuery `fadeOut` special effect
                    case "fadeOut":

                        self.list.fadeOut(self.options["hideEffectSpeed"]);

                    break;

                    // If none of the above options were passed, then a `jqueryUI hide effect` is expected
                    default:

                        // Allows for custom hide effects via the [jQueryUI core effects](http://http://jqueryui.com/demos/hide/)
                        self.list.hide(self.options["hideEffect"], self.options["hideEffectOptions"], self.options["hideEffectSpeed"], function() {

                            //Updates the list `scrollTop` attribute
                            self._scrollToView("search");

                        });

                    break;
                }

            }

            // Provide callback function support
            self._callbackSupport(callback);

            // Maintains chainability
            return self;

        },


        // _Event Handlers
        // ---------------
        //      Adds event handlers to the new dropdown list
        _eventHandlers: function() {

            // LOCAL VARIABLES
            var self = this,

                upKey = 38,

                downKey = 40,

                enterKey = 13,

                backspaceKey = 8,

                tabKey = 9,

                spaceKey = 32,

                escKey = 27;

            // Select Box events
            this.dropdown.bind({

                // `click` event with the `selectBoxIt` namespace
                "click.selectBoxIt": function() {

                    // Used to make sure the dropdown becomes focused (fixes IE issue)
                    self.dropdown.trigger("focus", true);

                    // The `click` handler logic will only be applied if the dropdown list is enabled
                    if (!self.originalElem.disabled) {

                        // Triggers the `click` event on the original select box
                        self.triggerEvent("click");

                        // If the dropdown list options list is visible when a user clicks on the dropdown list
                        if (self.list.is(":visible")) {

                            // Closes the dropdown list options list
                            self.close();
                        }

                        // If the dropdown list options list is not visible when a user clicks on the dropdown list
                        else {

                            // Shows the dropdown list options list
                            self.open();
                        }

                    }

                },

                // `mousedown` event with the `selectBoxIt` namespace
                "mousedown.selectBoxIt": function() {

                    // Stores data in the jQuery `data` method to help determine if the dropdown list gains focus from a click or tabstop.  The mousedown event fires before the focus event.
                    $(this).data("mdown", true);

                    self.triggerEvent("mousedown");

                },

                // `mouseup` event with the `selectBoxIt` namespace
                "mouseup.selectBoxIt": function() {

                    self.triggerEvent("mouseup");

                },

                // `blur` event with the `selectBoxIt` namespace.  Uses special blur logic to make sure the dropdown list closes correctly
                "blur.selectBoxIt": function() {

                    // If `self.blur` property is true
                    if (self.blur) {

                        // Triggers both the `blur` and `focusout` events on the original select box.
                        // The `focusout` event is also triggered because the event bubbles
                        // This event has to be used when using event delegation (such as the jQuery `delegate` or `on` methods)
                        // Popular open source projects such as Backbone.js utilize event delegation to bind events, so if you are using Backbone.js, use the `focusout` event instead of the `blur` event
                        self.triggerEvent("blur");

                        //If the dropdown options list is visible
                        if (self.list.is(":visible")) {

                            //Closes the dropdown list options list
                            self.close();

                        }

                    }

                },

                "focus.selectBoxIt": function(event, internal) {

                    // Stores the data associated with the mousedown event inside of a local variable
                    var mdown = $(this).data("mdown");

                    // Removes the jQuery data associated with the mousedown event
                    $(this).removeData("mdown");

                    // If a mousedown event did not occur and no data was passed to the focus event (this correctly triggers the focus event), then the dropdown list gained focus from a tabstop
                    if (!mdown && !internal) {

                        setTimeout(function() {

                            // Triggers the `tabFocus` custom event on the original select box
                            self.triggerEvent("tab-focus");

                        }, 0);

                    }

                    // Only trigger the `focus` event on the original select box if the dropdown list is hidden (this verifies that only the correct `focus` events are used to trigger the event on the original select box
                    if(!internal) {

                        //Triggers the `focus` default event on the original select box
                        self.triggerEvent("focus");

                    }

                },

                // `keydown` event with the `selectBoxIt` namespace.  Catches all user keyboard navigations
                "keydown.selectBoxIt": function(e) {

                    // Stores the `keycode` value in a local variable
                    var currentKey = e.keyCode;

                    // Supports keyboard navigation
                    switch (currentKey) {

                        // If the user presses the `down key`
                        case downKey:

                            // Prevents the page from moving down
                            e.preventDefault();

                            // If the plugin options allow keyboard navigation
                            if (self.moveDown) {

                                if(self.options["keydownOpen"]) {

                                    if(self.list.is(":visible")) {

                                        self.moveDown();

                                    }

                                    else {

                                        self.open();

                                    }

                                }

                                else {

                                    // Moves the focus down to the dropdown list option directly beneath the currently selected selectbox option
                                    self.moveDown();

                                }

                            }

                            if(self.options["keydownOpen"]) {

                                self.open();

                            }

                            break;

                        //If the user presses the `up key`
                        case upKey:

                            // Prevents the page from moving up
                            e.preventDefault();

                            // If the plugin options allow keyboard navigation
                            if (self.moveUp) {

                                if(self.options["keydownOpen"]) {

                                    if(self.list.is(":visible")) {

                                        self.moveUp();

                                    }

                                    else {

                                        self.open();

                                    }

                                }

                                else {

                                    // Moves the focus down to the dropdown list option directly beneath the currently selected selectbox option
                                    self.moveUp();

                                }

                            }

                            if(self.options["keydownOpen"]) {

                                self.open();

                            }

                            break;

                        // If the user presses the `enter key`
                        case enterKey:

                            var activeElem = self.list.find("li." + self.focusClass);
            
                            // If there is no active Elem yet
                            if(!activeElem.length) {

                                activeElem = self.listItems.first();

                            }

                            // Updates the dropdown list value
                            self._update(activeElem);

                            // Prevents the default event from being triggered
                            e.preventDefault();

                            // Checks to see if the dropdown list options list is open
                            if (self.list.is(":visible")) {

                                // Closes the dropdown list options list
                                self.close();

                            }

                            // Triggers the `enter` events on the original select box
                            self.triggerEvent("enter");

                            break;

                        // If the user presses the `tab key`
                        case tabKey:

                            // Triggers the custom `tab-blur` event on the original select box
                            self.triggerEvent("tab-blur");

                            break;

                        // If the user presses the `backspace key`
                        case backspaceKey:

                            // Prevents the browser from navigating to the previous page in its history
                            e.preventDefault();

                            // Triggers the custom `backspace` event on the original select box
                            self.triggerEvent("backspace");

                            break;

                        // If the user presses the `escape key`
                        case escKey:

                            // Closes the dropdown options list
                            self.close();

                            break;

                        // Default is to break out of the switch statement
                        default:

                            break;

                    }

                },

                // `keypress` event with the `selectBoxIt` namespace.  Catches all user keyboard text searches since you can only reliably get character codes using the `keypress` event
                "keypress.selectBoxIt": function(e) {

                    // Sets the current key to the `keyCode` value if `charCode` does not exist.  Used for cross
                    // browser support since IE uses `keyCode` instead of `charCode`.
                    var currentKey = e.charCode || e.keyCode,

                        // Converts unicode values to characters
                        alphaNumericKey = String.fromCharCode(currentKey);

                    // If the user presses the `space bar`
                    if (currentKey === spaceKey) {

                        // Prevents the browser from scrolling to the bottom of the page
                        e.preventDefault();

                    }

                    // If the plugin options allow text searches
                    if (self.search) {

                        // Calls `search` and passes the character value of the user's text search
                        self.search(alphaNumericKey, true, "");

                    }

                },

                // `mousenter` event with the `selectBoxIt` namespace .The mouseenter JavaScript event is proprietary to Internet Explorer. Because of the event's general utility, jQuery simulates this event so that it can be used regardless of browser.
                "mouseenter.selectBoxIt": function() {

                    // Trigger the `mouseenter` event on the original select box
                    self.triggerEvent("mouseenter");

                },

                // `mouseleave` event with the `selectBoxIt` namespace. The mouseleave JavaScript event is proprietary to Internet Explorer. Because of the event's general utility, jQuery simulates this event so that it can be used regardless of browser.
                "mouseleave.selectBoxIt": function() {

                    // Trigger the `mouseleave` event on the original select box
                    self.triggerEvent("mouseleave");

                }

            });

            // Select box options events that set the dropdown list blur logic (decides when the dropdown list gets
            // closed)
            self.list.bind({

                // `mouseover` event with the `selectBoxIt` namespace
                "mouseover.selectBoxIt": function() {

                    // Prevents the dropdown list options list from closing
                    self.blur = false;

                },

                // `mouseout` event with the `selectBoxIt` namespace
                "mouseout.selectBoxIt": function() {

                    // Allows the dropdown list options list to close
                    self.blur = true;

                },

                // `focusin` event with the `selectBoxIt` namespace
                "focusin.selectBoxIt": function() {

                    // Prevents the default browser outline border to flicker, which results because of the `blur` event
                    self.dropdown.trigger("focus", true);
                }

            })

            // Select box indropdownidual options events bound with the jQuery `delegate` method.  `Delegate` was used because binding indropdownidual events to each list item (since we don't know how many there will be) would decrease performance.  Instead, we bind each event to the unordered list, provide the list item context, and allow the list item events to bubble up (`event bubbling`). This greatly increases page performance because we only have to bind an event to one element instead of x number of elements. Delegates the `click` event with the `selectBoxIt` namespace to the list items
            .delegate("li", "click.selectBoxIt", function() {

                self._update($(this));

                self.triggerEvent("option-click");

                // If the current drop down option is not disabled
                if ($(this).attr("data-disabled") === "false") {

                    // Closes the drop down list
                    self.close();

                }

            })

            // Delegates the `focus` event with the `selectBoxIt` namespace to the list items
            .delegate("li", "focusin.selectBoxIt", function() {

                // Removes the hover class from the previous drop down option
                self.listItems.not($(this)).removeAttr("data-active");

                $(this).attr("data-active", "");

                if((self.options["searchWhenHidden"] && self.list.is(":hidden")) || self.options["aggressiveChange"] || (self.list.is(":hidden") && self.options["selectWhenHidden"])) {

                    self._update($(this));

                }

            });

            // Original dropdown list events
            self.selectBox.bind({

                // `change` event handler with the `selectBoxIt` namespace
                "change.selectBoxIt, internal-change.selectBoxIt": function(event, internal) {

                    // If the user called the change method
                    if(!internal) {

                        var currentOption = self.list.find('li[data-val="' + self.originalElem.value + '"]');

                        // If there is a dropdown option with the same value as the original select box element
                        if(currentOption.length) {

                            self.listItems.eq(self.currentFocus).removeClass(self.focusClass);

                            self.currentFocus = +currentOption.attr("id");



                        }

                    }

                    // Sets the new dropdown list text to the value of the current option
                    self.dropdownText.text(self.listItems.eq(self.currentFocus).find("a").text()).attr("data-val", self.originalElem.value);

                    if(self.listItems.eq(self.currentFocus).find("i").attr("class")) {

                        self.dropdownImage.attr("class", self.listItems.eq(self.currentFocus).find("i").attr("class")).addClass("selectboxit-default-icon");

                        self.dropdownImage.attr("style", self.listItems.eq(self.currentFocus).find("i").attr("style"));
                    }

                    // Triggers a custom changed event on the original select box
                    self.triggerEvent("changed");

                },

                // `disable` event with the `selectBoxIt` namespace
                "disable.selectBoxIt": function() {

                    // Adds the `disabled` CSS class to the new dropdown list to visually show that it is disabled
                    self.dropdown.addClass(self.disabledClasses);

                },

                // `enable` event with the `selectBoxIt` namespace
                "enable.selectBoxIt": function() {

                    // Removes the `disabled` CSS class from the new dropdown list to visually show that it is enabled
                    self.dropdown.removeClass(self.disabledClasses);

                }

            });

            // Maintains chainability
            return self;

        },

        // _update
        // -------
        //      Updates the drop down and select box with the current value
        _update: function(elem) {

            var self = this;

            if (elem.attr("data-disabled") === "false") {

                // If the default text option is set and the current drop down option is not disabled
                if ((self.options["defaultText"] && self.dropdownText.text() === self.options["defaultText"]) && self.selectBox.val() === elem.attr("data-val")) {

                    // Updates the dropdown list value
                    self.dropdownText.text(self.listItems.eq(self.currentFocus).text()).

                    trigger("internal-change");

                }

                else {

                    // Sets the original dropdown list value and triggers the `change` event on the original select box
                    self.selectBox.val(elem.attr("data-val"));

                    // Sets `currentFocus` to the currently focused dropdown list option.
                    // The unary `+` operator casts the string to a number
                    // [James Padolsey Blog Post](http://james.padolsey.com/javascript/terse-javascript-101-part-2/)
                    self.currentFocus = +elem.attr("id");

                    // Triggers the dropdown list `change` event if a value change occurs
                    if (self.originalElem.value !== self.dropdownText.attr("data-val")) {

                        self.triggerEvent("change");

                    }

                }

            }

        },

        // _addClasses
        // -----------
        //      Adds SelectBoxIt CSS classes
        _addClasses: function(obj) {

            var self = this,

                focusClass = obj.focusClasses || "selectboxit-focus",

                hoverClass = obj.hoverClasses || "selectboxit-hover",

                buttonClass = obj.buttonClasses || "selectboxit-btn",

                listClass = obj.listClasses || "selectboxit-dropdown";

            self.focusClass = focusClass;

            self.selectedClass = "selectboxit-selected";

            self.downArrow.addClass(self.selectBox.data("downarrow") || self.options["downArrowIcon"] || obj.arrowClasses);

            // Adds the correct container class to the dropdown list
            self.dropdownContainer.addClass(obj.containerClasses);

            // Adds the correct class to the dropdown list
            self.dropdown.addClass(buttonClass);

            // Adds the default class to the dropdown list options
            self.list.addClass(listClass);

            // Select box individual option events
            self.listItems.bind({

                // `focus` event with the `selectBoxIt` namespace
                "focusin.selectBoxIt": function() {

                    // Adds the focus CSS class to the currently focused dropdown list option
                    $(this).addClass(focusClass);

                },

                // `blur` event with the `selectBoxIt` namespace
                "blur.selectBoxIt": function() {

                    // Removes the focus CSS class from the previously focused dropdown list option
                    $(this).removeClass(focusClass);

                }

            });

            // Select box events
            self.selectBox.bind({

                // `click` event with the `selectBoxIt` namespace
                "open.selectBoxIt": function() {

                    var currentElem = self.list.find("li[data-val='" + self.dropdownText.attr("data-val") + "']");

                    // If no current element can be found, then select the first drop down option
                    if(!currentElem.length) {

                        currentElem = self.listItems.first();

                    }

                    self.currentFocus = +currentElem.attr("id");

                    var activeElem = self.listItems.eq(self.currentFocus);

                    // Removes the focus class from the dropdown list and adds the library focus class for both the dropdown list and the currently selected dropdown list option
                    self.dropdown.removeClass(hoverClass).addClass(focusClass);

                    self.listItems.removeClass(self.selectedClass);

                    self.listItems.removeAttr("data-active").not(activeElem).removeClass(focusClass);

                    activeElem.addClass(focusClass).addClass(self.selectedClass);

                },

                "blur.selectBoxIt": function() {

                    self.dropdown.removeClass(focusClass);

                },

                // `mousenter` event with the `selectBoxIt` namespace
                "mouseenter.selectBoxIt": function() {

                    self.dropdown.addClass(hoverClass);

                },

                // `mouseleave` event with the `selectBoxIt` namespace
                "mouseleave.selectBoxIt": function() {

                    // Removes the hover CSS class on the previously hovered dropdown list option
                    self.dropdown.removeClass(hoverClass);

                }

            });

            self.listItems.bind({

                "mouseenter.selectBoxIt": function() {

                    // If the currently moused over drop down option is not disabled
                    if($(this).attr("data-disabled") === "false") {

                        self.listItems.removeAttr("data-active");

                        $(this).addClass(focusClass).attr("data-active", "");

                        // Sets the dropdown list indropdownidual options back to the default state and sets the focus CSS class on the currently hovered option
                        self.listItems.not($(this)).removeClass(focusClass);

                        $(this).addClass(focusClass);

                        self.currentFocus = +$(this).attr("id");

                    }

                },

                "mouseleave.selectBoxIt": function() {

                    // If the currently moused over drop down option is not disabled
                    if($(this).attr("data-disabled") === "false") {

                        // Removes the focus class from the previous drop down option
                        self.listItems.not($(this)).removeClass(focusClass).removeAttr("data-active");

                        $(this).addClass(focusClass);

                        self.currentFocus = +$(this).attr("id");

                    }

                }

            });

            $(".selectboxit-option-icon").not(".selectboxit-default-icon").css("margin-top", self.downArrowContainer.height()/4);

            // Maintains chainability
            return self;

        },

        // _jqueryui
        // ---------
        //      Adds jQueryUI CSS classes
        _jqueryui: function() {

            var self = this;

            self._addClasses({

                focusClasses: "ui-state-focus",

                hoverClasses: "ui-state-hover",

                arrowClasses: "ui-icon ui-icon-triangle-1-s",

                buttonClasses: "ui-widget ui-state-default",

                listClasses: "ui-widget ui-widget-content",

                containerClasses: "jqueryui"

            });

            // Maintains chainability
            return self;

        },

        // _twitterbootstrap
        // -----------------
        //      Adds Twitter Bootstrap CSS classes
        _twitterbootstrap: function() {

            var self = this;

            self._addClasses({

                focusClasses: "active",

                hoverClasses: "",

                arrowClasses: "caret",

                buttonClasses: "btn",

                listClasses: "dropdown-menu",

                containerClasses: "bootstrap"

            });

            // Maintains chainability
            return self;

        },

        // _jquerymobile
        // -------------
        //      Adds jQuery Mobile CSS classes
        _jquerymobile: function() {

            var self = this,
                theme = self.selectBox.attr("data-theme") || "c";

            self._addClasses({

                focusClasses: "ui-btn-down-" + theme,

                hoverClasses: "ui-btn-hover-" + theme,

                arrowClasses: "ui-icon ui-icon-arrow-d ui-icon-shadow",

                buttonClasses: "ui-btn ui-btn-icon-right ui-btn-corner-all ui-shadow ui-btn-up-" + theme,

                listClasses: "ui-btn ui-btn-icon-right ui-btn-corner-all ui-shadow ui-btn-up-" + theme,

                containerClasses: "jquerymobile"

            });

            // Maintains chainability
            return self;

        },

        // Destroy
        // -------
        //    Removes the plugin from the page

        destroy: function(callback) {

            var self = this;

            self._destroySelectBoxIt();

            // Calls the jQueryUI Widget Factory destroy method
            $.Widget.prototype.destroy.call(self);

            //Provides callback function support
            self._callbackSupport(callback);

            //Maintains chainability
            return self;

        },

        // Internal Destroy Method
        // -----------------------
        //    Removes the plugin from the page
        _destroySelectBoxIt: function() {

            var self = this;

            //Unbinds all of the dropdown list event handlers with the `selectBoxIt` namespace
            self.dropdown.unbind(".selectBoxIt").

            //Undelegates all of the dropdown list event handlers with the `selectBoxIt` namespace
            undelegate(".selectBoxIt");

            //Remove all of the `selectBoxIt` DOM elements from the page
            self.dropdownContainer.remove();

            //Triggers the custom `destroy` event on the original select box
            self.triggerEvent("destroy");

            // Shows the original dropdown list
            self.selectBox.removeAttr("style").show();

            //Maintains chainability
            return self;

        },

        // Refresh
        // -------
        //    The dropdown will rebuild itself.  Useful for dynamic content.

        refresh: function(callback) {

            var self = this;

            // Destroys the plugin and then recreates the plugin
            self._destroySelectBoxIt()._create(true)._callbackSupport(callback);

            self.triggerEvent("refresh");

            //Maintains chainability
            return self;

        },

        // Apply Native Select
        // -------------------
        //      The dropdown will use the native select box functionality

        _applyNativeSelect: function() {

            var self = this,
                currentOption;

            self.dropdownContainer.css({

                "position": "static"

            });

            // Positions the original select box directly over top the new dropdown list using position absolute and "hides" the original select box using an opacity of 0.  This allows the mobile browser "wheel" interface for better usability.
            self.selectBox.css({

                "display": "block",

                "width": self.dropdown.outerWidth(),

                "height": self.dropdown.outerHeight(),

                "opacity": "0",

                "position": "absolute",

                "top": self.dropdown.position().top,

                "bottom": self.dropdown.position().bottom,

                "left": self.dropdown.position().left,

                "right": self.dropdown.position().right,

                "cursor": "pointer",

                "z-index": "999999"

            }).bind({

                "changed.selectBoxIt": function() {

                    currentOption = self.selectBox.find("option").filter(":selected");

                    // Sets the new dropdown list text to the value of the original dropdown list
                    self.dropdownText.text(currentOption.text());

                    if(self.list.find('li[data-val="' + currentOption.val() + '"]').find("i").attr("class")) {

                        self.dropdownImage.attr("class", self.list.find('li[data-val="' + currentOption.val() + '"]').find("i").attr("class")).addClass("selectboxit-default-icon");

                    }

                }

            });

        },

        _mobile: function(callback) {

            var self = this;
            if(this.options["isMobile"]()) {

                self._applyNativeSelect();

            }

            //Maintains chainability
            return this;

        },

        // HTML Escape
        // -----------
        //      HTML encodes a string
        htmlEscape: function(str) {
    
            return String(str)
                .replace(/&/g, '&amp;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#39;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;');

        },

        // triggerEvent
        // ------------
        //      Trigger's an external event on the original select box
        triggerEvent: function(eventName) {

            var self = this,
                // Finds the currently option index
                currentIndex = self.options["showFirstOption"] ? self.currentFocus : ((self.currentFocus - 1) >= 0 ? self.currentFocus: 0 );

                // Triggers the custom option-click event on the original select box and passes the select box option
                self.selectBox.trigger(eventName, { "elem": self.selectBox.eq(currentIndex), "dropdown-elem": self.listItems.eq(self.currentFocus) });


            // Maintains chainability
            return self;

        },

        // addSelectBoxAttributes
        // ----------------------
        //      Add's all attributes (excluding id, class names, and the style attribute) from the default select box to the new drop down
        _addSelectBoxAttributes: function(eventName) {

            var self = this;

            // Add's all attributes to the currently traversed drop down option
            self._addAttributes(self.selectBox.prop("attributes"), self.dropdown);

            // Add's all attributes to the drop down items list
            self.selectItems.each(function(iterator) {

                // Add's all attributes to the currently traversed drop down option
                self._addAttributes($(this).prop("attributes"), self.listItems.eq(iterator));

            });

            // Maintains chainability
            return self;

        },

        // addAttributes
        // -------------
        //  Add's attributes to a DOM element
        _addAttributes: function(arr, elem) {

            var self = this,
                // Attributes that will be copied over to the new drop down
                whitelist = [

                    "title",

                    "rel"

                ];

            // If there are array properties
            if(arr.length) {

                // Iterates over all of array properties
                $.each(arr, function(iterator, property) {

                    // Get's the property name and property value of each property
                    var propName = (property.name).toLowerCase(), propValue = property.value;

                    // If the currently traversed property value is not "null", is on the whitelist, or is an HTML 5 data attribute
                    if(propValue !== "null" && ($.inArray(propName, whitelist) !== -1 || propName.indexOf("data") !== -1)) {

                        // Set's the currently traversed property on element
                        elem.attr(propName, propValue);

                    }

                });

            }

            // Maintains chainability
            return self;

        }

    });

})); // End of core module
// Accessibility Module
// ====================

// Immediately-Invoked Function Expression (IIFE) [Ben Alman Blog Post](http://benalman.com/news/2010/11/immediately-invoked-function-expression/) that calls another IIFE that contains all of the plugin logic.  I used this pattern so that anyone viewing this code would not have to scroll to the bottom of the page to view the local parameters that were passed to the main IIFE.

(function (selectBoxIt) {

    //ECMAScript 5 Strict Mode: [John Resig Blog Post](http://ejohn.org/blog/ecmascript-5-strict-mode-json-and-more/)
    "use strict";

    // Calls the second IIFE and locally passes in the global jQuery, window, and document objects
    selectBoxIt(window.jQuery, window, document);

}

// Locally passes in `jQuery`, the `window` object, the `document` object, and an `undefined` variable.  The `jQuery`, `window` and `document` objects are passed in locally, to improve performance, since javascript first searches for a variable match within the local variables set before searching the global variables set.  All of the global variables are also passed in locally to be minifier friendly. `undefined` can be passed in locally, because it is not a reserved word in JavaScript.

(function ($, window, document, undefined) {

    // ECMAScript 5 Strict Mode: [John Resig Blog Post](http://ejohn.org/blog/ecmascript-5-strict-mode-json-and-more/)
    "use strict";

    //_ARIA Accessibility
    // ------------------
    //      Adds ARIA (Accessible Rich Internet Applications)
    //      Accessibility Tags to the Select Box

    $.selectBox.selectBoxIt.prototype._ariaAccessibility = function() {

        var self = this;

        //Adds `ARIA attributes` to the dropdown list
        self.dropdown.attr({

            //W3C `combobox` description: A presentation of a select; usually similar to a textbox where users can type ahead to select an option.
            "role": "combobox",

            //W3C `aria-autocomplete` description: Indicates whether user input completion suggestions are provided.
            "aria-autocomplete": "list",

            //W3C `aria-expanded` description: Indicates whether the element, or another grouping element it controls, is currently expanded or collapsed.
            "aria-expanded": "false",

            //W3C `aria-owns` description: The value of the aria-owns attribute is a space-separated list of IDREFS that reference one or more elements in the document by ID. The reason for adding aria-owns is to expose a parent/child contextual relationship to assistive technologies that is otherwise impossible to infer from the DOM.
            "aria-owns": self.list.attr("id"),

            //W3C `aria-activedescendant` description: This is used when a composite widget is responsible for managing its current active child to reduce the overhead of having all children be focusable. Examples include: multi-level lists, trees, and grids.
            "aria-activedescendant": self.listItems.eq(self.currentFocus).attr("id"),

            //W3C `aria-label` description:  It provides the user with a recognizable name of the object.
            "aria-label": $("label[for='" + self.originalElem.id + "']").text() || "",

            //W3C `aria-live` description: Indicates that an element will be updated.
            //Use the assertive value when the update needs to be communicated to the user more urgently.
            "aria-live": "assertive"
        }).

        //Dynamically adds `ARIA attributes` if the new dropdown list is enabled or disabled
        bind({

            //Select box custom `disable` event with the `selectBoxIt` namespace
            "disable.selectBoxIt" : function() {

                //W3C `aria-disabled` description: Indicates that the element is perceivable but disabled, so it is not editable or otherwise operable.
                self.dropdown.attr("aria-disabled", "true");

            },

            //Select box custom `enable` event with the `selectBoxIt` namespace
            "enable.selectBoxIt" : function() {

                //W3C `aria-disabled` description: Indicates that the element is perceivable but disabled, so it is not editable or otherwise operable.
                self.dropdown.attr("aria-disabled", "false");

            }

        });

        //Adds ARIA attributes to the dropdown list options list
        self.list.attr({

            //W3C `listbox` description: A widget that allows the user to select one or more items from a list of choices.
            "role": "listbox",

            //Indicates that the dropdown list options list is currently hidden
            "aria-hidden": "true"
        });

        //Adds `ARIA attributes` to the dropdown list options
        self.listItems.attr({

            //This must be set for each element when the container element role is set to `listbox`
            "role": "option"
        });

        //Dynamically updates the new dropdown list `aria-label` attribute after the original dropdown list value changes
        self.selectBox.bind({

            //Custom `change` event with the `selectBoxIt` namespace
            "change.selectBoxIt": function() {

                //Provides the user with a recognizable name of the object.
                self.dropdownText.attr("aria-label", self.originalElem.value);

            },

            //Custom `open` event with the `selectBoxIt` namespace
            "open.selectBoxIt": function() {

                //Indicates that the dropdown list options list is currently visible
                self.list.attr("aria-hidden", "false");

                //Indicates that the dropdown list is currently expanded
                self.dropdown.attr("aria-expanded", "true");

            },

            //Custom `close` event with the `selectBoxIt` namespace
            "close.selectBoxIt": function() {

                //Indicates that the dropdown list options list is currently hidden
                self.list.attr("aria-hidden", "true");

                //Indicates that the dropdown list is currently collapsed
                self.dropdown.attr("aria-expanded", "false");

            }

        });

        //Maintains chainability
        return self;

    };

}));
// Disable Module
// ==============

// Immediately-Invoked Function Expression (IIFE) [Ben Alman Blog Post](http://benalman.com/news/2010/11/immediately-invoked-function-expression/) that calls another IIFE that contains all of the plugin logic.  I used this pattern so that anyone viewing this code would not have to scroll to the bottom of the page to view the local parameters that were passed to the main IIFE.

(function (selectBoxIt) {

    //ECMAScript 5 Strict Mode: [John Resig Blog Post](http://ejohn.org/blog/ecmascript-5-strict-mode-json-and-more/)
    "use strict";

    // Calls the second IIFE and locally passes in the global jQuery, window, and document objects
    selectBoxIt(window.jQuery, window, document);

}

// Locally passes in `jQuery`, the `window` object, the `document` object, and an `undefined` variable.  The `jQuery`, `window` and `document` objects are passed in locally, to improve performance, since javascript first searches for a variable match within the local variables set before searching the global variables set.  All of the global variables are also passed in locally to be minifier friendly. `undefined` can be passed in locally, because it is not a reserved word in JavaScript.

(function ($, window, document, undefined) {

    // ECMAScript 5 Strict Mode: [John Resig Blog Post](http://ejohn.org/blog/ecmascript-5-strict-mode-json-and-more/)
    "use strict";

    // Disable
    // -------
    //      Disables the new dropdown list

    $.selectBox.selectBoxIt.prototype.disable = function(callback) {

        var self = this;

        if(!self.options["disabled"]) {

            // Makes sure the dropdown list is closed
            self.close();

            // Triggers a `disable` custom event on the original select box
            self.triggerEvent("disable");

            // Sets the `disabled` attribute on the original select box
           self.selectBox.attr("disabled", "disabled");

           // Makes the dropdown list not focusable by removing the `tabindex` attribute
           self.dropdown.removeAttr("tabindex")

           // Enabled styling for disabled state
           .addClass("selectboxit-disabled");

           // Calls the jQueryUI Widget Factory disable method to make sure all options are correctly synced
           $.Widget.prototype.disable.call(self);

        }

        // Provides callback function support
        self._callbackSupport(callback);

        // Maintains chainability
        return self;

    };

    // Disable Option
    // --------------
    //      Disables a single drop down option

    $.selectBox.selectBoxIt.prototype.disableOption = function(index, callback) {

        var self = this, currentSelectBoxOption, hasNextEnabled, hasPreviousEnabled;

        // If an index is passed to target an indropdownidual drop down option
        if(typeof index === "number") {

            // Makes sure the dropdown list is closed
            self.close();

            // The select box option being targeted
            currentSelectBoxOption = self.selectBox.find("option").eq(index);

            // Triggers a `disable-option` custom event on the original select box and passes the disabled option
            self.triggerEvent("disable-option");

            // Disables the targeted select box option
            currentSelectBoxOption.attr("disabled", "disabled");

            // Disables the drop down option
            self.listItems.eq(index).attr("data-disabled", "true").

            // Applies disabled styling for the drop down option
            addClass(self.disabledClasses);

            // If the currently selected drop down option is the item being disabled
            if(self.currentFocus === index) {

                hasNextEnabled = self.listItems.eq(self.currentFocus).nextAll("li").not("[data-disabled='true']").first().length;

                hasPreviousEnabled = self.listItems.eq(self.currentFocus).prevAll("li").not("[data-disabled='true']").first().length;

                // If there is a currently enabled option beneath the currently selected option
                if(hasNextEnabled) {

                    // Selects the option beneath the currently selected option
                    self.moveDown();

                }

                // If there is a currently enabled option above the currently selected option
                else if(hasPreviousEnabled) {

                    // Selects the option above the currently selected option
                    self.moveUp();

                }

                // If there is not a currently enabled option
                else {

                    // Disables the entire drop down list
                    self.disable();

                }

            }

        }

        // Provides callback function support
        self._callbackSupport(callback);

        // Maintains chainability
        return self;

    };

    //_Is Disabled
    // -----------
    //      Checks the original select box for the
    //    disabled attribute

    $.selectBox.selectBoxIt.prototype._isDisabled = function(callback) {

        var self = this;

        //If the original select box is disabled
        if (self.originalElem.disabled) {

            //Disables the dropdown list
            self.disable();
        }

        //Maintains chainability
        return self;

    };

}));
// Dynamic Positioning Module
// ==========================

// Immediately-Invoked Function Expression (IIFE) [Ben Alman Blog Post](http://benalman.com/news/2010/11/immediately-invoked-function-expression/) that calls another IIFE that contains all of the plugin logic.  I used this pattern so that anyone viewing this code would not have to scroll to the bottom of the page to view the local parameters that were passed to the main IIFE.

(function (selectBoxIt) {

    //ECMAScript 5 Strict Mode: [John Resig Blog Post](http://ejohn.org/blog/ecmascript-5-strict-mode-json-and-more/)
    "use strict";

    // Calls the second IIFE and locally passes in the global jQuery, window, and document objects
    selectBoxIt(window.jQuery, window, document);

}

// Locally passes in `jQuery`, the `window` object, the `document` object, and an `undefined` variable.  The `jQuery`, `window` and `document` objects are passed in locally, to improve performance, since javascript first searches for a variable match within the local variables set before searching the global variables set.  All of the global variables are also passed in locally to be minifier friendly. `undefined` can be passed in locally, because it is not a reserved word in JavaScript.

(function ($, window, document, undefined) {

    // ECMAScript 5 Strict Mode: [John Resig Blog Post](http://ejohn.org/blog/ecmascript-5-strict-mode-json-and-more/)
    "use strict";

    //_Dynamic positioning
    // ------------------
    //      Dynamically positions the dropdown list options list

    $.selectBox.selectBoxIt.prototype._dynamicPositioning = function() {

        var self = this,

            // Returns the x and y coordinates of the dropdown list options list relative to the document
            listOffsetTop = self.dropdown.offset().top,

            // The height of the dropdown list options list
            listHeight = self.list.data("max-height") || self.list.outerHeight(),

            // The height of the dropdown list DOM element
            selectBoxHeight = self.dropdown.outerHeight(),

            windowHeight = $(window).height(),

            windowScrollTop = $(window).scrollTop(),

            topToBottom = (listOffsetTop + selectBoxHeight + listHeight <= windowHeight + windowScrollTop),

            bottomReached = !topToBottom;

        if(!self.list.data("max-height")) {

            self.list.data("max-height", self.list.outerHeight());

        }

        // Makes sure the original select box is hidden
        self.selectBox.css("display", "none");

        // If there is room on the bottom of the viewport to display the drop down options
        if (!bottomReached) {
           
            self.list.css("max-height", self.list.data("max-height"));

            // Sets custom CSS properties to place the dropdown list options directly below the dropdown list
            self.list.css("top", "auto");

        }

        // If there is room on the top of the viewport
        else if((self.dropdown.offset().top - windowScrollTop) >= listHeight) {

            self.list.css("max-height", self.list.data("max-height"));

            // Sets custom CSS properties to place the dropdown list options directly above the dropdown list
            self.list.css("top", (self.dropdown.position().top - self.list.outerHeight()));
            self.list.parent().addClass("dropup");
        }

        // If there is not enough room on the top or the bottom
        else {
            var outsideBottomViewport = Math.abs((listOffsetTop + selectBoxHeight + listHeight) - (windowHeight + windowScrollTop)),

                outsideTopViewport = Math.abs((self.dropdown.offset().top - windowScrollTop) - listHeight);

            // If there is more room on the bottom
            if(outsideBottomViewport < outsideTopViewport) {

                self.list.css("max-height", self.list.data("max-height") - 
                                outsideBottomViewport - (selectBoxHeight/2) - 30 );

                self.list.css("top", "auto");

            }

            // If there is more room on the top
            else {
                self.list.css("max-height", self.list.data("max-height") - 
                                outsideTopViewport - (selectBoxHeight/2) - 50 );

                // Sets custom CSS properties to place the dropdown list options directly above the dropdown list
                self.list.css("top", (self.dropdown.position().top - self.list.outerHeight()));
                self.list.parent().addClass("dropup");
            }

        }

        // Maintains chainability
        return self;

    };

}));
// Enable Module
// =============

// Immediately-Invoked Function Expression (IIFE) [Ben Alman Blog Post](http://benalman.com/news/2010/11/immediately-invoked-function-expression/) that calls another IIFE that contains all of the plugin logic.  I used this pattern so that anyone viewing this code would not have to scroll to the bottom of the page to view the local parameters that were passed to the main IIFE.

(function (selectBoxIt) {

    //ECMAScript 5 Strict Mode: [John Resig Blog Post](http://ejohn.org/blog/ecmascript-5-strict-mode-json-and-more/)
    "use strict";

    // Calls the second IIFE and locally passes in the global jQuery, window, and document objects
    selectBoxIt(window.jQuery, window, document);

}

// Locally passes in `jQuery`, the `window` object, the `document` object, and an `undefined` variable.  The `jQuery`, `window` and `document` objects are passed in locally, to improve performance, since javascript first searches for a variable match within the local variables set before searching the global variables set.  All of the global variables are also passed in locally to be minifier friendly. `undefined` can be passed in locally, because it is not a reserved word in JavaScript.

(function ($, window, document, undefined) {

    // ECMAScript 5 Strict Mode: [John Resig Blog Post](http://ejohn.org/blog/ecmascript-5-strict-mode-json-and-more/)
    "use strict";

    //Enable
    // -----
    //      Enables the new dropdown list

    $.selectBox.selectBoxIt.prototype.enable = function(callback) {

        var self = this;

        if(self.options["disabled"]) {

            // Triggers a `enable` custom event on the original select box
            self.triggerEvent("enable");

            // Removes the `disabled` attribute from the original dropdown list
            self.selectBox.removeAttr("disabled");

            // Make the dropdown list focusable
            self.dropdown.attr("tabindex", 0)

            // Disable styling for disabled state
            .removeClass(self.disabledClasses);
                
            $.Widget.prototype.enable.call(self);

            // Provide callback function support
            self._callbackSupport(callback);

            }

            //Maintains chainability
            return self;

        };

    // Enable Option
    // -------------
    //      Disables a single drop down option

    $.selectBox.selectBoxIt.prototype.enableOption = function(index, callback) {

        var self = this, currentSelectBoxOption, currentIndex = 0, hasNextEnabled, hasPreviousEnabled;

        // If an index is passed to target an indropdownidual drop down option
        if(typeof index === "number") {

            // The select box option being targeted
            currentSelectBoxOption = self.selectBox.find("option").eq(index);

            // Triggers a `enable-option` custom event on the original select box and passes the enabled option
            self.triggerEvent("enable-option");

            // Disables the targeted select box option
            currentSelectBoxOption.removeAttr("disabled");

            // Disables the drop down option
            self.listItems.eq(index).attr("data-disabled", "false").

            // Applies disabled styling for the drop down option
            removeClass(self.disabledClasses);

        }

        // Provides callback function support
        self._callbackSupport(callback);

        // Maintains chainability
        return self;

    };

}));
// Keyboard Navigation Module
// ==========================

// Immediately-Invoked Function Expression (IIFE) [Ben Alman Blog Post](http://benalman.com/news/2010/11/immediately-invoked-function-expression/) that calls another IIFE that contains all of the plugin logic.  I used this pattern so that anyone viewing this code would not have to scroll to the bottom of the page to view the local parameters that were passed to the main IIFE.

(function (selectBoxIt) {

    //ECMAScript 5 Strict Mode: [John Resig Blog Post](http://ejohn.org/blog/ecmascript-5-strict-mode-json-and-more/)
    "use strict";

    // Calls the second IIFE and locally passes in the global jQuery, window, and document objects
    selectBoxIt(window.jQuery, window, document);

}

// Locally passes in `jQuery`, the `window` object, the `document` object, and an `undefined` variable.  The `jQuery`, `window` and `document` objects are passed in locally, to improve performance, since javascript first searches for a variable match within the local variables set before searching the global variables set.  All of the global variables are also passed in locally to be minifier friendly. `undefined` can be passed in locally, because it is not a reserved word in JavaScript.

(function ($, window, document, undefined) {

    // ECMAScript 5 Strict Mode: [John Resig Blog Post](http://ejohn.org/blog/ecmascript-5-strict-mode-json-and-more/)
    "use strict";

    //Move Down
    // --------
    //      Handles the down keyboard navigation logic

    $.selectBox.selectBoxIt.prototype.moveDown = function(callback) {

        var self = this;

        // Increments `currentFocus`, which represents the currently focused list item `id` attribute.
        self.currentFocus += 1;

        // Determines whether the dropdown option the user is trying to go to is currently disabled
        var disabled = self.listItems.eq(self.currentFocus).attr("data-disabled") === "true" ? true: false,

            hasNextEnabled = self.listItems.eq(self.currentFocus).nextAll("li").not("[data-disabled='true']").first().length;

        // If the user has reached the top of the list
        if (self.currentFocus === self.listItems.length) {

            // Does not allow the user to continue to go up the list
            self.currentFocus -= 1;

        }

        // If the option the user is trying to go to is disabled, but there is another enabled option
        else if (disabled && hasNextEnabled) {

            // Blur the previously selected option
            self.listItems.eq(self.currentFocus - 1).blur();

            // Call the `moveDown` method again
            self.moveDown();

            // Exit the method
            return;

        }

        // If the option the user is trying to go to is disabled, but there is not another enabled option
        else if (disabled && !hasNextEnabled) {

            self.currentFocus -= 1;

        }

        // If the user has not reached the bottom of the unordered list
        else {

            // Blurs the previously focused list item
            // The jQuery `end()` method allows you to continue chaining while also using a different selector
            self.listItems.eq(self.currentFocus - 1).blur().end().

            // Focuses the currently focused list item
            eq(self.currentFocus).focusin();

            // Calls `scrollToView` to make sure the `scrollTop` is correctly updated. The `down` user action
            self._scrollToView("down");

            // Triggers the custom `moveDown` event on the original select box
            self.triggerEvent("moveDown");

        }

        // Provide callback function support
        self._callbackSupport(callback);

        // Maintains chainability
        return self;

    };

    //Move Up
    // ------
    //      Handles the up keyboard navigation logic
    $.selectBox.selectBoxIt.prototype.moveUp = function(callback) {

        var self = this;

        // Increments `currentFocus`, which represents the currently focused list item `id` attribute.
        self.currentFocus -= 1;

        // Determines whether the dropdown option the user is trying to go to is currently disabled
        var disabled = self.listItems.eq(self.currentFocus).attr("data-disabled") === "true" ? true: false,

            hasPreviousEnabled = self.listItems.eq(self.currentFocus).prevAll("li").not("[data-disabled='true']").first().length;

        // If the user has reached the top of the list
        if (self.currentFocus === -1) {

            // Does not allow the user to continue to go up the list
            self.currentFocus += 1;
        }

        // If the option the user is trying to go to is disabled and the user is not trying to go up after the user has reached the top of the list
        else if (disabled && hasPreviousEnabled) {

            // Blur the previously selected option
            self.listItems.eq(self.currentFocus + 1).blur();

            // Call the `moveUp` method again
            self.moveUp();

            // Exits the method
            return;
        }

        else if (disabled && !hasPreviousEnabled) {

            self.currentFocus += 1;

        }

        // If the user has not reached the top of the unordered list
        else {

            // Blurs the previously focused list item
            // The jQuery `end()` method allows you to continue chaining while also using a different selector
            self.listItems.eq(this.currentFocus + 1).blur().end().

            // Focuses the currently focused list item
            eq(self.currentFocus).focusin();

            // Calls `scrollToView` to make sure the `scrollTop` is correctly updated. The `down` user action
            self._scrollToView("up");

            // Triggers the custom `moveDown` event on the original select box
            self.triggerEvent("moveUp");

        }

        // Provide callback function support
        self._callbackSupport(callback);

        // Maintains chainability
        return self;

    };

}));
// Keyboard Search Module
// ======================

// Immediately-Invoked Function Expression (IIFE) [Ben Alman Blog Post](http://benalman.com/news/2010/11/immediately-invoked-function-expression/) that calls another IIFE that contains all of the plugin logic.  I used this pattern so that anyone viewing this code would not have to scroll to the bottom of the page to view the local parameters that were passed to the main IIFE.

(function (selectBoxIt) {

    //ECMAScript 5 Strict Mode: [John Resig Blog Post](http://ejohn.org/blog/ecmascript-5-strict-mode-json-and-more/)
    "use strict";

    // Calls the second IIFE and locally passes in the global jQuery, window, and document objects
    selectBoxIt(window.jQuery, window, document);

}

// Locally passes in `jQuery`, the `window` object, the `document` object, and an `undefined` variable.  The `jQuery`, `window` and `document` objects are passed in locally, to improve performance, since javascript first searches for a variable match within the local variables set before searching the global variables set.  All of the global variables are also passed in locally to be minifier friendly. `undefined` can be passed in locally, because it is not a reserved word in JavaScript.

(function ($, window, document, undefined) {

    // ECMAScript 5 Strict Mode: [John Resig Blog Post](http://ejohn.org/blog/ecmascript-5-strict-mode-json-and-more/)
    "use strict";

    // _Set Current Search Option
    // -------------------------
    //      Sets the currently selected dropdown list search option

    $.selectBox.selectBoxIt.prototype._setCurrentSearchOption = function(currentOption) {

        var self = this;

        // Does not change the current option if `showFirstOption` is false and the matched search item is the hidden first option.
        // Otherwise, the current option value is updated
        if ((self.options["aggressiveChange"] || self.options["selectWhenHidden"] || self.listItems.eq(currentOption).is(":visible")) && self.listItems.eq(currentOption).data("disabled") !== true) {

            // Calls the `blur` event of the currently selected dropdown list option
            self.listItems.eq(self.currentFocus).blur();

            // Sets `currentIndex` to the currently selected dropdown list option
            self.currentIndex = currentOption;

            // Sets `currentFocus` to the currently selected dropdown list option
            self.currentFocus = currentOption;

            // Focuses the currently selected dropdown list option
            self.listItems.eq(self.currentFocus).focusin();

            // Updates the scrollTop so that the currently selected dropdown list option is visible to the user
            self._scrollToView("search");

            // Triggers the custom `search` event on the original select box
            self.triggerEvent("search");

        }

        //Maintains chainability
        return self;

    };

    // _Search Algorithm
    // -----------------
    //      Uses regular expressions to find text matches
    $.selectBox.selectBoxIt.prototype._searchAlgorithm = function(currentIndex, alphaNumeric) {

        var self = this,

            // Boolean to determine if a pattern match exists
            matchExists = false,

            // Iteration variable used in the outermost for loop
            x,

            // Iteration variable used in the nested for loop
            y,

            // Variable used to cache the length of the text array (Small enhancement to speed up traversing)
            arrayLength;

        // Loops through the text array to find a pattern match
        for (x = currentIndex, arrayLength = self.textArray.length; x < arrayLength; x += 1) {

            // Nested for loop to help search for a pattern match with the currently traversed array item
            for (y = 0; y < arrayLength; y += 1) {

                // Searches for a match
                if (self.textArray[y].search(alphaNumeric) !== -1) {

                    // `matchExists` is set to true if there is a match
                    matchExists = true;

                    // Exits the nested for loop
                    y = arrayLength;

                }

            } // End nested for loop

            //If a match does not exist
            if (!matchExists) {

                // Sets the current text to the last entered character
                self.currentText = self.currentText.charAt(self.currentText.length - 1).

                // Escapes the regular expression to make sure special characters are seen as literal characters instead of special commands
                replace(/[|()\[{.+*?$\\]/g, "\\$0");

                // Resets the regular expression with the new value of `self.currentText`
                alphaNumeric = new RegExp(self.currentText, "gi");

            }

            // Searches based on the first letter of the dropdown list options text if the currentText < 2 characters
            if (self.currentText.length < 3) {

                alphaNumeric = new RegExp(self.currentText.charAt(0), "gi");

                //If there is a match based on the first character
                if ((self.textArray[x].charAt(0).search(alphaNumeric) !== -1)) {

                    //Sets properties of that dropdown list option to make it the currently selected option
                    self._setCurrentSearchOption(x);

                    //Increments the current index by one
                    self.currentIndex += 1;

                    //Exits the search
                    return false;

                }
            }

            // If `self.currentText` > 1 character
            else {

                // If there is a match based on the entire string
                if ((self.textArray[x].search(alphaNumeric) !== -1)) {

                    // Sets properties of that dropdown list option to make it the currently selected option
                    self._setCurrentSearchOption(x);

                    // Exits the search
                    return false;
                }
            }

            // If the current text search is an exact match
            if (self.textArray[x].toLowerCase() === self.currentText.toLowerCase()) {

                // Sets properties of that dropdown list option to make it the currently selected option
                self._setCurrentSearchOption(x);

                // Resets the current text search to a blank string to start fresh again
                self.currentText = "";

                // Exits the search
                return false;

            }
        }

        //Returns true if there is not a match at all
        return true;
    };

    // Search
    // ------
    //      Calls searchAlgorithm()
    $.selectBox.selectBoxIt.prototype.search = function(alphaNumericKey, rememberPreviousSearch, callback) {

        var self = this;

        if(self.currentText === undefined) {

            self.currentText = "";

        }

        // If the search method is being called internally by the plugin, and not externally as a method by a user
        if (rememberPreviousSearch) {

            // Continued search with history from past searches.  Properly escapes the regular expression
            self.currentText += alphaNumericKey.replace(/[|()\[{.+*?$\\]/g, "\\$0");

        }

        else {

            // Brand new search.  Properly escapes the regular expression
            self.currentText = alphaNumericKey.replace(/[|()\[{.+*?$\\]/g, "\\$0");

        }

        // Searches globally
        var notFound = self._searchAlgorithm(self.currentIndex, self.currentText);

        // Searches the list again if a match is not found.  This is needed, because the first search started at the array indece of the currently selected dropdown list option, and does not search the options before the current array indece.
        // If there are many similar dropdown list options, starting the search at the indece of the currently selected dropdown list option is needed to properly traverse the text array.
        if (notFound) {

            // Searches the dropdown list values starting from the beginning of the text array
            self._searchAlgorithm(0, self.currentText);

        }

        // Provide callback function support
        self._callbackSupport(callback);

        // Maintains chainability
        return self;

    };

}));
// Select Option Module
// ====================

// Immediately-Invoked Function Expression (IIFE) [Ben Alman Blog Post](http://benalman.com/news/2010/11/immediately-invoked-function-expression/) that calls another IIFE that contains all of the plugin logic.  I used this pattern so that anyone viewing this code would not have to scroll to the bottom of the page to view the local parameters that were passed to the main IIFE.

(function (selectBoxIt) {

    //ECMAScript 5 Strict Mode: [John Resig Blog Post](http://ejohn.org/blog/ecmascript-5-strict-mode-json-and-more/)
    "use strict";

    // Calls the second IIFE and locally passes in the global jQuery, window, and document objects
    selectBoxIt(window.jQuery, window, document);

}

// Locally passes in `jQuery`, the `window` object, the `document` object, and an `undefined` variable.  The `jQuery`, `window` and `document` objects are passed in locally, to improve performance, since javascript first searches for a variable match within the local variables set before searching the global variables set.  All of the global variables are also passed in locally to be minifier friendly. `undefined` can be passed in locally, because it is not a reserved word in JavaScript.

(function ($, window, document, undefined) {

    // ECMAScript 5 Strict Mode: [John Resig Blog Post](http://ejohn.org/blog/ecmascript-5-strict-mode-json-and-more/)
    "use strict";

    // Select Option
    // -------------
    //      Programatically selects a drop down option by either index or value

    $.selectBox.selectBoxIt.prototype.selectOption = function(val, callback) {

        // Stores the plugin context inside of the self variable
        var self = this;

        // Makes sure the passed in position is a number
        if(typeof val === "number") {

            // Set's the original select box value and triggers the change event (which SelectBoxIt listens for)
            self.selectBox.val(self.selectBox.find("option").eq(val).val()).change();

        }

        else if(typeof val === "string") {

            // Set's the original select box value and triggers the change event (which SelectBoxIt listens for)
            self.selectBox.val(val).change();

        }

        // Calls the callback function
        self._callbackSupport(callback);

        // Maintains chainability
        return self;

    };

}));
// Set Option Module
// =================

// Immediately-Invoked Function Expression (IIFE) [Ben Alman Blog Post](http://benalman.com/news/2010/11/immediately-invoked-function-expression/) that calls another IIFE that contains all of the plugin logic.  I used this pattern so that anyone viewing this code would not have to scroll to the bottom of the page to view the local parameters that were passed to the main IIFE.

(function (selectBoxIt) {

    //ECMAScript 5 Strict Mode: [John Resig Blog Post](http://ejohn.org/blog/ecmascript-5-strict-mode-json-and-more/)
    "use strict";

    // Calls the second IIFE and locally passes in the global jQuery, window, and document objects
    selectBoxIt(window.jQuery, window, document);

}

// Locally passes in `jQuery`, the `window` object, the `document` object, and an `undefined` variable.  The `jQuery`, `window` and `document` objects are passed in locally, to improve performance, since javascript first searches for a variable match within the local variables set before searching the global variables set.  All of the global variables are also passed in locally to be minifier friendly. `undefined` can be passed in locally, because it is not a reserved word in JavaScript.

(function ($, window, document, undefined) {

    // ECMAScript 5 Strict Mode: [John Resig Blog Post](http://ejohn.org/blog/ecmascript-5-strict-mode-json-and-more/)
    "use strict";

    //Set Option
    // ----------
    //      Accepts an string key, a value, and a callback function to replace a single
    //      property of the plugin options object

    $.selectBox.selectBoxIt.prototype.setOption = function(key, value, callback) {

        var self = this;

        // If a user sets the `showFirstOption` to false
        if (key === "showFirstOption" && !value) {

            //Hides the first option in the dropdown list
            self.listItems.eq(0).hide();

        }

        // If a user sets the `showFirstOption` to true
        else if (key === "showFirstOption" && value) {

            //Shows the first option in the dropdown list
            self.listItems.eq(0).show();

        }

        else if(key === "defaultIcon" && value) {

            self.dropdownImage.attr("class", value + " selectboxit-arrow");

        }

        else if(key === "downArrowIcon" && value) {

            self.downArrow.attr("class", value + " selectboxit-arrow");

        }

        // If a user sets the defaultText option
        else if (key === "defaultText") {

            // Sets the new dropdown list default text
            self.dropdownText.text(value);

        }

        $.Widget.prototype._setOption.apply(self, arguments);

        // Provides callback function support
        self._callbackSupport(callback);

        // Maintains chainability
        return self;

    };

}));
// Set Options Module
// ==================

// Immediately-Invoked Function Expression (IIFE) [Ben Alman Blog Post](http://benalman.com/news/2010/11/immediately-invoked-function-expression/) that calls another IIFE that contains all of the plugin logic.  I used this pattern so that anyone viewing this code would not have to scroll to the bottom of the page to view the local parameters that were passed to the main IIFE.

(function (selectBoxIt) {

    //ECMAScript 5 Strict Mode: [John Resig Blog Post](http://ejohn.org/blog/ecmascript-5-strict-mode-json-and-more/)
    "use strict";

    // Calls the second IIFE and locally passes in the global jQuery, window, and document objects
    selectBoxIt(window.jQuery, window, document);

}

// Locally passes in `jQuery`, the `window` object, the `document` object, and an `undefined` variable.  The `jQuery`, `window` and `document` objects are passed in locally, to improve performance, since javascript first searches for a variable match within the local variables set before searching the global variables set.  All of the global variables are also passed in locally to be minifier friendly. `undefined` can be passed in locally, because it is not a reserved word in JavaScript.

(function ($, window, document, undefined) {

    // ECMAScript 5 Strict Mode: [John Resig Blog Post](http://ejohn.org/blog/ecmascript-5-strict-mode-json-and-more/)
    "use strict";

    //Set Options
    // ----------
    //      Accepts an object to replace plugin options
    //      properties of the plugin options object

    $.selectBox.selectBoxIt.prototype.setOptions = function(newOptions, callback) {

        var self = this;

        $.Widget.prototype._setOptions.apply(self, arguments);

        // If the `showFirstOption` option is true
        if (self.options["showFirstOption"]) {

            // Shows the first option in the dropdown list
            self.listItems.eq(0).show();

        }

        // If the `showFirstOption` option is false
        else {

            // Hides the first option in the dropdown list
            self.listItems.eq(0).hide();

        }

        if(self.options["defaultIcon"]) {

            self.dropdownImage.attr("class", self.options["defaultIcon"] + " selectboxit-arrow");

        }

        if(self.options["downArrowIcon"]) {

            self.downArrow.attr("class", self.options["downArrowIcon"] + " selectboxit-arrow");

        }

        // If the defaultText option is set, make sure the dropdown list default text reflects this value
        if (self.options["defaultText"]) {

            self.dropdownText.text(self.options["defaultText"]);

        }

        // Provide callback function support
        self._callbackSupport(callback);

        // Maintains chainability
        return self;

    };

}));
// Wait Module
// ===========

// Immediately-Invoked Function Expression (IIFE) [Ben Alman Blog Post](http://benalman.com/news/2010/11/immediately-invoked-function-expression/) that calls another IIFE that contains all of the plugin logic.  I used this pattern so that anyone viewing this code would not have to scroll to the bottom of the page to view the local parameters that were passed to the main IIFE.

(function (selectBoxIt) {

    //ECMAScript 5 Strict Mode: [John Resig Blog Post](http://ejohn.org/blog/ecmascript-5-strict-mode-json-and-more/)
    "use strict";

    // Calls the second IIFE and locally passes in the global jQuery, window, and document objects
    selectBoxIt(window.jQuery, window, document);

}

// Locally passes in `jQuery`, the `window` object, the `document` object, and an `undefined` variable.  The `jQuery`, `window` and `document` objects are passed in locally, to improve performance, since javascript first searches for a variable match within the local variables set before searching the global variables set.  All of the global variables are also passed in locally to be minifier friendly. `undefined` can be passed in locally, because it is not a reserved word in JavaScript.

(function ($, window, document, undefined) {

    // ECMAScript 5 Strict Mode: [John Resig Blog Post](http://ejohn.org/blog/ecmascript-5-strict-mode-json-and-more/)
    "use strict";

    // Wait
    // ----
    //    Delays execution by the amount of time
    //    specified by the parameter

    $.selectBox.selectBoxIt.prototype.wait = function(time, callback) {

        var self = this,

            // The timeout variable stores a Deferred Object, which will be resolved after the time specified in the parameter
            timeout = this.returnTimeout(time);

        // Once the Deferred object is resolved, call the callback function
        timeout.then(function() {

            // Provide callback function support
            self._callbackSupport(callback);

        });
        
        // Maintains chainability
        return self;

    };

    //Return timeout
    // -------------
    //    Returns a Deferred Object after the time
    //    specified by the parameter

    $.selectBox.selectBoxIt.prototype.returnTimeout = function(time) {

        //Returns a Deferred Object
        return $.Deferred(function(dfd) {

            //Call the JavaScript `setTimeout function and resolve the Deferred Object
            setTimeout(dfd.resolve, time);

        });

    };

}));
// enquire.js v1.5.4 - Awesome Media Queries in JavaScript
// Copyright (c) 2013 Nick Williams - http://wicky.nillia.ms/enquire.js
// License: MIT (http://www.opensource.org/licenses/mit-license.php)
if ($.browser.msie==undefined){
window.enquire=function(e){"use strict";function t(e,t){var n=0,r=e.length,i;for(n;n<r;n++){i=t(e[n],n);if(i===!1)break}}function n(e){return Object.prototype.toString.apply(e)==="[object Array]"}function r(e){return typeof e=="function"}function i(e){this.initialised=!1,this.options=e,e.deferSetup||this.setup()}function s(e,t){this.query=e,this.isUnconditional=t,this.handlers=[],this.matched=!1}function o(){if(!e)throw new Error("matchMedia is required");var t=new s("only all");this.queries={},this.listening=!1,this.browserIsIncapable=!t.matchMedia()}return i.prototype={setup:function(e){this.options.setup&&this.options.setup(e),this.initialised=!0},on:function(e){this.initialised||this.setup(e),this.options.match(e)},off:function(e){this.options.unmatch&&this.options.unmatch(e)},destroy:function(){this.options.destroy?this.options.destroy():this.off()},equals:function(e){return this.options===e||this.options.match===e}},s.prototype={matchMedia:function(){return e(this.query).matches},addHandler:function(e,t){var n=new i(e);this.handlers.push(n),t&&this.matched&&n.on()},removeHandler:function(e){var n=this.handlers;t(n,function(t,r){if(t.equals(e))return t.destroy(),!n.splice(r,1)})},assess:function(e){this.matchMedia()||this.isUnconditional?this.match(e):this.unmatch(e)},match:function(e){if(this.matched)return;t(this.handlers,function(t){t.on(e)}),this.matched=!0},unmatch:function(e){if(!this.matched)return;t(this.handlers,function(t){t.off(e)}),this.matched=!1}},o.prototype={register:function(e,i,o){var u=this.queries,a=o&&this.browserIsIncapable,f=this.listening;return u.hasOwnProperty(e)||(u[e]=new s(e,a),this.listening&&u[e].assess()),r(i)&&(i={match:i}),n(i)||(i=[i]),t(i,function(t){u[e].addHandler(t,f)}),this},unregister:function(e,n){var r=this.queries;return r.hasOwnProperty(e)?(n?r[e].removeHandler(n):(t(this.queries[e].handlers,function(e){e.destroy()}),delete r[e]),this):this},fire:function(e){var t=this.queries,n;for(n in t)t.hasOwnProperty(n)&&t[n].assess(e);return this},listen:function(e){function n(n){var r;window.addEventListener(n,function(n){r&&clearTimeout(r),r=setTimeout(function(){t.fire(n)},e)})}var t=this;e=e||500;if(!window.addEventListener)return;return this.listening?this:(t.fire(),n("resize"),n("orientationChange"),this.listening=!0,this)}},new o}(window.matchMedia);
}
var imageIsLoaded;
var onImageLoad;
var onImageLoadOrError;
var imageLoadListenerRemove;
(function($)
{
	imageIsLoaded = function (image)
	{
		// During the onload event, IE correctly identifies any images that
		// weren�t downloaded as not complete. Others should too. Gecko-based
		// browsers report this incorrectly.
		if (!image.complete) return false;

		// However, they do have two very useful properties: naturalWidth and
		// naturalHeight. These give the true size of the image. If it failed
		// to load, either of these should be zero.
		if
		(
			typeof image.naturalWidth	!= 'undefined'
			&&
			image.naturalWidth == 0
		)
		return false;
		
		// No other way of checking: assume it�s ok.
		return true;
	}
	
	onImageLoad = function(image, handler)
	{
		var $image = $(image);
		
		var listeners = $image.data('imageLoadListeners');
		if (!listeners) listeners = [];
		$image.data('imageLoadListeners', listeners);
	
		var applier = function() {handler.apply(image)};
		
		var src = $image.attr('src');
		var $loaderImage = $('<img/>');
		$loaderImage.load(applier);
		$loaderImage.attr('src', src);
		
		var listener = {handler: handler, $loaderImage: $loaderImage, applier: applier};
		listeners.push(listener);
	}
	
	onImageError = function(image, handler)
	{
		var $image = $(image);
		
		var listeners = $image.data('imageErrorListeners');
		if (!listeners) listeners = [];
		$image.data('imageErrorListeners', listeners);
	
		var applier = function() {handler.apply(image)};
		
		var src = $image.attr('src');
		var $loaderImage = $('<img/>');
		$loaderImage.error(applier);
		$loaderImage.attr('src', src);
		
		var listener = {handler: handler, $loaderImage: $loaderImage, applier: applier};
		listeners.push(listener);
	}
	
	onImageLoad_Remove = function(image, handler)
	{
		var listeners = $(image).data('imageErrorListeners');
		if (listeners)
		{
			for (var i = 0; i < listeners.length; i++)
			{
				var listener = listeners[i];
				if (listener.handler == handler)
				{
					listener.$loaderImage.unbind('load', listener.applier);
					break;
				}
			}
		}
	}
	
	onImageError_Remove = function(image, handler)
	{
		var listeners = $(image).data('imageErrorListeners');
		for (var i = 0; i < listeners.length; i++)
		{
			var listener = listeners[i];
			if (listener.handler == handler)
			{
				listener.$loaderImage.unbind('error', listener.applier);
				break;
			}
		}
	}
	
	onImageLoadOrError = function(image, handler)
	{
		onImageLoad(image, handler);
		onImageError(image, handler);
	}
	
	onImageLoadOrError_Remove = function(image, handler)
	{
		onImageLoad_Remove(image, handler);
		onImageError_Remove(image, handler);
	}
})(jQuery);

var DEBUG_MODE = true;



/*----------------------------------------------------------------------------------*/

var INIT_FOLDER = "/";

var FOLDERS = [];

FOLDERS['zh_cn'] = "";

var OPENSHOP_DOMAIN = "openshop.com";
//var OPENSHOP_DOMAIN = "ingmntest.no-ip.info";
//var OPENSHOP_DOMAIN = "192.168.1.110";
//var OPENSHOP_DOMAIN = "localhost";


/*----------------------------------------------------------------------------------*/

var HYDRA_MODULES = [ 
						"layout",
						"preloader",
						"cart-button",
						"page-satori-heart-ss14",
						"page-campaign-ss14",
						"page-campaign-fw13",
						"page-campaign-ss13",
						"page-technology",
						"page-products-list", 
						"page-product-detail",						
						"page-home",
						"page-brand",
						"page-stores",
						"page-live",
						"page-live-by-the-walk",
						"page-404",
						"page-popup",
						"stock-alert",
						"products-filter",
						"history",
						"load",
						"transition",
						"block-ipad-portrait",
						"responsive",
						"ganalytics"
					];

/*----------------------------------------------------------------------------------*/

var MAGENTO_LANG_URL_VAR = "?___store=";

/*----------------------------------------------------------------------------------*/

var LANGUAGES = [ "zh_cn", "en"];

/*----------------------------------------------------------------------------------*/

var CURRENT_LANGUAGE = "zh_cn";

/*----------------------------------------------------------------------------------*/

var TWITTER_ACCOUNT = { es:"Satorisan_ES", en:"Satorisan" };
var FACEBOOK_ACCOUNT = { es: "satorisan.es", en:"satorisan.en" };
var PINTEREST_ACCOUNT = "http://instagram.com/satorisan_livebythewalk";
var YOUTUBE_ACCOUNT = "MrSatorisan";

//var FACEBOOK_ACCESS_TOKEN = "AAAC1UJC56KgBAOSwTlypZBA4JBWBhCQbzapYKnwJ9iZAid0ZCoK0nslkM0vQGI3YUrWREAbXn6LkrpsX8WNb5ZCQ5lmE87NyUA1ZAxZBeFvO6SEHx1S61r";
//http://www.neosmart.de/social-media/facebook-wall/
//http://vipinsahu.com/facebook-wall-feeds-documentation

/*----------------------------------------------------------------------------------*/

var LANGUAGES_TEXT = [];
LANGUAGES_TEXT["zh_cn"] = "简体中文";
LANGUAGES_TEXT["es"] = "ESPAÑOL";
LANGUAGES_TEXT["en"] = "ENGLISH";

/*----------------------------------------------------------------------------------*/

var WEBSERVICES_PATH = [];
WEBSERVICES_PATH["catalog"] = INIT_FOLDER + "new/catalog.json";
//WEBSERVICES_PATH["product-detail"] = INIT_FOLDER + "website/webservices/product.php";
WEBSERVICES_PATH["product-detail"] = INIT_FOLDER + "website/webservices/product.php";
WEBSERVICES_PATH["filter-attributes"] = INIT_FOLDER + "new/attributes.json";
WEBSERVICES_PATH["add-to-cart"] = INIT_FOLDER + "website/webservices/addtocart.php";
WEBSERVICES_PATH["update-cart"] = INIT_FOLDER + "website/webservices/cartquantity.php";
WEBSERVICES_PATH["logout"] = INIT_FOLDER + "website/webservices/logout.php";
WEBSERVICES_PATH["blog"] = INIT_FOLDER + "website/webservices/blog.php";
WEBSERVICES_PATH["stores"] = INIT_FOLDER + "website/webservices/getstores.php";
WEBSERVICES_PATH["stock-alert"] = INIT_FOLDER + "website/webservices/productalert.php";
WEBSERVICES_PATH["live-by-the-walk"] = INIT_FOLDER + "website/webservices/instagram/feed.php";

/*----------------------------------------------------------------------------------*/

var TEMPLATES_PATH = new Array();
TEMPLATES_PATH["products-list"] = INIT_FOLDER + "/assets/new/templates/products-list.ejs";
TEMPLATES_PATH["product-detail"] = INIT_FOLDER + "/assets/new/templates/product-detail.ejs";

/*----------------------------------------------------------------------------------*/

var MEDIA_FOLDER_PATH = INIT_FOLDER + "media/catalog/product";

/*----------------------------------------------------------------------------------*/
/* CATALOG */
/*----------------------------------------------------------------------------------*/

var PRODUCT_LIST_WIDTH = 300;

/*----------------------------------------------------------------------------------*/
/* DICTIONARY */
/*----------------------------------------------------------------------------------*/

var DICTIONARY = {
		"zh_cn" : {
			all: "全部",
			allcolors: "所有颜色",
			outofstock:"SIZE OUT OF STOCK<br /><b><a id='stock-alert-btn' productId='%product_id%' >Tell me when it´s back again</a></b>",
			outofstock_allSizes:"MODEL OUT OF STOCK",
			addtocartnostock:"Sorry! Size out of stock",
			dragselectquantity:"Drag to select quantity",
			dragfiltercolor:"Drag to filter by color",
			dragfilterprice:"Drag to filter by price",
			filtersBalloon: '可以使用搜索功能筛选您感兴趣的产品。',
			allproducts:"全部产品",
			selectcategory:"请选择类别",
			selectsize:"请选择尺码",
			unavailablearea:"Online shopping is not allowed in your area.",
			quantitynostock:"Quantity out of stock",
			seecampaign:"SEE CAMPAIGN",
			noresult:"Oh mog, 没有找到您需要的。",
			moreabout:"MORE ABOUT",
			months:[ "Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec" ],
			screenerror:"Sorry, switch to landscape mode for better viewing",
			our_blog: "our blog",
			//my accout
			account_title: "我的定制",
			account_logout: "登出",
			account_orders_title: "我的订单",
	        account_account_title: "账户信息",
	        account_address_title: "收货地址",
	        account_tickets_title: "Help Desk",
	        //stores
			select_country: "select country",
			select_city: "select city",
			search_location: "search location",
			your_location: "your location",
			list_view: "list view",
			map_view: "map view",
			view_on_map: "view on map",
			get_directions: "get directions",
			stores: "stores",
			store: "store",
			//
			followtitle:"Follow Satorisan",
			followpush:"If you like to #livebythewalk we'll be pleased to have you walking with us!",
			languagetitle:"Select your region / language",
			languagepush1:"You're in ",
			languagepush2:" and your region is ",
			languagepush3:"If you want to change the store or language please select an option bellow.",
			remembersettings:"Remember my settings",
			validate:"Validate",
			search_results:"Search results",
			choose_location:"Choose location:",
			your_location_no_results: "We're sorry, there are not Satorisan Stores near your area.",
			your_location_error_browser: "Error: Your browser doesn't support geolocation.",
			your_location_error_service: "Error: The Geolocation service failed.",
			'new': "NEW",
			newcollection:"NEW COLLECTION",
			product_twitter_share:"I would love to be walking with you wearing this Satorisan <%product_name%> #livebythewalk",
			preload_stores:'There are loads of stores where you can find your Satorisan',
			preload_live:'Because living by the walk generate experiences',
			added_to_cart:'Added to shopping cart',
			// stock alert popup
			stock_alert_title: "Do you want to know when is this size available?",
			stock_alert_push: "Please, fill in your Name and Email and we will tell you when <strong>%product_name%, size %product_size% %size_chart%</strong> is back in stock. Thanks for your patience!",
			stock_alert_name: "Your Name",
			stock_alert_email: "Your Email",
			stock_alert_send: "Send",
			stock_alert_success: "You will receive an email notification when the product is back. Thanks for your patience!",
			cookies_text:"We use cookies, just to track visits to our website. Don't worry, we do not store personal details.",
			about_cookies:"ABOUT COOKIES",
			accept_cookies:"ACCEPT COOKIES",
			backtogrid:"BACK TO PRODUCTS",
			skipvideo:"SKIP VIDEO",
			gototheshop:"GO TO THE SHOP",
			seethegallery:"SEE THE GALLERY",
			playagain:"PLAY AGAIN",
			backtovideo:"BACK TO VIDEO",
			view_more: "view more",
			model: "款式"
		},
	"es" : {
		all: "TODOS",
		allcolors: "TODOS LOS COLORES",
		outofstock:"TALLA FUERA DE STOCK<br /><b><a id='stock-alert-btn' productId='%product_id%' >Avísame cuando vuelva a estar disponible</a></b>",
		outofstock_allSizes:"MODELO FUERA DE STOCK",
		addtocartnostock:"Lo siento! No hay esa cantidad de productos en stock",
		dragselectquantity:"Arrastra para seleccionar cantidad",
		dragfiltercolor:"Arrastra para filtrar por color",
		dragfilterprice:"Arrastra para filtrar por precio",
		filtersBalloon: 'Usa los filtros para encontrar justo lo que quieres',
		allproducts:"TODOS LOS PRODUCTOS",
		selectcategory:"SELECCIONE CATEGORÍA",
		selectsize:"Seleccione una talla",
		unavailablearea:"La compra online está deshabilitada para su zona.",
		quantitynostock:"Cantidad fuera de stock",
		seecampaign:"VER CAMPAÑA",
		noresult:"Ooops! Al parecer, no hay resultados con esta combinación.",
		moreabout:"MÁS INFORMACION SOBRE",
		months:[ "Ene", "Feb", "Mar", "Abr", "May", "Jun", "Jul", "Ago", "Sep", "Oct", "Nov", "Dic" ],
		screenerror:"Lo siento, cambiar a modo landscape para mejor visualización.",
		our_blog: "nuestro blog",
		//my accout
		account_title: "Mi cuenta",
		account_logout: "LOG OUT",
		account_orders_title: "Mis pedidos",
        account_account_title: "Informacion de la cuenta",
        account_address_title: "Libreta de direcciones",
        account_tickets_title: "Incidencias",
		//stores
		select_country: "seleccione un país",
		select_city: "seleccione una ciudad",
		search_location: "BUSCAR",
		your_location: "su ubicacion",
		list_view: "modo lista",
		map_view: "modo mapa",
		view_on_map: "ver en el mapa",
		get_directions: "obtener direcciones",
		stores: "tiendas",
		store: "tienda",
		//
		followtitle:"Sigue a Satorisan",
		followpush:"Sumate a #livebythewalk, estaremos encantados de caminar juntos!",
		languagetitle:"Selecciona tu región / idioma",
		languagepush1:"Estás en ",
		languagepush2:" y tu región es ",
		languagepush3:"Si deseas cambiar la tienda o el idioma por favor selecciona una de las siguientes opciones.",
		remembersettings:"Recordar configuración",
		validate:"Validar",
		search_results:"Resultados de la busqueda",
		choose_location:"Escoge una ubicación:",
		your_location_no_results: "Lo sentimos, no hay tiendas Satorisan cercanas a su área.",
		your_location_error_browser: "Error: Su navegador no soporta Geolocalización.",
		your_location_error_service: "Error: El servicio de Geolocalización ha fallado.",
		'new': "NUEVA",
		newcollection:"COLECCIÓN NUEVA",
		product_twitter_share:"Me encantaría andar contigo con mis Satorisan  <%product_name%> #livebythewalk",
		preload_stores:'Descubre todas las tiendas donde puedes encontrar tus Satorisan',
		preload_live:'Porque “Live by the Walk” genera experiencias',
		added_to_cart:'Añadido al carrito',
		// stock alert popup
		stock_alert_title: "¿Quieres saber cuándo esta talla vuelve a estar disponible?",
		stock_alert_push: "Por favor, pon tu Nombre y Email y te avisaremos cuando <strong>%product_name%, talla %product_size% %size_chart%</strong> esté nuevamente disponible. ¡Gracias por tu paciencia!",
		stock_alert_name: "Tu Nombre",
		stock_alert_email: "Tu Email",
		stock_alert_send: "Enviar",
		stock_alert_success: "Recibirás una notificación por email cuando el producto esté nuevamente en disponible. ¡Gracias por tu paciencia!",
		cookies_text:"Utilizamos cookies, para ofrecer una mejor experiencia y servicio. No te preocupes, no almacenamos datos personales.",
		about_cookies:"POLÍTICA DE COOKIES",
		accept_cookies:"ACEPTAR COOKIES",
		backtogrid:"VOLVER A PRODUCTOS",
		skipvideo:"SALTAR VIDEO",
		gototheshop:"IR A LA TIENDA",
		seethegallery:"VER GALERIA",
		playagain:"VER DE NUEVO",
		backtovideo:"VOLVER AL VIDEO",
		view_more: "más info",
		model: "Modelo"
	},
	
	"en" : {
		all: "ALL",
		allcolors: "ALL COLORS",
		outofstock:"SIZE OUT OF STOCK<br /><b><a id='stock-alert-btn' productId='%product_id%' >Tell me when it´s back again</a></b>",
		outofstock_allSizes:"MODEL OUT OF STOCK",
		addtocartnostock:"Sorry! Size out of stock",
		dragselectquantity:"Drag to select quantity",
		dragfiltercolor:"Drag to filter by color",
		dragfilterprice:"Drag to filter by price",
		filtersBalloon: 'Use these filters to find just what you\'re looking for',
		allproducts:"ALL PRODUCTS",
		selectcategory:"SELECT CATEGORY",
		selectsize:"Select a size",
		unavailablearea:"Online shopping is not allowed in your area.",
		quantitynostock:"Quantity out of stock",
		seecampaign:"SEE CAMPAIGN",
		noresult:"Ooops! It seems there are no results with this combination.",
		moreabout:"MORE ABOUT",
		months:[ "Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec" ],
		screenerror:"Sorry, switch to landscape mode for better viewing",
		our_blog: "our blog",
		//my accout
		account_title: "My Account",
		account_logout: "LOG OUT",
		account_orders_title: "My Orders",
        account_account_title: "Account Information",
        account_address_title: "Address Book",
        account_tickets_title: "Help Desk",
        //stores
		select_country: "select country",
		select_city: "select city",
		search_location: "search location",
		your_location: "your location",
		list_view: "list view",
		map_view: "map view",
		view_on_map: "view on map",
		get_directions: "get directions",
		stores: "stores",
		store: "store",
		//
		followtitle:"Follow Satorisan",
		followpush:"If you like to #livebythewalk we'll be pleased to have you walking with us!",
		languagetitle:"Select your region / language",
		languagepush1:"You're in ",
		languagepush2:" and your region is ",
		languagepush3:"If you want to change the store or language please select an option bellow.",
		remembersettings:"Remember my settings",
		validate:"Validate",
		search_results:"Search results",
		choose_location:"Choose location:",
		your_location_no_results: "We're sorry, there are not Satorisan Stores near your area.",
		your_location_error_browser: "Error: Your browser doesn't support geolocation.",
		your_location_error_service: "Error: The Geolocation service failed.",
		'new': "NEW",
		newcollection:"NEW COLLECTION",
		product_twitter_share:"I would love to be walking with you wearing this Satorisan <%product_name%> #livebythewalk",
		preload_stores:'There are loads of stores where you can find your Satorisan',
		preload_live:'Because living by the walk generate experiences',
		added_to_cart:'Added to shopping cart',
		// stock alert popup
		stock_alert_title: "Do you want to know when is this size available?",
		stock_alert_push: "Please, fill in your Name and Email and we will tell you when <strong>%product_name%, size %product_size% %size_chart%</strong> is back in stock. Thanks for your patience!",
		stock_alert_name: "Your Name",
		stock_alert_email: "Your Email",
		stock_alert_send: "Send",
		stock_alert_success: "You will receive an email notification when the product is back. Thanks for your patience!",
		cookies_text:"We use cookies, just to track visits to our website. Don't worry, we do not store personal details.",
		about_cookies:"ABOUT COOKIES",
		accept_cookies:"ACCEPT COOKIES",
		backtogrid:"BACK TO PRODUCTS",
		skipvideo:"SKIP VIDEO",
		gototheshop:"GO TO THE SHOP",
		seethegallery:"SEE THE GALLERY",
		playagain:"PLAY AGAIN",
		backtovideo:"BACK TO VIDEO",
		view_more: "view more",
		model: "Model"
	}
};


/*----------------------------------------------------------------------------------*/
/* HEADER */
/*----------------------------------------------------------------------------------*/

var MENU_HEADER_OPTIONS = { 
						 	groupLeft: 
						 	{ 
						 		"zh_cn" : [
								 			{title: "私人定制俱乐部", url: "home", cStyle:"branding"},
								 			//{title: "CAMPAÑA", url: "satori-heart-ss14", cStyle:"header-menu-option"},
								 			{title: "产品列表", url: "shop", cStyle:"header-menu-option"},
								 			{title: "实体店面", url: "ps", cStyle:"header-menu-option"},
								 			//{title: "TECH", url: "tech", cStyle:"header-menu-option"},
								 			//{title: "SATORISAN LIVE", url: "satorisan-live", cStyle:"header-menu-option"},
								 			{title: "最新活动", url: "es", cStyle:"header-menu-option"},
								 			{title: "联系我们", url: "c", cStyle:"header-menu-option"}
						 		   		],
							 	"en" : [
								 			{title: "SATORISAN", url: "home", cStyle:"branding"},
								 			//{title: "CAMPAIGN", url: "satori-heart-ss14", cStyle:"header-menu-option"},
								 			{title: "SHOP", url: "shop", cStyle:"header-menu-option"},
								 			{title: "FIND A STORE", url: "stores", cStyle:"header-menu-option"},
								 			//{title: "TECH", url: "tech", cStyle:"header-menu-option"},
								 			//{title: "SATORISAN LIVE", url: "satorisan-live", cStyle:"header-menu-option"},
								 			{title: "#LIVEBYTHEWALK", url: "live-by-the-walk", cStyle:"header-menu-option"},
								 			{title: "THE BRAND", url: "brand", cStyle:"header-menu-option"}
							 		   ]	   					 		  
						    },
							
							groupRight: 
						 	{ 
								"zh_cn" : [
							 			{title: cartQuantity, url: "cart", cStyle:"cart"},
							 			{title: username, url: "account", cStyle:"account"},
							 			{title: CURRENT_LANGUAGE, url: "", cStyle:"language normal-link"}
						 		   		],
						 		"es" : [
							 			{title: "0", url: "cart", cStyle:"cart"},
							 			{title: "MI CUENTA", url: "account", cStyle:"account"},
							 			{title: "ES", url: "", cStyle:"language normal-link"}
						 		   		],
							 	"en" : [
								 		{title: "0", url: "cart", cStyle:"cart"},
							 			{title: "MY ACCOUNT", url: "account", cStyle:"account"},
							 			{title: "EN", url: "", cStyle:"language normal-link"}
							 		   ]	   					 		  
						    }

						}


/*----------------------------------------------------------------------------------*/
/* FOOTER */
/*----------------------------------------------------------------------------------*/
						  
var FOOTER_TEXTS = { 
					   "zh_cn" : {
					   			groupLeft:[
									   			{text : "&copy; 2014 私人定制俱乐部 - openshop openteach inc.", cStyle:"footer-text copyright"},
									   			{text : "法律申明", url: "", cStyle:"footer-text policies normal-link"}
									   		],

								groupRight:[
									   			{text : "联系我们", link:"", url: "#", cStyle:"footer-button contact normal-link"},
									   			{text : "需要帮助?", link:"", url: "#", cStyle:"footer-button help normal-link"},
									   			{text : "Follow me!", url: "", cStyle:"footer-button share normal-link"}									   			
									   		]	   		
					   		},

					   	"en" : {
					   			groupLeft:[
									   			{text : "&copy; 2014 SATORISAN - ALL RIGHTS RESERVED", cStyle:"footer-text copyright"},
									   			{text : "OUR POLICIES", url: "#", cStyle:"footer-text policies normal-link"}
									   		],

								groupRight:[
									   			{text : "CONTACT", link:"", url: "#", cStyle:"footer-button contact normal-link"},
									   			{text : "NEED HELP?", link:"", url: "", cStyle:"footer-button help normal-link"},
									   			{text : "FOLLOW SATORISAN!", url: "", cStyle:"footer-button share normal-link"}									   			
									   		]	   		
					   		}	
				    }

/*----------------------------------------------------------------------------------*/
/* HOME 首页轮播墙			*/
/*----------------------------------------------------------------------------------*/				    

var HOME = {
	images : [ 

			{ 
				path : "/assets/new/images/home/fw14/1_collection.jpg", 
				resize:true, 
				offsetX:0, 
				offsetY:0, 
				align:"top", 
				ipadAlign:"top", 
				width:1600, 
				height:1050, 
				title_zh_cn:"<div class='fl1'>发现</div><div class='fl2'>新款</div>",
				title_en:"<div class='fl1'>DISCOVER</div><div class='fl2'>THE NEW COLLECTION</div>",
				body_zh_cn:"查看我们推出的当季最新款.<br/>发现我们的 秋/冬 14 个新款.",
				body_en:"Check out our new models for this season.<br/>Discover our fall/winter 14 collection.",
				title_es:"<div class='fl1'>DESCUBRE</div><div class='fl2'>LA NUEVA COLECCION</div>", 
				body_es:"Te presentamos los nuevos modelos para la próxima temporada.<br/>Descubre nuestra colección otoño invierno 2014.", 
				button:{
					text_es:"VIEW SHOES",
					text_zh_cn:"查看",
					text_en:"VIEW SHOES", 
					link_es:"/shop",
					link_zh_cn:"/shop", 
					link_en:"/shop", 
					target:"_self" } 
			},

			{ 
				path : "/assets/new/images/home/fw14/2_newsole.jpg", 
				resize:true, 
				offsetX:0, 
				offsetY:0, 
				align:"bottom", 
				ipadAlign:"bottom", 
				width:1600, 
				height:1050, 
				title_zh_cn:"<div class='fl1'>NEW</div><div class='fl2'>4WD COLD CLIMATE SOLE</div>",
				body_zh_cn:"Finally it’s here. We’re proud to introduce our new 4WD cold climate sole<br/>which was developed in collaboration with a renowned biomechanics<br/>institute for excellent grip on cold, wet and icy surfaces.", 
				title_en:"<div class='fl1'>NEW</div><div class='fl2'>4WD COLD CLIMATE SOLE</div>",
				body_en:"Finally it’s here. We’re proud to introduce our new 4WD cold climate sole<br/>which was developed in collaboration with a renowned biomechanics<br/>institute for excellent grip on cold, wet and icy surfaces.", 
				title_es:"<div class='fl1'>NUEVA</div><div class='fl2'>4WD SUELA CLIMA FRIO</div>", 
				body_es:"Finalmente ya está aquí ☺ ..Estamos orgullosos de presentarte nuestra nueva suela<br/>para clima frío 4WD, diseñada en colaboración con el Instituto de Biomecánica de Valencia<br/>para asegurar una excelente adherencia en superficies frías y húmedas, así como en hielo.", 
				button:{
					text_zh_cn:"查看",
					text_es:"VIEW SHOES",
					text_en:"VIEW SHOES",
					link_es:"/shop", 
					link_en:"/shop", 
					target:"_self" 
				} 
			},
			
			{ 
				path : "/assets/new/images/home/fw14/3_instagram.jpg", 
				resize:true, 
				offsetX:0, 
				offsetY:-10, 
				align:"middle", 
				ipadAlign:"top", 
				width:1600, 
				height:1050, 
				title_zh_cn:"<div class='fl1'>分享</div><div class='fl2'>#我的私人定制俱乐部</div>", 
				body_zh_cn:"Every month we send out a pair of Satorisan shoes of choice<br/>to the person who captured our motto best.",
				title_en:"<div class='fl1'>SHARE YOUR</div><div class='fl2'>#LiveByTheWalk MOMENT</div>", 
				body_en:"Every month we send out a pair of Satorisan shoes of choice<br/>to the person who captured our motto best.",
				title_es:"<div class='fl1'>#LiveByTheWalk</div><div class='fl2'>COMPARTE TU MOMENTO</div>", 
				body_es:"Cada mes enviaremos un par de zapas a elección del user que capture con mayor autenticidad y originalidad el universo Satorisan.", 
				button:{
					text_zh_cn:"分享!",
					text_es:"START SHARING!",
					text_en:"START SHARING!", 
					link_zh_cn:"/live-by-the-walk", 
					link_es:"/live-by-the-walk", 
					link_en:"/live-by-the-walk", 
					target:"_self" 
				} 
			}
			
			],
			
	stepTime : 6500
};


/*----------------------------------------------------------------------------------*/
/* CAMPAIGN */
/*----------------------------------------------------------------------------------*/

var CAMPAIGN = {
	 	
	 	title:{ es:"live by the walk", en:"live by the walk" },
	 	subtitle:{ es:"COLECCIÓN PRIMAVERA-VERANO 2013", en:"SPRING-SUMMER COLLECTION 2013" },
	 	button:{ es:"Explora la colección", en:"Explore the collection" },

	 	text_intro : { 
	 		es:'"Los humanos dicen que las caras son el espejo del alma,<br/>yo digo que las personalidades son el espejo de las experiencias."',
	 		en:'"Where humans say that faces are the mirror of the souls,<br/>I say personalities are the mirror of experiences."',
	 		//author:"THE SATORI"
	 		author:"<div class='satori_author'>THE SATORI</div>"
	 	 },

		//intro : { es:"ENHANCED IN", en:"ENHANCED IN", logo:INIT_FOLDER + "website/images/sprite-campaign_en.png", delay:5000 },
		intro : { es:"ENHANCED WITH", en:"ENHANCED WITH", delay:5000 },

		gride_logo:INIT_FOLDER + "website/images/sprite-campaign_en.png",

		legend_delay:6500,
		
		items : 
		[
				{
					day : { es:"DÍA 3", en:"DAY 3" },
					time: { es:"06:43 PM - 6.612 PASOS", en:"06:43 PM - 6.612 STEPS" },
					legend:{ 
						es:'"El día que descubrimos que un pequeño paso para alguien es un gran paso para la humanidad,<br/>pero nada comparado con seguir dando nuevos pasos todo el tiempo"', 
						en:'"The day we discovered that one small step for somebody is a big step for humanity,<br/> but nothing compared to keep walking new steps all time!"'
					},

					big_image_path: INIT_FOLDER + "website/images/campaign/01_SatorisanSS13_Calle.jpg",
					big_image_path_width:1980,
					big_image_path_height:1299,
					offsetY:0,
					thumb_image_path: INIT_FOLDER + "website/images/campaign/01_SatorisanSS13_Calle_thumb.jpg",
					hotpoints: [
						{ 
							video_path:INIT_FOLDER + "website/videos/campaign/calle003_1.mp4",
							video_width:1280,
							video_height:720,
							circle_image_path:INIT_FOLDER + "website/images/campaign/hotspots/tmb_calle003.png",
							coordinates:{x:682,y:980},

							box_coordinates:{x:1100,y:250},

							title:{
								es:"TANUKI",
								en:"TANUKI"
							},
							body:{
								es:"El mapache japonés no es un animal cualquiera, según la creencia popular sus divertidos poderes sobrenaturales le permiten cambiar de apariencia, pudiendo incluso adoptar la forma de una persona.",
								en:"The Japanese raccoon is not just any animal, according to popular belief its funny supernatural powers allow it to change its appearance and may even take the form of a person.",
							},
							block_position:"left",
							link_product:"tanuki"
						},
						{ 
							video_path:INIT_FOLDER + "website/videos/campaign/calle001_1.mp4",
							video_width:1280,
							video_height:720,
							circle_image_path:INIT_FOLDER + "website/images/campaign/hotspots/tmb_calle001.png",
							coordinates:{x:846,y:990},

							box_coordinates:{x:270,y:270},

							title:{
								es:"OKAME",
								en:"OKAME"
							},
							body:{
								es:"Es la representación de la diosa japonesa de la felicidad, la fertilidad y la danza. Responsable de la salida de la diosa del sol fuera de su caverna. Su color es el rojo fuego que ilumina la vida.",
								en:"Is the representation of the Japanese goddess of happiness, fertility and dance. Responsible for bringing the sun goddess outside of her cave. Her fire red color illuminates life.",
							},
							block_position:"left",
							link_product:"okame"
						},
						{ 
							video_path:INIT_FOLDER + "website/videos/campaign/calle002_1.mp4",
							video_width:1280,
							video_height:720,
							circle_image_path:INIT_FOLDER + "website/images/campaign/hotspots/tmb_calle002.png",
							coordinates:{x:1210,y:860},

							box_coordinates:{x:1100,y:300},

							title:{es:"KUGENUMA", en:"KUGENUMA"},
							body:{
								es:"La mística playa japonesa de arena negra. Su suave oleaje es testigo de la personalidad de surfers y longboarders que quieren rendir tributo a los antiguos maestros del mar.",
								en:"The mystical Japanese black sand beach. Its gentle waves witness the personality of the surfers and longboarders who want to pay tribute to the old sea masters.",
							},
							block_position:"left",
							link_product:"kugenuma"
						}
					]
				},
				{
					day : { es:"DÍA 7", en:"DAY 7" },
					time: { es:"10:13 AM - 12.256 PASOS", en:"10:13 AM - 12.256 STEPS" },
					legend:{ 
								es:'"Nos dimos cuenta que los libros hablan de barcos, pero las aventuras hablan de piratas."', 
								en:'"We realized books talk about boats, but adventures talk about pirates."' 
					},
					big_image_path: INIT_FOLDER + "website/images/campaign/02_SatorisanSS13_Barco.jpg",
					big_image_path_width:1980,
					big_image_path_height:1321,

					thumb_image_path: INIT_FOLDER + "website/images/campaign/02_SatorisanSS13_Barco_thumb.jpg",
					offsetY:0,
					hotpoints: [
						{ 
							video_path:INIT_FOLDER + "website/videos/campaign/barco001_1.mp4",
							video_width:1280,
							video_height:720,
							circle_image_path:INIT_FOLDER + "website/images/campaign/hotspots/tmb_barco001.png",
							coordinates:{x:980,y:800},

							box_coordinates:{x:250,y:250},
							
							title:{es:"GESHI", en:"GESHI"},
							body:{
								es:"El momento cumbre del verano.  Los japoneses usan este nombre para indicar el solsticio del verano en su calendario.",
								en:"The highlight of the summer. The Japanese use this name to indicate the summer solstice on their calendar.",
							},
							block_position:"left",
							link_product:"geshi"
						},
						{ 
							video_path:INIT_FOLDER + "website/videos/campaign/barco002_1.mp4",
							video_width:1280,
							video_height:720,
							circle_image_path:INIT_FOLDER + "website/images/campaign/hotspots/tmb_barco002.png",
							coordinates:{x:940,y:972},
							
							box_coordinates:{x:1100,y:300},
							
							title:{es:"NIULANG", en:"NIULANG"},
							body:{
								es:"Durante la festividad japonesa de Tanabata, se cuenta la leyenda de amor de Niulang y Zhinv. Dos amantes que simbolizan su amor a finales de verano cuando las estrellas Altair (Niulang) y Vega (Zhinv) se elevan en el cielo nocturno.",
								en:"During the Japanese Tanabata festival, the legend of the love story of Niulang and Zhinv is narrated. Two lovers that symbolize their love in late summer when the stars Altair (Niulang) and Vega (Zhinv) rise in the night sky.",
							},
							block_position:"left",
							link_product:"niulang"
						}
					]
				},
				{
					day : { es:"DÍA 12", en:"DAY 12" },
					time: { es:"01:41 PM - 23.551 PASOS", en:"01:41 PM - 23.551 STEPS" },
					legend:{ 
								es:'"Aplicamos nuestra regla personal Nº504.<br/>Los Déjà Vu no existen, son solo una excusa para conocerte.”"', 
								en:'"We apply the personal rule #504.<br/>There is no such thing as a deja vu, just an excuse to meet you."'
					},
					big_image_path: INIT_FOLDER + "website/images/campaign/03_SatorisanSS13_Terraza.jpg",
					big_image_path_width:1980,
					big_image_path_height:1321,

					thumb_image_path: INIT_FOLDER + "website/images/campaign/03_SatorisanSS13_Terraza_thumb.jpg",
					offsetY:0,
					hotpoints: [
						{ 
							video_path:INIT_FOLDER + "website/videos/campaign/terraza003_1.mp4",
							video_width:1280,
							video_height:720,
							circle_image_path:INIT_FOLDER + "website/images/campaign/hotspots/tmb_terraza003.png",
							coordinates:{x:1020,y:630},
							
							box_coordinates:{x:150,y:250}, //amarillo

							title:{es:"TAKAYAMA", en:"TAKAYAMA"},
							body:{
								es:"Es la ciudad donde trascurre uno de los festivales más hermosos de Japón. La fiesta empieza en el momento en que miles de tambores y bailarines disfrazados ejecutan la danza del león Shishimai durante kilómetros. Al atardecer, miles de linternas de papel llenan de puntos de luz el pueblo.",
								en:"Is the city where one of the most beautiful festivals in Japan takes place. The party starts at the time when thousands of costumed drummers and dancers perform along miles the lion dance Shishimai. At dusk, thousands of paper lanterns fill the village with spotlights.",
							},
							block_position:"left",
							link_product:"takayama"
						},
						{ 
							video_path:INIT_FOLDER + "website/videos/campaign/terraza001_1.mp4",
							video_width:1280,
							video_height:720,
							circle_image_path:INIT_FOLDER + "website/images/campaign/hotspots/tmb_terraza001.png",
							coordinates:{x:920,y:883},
							
							box_coordinates:{x:1100,y:150}, //azul
							
							title:{es:"AMATERASU", en:"AMATERASU"},
							body:{
								es:"Es la deidad más conocida de la mitología japonesa. El amarillo intenso de la, ni más ni menos, poderosa diosa del sol de Japón.",
								en:"The best known deity of Japanese mythology. The bright yellow of the, one and only, powerful sun goddess of Japan.",
							},
							block_position:"left",
							link_product:"amaterasu"
						},
						{ 
							video_path:INIT_FOLDER + "website/videos/campaign/terraza002_1.mp4",
							video_width:1280,
							video_height:720,
							circle_image_path:INIT_FOLDER + "website/images/campaign/hotspots/tmb_terraza002.png",
							coordinates:{x:830,y:763},
							
							box_coordinates:{x:1100,y:150}, // gris

							title:{es:"HONSHU", en:"HONSHU"},
							body:{
								es:"En otro tiempo llamada Hondo, es la isla principal del archipiélago japonés.",
								en:"Formerly called Hondo, it is the main island of the Japanese archipelago.",
							},
							block_position:"left",
							link_product:"honshu"
						}

					]
				},
				{
					day : { es:"DÍA 15", en:"DAY 15" },
					time: { es:"11:27 AM - 36.916 PASOS", en:"11:27 AM - 36.916 STEPS" },
					legend:{ 
								es:'"El día que nos dimos cuenta que viajar en avión ya no es viajar."', 
								en:'"The time when we realized that traveling by airplane is not traveling anymore."' 
					},
					big_image_path: INIT_FOLDER + "website/images/campaign/04_SatorisanSS13_Coche.jpg",
					big_image_path_width:1980,
					big_image_path_height:1321,

					thumb_image_path: INIT_FOLDER + "website/images/campaign/04_SatorisanSS13_Coche_thumb.jpg",
					offsetY:0,
					hotpoints: [
						{ 
							video_path:INIT_FOLDER + "website/videos/campaign/coche002_1.mp4",
							video_width:1280,
							video_height:720,
							circle_image_path:INIT_FOLDER + "website/images/campaign/hotspots/tmb_coche002.png",
							coordinates:{x:1012,y:795},

							box_coordinates:{x:250,y:250},

							title:{es:"INARI", en:"INARI"},
							body:{
								es:"Pocas representaciones de deidades son más representativas de la sociedad japonesa. La colorida Inari es la diosa de la fertilidad, el arroz, la agricultura, la industria y el éxito en general...",
								en:"Few depictions of deities are most representative of Japanese society. The colorful Inari is the goddess of fertility, rice, agriculture, industry and the overall success...",
							},
							block_position:"left",
							link_product:"inari"
						},
						{ 
							video_path:INIT_FOLDER + "website/videos/campaign/coche001_1.mp4",
							video_width:1280,
							video_height:735,
							circle_image_path:INIT_FOLDER + "website/images/campaign/hotspots/tmb_coche001.png",
							coordinates:{x:973,y:340},
							
							box_coordinates:{x:1100,y:250},
							
							title:{es:"HANAMICHI", en:"HANAMICHI"},
							body:{
								es:"Hanamichi es el puente de unión entre el público y los actores Kabuki. Esta pasarela es utilizada para acercar las experiencias al público, abandonando el escenario y sumergiéndose entre la audiencia. Literalmente significa camino florido.",
								en:"Hanamichi is the bridge between the public and the Kabuki actors. This gateway is used to bring the experiences to the public, leaving the stage and immersing the audience. Literally it means flower passage.",
							},
							block_position:"left",
							link_product:"hanamichi"
						}
					]
				},

				
				{
					day : { es:"DÍA 18", en:"DAY 18" },
					time: { es:"12:25 PM - 49.137 PASOS", en:"12:25 PM - 49.137 STEPS" },
					legend:{ 
								es:'"Aprendimos que todo es inspiración,<br/>bueno... y experiencias, bueno... y conejos arlequín, y..."', 
								en:'"We learnt it is all about inspiration, well... and experiences,<br/>well... and harlequin rabbits, and..."' 
					},

					big_image_path: INIT_FOLDER + "website/images/campaign/05_SatorisanSS13_Pintor.jpg",
					big_image_path_width:1980,
					big_image_path_height:1299,
					offsetY:0,
					thumb_image_path: INIT_FOLDER + "website/images/campaign/05_SatorisanSS13_Pintor_thumb.jpg",
					hotpoints: [
						{ 
							video_path:INIT_FOLDER + "website/videos/campaign/pintor001_1.mp4",
							video_width:1280,
							video_height:720,
							circle_image_path:INIT_FOLDER + "website/images/campaign/hotspots/tmb_pintor001.png",
							coordinates:{x:723,y:1085},
							
							box_coordinates:{x:1100,y:150},
							
							title:{es:"SENDAI", en:"SENDAI"},
							body:{
								es:"Capital de la provincia de Miyagi, Japón y una de las capitales del surf japones. Su larga historia ha sido cimentada por su mar. Sus famosos saltos han sido cabalgados por los mejores riders.",
								en:"Capital of the province of Miyagi, Japan, and one of the capitals of the Japanese surf. Its long history has been strengthened by its sea. Its famous jumps have been ridden by the best boarders.",
							},
							block_position:"left",
							link_product:"sendai"
						},
						{ 
							video_path:INIT_FOLDER + "website/videos/campaign/pintor002_1.mp4",
							video_width:1280,
							video_height:720,
							circle_image_path:INIT_FOLDER + "website/images/campaign/hotspots/tmb_pintor002.png",
							coordinates:{x:890,y:970},
							
							box_coordinates:{x:1100,y:300},
							
							title:{es:"WAFFURU", en:"WAFFURU"},
							body:{
								es:"Dulce, sabroso, con helado y mermelada, el gofre al estilo japonés.",
								en:"Sweet, tasty with ice cream and jam, the Japanese-style waffle.",
							},
							block_position:"left",
							link_product:"waffuru"
						},
						{ 
							video_path:INIT_FOLDER + "website/videos/campaign/pintor003_1.mp4",
							video_width:1280,
							video_height:720,
							circle_image_path:INIT_FOLDER + "website/images/campaign/hotspots/tmb_pintor003.png",
							coordinates:{x:1050,y:975},
							
							box_coordinates:{x:270,y:270},
							
							title:{es:"HOKUSAI", en:"HOKUSAI"},
							body:{
								es:"Gran maestro pintor y grabador Japonés. Viajero y observador. Conocido por sus tempestades en alta mar rompiendo enérgicas, por su bella forma de ver los paisajes de todo Japón y por sus más de treinta nombres diferentes que utilizo durante su vida. Arte puro, un torrente de personalidad.",
								en:"Grandmaster Japanese painter and engraver. Traveler and observer. Known for his strong sea storms, for his beautiful way of visualizing Japanese scenery and for using over thirty names throughout his life. Pure Art, a torrent of personality.",
							},
							block_position:"left",
							link_product:"hokusai"
						}
					]
				},

				

				{
					day : { es:"DÍA 19", en:"DAY 19" },
					time: { es:"07:11 PM - 53.672 PASOS", en:"07:11 PM - 53.672 STEPS" },
					legend:{ 
								es:'"Una experiencia se convierte en épica cuando nadie está liderando y nadie está siguiendo"', 
								en:'"An experience goes epic when nobody is leading and nobody following."' 
					},
					big_image_path: INIT_FOLDER + "website/images/campaign/06_SatorisanSS13_Bicis.jpg",
					big_image_path_width:1980,
					big_image_path_height:1321,

					thumb_image_path: INIT_FOLDER + "website/images/campaign/06_SatorisanSS13_Bicis_thumb.jpg",
					offsetY:0,
					hotpoints: [
						{ 
							video_path:INIT_FOLDER + "website/videos/campaign/bici001_1.mp4",
							video_width:1280,
							video_height:720,
							circle_image_path:INIT_FOLDER + "website/images/campaign/hotspots/tmb_bici001.png",
							coordinates:{x:896,y:897},
							
							box_coordinates:{x:200,y:200},
							
							title:{es:"KOYA", en:"KOYA"},
							body:{
								es:"El monte Koya es parte de la historia de Japón no solo por ser el centro más importante del budismo Shingon, sino por estar rodeado por los iconográficos  ocho picos japoneses que según dice la leyenda rodean el monte dibujando los pétalos de una Flor de loto.",
								en:"Mount Koya is a part of Japan’s history not only because is the most important center of Shingon Buddhism, but also because it is surrounded by eight Japanese iconographic peaks that together resemble the petals of a lotus flower.",
							},
							block_position:"left",
							link_product:"koya"
						},
						{ 
							video_path:INIT_FOLDER + "website/videos/campaign/bici002_1.mp4",
							video_width:1280,
							video_height:720,
							circle_image_path:INIT_FOLDER + "website/images/campaign/hotspots/tmb_bici002.png",
							coordinates:{x:1143,y:890},
							
							box_coordinates:{x:1100,y:200},
							
							title:{es:"TAMA", en:"TAMA"},
							body:{
								es:"Debe su nombre a la región Tama, tierra de colores intensos, que  rodea Tokyo.",
								en:"It owes its name to the region of Tama, land of intense colors, that surrounds Tokyo.",
							},
							block_position:"left",
							link_product:"tama"
						},
						{ 
							video_path:INIT_FOLDER + "website/videos/campaign/bici003_1.mp4",
							video_width:1280,
							video_height:720,
							circle_image_path:INIT_FOLDER + "website/images/campaign/hotspots/tmb_bici003.png",
							coordinates:{x:1329,y:952},
							
							box_coordinates:{x:1100,y:200},
							
							title:{es:"FUJI", en:"FUJI"},
							body:{
								es:"Es el pico más alto de todo Japón. Ha sido hogar del dios del fuego, de la diosa de los árboles en flor,... incluso se dice que una de sus diosas, conocida como Sengen, dejaba subir a la cima solo a los peregrinos con corazón puro.",
								en:"Mount Fuji is the highest peak in Japan. It has been known as the home of a fire god, of the goddess of flowering trees, ... It is said that one of the deities, known as Sengen, only allowed pilgrims who were pure of heart to climb to the summit. ",
							},
							block_position:"left",
							link_product:"fuji"
						},
						{ 
							video_path:INIT_FOLDER + "website/videos/campaign/bici004_1.mp4",
							video_width:1280,
							video_height:720,
							circle_image_path:INIT_FOLDER + "website/images/campaign/hotspots/tmb_bici004.png",
							coordinates:{x:1309,y:783},
													
							box_coordinates:{x:250,y:200},

							title:{es:"NARA", en:"NARA"},
							body:{
								es:"Antigua capital medieval de Japón. Tierra de Samurais y del venerado ciervo Sika. Este animal de pelaje claro y oscuro mezclado y cornamenta poderosa ha sido representado como el protector del bosque en la antigüedad. Actualmente vive libremente en las zonas verdes de la ciudad. Nara, cuna de un sinfín de leyendas modernas.",
								en:"Ancient medieval capital of Japan. Land of Samurais and revered Sika deer. This animal with mixed light and dark fur and powerful antlers has been depicted as the ancient protector of the forest, lives freely in the green areas of the city. Nara, home to a host of modern legends.",
							},
							block_position:"left",
							link_product:"nara"
						}
					]
				},


				{
					day : { es:"DÍA 21", en:"DAY 21" },
					time: { es:"08:37 PM - 67.702 PASOS", en:"08:37 PM - 67.702" },
					legend:{ 
								es:'"Una imagen vale más que mil palabras, el silencio vale millones de imágenes”"', 
								en:'"One image is worthy of a thousand words, silent is worth millions of images."' 
					},
					big_image_path: INIT_FOLDER + "website/images/campaign/07_SatorisanSS13_Playa.jpg",
					big_image_path_width:1980,
					big_image_path_height:1321,

					thumb_image_path: INIT_FOLDER + "website/images/campaign/07_SatorisanSS13_Playa_thumb.jpg",
					offsetY:0,
					hotpoints: [
						{ 
							video_path:INIT_FOLDER + "website/videos/campaign/playa001_1.mp4",
							video_width:1280,
							video_height:720,
							circle_image_path:INIT_FOLDER + "website/images/campaign/hotspots/tmb_playa001.png",
							coordinates:{x:380,y:852},
							
							box_coordinates:{x:300,y:300},
							
							title:{es:"KUGENUMA", en:"KUGENUMA"},
							body:{
								es:"La mística playa japonesa de arena negra. Su suave oleaje es testigo de la personalidad de surfers y longboarders que quieren rendir tributo a los antiguos maestros del mar.",
								en:"The mystical Japanese black sand beach. Its gentle waves witness the personality of the surfers and longboarders who want to pay tribute to the old sea masters.",
							},
							block_position:"left",
							link_product:"kugenuma"
						},
						{ 
							video_path:INIT_FOLDER + "website/videos/campaign/playa002_1.mp4",
							video_width:1280,
							video_height:720,
							circle_image_path:INIT_FOLDER + "website/images/campaign/hotspots/tmb_playa002.png",
							coordinates:{x:600,y:830},
							
							box_coordinates:{x:200,y:300},

							title:{es:"SHIROZAKE", en:"SHIROZAKE"},
							body:{
								es:"Literalmente significa “Amor Blanco”. Es un licor de sake espeso, dulce y blanco. Fue creado alrededor del 1600 por un comerciante de sake y alimentos, que según se cuenta, tuvo un sueño en el que un muñeco de papel le dijo cómo hacer esta bebida. Hoy en día, todavía se vende Shirozake después de 400 años.",
								en:"It literally means 'White Love'. It is a thick, sweet and white sake liqueur that was created around 1600 by a sake and food merchant. It is said that he had a dream in which a paper doll told him how to make this drink. Shirozake is still sold today, after 400 years.",
							},
							block_position:"left",
							link_product:"shirozake"
						},
						{ 
							video_path:INIT_FOLDER + "website/videos/campaign/playa003_1.mp4",
							video_width:1280,
							video_height:720,
							circle_image_path:INIT_FOLDER + "website/images/campaign/hotspots/tmb_playa003.png",
							coordinates:{x:830,y:792},
							
							box_coordinates:{x:150,y:250},
							
							title:{es:"TAKAYAMA", en:"TAKAYAMA"},
							body:{
								es:"Es la ciudad donde trascurre uno de los festivales más hermosos de Japón. La fiesta empieza en el momento en que miles de tambores y bailarines disfrazados ejecutan la danza del león Shishimai durante kilómetros. Al atardecer, miles de linternas de papel llenan de puntos de luz el pueblo.",
								en:"Is the city where one of the most beautiful festivals in Japan takes place. The party starts at the time when thousands of costumed drummers and dancers perform along miles the lion dance Shishimai. At dusk, thousands of paper lanterns fill the village with spotlights.",
							},
							block_position:"left",
							link_product:"takayama"
						},
						{ 
							video_path:INIT_FOLDER + "website/videos/campaign/playa004_1.mp4",
							video_width:1280,
							video_height:720,
							circle_image_path:INIT_FOLDER + "website/images/campaign/hotspots/tmb_playa004.png",
							coordinates:{x:1055,y:727},
							
							box_coordinates:{x:250,y:250},
							
							title:{es:"DAIFUKU", en:"DAIFUKU"},
							body:{
								es:"“Gran Suerte”. Es un dulce japonés consistente en un pequeño mochi o pastel de arroz, con un relleno dulce hecho a base de judías rojas. Una delicatessen de experiencias.",
								en:"'Great Luck'. A Japanese sweet consisting of a small mochi or rice cake, with a filling made from sweet red beans. A deli experience.",
							},
							block_position:"left",
							link_product:"daifuku"
						}
					]
				}
		]
		
	
};


/*----------------------------------------------------------------------------------*/
/* SATORI HEART */
/*----------------------------------------------------------------------------------*/

var SATORI_HEART_IMAGE_FULL_ZOOM_WIDTH = 30800;
var SATORI_HEART_IMAGE_FULL_ZOOM_HEIGHT = 16410;
var SATORI_HEART_TILE_SIZE = 256;
var SATORI_HEART_ZOOM_MULTIPLIER = 2;
var SATORI_HEART_ZOOM_LEVELS = 6;
        
var SATORI_HEART_LEVEL_MULTIPLIERS;
SATORI_HEART_LEVEL_MULTIPLIERS = [];
for (var i = 0; i < SATORI_HEART_ZOOM_LEVELS; i++)
{
    SATORI_HEART_LEVEL_MULTIPLIERS[i] = 1 / Math.pow(SATORI_HEART_ZOOM_MULTIPLIER, SATORI_HEART_ZOOM_LEVELS - 1 - i);
}

var SATORI_HEART =
{
	preloaderHeaderText: 
	{
		zh_cn: 'SATORI HEART',
		es: 'SATORI HEART',
		en: 'SATORI HEART',
	},
	preloaderFooterText: 
	{
		zh_cn: 'Bienvenido a la isla',
		es: 'Bienvenido a la isla',
		en: 'Welcome to the island',
	},
	splash:
	{
		title:
		{
			en: "Do you want to discover the Satori Heart?",
			es: "¿Quieres conocer el Satori Heart?"
		},
		body:
		{
			en:
			"\
				<p>\
                    The Satori Heart is a magical place with 6 different regions.\
                </p>\
				<p>\
                    The two main ones are \"Balance Kingdom\" and \"Harmony Council\", but in fact every corner is\
                    important.\
                </p>\
				<p>\
					Discover it calmly, learn from its people and find the perfect Satori shoes for each part of the\
					journey.\
                </p>\
            ",
			es:
			"\
				<p>\
                    El Satori Heart es un lugar mágico compuesto por 6 regiones que lo dividen.\
                </p>\
				<p>\
                    Las dos principales son \"Balance Kingdom\" y \"Harmony Council\", aunque en realidad cada\
                    rincón es importante.\
                </p>\
				<p>\
					Explóralo con calma, aprende de sus gentes y encuentra las Satori perfectas para cada momento de tu viaje.\
                </p>\
            ",
		},
		explore:
		{
			es: 'Explorar',
			en: 'Explore',
		}
	},
	viewLookbook: 
	{
		es: 'Ver Lookbook',
		en: 'View Lookbook',
	},
	backToMap_campaign: 
	{
		es: 'Volver a mapa',
		en: 'Back to map',
	},
	backToMap_detail: 
	{
		es: 'Volver a mapa',
		en: 'Back to<br/>map',
	},
	moreInfo: 
	{
		es: 'Más información',
		en: 'View more',
	},
	markers: 
	[
		{
			id: 'always-connected-bridge',
			path: '/product/tagomago-vaquero-jeans',
			lat: 4108 + 2751,
			lng: 7905 + 10345,
			name: 'Always Connected Bridge',
			body:
			{
				es: '<p>Este puente une a personas de todo el mundo. Cuando llegas al otro lado, te dan un ticket para pasar un rato a solas con un buen amigo o conocer a alguien nuevo. Sin facebook, sin smartphone, sin google glasses. Simplemente con ganas.</p>',
				en:	'<p>This bridge connects people across the world. Once you reach the other side, you’ll have a ticket to spend some time with a good friend or meet someone new. No Facebook, no Smartphone, no Google Glasses. You just need to feel like it.</p>',
			},
			footerTitle: 'Tagomago Vaquero Jeans',
			footerBody:
			{
				es:
				'\
					Comparte con alguien tu tiempo y un paseo agradable con tus TAGOMAGO VAQUERO JEANS.\
				',
				en:
				'\
					Share your time and a nice walk with somebody and a pair of TAGOMAGO VAQUERO JEANS.\
				',
			}
		},	
		{
			id: 'generocity',
			path: '/product/benirras-vaquero-wine-wood',
			lat: 4108 + 6837,
			lng: 7905 + 8558,
			name: 'Generocity',
			body:
			{
				es: '<p>Esta ciudad fue levantada por jóvenes artistas que la fundaron para compartirla con todos los que viven pensando en dar, sin esperar nada a cambio.</p>',
				en:	'<p>This city was created by young artists for those who give without expecting anything in return.</p>',
			},
			footerTitle: 'Benirras Vaquero Wine Wood',
			footerBody:
			{
				es:
				'\
					Descubre todo lo que tienen para ti con estas BENIRRÁS VAQUERO WINE WOOD.\
				',
				en:
				'\
					Discover all they have for you with BENIRRAS VAQUERO WINE WOOD.\
				',
			}
		},
		{
			id: 'kindness-town',
			path: '/product/yukai-napa-cuero',
			lat: 4108 + 4904,
			lng: 7905 + 5606,
			name: 'Kindness Town',
			body:
			{
				es: '<p>Bienvenido al pueblo del buen rollo. Los pájaros cantan swing y siempre hay cerveza fría en la nevera.</p>',
				en:	'<p>Welcome to the town with good vibes. The birds sing swing songs and there’s always a cold beer in the fridge.</p>',
			},
			footerTitle: 'Yukai Napa Cuero',
			footerBody:
			{
				es:
				'\
					Un placer pasear por la ciudad sin prisa con unas YUKAI NAPA CUERO.\
				',
				en:
				'\
					It’s a pleasure to walk around without a hurry with a pair of YUKAI NAPA CUERO.\
				',
			}
		},
		{
			id: 'dreamerness',
			path: '/product/kioku-vaquero-coco',
			lat: 4108 + 2012,
			lng: 7905 + 7775,
			name: 'Dreamerness',
			body:
			{
				es: '<p>Cuando sueñas, sueñas con una sitio como este. Una ciudad donde absolutamente todo es posible.</p>',
				en: '<p>In your dreams you think about a place like this one; a city where anything can happen.</p>',
			},
			footerTitle: 'Kugenuma Linen Mega Marbre',
			footerBody:
			{
				es:
				'\
					Recórrela sonámbulo con tus KIOKU VAQUERO COCO.\
				',
				en:
				'\
					Sleepwalk around it wearing your KIOKU VAQUERO COCO.\
				',
			}
		},
		{
			id: 'understanding-village',
			path: '/product/yasuragi-linen-giallo',
			lat: 4108 + 6987,
			lng: 7905 + 7693,
			name: 'Understanding Village',
			body:
			{
				es: '<p>Fundada como tierra de los que no encajaban, esta bella ciudad es refugio de los que saben que “lo diferente” es un bien preciado.</p>',
				en:	'<p>Settled by those who were different, this beautiful city is the home of the ones who know that being different means being special.</p>',
			},
			ooterTitle: 'Yasuragi Linen Giallo',
			footerBody:
			{
				es:
				'\
					Exprésate con libertad subido a unas YASURAGI LINEN GIALLO.\
				',
				en:
				'\
				 	Express yourself freely here wearing a pair of YASURAGI LINEN GALLO.\
				',
			}
		},
		{
			id: 'cliff-where-you-come-to-think',
			path: '/product/tagomago-vaquero-coco',
			lat: 4108 + 6544,
			lng: 7905 + 6069,
			name: 'Cliff Where You Come To Think',
			body:
			{
				es: '<p>Para conocernos mejor, todos necesitamos enfrentarnos a nuestros límites. Estos acantilados le refrescan a uno la cara y el alma.</p>',
				en:	'<p>We need to reach our own limits in order to know ourselves better. These cliffs will refresh your face and your soul.</p>',
			},
			footerTitle: 'Tagomago Vaquero Coco',
			footerBody:
			{
				es:
				'\
					Airea tus ideas y date un paseo hasta aquí con tus TAGOMAGO VAQUERO COCO.\
				',
				en:
				'\
					Release your mind and take a walk with your TAGOMAGO VAQUERO COCO.\
				',
			}
		},
		{
			id: 'equity-city',
			path: '/product/sukkiri-linen-jeans',
			lat: 4108 + 3910,
			lng: 7905 + 8956,
			name: 'Equity City',
			body:
			{
				es: '<p>El encanto de la ciudad es la falta de contrastes. Con una armonía arquitectónica sobresaliente. Todos conviven en igualdad y armonía.</p>',
				en:	'<p>This city’s main charm is the lack of contrasts. It has an outstanding architectural harmony. Everyone is equal and gets along with each other here.</p>',
			},
			footerTitle: 'Sukkiri Linen Jeans',
			footerBody:
			{
				es:
				'\
					Un lugar único para disfrutar con tus SUKKIRI LINEN JEANS.\
				',
				en:
				'\
					A unique place to enjoy with your SUKKIRI LINEN JEANS.\
				',
			}
		},	
		{
			id: 'calm-&-blue-reef',
			path: '/product/heisei-suede-moss-green',
			lat: 4108 + 4835,
			lng: 7905 + 10538,
			name: 'Calm & Blue Reef',
			body:
			{
				es: '<p>Corales azules y turquesas. Formas imposibles y sesiones de buceo infinitas. Mares de peces y un licor de piña que te hará caer de espaldas.</p>',
				en:	'<p>Blue and turquoise corals, different shapes and infinite snorkeling adventures. The fish shoals and the pineapple liqueur will blow your mind.</p>',
			},
			footerTitle: 'Heisei Suede Moss Green',
			footerBody:
			{
				es:
				'\
					Lánzate a descubrirlo sin quitarte tus HEISEI SUEDE MOSS GREEN.\
				',
				en:
				'\
					Discover it wearing a pair of HEISEI SUEDE MOSS GREEN.\
				',
			}
		},	
		{
			id: 'peaceful-city',
			path: '/product/jet-bondi-gravel',
			lat: 4108 + 5914,
			lng: 7905 + 9149,
			name: 'Peaceful City',
			body:
			{
				es: '<p>El lugar perfecto para cuando sientas que tu cabeza da vueltas aunque tu estés quieto. Merece la pena detenerse un poco a disfrutarla.</p>',
				en:	'<p>It is the perfect place to find your mind when it seems to be far away. It is worth stopping by when you are wandering around it.</p>',
			},
			footerTitle: 'Jet Bondi Gravel',
			footerBody:
			{
				es:
				'\
					Una ciudad para conocer a cámara lenta a bordo de unas JET BONDI GRAVEL.\
				',
				en:
				'\
					Discover the city in slow motion with a pair of JET BONDI GRAVEL.\
				',
			}
		},	
		{
			id: 'inspiration-mountain',
			path: '/product/kugenuma-linen-graisse-fat',
			lat: 4108 + 2358,
			lng: 7905 + 7231,
			name: 'Inspiration Mountain',
			body:
			{
				es: '<p>Un lugar único y adictivo donde encontrar siempre una dosis perfecta de inspiración.</p>',
				en:	'<p>It is a unique and addictive place where you can find the right inspiration dose.</p>',
			},
			footerTitle: 'Kugenuma Linen Graisse Fat',
			footerBody:
			{
				es:
				'\
					Inspírate en lo mál alto de tus KUGENUMA LINEN GRAISSE FAT.\
				',
				en:
				'\
					Motivate yourself with a pair of KUGENUMA LINEN GRAISSE FAT.\
				',
			}
		},	
		{
			id: 'energy-town',
			path: '/product/heisei-tie-dye-bottle-green',
			lat: 4108 + 3482,
			lng: 7905 + 5968,
			name: 'Energy Town',
			body:
			{
				es: '<p>La ciudad siempre despierta. De sus arboledas caen frutos y en sus tabernas se brinda con el vino de la bravura. Si vienes a Energy Town, no necesitarás más siestas.</p>',
				en:	'<p>The city that never sleeps. Its trees always give fruits and in the bar there’s always a reason to drink a toast with the wine of the braves. If you come to Energy Town you won’t need a “siesta” anymore.</p>',
			},
			footerTitle: 'Heisei Tie Dye Bottle Green',
			footerBody:
			{
				es:
				'\
					Un pueblo donde la energía fluye a través de tus HEISEI TIE DYE BOTTLE GREEN.\
				',
				en:
				'\
					A place where the energy will flow through your HEISEI TIE DYE BOTTLE GREEN.\
				',
			}
		},	
		{
			id: 'crazy-city',
			path: '/product/antai-linen-wine-wood',
			lat: 4108 + 3332,
			lng: 7905 + 9474,
			name: 'Crazy City',
			body:
			{
				es: '<p>En esta ciudad nada es lo que parece. Si te animas a descubrirla, sigue el consejo de los que saben: cuando todo el mundo está loco, ser cuerdo es una locura.</p>',
				en:	'<p>In this city nothing is what it seems. If you are willing to discover it, follow this advice: where everyone is insane, being sane is crazy.</p>',
			},
			footerTitle: 'Antai Linen Wine Wood',
			footerBody:
			{
				es:
				'\
					Pierde la cabeza con tus ANTAI LINEN WINE WOOD.\
				',
				en:
				'\
					Lose your mind with a pair of ANTAI LINEN WINE WOOD.\
				',
			}
		},	
		{
			id: 'first-kiss-beach',
			path: '/product/jet-bondi-rose-resin',
			lat: 4108 + 1656,
			lng: 7905 + 6044,
			name: 'First Kiss Beach',
			body:
			{
				es: '<p>Arena rosada, coral brillante y un calor intenso de lo más estimulante.</p>',
				en:	'<p>Pink sand, shiny coral and a stimulating hot weather.</p>',
			},
			footerTitle: 'Jet Bondi Rose Resin',
			footerBody:
			{
				es:
				'\
					El único lugar en el que no te importará quitarte tus JET BONDI ROSE RESIN.\
				',
				en:
				'\
					The only place where you won’t mind taking off your JET BONDI ROSE RESIN.\
				',
			}
		},	
		{
			id: 'sweetheart-lake',
			path: '/product/benirras-vaquero-rose-resin',
			lat: 4108 + 1245,
			lng: 7905 + 7230,
			name: 'Sweetheart Lake',
			body:
			{
				es: '<p>Todo late con calma en Sweetheart. Un sirope exquisito, el mejor de la región, se desliza por la corteza de los árboles para hacer las tortitas más exquisitas que jamás hayas probado.</p>',
				en:	'<p>The beat goes slow in Sweetheart. The best syrup of the region slides down the tree’s bark to make the best pancakes you’ve ever tried.</p>',
			},
			footerTitle: 'Benirrás Vaquero Rose Resin',
			footerBody:
			{
				es:
				'\
					Sumérgete con tus BENIRRÁS VAQUERO ROSE RESIN.\
				',
				en:
				'\
					Discover it wearing BENIRRÁS VAQUERO ROSE RESIN.\
				',
			}
		},	
		{
			id: 'health-falls',
			path: '/product/kugenuma-linen-mega-marbre',
			lat: 4108 + 5315,
			lng: 7905 + 7497,
			name: 'Health Falls',
			body:
			{
				es: '<p>El que las descubrió siempre decía que era conveniente hacer lo que te diera la gana porque era bueno para la salud.</p>',
				en:	'<p>The one who discovered these waterfalls used to say that you will have good health if you always do what you feel like doing.</p>',
			},
			footerTitle: 'Kioku Vaquero Coco',
			footerBody:
			{
				es:
				'\
					Date un paseo hasta allí con tus KUGENUMA LINEN MEGA MARBRE.\
				',
				en:
				'\
					Come here with your KUGENUMA LINEN MEGA MARBRE.\
				',
			}
		},	
		{
			id: 'discovery-village',
			path: '/product/yukai-napa-coco',
			lat: 4108 + 3070,
			lng: 7905 + 8780,
			name: 'Discovery Village',
			body:
			{
				es: '<p>Muchos Satori Hearts de los que se han hecho a sí mismos en la vida se compran un refugio en esta villa para disfrutar de los sueños cumplidos.</p>',
				en:	'<p>A lot of successful Satori Hearts bought their shelter in this village to enjoy their dreams that came true.</p>',
			},
			footerTitle: 'Yukai Napa Coco',
			footerBody:
			{
				es:
				'\
					Contágiate de su energía con tus YUKAI NAPA COCO.\
				',
				en:
				'\
					Share their energy with a pair of YUKAI NAPA COCO.\
				',
			}
		},	
		{
			id: 'sweet-lighthouse',
			path: '/product/kugenuma-linen-jeans',
			lat: 4108 + 1272,
			lng: 7905 + 5645,
			name: 'Sweet Lighthouse',
			body:
			{
				es: '<p>Más viejo que el mismísimo mar salado. Fue reconstruido en el último temporal que lo hizo añicos.</p>',
				en:	'<p>Older than the salty sea, this lighthouse had to be rebuilt after the storm that made it crumble.</p>',
			},
			footerTitle: 'Kugenuma Linen Jeans',
			footerBody:
			{
				es:
				'\
					Déjate guiar hasta allí por tus KUGENUMA LINEN JEANS.\
				',
				en:
				'\
					Guide yourself here with your KUGENUMA LINEN JEANS.\
				',
			}
		},	
		{
			id: 'that-friend-you-miss-so-much-village',
			path: '/product/hamoru-isabella-graisse-fat',
			lat: 4108 + 2340,
			lng: 7905 + 11719,
			name: 'That Friend You Miss So Much Village',
			body:
			{
				es: '<p>Una villa llena de buzones de correo, esperando noticias de todos aquellos que se fueron.</p>',
				en:	'<p>This town is full of mail posts that wait for news about those who are away.</p>',
			},
			footerTitle: 'Hamoru Isabella Graisse Fat',
			footerBody:
			{
				es:
				'\
					Reencuéntrate con tus amistades montado en unas HAMORU ISABELLA GRAISSE FAT.\
				',
				en:
				'\
					Meet again your old friends wearing HAMORU ISABELLA GRAISSE FAT.\
				',
			}
		},	
		{
			id: 'tender-sunset-port',
			path: '/product/hamoru-tropic-coral',
			lat: 4108 + 2842,
			lng: 7905 + 5770,
			name: 'Tender Sunset Port',
			body:
			{
				es: '<p>La ciudad bañada a orillas de Lovelifornia. Un enclave único en el que perderse y no volver.</p>',
				en:	'<p>It is a beautiful city on Lovelifornia’s coast. A place where you will like to get lost and never come back.</p>',
			},
			footerTitle: 'Hamoru Tropic Coral',
			footerBody:
			{
				es:
				'\
					Disfruta de su vida a paso lento con unas HAMORU TROPIC CORAL.\
				',
				en:
				'\
					Slowly enjoy the life here with a pair of HAMORU TROPIC CORAL.\
				',
			}
		},	
	]
}

for (var i = 0; i < SATORI_HEART.markers.length; i++)
{
    var markerData = SATORI_HEART.markers[i];
    markerData.latLng = new L.latLng(-markerData.lat * SATORI_HEART_LEVEL_MULTIPLIERS[0], markerData.lng * SATORI_HEART_LEVEL_MULTIPLIERS[0])
}


/*----------------------------------------------------------------------------------*/
/* BRAND */
/*----------------------------------------------------------------------------------*/				    

/*var BRAND = {
	pages : [ 
 
			{ path : "http://www.ingamana.com/satorisan/test/campaign/01_SatorisanSS13_Calle.jpg", width:1980, height:1299, title:"1LIVE BY THE WALK", body:"One day, one moment or one instant. Just the present for some.<br/>Experiences building up their own singularirt for others." },
			{ path : "http://www.ingamana.com/satorisan/test/home/coche_foto.jpg", width:1980, height:1321, title:"2LIVE BY THE WALK", body:"One day, one moment or one instant. Just the present for some.<br/>Experiences building up their own singularirt for others." },
			{ path : "http://www.ingamana.com/satorisan/test/home/slide1.jpg", width:1600, height:993, title:"3LIVE BY THE WALK", body:"One day, one moment or one instant. Just the present for some.<br/>Experiences building up their own singularirt for others." }
			],
			
	stepTime : 7000
};*/ 


/*----------------------------------------------------------------------------------*/
/* TRANSITION */
/*----------------------------------------------------------------------------------*/

var TRANSITION_TIME = 500;
var TRANSITION_EASE = "";


/*----------------------------------------------------------------------------------*/
/* FILTER */
/*----------------------------------------------------------------------------------*/

var FILTER_TEXT = [];

FILTER_TEXT ["zh_cn"] = {
		collection : "类别",
		color : "颜色",
		size : "尺码",
		prize : "价格",
		quantity: "库存",
		default_value : "全部"
	 }

FILTER_TEXT ["es"] = {
						collection : "COLECCIÓN",
						color : "COLOR",
						size : "TALLA",
						prize : "PRECIO",
						quantity: "CANTIDAD",
						default_value : "TODOS"
					 }

FILTER_TEXT ["en"] = {
						collection : "COLLECTION",
						color : "COLOR",
						size : "SIZE",
						prize : "PRICE",
						quantity: "QUANTITY",
						default_value : "ALL"
					 }


/*----------------------------------------------------------------------------------*/
/* TECH */
/*----------------------------------------------------------------------------------*/

var TECH_TIMELINE = { en:["OUTLOOK", "FOOTPRINT", "SPIRIT"], es:["OUTLOOK", "FOOTPRINT", "SPIRIT"] }


/*----------------------------------------------------------------------------------*/
/* BRAND */
/*----------------------------------------------------------------------------------*/

var BRAND_TIMELINE = { en:["SATORI", "SATORISAN", "CRAFTSMANSHIP"], es:["SATORI", "SATORISAN", "ARTESANIA"] }

var BRAND = {
	preload_time:3000,
	preload_text:{ es:"El “Live by the Walk” de Satorisan", en:"What makes Satorisan live by the walk" },
	pages:[
			{ 
				image_path:"/website/images/thebrand/fw14/1_satori.jpg",
				image_align: "top", 
				title:{es:"Satori", en:"Satori"},
				body:{es:"Representado en la “Enciclopedia de los Yokai” (妖怪の本) año 1781, el Satori se describe como una criatura sobrenatural con la capacidad de leer el corazón de las personas.<br/><br/><strong>Equilibrio y entendimiento</strong><br/>Dentro de la tradición del budismo Zen, Satori significa entendimiento e iluminación.  Satorisan se basa en este espíritu de comprensión y equilibro, con una visión de<br/>360 º. Es este conocimiento lo que dota de felicidad a todo aquel que consigue sentirlo.",
					en:"In The Great Yokai Encyclopedia [妖怪の本], a book about the mythical monsters of ancient Japan, the Satori is described as an ape-like being that had the capacity to see directly into people’s hearts.<br/><br/><strong>Balance & Insight</strong><br/>Within the tradition of Zen Buddhism, Satori means insight or enlightenment. We like to see it as being completely balanced and having a full, 360 degrees, understanding. It’s the type of understanding which brings happiness to all who sense it."}
			},
			{ 
				image_path:"/website/images/thebrand/fw14/2_satorisan2.jpg", 
				image_align: "middle", 
				title:{es:"Satorisan", en:"Satorisan"},
				body:{es:"Satorisan fue fundado en 2010 por un equipo de profesionales con gran experiencia en el sector de la industria del calzado. Nos servimos de este conocimiento adquirido durante casi  20 años creando calzado.<br/><br/>En nuestro comienzo, sabíamos que Satorisan llegaría a convertirse en algo especial.<br/>Nuestro lema era simple: Crear calzado único y especial. Calzado extremadamente confortable  y que al paso del tiempo ganara en belleza. Calzado con alma.", 
					en:"Satorisan was founded in 2010 by a team of experienced professionals in the footwear industry. We put to use all the knowledge acquired during almost 20 years of making footwear.<br/><br/>When we started out, we knew Satorisan had to become something special. Our aim was simple: Create unique and beautiful footwear. Footwear that is extremely comfortable and becomes more beautiful the older it gets. Footwear with a soul."}
			},
			{ 
				image_path:"/website/images/thebrand/fw14/3_craftsmanship.jpg",
				image_align: "middle",  
				title:{es:"Artesanía", en:"Craftsmanship"},
				body:{es:"Todos nuestros zapatos estan producidos en nuestra propia fábrica. Fundamos esta compañía con el deseo de ofrecer con coherencia alta calidad con un estilo de producción honesto. Combinando las técnicas tradicionales con la eficiencia de la industria actual, nuestros artesanos trabajan con materiales premium para crear botas y zapatillas de alta calidad. Nos dejamos guiar por nuestra propia visión, recorriendo nuestro propio camino en lugar de seguir las tendencias.", 
					en:"All our shoes are produced in a state-of-the-art production facility. We founded this factory ourselves from a desire to offer consistently high quality and decent working conditions. Combining traditional craftsmanship and modern industrial efficiency, our artisans work with premium materials to create boots and sneakers of exceptional quality. Always staying true to our own spirit, we follow our own trail rather than chasing trends."}
			
			}
	]
}


/*----------------------------------------------------------------------------------*/
/* SIZES */
/*----------------------------------------------------------------------------------*/

var FILTER_SIZE_SMALL_SIZE_TEXT = [];
FILTER_SIZE_SMALL_SIZE_TEXT["en"] = "<p>This model fits tight. Satorisan recommends using one size bigger than your normal shoe size.</p><br /><b>Would you like to select one size bigger?</b><div class='button yes'>YES</div><div class='button no'>NO</div>"; 
FILTER_SIZE_SMALL_SIZE_TEXT["es"] = "<p>Este modelo calza pequeño. Satorisan te recomienda que selecciones una talla mayor.</p><br /><b>¿Quieres seleccionar una talla mayor?</b><div class='button yes'>SI</div><div class='button no'>NO</div>"; 
/*-- CON BOTONES --*/ //FILTER_SIZE_SMALL_SIZE_TEXT["en"] = "This model fits loose.<br/>Satorisan recommends using <span>one size smaller</span><br />than you normal shoe size.<br/><br/ ><b>Would you like to select SIZE <%next_size%>?</b><br/><div class='button yes'>YES</div><div class='button no'>NO</div>"; 
/*-- CON BOTONES --*/ //FILTER_SIZE_SMALL_SIZE_TEXT["es"] = "Este modelo se ajusta suelto.<br/>Satorisan recomienda usar <span>una talla más chico</span><br />que tu talle normal.<br/><br /><b>Te gustaría elegir TALLA <%next_size%>?</b><br/><div class='button yes'>SI</div><div class='button no'>NO</div>"; 

var DETAIL_SIZE_OUT_OF_STOCK = [];
DETAIL_SIZE_OUT_OF_STOCK["en"] = "<b>SIZE OUT OF STOCK</b>Wooops! sorry! this size is currently out of stock.<br />We´re working on having them back soon.<br /><b><a id='stock-alert-btn' >Tell me when it´s back again</a></b>";
DETAIL_SIZE_OUT_OF_STOCK["es"] = "<b>TALLA FUERA DE STOCK</b>¡Ooops! ¡Perdona! Esta talla no se encuentra en stock. Estamos trabajando para tenerla disponible en breve.<br /><b><a id='stock-alert-btn' >Avísame cuando vuelva a estar disponible</a></b>";


var FILTER_SIZE_TOOLTIP_HELP = [];
FILTER_SIZE_TOOLTIP_HELP["es"] = "Arrastra para filtrar por talla";
FILTER_SIZE_TOOLTIP_HELP["en"] = "Drag to filter by size";

var FILTER_SIZE_SYSTEM_TOOLTIP_HELP = [];
FILTER_SIZE_SYSTEM_TOOLTIP_HELP["es"] = "Cliquea para cambiar sistema";
FILTER_SIZE_SYSTEM_TOOLTIP_HELP["en"] = "Click to change type";

var FILTER_QUANTITY_TOTAL = 4;

var FILTER_SIZE_UNITS = [];
FILTER_SIZE_UNITS.length = 4;
FILTER_SIZE_UNITS ["EUR"] = ["", "36", "37" ,"38","39","40","41","42","43","44","45","46","47"];
FILTER_SIZE_UNITS ["USA"] = ["", "5", "5.5", "6", "6.5", "7", "8", "9","9.5","10","11","12","12.5"];
FILTER_SIZE_UNITS ["UK"] =  ["", "3","4", "5", "6","7", "7.5", "8","8.5","9.5","10.5","11.5","12.5"];
FILTER_SIZE_UNITS ["JP"] =  ["", "22",  "23", "24", "25", "26", "26.5", "27","27.5","28.5","29.5","30.5","31.5"];

var FILTER_COLORS_HEX = [ "#000000", "#7c521f", "#dc2e2d", "#ff9700","#f7fa09", "#7fca3c", "#3d889f", "#ef7aec", '#ffa3a3', '#979797', '#f3d9ac', "#fdfbfc" ];

var FILTER_PRICES_MIN = 0;
var FILTER_PRICES_MAX = 220;
var FILTER_PRICES_STEPS = 12;


var FILTER_TYPES_PRODUCTS = [];
FILTER_TYPES_PRODUCTS["zh_cn"] = ["服装", "鞋子", "包包", "化妆品"];
FILTER_TYPES_PRODUCTS["en"] = ["FOOTWEAR", "ACCESORIES"];
FILTER_TYPES_PRODUCTS["es"] = ["FOOTWEAR", "ACCESORIOS"];




/*----------------------------------------------------------------------------------*/
/* FAMILIES */
/*----------------------------------------------------------------------------------*/

var MODELOS_HOME =
{
	zh_cn: 
	{
		title: '款式',
		body: '请选择您钟意的款式.'
	},
	en: 
	{
		title: 'Models',
		body: 'Pick the model you like the most to see all its possibilities.'
	},
	es:
	{
		title: 'Modelos',
		body: 'Elije el modelo que más te guste para ver todas sus posibilidades.'
	}
};

var PRODUCTS_FAMILIES = [];

	PRODUCTS_FAMILIES["heisei"] = {
		title: {es:"Heisei", en:"Heisei"},
		description:{ 
					es:"‘Heisei’ quiere decir calma, serenidad y tranquilidad en japonés. También es el nombre de la era histórica actual de Japón. ¿Sabías que con la muerte de cada emperador japonés empieza una nueva era? Nuestra actitud Satori nos hace entender la era Heisei como un deseo por conseguir calma y tranquilidad en el mundo. El nombre viene de dos libros chinos de historia y filosofía, donde quería decir ‘paz en todos lados’.<br/>Nuestro Heisei tiene líneas de un modelo deportivo clásico. Cómodo y fácil de llevar.", 
					en:"‘Heisei’ means calm, serenity and tranquility in Japanese. It is also the name given to the current historic era in Japan. Did you know that a new era starts with the death of each Japanese emperor? Our Satori attitude makes us understand the Heisei era as a desire to bring calmness and tranquility into the world. The name was taken from two Chinese history and philosophy books and is intended to mean ‘peace everywhere’.<br/>Our Heisei model has the outlines of a sporty classic. It’s easygoing as well as nimble." },
		image:"/media/catalog/product/h/e/heiseisuederosewood000.png"
	}

	PRODUCTS_FAMILIES["yasuragi"] = {
		title: {es:"Yasuragi", en:"Yasuragi"},
		description:{ 
					es:"‘Yasuragi’ quiere decir tranquilidad en japonés. Podríamos decir que se refiere a la ausencia de estrés mental. El camino para conseguir serenidad interior es sencillo y complejo a la vez. Una vez tu mente está libre de preocupación, eres libre. Podemos sentirnos así en cualquier momento, en cualquier parte del mundo, sólo parándonos un momento y encontrando nuestro equilibrio en el presente. Nuestro modelo Yasuragi es una botita de inspiración retro, perfecta para cualquier ocasión.", 
					en:"‘Yasuragi’ means peace of mind and tranquility in Japanese. It stands for the absence of mental stress. The path to achieve serenity of the mind is simple and complex at the same time. Once your mind is empty of worry, you are free. We can find this feeling at any moment, in any part of the world, just by stopping for a moment and finding our balance in the now. The model named Yasuragi is a mid-top sneaker with a retro inspiration that makes it perfect for every occasion. " },
		image:"/media/catalog/product/y/a/yasuraginapablack000.png"
	}

	PRODUCTS_FAMILIES["koa"] = {
		title: {es:"Koa", en:"Koa"},
		description:{ 
					es:"‘Koa’ quiere decir felicidad, alegría y euforia en maorí. También tiene un significado en hawaiiano, para ellos quiere decir  intrépido, valiente y audaz. Si mezclamos ambas significados obtenemos nuestra propia versión Satori: ser lo suficientemente valiente para ser feliz.<br/>Nuestro modelo Koa está inspirado en el elegante estilo británico. Combina una actitud deportiva con los refinados elementos decorativos de unos clásicos zapatos de cordones.", 
					en:"‘Koa’ means happiness, joyfulness and euphoria in Maori. It also has a meaning in the Hawaiian language, where it means brave, bold and fearless. If we mix both denotations, we get our very own Satori meaning: being brave enough to be happy.<br/>Our Koa model was inspired by the dapper style of British men. It combines a sporty attitude with the elegant decorative elements of classic wingtips." },
		image:"/media/catalog/product/k/o/koasmoothiron000.png"
	}

	PRODUCTS_FAMILIES["sachi"] = {
		title: {es:"Sachi", en:"Sachi"},
		description:{ 
					es:"‘Sachi’ quiere decir felicidad y fortuna en japonés. Para nosotros, aquellos que son capaces de vivir felices son los más afortunados. Sabios de todo el mundo están de acuerdo en que cuando aprecias cada momento como viene, sin juicios, la felicidad será tuya. Ese es el espíritu Sachi.<br/>La botita con este nombre es fácil de llevar y tiene una actitud deportiva combinada con los refinados elementos decorativos de unos clásicos zapatos de cordones.", 
					en:"‘Sachi’ means happiness and fortune in Japanese. To us, those who are able to live in happiness are the most fortunate ones. Sages all over the world say the same thing: When you appreciate every moment as it comes, without judgment, happiness will be yours. That’s the Sachi spirit.<br/>The mid-top Sachi boot combines an easygoing, sporty attitude with the elegant decorative elements of classic wingtips." },
		image:"/media/catalog/product/s/a/sachismoothsnapper000.png"
	}

	PRODUCTS_FAMILIES["araku"] = {
		title: {es:"Araku", en:"Araku"},
		description:{ 
					es:"‘Araku’ quiere decir caminar en japonés. También es un valle indio en Andra Pradesh, uno de los sitios más puros y menos visitados en India. Parece paradójico: un verbo japonés que habla de movimiento y a la vez el nombre de uno de los sitios más tranquilos de India. Pero para un corazón Satori esto no es una coincidencia, es más bien uno de los guiños del mundo para aquellos que están atentos.<br/>La bota Araku es única en su especie. Es cómoda y fácil de llevar, una verdadera bota ‘todo en uno’.", 
					en:"‘Araku’ means to walk in Japanese. It is also an Indian Valley in Andra Pradesh, one of the purest and least visited places in India. It seems paradoxical: a Japanese verb that talks about moving is also the name of one of the most serene places in India. But to a Satori mindset and heart, this is not a coincidence, it is one of the world’s winks to those who are aware.<br/>Our Araku high boot is one of a kind. It’s bold as well as nimble, a real do-it-all boot." },
		image:"/media/catalog/product/a/r/arakusmoothcuero000.png"
	}

	PRODUCTS_FAMILIES["etoku"] = {
		title: {es:"Etoku", en:"Etoku"},
		description:{ 
					es:"‘Etoku’ quiere decir entendimiento en japonés, la clase de entendimiento completo, 360 grados, del mundo. Esos momentos únicos en los que todo parece tener sentido. No se trata de conocimiento, es más bien intuición. Es ese tipo de experiencias que todos querríamos tener al menos una vez; puede durar toda la vida y te convierte en una persona más sabia y completa. Nuestro modelo Etoku, una bota minimalista, nación de la comprensión de que la belleza estriba en la imperfección.", 
					en:"‘Etoku’ means understanding in Japanese – the type of full, 360-degree understanding of the world. These rare moments when everything seems to makes sense. Not through knowing, more through intuition, insight. It’s the type of experience that we all would like to have at least once; it can last for a lifetime and it makes you wiser and richer as a person. Our Etoku model, a minimalist ankle boot, was born from the understanding that beauty lies in imperfection." },
		image:"/media/catalog/product/e/t/etokusmoothiron000.png"
	}

	PRODUCTS_FAMILIES["wanaka"] = {
		title: {es:"Wanaka", en:"Wanaka"},
		description:{ 
					es:"‘Wanaka’ es un resort de nieve en Nueva Zelanda, junto a un tranquilo lago con el mismo nombre. Snowboardear allí es increíble; puedes disfrutar de fuera pistas con espectaculares vistas al lago o aventurarte en las montañas de alrededor.<br/>Este modelo, inspirado en funcionalidad del calzado de trabajo, transmite una sencillez atemporal. Viene con nuestra nueva suela 4x4 para climas fríos, especialmente desarrollada para aislar del frío y tiene un buen agarre tanto en superficies secas como en mojadas o con hielo.", 
					en:"‘Wanaka’ is a snow resort in New Zealand situated by the tranquil Lake Wanaka. Snowboarding here is amazing, as the resort lends itself to off-piste riding with spectacular views of the lake. You can even venture into the surrounding mountains.<br/>Our Wanaka ankle boot is all about timeless simplicity. The design was inspired by the functionality of workwear. It comes with our new 4WD cold climate sole, which was especially developed to insulate from the cold and for great grip on dry, wet or icy surfaces." },
		image:"/media/catalog/product/w/a/wanakaastexcognac000.png"
	}

	PRODUCTS_FAMILIES["waraku"] = {
		title: {es:"Waraku", en:"Waraku"},
		description:{ 
					es:"‘Waraku’ significa paz y armonía en japonés. La palabra está compuesta por dos caracteres kanji; 和 (wa) que quiere decir harmonía y 楽 (raku) que es confort. El confort es muy importante para nosotros porque supone el primer paso para que disfrutes tus Satori.<br/>Waraku es una bota tan cómoda como una zapa. Lleva un forro 100% lana y nuestra nueva suela 4x4 para climas fríos, especialmente desarrollada para aislar del frío y tiene un buen agarre tanto en superficies secas como en mojadas o con hielo.", 
					en:"‘Waraku’ means peace and harmony in Japanese. The word consists of two kanji characters; 和 (wa) meaning harmony and 楽 (raku) meaning comfort. As comfort is the first step in really enjoying your Satori shoes, it is important to us.<br/>Waraku looks like a boot but wears like a sneaker. It’s a super functional model with a 100% wool lining and comes with our new 4WD cold climate sole, which was especially developed to insulate from the cold and for great grip on dry, wet or icy surfaces." },
		image:"/media/catalog/product/w/a/warakuastexiron000.png"
	}

	PRODUCTS_FAMILIES["heiwa"] = {
		title: {es:"Heiwa", en:"Heiwa"},
		description:{ 
					es:"‘Heiwa’ es una palabra japonesa que significa paz o armonía. Está compuesta por el kanji平 (hei) que es paz y uniformidad, y por和 (wa) que quiere decir paz y armonía. Creemos que hay una extrema belleza en las cosas sencillas y de eso trata este modelo. Heiwa es nuestra interpretación de un clásico wallaby hecho de serraje de gran calidad con un acabado a la cera.", 
					en:"‘Heiwa’ is a Japanese word that means peace or harmony. It is composed of the kanji 平 (hei) meaning peace, flat, even and 和 (wa) meaning peace, harmony. There is real beauty in extremely simple things and that’s what heiwa is all about. The Heiwa is our take on a classic wallaby and is made of top-quality suede that was given a waxy treatment." },
		image:"/media/catalog/product/w/a/waitomo000.png"
	}

	PRODUCTS_FAMILIES["kugenuma"] = {
		title: {es:"Kugenuma", en:"Kugenuma"},
		description:{ 
					es:"Es un botín de talle alto con un espíritu rústico y artesanal hecho con lino natural. Este modelo fue inspirado por KUGENUMA, una conocida playa surfera de Japón.<br/>¡Las zapas perfectas para los corazones intrépidos!", 
					en:"It is a high-top sneaker with a rustic and artisan spirit made with natural linen. This model was inspired by KUGENUMA, a well-known Japanese surfer beach.<br/>The perfect sneakers for daring hearts!" },
		image:"/media/catalog/product/k/u/kugenumalinenjeans000_1.png"
	}

	PRODUCTS_FAMILIES["kioku"] = {
		title: {es:"Kioku", en:"Kioku"},
		description:{ 
					es:"Es una interpretación de estilo rústico del clásico zapato de cordones. Un diseño único, caracterizado<br/>por su look artesanal y desgastado. Su nombre, KIOKU, significa equilibrio en japonés.<br/>¡Una buena opción para los más bohemios!", 
					en:"It is a rustic interpretation of a classic shoe with laces. A unique design, characterized<br/>by its artisan and worn down look. Its name, KIOKU, means equilibrium and balance in Japanese.<br/>A good choice for people with a bohemian nature!" },
		image:"/media/catalog/product/k/i/kiokuvaquerowinewood000.png"
	}

	PRODUCTS_FAMILIES["antai"] = {
		title: {es:"Antai", en:"Antai"},
		description:{ 
					es:"La palabara japonesa ‘Antai’ se traduce como paz, serenidad, seguridad y tranquilidad. También es un pequeño asentamiento con exactamente 163 habitantes en Marakei, un atolón en el Océano Pacífico. Un destino único que ha sabido mantener su pureza y serenidad.<br/>El modelo Antai es la versión de invierno del modelo de primavera/verano con el mismo nombre. Un diseño sencillo y especial con los mejores materiales. Sale de la caja con un look desgastado y la piel envejece de una forma preciosa.", 
					en:"The Japanese word ‘Antai’ translates as peace, serenity, security and tranquility. It’s also a tiny settlement with exactly 163 inhabitants on the Marakei atoll in the Pacific Ocean. A unique destination that has retained its pureness and serenity.<br/>The Antai is the winter version of the spring/summer model of the same name.  Effortless simplicity and the best materials are what this shoe is about. The Antai comes out of the box with a worn look and will only grow more beautiful the more it is worn." },
		image:"/media/catalog/product/a/n/antaivaqueroblack000.png"
	}

	PRODUCTS_FAMILIES["tagomago"] = {
		title: {es:"Tagomago", en:"Tagomago"},
		description:{ 
					es:"El islote de ‘Tagomago’, situado al nordeste de la costa ibicenca, dio nombre  a este modelo. Es un lugar que nos encanta y siempre nos inspira, por la magia y tranquilidad de los paisajes que posee tanto arriba como bajo el agua.<br/>El modelo Tagomago está hecho de piel de altísima calidad y bien con nuestro característico cerco de cuero.  Lo consideramos nuestra bota arquetípica. Sale de la caja con un look desgastado y la piel envejece de una forma preciosa.", 
					en:"The islet of ‘Tagomago’, located on the north-eastern coast of Ibiza, gave its name to this model. This place does never fail to inspire and enchant us with the magic and quietness of the sceneries above and under the water.<br/>The Tagomago is made of premium leather and comes with our characteristic leather welt construction. We consider it our archetypical premium high top. It comes out of the box with a worn look and will only grow more beautiful the more it is worn." },
		image:"/media/catalog/product/t/a/tagomagovaquerocuero000.png"
	}

	/*
	PRODUCTS_FAMILIES["niko-niko"] = {
		title: {es:"Niko Niko", en:"Niko Niko"},
		description:{ 
					es:"‘Niko niko’ quiere decir felizmente o con una sonrisa en japonés. Aquellos que sonríen al mundo irán por él con felicidad en sus corazones. Si compartes el punto de vista Sarorisan, entenderás lo que queremos decir. Sonríe, sonríe y sonríe, porque la felicidad no es una meta, es el camino.<br/>Esta botita mezcla una actitud deportiva con una elegancia clásica y detalles modernos. Incluye detalles de los clásicos brogue y flecos en el talon.", 
					en:"‘Niko niko’ means happily, with a smile in Japanese. Those who smile to the world will go through it with happiness in their hearts. If you share the Satorisan point of view, you will understand what we mean. Smile, smile and smile, because happiness is not a goal, it’s the journey.<br/>This mid top blends a sporty attitude with classic elegance and some funky details. It features the elegant decorative elements of brogues, classic wingtips and leather fringes at the back." },
		image:"/media/catalog/product/k/o/koasmoothbrown000.png"
	}
	*/
	/*
	PRODUCTS_FAMILIES["davos"] = {
		title: {es:"Davos", en:"Davos"},
		description:{ 
					es:"‘Davos’ es un alucinante resort de nieve en Suiza. En él encontrarás impresionantes vistas, pendientes, funparks y toneladas de nieve polvo. El snowboard nos hace sentir libres y felices, por eso quisimos llamar a este modelo como este increíble lugar.<br/>Este modelo es un zapato con un corazón sencillo. Inspirado por la funcionalidad del calzado de trabajo, no necesita alardear. Viene con nuestra nueva suela 4x4 para climas fríos, que ha sido especialmente desarrollada para aislar del frío y tiene un buen agarre tanto en superficies secas como en mojadas o con hielo.", 
					en:"‘Davos’ is an amazing snow resort in Switzerland. You’ll find impressive views, slopes, funparks and tons of deep powder. Snowboarding makes us feel free and happy, so we named this model after this wonderful place.<br/>Our Davos model is a shoe with simplicity at its heart. Inspired by the functionality of workwear it doesn’t need to show off. It comes with our new 4WD cold climate sole, which was especially developed to insulate from the cold and for great grip on dry, wet or icy surfaces." },
		image:"/media/catalog/product/a/r/arakusmoothcuero000.png"
	}
	*/
	/*
	PRODUCTS_FAMILIES["waraku-special-edition"] = {
		title: {es:"Waraku Special Edition", en:"Waraku Special Edition"},
		description:{ 
					es:"‘Waraku’ quiere decir paz y armonía en japonés; 和 (wa) es armonía y 楽 (raku) confort. El confort es muy importante para nosotros porque te hace disfrutar de tus Satori.<br/>Esta edición especial lleva nuestro cerco de cuero, forro de piel de oveja y Bokhara, una piel premium de antílopes salvajes de 2,6mm. Es transpirable y mantendrá tus pies calientes incluso a -15ºC (5ºF). Lleva nuestra nueva suela para climas fríos, desarrollada para aislar del frío y tener buen agarre en superficies mojadas o con hielo.", 
					en:" ‘Waraku’ means peace and harmony in Japanese: 和 (wa) meaning harmony and 楽 (raku) meaning comfort. As comfort is the first step in really enjoying your Satori shoes, it is important to us.<br/>This special edition comes with Satorisan’s own leather welt construction and a two-sided sheepskin lining and is made of Bokhara: 2,6mm highest-quality leather from wild antelopes. This warm and breathable boot will keep your feet warm, even at -15°C (5ºF). It comes with our new 4WD cold climate sole, which was especially developed to insulate from the cold and for great grip on dry, wet or icy surfaces." },
		image:"/media/catalog/product/w/a/warakuastexiron000.png"
	}
	*/


	

	































/*----------------------------------------------------------------------------------*/
/* CHECK EXIST DATA */
/*----------------------------------------------------------------------------------*/

function logout()
{
    $.ajax({
          cache: true,
          url: "/website/webservices/logout.php",
          contentType: "application/x-www-form-urlencoded;charset=UTF-8",
          success: function(data_json) {
            document.location = "/";
          }
     });
 }

/*----------------------------------------------------------------------------------*/
/* CHECK EXIST DATA */
/*----------------------------------------------------------------------------------*/

function checkExist(_condition)
{
    if (String(_condition) !== undefined) return _condition;
}

/*----------------------------------------------------------------------------------*/
/* REG EX TO EXTRACT BODY */
/*----------------------------------------------------------------------------------*/

var SUBSTRACT_BODY_PATTERN = /<body[^>]*>((.|[\n\r])*)<\/body>/im;

function extractBody(markup)
{
	return SUBSTRACT_BODY_PATTERN.exec(markup)[1];
}

/*----------------------------------------------------------------------------------*/
/* RENDER TEMPLATE */
/*----------------------------------------------------------------------------------*/

function renderEJS (template, _data)
{
	for (var o in _data)
	{
		var token = "<%" + o + "%>"
		template = template.split(token).join(_data[o]);
	}

	template = template.split("<%current_language%>").join(CURRENT_LANGUAGE);
	return template;
}


/*----------------------------------------------------------------------------------*/
/* GET A ATTRIBUTE BY INDEX */
/*----------------------------------------------------------------------------------*/

function getAttrByIndex(arr, index)
{
	var i=0;
	var r;
	for (var o in arr)
	{
		if (i==index)
		{
			r=o;
			break;
		}
		i++;
	}
	return r;
}

/*----------------------------------------------------------------------------------*/
/* GET CODE LOCALE */
/*----------------------------------------------------------------------------------*/

function getCodeLocale()
{
	var code = 'zh_cn';
	
	if (user.SHIPPING_REGION == "china" && CURRENT_LANGUAGE == "zh_cn")
	{
		code = "zh_cn";
	} 
	else if (user.SHIPPING_REGION == "spain" && CURRENT_LANGUAGE == "es")
	{
		code = "es";
	}
	else if (user.SHIPPING_REGION == "spain" && CURRENT_LANGUAGE == "en")
	{
		code = "en";
	}
	else if (user.SHIPPING_REGION == "international" && CURRENT_LANGUAGE == "es")
	{
		code = "es_in";	
	}
	else if (user.SHIPPING_REGION == "international" && CURRENT_LANGUAGE == "en")
	{
		code = "en_in";	
	}
	else if (user.SHIPPING_REGION == "europe" && CURRENT_LANGUAGE == "es")
	{
		code = "es_eu";	
	}
	else if (user.SHIPPING_REGION == "europe" && CURRENT_LANGUAGE == "en")
	{
		code = "en_eu";	
	}


	return code;
}

/*----------------------------------------------------------------------------------*/
/* RETURN NUMBER */
/*----------------------------------------------------------------------------------*/

function convertTextInNumber(_text)
{
	return Number(String(_text).replace(",", "."));
}


/*----------------------------------------------------------------------------------*/
/* TRIM TEXT */
/*----------------------------------------------------------------------------------*/

function trimText(text,numOfWords, wordCount ) {
	var stripTagsFromText = $("text").text();
	wordCount = stripTagsFromText.split(' ').length;
	//wordCount = text.trim().replace(/\s+/g, ' ').split(' ').length;
	if(numOfWords <= 0 || numOfWords === wordCount){
		return text;
	} else {
		text = text.trim().split(' ');
		text.splice(numOfWords, wordCount, '>CACHO');
		return text.join(' ');
	}
}

/*----------------------------------------------------------------------------------*/
/* SOCIAL UTILS */
/*----------------------------------------------------------------------------------*/

function parseTwitterDate(_date)
{
    var arrayDate = String(_date).split(" ");
    var nameDay = arrayDate[0];
    var nameMonth = arrayDate[1];
    var numberMonth = arrayDate[2];
    var hour = new Date();
    hour.setUTCHours( String(arrayDate[3]).split(":")[0] );
    hour.setUTCMinutes( String(arrayDate[3]).split(":")[2] );
    
    var year = arrayDate[5];

    var hh = hour.getHours();
    var m = hour.getMinutes();
    var f = "AM";

    if (hh>=12)
    {
        f = "PM";
        hh-=12;
    }

    return hh + ":" + m + " "+ f + " - " + numberMonth + " " + String(nameMonth).toUpperCase() + " " + year;
}

function parseFacebookDate(_date)
{
    var stringDate = String(_date).split("T")[0];
    var stringTime = String(_date).split("T")[1];
    var arrayDate = stringDate.split("-");
    var arrayTime = stringTime.split(":");
    var day = arrayDate[2];
    var month = arrayDate[1];
    var year = arrayDate[0];
    
    var hour = arrayTime[0];
    var minutes = arrayTime[1];

    var f = "AM";

    if (hour>=12)
    {
        f = "PM";
        hour-=12;
    }

    if (day<=Number(9)) day = "0" + Number(day);
    if (hour<=Number(9)) hour = "0" + Number(hour);
    if (minutes<=Number(9)) hour = "0" + Number(minutes);
    
    return hour + ":" + minutes + " "+ f + " - " + day + " " + String(DICTIONARY[CURRENT_LANGUAGE].months[Number(month)-1]).toUpperCase() + " " + year;
}


function processLinks(text) {
var exp = /(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/i;

text = text.replace(exp, "<a href='$1' target='_blank'>$1</a>");

exp = /(^|\s)#(\w+)/g;
text = text.replace(exp, "$1<a href='http://search.twitter.com/search?q=%23$2' target='_blank'>#$2</a>");
exp = /(^|\s)@(\w+)/g;
text = text.replace(exp, "$1<a href='http://www.twitter.com/$2' target='_blank'>@$2</a>");

return text;
}

/*----------------------------------------------------------------------------------*/
/* GET URL LEVEL */
/*----------------------------------------------------------------------------------*/

function getURLLevel(depth)
{
	var u = "";
	if (String(location.pathname).split("/") [depth+1]) u = String(location.pathname).split("/") [depth+1]; 
	return u;
}

/*----------------------------------------------------------------------------------*/
/* TRIM THE STRING FOR THE SELECTED COLLECTION FILTER */
/*----------------------------------------------------------------------------------*/

function trimCollectionString(_name)
{
	var name = String(_name);
	var finalName = "";

	if ( String(name).toLowerCase().indexOf("all ")!=-1 || String(name).toLowerCase().indexOf("todos")!=-1 )
	{
		finalName = DICTIONARY[CURRENT_LANGUAGE].all;
	}
	else
	{
		finalName = DICTIONARY[CURRENT_LANGUAGE]['new'];
	}

	return finalName;
}


/*----------------------------------------------------------------------------------*/
/* TWITTER STATUS SHARE PRODUCT
/*----------------------------------------------------------------------------------*/

function getProductStatusTwitter(productName)
{
	var text = DICTIONARY[CURRENT_LANGUAGE].product_twitter_share;
	text = text.replace("<%product_name%>", productName);
	return text;
}

/*----------------------------------------------------------------------------------*/
/* 
/*----------------------------------------------------------------------------------*/

function showAccountMenu(duration)
{
	$("#account-menu-wrapper").css("display","block")
	$("#account-menu-wrapper").animate( { "opacity" : 1 }, {duration:duration} );
}

function hideAccountMenu(duration)
{
	$("#account-menu-wrapper").animate( { "opacity" : 0 }, 
		{duration:duration, complete: function(){ $("#account-menu-wrapper").css("display","none") } } );
}


function ipadInputFix( x, y ) {
	if(x == undefined){ x = 0; }
	if(y == undefined){ y = 0; }
	//alert("blur")
    window.scrollTo(x, y);
}

/*----------------------------------------------------------------------------------*/
/* GET SHARE URL */
/*----------------------------------------------------------------------------------*/

function getShareURL()
{
	return document.location;
}

/*----------------------------------------------------------------------------------*/
/* GET SHARE URL */
/*----------------------------------------------------------------------------------*/

function translateColor(_color)
{
	var c = String(_color).toLowerCase();

	var colors = [];
	colors["amarillo"] = "yellow";
	colors["negro"] = "black";
	colors["marrón"] = "brown";
	colors["rojo"] = "red";
	colors["naranja"] = "orange";
	colors["azul"] = "blue";
	colors["morado"] = "purple";
	colors["blanco"] = "white";
	colors["verde"] = "green";
	colors.length = 9;

	for (var i=0; i<colors.length; i++)
	{
		if (colors[_color])
		{
			c = colors[_color];
		}
	}

	return c;
	
}



function getURLParameters() {
  var searchString = window.location.search.substring(1)
    , params = searchString.split("&")
    , hash = {}
    ;

  for (var i = 0; i < params.length; i++) {
    var val = params[i].split("=");
    hash[unescape(val[0])] = unescape(val[1]);
  }
  return hash;
}



var Tooltip;

(function($)
{
	var checked3D = false;
	var use3D;
	function has3d()
	{
		var el = document.createElement('p'), 
			has3d,
			transforms = {
				'webkitTransform':'-webkit-transform',
				'OTransform':'-o-transform',
				'msTransform':'-ms-transform',
				'MozTransform':'-moz-transform',
				'transform':'transform'
			};

		// Add it to the body to get the computed style.
		document.body.insertBefore(el, null);

		for (var t in transforms) {
			if (el.style[t] !== undefined) {
				el.style[t] = "translate3d(1px,1px,1px)";
				has3d = window.getComputedStyle(el).getPropertyValue(transforms[t]);
			}
		}

		document.body.removeChild(el);

		return (has3d !== undefined && has3d.length > 0 && has3d !== "none");
	}
	
	Tooltip = function(data)
	{
		if (!checked3D)
		{
			use3D = has3d();
			checked3D = true;
		}
		var $tooltip;
		var $target = $( data.target );
		var markup = data.markup;
		var exitMode = data.exitMode;
		var $overlay = $("#overlay")
		var DELAY = 3500;
		var offsetX = 0;
		var offsetY = 0;
		var $this;
		var enterMode=false;
		var onComplete;
		var myYPosition;
		var className="";
		var dialogValue=0;
		var dialogCallback;
		var random = Math.round(Math.random()*100000);
		var isUpdate = false;
		var bottomMode = false;

		if (data.className) className = data.className;
		if (data.onComplete) onComplete = data.onComplete;
		if (data.offsetY) offsetY = data.offsetY;
		if (data.offsetX) offsetX = data.offsetX;
		if (data.enterMode) enterMode = true;
		if (data.dialogCallback) dialogCallback = data.dialogCallback;
		if (data.bottomMode) bottomMode = data.bottomMode;

		if (data.exitTime) DELAY = data.exitTime;

		var timeout;
		
		function open()
		{
			var hideTimeout = $tooltip.data('hideTimeout');
			if (hideTimeout) clearTimeout(hideTimeout);
			$tooltip.css({display: 'block'});
						
			if (!use3D)
			$tooltip.stop(true).animate({opacity: 1}, { duration: 300, specialEasing: {opacity: 'easeInOutCubic'}});
			else
			$tooltip.stop(true).transition({opacity: 1, transform: 'perspective(500px) rotateX(0) scale(1)', duration: 250, easing: 'cubic-bezier(.5,0,.5,1)'});
		}
		
		function close()
		{
			if (!use3D)
			{
				$tooltip.stop(true).animate({opacity: 0}, { duration: 300, specialEasing: {opacity: 'easeInOutCubic'}, complete: function()
				{
					$tooltip.css({display: 'none'});
				}});
			}
			else
			{
				$tooltip.stop(true).css({transform: 'perspective(500px) rotateX(-0.01deg) scale(1)'}).transition({opacity: 0, transform: 'perspective(500px) rotateX(-90deg) scale(.5)', duration: 300, easing: 'cubic-bezier(.5,0,.5,1)'});
				$tooltip.data('hideTimeout', setTimeout(function(){ $tooltip.css({display: 'none'}); }, 320));
			}
		}

		/*----------------------------------------*/

		this.append = function()
		{
			$this = this;
			
			var tooltipMarkup = "<div class='tooltip " + className + " r-"+random+"'><div class='text'>" + markup + "</div><div class='tooltip-arrow'></div></div>";
			
			if (bottomMode)
			{
				tooltipMarkup = "<div class='tooltip " + className + " r-"+random+"'><div class='tooltip-arrow-top'></div><div class='text'>" + markup + "</div></div>";
			}

			$target.parent().append(tooltipMarkup);
			$tooltip = $target.parent().find(".tooltip.r-"+random);
			
			$tooltip.css({opacity: 0});
			if (use3D)
			{
				$tooltip.css({transformOrigin: '50% 82%'});
				$tooltip.css({transform: 'perspective(500px) rotateX(-90deg) scale(.5)'});
			}
			
			this.render();

			open();
			$target.bind(MOUSE_DOWN_EVENT, $this.stop);
			
			

			if (exitMode == "delay")
			{
				timeout = setTimeout(this.stop, DELAY);
			}



			if (exitMode == "delayButWait")
			{
				timeout = setTimeout(this.stop, DELAY);
				$target.bind(MOUSE_LEAVE, $this.tooltipMouseLeave);
				$tooltip.bind(MOUSE_LEAVE, $this.tooltipMouseLeave);
				$tooltip.bind(MOUSE_ENTER, $this.clearTimeout);
			}

			if (enterMode)
			{
				$target.bind(MOUSE_LEAVE, $this.tooltipMouseLeave);
				$tooltip.bind(MOUSE_LEAVE, $this.tooltipMouseLeave);
				$tooltip.bind(MOUSE_ENTER, $this.clearTimeout);
			}

			$tooltip.find(".button").bind(CLICK_EVENT, this.clickButton);
		}

		/*----------------------------------------*/

		this.clickButton = function()
		{
			if ($(this).hasClass("yes"))
			{
				dialogValue = 1;
			}
			else
			{
				dialogValue = 0;
			}

			$this.stop();
			$this.dialogCallbackFunction (dialogValue);
		}

		/*----------------------------------------*/

		this.dialogCallbackFunction = function(dialogValue)
		{
			if (dialogCallback)
			{
				dialogCallback(dialogValue);
			}
		}

		/*----------------------------------------*/

		this.onCompleteCallback = function()
		{
			if (onComplete) onComplete();
		}


		/*----------------------------------------*/

		this.clearTimeout = function()
		{
			$tooltip.stop();
			open();
			clearTimeout(timeout);
		}

		/*----------------------------------------*/

		this.tooltipMouseLeave = function()
		{
			clearTimeout(timeout);
			timeout = setTimeout($this.stop, 500);
		}

		/*----------------------------------------*/

		this.reactive = function()
		{
			open();
			clearTimeout(timeout);
		}

		/*----------------------------------------*/

		this.stop = function()
		{
			if ($tooltip)
			{
				close();
				$tooltip.unbind(MOUSE_DOWN_EVENT, this.stop);
				$target.unbind(MOUSE_LEAVE, $this.tooltipMouseLeave);
				$tooltip.unbind(MOUSE_LEAVE, $this.tooltipMouseLeave);
				$tooltip.unbind(MOUSE_ENTER, $this.clearTimeout);
				
				setTimeout(function(){
					$tooltip.remove();					
				},300);
				
				$this.onCompleteCallback();
			}
		}
		
		/*----------------------------------------*/

		this.render = function()
		{
			if ($target)
			{
				if ($target.position())
				{
					myYPosition = offsetY + $target.position().top - $tooltip.height() - 10;
				}
				else
				{
					myYPosition  = - $tooltip.height() - 10 + offsetY;
				}
							
				var myXPosition;	
				
				if ($target.position().left)
				{
					myXPosition = $target.position().left;
				}
				else
				{
					myXPosition = $target.offset().left;	
				}

				if (bottomMode) myYPosition += 100;

				

				$tooltip.css( { left:offsetX + myXPosition + (($target.width()/2) - ($tooltip.width() / 2)) -  + 36, top: myYPosition});
				
			}
		}

		/*----------------------------------------*/

		this.append();
	}
})
(jQuery)
Hydra.module.register( 'page-campaign-ss13', function( bus ){ 
        
        var initTimeout,filesToLoad,markup,$container,endOffsetY,isPhotosLoaded,timeout,isDelayLegend,startOffsetY,endOffsetX,startOffsetX,$wrapper,$this,$prev,$next,callbackNextSection,$gride,$photo,$photoContainer,$hotspots,$description,currentMode,noise,video,
        dayTouched=0,touching = false, isInAnimationNext=false, isInitPreloadOK=false,isPressing=false,isInitTimeoutOK=false,timeoutPress,isCSSTransform=false,isAlive=false,PAGE_BODY_SELECTOR = "campaign", isActive=false, currentDay=0, currentHotspot=0, MAX_OFFSET_DRAG = 2, imagesLoaded=new Array(),isResume=false,isTransition=false;

        return {
            
            /*-------------------------------*/
            /* PAGE CAMPAIGN */
            /*-------------------------------*/            

            init: function(){
                $this = this;
                bus.subscribe('satorisan', this);
            },
            
            /*-------------------------------*/

            oEventsCallbacks: {
                'append-page' : function (data) {                    
                    
                    if (isActive == false)
                    {
                        if (data.content == "campaign-ss13")
                        {                            
                            isInAnimationNext = false;
                            isPressing = false;
                            isActive = true;
                            isAlive = true;
                            currentDay = 0;
                            bus.publish("satorisan", "ganalytics-track-path");
                            this.create();
                        }
                    }

                },
                
                'transition-out' : function(data)
                {
                    if (isActive && data.type=="campaign-ss13")
                    {
                        //$(document).unbind("mouseup");
                        //$(document).unbind("mousedown");
                        if($hotspots) $hotspots.unbind("mousedown");
                        $(document).unbind("mouseup", $this.documentMouseUp)
                        $document.unbind('touchmove', $this.touchmoveHandler);
                        $document.unbind('touchend', $this.touchendHandler);

                        if ($photo) $photo.bind('swipeup', $this.showGride);

                        // iscroll destruir
						$("#gride-container-scroll").iOSScrollSatorisan('destroy');

                        $container.find(".photo-section").unbind("swipeleft");      
                        $container.find(".photo-section").unbind('swiperight');

                        $window.unbind("resize", $this.resize);

                        $wrapper.unbind(MOUSE_DOWN_EVENT, this.startMouseDown);
                        $wrapper.unbind(MOUSE_UP_EVENT, this.stopMouseDown);
                        isActive = false;                        

                        if (timeout) clearTimeout (timeout);

                        isAlive = false;
                        if (currentMode == "intro")
                        {
                            var swP = false;
                            if ($container.find(".campaign-intro").length>0)
                            {
                                swP = true;
                                $container.find(".campaign-intro").animate( { opacity:0 }, {duration:350, complete:data.complete} );
                            }

                            if ($container.find(".campaign-text-intro").length>0)
                            {
                                swP = true;
                                $container.find(".campaign-text-intro").animate( { opacity:0 }, {duration:350, complete:data.complete} );
                            }
                            
                            if (swP == false)
                            {
                                data.complete();
                            }

                            $body.removeClass(PAGE_BODY_SELECTOR);
                        }

                        if (currentMode == "legend")
                        {
                            $container.find(".legend .day").animate( {marginTop:60}, {duration:250} );
                            $container.find(".legend .body").animate( {marginTop:-100}, {duration:350, complete:function(){
                                $container.find(".legend .line").css( {width:0} );
                                $container.find(".legend .line-grey").css( {width:0, complete:data.complete} );
                            } } );
                            $body.removeClass(PAGE_BODY_SELECTOR);
                        }

                        if (currentMode == "satorivision")
                        {
                            $container.find(".campaign-intro").animate( { opacity:0 }, {duration:350, complete:data.complete} );
                            $body.removeClass(PAGE_BODY_SELECTOR);
                        }

                        if (currentMode == "photo")
                        {
                            if ($hotspots)
                            {
                                if ($hotspots.length > 0)
                                {
                                    $hotspots.each(function(){
                                        $(this).animate( { top:$(this).position().top + 15, opacity:0}, {duration:200} );
                                    });
                                }
                            }
                            
                            if (noise)
                            {
                                noise.stop();
                                noise = null;
                            }
                            
                            $gride.animate ({ bottom:-6 }, {duration:250});
                            $prev.animate ({ left:-57 }, {duration:250});
                            $next.animate ({ right:-57 }, {duration:250, complete:function(){                                
                                $gride.hide();
                                $('.image-mask:last').removeClass("animation").animate( { height:0, top:($window.height()/2) - 35 }, {duration:350, complete:function(){
                                    $body.removeClass(PAGE_BODY_SELECTOR);
                                    data.complete();
                                }});    
                            }});

                        }

                        if (currentMode == "video")
                        {
                            if ($container.find(".photo-section").length > 0) $container.find(".photo-section").remove();
                            $container.find(".box-description").css( {"overflow":"hidden"} ).animate( { height:0 }, {duration:200});
                            $container.find(".campaign-video-description").css( {"overflow":"hidden"} ).animate( { top:$window.height()/2,height:0 }, {duration:450, complete:function(){
                                if (video) video.destroy();
                                $(".photo-container").children().filter("video").each(function(){
                                    this.pause();
                                    delete(this);
                                    $(this).empty();
                                    $(this).remove();
                                });
                                data.complete();
                            }});   
                            $body.removeClass(PAGE_BODY_SELECTOR);
                        }

                        if (currentMode == "gride")
                        {
                            // iscroll destruir
							$("#gride-container-scroll").iOSScrollSatorisan('destroy');

                            var totalTime=0;
                            $(".gride-item").each(function(index){
                                $(this).delay(index*100).animate( { marginTop:50, opacity : 0 }, {duration : 150});
                                totalTime+=100;
                            });
                            $(".gride-logo").animate( { "opacity" : 0 }, {duration : 350} );   
                            timeout = setTimeout(function(){
                                $body.removeClass(PAGE_BODY_SELECTOR);
                                data.complete();
                            }, totalTime + 150);
                            
                        }
                    }
                },

                'pause-page' : function()
                {
                   isResume = true;
                   if (isActive)
                   {
                       if (currentMode == "intro")
                       {
                            clearTimeout(timeout);
                       }

                       if (currentMode == "satorivision")
                       {
                            clearTimeout(timeout);
                       }

                       if (currentMode == "legend")
                       {
                        
                       }

                       if (currentMode == "video")
                       {
                            video.pause();
                       }
                   }

                },

                'resume-page' : function()
                {
                   isResume = false;
                   if (isActive)
                   {
                       if (currentMode == "intro")
                       {
                            timeout = setTimeout($this.hideIntroText,CAMPAIGN.intro.delay);
                       }

                       if (currentMode == "satorivision")
                       {
                            timeout = setTimeout($this.hideIntro, 500);
                       }

                       if (currentMode == "legend")
                       {
                            timeout = setTimeout($this.destroyLegendDay, 500);
                       }

                       if (currentMode == "video")
                       {
                            video.resume();
                       }
                   }

                },

                'destroy-page' : function(data)
                {
                    if (isActive)
                    {
                        this.stop();
                        data.complete();
                    }
                }
            },

            /*-------------------------------*/

            create:function(){
                
                currentMode = "intro";

                $window.bind("resize", $this.resize);
                markup = "<div class='section-wrapper new-section " + PAGE_BODY_SELECTOR + " ss-13' style='top: 36px;'></div>"
                $content.append(markup);
                $wrapper = $(".section-wrapper");
                $container = $(".section-wrapper." + PAGE_BODY_SELECTOR);

                if (CURRENT_FLOOR == null)
                {
                    $this.startPreloading();
                    
                }
                else
                {
                    if (CURRENT_FLOOR == 0)
                    {
                        
                        bus.publish( 'satorisan', 'transition-page', { type: "SLIDE_BOTTOM", complete:function(){
                            if (user.COME_FROM_CAMPAIGN_DAY==-1)
                            {
                                $this.startPreloading();   
                            }
                            else
                            {
                                $this.createDescriptionAccess();
                            }
                        }});

                        CURRENT_FLOOR = 1;
                    }
                    else
                    {
                        if (user.COME_FROM_CAMPAIGN_DAY==-1)
                        {
                            $this.startPreloading();   
                        }
                        else
                        {
                            $this.createDescriptionAccess();
                        }
                    }
                }

                $body.addClass(PAGE_BODY_SELECTOR);
                $body.addClass("ss-13");
                bus.publish( 'satorisan', 'menu-change' );
            },

            /*-------------------------------*/

            startPreloading:function()
            {
                isInitTimeoutOK = false;
                initPreloadedOk = false;

                initTimeout = setTimeout($this.initTimeoutOk, 4500);
                bus.publish( 'satorisan', 'preloader-show', { 
                    header:"<div class='preloader-header-campaign'>Campaign</div>", 
                    footer:"<div class='preloader-footer-campaign'>" + CAMPAIGN.text_intro[CURRENT_LANGUAGE] + "<div class='campaign-image-preloader'></div></div>" 
                } );

                filesToLoad = [];
                //filesToLoad.push (CAMPAIGN.intro.logo);
                filesToLoad.push (CAMPAIGN.items[0].big_image_path);
                for ( var i=0; i<CAMPAIGN.items[0].hotpoints.length;i++)
                {
                    filesToLoad.push (CAMPAIGN.items[0].hotpoints[i].circle_image_path);
                }

                var callbackFunction = $this.createTextIntro;

                $.preload(filesToLoad, {

                    loaded_all:function(){

                        if (CURRENT_FLOOR == null)
                        {
                            if (user.HEADER_AND_FOOTER_CREATED == false)
                            {
                                Hydra.module.start("menu", 'menu_instance');
                                Hydra.module.start("footer", 'footer_instance'); 
                                bus.publish("satorisan", "menu-change-go", { data:"campaign" });
                                user.HEADER_AND_FOOTER_CREATED = true;
                            }

                            bus.publish( 'satorisan', 'history-update' );
                            timeout = setTimeout($this.initPreloadedOk, 350);
                        }
                        else
                        {
                            $this.initPreloadedOk();
                        }

                        CURRENT_FLOOR = 1;

                    },

                    loaded:function(img, loaded, total){
                        bus.publish( 'satorisan', 'preloader-update', { rate:(loaded/total)*100 });
                    }
                });
                
                
            },

            /*-------------------------------*/

            initTimeoutOk:function(){
                isInitTimeoutOK = true;
                
                if (isInitPreloadOK)
                {
                    $this.createLogoIntro();
                }
            },

            /*-------------------------------*/

            initPreloadedOk:function(){
                
                isInitPreloadOK = true;

                if (isInitTimeoutOK)
                {
                    $this.createLogoIntro();
                }
            },

            /*-------------------------------*/

            directAccess:function(){
                bus.publish( 'satorisan', 'preloader-hide', { complete:function(){
                    bus.publish( 'satorisan', 'menu-change' );
                    $this.createPhoto();
                } });                
            }, 

            /*-------------------------------*/

            createTextIntro:function(){
                currentMode = "intro";

                bus.publish( 'satorisan', 'preloader-hide', { complete:function(){
                    if (isResume == false)
                    {
                        $container.append("<div class='campaign-text-intro'><div class='title'>" + CAMPAIGN.text_intro[CURRENT_LANGUAGE] + "</div><div class='author'>" + CAMPAIGN.text_intro.author + "</div><div></div></div>");    
                        $container.find(".campaign-text-intro").css( { opacity: 0}).animate( { opacity:1 }, {duration:550} );
                        timeout = setTimeout($this.hideIntroText,350+CAMPAIGN.intro.delay)
                    }
                } } ); 
            },

            /*-------------------------------*/

            hideIntroText:function(){
                if (isResume==false)
                {
                    $container.find(".campaign-text-intro").animate( { opacity:0 }, {duration:350, complete:$this.createLogoIntro} );
                }
            },

            /*-------------------------------*/

            createLogoIntro:function(){
                currentMode = "satorivision";
                bus.publish( 'satorisan', 'preloader-hide', { complete:function(){

                    $container.find(".campaign-text-intro").remove();

                    //$container.append("<div class='campaign-intro'><div class='title'>" + CAMPAIGN.intro[CURRENT_LANGUAGE] + "</div><div><img src=" + CAMPAIGN.intro.logo + " /></div></div>");
                    $container.append("<div class='campaign-intro'><div class='title'>" + CAMPAIGN.intro[CURRENT_LANGUAGE] + "</div><div class='satorivision'>SATORIVISION</div></div>"); 


                    $container.find(".campaign-intro").css( { opacity: 0}).animate( { opacity:1 }, {duration:350} );
                    timeout = setTimeout($this.hideIntro,CAMPAIGN.intro.delay-1000);
                }});

            },

            /*-------------------------------*/

            hideIntro:function(){
                $container.find(".campaign-intro").animate( { opacity:0 }, {duration:350, complete:$this.createLegendDay} );
            },

            /*-------------------------------*/

            createLegendDay:function(){
                currentMode = "legend";
                
                bus.publish("satorisan", "ganalytics-track-event", { name: "CAMPAIGN - "+CURRENT_LANGUAGE+" - "+CAMPAIGN.items[currentDay].day[CURRENT_LANGUAGE] } );

                isPhotosLoaded = false;
                isDelayLegend = false;

                if ($container.find(".gride-section").length > 0) $container.find(".gride-section").remove();
                if ($container.find(".campaign-intro").length > 0) $container.find(".campaign-intro").remove();
                if ($container.find(".legend").length > 0) $container.find(".legend").remove();

                $container.append("<div class='legend'><div class='first-block'><div class='day'>" + CAMPAIGN.items[currentDay].day[CURRENT_LANGUAGE] + "</div><div class='time'>" + CAMPAIGN.items[currentDay].time[CURRENT_LANGUAGE] + "</div></div><div class='line-grey'></div><div class='line'></div><div class='second-block'><div class='body'>" + CAMPAIGN.items[currentDay].legend[CURRENT_LANGUAGE] + "</div></div></div>");
               
                
                $container.find(".legend .day").css( {marginTop:60} );
                $container.find(".legend .body").css( {marginTop:-100} );

                $container.find(".legend .line").css( {width:0} )
                $container.find(".legend .line-grey").css( {width:0} ).animate( { width:"100%"}, {duration:250, complete:function(){
                    $container.find(".legend .day").animate( {marginTop:0}, {duration:250} );
                        $container.find(".legend .body").animate( {marginTop:20}, {duration:350, complete:function(){

                            if (imagesLoaded[CAMPAIGN.items[currentDay].big_image_path] == true)
                            {
                                isDelayLegend = true;
                                $container.find(".legend .line").css( {width:0} ).animate( { width:"100%"}, {duration:CAMPAIGN.legend_delay, complete:$this.legendPhotoLoaded});
                            }
                            else
                            {                             
                                timeout = setTimeout($this.destroyLegendDay, CAMPAIGN.legend_delay);

                                var imagesToLoad = [];
                                imagesToLoad.push(CAMPAIGN.items[currentDay].big_image_path);

                                for (var i=0;i<CAMPAIGN.items[currentDay].hotpoints.length;i++)
                                {
                                    imagesToLoad.push(CAMPAIGN.items[currentDay].hotpoints[i].circle_image_path);
                                }
                                $.preload (imagesToLoad, {

                                    loaded:function(img, loaded, total){
                                        $container.find(".legend .line").animate( {width:((loaded/total)*100)+"%"}, {duration:150} );
                                    },

                                    loaded_all:$this.legendPhotoLoaded
                                });
                            }

                        }} );
                    
                }} );

                
                           

            },

            /*-------------------------------*/

            legendPhotoLoaded:function(){

                isPhotosLoaded = true;
                imagesLoaded[CAMPAIGN.items[currentDay].big_image_path] = true;

                if (isDelayLegend && isAlive && !isResume)
                {
                    $container.find(".legend .day").animate( {marginTop:60}, {duration:250} );
                    $container.find(".legend .body").animate( {marginTop:-100}, {duration:350, complete:$this.createPhoto } );
                }         
            },

            destroyLegendDay:function(){
                isDelayLegend = true;
                
                if (isPhotosLoaded && isAlive && !isResume)
                {
                    $container.find(".legend .day").animate( {marginTop:60}, {duration:250} );
                    $container.find(".legend .body").animate( {marginTop:-100}, {duration:350, complete:$this.createPhoto } );
                }
            },

            /*-------------------------------*/

            createPhotoAccess:function()
            {
                isInAnimationNext = true;
                isCSSTransform = true;
                isTransition = false;
                user.COME_FROM_CAMPAIGN_DAY = -1;
                user.COME_FROM_CAMPAIGN_HOTSPOT = -1; 
                $container.append("<div class='photo-section'><div class='photo-container'><div class='noise'></div><div class='image-bg'></div><div class='image-mask' style='position:absolute;background-attachment:fixed;background-image:url(" + CAMPAIGN.items[currentDay].big_image_path + "); top:0;height:100%;width:100%;'><!--img class='image-scale' src='" + CAMPAIGN.items[currentDay].big_image_path + "' /--></div></div><div class='arrows'><a class='left iconos normal-link'><span /></a><a class='right iconos normal-link'><span /></a></div><a class='gride iconos back normal-link'><span /></a><div class='hotspots'></div></div>");  
                $photoContainer = $('.photo-container');
                $('.photo-section').css( { "z-index" : 1 } );
                
                $prev = $(".arrows .left");
                $next = $(".arrows .right");
                $gride = $(".gride");

                $prev.css ({ left:-60 });
                $next.css ({ right:-60 });
                $gride.css ({ bottom:-35 });
                /*$gride.hide();*/

                $this.createSpots();

                $photo.unbind("swipeup").bind('swipeup', $this.showGride);
            },

            /*-------------------------------*/

            createPhoto:function()
            {
                isInAnimationNext = false;
                isTransition = false;
                isCSSTransform = false;
                user.LAST_CAMPAIGN_DAY = currentDay;
                if ($container.find(".legend").length > 0) $container.find(".legend").remove();
                currentMode = "photo";
                if ($container.find(".photo-section").length > 0) $container.find(".photo-section").remove();
                $container.append("<div class='photo-section'><div class='photo-container'><div class='noise'></div><div class='image-bg'></div><div class='image-mask' style='position:absolute;background-attachment:fixed;background-image:url(" + CAMPAIGN.items[currentDay].big_image_path + "); top:50%;height:0;width:100%;'><!--img class='image-scale' src='" + CAMPAIGN.items[currentDay].big_image_path + "' /--></div></div><div class='arrows'><a class='left iconos normal-link'><span /></a><a class='right iconos normal-link'><span /></a></div><a class='gride iconos back normal-link'><span /></a><div class='hotspots'></div></div>");
                $prev = $(".arrows .left");
                $next = $(".arrows .right");
                $gride = $(".gride");
                $prev.css ({ left:-60 });
                $next.css ({ right:-60 });
                $gride.css ({ bottom:-35 });
                $gride.hide();
                $this.resize();
                
                $photo = $(".photo-section .image-mask");

                
                if (Modernizr.csstransforms && !$.browser.msie)
                {
                    $('.image-mask').removeClass("animation").css ( {height:0, top:($window.height()/2)-35 });

                    setTimeout(function(){
                        $('.image-mask').addClass("animation").css ( { height:$window.height(), top:0 });
                        setTimeout($this.createNoise, 850);
                    },100)
                    
                }
                else
                {
                    $('.image-mask').css( { height:0, top:($window.height()/2)-35 }).animate( { height:$window.height(), top:0 }, {duration:850, complete:$this.createNoise } );
                }

                $photoContainer = $('.photo-container');
                bus.publish( 'satorisan', 'history-update' );

                $photo.unbind("swipeup").bind('swipeup', $this.showGride);
                
            },

            /*-------------------------------*/

            createNoise:function()
            {
                $this.createSpots();
            },

            /*-------------------------------*/

            createSpots:function()
            {
                if ($(".hotspot").length>0) $(".hotspot").remove();

                for (var i=0;i < CAMPAIGN.items[currentDay].hotpoints.length; i++)
                {
                    $(".hotspots").append( "<div class='hotspot' id='hotspot-"+i+"'><div class='item'></div><div class='circle' style='background:url("+CAMPAIGN.items[currentDay].hotpoints[i].circle_image_path+")'></div></div>" );
                }

                $hotspots = $(".hotspot");
                $this.resize();

                if (Modernizr.touch == false)
                {

                    $hotspots.unbind("mousedown").bind("mousedown", function(){
                        isPressing = true;
                    });

                    $(document).unbind("mouseup", $this.documentMouseUp).bind("mouseup", $this.documentMouseUp);

                    $hotspots.unbind(MOUSE_ENTER).bind(MOUSE_ENTER, function(){
                        $(this).addClass("showcircle");
                        $(".hotspot").css( { "z-index" : 1 });
                        $(this).css( { "z-index" : 2 });
                    });
                    $hotspots.unbind(MOUSE_LEAVE).bind(MOUSE_LEAVE, function(){
                        $(this).removeClass("showcircle");
                    });
                }

                $hotspots.unbind(CLICK_EVENT).bind(CLICK_EVENT, $this.createDescription);
                $hotspots.each(function(){
                    var p = $(this).position().top;
                    $(this).find(".item").transition ( {scale: [0, 1]}, 0 );
                    $(this).css( { top:p + 15, opacity:0} ).animate( {top:p, opacity:1}, {duration:250} );
                    $(this).find(".item").transition ( {scale: [1, 1]}, 350 );
                });                
                

                $this.createArrows();
            },

            /*-------------------------------*/

            documentMouseUp:function(){
                 clearTimeout(timeoutPress);
                        timeoutPress = setTimeout(function(){
                            isPressing = false;    
                        },150);
            },

            /*-------------------------------*/

            createArrows:function()
            {
                $prev.animate ({ left:0 }, {duration:250});
                $next.animate ({ right:0 }, {duration:250});
                $gride.show();
                $gride.animate ({ bottom:69 }, {duration:250});

                if (currentDay==0)
                {
                    $prev.addClass("disabled");
                }
                else
                {
                    $prev.removeClass("disabled");
                }

                if (currentDay == CAMPAIGN.items.length-1)
                {
                    $next.addClass("disabled");
                }
                else
                {
                    $next.removeClass("disabled");
                }

                $prev.unbind(CLICK_EVENT).bind(CLICK_EVENT, $this.gotoPrevPhoto);
                $next.unbind(CLICK_EVENT).bind(CLICK_EVENT, $this.gotoNextPhoto);
                $gride.unbind(CLICK_EVENT).bind(CLICK_EVENT, $this.showGride);
                isTransition = false;
               
                $container.find(".photo-section").unbind("swipeleft").bind('swipeleft', $this.gotoNextPhoto);
                $container.find(".photo-section").unbind('swiperight').bind('swiperight', $this.gotoPrevPhoto);
                
                
                $this.resizeSpots();

                $blocker.hide();
                
                if (user.COME_FROM_CAMPAIGN_HOTSPOT != -1)
                {
                    $this.createDescription();
                }

                bus.publish( 'satorisan', 'history-check-callback' );
                user.IS_IN_TRANSITION = false;
                
            },

            /*-------------------------------*/

            showGride:function()
            {

                 bus.publish("satorisan", "ganalytics-track-event", { name: "CAMPAIGN - GRID" } );

                $photo.unbind("swipeup", $this.showGride);

                currentMode = "gride";
                $blocker.show();
                var markup = "<div class='gride-section'><div id='gride-container-scroll' class='gride-container'><div id='scroller'><ul id='thelist'>"
                for ( var i=0; i<CAMPAIGN.items.length;i++)   
                {
                    markup += "<li class='gride-item'><div class='gride-day'>" + CAMPAIGN.items[i].day[CURRENT_LANGUAGE] + "</div><div class='gride-time'>" + CAMPAIGN.items[i].time[CURRENT_LANGUAGE] + "</div><div class='gride-thumb'><div class='campaign-hover'></div><img src='" + CAMPAIGN.items[i].thumb_image_path + "' /></div></li>";    
                }

                markup += "<li class='gride-item last'><div class='title'>" + CAMPAIGN.title[CURRENT_LANGUAGE] + "</div><div class='subtitle'>" + CAMPAIGN.subtitle[CURRENT_LANGUAGE] + "</div><div class='button'>" + CAMPAIGN.button[CURRENT_LANGUAGE] + "</div></li>";    

                //markup += "</ul></div></div></div><div class='gride-logo'><div class='title'>"+CAMPAIGN.intro[CURRENT_LANGUAGE]+"</div><br /><img src='" + CAMPAIGN.gride_logo + "' /></div>";
                markup += "</ul></div></div></div><div class='gride-logo'><div class='title'>"+CAMPAIGN.intro[CURRENT_LANGUAGE]+"</div><br /><div class='logo_satorivision_01'></div></div>";
                $container.append(markup);

                $(".gride-logo").css( { "opacity" : 0 } );

                var wrapperWidth = (CAMPAIGN.items.length+1) * 555;
                if (wrapperWidth < $window.width()) wrapperWidth = $window.width();
                

                $("#gride-container-scroll").css ( { width:$window.width()} );
                $(".gride-container #scroller").css ( { width : wrapperWidth } );

                $("#thelist").css( { "padding-top" : ($window.height()/2)-290, "padding-bottom" : ($window.height()/2)} );

				var $grideContainerScroll = $("#gride-container-scroll");
                $grideContainerScroll.css ( { width:$window.width(), height:$window.height()-$("#gride-container-scroll").height()} );
				
				// iscroll crear
				$grideContainerScroll.iOSScrollSatorisan();
				
    			DragCursor.open($grideContainerScroll, true);
				$grideContainerScroll.iOSScrollSatorisan('addListener', 'dragStart', function()
				{
					DragCursor.closed($grideContainerScroll, true);
				});
				$grideContainerScroll.iOSScrollSatorisan('addListener', 'dragStop', function()
				{
					DragCursor.open($grideContainerScroll, true);
				});

                $(".gride-item").unbind("touchstart").bind("touchstart", $this.touchstartHandler);

                $("#gride-container-scroll").hide();
                $gride.animate ({ bottom:-35 }, {duration:150, complete:function(){
                    $gride.hide();
                    $(".image-mask:last").removeClass("animation").css( { marginTop:-42, "background-attachment" : "inherit" } );
                    $(".photo-section").removeClass("animation").css( {"z-index" : 1}).animate( { top:0-$(".photo-section").height()}, {easing:"easeInOutSine", duration:850} );
                    $(".gride-section").css( {"z-index" : 2, "top" : $window.height()}).animate( { top:0}, {easing:"easeInOutSine", duration:850, complete:function(){
                        $(".photo-section").remove();
                        $this.preloadGrideImages();
                    }} ); 
                }});             
            },


            /*-------------------------------*/

            touchstartHandler:function(e)
            {
                if (!touching)
                {
                    e.preventDefault();
                    dayTouched = $(".gride-item").index($(this));    
                    startOffsetX = endOffsetX = e.originalEvent.touches[0].clientX;
                    startOffsetY = endOffsetY = e.originalEvent.touches[0].clientY;
                    $document.bind('touchmove', $this.touchmoveHandler);
                    $document.bind('touchend', $this.touchendHandler);
                    touching = true;
                }
            },
                    
                    
            touchmoveHandler:function (e)
            {
                e.preventDefault();
                endOffsetX = e.originalEvent.touches[0].clientX;
                endOffsetY = e.originalEvent.touches[0].clientY;
            },

            touchendHandler:function (e)
            {

                if (e.originalEvent.touches.length == 0)
                {                    
                     
                    $document.unbind('touchmove', $this.touchmoveHandler);
                    $document.unbind('touchend', $this.touchendHandler);
                    touching = false;
                    
                    if (Math.abs(startOffsetX - endOffsetX) < 5 && Math.abs(startOffsetY - endOffsetY) < 5)
                    {                        
                        
                        $document.unbind('touchmove', $this.touchmoveHandler);
                        $document.unbind('touchend', $this.touchendHandler);

                        $(".gride-logo").animate( { "opacity" : 0 }, {duration : 350} );
                        $(".gride-item").unbind(CLICK_EVENT);
                        if ($(this).hasClass("last") == false)
                        {
                            currentDay = dayTouched;
                        }
                        else
                        {
                            currentDay = 0;   
                        }
                        var totalTime=0;
                        $(".gride-item").each(function(index){
                            $(this).delay(index*100).animate( { marginTop:50, opacity : 0 }, {duration : 150});
                            totalTime+=100;
                        });

                        timeout = setTimeout($this.createLegendDay, totalTime + 150);                       
                    }

                }
                 
            },


            /*-------------------------------*/

            preloadGrideImages:function()
            {
                bus.publish( 'satorisan', 'preloader-show' );


                var imagesToLoad = [];
                for ( var i=0; i<CAMPAIGN.items.length;i++)
                {
                  imagesToLoad.push(CAMPAIGN.items[i].thumb_image_path);
                }

                $.preload ( imagesToLoad, {
                        
                        loaded:function(img, loaded, total){
                            bus.publish( 'satorisan', 'preloader-update', { rate:((loaded/total)*100) } );
                        },

                        loaded_all:function(){
                          $this.createScroll()  
                        }
                });
            },

            /*-------------------------------*/

            createScroll:function(){
                if (isAlive)
                {
                    bus.publish( 'satorisan', 'preloader-hide', {complete:function(){
                        
                        $(".gride-item").css({ opacity : 0, marginTop:50})
                        $("#gride-container-scroll").show();
                        $(".gride-item").each(function(index){
                            $(this).delay(index*100).animate( { marginTop:0, opacity : 1 }, {duration : 150});
                        });

                        if (Modernizr.touch)
                        {
                            
                        }
                        else
                        {
                            
                            $wrapper.unbind(MOUSE_DOWN_EVENT, $this.startMouseDown).bind(MOUSE_DOWN_EVENT, $this.startMouseDown);
                            $wrapper.unbind(MOUSE_UP_EVENT, $this.stopMouseDown).bind(MOUSE_UP_EVENT, $this.stopMouseDown);    
                        }                        
                        
                        $(".gride-item").unbind(CLICK_EVENT).bind (CLICK_EVENT, $this.goToDay);
                        //$(".gride-item").bind (CLICK_EVENT, $this.goToDay);

                        $blocker.hide();

                    }} );                

                    $(".gride-logo").delay(550).animate( { "opacity" : 1 }, {duration : 350} );
                }
                
            },

            /*-------------------------------*/

            goToDay:function()
            {                
                var t = $(this);

                if ($(this).hasClass("last"))
                {
                    bus.publish("satorisan", "history-goto", {url:"/shop"});
                }
                else
                {
                    if (Modernizr.touch)
                    {
                        
                        $(".gride-logo").animate( { "opacity" : 0 }, {duration : 350} );
                        $(".gride-item").unbind(CLICK_EVENT);
                        if ($(this).hasClass("last") == false)
                        {
                            currentDay = $(".gride-item").index( $(this) );
                        }
                        else
                        {
                            currentDay = 0;   
                        }
                        var totalTime=0;
                        $(".gride-item").each(function(index){
                            $(this).delay(index*100).animate( { marginTop:50, opacity : 0 }, {duration : 150});
                            totalTime+=100;
                        });
                        timeout = setTimeout($this.createLegendDay, totalTime + 150);                    
                    }
                    else
                    {
                        
                        if ( Math.abs(endOffsetX-startOffsetX) < MAX_OFFSET_DRAG &&  Math.abs(endOffsetY-startOffsetY) < MAX_OFFSET_DRAG )
                        {

                            $(".gride-logo").animate( { "opacity" : 0 }, {duration : 350} );
                            $(".gride-item").unbind(CLICK_EVENT);
                            if ($(this).hasClass("last") == false)
                            {
                                currentDay = $(".gride-item").index( $(this) );
                            }
                            else
                            {
                                currentDay = 0;   
                            }
                            var totalTime=0;
                            $(".gride-item").each(function(index){
                                $(this).delay(index*100).animate( { marginTop:50, opacity : 0 }, {duration : 150});
                                totalTime+=100;
                            });

                            timeout = setTimeout($this.createLegendDay, totalTime + 150);
                        }
                    }    
                }       
            },

            /*-------------------------------*/

            startMouseDown:function(e)
            {
                startOffsetX = e.pageX;
                startOffsetY = e.pageY;
            },

            /*-------------------------------*/

            stopMouseDown:function(e)
            {
                endOffsetX = e.pageX;
                endOffsetY = e.pageY;
            },            

            /*-------------------------------*/

            gotoPrevPhoto:function()
            {
                if ($(this).hasClass("disabled")==false && isTransition==false && currentDay > 0 && isPressing == false)
                {
                    isTransition = true;
                    currentDay--;
                    callbackNextSection = $this.createLegendDay;
                    $this.closeHotspots();
                }
            },

            /*-------------------------------*/

            gotoNextPhoto:function()
            {
                if ($(this).hasClass("disabled")==false && isTransition==false && currentDay < (CAMPAIGN.items.length-1) && isPressing == false)
                {
                    isTransition = true;
                    currentDay++;                    
                    callbackNextSection = $this.createLegendDay;
                    $this.closeHotspots();
                }
            },

            /*-------------------------------*/

            closeHotspots:function()
            {
                $blocker.show();
                $hotspots.each(function(){
                    $(this).animate( { top:$(this).position().top + 15, opacity:0}, {duration:250} );
                    $(this).find(".item").transition ( {scale: [0, 1]}, 200 );
                });
                timeout = setTimeout($this.closePhoto, 250);
            },

            /*-------------------------------*/

            closePhoto:function()
            {
                $gride.animate ({ bottom:-35 }, {duration:250});
                $prev.animate ({ left:-57 }, {duration:250});

                $next.animate ({ right:-57 }, {duration:250, complete:function(){
                    
                    $gride.hide();    
                    
                    
                    if (Modernizr.csstransforms && !$.browser.msie)
                    {
                        $('.image-mask:last').css( { height:0, top:($window.height()/2) - 65 });
                        
                        setTimeout(function(){
                            $blocker.show();
                            callbackNextSection();
                        },350);               
                    }
                    else
                    {
                        $('.image-mask:last').animate( { height:0, top:($window.height()/2) - 65 }, {duration:350, complete:function(){
                            $blocker.show();
                            callbackNextSection();
                        }});
                    }
                    
                    
                }});               
            },

            /*-------------------------------*/

            createDescriptionAccess:function()
            {
                isInAnimationNext = true;
                currentMode = "video";
                currentDay = user.COME_FROM_CAMPAIGN_DAY;
                index = user.COME_FROM_CAMPAIGN_HOTSPOT;
                $this.resize();
                currentHotspot = index;

                bus.publish("satorisan", "preloader-show", {mono:true});
                //$container.append("<div class='campaign-video-description'><div class='video'></div><div class='box-description " + CAMPAIGN.items[currentDay].hotpoints[index].block_position + "'><div class='box-container' style='z-index:10;'><div class='title'><img src='/website/images/product-names/" + String(CAMPAIGN.items[currentDay].hotpoints[index].title[CURRENT_LANGUAGE]).toLowerCase() + ".png' /></div><div class='description'>" + CAMPAIGN.items[currentDay].hotpoints[index].body[CURRENT_LANGUAGE] + "</div><div class='campaign-box-more-info'><a class='description-link' video-index='"+index+"' href='/product/"+CAMPAIGN.items[currentDay].hotpoints[index].link_product+"'>" + DICTIONARY[CURRENT_LANGUAGE].moreabout + " " + CAMPAIGN.items[currentDay].hotpoints[index].title[CURRENT_LANGUAGE] + "</a></div></div><a href='#' class='iconos top normal-link'><span>x</span></a></div></div>");
                
                $container.append("<div class='campaign-video-description'><div class='video'></div><div class='box-description " + CAMPAIGN.items[currentDay].hotpoints[index].block_position + "'><div class='box-container' style='z-index:10;'><div class='title'><img src='/website/images/product-names/" + String(CAMPAIGN.items[currentDay].hotpoints[index].title[CURRENT_LANGUAGE]).toLowerCase() + ".png' /></div><div class='description'>" + CAMPAIGN.items[currentDay].hotpoints[index].body[CURRENT_LANGUAGE] + "</div><div class='campaign-box-more-info'><a class='description-link' video-index='"+index+"' href='/product/"+CAMPAIGN.items[currentDay].hotpoints[index].link_product+"'>" + DICTIONARY[CURRENT_LANGUAGE].moreabout + " " + CAMPAIGN.items[currentDay].hotpoints[index].title[CURRENT_LANGUAGE] + "</a></div></div><div class='mascara'><a href='#' class='iconos top normal-link'><span>x</span></a></div></div></div>");

                bus.publish( 'satorisan', 'history-update' );

                $container.find (".description-link").unbind(CLICK_EVENT).bind(CLICK_EVENT, $this.gotoRelationProduct);
                
                var overlayPattern = 1;

                if (index == 1)
                {
                    overlayPattern = 2;
                }

                if (index == 3)
                {
                    overlayPattern = 2;
                }
                
                video = new Fullvideo ( { 
                                        pattern:overlayPattern,
                                        autoplay:"false",
                                        selector:".campaign-video-description .video", 
                                        path:CAMPAIGN.items[currentDay].hotpoints[index].video_path, 
                                        videoWidth:CAMPAIGN.items[currentDay].hotpoints[index].video_width, 
                                        videoHeight:CAMPAIGN.items[currentDay].hotpoints[index].video_height,
                                        canplay:function(){
                                            bus.publish("satorisan", "preloader-hide", {complete:function(){                                                
                                                $this.videoDescriptionLoadad();
                                            }})   
                                        }
                                    } );

                $description = $container.find(".campaign-video-description");          

                $container.find(".campaign-video-description").unbind("swipedown", $this.closeDescription).bind("swipedown", $this.closeDescription);
  
                
                if (Modernizr.csstransforms && !$.browser.msie)
                {
                    $description.transition( { y : $window.height()}, 0);    
                }
                else
                {
                    $description.css( { top : $window.height()});    
                }

                $description.css( {"z-index" : 2} );
                $(".iconos.top").bind (CLICK_EVENT, $this.closeDescription);

            },

            /*-------------------------------*/

            createDescription:function()
            {

                $gride.animate ({ bottom:-57 }, {duration:250});
                $next.animate ({ right:-57 }, {duration:250});
                $prev.animate ({ left:-57 }, {duration:250});

                currentMode = "video";
                bus.publish( 'satorisan', 'preloader-show', {mono:true} );
                
                var index;

                if (user.COME_FROM_CAMPAIGN_HOTSPOT!=-1)
                {
                    index = user.COME_FROM_CAMPAIGN_HOTSPOT;
                    user.COME_FROM_CAMPAIGN_DAY = -1;
                    user.COME_FROM_CAMPAIGN_HOTSPOT = -1;
                }
                else
                {
                    index = $hotspots.index($(this));
                }

                currentHotspot = index;

                bus.publish("satorisan", "ganalytics-track-event", { name: "CAMPAIGN - "+CURRENT_LANGUAGE+" - "+CAMPAIGN.items[currentDay].day[CURRENT_LANGUAGE] +" - "+CAMPAIGN.items[currentDay].hotpoints[index].title[CURRENT_LANGUAGE] } );
                
                if ($container.find(".campaign-video-description").length>0) $container.find(".campaign-video-description").remove();

                //$container.append("<div class='campaign-video-description' style='z-index:2;'><div class='video' style='position:absolute;top:0;left:0;z-index:1;'></div><div style='z-index:2;display:none;' class='box-description " + CAMPAIGN.items[currentDay].hotpoints[index].block_position + "'><div class='box-container' style='z-index:10;'><div class='title'><img src='/website/images/product-names/" + String(CAMPAIGN.items[currentDay].hotpoints[index].title[CURRENT_LANGUAGE]).toLowerCase() + ".png' /></div><div class='description'>" + CAMPAIGN.items[currentDay].hotpoints[index].body[CURRENT_LANGUAGE] + "</div><div class='campaign-box-more-info'><a class='description-link' video-index='"+index+"' href='/product/"+CAMPAIGN.items[currentDay].hotpoints[index].link_product+"'>" + DICTIONARY[CURRENT_LANGUAGE].moreabout + " " + CAMPAIGN.items[currentDay].hotpoints[index].title[CURRENT_LANGUAGE] + "</a></div></div><a href='#' class='iconos top normal-link'><span>x</span></a></div></div>");
                $container.append("<div class='campaign-video-description' style='z-index:2;'><div class='video' style='position:absolute;top:0;left:0;z-index:1;'></div><div style='z-index:2;display:none;' class='box-description " + CAMPAIGN.items[currentDay].hotpoints[index].block_position + "'><div class='box-container' style='z-index:10;'><div class='title'><img src='/website/images/product-names/" + String(CAMPAIGN.items[currentDay].hotpoints[index].title[CURRENT_LANGUAGE]).toLowerCase() + ".png' /></div><div class='description'>" + CAMPAIGN.items[currentDay].hotpoints[index].body[CURRENT_LANGUAGE] + "</div><div class='campaign-box-more-info'><a class='description-link' video-index='"+index+"' href='/product/"+CAMPAIGN.items[currentDay].hotpoints[index].link_product+"'>" + DICTIONARY[CURRENT_LANGUAGE].moreabout + " " + CAMPAIGN.items[currentDay].hotpoints[index].title[CURRENT_LANGUAGE] + "</a></div></div><div class='mascara'><a href='#' class='iconos top normal-link'><span>x</span></a></div></div></div>");
                
                bus.publish( 'satorisan', 'history-update' );

                $container.find (".description-link").unbind(CLICK_EVENT).bind(CLICK_EVENT, $this.gotoRelationProduct);
                
                $description = $container.find(".campaign-video-description");

                if (Modernizr.csstransforms && !$.browser.msie)
                {
                    $description.transition( { y : $window.height()}, 0);    
                }
                else
                {
                    $description.css( { top : $window.height()});    
                }


                

                var overlayPattern = 1;

                if (index == 1)
                {
                    overlayPattern = 2;
                }

                if (index == 3)
                {
                    overlayPattern = 2;
                }

                video = new Fullvideo ( { 
                                        pattern:overlayPattern,
                                        autoplay:"false",
                                        selector:".campaign-video-description .video", 
                                        path:CAMPAIGN.items[currentDay].hotpoints[index].video_path, 
                                        videoWidth:CAMPAIGN.items[currentDay].hotpoints[index].video_width, 
                                        videoHeight:CAMPAIGN.items[currentDay].hotpoints[index].video_height,
                                        canplay:$this.videoDescriptionLoadad
                                    } );

                
                
                
                $container.find(".campaign-video-description").unbind("swipedown", $this.closeDescription).bind("swipedown", $this.closeDescription);
                

                
                

                $description.css( {"z-index" : 2} );
                $(".iconos.top").bind (CLICK_EVENT, $this.closeDescription);
                
            },

            /*-------------------------------*/

            gotoRelationProduct:function(e){

                e.preventDefault();
                user.COME_FROM_CAMPAIGN_DAY = currentDay;
                user.COME_FROM_CAMPAIGN_HOTSPOT = $(this).attr("video-index");
                bus.publish( 'satorisan', 'history-goto', { url:$(this).attr("href") } ); 
                return false;
            },

            /*-------------------------------*/

            videoDescriptionLoadad:function(){
                video.resize();
                
                $.preload([ "/website/images/product-names/" + CAMPAIGN.items[currentDay].hotpoints[currentHotspot].link_product + ".png" ], {loaded_all:function(){

                    bus.publish( 'satorisan', 'preloader-hide', {complete:function(){
                        var tHeight = $(".box-description").height();

                        setTimeout(function(){
                            $(".box-description").show();
                            $(".box-description .top").hide();
                            //$(".box-description .top").css( { overflow:"hidden", height:0} )
                            $(".box-description").css( { overflow:"hidden", "height":0} )
                            $blocker.hide();
                            
                            
                            if (Modernizr.csstransforms && !$.browser.msie)
                            {
                                isCSSTransform = true;
                                $this.resize();
                                $(".photo-section").transition( { y:0}, 0 )
                                $(".photo-section").transition( { y:0-($window.height()/2)}, 850, "ease" );
                                $description.transition( { y:0}, 850, "ease", function(){
                                    video.play();

                                    $(".box-description").animate({height:tHeight},{duration:250, complete:function(){
                                        //$(".box-description").css( { overflow:"inherit" } );
                                        $(".box-description .mascara").css({'left':'341px'});
                                        $(".box-description .top").css({'left':'-57px'});
                                        $(".box-description .top").show().animate( { left:0}, {duration:250});
                                        
                                    }});

                                    if (user.COME_FROM_CAMPAIGN_DAY!=-1)
                                    {
                                        $this.createPhotoAccess();
                                    }
                                } );
                            }
                            else
                            {
                                isInAnimationNext = true;
                                $(".photo-section .image-mask").css( {   height:$window.height(), marginTop:-42, "background-attachment" : "inherit"} );
                                $(".photo-section").animate( { top:0-($window.height()/2)}, 850 );
                                $description.animate( { top:0}, {duration:850, complete:function(){
                                    video.play();
                                    $(".box-description .mascara").css({'left':'341px'});
                                    $(".box-description .top").css({'left':'-57px'});
                                    $(".box-description .top").show().animate({left:0}, {duration:250});
                                    //var tHeight = $(".box-description").height();
                                    $(".box-description").css( { "height":0} ).animate({height:tHeight},{duration:250,complete:function(){
                                        $(".box-description").css( { overflow:"inherit" } );
                                    }});
                                    if (user.COME_FROM_CAMPAIGN_DAY!=-1)
                                    {
                                        $this.createPhotoAccess();                                    
                                    }
                                }} );
                            }
                        }, 350);                    
                    }});

                }});
            },

            /*-------------------------------*/

            closeDescription:function(e){

                if (e) e.preventDefault();
                isCSSTransform = true;

                if($.browser.mozilla) isCSSTransform = false;

                $container.find(".campaign-video-description").unbind("swipedown", $this.closeDescription)

                currentMode = "photo";
                $this.resize();
                $gride.hide();                
                
                if (Modernizr.csstransforms && !$.browser.msie)
                {                    
                    $(".photo-section").css( {"z-index" : 2 });
                    $(".photo-section").transition( {y:0-$(".photo-section").height()}, 0)
                    $(".photo-section").transition( { y:0}, 850, "ease" );
                    
                    $description.css( {"z-index" : 1});
                    $description.transition( { y:($window.height()/2)}, 850, "ease", function(){
                       
                        if (isInAnimationNext)
                        {
                            $gride.css({bottom:-39})
                        }
                        else
                        {
                            $gride.css({bottom:-33})
                        }
                        $gride.show();
                        $this.destroyVideo();
                        $next.animate ({ right:0 }, {duration:250});
                        $prev.animate ({ left:0 }, {duration:250});
                        if (isInAnimationNext)
                        {
                            $gride.animate ({ bottom:21 }, {duration:250});    
                        }
                        else
                        {
                            $gride.animate ({ bottom:62 }, {duration:250});    
                        }

                        
                    });
                }
                else
                {
                    $(".photo-container .image-mask").css( {marginTop:-42});
                    $(".photo-section").css( {"z-index" : 2, top:0-$(".photo-section").height()}).animate( { top:1}, {duration:850} );
                    $description.css( {"z-index" : 1}).animate( { top:($window.height()/2)}, {duration:850, complete:function(){
                        
                        $gride.show();
                        $this.destroyVideo();
                        $next.animate ({ right:0 }, {duration:250});
                        $prev.animate ({ left:0 }, {duration:250});
                        $gride.css({bottom:-33}).animate ({ bottom:22 }, {duration:250});
                    }} );
                }

                return false;
            },

            /*-------------------------------*/

            destroyVideo:function(){
                currentMode = "photo";
                video.destroy();
                if ($description) $description.remove();

                $(".photo-container").children().filter("video").each(function(){
                    this.pause();
                    delete(this);
                    $(this).empty();
                    $(this).remove();
                });

                //noise = new Fullvideo ( { autoplay:"autoplay", selector:".photo-section .noise", path:"/website/videos/noise.mp4", videoWidth:1000, videoHeight:562, isNoise:true} );
            },

            /*-------------------------------*/

            resizeSpots:function(){
                if (currentMode == "photo")
                {
                    if ($hotspots)
                    {

                        var windRes = $window.width() / $window.height();
                        var imageRes = CAMPAIGN.items[currentDay].big_image_path_width / CAMPAIGN.items[currentDay].big_image_path_height;
                
                
                        $hotspots.each(function(index){
                            if (CAMPAIGN.items[currentDay].hotpoints[index])
                            {
                                
                                var originalX = CAMPAIGN.items[currentDay].hotpoints[index].coordinates.x;
                                var originalY = CAMPAIGN.items[currentDay].hotpoints[index].coordinates.y;
                                
                                var imageWidth;
                                var imageHeight;

                                if (windRes < imageRes)
                                {
                                    imageHeight = $window.height();
                                    imageWidth = (CAMPAIGN.items[currentDay].big_image_path_width * $window.height()) / CAMPAIGN.items[currentDay].big_image_path_height;

                                }
                                else
                                {
                                    imageWidth = $window.width();
                                    imageHeight = (CAMPAIGN.items[currentDay].big_image_path_height * $window.width()) / CAMPAIGN.items[currentDay].big_image_path_width;
                                }

                                
                                var newX = (imageWidth * originalX) / CAMPAIGN.items[currentDay].big_image_path_width;
                                var newY = (imageHeight * originalY) / CAMPAIGN.items[currentDay].big_image_path_height;

                                var finalX = (($window.width() / 2) - (imageWidth/2)) + newX;
                                var finalY = (($window.height() / 2) - (imageHeight/2)) + newY;

                                $(this).css( { top:Math.round(finalY-47) + CAMPAIGN.items[currentDay].offsetY, left:Math.round(finalX) } );
                            }
                        });
                    }
                }
            },

            /*-------------------------------*/

            resize:function(){
                $container.css( { height:$window.height()-60, "overflow":"hidden"} );
                var windRes = $window.width() / $window.height();
                var imageRes = CAMPAIGN.items[currentDay].big_image_path_width / CAMPAIGN.items[currentDay].big_image_path_height;
                
                var imageWidth;
                var imageHeight;

                if (windRes < imageRes)
                {
                    imageHeight = $window.height();
                    imageWidth = (CAMPAIGN.items[currentDay].big_image_path_width * $window.height()) / CAMPAIGN.items[currentDay].big_image_path_height;

                }
                else
                {
                    imageWidth = $window.width();
                    imageHeight = (CAMPAIGN.items[currentDay].big_image_path_height * $window.width()) / CAMPAIGN.items[currentDay].big_image_path_width;
                }

                /*console.log(">>"+imageHeight);
                console.log(">>"+$window.height());

                if (imageHeight>$window.height())
                {
                    
                     console.log(">>adentro");
                    imageHeight = $window.height();
                    imageWidth = (CAMPAIGN.items[currentDay].big_image_path_width * $window.height()) / CAMPAIGN.items[currentDay].big_image_path_height;
                }*/

                var yOffset = 0;
                
                if (isCSSTransform==true) yOffset = -42;

                yOffset += CAMPAIGN.items[currentDay].offsetY;

                //console.log(yOffset);

                //$(".image-mask:last").css( { "background-size" : imageWidth + "px " + imageHeight + "px", "background-position" :  "center center" } );
                $('.image-mask').removeClass("animation");
                
                $(".image-mask:last").css( { width:imageWidth, "background-size" : imageWidth + "px " + imageHeight + "px", "background-position" : (($window.width()/2)-(0-imageWidth/2)) + "px " + ((($window.height()/2)-(0-imageHeight/2)) + yOffset) + "px" } );
                
                //console.log(">>"+isInAnimationNext);

                if (isInAnimationNext==false)
                {
                    $(".image-mask:last").css( { height:$window.height()-60 } );
                }
                else
                {
                    $(".image-mask:last").css( { height:$window.height() } );
                }


                if (isInAnimationNext==false)
                {
                   $('.photo-container').css( { height:$window.height() } );
                }
                else
                {
                    $('.photo-container').css( { height:$window.height()-42 } );   
                }

                $('.image-mask').addClass("animation");
                

                if (currentMode == "gride")
                {
					var wrapperWidth = (CAMPAIGN.items.length+1) * 555;
                    if (wrapperWidth < $window.width()) wrapperWidth = $window.width();
                    

					var $grideContainerScroll = $("#gride-container-scroll");
					$grideContainerScroll.css ( { width:$window.width(), height:$window.height()-$("#gride-container-scroll").height()} );
                    $(".gride-container #scroller").css ( { width : wrapperWidth } );

                    $("#thelist").css( { "padding-top" : ($window.height()/2)-290, "padding-bottom" : ($window.height()/2)} );

					// iscroll resize
					$grideContainerScroll.iOSScrollSatorisan('updateDimensions', wrapperWidth, $window.width());
                }

                

                if (currentMode == "video")
                {

                    var originalBoxX = CAMPAIGN.items[currentDay].hotpoints[currentHotspot].box_coordinates.x;
                    var originalBoxY = CAMPAIGN.items[currentDay].hotpoints[currentHotspot].box_coordinates.y;

                    var finalBoxX = (imageWidth*originalBoxX)/CAMPAIGN.items[currentDay].big_image_path_width;
                    var finalBoxY = (imageHeight*originalBoxY)/CAMPAIGN.items[currentDay].big_image_path_height;

                    $(".box-description").css ( {
                        top:finalBoxY,
                        left:finalBoxX
                    } );

                }
                
                $this.resizeSpots();
            },

            /*-------------------------------*/

            stop:function(){

                if (isActive)               
                {
                    $(document).unbind("mouseup");
                    if($hotspots) $hotspots.unbind("mousedown");

                    isActive = false;
                    $wrapper.unbind(MOUSE_DOWN_EVENT, this.startMouseDown);
                    $wrapper.unbind(MOUSE_UP_EVENT, this.stopMouseDown);                    

                    if (timeout) clearTimeout (timeout);

                    isAlive = false;

                    if (noise)
                    {
                        noise.stop();
                        noise = null;
                    }
                    
                    $container.find(".photo-section").unbind("swipeleft");      
                    $container.find(".photo-section").unbind('swiperight');
                    
                    if (video)
                    {
                        //video.stop();
                    }

					// iscroll destruir
					$("#gride-container-scroll").iOSScrollSatorisan('destroy');

                    $window.unbind("resize", $this.resize);

                }

                $body.removeClass(PAGE_BODY_SELECTOR);
                $body.removeClass("ss-13");
            }

        
        }
    
});


var campaignCreateGrid, campaignShowDetail, timeInterval, goToProductDescription, flashObj,currentMode="video", campaignDirectAccessPath="", video, idGridDetail=null, goBackTransitionVideo;
Hydra.module.register( 'page-campaign-fw13', function( bus ){ 
        
        var PAGE_BODY_SELECTOR = "campaign", audio=true, isScreenVideoFinish=false, isVideoFinished=false, isInEnd=false, introTimeout, randomVideo=Math.round(Math.random()*2)+1,SWF_PATH="/website/swf/campaign/controller/campaign.swf", isActive=false, isResume=false, unique = Math.round(Math.random()*1000);
         

        return {
            
            /*-------------------------------*/
            /* PAGE CAMPAIGN */
            /*-------------------------------*/            

            init: function(){
                $this = this;
                bus.subscribe('satorisan', this);
            },
            
            /*-------------------------------*/

            oEventsCallbacks: {
                'append-page' : function (data) {                    
                    
                    
                    if (isActive == false)
                    {
                        if (data.content == "campaign-fw13")
                        {                            
                            
                            isActive = true;
                            isAlive = true;
                            bus.publish("satorisan", "ganalytics-track-path");
                            this.create();
                        }
                    }

                },
                
                'transition-out' : function(data)
                {
                    if (isActive && data.type=="campaign-fw13")
                    {
                        if (introTimeout) clearTimeout(introTimeout);
                        if (timeInterval) clearInterval(timeInterval);
                        $(".section-wrapper." + PAGE_BODY_SELECTOR + " .buttons").animate( { opacity:0 }, {duration:1000});
                        $(".video-container").animate( { opacity:0 }, {duration:1000});
                        $(".grid-wrapper").animate( { opacity:0 }, {duration:1000});
                        
                        if (currentMode=="grid")
                        {
                            SatorisanGrid.destroy();    
                        }

                        $(".section-wrapper.campaign > .container").animate( { opacity:0 }, {duration:1000, complete:function(){
                            if (video) video.destroy();
                            video=null;
                            $body.removeClass(PAGE_BODY_SELECTOR);                       
                            isActive = false;
                            isAlive = false;
                            data.complete();
                        }} );

                    }
                },

                'pause-page' : function()
                {
                   isResume = true;
                   if (isActive)
                   {

                        if (currentMode=="video" && isVideoFinished==false && isInEnd==false)
                        {
                            video.muted();  
                            video.pause();
                        }
                   }

                },

                'resume-page' : function()
                {
                   isResume = false;
                   if (isActive)
                   {
                       if (currentMode=="video" && isVideoFinished==false && isInEnd==false)
                        {
                            if (audio)
                            {
                                video.audio();
                            }
                            else
                            {
                                video.muted();
                            }

                            video.resume();
                        } 
                   }

                },

                'campaign-create-video' : function(){
                    this.createVideoFromGrid();
                },

                'destroy-page' : function(data)
                {
                    if (isActive)
                    {
                        if (introTimeout) clearTimeout(introTimeout);
                        if (timeInterval) clearInterval(timeInterval);
                        this.stop();
                        data.complete();
                    }
                }
            },

            /*-------------------------------*/

            create:function(){
                audio = true;
                currentMode = "video";
                isScreenVideoFinish=false;
                isVideoFinished=false;
                isInEnd=false;
                $window.bind("resize", $this.resize);
                markup = "<div class='section-wrapper new-section " + PAGE_BODY_SELECTOR + "'><div class='container'><div id='audio-button'>AUDIO OFF</div><div class='video-container' style='pointer-events:none; overflow:hidden; z-index:29;'></div><div class='buttons'><div class='play-again'>" + DICTIONARY[CURRENT_LANGUAGE].playagain + "</div><div class='backtovideo'>" + DICTIONARY[CURRENT_LANGUAGE].backtovideo + "</div><div class='buttons-overlay'></div> <div class='buttons-campaign'><div class='button-campaign shop'>"+DICTIONARY[CURRENT_LANGUAGE].gototheshop+"</div><div class='button-campaign grid'>"+DICTIONARY[CURRENT_LANGUAGE].seethegallery+"</div></div> </div><div class='skip-video'>" + DICTIONARY[CURRENT_LANGUAGE].skipvideo + "</div><div class='title-container'><div class='push'>SATORISAN FALL-WINTER 2013</div><div class='title-campaign'>NEXT STEP IS</div></div></div></div>"
                $content.append(markup);
                $wrapper = $(".section-wrapper");
                $container = $(".section-wrapper." + PAGE_BODY_SELECTOR);

                $container.find(".video-container").append ("<div class='campaign-video-container'> \
                                        <div id='campaign-video-container-" + unique + "'></div> \
                                    </div>");

                $("#audio-button").unbind(CLICK_EVENT).bind(CLICK_EVENT, $this.toggleAudio);

                 $(".skip-video").unbind(CLICK_EVENT).bind(CLICK_EVENT, function(){
                    $this.videoFinish(); 
                });

                $(".backtovideo").unbind(CLICK_EVENT).bind(CLICK_EVENT, function(){
                    isScreenVideoFinish = false;
                    $this.resumeVideo(); 
                });

                $(".play-again").unbind(CLICK_EVENT).bind(CLICK_EVENT, function(){
                    isScreenVideoFinish = false;
                    $this.restartVideo(); 
                });

                $(".button-campaign.shop").bind(CLICK_EVENT, function(){
                    globalBus.publish( 'satorisan', 'history-goto', { url: "/shop" } );
                });

                $(".button-campaign.grid").bind(CLICK_EVENT, function(){
                    clearTimeout(introTimeout);
                    clearInterval(timeInterval);
                    campaignCreateGrid();
                });



                if (CURRENT_FLOOR == null)
                {
                    CURRENT_FLOOR = 1;
                    
                    if (user.HEADER_AND_FOOTER_CREATED == false)
                    {
                        Hydra.module.start("menu", 'menu_instance');
                        Hydra.module.start("footer", 'footer_instance'); 
                        user.HEADER_AND_FOOTER_CREATED = true;
                        bus.publish("satorisan", "menu-change-go", { data:"campaign-fw13" });
                    }

                    $this.checkWhatShow();

                    bus.publish( 'satorisan', 'history-update' );
                    
                }
                else
                {
                    if (CURRENT_FLOOR == 0)
                    {
                        bus.publish( 'satorisan', 'transition-page', { type: "SLIDE_BOTTOM", complete:$this.checkWhatShow } );
                        CURRENT_FLOOR = 1;
                    }
                    else
                    {
                        $this.checkWhatShow();
                    }
                } 

                $body.addClass(PAGE_BODY_SELECTOR);
                bus.publish( 'satorisan', 'menu-change', { data:"campaign-fw13" } );

                user.IS_IN_TRANSITION = false;
            },


            checkWhatShow:function(){
                if (idGridDetail==null)
                {
                    $this.createVideo();
                }
                else
                {
                    campaignCreateGrid(true);
                }
            },

            createVideo:function(){
                var headerText = "Campaign";
                var footerText = "NEXT STEP IS - FALL WINTER 13";
                if (CURRENT_LANGUAGE=="es")
                {
                    headerText = "Campaña";
                    footerText = "NEXT STEP IS - OTOÑO INVIERNO 13";
                }
                bus.publish( 'satorisan', 'preloader-show', { 
                    header:"<div class='preloader-header-campaign'>"+headerText+"</div>", 
                    footer:footerText
                } );

                var r = (Math.round(Math.random())*2)+1;

                while (r==randomVideo)
                {
                    r = (Math.round(Math.random())*2)+1;
                }

                randomVideo = r;

                $("#campaign-video-container-" + unique).css({opacity:0});
                
                /*video = new Fullvideo ( { 
                                        autoplay:"false",
                                        selector:"#campaign-video-container-" + unique, 
                                        path:"/website/videos/campaign/fw13/nextstepis" + randomVideo + ".mp4", 
                                        videoWidth:1280,
                                        videoHeight:720,
                                        canplay:function(){
                                            bus.publish("satorisan", "preloader-hide", {complete:function(){                                                
                                                    $this.videoLoaded();                                                 
                                                    video.resize();
                                                    $("#campaign-video-container-" + unique).delay(100).animate({opacity:1}, {duration:350});
                                            }})
                                               
                                        }
                                    } );
                */



                video = new Fullvideo ( { 
                                        loop:"false",
                                        pattern:0,
                                        autoplay:"false",
                                        selector:"#campaign-video-container-" + unique, 
                                        //path:"/website/videos/campaign/fw13/NextStepIs" + randomVideo + ".mp4",
                                        path:"https://s3-eu-west-1.amazonaws.com/satorisan-fw13/videos/nextstepis" + randomVideo + ".mp4", 
                                        videoWidth:1280, 
                                        videoHeight:720,
                                        canplay:function(){
                                            if (isiPad==false)
                                            {
                                                bus.publish("satorisan", "preloader-hide", {complete:function(){ 
                                                    if(!isiPad){
                                                        $this.videoLoaded();                                                 
                                                        video.resize();
                                                    }
                                                    
                                                    
                                                    $("#campaign-video-container-" + unique).delay(100).animate({opacity:1}, {duration:350});
                                                }});
                                            }

                                        }
                                    } );
                
                

                if (isiPad ){
                    
                    setTimeout(function(){
                        
                        $.preload(['/website/videos/campaign/fw13/poster' + randomVideo + '.jpg'], {loaded_all:function(){

                            bus.publish("satorisan", "preloader-hide", {complete:function(){ 
                                                    $(".container .buttons").append("<div class='img-poster'><img width='100%' style='top:-100px;position:absolute;z-index:1;' src='/website/videos/campaign/fw13/poster" + randomVideo + ".jpg' /></div><a class='button-campaign' id='ipad-video-play' style='margin-top:243px;z-index:2; position:relative;' >PLAY</a>");
                                                    
                                                    $("#ipad-video-play").unbind(CLICK_EVENT).bind(CLICK_EVENT, function(){
                                                        $(".img-poster").hide();
                                                        $("#ipad-video-play").hide();
                                                        video.play();
                                                        $("#campaign-video-container-" + unique).delay(100).animate({opacity:1}, {duration:350});
                                                        setTimeout(function(){
                                                            $this.videoLoaded();                                                 
                                                            video.resize();
                                                            
                                                        },6000 );
                                                        
                                                        $("#campaign-video-container-" + unique).delay(100).animate({opacity:1}, {duration:350});
                                                    });

                                                    $this.resize();                                                 

                                                    
                            }});
                        }});
                         
                    },2000);  
                }

            },

            /*-------------------------------*/

            createVideoFromGrid:function(){
                var r = (Math.round(Math.random())*2)+1;

                while (r==randomVideo)
                {
                    r = (Math.round(Math.random())*2)+1;
                }

                randomVideo = r;

                $("#campaign-video-container-" + unique).css({opacity:0});

                video = new Fullvideo ( { 
                                        loop:"false",
                                        pattern:0,
                                        autoplay:"false",
                                        selector:"#campaign-video-container-" + unique, 
                                        //path:"/website/videos/campaign/fw13/NextStepIs" + randomVideo + ".mp4",
                                        path:"https://s3-eu-west-1.amazonaws.com/satorisan-fw13/videos/nextstepis" + randomVideo + ".mp4", 
                                        videoWidth:1280, 
                                        videoHeight:720,
                                        canplay:function(){
                                            if (isiPad==false)
                                            {
                                                bus.publish("satorisan", "preloader-hide", {complete:function(){ 
                                                    if(!isiPad){
                                                        $this.gridAnimation();                                                 
                                                        video.resize();
                                                    }
                                                    
                                                    
                                                    $("#campaign-video-container-" + unique).delay(100).animate({opacity:1}, {duration:350});
                                                }});
                                            }

                                        }
                                    } );
                
                

                if (isiPad ){
                    
                    setTimeout(function(){
                        
                        $.preload(['/website/videos/campaign/fw13/poster' + randomVideo + '.jpg'], {loaded_all:function(){
 
                            bus.publish("satorisan", "preloader-hide", {complete:function(){ 

                                                    $(".container .buttons").append("<div class='img-poster'><img width='100%' style='top:-100px;position:absolute;z-index:1;' src='/website/videos/campaign/fw13/poster" + randomVideo + ".jpg' /></div><a class='button-campaign' id='ipad-video-play' style='margin-top:243px;z-index:2; position:relative;' >PLAY</a>");
                                                    
                                                    $("#ipad-video-play").unbind(CLICK_EVENT).bind(CLICK_EVENT, function(){
                                                        $(".img-poster").hide();
                                                        $("#ipad-video-play").hide();
                                                        //video.play();
                                                        $("#campaign-video-container-" + unique).delay(100).animate({opacity:1}, {duration:350});
                                            
                                                            $this.videoLoaded();                                                 
                                                            video.resize();

                                                        $("#campaign-video-container-" + unique).delay(100).animate({opacity:1}, {duration:350});
                                                    });

                                                    $this.resize();      
                                                    $this.gridAnimation();                                            

                                                    
                            }});
                        }});
                         
                    },2000);  
                }
                
            },

            gridAnimation:function(){
                currentMode = "video";
             
                SatorisanGrid.destroy();    

                if (Modernizr.csstransforms && !$.browser.msie)
                {
                  

                   //$(".grid-wrapper").removeClass("transition-top");
                   $(".grid-wrapper").css( { 'z-index' : 1 });

                   $(".section-wrapper.campaign > .container").removeClass("transition-top");
                   $(".section-wrapper.campaign > .container").css( { 
                    'z-index' : 2,
                    top: 0-video.videoHeight()
               /*     '-webkit-transform': 'translate3D(0, '+(0-$window.height())+'px,0)',
                    '-moz-transform': 'translate3D(0, '+(0-$window.height())+'px,0)',
                    '-o-transform': 'translate3D(0, 0,'+(0-$window.height())+'px)',
                    '-ms-transform': 'translate3D(0, '+(0-$window.height())+'px,0)'*/
                    });
                   

                   var sw = false;
                   $(".section-wrapper.campaign > .container").unbind(TRANSITION_END_EVENT).bind(TRANSITION_END_EVENT, function(){
                        if (sw==false)
                        {
                            $(".grid-wrapper").removeClass("transition-top");
                            $(".section-wrapper.campaign > .container").removeClass("transition-top");
                            $(".buttons-campaign,.backtovideo,#audio-button,.title-container").animate({opacity:1}, {duration:250});
                             $(".grid-wrapper").remove();
                            if (isiPad==false) $this.videoLoaded();
                        }
                        sw = true;
                    });

                   

                    setTimeout(function(){
                        $(".section-wrapper.campaign > .container").addClass("transition-top");
                        $(".grid-wrapper").addClass("transition-top");

                        $(".grid-wrapper").css( { 
                            top: Math.round($window.height()*0.75)

                         });

                         $(".section-wrapper.campaign > .container").css( { 
                            /*'z-index' : 1,*/
                            top: 0

                         });
                    },250);

                }
                else
                {
                    $(".grid-wrapper").css( { 
                        'z-index' : 1
                     });

                     $(".section-wrapper.campaign > .container").css( { 
                        'z-index' : 2
                     });


                     $(".grid-wrapper").animate( { 
                        top: ($window.height()*0.75),
                        complete:function(){
                            $(".buttons-campaign,.backtovideo,#audio-button,.title-container").animate({opacity:1}, {duration:250});
                             $(".grid-wrapper").remove();
                            if (isiPad==false) $this.videoLoaded();
                        }
                     });

                     $(".section-wrapper.campaign > .container").animate( { 
                        top: 60
                     });
                }
            },

            /*-------------------------------*/

            toggleAudio:function(){

                if (audio)
                {
                    audio = false;
                    video.muted();
                    $("#audio-button").addClass("off")
                }
                else
                {
                    audio = true;
                    video.audio();
                    $("#audio-button").removeClass("off")
                }
            },

            /*-------------------------------*/

            resumeVideo:function(){
                $blocker.show();
                $(".title-container").animate( { opacity:0 }, { duration:550 } );
                $(".buttons-campaign").animate({opacity:0}, { duration:550 });
                $(".backtovideo").animate({opacity:0}, { duration:550, complete:function(){
                    $(".backtovideo").hide();
                    $(".buttons-overlay").animate({opacity:0}, { duration:550, complete:function(){

                        clearInterval(timeInterval);
                        timeInterval = setInterval($this.checkTime, 100);
                        if (audio)
                        {
                            video.audio();
                        }
                        else
                        {
                            video.muted();   
                        }
                        video.resume();
                        isScreenVideoFinish=false;
                        $(".skip-video").show().animate({bottom:20}, {duration:350});
                        $("#audio-button").show().animate({bottom:33}, {duration:350, complete:function(){
                            $blocker.hide();
                        }});

                    }});

                } })
            },

            /*-------------------------------*/

            restartVideo:function(){
                //$(".title-container").animate( { opacity:0 }, { duration:550 } );
                $blocker.show();
                $(".buttons-campaign").animate({opacity:0}, { duration:550 });
                $(".play-again").animate({opacity:0}, { duration:550, complete:function(){
                        isInEnd = false;
                        $(".play-again").hide();
                        if (audio)
                        {
                            video.audio();
                        }
                        else
                        {
                            video.muted();   
                        }

                        video.restartVideo();
                        isScreenVideoFinish=false;
                        introTimeout = setTimeout($this.showSkip, 4500);
                        timeInterval = setInterval($this.checkTime, 100);
                        //$blocker.hide();
                } });
            },

 

            /*-------------------------------*/

            videoFinish:function()
            {
               if (isScreenVideoFinish==false)
               {
                   isScreenVideoFinish = true;
                   if (isInEnd==false)
                   {
                        video.muted();  
                        video.pause();
                        $blocker.show();
                        $(".skip-video").animate({bottom:-10}, {duration:350, complete:function(){
                            $(".skip-video").hide();
                            

                        }});

                        $("#audio-button").animate({bottom:-11}, {duration:350, complete:function(){
                            $("#audio-button").hide();

                        }});

                        $(".title-container").animate( { opacity:1 }, { duration:550 } );

                        $(".buttons-campaign").css({opacity:0}).show();

                        
                        $(".buttons-overlay").css({opacity:0}).show();
                        $(".buttons-overlay").animate({opacity:0.25}, {duration:350, complete:function(){
                            $(".buttons-campaign").animate({opacity:1}, {duration:350});
                            $(".backtovideo").css({opacity:0}).show();
                            $(".backtovideo").animate({opacity:1}, {duration:350, complete:function(){
                                $blocker.hide();
                            }});

                        }});

                        
                   }
                   else
                   {
                        $blocker.show();
                        $(".skip-video").animate({bottom:-10}, {duration:350, complete:function(){
                            $(".skip-video").hide();
                            

                        }});

                        $("#audio-button").animate({bottom:-11}, {duration:350, complete:function(){
                            $("#audio-button").hide();

                        }});

                        $(".title-container").animate( { opacity:1 }, { duration:550 } );

                        $(".buttons-campaign").css({opacity:0}).show();

                        $(".buttons-campaign").animate({opacity:1}, {duration:350});
                        $(".play-again").css({opacity:0}).show();
                        $(".play-again").animate({opacity:1}, {duration:350, complete:function(){
                            $blocker.hide();
                        }});
                        
                   }
                }
            },

            /*-------------------------------*/

            videoLoaded:function(){

                $(".title-container").css({opacity:0}).show();
                $(".title-container").animate( { opacity:1 }, { duration:550 } );
                introTimeout = setTimeout($this.showSkip, 4500);
                video.play();
                timeInterval = setInterval($this.checkTime, 100);
                video.resize();
            },
            
            /*-------------------------------*/

            checkTime:function(){


                if ( video.getVideoTime() > 50 && isInEnd==false)
                {
                    
                    clearInterval (timeInterval);
                    isInEnd = true;
                    $this.videoFinish();
                }
            },

            /*-------------------------------*/

            showSkip:function(){
                $(".title-container").animate( { opacity:0 }, { duration:550, complete:function(){
                    $(".skip-video").css({bottom:0});
                    $(".skip-video").show();
                    $(".skip-video").animate({bottom:20}, {duration:350});

                    $("#audio-button").css({bottom:0});
                    $("#audio-button").show();
                    $("#audio-button").animate({bottom:33}, {duration:350});
                } } );

                if (isiPad)
                {
                    video.removeControls();
                }
            },

            /*-------------------------------*/

            resize:function(){
               if (isFlash())
               {
                    //$( '#campaign-swf-container-' + unique ).css( { height : $window.height()-93 } );
               }
               else
               {
                    SatorisanGrid.updateDimensions($(window).width(), window.innerHeight-(60+33));
               }

               if (currentMode=="grid") SatorisanGrid.updateDimensions($(window).width(), window.innerHeight-(60+33));

               

            },

            /*-------------------------------*/

            stop:function(){

                if (isActive)               
                {
                    $window.unbind("resize", $this.resize);
                    isActive = false;

                    clearTimeout(introTimeout);
                    clearInterval(timeInterval);

                }

                $body.removeClass(PAGE_BODY_SELECTOR);
            }

        
        }
    
});

 /*-------------------------------*/

function isFlash()
{
    if (typeof navigator.plugins['Shockwave Flash'] !== 'undefined') {
        return true;
    } else {
        return false;
    }
    return false;
}

goToProductDescription = function(link)
{
   globalBus.publish( 'satorisan', 'history-goto', { url: "/product/" + link } );
}

goBackToVideo = function()
{
    //console.log("video>>"+video);
    if (video)
    {
        goBackTransitionVideo();
    }
    else
    {
       $blocker.show();
       globalBus.publish("satorisan", "preloader-show", {mono:true});
       globalBus.publish("satorisan", "campaign-create-video");

    }
    
}

goBackTransitionVideo = function(){

   currentMode = "video";
    
    SatorisanGrid.destroy();    

    if (Modernizr.csstransforms && !$.browser.msie)
    {
      

       //$(".grid-wrapper").removeClass("transition-top");
       $(".grid-wrapper").css( { 'z-index' : 1 });

       $(".section-wrapper.campaign > .container").removeClass("transition-top");
       $(".section-wrapper.campaign > .container").css( { 
        'z-index' : 2,
        top: 0-video.videoHeight()
   /*     '-webkit-transform': 'translate3D(0, '+(0-$window.height())+'px,0)',
        '-moz-transform': 'translate3D(0, '+(0-$window.height())+'px,0)',
        '-o-transform': 'translate3D(0, 0,'+(0-$window.height())+'px)',
        '-ms-transform': 'translate3D(0, '+(0-$window.height())+'px,0)'*/
        });
       

       var sw = false;
       $(".section-wrapper.campaign > .container").unbind(TRANSITION_END_EVENT).bind(TRANSITION_END_EVENT, function(){
            if (sw==false)
            {
                $(".grid-wrapper").removeClass("transition-top");
                $(".section-wrapper.campaign > .container").removeClass("transition-top");
                $(".buttons-campaign,.backtovideo,#audio-button,.title-container").animate({opacity:1}, {duration:250});
                resumeCampaignVideo();
            }
            sw = true;
        });

       

        setTimeout(function(){
            $(".section-wrapper.campaign > .container").addClass("transition-top");
            $(".grid-wrapper").addClass("transition-top");

            $(".grid-wrapper").css( { 
                top: Math.round($window.height()*0.75)

             });

             $(".section-wrapper.campaign > .container").css( { 
                /*'z-index' : 1,*/
                top: 0

             });
        },250);

    }
    else
    {
        $(".grid-wrapper").css( { 
            'z-index' : 1
         });

         $(".section-wrapper.campaign > .container").css( { 
            'z-index' : 2
         });


         $(".grid-wrapper").animate( { 
            top: ($window.height()*0.75),
            complete:function(){
                $(".buttons-campaign,.backtovideo,#audio-button,.title-container").animate({opacity:1}, {duration:250});
                 resumeCampaignVideo();
            }
         });

         $(".section-wrapper.campaign > .container").animate( { 
            top: 60
         });
    }


}

resumeCampaignVideo = function()
{

    $(".grid-wrapper").remove();
    
    //flashObj.resume();   
} 

var isGridLoaded = false;

campaignCreateGrid = function(isFirst){  
    var MARKUP_GRID_CAMPAIGN = '<div class="grid-wrapper" style="z-index: 2;width: 100%;height: 100%; position: absolute;"><div id="grid"> \
        <ul id="grid-mover"> \
            <li class="item item-1" data-cols="4" data-rows="2"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images/01.jpg" /></li> \
            <li class="item item-2" data-cols="2" data-rows="2"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images/02.jpg" /></li> \
            <li class="item item-3" data-cols="4" data-rows="2"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images/03.jpg" /></li> \
            <li class="item item-4" data-cols="2" data-rows="1"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images/04.jpg" /></li> \
            <li class="item item-5" data-cols="2" data-rows="1"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images/05.jpg" /></li> \
            <li class="item item-6" data-cols="2" data-rows="1"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images/06.jpg" /></li> \
            <li class="item item-7" data-cols="2" data-rows="1"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images/07.jpg" /></li> \
            <li class="item item-8" data-cols="2" data-rows="2"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images/08.jpg" /></li> \
            <li class="item item-9" data-cols="2" data-rows="2"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images/09.jpg" /></li> \
            <li class="item item-10" data-cols="2" data-rows="2" do-not-dim non-interactive><img src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images/00_collection.jpg" /></li> \
            <li class="item item-11" data-cols="2" data-rows="2"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images/10.jpg" /></li> \
            <li class="item item-12" data-cols="2" data-rows="1"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images/11.jpg" /></li> \
            <li class="item item-13" data-cols="1" data-rows="1" data-min-distance="6" do-not-dim is-close-item><img src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images/00_back_'+CURRENT_LANGUAGE+'.jpg" /></li>\
            <li class="item item-14" data-cols="1" data-rows="1"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images/12.jpg" /></li> \
            <li class="item item-15" data-cols="2" data-rows="1"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images/13.jpg" /></li> \
            <li class="item item-16" data-cols="2" data-rows="1"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images/14.jpg" /></li> \
            <li class="item item-17" data-cols="2" data-rows="1"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images/15.jpg" /></li> \
            <li class="item item-18" data-cols="2" data-rows="2"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images/16.jpg" /></li> \
            <li class="item item-19" data-cols="2" data-rows="2"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images/17.jpg" /></li> \
            <li class="item item-20" data-cols="2" data-rows="1"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images/18.jpg" /></li> \
            <li class="item item-21" data-cols="2" data-rows="2"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images/19.jpg" /></li> \
            <li class="item item-22" data-cols="1" data-rows="1"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images/20.jpg" /></li> \
            <li class="item item-23" data-cols="2" data-rows="1"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images/21.jpg" /></li> \
            <li class="item item-24" data-cols="1" data-rows="1"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images/22.jpg" /></li> \
        </ul> \
    </div> \
    <div id="grid-content"> \
        <div tabindex="0" class="button previous">Previous</div> \
        <div tabindex="0" class="button next">Next</div> \
        <div tabindex="0" class="button close"  >Close</div> \
        <div class="item item-1" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images-big/01.jpg" > \
            <div class="hotspots"> \
                <div class="hotspot" style="left:43%; top:66.5%;" data-link="/product/magadi"> \
                    <h4>Magadi</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/shoes/Magadi.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-2" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images-big/02.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:39%; top:38.3%;" data-link="/product/nazca" > \
                    <h4>Nazca</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/shoes/Nazca.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-3" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images-big/03.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:12%; top:68.5%;" data-link="/product/magadi" > \
                    <h4>Magadi</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/shoes/Magadi.jpg"></div> \
                </div> \
                <div class="hotspot" style="left:48%; top:70.5%;" data-link="/product/tsingy" > \
                    <h4>Tsingy</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/shoes/Tsingy.jpg"></div> \
                </div> \
                <div class="hotspot" style="left:80%; top:74.8%;" data-link="/product/namib" > \
                    <h4>Namib</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/shoes/Namib.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-4" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images-big/04.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:52%; top:80%;" data-link="/product/uluru" > \
                    <h4>Uluru</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/shoes/Uluru.jpg"></div> \
                </div> \
                <div class="hotspot" style="left:48.5%; top:46%;" data-link="/product/yodel-annapurna" > \
                    <h4>Yodel Annapurna</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/shoes/YodelAnnapurna.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-5" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images-big/05.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:71%; top:64.7%;" data-link="/product/nambung" > \
                    <h4>Nambung</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/shoes/Nambung.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-6" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images-big/06.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:39.5%; top:61%;" data-link="/product/tsingy" > \
                    <h4>Tsingy</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/shoes/Tsingy.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-7" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images-big/07.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:39%; top:68.8%;" data-link="/product/pumori" > \
                    <h4>Pumori</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/shoes/Pumori.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-8" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images-big/08.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:67%; top:73.3%;" data-link="/product/uluru" > \
                    <h4>Uluru</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/shoes/Uluru.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-9" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images-big/09.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:47%; top:72.3%;" data-link="/product/nimrod-marrone" > \
                    <h4>Nimrod Marrone</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/shoes/NimrodMarrone.jpg"></div> \
                </div> \
                <div class="hotspot" style="left:89.3%; top:54.8%;" data-link="/product/uluru" > \
                    <h4>Uluru</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/shoes/Uluru.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-10" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images-big/10.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:86.5%; top:68.5%;" data-link="/product/antelope" > \
                    <h4>Antelope</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/shoes/Antelope.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-11" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images-big/11.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:78.5%; top:69.5%;" data-link="/product/antelope" > \
                    <h4>Antelope</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/shoes/Antelope.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-12" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images-big/12.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:65%; top:64.5%;" data-link="/product/magadi" > \
                    <h4>Magadi</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/shoes/Magadi.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-14" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images-big/13.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:28%; top:48.5%;" data-link="/product/nimrod-marrone" > \
                    <h4>Nimrod Marrone</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/shoes/NimrodMarrone.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-16" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images-big/14.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:39.5%; top:42.8%;" data-link="/product/myojin" > \
                    <h4>Myojin</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/shoes/Myojin.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-17" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images-big/15.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:20.5%; top:63.8%;" data-link="/product/kibo" > \
                    <h4>Kibo</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/shoes/Kibo.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-18" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images-big/16.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:84%; top:42.8%;" data-link="/product/beluka" > \
                    <h4>Beluka</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/shoes/Beluka.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-19" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images-big/17.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:60%; top:85.7%;" data-link="/product/elbrus" > \
                    <h4>Elbrus</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/shoes/Elbrus.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-20" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images-big/18.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:56%; top:82.5%;" data-link="/product/elbrus" > \
                    <h4>Elbrus</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/shoes/Elbrus.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-21" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images-big/19.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:59%; top:44.2%;" data-link="/product/norgay" > \
                    <h4>Norgay</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/shoes/Norgay.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-22" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images-big/20.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:38%; top:50%;" data-link="/product/norgay" > \
                    <h4>Norgay</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/shoes/Norgay.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-23" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images-big/21.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:68%; top:61%;" data-link="/product/richat" > \
                    <h4>Richat</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/shoes/Richat.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-24" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/images-big/22.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:77%; top:61.4%;" data-link="/product/cervin" > \
                    <h4>Cervin</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-fw13/images/shoes/Cervin.jpg"></div> \
                </div> \
            </div> \
        </div> \
    </div></div>';

    var s=false;

    $(".buttons-campaign,.backtovideo,#audio-button,.title-container").animate({opacity:0}, {duration:250, complete:function(){

        if (s==false)
        {

            
            $(".section-wrapper.campaign").append( MARKUP_GRID_CAMPAIGN );
            currentMode = "grid";
            $blocker.show();
            SatorisanGrid.onLoaded(function()
            {
                SatorisanGrid.init($(window).width(), window.innerHeight-(60+33), goBackToVideo);

                currentMode = "grid";

                if (isGridLoaded == false)
                {
                    globalBus.publish( 'satorisan', 'preloader-hide', { delay:0, complete:gridTransition } );
                    isGridLoaded = true;
                }
                else
                {
                    
                    gridTransition();
                }

                
            });

            
            if (isGridLoaded == false) globalBus.publish( 'satorisan', 'preloader-show', { mono:true } );
            
            if (Modernizr.csstransforms && !$.browser.msie)
            {
                $(".grid-wrapper").css({
                    top: $window.height()
                    /*'-webkit-transform': 'translate3D(0, '+$window.height()+'px,0)',
                    '-moz-transform': 'translate3D(0, '+$window.height()+'px,0)',
                    '-o-transform': 'translate3D(0, '+$window.height()+'px,0)',
                    '-ms-transform': 'translate3D(0, '+$window.height()+'px,0)'*/
                });
            }
            else
            {
                $(".grid-wrapper").css({
                    top:$window.height()
                });
            }

            s=true;
        }

    }});

    
}

function gridTransition()
{

    $blocker.hide();
    if (Modernizr.csstransforms && !$.browser.msie)
    {
        $(".grid-wrapper").addClass("transition-top").css( { 
            top: 60
        /*
            '-webkit-transform': 'translate3D(0, 0,0)',
            '-moz-transform': 'translate3D(0, 0,0)',
            '-o-transform': 'translate3D(0, 0,0)',
            '-ms-transform': 'translate3D(0, 0,0)'*/
         });

            var sw = false;
           $(".section-wrapper.campaign > .container").unbind(TRANSITION_END_EVENT).bind(TRANSITION_END_EVENT, function(){
                if (sw==false)
                {
                  $(".grid-wrapper").removeClass("transition-top");
                }
                sw = true;
            });

         $(".section-wrapper.campaign > .container").addClass("transition-top").css( { 
            'z-index' : 1,
            top: -Math.round($window.height()*0.25)
         /*   '-webkit-transform': 'translate3D(0, '+(0-$window.height()*0.25)+'px,0)',
            '-moz-transform': 'translate3D(0, '+(0-$window.height()*0.25)+'px,0)',
            '-o-transform': 'translate3D(0, 0,'+(0-$window.height()*0.25)+'px)',
            '-ms-transform': 'translate3D(0, '+(0-$window.height()*0.25)+'px,0)'*/
         });

       
    }
    else
    {
        (".grid-wrapper").animate( { 
            top: 0
         },
         {
            duration:750
         });

         $(".section-wrapper.campaign > .container").animate( { 
            top: (0-$window.height()*0.25)
         },
         {
            duration:750
         });
    }
}


var fromProductToMap = false;

Hydra.module.register( 'page-satori-heart-ss14', function( bus )
{
        var self;

        var PAGE_BODY_SELECTOR = "satori-heart-ss14";
        var isActive = false;

        var IMAGES_FOLDER = '/website/images/satori-heart/'

        var map;

        var currentZoom;
        var minZoom;
        var maxZoom;

        var mapCenter;

        var $highlightedBar;

        var $overlays;

        var $hotspotDetail;

        var $sectionWrapper;
        var $container;
        var $mapContainer;

        var storedCenter;
        var storedZoom;

        var resizeTimeout;

        function mapZoomStartHandler(e)
        {
            setTimeout(function()
            {
                currentZoom = e.target._zoomAnimated ? e.target._animateToZoom : e.target._zoom;
                updateZoomBar();
                updateZoomState();
            }, 1);
        }

        function mapZoomEndHandler(e)
        {
            currentZoom = map.getZoom();
            updateZoomBar();
            updateZoomState();
        }

        function updateZoomBar()
        {
            var ratio = (currentZoom - minZoom) / (maxZoom - minZoom);
            $highlightedBar.css('height', ratio * 100 + '%');
        }

        function updateZoomState()
        {
            if (currentZoom < 2)
            $mapContainer.addClass('no-markers');
            else
            $mapContainer.removeClass('no-markers');

            if (currentZoom == SATORI_HEART_ZOOM_LEVELS - 1)
            $mapContainer.addClass('big-markers');
            else
            $mapContainer.removeClass('big-markers');
        }

        function updatePopupsMargins()
        {
            $('.overlays .popup').each(function()
            {
                var $popup = $(this);
                $popup.css(
                {
                    left: Math.round($mapContainer.width()/2),
                    top: Math.round($mapContainer.height()/2),
                    marginLeft: Math.round(-$popup.outerWidth()/2),
                    marginTop: Math.round(-$popup.outerHeight()/2)
                });
            });
        }

        function closeOverlays()
        {
            var $closingOverlay = $overlays.find('.popup.opened');
            $closingOverlay.removeClass('opened');
            $overlays.removeClass('opened');

            if ($closingOverlay.hasClass('hotspot-detail'))
            setTimeout(hotspotDetailClosed, 300);
        }
        function openOverlays(name)
        {
            $overlays.find('.popup.opened').removeClass('opened');
            $overlays.children('.' + name).addClass('opened');
            $overlays.addClass('opened');
        }
                
        var $hotspotLoadingTitle;
        function openHotspotDetail(markerData)
        {
            if (!$hotspotLoadingTitle)
            {
                globalBus.publish( 'satorisan', 'preloader-show', { mono: true, delay: 350 } );
                $hotspotLoadingTitle = $('<img />');
                $hotspotLoadingTitle.on('load', function()
                {
                    openHotspotDetailEffective(markerData);
                });
                $hotspotLoadingTitle[0].src = IMAGES_FOLDER + 'titles/' + markerData.id + '.png';
            }
        }
        var $hotspotLoadingImage;
        function openHotspotDetailEffective(markerData)
        {
            $hotspotLoadingTitle = null;
            globalBus.publish( 'satorisan', 'preloader-hide', { mono: true, delay: 0 });
            $hotspotLoadingImage = $('<img />');
            $hotspotLoadingImage.on('load', function()
            {
                $hotspotDetail.find('.image-container').addClass('loaded');
            });
            $hotspotLoadingImage[0].src = IMAGES_FOLDER + 'place-thumbs/' + markerData.id + '.png';
            $hotspotDetail.find('.image').css('background-image', 'url(' + IMAGES_FOLDER + 'place-thumbs/' + markerData.id + '.png)');

            $hotspotDetail.find('.top .texts h2').text(markerData.name).css('background-image', 'url(' + IMAGES_FOLDER + 'titles/' + markerData.id + '.png)');
            $hotspotDetail.find('.top .texts .body').html(markerData.body[CURRENT_LANGUAGE]);
            $hotspotDetail.find('.bottom .text .body').html(markerData.footerBody[CURRENT_LANGUAGE]);
            $hotspotDetail.find('.more-info').attr('path', markerData.path);

            var $bottomImage = $('<img />');
            $bottomImage.on('load', function()
            {
                $hotspotDetail.find('.bottom').css('height', $hotspotDetail.find('.bottom-content').height());
            });
            $bottomImage[0].src = IMAGES_FOLDER + 'product-thumbs/' + markerData.id + '.png';
            $hotspotDetail.find('.bottom .product-image').append($bottomImage);

            openOverlays('hotspot-detail');
        }
        function hotspotDetailClosed()
        {
            $hotspotLoadingImage.off('load');
            $hotspotDetail.find('.image-container').removeClass('loaded');
            $hotspotDetail.find('.bottom .product-image').children().remove();
            $hotspotDetail.find('.bottom').css('height', '');
        }

        function createMap(passedCenter, passedZoom)
        {
            var tiles = L.tileLayer
            (
                '/website/webservices/map/{z}/{x}/{y}.png',
                {
                    noWrap: false,
                    continuousWorld: true
                }
            );
            tiles.on('load', function()
            {
                self.hidePreloader();
            });

            var northWest = new L.LatLng(0, 0),
            southEast = new L.LatLng(-SATORI_HEART_IMAGE_FULL_ZOOM_HEIGHT * SATORI_HEART_LEVEL_MULTIPLIERS[0], SATORI_HEART_IMAGE_FULL_ZOOM_WIDTH * SATORI_HEART_LEVEL_MULTIPLIERS[0]),
            bounds = new L.LatLngBounds(northWest, southEast);
            mapCenter = bounds.getCenter();

            minZoom = 0;
            while
            (
                SATORI_HEART_IMAGE_FULL_ZOOM_WIDTH * SATORI_HEART_LEVEL_MULTIPLIERS[minZoom] < $mapContainer.width()
                ||
                SATORI_HEART_IMAGE_FULL_ZOOM_HEIGHT * SATORI_HEART_LEVEL_MULTIPLIERS[minZoom] < $mapContainer.height()
            )
            minZoom++;

            maxZoom = SATORI_HEART_ZOOM_LEVELS - 1;

            var startCenter;
            var startZoom;
            if (passedCenter)
            {
                startCenter = passedCenter;
                startZoom = passedZoom;
            }
            else if (fromProductToMap)
            {
                fromProductToMap = false;
                
                startCenter = storedCenter;
                startZoom = storedZoom; 

                closeOverlays();
            }
            else
            {
                startCenter = mapCenter;
                startZoom = minZoom;
            }

            if (startZoom < minZoom)
            startZoom = minZoom

            map = L.map
            (
                $('.map-main')[0],
                {
                    center: startCenter,
                    zoom: startZoom,
                    minZoom: minZoom,
                    maxZoom: maxZoom,
                    maxBounds: bounds,
                    zoomControl: false,
                    attributionControl: false,
                    crs: L.CRS.Simple
                }
            );
            map.addLayer(tiles);

            for (var i = 0; i < SATORI_HEART.markers.length; i++)
            {
                (function()
                {
                    var markerData = SATORI_HEART.markers[i];
                    var newMarker = new L.marker(markerData.latLng,
                    {
                        icon: new L.divIcon(
                        {
                            className: 'custom-marker-icon',
                            html:
                            '\
                                <div class="icon">\
                                    <div class="small"></div>\
                                    <div class="big">\
                                        <img src="/website/images/satori-heart/marker-big.png" />\
                                    </div>\
                                </div>\
                            '
                        })
                    });
                    newMarker.addTo(map);
                    var $iconDiv = $(newMarker._icon);
                    $iconDiv.off('tapone').on('tapone', function()
                    {
                        openHotspotDetail(markerData);
                    });
                })();
            }

            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))
            $container.addClass('mobile');

            if ($container.hasClass('mobile'))
            map.on('zoomend', mapZoomEndHandler);
            else
            map.on('zoomstart', mapZoomStartHandler);

            currentZoom = map.getZoom();
        }

        return {
            
            /*-------------------------------*/
            /* PAGE CAMPAIGN */
            /*-------------------------------*/            

            init: function()
            {
                self = this;
                bus.subscribe('satorisan', this);
            },
            
            /*-------------------------------*/

            oEventsCallbacks: {
                'append-page' : function (data) {                    

                    if (isActive == false)
                    {
                        if (data.content == "satori-heart-ss14")
                        {                            
                            isActive = true;
                            isAlive = true;
                            bus.publish("satorisan", "ganalytics-track-path");
                            this.create();
                        }
                    }

                },
                
                'transition-out' : function(data)
                {
                    if (isActive && data.type == "satori-heart-ss14")
                    {
                        $container.animate({opacity: 0}, {duration: 800, specialEasing: {opacity: 'easeInOutCubic'}, complete: function()
                        {
                            $body.removeClass(PAGE_BODY_SELECTOR);                       
                            isActive = false;
                            isAlive = false;
                            data.complete();
                        }});
                    }
                },

                'destroy-page' : function(data)
                {
                    if (isActive)
                    {
                        this.stop();
                        data.complete();
                    }
                }
            },

            /*-------------------------------*/

            create: function()
            {
                $window.bind("resize", self.resize);

                var markup =
                "\
                    <div class='section-wrapper new-section " + PAGE_BODY_SELECTOR + "'>\
                        <div class='container'>\
                            <div class=\"map-container\">\
                                <div class=\"map-main\"></div>\
                                <div id=\"map-controls\">\
                                    <div class=\"zoom-button in\">\
                                        <div class=\"icon\">\
                                            <div class=\"over\"></div>\
                                        </div>\
                                    </div>\
                                    <div class=\"bar-container\">\
                                        <div class=\"bar\">\
                                            <div class=\"highlighted\"></div>\
                                        </div>\
                                    </div>\
                                    <div class=\"zoom-button out\">\
                                        <div class=\"icon\">\
                                            <div class=\"over\"></div>\
                                        </div>\
                                    </div>\
                                </div>\
                                <div id=\"rosa-de-los-vientos\"></div>\
                            </div>\
                            <div class=\"overlays opened\">\
                                <div class=\"popup splash opened\">\
                                    <h2>" + SATORI_HEART.splash.title[CURRENT_LANGUAGE] + "</h2>\
                                    <div class=\"body\">\
                                        " + SATORI_HEART.splash.body[CURRENT_LANGUAGE] + "\
                                    </div>\
                                    <div class=\"enter green-button\">" + SATORI_HEART.splash.explore[CURRENT_LANGUAGE] + "</div>\
                                </div>\
                                <div class=\"popup hotspot-detail\">\
                                    <div class=\"close\"></div>\
                                    <section class=\"top\">\
                                        <div class=\"image-container\">\
                                            <div class=\"image\"></div>\
                                        </div>\
                                        <div class=\"texts\">\
                                            <h2></h2>\
                                            <div class=\"body\">\
                                            </div>\
                                        </div>\
                                    </section>\
                                    <div class=\"bottom\">\
                                        <div class=\"bottom-content\">\
                                            <div class=\"text\">\
                                                <div class=\"body\"></div>\
                                                <div class=\"more-info green-button\">" + SATORI_HEART.moreInfo[CURRENT_LANGUAGE] + "</span></div>\
                                            </div><div class=\"product-image\"></div>" + // New line character removed from this line to solve Safari problem. Do NOT restore it.
                                        "</div>\
                                    </div>\
                                </div>\
                            </div>\
                        </div>\
                    </div>\
                ";
                $content.append(markup);

                $sectionWrapper = $content.children('.section-wrapper');
                $container = $sectionWrapper.children('.container');
                $mapContainer = $container.children('.map-container')
                
                var $goToGrid = $('<div class="go-to-grid green-button">' + SATORI_HEART.viewLookbook[CURRENT_LANGUAGE] + '</div>');
                $container.append($goToGrid);

                function isIE()
                {
                    var ua = window.navigator.userAgent;
                    var isIE = ua.indexOf("MSIE ") > 0 || !!ua.match(/Trident.*rv\:11\./);

                    return isIE;
                }

                if (isIE())
                $container.children().css('opacity', 'inherit');

                $container.css('opacity', 0);

                $goToGrid.on('click', function(e)
                {
                    globalBus.publish( 'satorisan', 'history-goto', { url: '/campaign-ss14' } );
                });
                
                if (CURRENT_FLOOR == null)
                {
                    CURRENT_FLOOR = 1;
                    
                    if (!user.HEADER_AND_FOOTER_CREATED)
                    {
                        Hydra.module.start("menu", 'menu_instance');
                        Hydra.module.start("footer", 'footer_instance'); 
                        user.HEADER_AND_FOOTER_CREATED = true;
                        bus.publish("satorisan", "menu-change-go", { data:"satori-heart-ss14" });
                    }

                    self.startLoadingPage();
                    bus.publish( 'satorisan', 'history-update' );
                    
                }
                else
                {
                    if (CURRENT_FLOOR == 0)
                    {
                        bus.publish( 'satorisan', 'transition-page', { type: "SLIDE_BOTTOM", complete: self.startLoadingPage } );
                        CURRENT_FLOOR = 1;
                    }
                    else
                    {
                        self.startLoadingPage();
                    }
                } 

                $body.addClass(PAGE_BODY_SELECTOR);
                bus.publish( 'satorisan', 'menu-change', { data:"satori-heart-ss14" } );

                user.IS_IN_TRANSITION = false;
            },


            startLoadingPage: function()
            {
                globalBus.publish( 'satorisan', 'preloader-show',
                {
                    header:"<div class='preloader-header-satori-heart'>" + SATORI_HEART.preloaderHeaderText[CURRENT_LANGUAGE] + "</div>", 
                    footer: SATORI_HEART.preloaderFooterText[CURRENT_LANGUAGE]
                });

                // Overlays
                $overlays = $('.overlays');
                $overlays.on('click', function(e)
                {
                    if (e.target == e.currentTarget)
                    closeOverlays();
                });
                $overlays.find('.splash .enter').add($overlays.find('.popup .close')).on('tapone', function(e)
                {
                    closeOverlays();
                });

                $hotspotDetail = $('.overlays .hotspot-detail');

                createMap();

                $hotspotDetail.find('.more-info').click(function()
                {
                    fromMapToProduct = true;
                    storedCenter = map.getCenter();
                    storedZoom = map.getZoom();
                    globalBus.publish( 'satorisan', 'history-goto', { url: $(this).attr('path') } );
                });

                // Controls
                var $zoomButtons = $('#map-controls .zoom-button');
                $zoomButtons.on('tapone', function(e)
                {
                    var $clickedButton = $(this);
                    if ($clickedButton.hasClass('in'))
                    map.zoomIn();
                    else
                    map.zoomOut();
                });
                $highlightedBar = $('#map-controls .highlighted');
                var $zoomBar = $('#map-controls .bar');
                $zoomBar.click(function(e)
                {
                    var y = e.pageY - $zoomBar.offset().top;
                    var ratio = 1 - y / $zoomBar.height();
                    var level = minZoom + Math.round((maxZoom - minZoom) * ratio);
                    map.setZoom(level);
                });
                updateZoomBar();
                updateZoomState();

                $window.bind('resize', updatePopupsMargins);
                updatePopupsMargins();
            },

            hidePreloader: function()
            {
                globalBus.publish( 'satorisan', 'preloader-hide', { delay:0, complete: self.launchPage } );
            },

            launchPage: function()
            {
                $container.animate({opacity: 1}, {duration: 1000, specialEasing: {opacity: 'easeInOutCubic'}});
            },
            /*-------------------------------*/

            resize:function()
            {
                clearTimeout(resizeTimeout);

                resizeTimeout = setTimeout(function()
                {
                    var storedCenter = map.getCenter();
                    var storedZoom = map.getZoom();
                    $('.map-main').replaceWith('<div class="map-main"></div>');
                    createMap(storedCenter, storedZoom);
                }, 300);
            },

            /*-------------------------------*/

            stop:function(){

                if (isActive)               
                {
                    $window.unbind("resize", self.resize);
                    isActive = false;
                }

                $body.removeClass(PAGE_BODY_SELECTOR);
            }

        
        }
    
});

 /*-------------------------------*/


goToGrid = function(link)
{
   globalBus.publish( 'satorisan', 'history-goto', { url: '/campaign-ss14' } );
}
var campaignSS14CreateGrid,
    campaignSS14ShowDetail,
    timeInterval,
    goToProductDescription,
    currentMode="grid",
    campaignDirectAccessPath="",
    idGridDetail=null;

var $backToMap;

Hydra.module.register( 'page-campaign-ss14', function( bus )
{ 
        var PAGE_BODY_SELECTOR = "campaign",
            isInEnd=false,
            introTimeout,
            isActive=false,
            isResume=false,
            unique = Math.round(Math.random()*1000);

        return {
            
            /*-------------------------------*/
            /* PAGE CAMPAIGN */
            /*-------------------------------*/            

            init: function(){
                $this = this;
                bus.subscribe('satorisan', this);
            },
            
            /*-------------------------------*/

            oEventsCallbacks: {
                'append-page' : function (data) {                    

                    if (isActive == false)
                    {
                        if (data.content == "campaign-ss14")
                        {                            
                            isActive = true;
                            isAlive = true;
                            bus.publish("satorisan", "ganalytics-track-path");
                            this.create();
                        }
                    }

                },
                
                'transition-out' : function(data)
                {
                    if (isActive && data.type=="campaign-ss14")
                    {
                        if (introTimeout) clearTimeout(introTimeout);
                        if (timeInterval) clearInterval(timeInterval);
                        $(".grid-wrapper").animate( { opacity:0 }, {duration:1000, specialEasing: {opacity: 'easeInOutCubic'}});
                        $backToMap.animate({opacity: 0}, {duration: 1000, specialEasing: {opacity: 'easeInOutCubic'}});
                        if (currentMode=="grid")
                        {
                            SatorisanGrid.destroy();    
                        }

                        $(".section-wrapper.campaign > .container").animate( { opacity:0 }, {duration:1000, complete:function(){
                            $body.removeClass(PAGE_BODY_SELECTOR);                       
                            isActive = false;
                            isAlive = false;
                            data.complete();
                        }} );

                    }
                },

                'destroy-page' : function(data)
                {
                    if (isActive)
                    {
                        if (introTimeout) clearTimeout(introTimeout);
                        if (timeInterval) clearInterval(timeInterval);
                        this.stop();
                        data.complete();
                    }
                }
            },

            /*-------------------------------*/

            create: function()
            {
                $window.bind("resize", $this.resize);

                var markup = "<div class='section-wrapper new-section " + PAGE_BODY_SELECTOR + "'><div class='container'><div class='buttons'></div><div class='title-container'></div></div></div>"
                $content.append(markup);

                var $wrapper = $(".section-wrapper");
                
                $backToMap = $('<div class="back-to-map green-button">' + SATORI_HEART.backToMap_campaign[CURRENT_LANGUAGE] + '</div>');
                $backToMap.click(function(e)
                {
                    globalBus.publish( 'satorisan', 'history-goto', { url: '/satori-heart-ss14' } );
                });
                $backToMap.css('opacity', 0);
                $wrapper.append($backToMap);

                if (CURRENT_FLOOR == null)
                {
                    CURRENT_FLOOR = 1;
                    
                    if (user.HEADER_AND_FOOTER_CREATED == false)
                    {
                        Hydra.module.start("menu", 'menu_instance');
                        Hydra.module.start("footer", 'footer_instance'); 
                        user.HEADER_AND_FOOTER_CREATED = true;
                        bus.publish("satorisan", "menu-change-go", { data:"campaign-ss14" });
                    }

                    campaignSS14CreateGrid();
                    bus.publish( 'satorisan', 'history-update' );
                    
                }
                else
                {
                    if (CURRENT_FLOOR == 0)
                    {
                        bus.publish( 'satorisan', 'transition-page', { type: "SLIDE_BOTTOM", complete: campaignSS14CreateGrid } );
                        CURRENT_FLOOR = 1;
                    }
                    else
                    {
                        campaignSS14CreateGrid();
                    }
                } 

                $body.addClass(PAGE_BODY_SELECTOR);
                bus.publish( 'satorisan', 'menu-change', { data:"campaign-ss14" } );

                user.IS_IN_TRANSITION = false;

            },


            /*-------------------------------*/


            gridAnimation:function()
            {
                currentMode = "video";
                
                SatorisanGrid.destroy();

                if (Modernizr.csstransforms && !$.browser.msie)
                {
                  
                   //$(".grid-wrapper").removeClass("transition-top");
                   $(".grid-wrapper").css( { 'z-index' : 1 });

                   $(".section-wrapper.campaign > .container").removeClass("transition-top");
                   $(".section-wrapper.campaign > .container").css( { 
                    'z-index' : 2,
                    top: 0-SS14video.videoHeight()
               /*     '-webkit-transform': 'translate3D(0, '+(0-$window.height())+'px,0)',
                    '-moz-transform': 'translate3D(0, '+(0-$window.height())+'px,0)',
                    '-o-transform': 'translate3D(0, 0,'+(0-$window.height())+'px)',
                    '-ms-transform': 'translate3D(0, '+(0-$window.height())+'px,0)'*/
                    });
                   

                   var sw = false;
                   $(".section-wrapper.campaign > .container").unbind(TRANSITION_END_EVENT).bind(TRANSITION_END_EVENT, function(){
                        if (sw==false)
                        {
                            $(".grid-wrapper").removeClass("transition-top");
                            $(".section-wrapper.campaign > .container").removeClass("transition-top");
                            $(".buttons-campaign,.backtovideo,#audio-button,.title-container").animate({opacity:1}, {duration:250});
                             $(".grid-wrapper").remove();
                            if (isiPad==false) $this.videoLoaded();
                        }
                        sw = true;
                    });

                   

                    setTimeout(function(){
                        $(".section-wrapper.campaign > .container").addClass("transition-top");
                        $(".grid-wrapper").addClass("transition-top");

                        $(".grid-wrapper").css( { 
                            top: Math.round($window.height()*0.75)

                         });

                         $(".section-wrapper.campaign > .container").css( { 
                            /*'z-index' : 1,*/
                            top: 0

                         });
                    },250);

                }
                else
                {
                    $(".grid-wrapper").css( { 
                        'z-index' : 1
                     });

                     $(".section-wrapper.campaign > .container").css( { 
                        'z-index' : 2
                     });


                     $(".grid-wrapper").animate( { 
                        top: ($window.height()*0.75),
                        complete:function(){
                            $(".buttons-campaign,.backtovideo,#audio-button,.title-container").animate({opacity:1}, {duration:250});
                             $(".grid-wrapper").remove();
                            if (isiPad==false) $this.videoLoaded();
                        }
                     });

                     $(".section-wrapper.campaign > .container").animate( { 
                        top: 60
                     });
                }
            },

            

            /*-------------------------------*/

            resize:function(){
               if (isFlash())
               {
                    //$( '#campaign-swf-container-' + unique ).css( { height : $window.height()-93 } );
               }
               else
               {
                    SatorisanGrid.updateDimensions($(window).width(), window.innerHeight-(60+33));
               }

               if (currentMode=="grid") SatorisanGrid.updateDimensions($(window).width(), window.innerHeight-(60+33));

               

            },

            /*-------------------------------*/

            stop:function(){

                if (isActive)               
                {
                    $window.unbind("resize", $this.resize);
                    isActive = false;

                    clearTimeout(introTimeout);
                    clearInterval(timeInterval);

                }

                $body.removeClass(PAGE_BODY_SELECTOR);
            }

        
        }
    
});

 /*-------------------------------*/


goToProductDescription = function(link)
{
   globalBus.publish( 'satorisan', 'history-goto', { url: "/product/" + link } );
}

var isGridLoaded = false;

campaignSS14CreateGrid = function(){  


    var MARKUP_GRID_CAMPAIGN = '<div class="grid-wrapper" style="z-index: 2;width: 100%;height: 100%; position: absolute;"><div id="grid"> \
        <ul id="grid-mover"> \
            <li class="item item-1" data-cols="4" data-rows="2"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images/01.jpg" /></li> \
            <li class="item item-2" data-cols="2" data-rows="2"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images/02.jpg" /></li> \
            <li class="item item-3" data-cols="4" data-rows="2"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images/03.jpg" /></li> \
            <li class="item item-4" data-cols="2" data-rows="1"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images/04.jpg" /></li> \
            <li class="item item-5" data-cols="2" data-rows="1"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images/05.jpg" /></li> \
            <li class="item item-6" data-cols="2" data-rows="1"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images/06.jpg" /></li> \
            <li class="item item-7" data-cols="2" data-rows="1"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images/07.jpg" /></li> \
            <li class="item item-8" data-cols="2" data-rows="2"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images/08.jpg" /></li> \
            <li class="item item-9" data-cols="2" data-rows="2"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images/09.jpg" /></li> \
            <li class="item item-10" data-cols="2" data-rows="2" do-not-dim non-interactive><img src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images/00_collection.jpg" /></li> \
            <li class="item item-11" data-cols="2" data-rows="2"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images/10.jpg" /></li> \
            <li class="item item-12" data-cols="2" data-rows="1"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images/11.jpg" /></li> \
            <li class="item item-13" data-cols="1" data-rows="1" do-not-dim non-interactive avoid-group="a"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images/00_1.jpg" /></li>\
            <li class="item item-14" data-cols="1" data-rows="1"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images/12.jpg" /></li> \
            <li class="item item-15" data-cols="2" data-rows="1"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images/13.jpg" /></li> \
            <li class="item item-16" data-cols="2" data-rows="1"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images/14.jpg" /></li> \
            <li class="item item-17" data-cols="1" data-rows="1" do-not-dim non-interactive avoid-group="a"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images/00_2.jpg" /></li>\
            <li class="item item-18" data-cols="2" data-rows="1"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images/15.jpg" /></li> \
            <li class="item item-19" data-cols="2" data-rows="2"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images/16.jpg" /></li> \
            <li class="item item-20" data-cols="2" data-rows="2"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images/17.jpg" /></li> \
            <li class="item item-21" data-cols="1" data-rows="1" do-not-dim non-interactive avoid-group="a"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images/00_3.jpg" /></li>\
            <li class="item item-22" data-cols="2" data-rows="1"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images/18.jpg" /></li> \
            <li class="item item-23" data-cols="2" data-rows="2"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images/19.jpg" /></li> \
            <li class="item item-24" data-cols="1" data-rows="1" non-interactive><img src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images/20.jpg" /></li> \
            <li class="item item-25" data-cols="2" data-rows="1" non-interactive><img src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images/21.jpg" /></li> \
            <li class="item item-26" data-cols="1" data-rows="1" non-interactive><img src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images/22.jpg" /></li> \
            <li class="item item-27" data-cols="4" data-rows="2"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images/23.jpg" /></li> \
            <li class="item item-28" data-cols="1" data-rows="1" non-interactive><img src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images/24.jpg" /></li> \
            <li class="item item-29" data-cols="1" data-rows="1" non-interactive><img src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images/25.jpg" /></li> \
            <li class="item item-30" data-cols="1" data-rows="1" non-interactive><img src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images/26.jpg" /></li> \
            <li class="item item-31" data-cols="1" data-rows="1"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images/27.jpg" /></li> \
            <li class="item item-32" data-cols="2" data-rows="1"><img src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images/28.jpg" /></li> \
        </ul> \
    </div> \
    <div id="grid-content"> \
        <div tabindex="0" class="button previous">Previous</div> \
        <div tabindex="0" class="button next">Next</div> \
        <div tabindex="0" class="button close"  >Close</div> \
        <div class="item item-1" data-align-bottom="0" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images-big/01.jpg" > \
            <div class="hotspots"> \
                <div class="hotspot" style="left:23%; top:82%;" data-link="/product/heisei-suede-moss-green" > \
                    <h4>Heisei Suede Moss Green</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/1-Heisei-Suede-Moss-Green.jpg"></div> \
                </div> \
                <div class="hotspot" style="left:38%; top:88%; " data-link="/product/hamoru-viper-brown" > \
                    <h4>Hamoru Viper Brown</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/2-Hamoru-Viper-Brown.jpg"></div> \
                </div> \
                <div class="hotspot" style="left:59%; top:89%; " data-link="/product/yasuragi-linen-graisse-fat" > \
                    <h4>Yasuragi Linen Graisse Fat</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/3-Yarusagi-Linen-Graisse-Fat.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-2" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images-big/02.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:35%; top:25%; " data-link="/product/tagomago-vaquero-jeans" > \
                    <h4>Tagomago Vaquero Jeans</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/4-Tagomago-Vaquero-Jeans.jpg"></div> \
                </div> \
                <div class="hotspot" style="left:60%; top:72%;" data-link="/product/kioku-vaquero-wine-wood" > \
                    <h4>Kioku Vaquero Wine Wood</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/5-Kioku-Vaquero-Wine-Wood.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-3" data-align-top="0" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images-big/03.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:40%; top:23%; " data-link="/product/tagomago-vaquero-rose-resin" > \
                    <h4 class="two-lines" >Tagomago Vaquero Rose Resin</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/6-Tagomago-Vaquero-Rose-Resin.jpg"></div> \
                </div> \
                <div class="hotspot" style="left:58%; top:18%; " data-link="/product/kugenuma-linen-graisse-fat" > \
                    <h4>Kugenuma Linen Graisse Fat</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/7-Kugenuma-Linen-Graisse-Fat.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-4" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images-big/04.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:21%; top:75%; " data-link="/product/yukai-napa-rose-resin" > \
                    <h4>Yukai Napa Rose Resin</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/8a-Yukai-Napa-Rose-Resin.jpg"></div> \
                </div> \
                <div class="hotspot" style="left:86%; top:35%;" data-link="/product/yukai-napa-coco" > \
                    <h4>Yukai Napa Coco</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/8b-Yukai-Napa-Coco.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-5" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images-big/05.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:57%; top:41%;" data-link="/product/sukkiri-linen-mega-marbre" > \
                    <h4>Sukkiri Linen Mega Marbre</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/9-Sukkiri-Linen-Mega-Marbre.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-6" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images-big/06.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:24%; top:58%;" data-link="/product/hamoru-tropic-yeso" > \
                    <h4>Hamoru Tropic Yeso</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/10-Homoru-Fantasy-Tropic-Yeso.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-7" data-align-bottom="0" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images-big/07.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:68%; top:87%;" data-link="/product/benirras-vaquero-jeans" > \
                    <h4>Benirras Vaquero Jeans</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/11-Benirras-Vaquero-Jeans.jpg"></div> \
                </div> \
                <div class="hotspot" style="left:89%; top:82%;" data-link="/product/benirras-vaquero-gravel" > \
                    <h4>Benirras Vaquero Gravel</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/12-Benirras-Vaquero-Gravel.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-8" data-align-bottom="0" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images-big/08.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:55%; top:82%;" data-link="/product/hamoru-viper-turquesa" > \
                    <h4>Hamoru Viper Turquesa</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/13-Hamoru-Viper-Turquesa.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-9" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images-big/09.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:83%; top:65%; z-index:10;" data-link="/product/kioku-vaquero-wine-wood" > \
                    <h4>Kioku Vaquero Wine Wood</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/14-Kioku-Vaquero-Wine-Wood.jpg"></div> \
                </div> \
                <div class="hotspot" style="left:90%; top:56%;" data-link="/product/benirras-vaquero-gravel" > \
                    <h4>Benirras Vaquero Gravel</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/15-Benirras-Vaquero-Gravel.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-11" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images-big/10.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:32%; top:65%;" data-link="/product/yasuragi-linen-giallo" > \
                    <h4>Yasuragi Linen Giallo</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/16-Yasuragi-Linen-Giallo.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-12" data-align-bottom="0" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images-big/11.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:63%; top:93%; z-index:10;" data-link="/product/jet-bondi-gravel" > \
                    <h4>Jet Bondi Gravel</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/17-Jet-Bondi-Gravel.jpg"></div> \
                </div> \
                <div class="hotspot" style="left:65%; top:69%;" data-link="/product/jet-bondi-saxony-blue" > \
                    <h4>Jet Bondi Saxony Blue</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/18-Jet-Bondi-Saxony-Blue.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-14" data-align-bottom="0" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images-big/12.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:48%; top:79%; " data-link="/product/jet-bondi-gravel" > \
                    <h4>Jet Bondi Gravel</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/19-Jet-Bondi-Gravel.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-15" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images-big/13.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:26%; top:45%;" data-link="/product/heisei-tie-dye-bottle-green" > \
                    <h4>Heisei Tie Dye Bottle Green</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/20-Heisei-Tie-Dye-Bottle-Green.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-16" data-align-bottom="0" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images-big/14.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:31%; top:80%;" data-link="/product/hamoru-tropic-coral" > \
                    <h4>Hamoru Tropic Coral</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/21-Hamoru-Tropic-Coral.jpg"></div> \
                </div> \
                <div class="hotspot" style="left:38%; top:79%;" data-link="/product/sukkiri-linen-fango" > \
                    <h4>Sukkiri Linen Fango</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/22-Sukkiri-Linen-Fango.jpg"></div> \
                </div> \
                <div class="hotspot" style="left:53%; top:83%;" data-link="/product/heisei-tie-dye-saxony-blue" > \
                    <h4>Heisei Tie Dye Saxony Blue</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/23-Heisei-Tie-Dye-Saxony-Blue.jpg"></div> \
                </div> \
                <div class="hotspot" style="left:74%; top:90%;" data-link="/product/yukai-napa-cuero" > \
                    <h4>Yukai Napa Cuero</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/24-Yukai-Napa-Cuero.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-18" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images-big/15.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:62%; top:62%;" data-link="/product/sukkiri-linen-fango" > \
                    <h4>Sukkiri Linen Fango</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/25-Sukkiri-Linen-Fango.jpg"></div> \
                </div> \
                <div class="hotspot" style="left:85%; top:72%;" data-link="/product/heisei-tie-dye-saxony-blue" > \
                    <h4>Heisei Tie Dye Saxony Blue</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/26-Heisei-Tie-Dye-Saxony-Blue.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-19" data-align-bottom="0" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images-big/16.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:49%; top:95%;" data-link="/product/benirras-vaquero-wine-wood" > \
                    <h4>Benirras Vaquero Wine Wood</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/27-Benirras-Vaquero-Wine-Wood.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-20" data-align-bottom="0" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images-big/17.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:14%; top:89%;" data-link="/product/benirras-vaquero-wine-wood" > \
                    <h4>Benirras Vaquero Wine Wood</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/28-Benirras-Vaquero-Wine-Wood.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-22" data-align-bottom="0" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images-big/18.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:59%; top:94%;" data-link="/product/benirras-vaquero-jeans" > \
                    <h4>Benirras Vaquero Jeans</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/29-Benirras-Vaquero-Jeans.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-23" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images-big/19.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:66%; top:63%;" data-link="/product/tagomago-vaquero-rose-resin" > \
                    <h4 class="two-lines" >Tagomago Vaquero Rose Resin</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/30-Tagomago-Vaquero-Rose-Resin.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-27" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images-big/23.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:59%; top:77%;" data-link="/product/kioku-vaquero-wine-wood" > \
                    <h4>Kioku Vaquero Wine Wood</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/31-Kioku-Vaquero-Wine-Wood.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-31" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images-big/27.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:64%; top:74%;" data-link="/product/yasuragi-linen-giallo" > \
                    <h4>Yasuragi Linen Giallo</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/32-Yasuragi-Linen-Giallo.jpg"></div> \
                </div> \
            </div> \
        </div> \
        <div class="item item-32" data-image="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/images-big/28.jpg"> \
            <div class="hotspots"> \
                <div class="hotspot" style="left:62%; top:52%;" data-link="/product/heisei-tie-dye-broken-glass" > \
                    <h4>Heisei Tie Dye Broken Glass</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/33-Heisei-Tie-Dye-Broken-Glass.jpg"></div> \
                </div> \
                <div class="hotspot" style="left:83%; top:42%;" data-link="/product/heisei-tie-dye-rose-resin" > \
                    <h4>Heisei Tie Dye Rose Resin</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/35-Heisei-Tie-Dye-Rose-Resin.jpg"></div> \
                </div> \
                <div class="hotspot" style="left:71%; top:80%;" data-link="/product/heisei-tie-dye-graisse-fat" > \
                    <h4>Heisei Tie Dye Graisse Fat</h4> \
                    <div class="shoe" data-src="https://s3-eu-west-1.amazonaws.com/satorisan-ss14/campaign/shoes/34-Heisei-Tie-Dye-Graisse-Fat.jpg"></div> \
                </div> \
            </div> \
        </div> \
    </div></div>';

    var s=false;

    $(".buttons-campaign,.backtovideo,#audio-button,.title-container").animate({opacity:0}, {duration:250, complete:function(){

        if (s==false)
        {

            $(".section-wrapper.campaign").append( MARKUP_GRID_CAMPAIGN );
            currentMode = "grid";
            $blocker.show();
            SatorisanGrid.onLoaded(function()
            {
                SatorisanGrid.init($(window).width(), window.innerHeight-(60+33), goBackToVideo);

                currentMode = "grid";

                if (isGridLoaded == false)
                {
                    globalBus.publish( 'satorisan', 'preloader-hide', { delay:0, complete: gridTransition } );
                    isGridLoaded = true;
                }
                else
                {
                    gridTransition();
                }
            });

            
            if (isGridLoaded == false){
                var headerText = "Campaign";
                var footerText = "SPRING SUMMER 14";
                if (CURRENT_LANGUAGE=="es")
                {
                    headerText = "Campaña";
                    footerText = "PRIMAVERA VERANO 14";
                }
                globalBus.publish( 'satorisan', 'preloader-show', { 
                    header:"<div class='preloader-header-campaign'>"+headerText+"</div>", 
                    footer:footerText
                } );
                
            } 
            //globalBus.publish( 'satorisan', 'preloader-show', { mono:true } );
            
            if (Modernizr.csstransforms && !$.browser.msie)
            {
                $(".grid-wrapper").css({
                    top: $window.height()
                    /*'-webkit-transform': 'translate3D(0, '+$window.height()+'px,0)',
                    '-moz-transform': 'translate3D(0, '+$window.height()+'px,0)',
                    '-o-transform': 'translate3D(0, '+$window.height()+'px,0)',
                    '-ms-transform': 'translate3D(0, '+$window.height()+'px,0)'*/
                });
            }
            else
            {
                $(".grid-wrapper").css({
                    top:$window.height()
                });
            }

            s=true;
        }

    }});
    
    function gridTransition()
    {
        $blocker.hide();

        //console.log($backToMap);

        if (Modernizr.csstransforms && !$.browser.msie)
        {
            $(".grid-wrapper").addClass("transition-top").css('top', 60);

            var completeDone = false;
            setTimeout(function ()
            {
                if (!completeDone)
                {
                    $(".grid-wrapper").removeClass("transition-top");
                    $backToMap.animate({opacity: 1}, {duration: 300, specialEasing: {opacity: 'easeInOutCubic'}});
                }
                completeDone = true;
            }
            , 1100);

            $(".section-wrapper.campaign > .container").addClass("transition-top").css(
            {
                zIndex: 1,
                top: -Math.round($window.height() * .25)
            });
        }
        else
        {
            (".grid-wrapper").animate(
            { 
                top: 0
            },
            {
                duration: 750,
                complete: function()
                {
                    $backToMap.animate({opacity: 1}, {duration: 300, specialEasing: {opacity: 'easeInOutCubic'}});
                }
            });

             $(".section-wrapper.campaign > .container").animate( { 
                top: (0-$window.height()*0.25)
             },
             {
                duration:750
             });
        }
    }
}



Hydra.module.register( 'page-technology', function( bus )
{
	function has3d()
	{
		var el = document.createElement('p'), 
			has3d,
			transforms = {
				'webkitTransform':'-webkit-transform',
				'OTransform':'-o-transform',
				'msTransform':'-ms-transform',
				'MozTransform':'-moz-transform',
				'transform':'transform'
			};

		// Add it to the body to get the computed style.
		document.body.insertBefore(el, null);

		for (var t in transforms) {
			if (el.style[t] !== undefined) {
				el.style[t] = "translate3d(1px,1px,1px)";
				has3d = window.getComputedStyle(el).getPropertyValue(transforms[t]);
			}
		}

		document.body.removeChild(el);

		return (has3d !== undefined && has3d.length > 0 && has3d !== "none");
	}
	
	var use3D;
	var useSmall;
	
	var FRAME_RATE = 30;

	var WIDTH_BIG = 833;
	var HEIGHT_BIG = 540;

	var WIDTH_SMALL = 583;
	var HEIGHT_SMALL = 378;
	
	var widgetWidth;
	var widgetHeight;
	
	var WIPER_MARGIN_BIG = 50;
	var WIPER_MARGIN_SMALL = 35;
	
	var wiperMargin;
	
	var SPRITES_COUNT = 7;
	var STEPS_PER_SPRITE = 4;
	
	var CLOSED_SOLE_TOP_BIG = 73; 
	var OPENED_SOLE_TOP_BIG = 20;
	
	var CLOSED_SOLE_TOP_SMALL = 51;
	var OPENED_SOLE_TOP_SMALL = 14;
	
	var closedSoleTop;
	var openedSoleTop;
	
	var animationTopFix;
	
	var FOOTPRINT_START = 1;
	var FOOTPRINT_FLIP_POINT = 2;
	var FOOTPRINT_END = 13;
	var SPIRIT_START = 14;
	var SPIRIT_FLIP_POINT = 15;
	var SPIRIT_END = 24;
	
	var OUTLOOK = "outlook";
	var FOOTPRINT = "footprint";
	var SPIRIT = "spirit";
	
	var TIMELINE_POSITIONS = 
	[
		OUTLOOK,
		FOOTPRINT,
		SPIRIT
	];
	
	
	var state = OUTLOOK;
	
	var $contentContainer;
	var $techWidget;
	var $shoe;
	var $sole;
	var $soleHSContainer;
	var $shadows;
	var $soleRed;
	var $soleRedOffsetter;
	var $soleRedTop;
	var $soleRedSide;
	var $soleBlack;
	var $switcher;
	var $switcherSoles;
	var $wiperReel;
	var $wiper;
	var $dragger;
	var $draggerText;
	var $animation;
	var $animationMover;
	var $hotspotsContainer;
	var $hotspots;
	var $showingHotspots = $();
	
	var $sprites = $();
	var $ramSprites = $();
	
	var currentFrame = 0;
	var pendingAnimationSteps = [];
	
	var soleWipe = {ratio: 0};
	var $soleWipe = $(soleWipe);	
	
	var closeLastBalloon;
		
	function showWiper()
	{
		$shoe.css({overflow: 'hidden'});
		$wiperReel.css({display: 'block'}).stop(true).animate({opacity: 1}, { duration: 400, specialEasing: {opacity: 'easeInOutCubic'}});
		$wiper.css({display: 'block'}).stop(true).animate({opacity: 1}, { duration: 400, specialEasing: {opacity: 'easeInOutCubic'}});
	}
	
	function hideWiper()
	{
		$shoe.css({overflow: 'visible'});
		$wiperReel.stop(true, true).animate({opacity: 0}, { duration: 400, specialEasing: {opacity: 'easeInOutCubic'}, complete: function()
		{
			$wiperReel.css({display: 'none'});
		}});
		$wiper.stop(true, true).animate({opacity: 0}, { duration: 400, specialEasing: {opacity: 'easeInOutCubic'}, complete: function()
		{
			$wiper.css({display: 'none'});
		}});
	}
	
	var wipeOpened = false;
	function closeWipe(fast)
	{
		var duration;
		if (fast)
		{
			duration = 850;
		}
		else
		{
			var distance = Math.abs(Number($wiper.css('left').split('px').join('')) - wiperMargin);
			var durationRatio = distance / (widgetWidth / 2);
			duration = 150 + 500 * durationRatio;
		}
		$wiper.animate({left: wiperMargin}, {duration: duration, specialEasing: {left: 'easeOutCubic'}, step: updateWipes, complete: function()
		{
			updateWipes();
			wipeOpened = false;
			soleWipe.ratio = 0;
			updateSoleWipe();
			blackSoleOpened = false;
			updateSwitcher();
		}});
	}
	
	var closeWipeTimeout;
	var smartCloseCallbackTimeout;
	function wipeSmartClose(callback)
	{
		closeSole();
		hideSwitcher();
		if (closeWipeTimeout) clearTimeout(closeWipeTimeout);
		if (smartCloseCallbackTimeout) clearTimeout(smartCloseCallbackTimeout);
		closeWipeTimeout = setTimeout(function (){closeWipe(true);}, 350);
		smartCloseCallbackTimeout = setTimeout(callback, 960);
	}
	
	function openWipe()
	{
		wipeOpened = true;
		var distance = Math.abs(Number($wiper.css('left').split('px').join('')) - (widgetWidth - wiperMargin));
		var durationRatio = distance / (widgetWidth / 2);
		$wiper.animate({left: widgetWidth - wiperMargin}, {duration: 150 + 500 * durationRatio, specialEasing: {left: 'easeOutCubic'}, step: updateWipes, complete: function()
		{
			updateWipes();
			openSole();
		}});
	}
	
	function openSole()
	{
		$soleRedTop.stop(true).animate({top: openedSoleTop}, { duration: 400, specialEasing: {top: 'easeInOutCubic'}, complete: function()
		{
			$shadows.stop(true).animate({opacity: 1}, { duration: 400, specialEasing: {opacity: 'easeInOutCubic'}});
			$soleRedSide.stop(true).animate({opacity: 1}, { duration: 400, specialEasing: {opacity: 'easeInOutCubic'}});
			showHotspots();
		}});
		$soleBlackTop.stop(true).animate({top: openedSoleTop}, { duration: 400, specialEasing: {top: 'easeInOutCubic'}, complete: function()
		{
			$soleBlackSide.stop(true).animate({opacity: 1}, { duration: 400, specialEasing: {opacity: 'easeInOutCubic'}});
		}});
		showSwitcher();
	}
	
	function closeSole()
	{
		hideHotspots();
		$shadows.stop(true).animate({opacity: .5}, { duration: 200, specialEasing: {opacity: 'easeInOutCubic'}});
		$soleRedSide.stop(true).animate({opacity: 0}, { duration: 200, specialEasing: {opacity: 'easeOutCubic'}});
		$soleRedTop.stop(true).animate({top: closedSoleTop}, { duration: 300, specialEasing: {top: 'easeInOutCubic'}});
		$soleBlackSide.stop(true).animate({opacity: 0}, { duration: 200, specialEasing: {opacity: 'easeOutCubic'}});
		$soleBlackTop.stop(true).animate({top: closedSoleTop}, { duration: 300, specialEasing: {top: 'easeInOutCubic'}});
	}
	
	var blackSoleOpened = false;
	function showSwitcher()
	{
		$switcher.css({display: 'block'}).stop(true).animate({opacity: 1}, { duration: 300, specialEasing: {opacity: 'easeInOutCubic'}});
		$switcher.mouseenter(switcherEnterHandler);
		$switcher.mouseleave(switcherLeaveHandler);
		$switcher.click(switcherClickHandler);
	}
	function hideSwitcher()
	{
		$switcher.unbind('mouseenter', switcherEnterHandler);
		$switcher.unbind('mouseleave', switcherLeaveHandler);
		$switcher.unbind('click', switcherClickHandler);
		$switcher.stop(true).animate({opacity: 0}, { duration: 300, specialEasing: {opacity: 'easeInOutCubic'}, complete: function()
		{
			$switcher.css({display: 'none'});
		}});
	}
	
	function switcherEnterHandler()
	{
		/* if (blackSoleOpened)
		{
			halfOpenRedSole();
		}
		else
		{
			halfOpenBlackSole();
		} */
		
		$switcherSoles.css({transform: 'scale(1)'});
	}
	function switcherLeaveHandler()
	{
		/* if (blackSoleOpened)
		{
			openBlackSole();
		}
		else
		{
			closeBlackSole();
		} */
		$switcherSoles.css({transform: 'scale(.9)'});
	}
	function switcherClickHandler()
	{
		hideHotspots();
		if (blackSoleOpened)
		{
			closeBlackSole();
			blackSoleOpened = false;
			updateSwitcher();
		}
		else
		{
			openBlackSole();
			blackSoleOpened = true;
			updateSwitcher();
		}
	}
	
	function updateSwitcher()
	{
		if (blackSoleOpened)
		{
			$switcherBlack.stop(true).animate({opacity: 0}, { duration: 300, specialEasing: {opacity: 'easeInOutCubic'}});
			$switcherRed.stop(true).delay(300).animate({opacity: 1}, { duration: 300, specialEasing: {opacity: 'easeInOutCubic'}});
		}
		else
		{
			$switcherRed.stop(true).animate({opacity: 0}, { duration: 300, specialEasing: {opacity: 'easeInOutCubic'}});
			$switcherBlack.stop(true).delay(300).animate({opacity: 1}, { duration: 300, specialEasing: {opacity: 'easeInOutCubic'}});
		}
	}
	
	/* function halfOpenBlackSole()
	{
		$soleWipe.stop(true).animate({ratio: .25}, {duration: 400, step: updateSoleWipe, complete: updateSoleWipe, specialEasing: {ratio: 'easeInOutCubic'}});
	}
	
	function halfOpenRedSole()
	{
		$soleWipe.stop(true).animate({ratio: .75}, {duration: 400, step: updateSoleWipe, complete: updateSoleWipe, specialEasing: {ratio: 'easeInOutCubic'}});
	} */
	
	function openBlackSole()
	{
		$soleWipe.stop(true).animate({ratio: 1}, {duration: 400, step: updateSoleWipe, specialEasing: {ratio: 'easeInOutCubic'}, complete: function()
		{
			updateSoleWipe();
			showHotspots();
		}});
	}
	
	function closeBlackSole()
	{
		$soleWipe.stop(true).animate({ratio: 0}, {duration: 400, step: updateSoleWipe, specialEasing: {ratio: 'easeInOutCubic'}, complete: function()
		{
			updateSoleWipe();
			showHotspots();
		}});
	}
	
	function updateSoleWipe()
	{
		var left = widgetWidth * soleWipe.ratio;
		$soleRed.css({left: left});
		$soleRedOffsetter.css({left: -left});
		$soleBlack.css({width: left});
	}
	
	function updateWipes()
	{
		var left = Number($wiper.css('left').split('px').join(''));
		$shoe.css({width: widgetWidth - left});
		$hotspotsContainer.css({left: -left});
		$sole.css({width: left});
	}
	
	var animateInterval;
	function animate()
	{
		hideHotspots();
		hideWiper();
		setTimeout(function ()
		{
			if (animateInterval) clearInterval(animateInterval);
			animateInterval = setInterval(animateHandler, 1000/FRAME_RATE);
		}, 300);
	}
	function animateHandler()
	{
		if (pendingAnimationSteps.length)
		{
			var currentStep = pendingAnimationSteps[0];
			switch (currentStep.type)
			{
				case 'animate':
					var newFrame = currentFrame;
					if (currentStep.frame > currentFrame) newFrame++;
					if (currentStep.frame < currentFrame) newFrame--;
					updateFrame(newFrame);
					if (currentStep.frame == currentFrame)
					pendingAnimationSteps.shift();
					break;
				case 'jump':
					updateFrame(currentStep.frame);
					pendingAnimationSteps.shift();
					break;
			}
		}
		else animationComplete();
	}
	function updateFrame(newFrame)
	{
		$animationMover.css({ top: animationTopFix - widgetHeight * newFrame });
		currentFrame = newFrame;
	}
	function animationComplete()
	{
		clearInterval(animateInterval);
		animateInterval = null;
		if (state == SPIRIT) showWiper();
		else showHotspots();
	}
	function hideHotspots()
	{
		if (closeLastBalloon) closeLastBalloon();
		$showingHotspots.each(function(i)
		{
			var $hotspot = $(this);
			$hotspot.stop(true).delay(i*100).animate({opacity: 0}, { duration: 300, specialEasing: {opacity: 'easeInOutCubic'}, complete: function()
			{
				$hotspot.css('display', 'none');
			}});
		});
	}
	function showHotspots()
	{
		if (state == SPIRIT)
		{
			if (blackSoleOpened)
			{
				
				$showingHotspots = $hotspots.filter('.black-sole');
			}
			else
			{
				$showingHotspots = $hotspots.filter('.red-sole');
			}
		}
		else $showingHotspots = $hotspots.filter('.' + state);
		$showingHotspots.css('display', 'block');
		$showingHotspots.each(function(i)
		{
			var $hotspot = $(this);
			$hotspot.stop(true).delay(i*50).animate({opacity: 1}, { duration: 250, specialEasing: {opacity: 'easeInOutCubic'}});
		});
	}
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
        var $this, isActive=false, PAGE_BODY_SELECTOR="tech";

        return {
            
            /*-------------------------------*/
            /* PAGE CAMPAIGN */
            /*-------------------------------*/            

            init: function(){
                $this = this;
                bus.subscribe('satorisan', this);
            },
            

            /*-------------------------------*/

            oEventsCallbacks: {
                
                'append-page' : function (data) {                    
                    if (isActive==false)
                    {
                        
                        if (data.content == "tech")
                        {
                        	bus.publish("satorisan", "ganalytics-track-path");
                        	currentFrame = 0;
                        	state = OUTLOOK;
							useSmall = ($window.height() < 690);
							
							if (useSmall)
							{
								widgetWidth = WIDTH_SMALL;
								widgetHeight = HEIGHT_SMALL;
	
								closedSoleTop = CLOSED_SOLE_TOP_SMALL;
								openedSoleTop = OPENED_SOLE_TOP_SMALL;
								
								wiperMargin = WIPER_MARGIN_SMALL;
								
								animationTopFix = -1;
							}
							else
							{
								widgetWidth = WIDTH_BIG;
								widgetHeight = HEIGHT_BIG;
	
								closedSoleTop = CLOSED_SOLE_TOP_BIG;
								openedSoleTop = OPENED_SOLE_TOP_BIG;
								
								wiperMargin = WIPER_MARGIN_BIG;
								
								animationTopFix = 0;
							}
							
                            currentDetail = 0;
                            currentMode = "list";
                            isActive=true;
							
							var pageContent = CURRENT_LANGUAGE == 'en' ? TEMPLATE_TECH_EN : TEMPLATE_TECH_ES;
							$contentContainer = $('<div class="tech-container"/>').css('opacity', 0);
							if (useSmall) $contentContainer.addClass('small');
							$contentContainer.append(pageContent);
							var $sectionWrapper = $("<div class='section-wrapper new-section " + PAGE_BODY_SELECTOR + "'/>");
							$sectionWrapper.append($contentContainer);
                            $content.append($sectionWrapper);
							
                            $container = $("." + PAGE_BODY_SELECTOR)
							
							timeline = new TechTimeline();
							$('#filter-quantity-widget').css({bottom: -77});
							
                            $this.create();

                        }
                    }
                },
                
                'transition-out' : function(data)
                {

                    if (isActive && data.type == "tech")
                    {
                        $body.removeClass(PAGE_BODY_SELECTOR);
                        $blocker.show();
						$('#filter-quantity-widget').stop(true).animate({bottom: -77}, { duration: 700, complete:function(){
							timeline.removeMenu();
							timeline = undefined;
							$contentContainer.stop(true).animate({opacity: 0}, {duration: 1000, specialEasing: {opacity: 'easeInOutCubic'}, complete: function()
							{
								$contentContainer.remove();
								if(data) data.complete();
							}});
							
						} });
						
						isActive = false;
                    }
                },

                'destroy-page' : function(data)
                {
                    
                    if (isActive)
                    {
                        $this.stop();
                        if (data) data.complete();
                    }
                }
            },

            /*-------------------------------*/

            create: function()
			{
                
				use3D = has3d();
				
				$techWidget = $('#tech-widget');
				$shoe = $techWidget.children('.shoe');
				$sole = $techWidget.children('.sole');
				$shadows = $sole.find('.shadow');
				$soleRed = $sole.children('.red');
				$soleRedOffsetter = $soleRed.children('.offsetter');
				$soleRedTop = $soleRedOffsetter.children('.top');
				$soleRedSide = $soleRedOffsetter.children('.side');
				$soleBlack = $sole.children('.black');
				$soleBlackTop = $soleBlack.children('.top');
				$soleBlackSide = $soleBlack.children('.side');
				$switcher = $techWidget.children('.switcher');
				$switcherSoles = $switcher.find('.switcher-sole');
				$switcherBlack = $switcher.children('.black');
				$switcherRed = $switcher.children('.red');
				$wiperReel = $techWidget.children('.wiper-reel');
				$wiper = $techWidget.children('.wiper');
				$dragger = $wiper.children('.dragger');
				$draggerText = $wiper.children('.dragger-text');
				$animation = $shoe.children('.animation');
				$hotspotsContainer = $techWidget.find('.hotspots-container');
				$hotspots = $techWidget.find('.hotspot');
				
				$techWidget.css({opacity: 0.1});
				$wiperReel.css({opacity: 0});
				$wiper.css({opacity: 0});
				$switcher.css({opacity: 0});
				$switcherSoles.css({transform: 'scale(.9)'});
				$switcherRed.css({opacity: 0});
				$soleRedSide.css({opacity: 0});
				$shadows.css({opacity: .5});
				
				$soleHSContainer = $('<div id="sole-hotspots-container"/>');
				$sole.before($soleHSContainer);
				
				//DragCursor.open($dragger);
				
				var $ramsContainer = $('<div class="rams-container" />');
				
				for (var i = 0; i < SPRITES_COUNT; i++)
				{
					(function()
					{
						var index = i;
						var $sprite = $("<div class='sprite sprite-" + (i+1) + "'></div>");
						var $spriteRam = $sprite.clone().addClass('keep-on-ram');
						
						$sprite.css('opacity', 0);
						$sprite.data('top', index * widgetHeight * 4);
						
						//hideSprite($sprite);
						$spriteRam.css({opacity: 0});
						
						$sprites = $sprites.add($sprite);
						$ramSprites = $ramSprites.add($spriteRam);
						
						$ramsContainer.append($spriteRam);
					})();
				}
				$animation.before($ramsContainer);
				$animation.append($sprites);
				$animationMover = $('<div class="mover"/>');
				$animation.append($animationMover);
				$animation.children().not('.mover').appendTo($animationMover);
				
				$window.bind('techTimelineUpdate', function(e)
				{
					var linkClass = TIMELINE_POSITIONS[e.positionIndex];
					if (state == SPIRIT && wipeOpened)
					{
						wipeSmartClose(function()
						{
							startTransition(linkClass);
						});
					}
					else
					{
						startTransition(linkClass);
					}
				});
				
				function startTransition(linkClass)
				{
					switch (linkClass)
					{
						case FOOTPRINT:
							switch(state)
							{
								case OUTLOOK:
									pendingAnimationSteps.push({type: 'animate', frame: FOOTPRINT_END});
									animate();
									break;
								case SPIRIT:
									pendingAnimationSteps.push({type: 'animate', frame: SPIRIT_FLIP_POINT});
									pendingAnimationSteps.push({type: 'jump', frame: FOOTPRINT_FLIP_POINT});
									pendingAnimationSteps.push({type: 'animate', frame: FOOTPRINT_END});
									animate();
									break;
							}
							state = FOOTPRINT;
							break;
						case OUTLOOK:
							switch(state)
							{
								case FOOTPRINT:
									pendingAnimationSteps.push({type: 'animate', frame: 0});
									animate();
									break;
								case SPIRIT:
									pendingAnimationSteps.push({type: 'animate', frame: SPIRIT_START});
									pendingAnimationSteps.push({type: 'jump', frame: 0});
									animate();
									break;
							}
							state = OUTLOOK;
							break;
						case SPIRIT:
							switch(state)
							{
								case FOOTPRINT:
									pendingAnimationSteps.push({type: 'animate', frame: FOOTPRINT_FLIP_POINT});
									pendingAnimationSteps.push({type: 'jump', frame: SPIRIT_FLIP_POINT});
									pendingAnimationSteps.push({type: 'animate', frame: SPIRIT_END});
									animate();
									break;
								case OUTLOOK:
									pendingAnimationSteps.push({type: 'jump', frame: SPIRIT_START});
									pendingAnimationSteps.push({type: 'animate', frame: SPIRIT_END});
									animate();
									break;
							}
							state = SPIRIT;
							break;
					};
					
				}
				
				$hotspots.each(function()
				{
					var $hotspot = $(this);
					var $spot = $hotspot.children('.spot');
					var $spotSpot = $spot.children('.spot');
					var $spotSpotOver = $spotSpot.children('.over');
					var $spotSpotNormal = $spotSpot.children('.normal');
					var $spotName = $spot.children('.name');
					var $balloonContainer = $hotspot.children('.balloon-container');
					var $balloon = $balloonContainer.children('.balloon');
					
					if ($soleRed.find($hotspot).length)
					$hotspot.addClass('red-sole');
					else
					$hotspot.addClass('black-sole');
					
					if ($sole.find($hotspot).length)
					$soleHSContainer.append($hotspot);
					
					$hotspot.css({opacity: 0});
					$balloon.css({opacity: 0});
					$spotSpotOver.css({opacity: 0});
					if (use3D)
					{
						$balloon.css({transformOrigin: '50% 100%'});
						$balloon.css({transform: 'perspective(500px) rotateX(-90deg) scale(.5)'});
					}
					
					var opened = false;
					
					function openBalloon()
					{
						if (closeLastBalloon)
						{
							closeLastBalloon();
							closeLastBalloon = null;
						}
						closeLastBalloon = function ()
						{
							closeBalloon();
						}
						
						opened = true;
						
						$spotName.stop(true).animate({opacity: 0}, { duration: 200, specialEasing: {opacity: 'easeInOutCubic'}});
						$spotSpotOver.css({display: 'block'}).stop(true).animate({opacity: 1}, { duration: 300, specialEasing: {opacity: 'easeInOutCubic'}});
						$spotSpotNormal.stop(true).delay(200).animate({opacity: 0}, { duration: 100, specialEasing: {opacity: 'easeInOutCubic'}});
						
						var hideTimeout = $balloonContainer.data('hideTimeout');
						if (hideTimeout) clearTimeout(hideTimeout);
						
						$balloonContainer.css({display: 'block'});
						
						var currentMarginLeft = Number($balloonContainer.css('margin-left').split('px').join(''));
						var newMargin = currentMarginLeft + ($balloonContainer.width() - $balloon.outerWidth()) / 2;
						$balloonContainer.width($balloon.outerWidth()).css('margin-left', newMargin);
						
						if (!use3D)
						$balloon.stop(true).animate({opacity: 1}, { duration: 300, specialEasing: {opacity: 'easeInOutCubic'}});
						else
						$balloon.stop(true).transition({opacity: 1, transform: 'perspective(500px) rotateX(0) scale(1)', duration: 250, easing: 'cubic-bezier(.5,0,.5,1)'});
					}
					function closeBalloon()
					{
						closeLastBalloon = null;
						
						opened = false;
						$spotName.stop(true).delay(200).animate({opacity: 1}, { duration: 200, specialEasing: {opacity: 'easeInOutCubic'}});
						$spotSpotNormal.stop(true).animate({opacity: 1}, { duration: 100, specialEasing: {opacity: 'easeInOutCubic'}});
						$spotSpotOver.stop(true).delay(0).animate({opacity: 0}, { duration: 300, specialEasing: {opacity: 'easeInOutCubic'}, complete: function()
						{
							$spotSpotOver.css({display: 'none'});
						}});
						
						if (!use3D)
						{
							$balloon.stop(true).animate({opacity: 0}, { duration: 300, specialEasing: {opacity: 'easeInOutCubic'}, complete: function()
							{
								$balloonContainer.css({display: 'none'});
							}});
						}
						else
						{
							$balloon.stop(true).css({transform: 'perspective(500px) rotateX(-0.01deg) scale(1)'}).transition({opacity: 0, transform: 'perspective(500px) rotateX(-90deg) scale(.5)', duration: 300, easing: 'cubic-bezier(.5,0,.5,1)'});
							$balloonContainer.data('hideTimeout', setTimeout(function()
							{
								$balloonContainer.css({display: 'none'});
							}, 320));
						}
					}
					
					function mouseenterHandler()
					{
						openBalloon();
						$hotspot.mouseleave(mouseLeaveHandler);
					}
					function mouseLeaveHandler()
					{
						closeBalloon();
						$hotspot.unbind('mouseleave', mouseLeaveHandler);
					}
					$spotSpot.mouseenter(mouseenterHandler);
					
					function touchHandler(e)
					{
						e.originalEvent.preventDefault();
						if (!opened)
						{
							openBalloon();
						}
						else
						{
							closeBalloon();
						}
					}
					$spotSpot.bind('touchstart', touchHandler);
					$balloonContainer.bind('touchstart', touchHandler);
					$spotSpot.bind('touchend', function(e){e.originalEvent.preventDefault(); return false;});
					$balloonContainer.bind('touchend', function(e){e.originalEvent.preventDefault(); return false;});
					
					$balloon.append('<div class="arrow" />');
				});
				
				var showingBalloon = true;
				
				function hideBalloon()
				{
					$draggerText.stop(true).animate({opacity: 0}, {duration: 400, specialEasing: {opacity: 'easeInOutCubic'}, complete: function()
					{
						$draggerText.remove();
					}});
					showingBalloon = false;
				}
				
				var dragInterval;
				var startX;
				var currentX;
				var lastX;
				var startLeft;
				function startDrag()
				{
					//DragCursor.closed($body);
					
					startLeft = Number($wiper.css('left').split('px').join(''));
					
					if (showingBalloon) hideBalloon();
					
					closeSole();
					hideSwitcher();
					
					$body.addClass('tech-widget-dragging');
					
					if (dragInterval) clearInterval(dragInterval);
					dragInterval = setInterval(dragIntervalHandler, 0);
					
				}
				function dragIntervalHandler()
				{
					if (currentX != lastX)
					{
						var difference = currentX - startX;
						var destination = startLeft + difference;
						if (destination < wiperMargin)
						{
							destination = wiperMargin;
						}
						else if (destination > widgetWidth - wiperMargin)
						{
							destination = widgetWidth - wiperMargin;
						}
						$wiper.css('left', destination);
						updateWipes();
						
						lastX = currentX;
					}
				}
				function stopDrag()
				{
					//DragCursor.clear($body);
					setTimeout(function() { $body.css('cursor', ''); }, 0);
					
					dragIntervalHandler();
					clearInterval(dragInterval);
					$body.removeClass('tech-widget-dragging');
					if (Number($wiper.css('left').split('px').join('')) < widgetWidth / 2)
					{
						closeWipe();
					}
					else
					{
						openWipe();
					}
				}
				$dragger.bind('touchstart', function(e)
				{
					e.preventDefault();
					startX = e.originalEvent.touches[0].clientX;
					currentX = startX;
					lastX = currentX;
					startDrag();
					function moveHandler(e)
					{
						currentX = e.originalEvent.touches[0].clientX;
					}
					$document.bind('touchmove', moveHandler);
					function endHandler(e)
					{
						$document.unbind('touchmove', moveHandler);
						$document.unbind('touchend', endHandler);
						stopDrag();
					}
					$document.bind('touchend', endHandler);
				});
				
				$dragger.mousedown(function(e)
				{
					e.preventDefault();
					startX = e.pageX;
					currentX = startX;
					lastX = currentX;
					startDrag();
					function mouseMoveHandler(e)
					{
						currentX = e.pageX;
					}
					$document.mousemove(mouseMoveHandler);
					function mouseUpHandler(e)
					{
						currentX = e.pageX;
						$document.unbind('mousemove', mouseMoveHandler);
						$document.unbind('mouseup', mouseUpHandler);
						stopDrag();
					}
					$document.mouseup(mouseUpHandler);
				});

                if (CURRENT_FLOOR == null)
                {
                    CURRENT_FLOOR = 1;
                    
                    if (user.HEADER_AND_FOOTER_CREATED == false)
                    {
                        Hydra.module.start("menu", 'menu_instance');
                        Hydra.module.start("footer", 'footer_instance'); 
                        user.HEADER_AND_FOOTER_CREATED = true;
                        bus.publish("satorisan", "menu-change-go", { data:"tech" });
                    }
                    setTimeout(function(){
	                    bus.publish( 'satorisan', 'history-update' );
	                    $this.startPreloading();
                    },50);
                }
                else
                {
                    if (CURRENT_FLOOR == 0)
                    {
                        bus.publish( 'satorisan', 'transition-page', { type: "SLIDE_BOTTOM", complete:$this.startPreloading } );
                        CURRENT_FLOOR = 1;
                    }
                    else
                    {
                        $this.startPreloading();   
                    }
                }

                $body.addClass(PAGE_BODY_SELECTOR);
                bus.publish( 'satorisan', 'menu-change' );
                
            },

            /*-------------------------------*/

            startPreloading:function()
            {
                var imagesToLoad =
				[
					'/website/images/sprite.png',
					'/website/images/tech/black-sole-side.png',
					'/website/images/tech/black-sole-top.png',
					'/website/images/tech/extra-shoelaces.jpg',
					'/website/images/tech/hand-stich-label.jpg',
					'/website/images/tech/hotspot.png',
					'/website/images/tech/red-sole-side.png',
					'/website/images/tech/red-sole-top.png',
					'/website/images/tech/sole-shadow.png',
					'/website/images/tech/switch-black.png',
					'/website/images/tech/switch-red.png'
				];
				
				if (useSmall)
				{
					imagesToLoad.push
					(
						'/website/images/tech/small/animation-1.jpg',
						'/website/images/tech/small/animation-2.jpg',
						'/website/images/tech/small/animation-3.jpg',
						'/website/images/tech/small/animation-4.jpg',
						'/website/images/tech/small/animation-5.jpg',
						'/website/images/tech/small/animation-6.jpg',
						'/website/images/tech/small/animation-7.jpg'
					);
				}
				else
				{
					imagesToLoad.push
					(
						'/website/images/tech/animation-1.jpg',
						'/website/images/tech/animation-2.jpg',
						'/website/images/tech/animation-3.jpg',
						'/website/images/tech/animation-4.jpg',
						'/website/images/tech/animation-5.jpg',
						'/website/images/tech/animation-6.jpg',
						'/website/images/tech/animation-7.jpg'
					);
				}
				
				var subPreloader = CURRENT_LANGUAGE == 'en' ? 'The small details that create happy feet around the world' : 'Los pequeños detalles que crean pies felices por todo el mundo';
				bus.publish( 'satorisan', 'preloader-show', { header: 'Tech', footer: "" } );
				
				function loadOrErrorHandler()
				{
					loadedImages++;
					bus.publish( 'satorisan', 'preloader-update', {rate: loadedImages / totalImages * 100});
					if (loadedImages == totalImages) 
					{
						$contentContainer.css('opacity', .01);
						
						var loadingSprite = 0;
						function loadSprite()
						{
							if (loadingSprite < $sprites.length)
							{
								var $sprite = $sprites.eq(loadingSprite);
								var $ramSprite = $ramSprites.eq(loadingSprite);
								$sprite.css('opacity', '');
								$ramSprite.css('opacity', '');
								
								loadingSprite++;
								setTimeout(loadSprite, 0);
							}
							else
							{
								bus.publish('satorisan', 'preloader-hide', {complete:launchSection});
							}
						}
						
						setTimeout(function()
						{
							$techWidget.css('opacity', .01);
							setTimeout(loadSprite, 0);
						}, 0);
					}
				}
				
				function launchSection()
				{
					if (isActive)
					{
						$contentContainer.stop(true).animate({opacity: 1}, {duration: 1000, specialEasing: {opacity: 'easeInOutCubic'}, complete: function()
						{
							$sprites.each(function()
							{
								var $sprite = $(this);
								$sprite.css(
								{
									top: $sprite.data('top')
								});
							});
							
							setTimeout(function()
							{
								$techWidget.stop(true).animate({opacity: 1}, {duration: 1000, specialEasing: {opacity: 'easeInOutCubic'}, complete: function()
								{
									$('#filter-quantity-widget').stop(true).animate({bottom: 27}, { duration:700, specialEasing: {bottom: 'easeInOutCubic'}, complete: function()
									{
										showHotspots();

										bus.publish( 'satorisan', 'history-check-callback' );
                						user.IS_IN_TRANSITION = false;

									}});
								}});
							}, 100);
						}});
					}
				}
				
				var loadedImages = 0;
				var totalImages = imagesToLoad.length;
				
				for (var i = 0; i < totalImages; i++)
				{
					var $image = $('<img src="' + imagesToLoad[i] + '"/>');
					onImageLoadOrError($image[0], loadOrErrorHandler);
				}
            },

           /*-------------------------------*/

            stop:function(){
                if (isActive)
                {
                    isActive = false;
                    $window.unbind('techTimelineUpdate');


                }

                $body.removeClass(PAGE_BODY_SELECTOR);
            }

		
        }
    
});
var $productsPreloadingImage;

var ProductsListPage = {};

Hydra.module.register( 'page-products-list', function( bus )
{
        var PAGE_BODY_SELECTOR = "catalog";
        var DATA_JSON;
        var MARKUP_TEMPLATE;
        var MARKUP_SECTION = "";
        var MARKUP_MODELS = "";

        var self = this;
        var revive = false;
        var $products;
        var $models;
        var totalProducts = 0;
        var $wrapper;
        var $dragArea;
        var $container;
        var startXDragPosition;
        var endXDragPosition;
        var $mask;
        var MAX_OFFSET_DRAG = 3;
        var $noresult;
        var isActive = false;
        var wrapperHeight;
        var PRODUCT_WIDTH = 215;
        var PRODUCT_HEIGHT = 211;
        var PRODUCT_MARGIN_HORIZONTAL = 25;
        var PRODUCT_MARGIN_VERTICAL = 6.5;
		var PRODUCT_TOTAL_WIDTH = PRODUCT_WIDTH + PRODUCT_MARGIN_HORIZONTAL * 2;
        var PRODUCT_TOTAL_HEIGHT = PRODUCT_HEIGHT + PRODUCT_MARGIN_VERTICAL * 2;
		var PRODUCT_TOTAL_SHORT_HEIGHT = PRODUCT_TOTAL_HEIGHT - 19;
        var productTotalHeight;
        var MODEL_TOTAL_HEIGHT = 185 + 6.5 * 2;
        var VERTICAL_PADDING = 33;
        var VERTICAL_OFFSET = -20;
        var TEXTS_DISTANCE = 40;
        var noresult = false;
        var nextToOpen = -1;
        var isUpdate = false;
        var noResultTimeout;
        var isPreloaded = false;
        var visibleItems;
        var showTimeout;
		var modelsShowTimeout;
		var resizeTimeout;

        var $modelsListWrapper;

        var productsGridDefinition;
        var modelsGridDefinition;

        var windowWidth;
        var cleanHeight;
        var maxItemsAreaHeight;
        var maxRows;
        var maxColumns;

        var mode = 'products';

        var textsHeight = 0;

        var nextMode;

        ProductsListPage.goToModels = function()
        {
            if (!nextMode)
            {
                if (mode == 'products')
                {
                    var hideTime = self.hideVisibleProducts();
                    setTimeout(closedHandler, hideTime);
                }
            }

            nextMode = "models";
        }

        function closedHandler()
        {
            mode = nextMode;
            nextMode = null;

            switch (mode)
            {
                case "models":
                    ProductsListPage.setTexts(MODELOS_HOME[CURRENT_LANGUAGE].title, MODELOS_HOME[CURRENT_LANGUAGE].body);
                    self.showModels();
                    break;
                case "products":
                    setProductsTexts();
                    self.showProducts();
                    break;
            }
        }

        function setProductsTexts()
        {
            if (user.TYPE_PRODUCT == "FOOTWEAR" && user.MODEL_ID)
            ProductsListPage.setTexts(PRODUCTS_FAMILIES[user.MODEL_ID].title[CURRENT_LANGUAGE], PRODUCTS_FAMILIES[user.MODEL_ID].description[CURRENT_LANGUAGE]);
            else
            ProductsListPage.removeTexts();
        }

        ProductsListPage.goToProducts = function()
        {
            if (!nextMode)
            {
                if (mode == 'models')
                {
                    var hideTime = self.hideModels();
                    setTimeout(closedHandler, hideTime);
                }
            }

            nextMode = "products";
        }

        ProductsListPage.setTexts = function(title, body)
        {
            var $newTexts = $(
            '\
                <div class="descriptive-texts current">\
                    <h3>' + title + '</h3>\
                    <div class="body">' + body + '</div>\
                </div>\
            ');
            $newTexts.css('opacity', 0);

            var $lastTexts = $container.children('.descriptive-texts');
            $lastTexts.removeClass('current');
            $lastTexts.stop(true).animate({opacity: 0}, {duration: 500, specialEasing: {opacity: 'easeInOutCubic'}, complete: function()
            {
                $lastTexts.remove();
            }});

            $container.append($newTexts);

            var $textsBody = $newTexts.find('.body');
            textsHeight = $textsBody.height();
        }

        function showTexts($texts, delay)
        {
            $texts.stop(true).delay(delay ? delay : 0).animate({opacity: 1}, {duration: 500, specialEasing: {opacity: 'easeInOutCubic'}});
        }

        function hideTexts($texts)
        {
            $texts.stop(true).animate({opacity: 0}, {duration: 500, specialEasing: {opacity: 'easeInOutCubic'}});
        }

        ProductsListPage.removeTexts = function()
        {
            var $lastTexts = $container.children('.descriptive-texts');
            $lastTexts.removeClass('current');
            $lastTexts.stop(true).animate({opacity: 0}, {duration: 500, specialEasing: {opacity: 'easeInOutCubic'}, complete: function()
            {
                $lastTexts.remove();
            }});
            textsHeight = 0;
        }

        function getGridDefinition(visibleItemsCount)
        {
            var exceedsWidth = maxColumns * maxRows < visibleItemsCount;

            var rows;
            if (!exceedsWidth)
            {
                rows = 1;
                while (visibleItemsCount / rows > maxColumns)
                {
                    rows++;
                }
            }
            else
            {
                rows = maxRows;
            }

            if
            (
                !exceedsWidth
                &&
                rows == 1
                &&
                maxRows > 1
                &&
                visibleItemsCount > 3
            )
            rows = 2;

            var columns = Math.ceil(visibleItemsCount / rows);

            return {
                exceedsWidth: exceedsWidth,
                leftZero: !exceedsWidth ? (windowWidth - columns * PRODUCT_TOTAL_WIDTH) / 2 : 0,
                topZero: (cleanHeight - rows * (mode == 'products' ? productTotalHeight : MODEL_TOTAL_HEIGHT)) / 2 + (textsHeight + (textsHeight ? TEXTS_DISTANCE : 0)) / 2 + VERTICAL_OFFSET,
                rows: rows,
                columns: columns,
            }
        }
		
		function showItem($product, delay, immediate)
		{
			$product.data('hidden', false);

            $product.unbind('webkitTransitionEnd').unbind('transitionend').unbind('transitionEnd').unbind('oTransitionEnd');
			
            var timeout = $product.data('displayTimeout');
            if (timeout) clearTimeout(timeout);
			
			if (immediate)
			{
				$product.stop(true).css(
				{
					opacity: 1,
					transform: 'perspective(1000px) translateY(0px) rotateX(0deg)',
					transformOrigin: '50% 100%',
					display: 'block',
                    transitionDelay: 0,
                    transitionDuration: 0
				});
			}
			else
			{
				$product.stop(true).css(
				{
					transform: 'perspective(1000px) translateY(30px) rotateX(60deg)',
					transformOrigin: '50% 100%',
					display: 'block',
                    transitionDelay: 0,
                    transitionDuration: 0
				})
                setTimeout(function()
                {
                    $product.css(
                    {
                        opacity: 1,
                        transform: 'perspective(1000px) translateY(0px) rotateX(0deg)',
                        transitionDelay: delay / 1000 + 's',
                        transitionTimingFunction: 'cubic-bezier(0, .5, .5, 1)',
                        transitionDuration: 350 / 1000 + 's'
                    });
                })
			}
		}
		
		function hideItem($product, delay, immediate)
		{
            var timeout = $product.data('displayTimeout');
			if (timeout) clearTimeout(timeout);

			$product.stop(true).css({transformOrigin: '50% 0%'});

			if (immediate)
			{
				$product.css(
				{
					opacity: 0,
					transform: 'perspective(1000px) translateY(30px) translateZ(-50px)',
					display: 'none',
                    transitionDelay: 0,
                    transitionDuration: 0
				});
			}
			else
			{
                function transitionendHandler()
                {
                    $product.css({display: 'none'});
                    
                    $product.unbind('transitionend', transitionendHandler).unbind('transitionEnd', transitionendHandler).unbind('webkitTransitionEnd', transitionendHandler).unbind('oTransitionEnd', transitionendHandler);
                }

                $product.one('transitionend', transitionendHandler).one('transitionEnd', transitionendHandler).one('webkitTransitionEnd', transitionendHandler).one('oTransitionEnd', transitionendHandler);

                $product.css(
                {
                    opacity: 0,
                    transform: 'perspective(1000px) translateY(30px) translateZ(-50px)',
                    transitionDelay: delay / 1000 + 's',
                    transitionTimingFunction: 'cubic-bezier(.5, 0, 1, .5)',
                    transitionDuration: 300 / 1000 + 's'
                });

			}
			$product.data('hidden', true);
		}
		
		function checkShowing($item)
		{
			var left = (typeof $item == 'number') ? $item : $item.offset().left;
			
			var minLeft = -PRODUCT_TOTAL_WIDTH;
			var maxLeft = $window.width() + PRODUCT_TOTAL_WIDTH;
			return (left > minLeft && left < maxLeft);
		}
                    
        var normalizeTimeout;
        
        function highlightItems($products)
        {
            if (normalizeTimeout) clearTimeout(normalizeTimeout);
            var $image = $products.find('.image-container img');
            $products.css({opacity: 1});
            
            if (Modernizr.csstransitions)
            {
                $image.css(
                {
                    transform: 'perspective(1000px) rotateX(-10deg) scale(1.1)'
                });
            }
        }
        
        function dimItems($products)
        {
            if (normalizeTimeout) clearTimeout(normalizeTimeout);
            var $image = $products.find('.image-container img');
            $products.css({opacity: .5});
            $image.css(
            {
                transform: 'perspective(1000px) rotateX(0deg) scale(.9)'
            });
        }
        
        function normalizeItem($target)
        {
            var $image = $target.find('.image-container img');
            $target.css({opacity: 1});
            
            if (Modernizr.csstransitions)
            {
                $image.css(
                {
                    transform: 'perspective(1000px) rotateX(0deg) scale(1)'
                });
            }
        }
        
        function normalizeItems()
        {
            normalizeTimeout = setTimeout(function()
            {
                normalizeItem($products);
            }
            , 200);
        }


        function calculateGridHeights()
        {
            if (window.innerHeight > 700)
            {
                productTotalHeight = PRODUCT_TOTAL_HEIGHT;
            }
            else
            {
                productTotalHeight = PRODUCT_TOTAL_SHORT_HEIGHT;
            }
        }

        return {
            
            /*-------------------------------*/
            /* PRODUCTS LIST */
            /*-------------------------------*/            

            init: function()
            {
                self = this;
                bus.subscribe('satorisan', this);
            },
            
            /*-------------------------------*/

            oEventsCallbacks: {
                'append-page' : function (data) {                    
                    
                    if (data.content == "products-list")
                    {
                        if (!isActive)
                        {
                            revive = false;
                            nextToOpen = -1;
                            isActive = true;
                            bus.publish("satorisan", "ganalytics-track-path");
                            calculateGridHeights();
                            this.create();
                        }
                    }
                    else
                    {
                        //$body.removeClass(PAGE_BODY_SELECTOR);
                    }
                },

                'revive-page' : function() {
                    revive = true;
                },

                'shipping-country-update' : function() {
                    this.update();
                },
                
                'filter-products' : function ()
                {
                    this.filter();
                },

                'transition-out' : function(data)
                {
                    if (isActive && data.type == "shop")
                    {
                        bus.publish( 'satorisan', 'destroy-products-filter' );
                        $window.unbind("resize", self.resize);
                        
                        var maxDelay = -50;
                        var totalDelay = 0;

                        if (visibleItems)
                        {
                            
                            var offsetMinY = 9999999999999;

                            for (var i = 0; i < visibleItems.length; i++)
                            {
                               var $tempItem = $(visibleItems[i]); 

                               if ( $tempItem.position().top < offsetMinY)
                               {
                                    offsetMinY = $tempItem.position().top;
                               }
                            }
                            
                            for (var i = 0; i < visibleItems.length; i++)
                            {
								var item = visibleItems[i];
								var $item = $(item);
								if (nextToOpen != $products.index(item))
								{
									if (checkShowing($item))
									{
                                        hideItem($item, $item.position().top + 200);
                                        if ( ($item.position().top - offsetMinY) > maxDelay) maxDelay = $item.position().top - offsetMinY;								
                                        
									}
								}
                            }
                        }
						if ($products)
						{
							totalDelay = maxDelay + 150;
							setTimeout(function()
							{
                                $products.eq(nextToOpen).animate({opacity: 0}, {duration: 500, specialEasing: {opacity: 'easeInOutCubic'}});
							}, totalDelay);
                        }
                        setTimeout(function()
						{                            
                            if (revive==false)
                            {
                                $wrapper.iOSScrollSatorisan('destroy');
                                data.complete();
                            }
                            else
                            {
                                revive = false;
                                nextToOpen = -1;
                                isActive = true;
                                bus.publish("satorisan", "ganalytics-track-path");
                                self.create();
                            }
                        }, totalDelay + 500);
                        isActive = false;
                        $body.removeClass("catalog");
                    }                    

                },

                'destroy-page' : function(data)
                {                    
                    
                    if (isActive)
                    {
                        this.stop();
                        data.complete();
                    }
                }
            },

            /*-------------------------------*/

            create: function()
            {             
                $body.addClass(PAGE_BODY_SELECTOR);   
                bus.publish('satorisan', 'menu-change');

                if (!user.COME_FROM_DETAIL)
                {
                    user.TYPE_PRODUCT = FILTER_TYPES_PRODUCTS[CURRENT_LANGUAGE][0];
                    user.MODEL_ID = null;
                    user.MODEL_NAME = null;
                    user.COLOR = "";
                    user.SIZE_SYSTEM = "EUR";
                    user.SIZE = 0;
                    user.DETAIL_SIZE = 0;
                    user.PRICE_RATE_MIN = FILTER_PRICES_MIN;
                    user.PRICE_RATE_MAX = FILTER_PRICES_MAX;
                }

                user.COME_FROM_DETAIL = false;
                
                if (CURRENT_FLOOR == null)
                {
                    bus.publish( 'satorisan', 'preloader-show', { header:"", footer:"" } );
                    this.appendGeneralMarkup();
                    self.startToLoad();
                }
                else
                {
                    if (CURRENT_FLOOR == 0)
                    {
                        this.appendGeneralMarkup();
                        bus.publish( 'satorisan', 'transition-page', { type: "SLIDE_BOTTOM", complete:self.startToLoad } );
                        CURRENT_FLOOR = 1;
                    }
                    else
                    {
                        this.appendGeneralMarkup();
                        self.startToLoad();
                        CURRENT_FLOOR = 1;
                    }
                }
            },

            /*-------------------------------*/

            startToLoad: function()
            {
            	if (CURRENT_LANGUAGE == "zh_cn") 
            	{
            		footer_text = "发现我们的产品";
            	}
            	else if (CURRENT_LANGUAGE == "es")
                {
                    footer_text = "Descubre nuestro footwear y accesorios hechos para andar experiencias";
                }
                else if (CURRENT_LANGUAGE == "en")
                {
                    footer_text = "Discover our footwear and accessories collection made to walk";
                }
                
                if (!isPreloaded)
                {
                    bus.publish('satorisan', 'preloader-show', { header:"Shop", footer:"" });
                    setTimeout(self.loadData, 250);
                }
                else
                {
                    self.appendAllProducts();
                }
            },

            /*-------------------------------*/

            appendGeneralMarkup: function()
            {
                $content.append("<div class='section-wrapper new-section " + PAGE_BODY_SELECTOR + "'><div id='products-no-result'>" + DICTIONARY[CURRENT_LANGUAGE].noresult + "</div><div class='products-list-mask'><div class='products-list-drag-area'><div id='products-list-wrapper'><div id='scroller'><ul id='thelist'></ul></div></div></div></div></div>");
            },

            /*-------------------------------*/

            update: function()
            {
                if (isActive)
                {
                    isUpdate = true;
                    MARKUP_SECTION = "";
                    bus.publish( 'satorisan', 'preloader-show');

                    var gotoLink = $(this).find("span").attr("href");
                    $blocker.show();
                    $products.each(function(index)
                    {
                        $(this).delay(Math.random()*150).animate( { opacity : 0}, {duration:200} );
                    });
                    setTimeout(self.destroyAll, 200);
                }
            },

            /*-------------------------------*/

            destroyAll: function()
            {
                $window.unbind("resize", self.resize);
                $wrapper.iOSScrollSatorisan('destroy');
                DATA_JSON = null;
                self.loadData();
            },

            /*-------------------------------*/

            loadData: function()
            {
                if (isActive)
                {
                	/*
                    $.ajax(
                    {
                        cache: true,
                        url: WEBSERVICES_PATH[PAGE_BODY_SELECTOR] + "?lg=" + getCodeLocale() + "&store=" + user.SHIPPING_REGION + "&show_unpublish=" + NEW_COLLECTION,
                        contentType: "application/x-www-form-urlencoded;charset=UTF-8",
                        dataType: "text", //set to JSON
                        success: function(data_json)
                        {
                            DATA_JSON = $.parseJSON(data_json);
                                               
                            bus.publish('satorisan', 'preloader-update', {rate: 15});
                            self.preloadImages();
                        }
                    });
                    */
                	// search
                	
                	window.jsbridge.callHandler(
						'callApi',
						'com.openteach.openshop.server.product.search',
						'0.0.1',
						{
							
						},
						function(response) {
							console.log('Got response from com.openteach.openshop.server.product.get', response);
							if (response.succeed) {
								DATA_JSON = response.data.content;
								bus.publish('satorisan', 'preloader-update', {rate: 15});
	                            self.preloadImages();
							} else {
									// TODO
								alert(response.errorMsg);
							}
						});
                }
            },

            /*-------------------------------*/

            preloadImages: function()
            {
                if (isActive)
                {
                    var totalShoes = DATA_JSON.length;

                    /*
                    for (var i = 0; i < DATA_JSON.length; i++)
                    {
                        if (DATA_JSON[i].type == "Shoes")
                        {
                            totalShoes++;
                        }
                    }
                    */
                    
                    productsGridDefinition = getGridDefinition(totalShoes);

                    var imagesToLoad = new Array();
                    var counter = 0;

                    for (var i = 0; i < DATA_JSON.length; i++)
                    {
                        if (counter < maxColumns * productsGridDefinition.rows)
                        {
                        	imagesToLoad.push(DATA_JSON[i].thumbnail);
                            counter++;
                        }
                    }

                    if (imagesToLoad.length)
                    {
                        $.preload(imagesToLoad,
                        {
                            loaded: function(img, loaded, total)
                            {
                                bus.publish('satorisan', 'preloader-update', {rate: 15 + loaded / total * 85});
                            },
                            loaded_all: self.appendAllProducts
                        });
                    }
                    else
                    self.appendAllProducts();
                }
            },

            /*-------------------------------*/
                
            appendAllProducts: function()
            {
                if (isActive)
                {
                    if (MARKUP_SECTION == "")
                    {
                        for (var i = 0; i < DATA_JSON.length; i++)
                        {
                            var product = DATA_JSON[i];
                            product.init_folder = "";
                            product.index_list = i;

                            var priceSplit = String(product.price).split(",");
                            product.price = priceSplit[0];
                            product.price_decimal = priceSplit[1];

                            product.currency = SYMBOL_CURRENCY;
                            MARKUP_SECTION += 
                            "\
                                <li class='product-list " + product.type + " product-id-" + product.id + "' index-list='" + product.index_list + "' productId='" + product.id + "' >\
                                    <div class='inactive'></div>\
                                    <div class='hover'></div>\
                                    <span href='/product/" + product.id + "'>\
                                        <div class='image-container'>\
                                            <img width='200' class='no-loaded' src='" + product.init_folder + product.thumbnail + "' valign='baseline' />\
                                        </div>"
                                        if (product.type != 'Shoes')
                                        {
                                            MARKUP_SECTION += "<div class='product-name'> " + product.name + " </div>";
                                        }
                                        else
                                        {
                                            MARKUP_SECTION +=
                                            "\
                                                <div class='product-name'>\
                                                    <div class='model'>" + product.family + "</div>\
                                                    <div class='style'>" + product.subtitle + "</div>\
                                                </div>\
                                            ";
                                        }
                                        MARKUP_SECTION += "\
                                        <div class='product-price'>\
                                            <span class='currency-symbol'>" + product.currency + "</span>\
                                            <span class='price'>" + product.price + "</span>\
                                            <span class='price-decimal'>," + product.price_decimal + "</span>\
                                        </div>\
                                        <div class='no-stock-container'></div>\
                                    </span>\
                                </li>\
                            ";
                            totalProducts++;
                        }    
                        $products = $(".product-list");
                        hideItem($products, 0, true);
                        $products.data('hidden', true);  
                    }

                    if (!isPreloaded)
                    {
                        bus.publish( 'satorisan', 'preloader-hide', { complete: self.appendAllProductsNext } );  
                        isPreloaded = true;
                    }
                    else
                    {   
                        self.appendAllProductsNext();
                    }
                }
            },


            /*-------------------------------*/

            appendAllProductsNext: function()
            {
                if (isActive)
                {
                    $blocker.hide();
                    var delay = 0;
                    if (CURRENT_FLOOR == null)
                    {
                        if (!user.HEADER_AND_FOOTER_CREATED)
                        {
                            Hydra.module.start("menu", 'menu_instance');
                            Hydra.module.start("footer", 'footer_instance');
                            bus.publish("satorisan", "menu-change-go", {data: "catalog"});
                            user.HEADER_AND_FOOTER_CREATED = true;
                            delay = 250;
                        }
                    }

                    $content.find("#thelist").html(MARKUP_SECTION);                        
                    $content.find("#thelist img").unbind("load").bind("load", function()
                    {
                        var $image = $(this);
                        $image.animate({opacity: 1}, {duration:200, complete: function()
                        {
                            $image.removeClass("no-loaded");
                        }});
                    });

                    $container = $(".section-wrapper." + PAGE_BODY_SELECTOR);
                    $noresult = $container.find("#products-no-result");

                    $wrapper = $("#products-list-wrapper");
    				$wrapper.iOSScrollSatorisan();
					
    				DragCursor.open($wrapper, true);
    				$wrapper.iOSScrollSatorisan('addListener', 'dragStart', function()
					{
						DragCursor.closed($wrapper, true);
					});
    				$wrapper.iOSScrollSatorisan('addListener', 'dragStop', function()
					{
						DragCursor.open($wrapper, true);
					});

                    $mask = $(".products-list-mask");
                    $dragArea = $('.products-list-drag-area');
                    $products = $(".product-list");
                    hideItem($products, 0, true);
					$products.data('hidden', true);

                    $window.unbind("resize", self.resize).bind("resize", self.resize);
					
					$products.each(function()
					{
						var $product = $(this);
						var $hoverTarget =  $product.find('.hover');
						var $image = $product.find('.image-container img');
						var $productName = $product.find('.product-name');
						//var $otherProducts = $products.not(this);
						$image.css({transformOrigin: '50% 90%'});
						$hoverTarget.bind('mouseenter', function()
						{
							if (!$product.data('hidden'))
							{
								if (!$product.hasClass('inactive'))
								{
									highlightItems($product);
									//dimItems($otherProducts);
									$productName.addClass('hover');
								}
							}
						});
                    
						$hoverTarget.bind('mouseleave', function()
						{
							if (!$product.data('hidden'))
							{
								normalizeItem($product);
								$productName.removeClass('hover');
							}
						});
					});

                    $products.bind('tapone', self.productClick);

                    self.appendModels();

                    // PAGE LAUNCH 
                    // TODO: Sort this shit out!
                    setTimeout(function()
                    {
                        bus.publish('satorisan', 'append-products-filter');
                        CURRENT_FLOOR = 1;
                        bus.publish('satorisan', 'history-check-callback');
                        user.IS_IN_TRANSITION = false;

                        if (window.location.hash)
                        {
                            var hashValue = window.location.hash.split('#').join('');

                            if (hashValue == 'models' || hashValue == 'modelos')
                            {
                                $('#model-selection').trigger('tapone');
                            }
                            else
                            {
                                user.MODEL_ID = hashValue;
                                user.MODEL_NAME = PRODUCTS_FAMILIES[hashValue].title[CURRENT_LANGUAGE];

                                $('#model-selection .selected').removeClass('gray').text(user.MODEL_NAME);

                                self.filter();
                            }

                            window.location.hash = '';
                        }
                        else
                        self.filter();
                    }
                    , 200);
                }
            },

            /*-------------------------------*/

            appendModels: function()
            {
                if (isActive)
                {
                    $modelsListWrapper =
                    $('\
                        <div id="models-list-wrapper">\
                            <div class="scroller">\
                                <ul></ul>\
                            </div>\
                        </div>\
                    ');
                    var $list = $modelsListWrapper.find('ul');

                    if (MARKUP_MODELS == "")
                    {
                        for (var id in PRODUCTS_FAMILIES)
                        {
                            var model = PRODUCTS_FAMILIES[id];
                            MARKUP_MODELS +=
                            '\
                                <li class="model-list" model="' + id + '" >\
                                    <div class="hover"></div>\
                                    <span href="">\
                                        <div class="image-container">\
                                            <img class="no-loaded" src="' + model.image + '" width="200" />\
                                        </div>\
                                        <div class="model-name">' + model.title[CURRENT_LANGUAGE] + '</div>\
                                    </span>\
                                </li>\
                            ';
                        }
                    }

                    $list.html(MARKUP_MODELS);

                    $list.find("img").bind("load", function()
                    {
                        var $image = $(this);
                        $image.animate({opacity: 1}, {duration: 200, complete: function()
                        {
                            $image.removeClass("no-loaded");
                        }});
                    });

                    $modelsListWrapper.iOSScrollSatorisan();
                    
                    DragCursor.open($modelsListWrapper, true);
                    $modelsListWrapper.iOSScrollSatorisan('addListener', 'dragStart', function()
                    {
                        DragCursor.closed($modelsListWrapper, true);
                    });
                    $modelsListWrapper.iOSScrollSatorisan('addListener', 'dragStop', function()
                    {
                        DragCursor.open($modelsListWrapper, true);
                    });

                    $modelsListWrapper.iOSScrollSatorisan('disable');

                    $models = $modelsListWrapper.find(".model-list");
                    hideItem($models, 0, true);

                    $window.unbind("resize", self.resize).bind("resize", self.resize);
                    
                    $models.each(function()
                    {
                        var $model = $(this);
                        var $hoverTarget =  $model.find('.hover');
                        var $image = $model.find('.image-container img');
                        var $modelName = $model.find('.model-name');
                        $image.css({transformOrigin: '50% 90%'});
                        $hoverTarget.bind('mouseenter', function()
                        {
                            highlightItems($model);
                            $modelName.addClass('hover');
                        });
                    
                        $hoverTarget.bind('mouseleave', function()
                        {
                            normalizeItem($model);
                            $modelName.removeClass('hover');
                        });
                    });

                    $dragArea.append($modelsListWrapper);
                }
            },

            /*-------------------------------*/

            resize: function()
            {
                calculateGridHeights();

                if (showTimeout) clearTimeout(showTimeout);
                if (modelsShowTimeout) clearTimeout(modelsShowTimeout);

                if (resizeTimeout) clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(self.effectiveResize, 300);
            },

            /*-------------------------------*/

            productClick: function()
            {
                var $this = $(this);

                if (!$this.hasClass("inactive"))
                {
                    bus.publish( 'satorisan', 'destroy-products-filter' );
                    var index = $products.index($this);
				    
                    user.PRODUCT_CLICK = DATA_JSON[index].product_url;

                    if (index >= 0)
                    {
                        var productsPreloadingImage = '/website/images/product-names/' + DATA_JSON[index].product_url + '.png';
                        $productsPreloadingImage = $('<img src="' + productsPreloadingImage + '"/>');
                    }
					var gotoLink = $this.find("span").attr("href");
                    
                    $blocker.show();
                    nextToOpen =  index; 
                    bus.publish('satorisan', 'history-goto', {url: gotoLink});
                }                
            },

            /*-------------------------------*/

            filter: function()
            {
                for (var i = 0; i < DATA_JSON.length; i++)
                {
                    var product = DATA_JSON[i];

                    product.isVisible = true;
                    product.isInStock = true;

                    // CHECK SIZE ********************************

                    if (user.TYPE_PRODUCT == "FOOTWEAR" && user.SIZE != 0 && user.SIZE != "")
                    {
                        if (String(product.size).indexOf(user.SIZE) == -1)
                        {
                            product.isVisible = false;
                        }
                        else
                        {
                            var sizes = String(product.size).split("-");
                            var stocks = String(product.sizes_stock).split("-");
                            var index = 0;

                            for (var j = 0; j < sizes.length; j++)
                            {
                                if (user.SIZE == sizes[j])
                                {
                                    index = j;
                                    break;
                                }
                            }

                            if(stocks[index] == 0)
                            {
                                $products.eq(i).addClass("inactive");
                            }
                            else
                            {
                                $products.eq(i).removeClass("inactive");
                            }   
                        }
                    }
                    else
                    {
                        $products.eq(i).removeClass("inactive");
                    }





                    // HARDCODE: Set a product as out-of-stock for all sizes
                    // Do NOT delete when unnecessary. Just comment it.
                    if
                    (
                        product.id == 1551
                        ||
                        product.id == 2351
                        ||
                        product.id == 2281
                        ||
                        product.id == 2338
                        ||
                        product.id == 2364
                        ||
                        product.id == 2325
                        ||
                        product.id == 2312
                        ||
                        product.id == 2294
                    )
                    $products.eq(i).addClass("inactive inactive-all-sizes");





                    // CHECK COLOR ********************************
                    function colorsArray()
                    {
                        if (ATTRIBUTES_FILTER[3])
                        {
                            return ATTRIBUTES_FILTER[3];
                        }
                        else
                        {
                            return [
                                {label: "", value: ""},
                                {label: "Black", value: "42"},
                                {label: "Brown", value: "49"},
                                {label: "Red", value: "41"},
                                {label: "Orange", value: "48"},
                                {label: "Yellow", value: "47"},
                                {label: "Green", value: "46"},
                                {label: "Blue", value: "45"},
                                {label: "Purple", value: "44"},
                                {label: "White", value: "43"},
                            ];
                        }
                    }

                    if (user.COLOR != 0)
                    {
                        
                        //if (String(product.colors).toLowerCase().indexOf(translateColor( String(ATTRIBUTES_FILTER[3][user.COLOR].label).toLowerCase() )) == -1)


                        if (CURRENT_LANGUAGE == "es")
                        {
                            if (String(product.colors).toLowerCase().indexOf( String(colorsArray()[user.COLOR].label).toLowerCase() ) == -1)
                            {
                                product.isVisible = false;
                            }
                        }
                        else
                        {
                            if (String(product.colors).toLowerCase().indexOf(translateColor( String(colorsArray()[user.COLOR].label).toLowerCase() )) == -1)
                            {
                                product.isVisible = false;
                            }
                        }
                    }

                    // CHECK TYPE ********************************

                    if (user.TYPE_PRODUCT == "FOOTWEAR")
                    {
                        if (product.type != "Shoes")
                        {
                            product.isVisible = false;
                        }
                    }
                    
                    if (CURRENT_LANGUAGE == "en")
                    {
                        if (user.TYPE_PRODUCT == "ACCESORIES" && product.type == "Shoes")
                        {
                            product.isVisible = false;
                        }
                    }
                    else if (CURRENT_LANGUAGE == "es")
                    {
                        if (user.TYPE_PRODUCT == "ACCESORIOS" && product.type == "Shoes")
                        {
                            product.isVisible = false;
                        }
                    }

                    // CHECK PRICE ********************************

                    if (!(user.PRICE_RATE_MIN == 0 && user.PRICE_RATE_MAX == 0))
                    {
                        if
                        (
                            convertTextInNumber(product.price) < user.PRICE_RATE_MIN
                            ||
                            convertTextInNumber(product.price) > user.PRICE_RATE_MAX
                        )
                        product.isVisible = false;
                    }

                    // CHECK MODEL ********************************

                    if (user.TYPE_PRODUCT == "FOOTWEAR" && user.MODEL_ID && product.family_id != user.MODEL_ID)
                    {
                        product.isVisible = false;
                    }
                }

                if (mode == 'products')
                self.respawnProducts();
                else
                ProductsListPage.goToProducts();
            },

            /*-------------------------------*/            

            calculateDimensions: function(additionalHeight)
            {
                if (!additionalHeight)
                additionalHeight = 0;

                windowWidth = $window.width();

                cleanHeight = $window.height()
                - 60 /* header */
                - 33 /* footer */
                - 53 /* filters */
                + additionalHeight
                ;

                maxItemsAreaHeight = cleanHeight
                - VERTICAL_PADDING /* top padding */
                - VERTICAL_PADDING /* bottom padding */
                - textsHeight
                - (textsHeight ? TEXTS_DISTANCE : 0) /* margin-bottom for text */
                ;

                maxRows = Math.floor(maxItemsAreaHeight / (mode == 'products' ? productTotalHeight : MODEL_TOTAL_HEIGHT));
                if (maxRows > 4) maxRows = 4;
                
                maxColumns = Math.floor(windowWidth / PRODUCT_TOTAL_WIDTH);
            },

            /*-------------------------------*/            

            effectiveResize: function()
            {
                if (mode == 'products')
                self.respawnProducts();
                else
                self.respawnModels();
            },

            /*-------------------------------*/         

            hideVisibleProducts: function()
            {
                $wrapper.css('z-index', '');

                $wrapper.iOSScrollSatorisan('disable');

                var $texts = $container.children('.descriptive-texts.current');

                if ($texts.length)
                hideTexts($texts);

                var firstShowingIndex = -1;
                var animDelay = 0;
                for (var i = 0; visibleItems && i < visibleItems.length; i++)
                {
                    (function()
                    {
                        var $product = $(visibleItems[i]);
                        
                        if (checkShowing($product))
                        {
                            if (firstShowingIndex == -1) firstShowingIndex = i;

                            var yCounter = (i - firstShowingIndex) % productsGridDefinition.rows;
                            var xCounter = Math.floor((i - firstShowingIndex) / productsGridDefinition.rows);

                            animDelay = yCounter * 100 + xCounter * 50;
                            hideItem($product, animDelay);
                        }
                        else
                        {
                            hideItem($product, 0, true);
                        }
                    }
                    )();
                }

                return (400 + animDelay);
            },

            /*-------------------------------*/         

            showProducts: function(startDelay)
            {   
                $wrapper.css('z-index', 2);

                if (!startDelay)
                startDelay = 0;
                
                var newVisibleItems = [];
                for (var i = 0; i < DATA_JSON.length; i++)
                {
                    //if (DATA_JSON[i].isVisible)
                    newVisibleItems.push($products.eq(i));
                }
                
                var visibleItemsCount = newVisibleItems.length;
                if (visibleItemsCount > 0)
                {
                    self.calculateDimensions();

                    if (maxRows > 0 && maxColumns)
                    {
                        productsGridDefinition = getGridDefinition(visibleItemsCount);
                        
                        showTimeout = setTimeout(function()
                        {
                            var $texts = $container.children('.descriptive-texts.current');

                            if ($texts.length)
                            {
                                $texts.css('top', (productsGridDefinition.topZero - textsHeight) / 2 + 12);
                                showTexts($texts, 500);
                            }

                            $wrapper.iOSScrollSatorisan('setTo', 0);
                            self.updateProductsScrollDimensions();
                            $wrapper.iOSScrollSatorisan('enable');
                            $wrapper.iOSScrollSatorisan('setTo', 0);
                            
                            for (var i = 0; i < visibleItemsCount; i++)
                            {
                                var $product = newVisibleItems[i];
                                var yCounter = i % productsGridDefinition.rows;
                                var xCounter = Math.floor(i / productsGridDefinition.rows);
                                
                                var leftPosition = productsGridDefinition.leftZero + xCounter * PRODUCT_TOTAL_WIDTH;

                                if
                                (
                                    !productsGridDefinition.exceedsWidth
                                    &&
                                    productsGridDefinition.rows * productsGridDefinition.columns - (productsGridDefinition.rows - 1 - yCounter) > visibleItemsCount
                                )
                                {
                                    leftPosition += PRODUCT_TOTAL_WIDTH / 2;
                                }
                                
                                $product.css(
                                {
                                    top: productsGridDefinition.topZero + yCounter * (mode == 'products' ? productTotalHeight : MODEL_TOTAL_HEIGHT),
                                    left: leftPosition
                                })
                                .attr("row", yCounter);
                                
                                if (checkShowing(leftPosition))
                                {
                                    var animDelay = yCounter * 100 + xCounter * 50;
                                    showItem($product, animDelay);
                                }
                                else
                                {
                                    showItem($product, 0, true);
                                }
                            }
                                
                            
                        }
                        , startDelay);
                        
                        $noresult.hide();
                    }
                }
                else self.showNoResult();
                
                visibleItems = newVisibleItems;
            },

            /*-------------------------------*/         

            respawnProducts: function()
            {
                if (!nextMode)
                {
                    var hideTime = self.hideVisibleProducts();
                    setTimeout(closedHandler, hideTime);
                }

                nextMode = 'products';
            },

            /*-------------------------------*/         

            hideModels: function()
            {
                $modelsListWrapper.css('z-index', '');

                $modelsListWrapper.iOSScrollSatorisan('disable');

                var $texts = $container.children('.descriptive-texts.current');

                if ($texts.length)
                hideTexts($texts);

                var firstShowingIndex = -1;
                var animDelay = 0;
                $models.each(function(i)
                {
                    var $model = $(this);
                    
                    if (checkShowing($model))
                    {
                        if (firstShowingIndex == -1) firstShowingIndex = i;

                        var yCounter = (i - firstShowingIndex) % modelsGridDefinition.rows;
                        var xCounter = Math.floor((i - firstShowingIndex) / modelsGridDefinition.rows);

                        animDelay = yCounter * 100 + xCounter * 50;

                        hideItem($model, animDelay);
                    }
                    else
                    {
                        hideItem($model, 0, true);
                    }
                });

                return (animDelay + 400);
            },

            /*-------------------------------*/         

            showModels: function(startDelay)
            {
                $modelsListWrapper.css('z-index', 2);

                if (!startDelay)
                startDelay = 0;

                self.calculateDimensions(-67);

                if (maxRows > 0 && maxColumns)
                {
                    modelsGridDefinition = getGridDefinition($models.length);
                    
                    modelsShowTimeout = setTimeout(function()
                    {
                        var $texts = $container.children('.descriptive-texts.current');
                        if ($texts.length)
                        {
                            $texts.css('top', (modelsGridDefinition.topZero - textsHeight) / 2 + 12);
                            showTexts($texts, 500);
                        }

                        $modelsListWrapper.iOSScrollSatorisan('setTo', 0);
                        self.updateModelsScrollDimensions();
                        $modelsListWrapper.iOSScrollSatorisan('enable');
                        $modelsListWrapper.iOSScrollSatorisan('setTo', 0);

                        function verticallySortedIndex(index)
                        {
                            var column = index % modelsGridDefinition.columns;
                            var row = Math.floor(index / modelsGridDefinition.columns);

                            return (column * modelsGridDefinition.rows + row);
                        }

                        var columnsPerRow = [];
                        for (var i = 0; i < modelsGridDefinition.rows; i++)
                        {
                            columnsPerRow[i] = modelsGridDefinition.columns;
                        }
                        for (var i = modelsGridDefinition.rows - 1; modelsGridDefinition.rows * modelsGridDefinition.columns - (modelsGridDefinition.rows - 1 - i) > $models.length; i--)
                        {
                            columnsPerRow[i] = columnsPerRow[i] - 1;
                        }

                        $models.each(function(i)
                        {
                            var $model = $(this);

                            var itemsOffset = 0;
                            var yCounter = 0;
                            while (i > itemsOffset + columnsPerRow[yCounter] - 1)
                            {
                                itemsOffset += columnsPerRow[yCounter];
                                yCounter++;
                            }

                            var xCounter = i - itemsOffset;
                            
                            var leftPosition = modelsGridDefinition.leftZero + xCounter * PRODUCT_TOTAL_WIDTH;

                            if
                            (
                                !modelsGridDefinition.exceedsWidth
                                &&
                                columnsPerRow[yCounter] < modelsGridDefinition.columns
                            )
                            {
                                leftPosition += PRODUCT_TOTAL_WIDTH / 2;
                            }

                            $model.css(
                            {
                                top: modelsGridDefinition.topZero + yCounter * (mode == 'products' ? productTotalHeight : MODEL_TOTAL_HEIGHT),
                                left: leftPosition
                            })
                            .attr("row", yCounter);
                            
                            if (checkShowing(leftPosition))
                            {
                                var animDelay = yCounter * 100 + xCounter * 50;
                                showItem($model, animDelay);
                            }
                            else
                            {
                                showItem($model, 0, true);
                            }
                        });
                    },
                    startDelay);
                }
            },

            /*-------------------------------*/         

            respawnModels: function()
            {
                if (!nextMode)
                {
                    var hideTime = self.hideModels();
                    setTimeout(closedHandler, hideTime);
                }

                nextMode = 'models';
            },

            /*-------------------------------*/         

            showNoResult: function()
            {
                $noresult.show();
                $noresult.css({marginTop: -50, opacity: 0}).animate({marginTop: -95, opacity: 1}, 250);
            },

            /*-------------------------------*/            

            updateProductsScrollDimensions: function()
            {
                if (isActive)
                {
                    var contentWidth = productsGridDefinition.columns * PRODUCT_TOTAL_WIDTH;
                    if (contentWidth < windowWidth) contentWidth = windowWidth;
                    
                    $wrapper.iOSScrollSatorisan('updateDimensions', contentWidth, windowWidth);
                }
            },

            /*-------------------------------*/            

            updateModelsScrollDimensions: function()
            {
                if (isActive)
                {
                    var contentWidth = modelsGridDefinition.columns * PRODUCT_TOTAL_WIDTH;
                    if (contentWidth < windowWidth) contentWidth = windowWidth;
                    
                    $modelsListWrapper.iOSScrollSatorisan('updateDimensions', contentWidth, windowWidth);
                }
            },

            /*-------------------------------*/

            stop: function(){
                
                if (isActive)
                {
                    isActive = false;
                    $window.unbind("resize", self.resize);
                    $wrapper.iOSScrollSatorisan('destroy');
                    bus.publish( 'satorisan', 'destroy-products-filter' );
                    $body.removeClass("catalog");
                }
                
            }        

            /*-------------------------------*/

        }
});
var fromMapToProduct = false;

Hydra.module.register( 'page-product-detail', function( bus )
{
        var PAGE_BODY_SELECTOR = "product-detail",
        DATA_JSON,
        MARKUP_TEMPLATE,
        MARKUP_SECTION="",
        self = this,		
		actualPage = 1,
		$section,
		currentGalleryIndex,
		$proudctNameContainer,
		$prevBtn,
		$nextBtn,
		$pagerDisplay,
		$productDetailHeader,
		$backToListBtn,
		$productInfoBtn,
		$seeGalleryBtn,
		$productInfoPage,
		$productInfoPageWrapper,
		$productInfoPageCloseBtn,
		$addToCartBtn,
		$detailHeaderCloseBtn,
		$productImagePage,
		$blockQuantity,
		$backToCampaignBtn,
		blocker = false,
		$pager,
		$page1,
		$page2,
		$page3,
		toolip,
		startOffsetX = 0,
        startOffsetY = 0,
        endOffsetX = 0,
        endOffsetY = 0,	
        MAX_OFFSET_DRAG = 1,	
		$blockSize,
		gallerySlider,
		quantitySelect,
		sizeSelect,
		tooltipCart,
		top1,
		top2,
		top3,
		zindex1,
		zindex2,
		zindex3,
		relatedAccesoriesiScroll,
		relatedShoesiScroll,
		relatedShoesItemsList,
		relatedAccesoriesItemsList,
		stocks_quantities,
		stocks_ids,
		stocks_sizes,
		isHeaderOptionOpen = true,
		isImageTop = false,
		comeFromCampaignDay = -1,
		comeFromCampaignHotspot = -1,
		id_size_product = -1,
		id_size_product_for_stock_alert = -1,
		currentTooltipId = -99,
		pid = 0,
		id_product = "",
		token_section = 0,
		isActive = false,
		isReladed = false,
		$cartDialog,
		nice,
		currentIdGridDetail = null,
		freakingInfoOpened = false;

        var PRODUCT_WIDTH = 215;
        var PRODUCT_HEIGHT = 211;
        var PRODUCT_MARGIN_HORIZONTAL = 25;
        var PRODUCT_MARGIN_VERTICAL = 6.5;
		var PRODUCT_TOTAL_WIDTH = PRODUCT_WIDTH + PRODUCT_MARGIN_HORIZONTAL * 2;
		var PRODUCT_TOTAL_HEIGHT = PRODUCT_HEIGHT + PRODUCT_MARGIN_VERTICAL * 2;

		var $relatedItem;

        return {
            
            /*-------------------------------*/
            /* PAGE DETAIL */
            /*-------------------------------*/            

            init: function()
            {
                self = this;
                bus.subscribe('satorisan', this);
            },
            
            /*-------------------------------*/

            oEventsCallbacks:
            {
                'append-page': function(data)
                {
                    if (data.content == "product-detail")
                	{
                    	// get pid
						var array_dirs = String(document.location.href).split("/");
						var path_id = array_dirs[array_dirs.length - 1];
						currentGalleryIndex = 0;
                		if (!isActive && id_product != path_id)
                		{
                			isHeaderOptionOpen = true;
                			id_product = array_dirs[array_dirs.length - 1]; 
							isActive = true;
                		    bus.publish("satorisan", "ganalytics-track-path");
                			this.create();
                		}
                	}
                	else
                	{
                		$body.removeClass(PAGE_BODY_SELECTOR);
                	}
                },
                
                'shipping-country-update': function()
                {
                    if (isActive) this.goToShop();
                },

                'destroy-page': function(data)
                {
                    if (isActive)
                    {
                        this.stop();
                        isActive = false;
                        data.complete();
                    }
                },

                'pause-page': function()
                {
                   if (isActive && actualPage == 1)
                   {
                   		if ($(".description").getNiceScroll())
                   		{
                   			$(".description").getNiceScroll().hide();
                   		}
                   }
                },

                'resume-page': function()
                {
                   if (isActive && actualPage == 1)
                   {
                   		if ($(".description").getNiceScroll())
                   		{
                   			$(".description").getNiceScroll().show();
                   		}
                   }
                },

                'transition-out': function(data)
                {
                    if (isActive && data.type == "detail")
                    {
                    	currentIdGridDetail = null;
                     	$body.removeClass(PAGE_BODY_SELECTOR);
                     	$window.unbind("resize", self.resize);
                     	id_product = -1;
						isActive = false;
						actualPage = 1; 

                     	isActive = false;

						var s = 0;
						$content.find(".footer").animate({bottom: -38}, {duration: 350});
						$productDetailHeader.animate({marginTop: -54}, {duration:350, complete: function()
						{
							$backToListBtn.animate({marginLeft: -56}, {duration: 350});
							$backToCampaignBtn.animate({marginLeft: -56}, {duration: 350});
							$(".content-wrapper .menu").animate({height: 0}, {duration: 150});
							$content.find(".pager-wrapper").animate({right: 0}, {duration: 350, complete: function()
							{
								$content.find(".image-holder").animate({marginTop: 25, opacity: 0}, {duration: 350});
								var delay_page = 350;
								if (actualPage == 2) delay_page = 650;
								$content.find(".page").animate({opacity: 0}, {duration: 650, complete: function()
								{
									if (nice)
									{
										$(".description").getNiceScroll().remove();
									}

									if (s == 0)
									{
										if (gallerySlider)
										{
											gallerySlider.destroy(true);
											gallerySlider = null;
										}
										
										if (isReladed)
										{
											$content.find(".section-wrapper." + PAGE_BODY_SELECTOR).remove();
											isReladed = false;
										}

										isActive = false;

										if (nice)
										{
											$(".description").getNiceScroll().hide();
										}

										data.complete();	
									}
									s++;
								}});
							}});
						}});

						if (relatedShoesiScroll)
						{
							relatedShoesiScroll.destroy(true);
							relatedShoesiScroll = null;
						}

						if (relatedAccesoriesiScroll)
						{
							relatedAccesoriesiScroll.destroy(true);
							relatedAccesoriesiScroll = null;
						}

						if (quantitySelect)
						{
							$section.find(".footer-holder .block.quantity").removeClass("active");
							quantitySelect.destroy();
						}

						if (sizeSelect)
						{
							$section.find(".footer-holder .block.size").removeClass("active");
							sizeSelect.destroy();
						}

						if ($productInfoBtn)
						{
							$productInfoBtn.unbind(CLICK_EVENT, self.openInfoPage);
							$productInfoPageCloseBtn.unbind(CLICK_EVENT, self.closeInfoPage);
							$seeGalleryBtn.unbind(CLICK_EVENT, self.pagerNext);
							$nextBtn.unbind(CLICK_EVENT, self.pagerNext);
							$prevBtn.unbind(CLICK_EVENT, self.pagerPrev);
							$blockSize.unbind(CLICK_EVENT, self.showSizeForm);
							$blockQuantity.unbind(CLICK_EVENT, self.showQuantityForm);
							$addToCartBtn.unbind(CLICK_EVENT, self.addToCart);
							$relatedItem.unbind(CLICK_EVENT, self.goTorelatedItem);
							$("#img-gallery-controls li").unbind(CLICK_EVENT, self.galleryLoadImage);
							$section.unbind("swipeup");
	 						$section.unbind('swipedown');
						}
						
						$window.unbind("resize", self.resize);

		                DATA_JSON = undefined;	                        
	                    bus.publish('satorisan', 'destroy-products-filter');
                	}
                },
            },

            /*-------------------------------*/

            goToShop: function()
            {
				bus.publish('satorisan', "history-goto", { url:"/shop" });
            },

            /*-------------------------------*/

            create: function()
            {
				if (user.SIZE != 0)
				user.DETAIL_SIZE = user.SIZE;

				if (!Modernizr.touch)
				{
					comeFromCampaignDay = user.COME_FROM_CAMPAIGN_DAY;
					comeFromCampaignHotspot = user.COME_FROM_CAMPAIGN_HOTSPOT;
				}

				user.COME_FROM_CAMPAIGN_DAY = -1;
				user.COME_FROM_CAMPAIGN_HOTSPOT = -1;
				user.SIZE_SMALL_SHOWED = false;

                token_section++;
                sizeSelect = null;
                quantitySelect = null;
                
                user.DETAIL_QUANTITY = 1;
				
				var imagePath = id_product;
				imagePath = imagePath.replace("?new_collection", "");
				imagePath = imagePath.split("-").join(" ");

				if (imagePath == "shop" || imagePath == "campaign" || imagePath == "stores" || imagePath == "satorisan-live" || imagePath == "brand")
				{
					imagePath = user.PRODUCT_CLICK;
				}

				//var $productNameImage = $('<img title="'+imagePath+ '" alt="'+imagePath+ '" src="/website/images/product-names/' + imagePath + '.png" />');
				var $productNameImage = $('<img src="/assets/new/images/pixel.gif" />');
				
				var productNameImage = $productNameImage.get(0);

				if (CURRENT_FLOOR == null)
				{
					$(".section-wrapper").eq(0).remove();
					bus.publish( 'satorisan', 'preloader-show', { header: imagePath , footer:"" } );
					self.appendGeneralMarkup();
					onImageLoadOrError($productNameImage.get(0), imageLoadedHandler);
				}
				else
				{
					if (CURRENT_FLOOR == 0)
					{
						
						bus.publish( 'satorisan', 'transition-page', { type: "SLIDE_BOTTOM", complete: function()
						{
							$(".section-wrapper").eq(0).remove();
							bus.publish( 'satorisan', 'preloader-show', { header: imagePath, footer:"" } );
							self.appendGeneralMarkup();
							onImageLoadOrError($productNameImage.get(0), imageLoadedHandler);
						}});
						CURRENT_FLOOR = 1;
					}
					else
					{
						$(".section-wrapper").eq(0).remove();
						bus.publish( 'satorisan', 'preloader-show', { header: imagePath, footer:"" } );
						
						self.appendGeneralMarkup();
						onImageLoadOrError($productNameImage.get(0), imageLoadedHandler);
					}
				}


				self.createProductScroll();
				
				
				function imageLoadedHandler()
				{
					bus.publish( 'satorisan', 'preloader-update', {rate: 10});
					
					var width = productNameImage.naturalWidth ? productNameImage.naturalWidth : productNameImage.width;
					var height = productNameImage.naturalHeight ? productNameImage.naturalHeight : productNameImage.height;
					
					$proudctNameContainer = $('<div id="preloader_'+ id_product +'" class="title_name_img" style="position:absolute;left:50%;top:50%;overflow:hidden" />');
					$proudctNameContainer.width(width);
					$proudctNameContainer.height(0);
					$proudctNameContainer.css('margin-left', -width/2);
					$proudctNameContainer.css('margin-top', -38);
					$proudctNameContainer.append(productNameImage);
					//$body.append($proudctNameContainer);
					//$proudctNameContainer.animate({marginTop: -53 - height, height: height + 15}, {duration: 300});
					$proudctNameContainer.animate({marginTop: -40 - height, height: height + 15}, {duration: 300});
					self.loadData();
				}
				
                $body.addClass(PAGE_BODY_SELECTOR);

                bus.publish( 'satorisan', 'menu-change' );

            },

            /*-------------------------------*/

			appendGeneralMarkup: function()
			{
				$content.append("<div class='section-wrapper new-section " + PAGE_BODY_SELECTOR + " detail-token-" + token_section + "'><div id='products-detail-wrapper'></div></div>");
			},

            /*-------------------------------*/

            loadData: function()
            {
                

                var imagePath = id_product;

				if ( imagePath == "shop" || imagePath == "campaign" || imagePath == "stores" || imagePath == "satorisan-live" || imagePath == "brand")
				{
					imagePath = user.PRODUCT_CLICK;
					user.PRODUCT_CLICK = "";
				}

				/*
                $.ajax(
                {
                  cache: true,
                  url: WEBSERVICES_PATH [PAGE_BODY_SELECTOR] + "?lg=" + getCodeLocale() + "&id=" + imagePath + "&store=" + user.SHIPPING_REGION + "&show_unpublish="+NEW_COLLECTION,
                  contentType: "application/x-www-form-urlencoded;charset=UTF-8",
                  dataType: 'text',
                  success: function(data_json)
                  {
	                DATA_JSON = $.parseJSON(data_json);
	                if (DATA_JSON.status == 0 && !NEW_COLLECTION)
	                {
	                	document.location = "/";
	                	return false;
	                }
	                stocks_ids = String(DATA_JSON.sizes_ids).split("-");
	                stocks_sizes = String(DATA_JSON.sizes).split("-");
					stocks_quantities = String(DATA_JSON.sizes_quantities).split("-");

	                bus.publish("satorisan", "preloader-update", {rate:33});
	                self.appendProductDetail();
                  }
                });
                */
				// get product
				
				window.jsbridge.callHandler(
					'callApi',
					'com.openteach.openshop.server.product.get',
					'0.0.1',
					{
						'pid' : 1
					},
					function(response) {
						console.log('Got response from com.openteach.openshop.server.product.get', response);
						if (response.succeed) {
							DATA_JSON = response.data;
							//alert(response.data);
							stocks_ids = String(DATA_JSON.sizes_ids).split("-");
				            stocks_sizes = String(DATA_JSON.sizes).split("-");
				            stocks_quantities = String(DATA_JSON.sizes_quantities).split("-");
							bus.publish("satorisan", "preloader-update", {rate:33});
				            self.appendProductDetail();
						} else {
								// TODO
						}
					});
            },


            /*-------------------------------*/

            appendProductDetail: function()
            {              
/*
                if (CURRENT_LANGUAGE=="en"){
                	$(".fb-like").css( { width : 44 } );
                }
				
				if (CURRENT_LANGUAGE=="es"){
                	$(".fb-like").css( { width : 70 } );
                }
*/
				/*$content.find ("iframe").unbind("load").bind("load", function(){
					var editFrame = document.getElementById('fb-iframe');
				});*/
            	

                var imagesToPreload = new Array();
                if (DATA_JSON.bg_name_image) imagesToPreload.push(DATA_JSON.bg_name_image);
                if (DATA_JSON.image) imagesToPreload.push(DATA_JSON.image);
                //imagesToPreload.push( DATA_JSON.gallery_first_image );
				
                $.preload(imagesToPreload, {loaded_all: function()
                {
	                //$content.append("<div class='section-wrapper new-section " + PAGE_BODY_SELECTOR + " detail-token-" + token_section + "'><div id='products-detail-wrapper'>" + MARKUP_SECTION + "</div></div>");

					if (CURRENT_LANGUAGE=="es")
					{
	                	DATA_JSON.fb_language = "es_LA";
	                	DATA_JSON.gle_language = "es";
						
						if ((navigator.platform.indexOf("Mac") != -1)){ // MAC en español
							DATA_JSON.fc_width = "79";
							DATA_JSON.tw_width = "67";
						}
						if ((navigator.platform.indexOf("Win") != -1)){ // WIN en español
							DATA_JSON.fc_width = "72";
							DATA_JSON.tw_width = "71";
							if($.browser.msie && $.browser.version>=7)
							{
								DATA_JSON.fc_width = "70";
							}
						}
	                }

	                if (Modernizr.touch)
	                {
	                	if (CURRENT_LANGUAGE == "es") // IPAD en español
	                	{
	                		DATA_JSON.fc_width = 77;
	                		DATA_JSON.tw_width = 69;
	                	}
	                	if (CURRENT_LANGUAGE == "en") // IPAD en ingles
	                	{
	                		DATA_JSON.fc_width = 52;
	                		DATA_JSON.tw_width = 58;
	                	}
	                }

	                if (CURRENT_LANGUAGE == "en")
	                {
	                	DATA_JSON.fb_language = "en_US";
	                	DATA_JSON.gle_language = "en-US";

						if (navigator.platform.indexOf("Mac") != -1) // MAC en ingles
						{
							DATA_JSON.fc_width = "51";
							DATA_JSON.tw_width = "58";
						}
						if (navigator.platform.indexOf("Win") != -1) // WIN en ingles
						{
							DATA_JSON.fc_width = "46";
							DATA_JSON.tw_width = "60";
							if ($.browser.msie && $.browser.version >= 7)
							{
								DATA_JSON.fc_width = "46";
							}
						}
						
					}
					
					//!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document,'script','twitter-wjs');

	                DATA_JSON.twitter_text_share = getProductStatusTwitter(DATA_JSON.prod_title);
	                DATA_JSON.url_share = getShareURL();
	                DATA_JSON.twitter_account = TWITTER_ACCOUNT[CURRENT_LANGUAGE];
	                DATA_JSON.init_folder = "";
	                
	                DATA_JSON.image_title = id_product;
	                
	                var priceSplit = String(DATA_JSON.prod_price).split(",");
                    DATA_JSON.prod_price = priceSplit[0];
                    DATA_JSON.price_decimal = priceSplit[1];
                    DATA_JSON.currency = SYMBOL_CURRENCY;

                    DATA_JSON.backtogrid = DICTIONARY[CURRENT_LANGUAGE].backtogrid;

	                MARKUP_SECTION = renderEJS(TEMPLATE_DETAIL, DATA_JSON);
					$.getScript('//platform.twitter.com/widgets.js', function()
					{
						//calling method load
						twttr.widgets.load();
					});

	                $content.find("#products-detail-wrapper:last").html(MARKUP_SECTION);

	                $content.find("#thelist img").eq(0).attr("src", $content.find("#thelist img").eq(0).attr("_src"));
	                $content.find("#thelist img").unbind("load").bind("load", function()
	                {
	                	if (isActive)
	                	{
	                		$(this).parent().find(".gallery-preloader").remove();
	                		$(this).animate( { "opacity" : 1}, {duration:150} );
	                	}
	                });
					
					var divMaxHeight = 38;
					var $titlePrice = $content.find('#product-detail .title-price');
					var $title = $titlePrice.find('.title');
					var $price = $titlePrice.find('.price');
					var $currencySymbol = $price.find('.currency-symbol');
					var titleFontSize = Number($title.css('font-size').split('px').join(''));
					var titleHeight = $title.height();
					var priceFontSize = Number($price.css('font-size').split('px').join(''));
					var priceHeight = $price.height();
					var currencySymbolFontSize = Number($currencySymbol.css('font-size').split('px').join(''));
					var decreaseStep = .98;
					var ratio = 1;
					/*while ($titlePrice.height() > divMaxHeight)
					{
						
						ratio *= decreaseStep;
						$title.css('font-size', titleFontSize * ratio + 'px');
						$price.css('font-size', priceFontSize * ratio + 'px');

						$(".block.title,.block.price").css( {'font-size': titleFontSize });
						
						$price.css('font-size', priceFontSize + 'px');

						

						$currencySymbol.css('font-size', currencySymbolFontSize * ratio + 'px');

					}
					$title.css('margin-top', '+=' + (titleHeight - $title.height()) / 2 + 'px');
					$price.css('margin-top', '+=' + (priceHeight - $price.height()) / 2 + 'px');*/

					if ($title.html().length > 12)
					{
						$(".block.title").css( {'font-size': 25, marginTop:3 });
						//$(".block.price").css( {'font-size': 25, marginTop:8 });
						//$currencySymbol.css('font-size', 18);
					}

					
					self.createProductScroll();
					
					

	                if ( comeFromCampaignDay != -1){
	                	$(".back-to-list-wrapper").prepend("<div class='back-to-campaign iconos '><a class='normal-link'><span> < </span></a></div>");
	                	$(".back-to-list").css( { marginTop:1} );
	                }
	                else
	                {
	                	$(".back-to-list").css( { marginTop:-62} );
	                }




					self.initSection();					
	                $window.bind("resize", self.resize);



                	},

                	loaded:function(img, loaded, total){
                		bus.publish("satorisan", "preloader-update", {rate:33+((loaded/total)*66)});
                	}

            	});

                $(".pinterest_galery").css( { opacity:0} );
                
            },           
            
			/*-------------------------------*/
			accomodateRelatedItems: function()
			{
				if (relatedShoesiScroll)
				{
					relatedShoesiScroll.destroy();
					relatedShoesiScroll = null;
				}

                var cleanWidth = $window.width() - 160 /* buttons */;

                var textsHeight = $('#product-detail .page-3 .content .title').height();

                var cleanHeight = $window.height() - 60 /* header */ - 40 /* margin-after header */ - 86  /* footer */ - 40 /* margin before footer */ - textsHeight /* text height */ - 30 /* margin after text */;

                var maxRows = Math.floor(cleanHeight / PRODUCT_TOTAL_HEIGHT);
                if (maxRows > 4) maxRows = 4;
                
                var maxColumns = Math.floor(cleanWidth / PRODUCT_TOTAL_WIDTH);

                var $items = $('#related-items-shoes .related-item')
                var itemsCount = $items.length;

                var exceedsWidth = maxColumns * maxRows < itemsCount;

	            var rows;
	            if (!exceedsWidth)
	            {
	                rows = 1;
	                while (itemsCount / rows > maxColumns)
	                {
	                    rows++;
	                }
	            }
	            else
	           	rows = maxRows;

	            if
	            (
	                !exceedsWidth
	                &&
	                rows == 1
	                &&
	                maxRows > 1
	                &&
	                itemsCount > 3
	            )
	            rows = 2;

	            var columns = Math.ceil(itemsCount / rows);

	            var $relatedShoesContainer = $("#related-items-shoes .scroller ul");
	            $relatedShoesContainer.children().filter('br').remove();

	            if (exceedsWidth)
	            $relatedShoesContainer.css('text-align', 'left');
				else
	            $relatedShoesContainer.css('text-align', 'center');

	            for (var i = columns - 1; i < itemsCount - 1; i += columns)
	            {
	            	$relatedItem.eq(i).after('<br/>');
	            }

				$("#related-items-shoes").removeClass("cursor-move");
				$relatedShoesWrapper = $("#related-items-shoes .scroller");
				$relatedShoesWrapper.width(260 * columns);

				if
				(
					$("#related-items-shoes").length
					&&
					exceedsWidth
				)
				{
					relatedShoesiScroll = new iScroll('related-items-shoes',
					{
						snap: false,
						momentum: true,
						vScrollbar: false,
						hScrollbar: false
	 				});

					$("#related-items-shoes").addClass("cursor-move");
                    //$relatedShoesWrapper.addClass("drag-cursor");
                    $relatedShoesWrapper.unbind(MOUSE_DOWN_EVENT, self.startMouseDown).bind(MOUSE_DOWN_EVENT, self.startMouseDown);
                	$relatedShoesWrapper.unbind(MOUSE_UP_EVENT, self.stopMouseDown).bind(MOUSE_UP_EVENT, self.stopMouseDown);
                }

                if ($("#related-items-accesories").length)
                {
                	if (relatedAccesoriesiScroll)
                	{
						relatedAccesoriesiScroll.destroy();
						relatedAccesoriesiScroll = null;
					}

                    $relatedAccsWrapper = $("#related-items-accesories .scroller");
					$relatedAccsWrapper.width( 260 * $("#related-items-accesories .scroller ul").children().length );
                    relatedAccesoriesiScroll = new iScroll('related-items-accesories', {
														snap: false, momentum: false,
														vScrollbar: false, hScrollbar: false
	 				});
                    $relatedAccsWrapper.addClass("drag-cursor");
                    $relatedAccsWrapper.unbind(MOUSE_DOWN_EVENT, self.startMouseDown).bind(MOUSE_DOWN_EVENT, self.startMouseDown);
                	$relatedAccsWrapper.unbind(MOUSE_UP_EVENT, self.stopMouseDown).bind(MOUSE_UP_EVENT, self.stopMouseDown);
                }
			},
            
			/*-------------------------------*/
			resize: function()
			{
				self.galleryInit(true);

				self.accomodateRelatedItems();
			},

			/*-------------------------------*/		

			createProductScroll:function()
            {
                if (nice)
                {
                    nice.show();
                    nice.resize();
                    $(".description").getNiceScroll().resize();
                }
                else
                {

                    nice = $(".description").niceScroll(
                    {
                    	autohidemode: false,
						cursorcolor: "#999",
						cursorwidth: "8px",
						railpadding: {top: 0, right: 0, left: 30, bottom: 0},
						railoffset: {top: 0, left: 0}
					});
                    nice.show();
                }

                $(".description").niceScroll(
                {
            	  	autohidemode: false,
					cursorcolor: "#999",
					cursorwidth: "8px",
					railpadding: {top: 0, right: 0, left: 30, bottom: 0},
					railoffset: {top: 0, left: 0}
				});

                 $(".description").getNiceScroll().hide();
            },
			
			/*-------------------------------*/		
            
			initSection: function()
			{
				user.DETAIL_QUANTITY = 1;
				//user.DETAIL_SIZE = 0;
				//console.log(user.DETAIL_SIZE);

				// Definitions
				$section = $(".product-detail.detail-token-"+token_section)
				
				// puesto para evitar que se escrolee la page al hacer el gesto vertical
				// de arriba hacia abajo con el mouse. sacar sólo si genera algún problema
				$section.mousedown(function (e) {e.preventDefault();});
				$section.mouseup(function (e) {e.preventDefault();});
				
                $prevBtn = $section.find(".pager .iconos.top");
                $nextBtn = $section.find(".pager .iconos.bottom");
				$pagerDisplay = $section.find(".pager .page-num");
				$backToListBtn = $section.find(".back-to-list .iconos.back");
				$backToCampaignBtn = $section.find(".back-to-campaign");
				$productInfoBtn = $section.find("a.product-info");
				$seeGalleryBtn = $section.find("a.see-gallery");
				$addToCartBtn = $section.find("#add-to-cart");
				$detailHeaderCloseBtn = $section.find("#product-detail .header a.close");
				/* Agrega Facu */
				$menu = $section.find(".content .menu");
				/*--*/
				$productDetailHeader = $section.find("#product-detail .header");
				
				$productInfoPageWrapper = $section.find(".page-1 .info-wrapper");
				$productInfoPage = $section.find(".page-1 .info-holder");
				$productInfoPageCloseBtn = $section.find(".page-1 .info-holder .close-iframe");
				$productImagePage = $section.find(".page-1 .image-holder");
				
				$pager = $section.find(".pager");

				$page1 = $section.find(".page.page-1");
				$page2 = $section.find(".page.page-2");
				$page3 = $section.find(".page.page-3");
				
				$page2.hide();
				$page3.hide();

				$blockSize = $section.find(".footer-holder .block.size");
				$blockQuantity = $section.find(".footer-holder .block.quantity");
				
				$relatedItem = $section.find(".related-item");
				
					var $productsHoverTargets = $relatedItem.find('.hover');
					
					var normalizeTimeout;
					
					function highlightProducts($products)
					{
						if (normalizeTimeout) clearTimeout(normalizeTimeout);
						var $image = $products.find('.image img');
						$products.css({opacity: 1});
						if (Modernizr.csstransitions && !$.browser.msie)
						{
							$image.css(
							{
								transform: 'perspective(1000px) rotateX(-10deg) scale(1.1)'
							});
						}
					}
					
					function normalizeProduct($target)
					{
						var $image = $target.find('.image img');
						$target.css({opacity: 1});
						
						if (Modernizr.csstransitions && !$.browser.msie)
						{
							$image.css(
							{
								transform: 'perspective(1000px) rotateX(0deg) scale(1)'
							});
						}
					}
					
					function normalizeProducts()
					{
						normalizeTimeout = setTimeout(function()
						{
							normalizeProduct($relatedItem);
						}, 200);
					}
					
					$relatedItem.each(function()
					{
						var $product = $(this);
						var $hoverTarget =  $product.find('.hover');
						var $image = $product.find('.image img');
						var $productName = $product.find('.product-name');
						$image.css({transformOrigin: '50% 90%'});
						
						$hoverTarget.bind('mouseenter', function()
						{
							$productName.addClass('mouse-over');
							highlightProducts($product);
						});
                    
						$hoverTarget.bind('mouseleave', function()
						{
							normalizeProduct($product);
							$productName.removeClass('mouse-over');
						});
					
						$hoverTarget.bind(CLICK_EVENT, self.goTorelatedItem);
					});

				// Buttons
				$productInfoBtn.bind(CLICK_EVENT, self.showIntroductionPage);
				$productInfoPageCloseBtn.bind(CLICK_EVENT, self.closeInfoPage);
				$seeGalleryBtn.bind(CLICK_EVENT, self.pagerNext);
				$nextBtn.bind(CLICK_EVENT, self.pagerNext);
				$prevBtn.bind(CLICK_EVENT, self.pagerPrev);
				$blockSize.bind(CLICK_EVENT, self.showSizeForm);
				$blockSize.bind('touchend', function(e)
				{
					e.originalEvent.preventDefault();
					if (e.originalEvent.touches.length == 0)
					{
						self.showSizeForm.apply(this);
					}
				});
				
				$blockQuantity.bind(CLICK_EVENT, self.showQuantityForm);
				$blockQuantity.bind('touchend', function(e)
				{
					e.originalEvent.preventDefault();
					if (e.originalEvent.touches.length == 0)
					{
						self.showQuantityForm.apply(this);
					}
				});
				
				$addToCartBtn.bind(CLICK_EVENT, self.addToCart);
				
				$addToCartBtn.bind('touchend', function(e)
				{
					e.originalEvent.preventDefault();
					if (e.originalEvent.touches.length == 0)
					{
						self.addToCart.apply(this);
					}
				});
				$detailHeaderCloseBtn.bind(CLICK_EVENT, function(){
					isHeaderOptionOpen = false;
					self.closeDetailHeader();
				});
				
				// Related Item
				bus.publish('satorisan', 'history-update');
				
				if(DATA_JSON.type != "Shoes")
				{
					$(".block.size .size-num").html( ATTRIBUTES_FILTER[4][1].label );
					$('#content > .section-wrapper').addClass('is-not-shoe');
				}
				else
				{
					$('#product-detail .page.page-3 .title .line-2').html(PRODUCTS_FAMILIES[DATA_JSON.family_id].description[CURRENT_LANGUAGE]);
				}

				if (DATA_JSON.type == "Gaiter")
				{
					$(".block.size").remove();
				}
				
				$content.find(".mask-detail").css( { opacity : 0} )
				$content.find(".page").css( { opacity : 0} )
				$content.find(".footer").css( { bottom : -62} )
				$backToListBtn.css ( {marginLeft:-56} )
				$backToCampaignBtn.css ( {marginLeft:-56} )
				$pager.css ( {marginRight:-54} );
				//$content.find(".page-1").css ( { backgroundPosition : "50% 43%" } );
				$nextBtn.css( { top : -62 } );
				$prevBtn.css( { top : -62 } );
	            $(".pager-wrapper").css({right:0});
				$content.find(".mask-detail").css( { opacity : 1} )
				$content.find(".background-name ").css( {opacity:1} );
				//$content.find(".menu .menu-container").css( {marginTop:-25} );
				$content.find(".menu").css( { "height" : 0, marginTop:25 } );
				$proudctNameContainer.animate({opacity: 0}, {complete: function() {$proudctNameContainer.remove();}});
				bus.publish( 'satorisan', 'preloader-hide', {complete:function(){

					var delay=0;

					if (CURRENT_FLOOR == null)
	                {
	                    delay = 250;
	                    CURRENT_FLOOR = 1;
	                    Hydra.module.start("menu", 'menu_instance');
	                    Hydra.module.start("footer", 'footer_instance'); 
	                    bus.publish("satorisan", "menu-change-go", { data:"detail" });
	                    bus.publish( 'satorisan', 'history-update' );
	                    user.HEADER_AND_FOOTER_CREATED = true;

	                }  

					$content.find(".page-1").delay(delay).animate( {opacity:1}, {duration:1000} );

					$content.find(".background-name ").delay(delay).animate({opacity:1, backgroundPosition :"50% 37%"}, {duration:350} );
					$content.find(".image-holder").css({marginTop:25})
					$content.find(".image-holder").delay(delay).animate({marginTop:0},{duration:350});
					$content.find(".page").delay(delay).animate( {opacity:1}, {duration:350} );

					$(".pager-wrapper").delay(700+delay).animate({right:56},{duration:350, complete:function(){
						$nextBtn.animate( { top : -5 }, {duration:250} );
						$prevBtn.animate( { top : -120 }, {duration:250, complete:function(){
							if (DATA_JSON.loose_size == 1 && user.DETAIL_SIZE != 0)
			                {
			                	self.showFilterSizeWidthAlert();
			                }
						}} );
						
						$content.find("#thelist img").each(function(index){
							$(this).attr("src", $(this).attr("_src"));
						});

						self.galleryInit(false);
	                }});

					$content.find(".footer").delay(350+delay).animate( {bottom:27}, {duration:500, easing:"easeOutCubic"} );
					$backToListBtn.delay(700+delay).animate( {marginLeft:0}, {duration:250} );
					$backToCampaignBtn.delay(350+delay).animate( {marginLeft:0}, {duration:250} );
					$pager.delay(350+delay).animate( {marginRight:0}, {duration:250} );

					$content.find(".menu").delay(350+delay).animate( { "height" : 25, marginTop:0 }, {duration:250} );
					//$content.find(".menu .menu-container").delay(350+delay).animate( { marginTop:0 }, {duration:250} );

					//$backToCampaignBtn.unbind(CLICK_EVENT).bind(CLICK_EVENT, self.backToCampaign);

					setTimeout(self.openDetailHeader,delay+350);
					

					CURRENT_FLOOR = 1;

				}} );

				if (user.SIZE != 0)
				{
					var finalSize = user.SIZE;

					for (var o in FILTER_SIZE_UNITS)
					{

						if (user.SIZE_SYSTEM == o)
	                    {
	                        for (var i=0;i<FILTER_SIZE_UNITS["EUR"].length;i++)
	                        {
	                            if (finalSize == FILTER_SIZE_UNITS["EUR"][i])
	                            {
	                                finalSize = FILTER_SIZE_UNITS[o][i]
	                            }
	                        }
	                    }
                	}
                    
					$(".block.size .size-num").html( finalSize + " " + user.SIZE_SYSTEM );
				}

				$content.find(".header_desc a").unbind(CLICK_EVENT).bind(CLICK_EVENT, function(e){
					e.preventDefault();
					bus.publish('satorisan', 'create-shipping-popup');
					return false;
				});
				

				$section.unbind("swipeup").bind('swipeup', self.pagerNext);
                $section.unbind('swipedown').bind('swipedown', self.pagerPrev);

 				$("body").bind("mousewheel", function(event, delta) {
			      if  (delta > 2)
			      {
			      	self.pagerNext()
			      }

			      if  (delta < -2)
			      {
			      	self.pagerPrev()
			      }


			   });

 				$content.find (".page").unbind(CLICK_EVENT).bind(CLICK_EVENT, self.hideFilters);
 				$content.find (".title-price").unbind(CLICK_EVENT).bind(CLICK_EVENT, self.hideFilters);

 				$backToListBtn.unbind(CLICK_EVENT).bind(CLICK_EVENT, function(e){
 					e.preventDefault();
 					user.COME_FROM_DETAIL = true;
 					bus.publish( 'satorisan', 'history-goto', { url:"/shop" } );
 					return false;
 				});

                if (idGridDetail!=null)
                {
                	currentIdGridDetail = idGridDetail;
                	$(".iconos.back.grilla").attr("href", "/campaign-ss14")
                	
                	$(".iconos.back.grilla").unbind(CLICK_EVENT).bind(CLICK_EVENT, function(e){
                		e.preventDefault();
                		idGridDetail = currentIdGridDetail;
                		bus.publish( 'satorisan', 'history-goto', { url:"/campaign-ss14" } );
                		return false;
                	});
                	
                	if (CURRENT_LANGUAGE=="en")
                	{
                		$(".back-to-grid-text").html("BACK TO CAMPAIGN");
                	}
                	else
                	{
                		$(".back-to-grid-text").html("VOLVER A CAMPAÑA");	
                	}
                }

                idGridDetail=null;

				if (fromMapToProduct)
				{
					$backToListBtn.unbind(CLICK_EVENT).bind(CLICK_EVENT, function(e)
					{
	 					e.preventDefault();
                 		fromProductToMap = true;
	                    globalBus.publish( 'satorisan', 'history-goto', { url: '/satori-heart-ss14' } );
	 					return false;
	 				});
	 				
					$(".iconos.back.grilla").addClass('map');
                	$(".back-to-grid-text").html(SATORI_HEART.backToMap_detail[CURRENT_LANGUAGE]);

	                fromMapToProduct = false;
				}
 				

 				$("#product-detail .page.page-1 .content .image-holder img").bind("contextmenu", function(e) {
	                e.preventDefault();
	            });

				self.accomodateRelatedItems();

	            bus.publish( 'satorisan', 'history-check-callback' );
                user.IS_IN_TRANSITION = false;

               

            },

			/*-------------------------------*/

			showFilterSizeWidthAlert:function()
			{
				self.showSizeForm();
			},

			/*-------------------------------*/

			hideFilters:function()
			{
				if (quantitySelect)
				{
					self.productToBottom()
					$section.find(".footer-holder .block.quantity").removeClass("active");
					quantitySelect.destroy();
					quantitySelect = null;
					
				}

				if (sizeSelect)
				{
					self.productToBottom()
					$section.find(".footer-holder .block.size").removeClass("active");
					sizeSelect.destroy();
					sizeSelect = null;
				}

			},

			/*-------------------------------*/

			backToCampaign:function(e){
				e.preventDefault();
				user.COME_FROM_CAMPAIGN_DAY = Number(comeFromCampaignDay);
				user.COME_FROM_CAMPAIGN_HOTSPOT = Number(comeFromCampaignHotspot);
				bus.publish( 'satorisan', 'history-goto', { url:"/campaign" } );
				return false;
			},

			/*-------------------------------*/
			
			launchSection:function()
			{
				self.openDetailHeader();
			},
			
			/*-------------------------------*/
			
			openDetailHeader:function()
			{
				if (user.SHIPPING_CODE != "RU"){
					$productDetailHeader.animate( {"marginTop": 0 }, { duration:400} );
				}
			},
			
			closeDetailHeader:function(e)
			{
				if(e) e.preventDefault();
				$productDetailHeader.animate( {"marginTop": "-55px" }, { duration:400 } );
				return false;
			},
			
			
			/*-------------------------------*/
			
			goTorelatedItem:function(e)
			{
				if (e) e.preventDefault();
				if ( Math.abs(endOffsetX-startOffsetX) < MAX_OFFSET_DRAG &&  Math.abs(endOffsetY-startOffsetY) < MAX_OFFSET_DRAG && ($(this).hasClass("inactive")==false))
                {
                	$body.removeClass(PAGE_BODY_SELECTOR);
                	isReladed = true;
					
					bus.publish( 'satorisan', 'history-goto', { url: $(this).parent().find(".product-name a").attr("href") } );
				}
				return false;
			},

			/*-------------------------------*/

			showQuantityForm:function()
			{
				var t = $(this);
				var d=0;

				if (sizeSelect)
				{
					$section.find(".footer-holder .block.size").removeClass("active");
					sizeSelect.destroy();
					d = 350;
				}

				setTimeout(function(){
					if (sizeSelect) {sizeSelect=null;}

					if (quantitySelect)
					{
						t.removeClass("active");
						quantitySelect.destroy(function(){
							quantitySelect = null;
						});
						self.productToBottom();
					}
					else
					{
						t.addClass("active");
						quantitySelect = new FilterQuantity( self.selectQuantity );
						self.productToTop();		
					}

				}, d);
			},

			/*-------------------------------*/

			showSizeForm:function()
			{
				var t = $(this);
				var d=0;
				if (quantitySelect)
				{
					
					$section.find(".footer-holder .block.quantity").removeClass("active");
					quantitySelect.destroy();
					d = 350;
				}

				setTimeout(function(){				
					if (quantitySelect) {quantitySelect=null;}
				
					if (sizeSelect)
					{
						t.removeClass("active");
						sizeSelect.destroy(function(){
							sizeSelect = null;
						});
						self.productToBottom();
					}
					else
					{
						t.addClass("active");
						
						if (DATA_JSON.type == "Shoes")
						{
							var startInactive = false;
							var s = user.DETAIL_SIZE;
							var currentSizeStock = 0;

							var myIndex = -1;

							for (var i=0;i<stocks_sizes.length;i++)
							{
								if (s == stocks_sizes[i])
								{
									myIndex=i;
								}
							}
							
							if (Number(stocks_quantities[myIndex])==0)
							{
								startInactive = true;
							}

							sizeSelect = new FilterSize( self.selectSize, true, DATA_JSON.sizes, DATA_JSON.loose_size,  startInactive );

						}
						else
						{
							
							sizeSelect = new FilterSizeAccesorie( self.selectSize, DATA_JSON.sizes, DATA_JSON.type );

							var NAMES_OF_SIZES = DATA_JSON.sizes.split("-");
							var STOCK_OF_SIZES = DATA_JSON.sizes_quantities.split("-");
							if (STOCK_OF_SIZES[user.DETAIL_SIZE] == 0) sizeSelect.inactiveSize();

						}					
						self.productToTop();		
					}
				}, d);
			},

			selectQuantity:function()
			{
				$(".block.quantity .quantity-num").html(user.DETAIL_QUANTITY);
			},

			selectSize:function()
			{
				var s = user.DETAIL_SIZE;
				var currentSizeStock = 0;

				var myIndex = -1;

				for (var i=0;i<stocks_sizes.length;i++)
				{
					if (s == stocks_sizes[i])
					{
						myIndex=i;
					}
				}

				

				if (s == "" || s == undefined)
				{
					if(DATA_JSON.type == "Shoes")
					{
						//s = DICTIONARY[CURRENT_LANGUAGE].all;
						s = "-";
						$(".block.size .size-num").html(s);
						$(".block.size .size-num").removeClass("inactive");
					}
					else
					{
						$(".block.size .size-num").html(  ATTRIBUTES_FILTER[4][1].label );
					}
				}
				else
				{
  					var finalSize = user.DETAIL_SIZE;

                    if(DATA_JSON.type == "Shoes")
                    {
	                   	for (var o in FILTER_SIZE_UNITS)
						{

							if (user.SIZE_SYSTEM == o)
		                    {
		                        for (var i=0;i<FILTER_SIZE_UNITS["EUR"].length;i++)
		                        {
		                            if (finalSize == FILTER_SIZE_UNITS["EUR"][i])
		                            {
		                                finalSize = FILTER_SIZE_UNITS[o][i]
		                            }
		                        }
		                    }
	                	}
	                	
	                	if (DATA_JSON.sizes)
	                	{
		                	if ( stocks_quantities[myIndex] < 1){
		                		 $(".block.size .size-num").addClass("inactive");
			                }else{
			                	 $(".block.size .size-num").removeClass("inactive");	
			                }
		            	}
		            	else
		            	{
		            		$(".block.size .size-num").addClass("inactive");
		            	}

	                    $(".block.size .size-num").html( finalSize + " " + user.SIZE_SYSTEM );
                	}
                	else
                	{
                		if (DATA_JSON.sizes)
                		{
	                		if ( DATA_JSON.sizes.indexOf(ATTRIBUTES_FILTER[4][finalSize+1].label) == -1){
		                		 $(".block.size .size-num").addClass("inactive");
			                }else{
			                	 $(".block.size .size-num").removeClass("inactive");	
			                }
		                }	
		                else
		                {
		                	$(".block.size .size-num").addClass("inactive");	
		                }
		                
                		$(".block.size .size-num").html(  ATTRIBUTES_FILTER[4][finalSize+1].label );
                	}
				}

				if(DATA_JSON.type != "Shoes")
				{
					s = ATTRIBUTES_FILTER[4][s+1].label;
				}

				if (DATA_JSON.type == "Shoes")
				{
					
					if (stocks_quantities[myIndex]>0)
					{
						if (sizeSelect) sizeSelect.activeSizes();
						if (toolip)
						{
							toolip.stop();
						}
					}
					else
					{
						if (stocks_quantities[myIndex])
						{
							if (sizeSelect) sizeSelect.inactiveSize();
							if (toolip) toolip.stop();
							if (currentTooltipId != user.DETAIL_SIZE)
							{
								setTimeout(
									function()
									{
										toolip = null;
										var  offsX = 45;
										if (DATA_JSON.type!="Shoes")
										{
											offsX = 90;
										}
										toolip = new Tooltip( { exitMode:"delayButWait", offsetY:-5, offsetX:offsX, className:"out-of-stock-size", target: ".filter-size-selector", markup: DETAIL_SIZE_OUT_OF_STOCK[CURRENT_LANGUAGE], exitTime:6500 } );
										
										$("#stock-alert-btn").unbind().bind(CLICK_EVENT, self.stockAlertPopup)				

									}
								, 400);					
							}
						}
						else
						{
							if (sizeSelect) sizeSelect.activeSizes();
						}
					}
				}
				else
				{
					var NAMES_OF_SIZES = DATA_JSON.sizes.split("-");
					var STOCK_OF_SIZES = DATA_JSON.sizes_quantities.split("-");
					var accesorieStock = 0;
					for ( var k=0; k<NAMES_OF_SIZES.length; k++)
					{
						if (NAMES_OF_SIZES[k]==s)
						{
							accesorieStock = STOCK_OF_SIZES[k];
						}
					}


					
					if (accesorieStock>0)
					{
						if (sizeSelect) sizeSelect.activeSizes();
						if (toolip)
						{
							toolip.stop();
						}
					}
					else
					{
						if (sizeSelect) sizeSelect.inactiveSize();
						if (toolip) toolip.stop();
						if (currentTooltipId != user.DETAIL_SIZE)
						{
							setTimeout(
								function()
								{
									toolip = null;
									var  offsX = 45;
									if (DATA_JSON.type!="Shoes")
									{
										offsX = 40;
									}
									toolip = new Tooltip( { exitMode:"delayButWait", offsetY:-5, offsetX:offsX, className:"out-of-stock-size", target: ".filter-size-selector", markup: DETAIL_SIZE_OUT_OF_STOCK[CURRENT_LANGUAGE], exitTime:6500 } );				

								}
							, 400);					
						}
					}
				}

				currentTooltipId = user.DETAIL_SIZE;
			},



			stockAlertPopup: function(){
				//console.log(DATA_JSON.product_id)
				bus.publish( 'satorisan', 'append-page', { content: "stock-alert",
												id_size_product: DATA_JSON.product_id,
												product_name: DATA_JSON.prod_title,
												size: user.DETAIL_SIZE,
												size_chart: user.SIZE_SYSTEM } );
				
			},
			
			// ------------------------------------------------------ >
			// Info Page
			
			openInfoPage:function(e){
				e.preventDefault();
		 		self.createProductScroll();
					//alert($(".description").getNiceScroll());
				if ($productInfoBtn.hasClass("active") == false)
				{
					freakingInfoOpened = true;
					$section.unbind("swipeup");
	                $section.unbind('swipedown');
 
				 	$productInfoPageWrapper.find(".close-iframe").css( "right",0 );
					$productInfoPageWrapper.css("display","");
					$(".image-holder,.page-background .menu").animate( { opacity:0 }, {duration:250} );
					$productInfoPageWrapper.delay(100).animate( { height: 500 }, {duration:700, 
						complete: function(){
							
							//setTimeout(function(){$(".description").getNiceScroll().show(),1000});
							$productInfoPageWrapper.find(".info-image-holder").animate( { opacity:1 }, {duration:350} )
							$productInfoPageWrapper.find(".close-iframe").delay(350).animate( { right:-57 }, {duration:150} )
							//$productInfoPage.css({ overflow: "" });
							//$productImagePage.hide();
							$(".description").getNiceScroll().show();
							$productInfoBtn.addClass("active");
						}
					})

					//$productInfoPageWrapper.css("display","");
					//$productInfoPage.show();
					//$menu.hide();
					//$productInfoPage.css({ height: "0" });
					//$productImagePage.css( { position: "absolute", right:0, left:0 } );
					//$productInfoPageWrapper.find(".info-image-holder").css( "opacity",0 );
				}
				else
				{
					// $productInfoPage.hide();
					// $menu.show();
					// $productImagePage.show();
					// $productInfoBtn.re
					moveClass("active");
				}
				return false;
			},
			
			closeInfoPage:function(e){

				if(e) e.preventDefault();
				freakingInfoOpened = false;
				$(".description").getNiceScroll().hide();
				//$productInfoPage.css({ overflow: "hidden" });
				$section.unbind("swipeup").bind('swipeup', self.pagerNext);
                $section.unbind('swipedown').bind('swipedown', self.pagerPrev);
				$productInfoPageWrapper.animate( { height: 0 }, {duration:350, 
					complete: function(){
					$(".image-holder,.page-background .menu").animate( { opacity:1 }, {duration:150} );
						$productInfoPageWrapper.css("display","none");
						$productInfoPageWrapper.find(".info-image-holder").animate( { opacity:0 }, {duration:0} )
						$productInfoPageWrapper.find(".close-iframe").animate( { right:0 }, {duration:0} )

						//$productInfoPage.css({ overflow: "" });
						//$menu.show();
						//$productImagePage.hide();
						//$productImagePage.css( { position: "", right:"none", left:"none" } );
						//$productInfoPageWrapper.hide();
						$productInfoBtn.removeClass("active");
					}
				})	//$productImagePage.show();

				return false;
			},
			
			
			// ------------------------------------------------------ >
			// Pager
			
			pagerNext:function(e){
				if (e) e.preventDefault();
				if( actualPage < 3 ){
					prevPage = actualPage;
					
					if (isImageTop)
					{
						self.hideFilters();
						self.productToBottom({complete:function(){
							self.pagerLoadPage( prevPage, (actualPage+1)  );		
						}});
					}
					else
					{
						self.pagerLoadPage( prevPage, (actualPage+1)  );
					}
				}
				return false;
			},
			
			showIntroductionPage: function(e) {
				if (e) e.preventDefault();
				self.pagerLoadPage(2, 3);
				return false;
			},
			
			pagerPrev:function(e){
				if (e) e.preventDefault();
				if( actualPage > 1 ){
					prevPage = actualPage;
					if (isImageTop)
					{
						self.hideFilters();
						self.productToBottom({complete:function(){
							self.pagerLoadPage( prevPage, (actualPage-1)  );	
						}});
					}
					else
					{
						self.pagerLoadPage( prevPage, (actualPage-1)  );	
					}
					
				}
				return false;
			},
			
			pagerLoadPage:function(prevPage, newPage){				
				if (blocker==false)
				{
					
					blocker = true;
					actualPage = newPage;
					
					top1=0-$window.height();
					top3=$window.height();

					if (prevPage==1) top1 = 0;
					if (prevPage==2) top2 = 0;
					if (prevPage==3) top3 = 0;

					var offsetDivision = 3.5;
					
					if( actualPage == 1 ){

						$page1.show();
						page1Top = 0;
						page2Top = $window.height() - ($window.height()/offsetDivision);
						page3Top = $window.height()*2;
						
						zindex1=3;
						zindex2=2;
						zindex3=1;
						
					}else if ( actualPage == 2 ){
						
						if (freakingInfoOpened) $(".description").getNiceScroll().hide();
						$page2.show();
						page1Top = ($window.height()*-1) + ($window.height()/offsetDivision);
						page2Top = 0;
						page3Top = $window.height() - ($window.height()/offsetDivision);

						zindex1=1;
						zindex2=3;
						zindex3=2;

						if ( prevPage == 3 ) top2 = 0-$window.height(); 
						if ( prevPage == 1 ) top2 = $window.height(); 
						
					}
					else if ( actualPage == 3 )
					{
						$page3.show();

						self.accomodateRelatedItems();

						page1Top = ($window.height()*-1)*2;
						page2Top = ($window.height()*-1) + ($window.height()/offsetDivision);
						page3Top = 0;

						zindex1=1;
						zindex2=2;
						zindex3=3;
					}
					if (prevPage == 2){$(".pinterest_galery").animate( { opacity:0}, {duration:250} );}


					if (Modernizr.csstransforms && !$.browser.msie)
					{

						//console.log("anim transform 1"+TRANSITION_END_EVENT)
						$page2.one(TRANSITION_END_EVENT, function(){self.transitionComplete();});
						//console.log("anim transform 2")
						if ( (prevPage==1 && actualPage==2) || (prevPage==2 && actualPage==1))
						{
							$page1.show();
							$page2.show();
							$page3.hide();
							
							$page1.removeClass("transition-top").css({"z-index" : zindex1, 'transform': 'translate3D(0,'+top1+'px,0)' });
							$page2.removeClass("transition-top").css({"z-index" : zindex2, 'transform': 'translate3D(0,'+top2+'px,0)' });
							setTimeout(function(){
								$page1.addClass("transition-top").css( { 'transform': 'translate3D(0,'+page1Top+'px,0)' } );
								$page2.addClass("transition-top").css( { 'transform': 'translate3D(0,'+page2Top+'px,0)' } );
							},100);
						}

						if ( (prevPage==2 && actualPage==3) || (prevPage==3 && actualPage==2) )
						{
							$page1.hide();
							$page2.show();
							$page3.show();
							
							$page2.removeClass("transition-top").css({"z-index" : zindex2, 'transform': 'translate3D(0,'+top2+'px,0)' });
							$page3.removeClass("transition-top").css({"z-index" : zindex3, 'transform': 'translate3D(0,'+top3+'px,0)' });
							
							setTimeout(function(){
								$page2.addClass("transition-top").css( { 'transform': 'translate3D(0,'+page2Top+'px,0)' } );
								$page3.addClass("transition-top").css( { 'transform': 'translate3D(0,'+page3Top+'px,0)' } );
							},100);
						}
					}
					else
					{
						$page1.show();
						$page2.show();
						$page3.show();

						if ( (prevPage==1 && actualPage==2) || (prevPage==2 && actualPage==1))
						{
							
							$page1.show();
							$page2.show();
							$page3.hide();
							
							$page1.css({"z-index" : zindex1, top:top1}).animate( {"top": page1Top }, { duration:1150, easing:"easeInOutCubic" } );
							
							$page2.css({"z-index" : zindex2, top:top2}).animate( {"top": page2Top }, { duration:1150, easing:"easeInOutCubic", complete:self.transitionComplete } );
							
						}

						if ( (prevPage==2 && actualPage==3) || (prevPage==3 && actualPage==2))
						{
							$page1.hide();
							$page2.show();
							$page3.show();
							
							$page2.css({"z-index" : zindex2, top:top2}).animate( {"top": page2Top }, { duration:1150, easing:"easeInOutCubic" } );
							$page3.css({"z-index" : zindex3, top:top3}).animate( {"top": page3Top }, { duration:1150, easing:"easeInOutCubic", complete:self.transitionComplete } );
						}

					}
						
		
					
					
				}
				
			},
			
			
			// ------------------------------------------------------ >
			// Transition complete

			transitionComplete:function(){

				
				if (actualPage == 2)
				{
					$(".pinterest_galery").animate( { opacity:1 } , {duration:250} );
				}
				
				$pagerDisplay.html(actualPage+"/3");
				
				$prevBtn.removeClass("disabled");
				$nextBtn.removeClass("disabled");
				if( actualPage == 1 ){
					$prevBtn.addClass("disabled");
				}else if( actualPage == 3 ){
					$nextBtn.addClass("disabled");
				}

				self.hideFilters();
				
				$page1.removeClass("transition-top");
				$page2.removeClass("transition-top");
				$page3.removeClass("transition-top");
				
				blocker = false;
				if (actualPage == 1)
				{

					if (freakingInfoOpened) $(".description").getNiceScroll().show();
					$page2.hide();
					$page3.hide();		

					if (isHeaderOptionOpen)
					{
						setTimeout(self.openDetailHeader,400);
					}
				}

				if (actualPage == 2)
				{

					$page1.hide();
					$page3.hide();
					setTimeout(self.closeDetailHeader, 400);
				}

				if (actualPage == 3)
				{
					$page1.hide();
					$page2.hide();		
					//self.closeDetailHeader();
				}


				currentGalleryIndex = 0;
				self.galleryInit(false);
			},

			// ------------------------------------------------------ >
			// Images Gallery
			
			galleryInit:function(gotoTarget) {
				
				if (gallerySlider){
					gallerySlider.destroy();
					gallerySlider = null;
				}

				var $imgGallery = $('#img-gallery');
				
				// prevent right click on images
				$imgGallery.find("img").bind("contextmenu", function(e) {
	                e.preventDefault();
	            });
				

				DragCursor.open($imgGallery);
				gallerySlider = new iScroll('img-gallery',
				{
					snap: true,
					momentum: false,
					hScrollbar: false,
					onScrollEnd: function()
					{
						DragCursor.open($imgGallery);
						document.querySelector('#img-gallery-controls > li.active').className = '';
						document.querySelector('#img-gallery-controls > li:nth-child('+(parseInt(this.currPageX)+1)+')').className='active';
						currentGalleryIndex = parseInt(this.currPageX);

						temp_img = $("#img-gallery img").eq(parseInt(this.currPageX)).attr("src");
						$(".pinterest_galery").stop().animate({ opacity:0}, {duration:100, complete:function(){
							
							$(".pinterest_galery").html("<script type='text/javascript' src='//assets.pinterest.com/js/pinit.js'></script><a href='http://pinterest.com/pin/create/button/?description=Satorisan - Live by the Walk&amp;url=" + getShareURL() + "&amp;media=" + temp_img + "' class='pin-it-button' count-layout='none'><img border='0' src='//assets.pinterest.com/images/PinExt.png' title='Pin It' /></a>");	
							//$(".pinterest_galery").html("<a href='http://pinterest.com/pin/create/button/?description=Satorisan - Live by the Walk&amp;url=" + getShareURL() + "&amp;media=" + temp_img + "' class='pin-it-button' count-layout='none'><img border='0' src='//assets.pinterest.com/images/PinExt.png' title='Pin It' /></a>");
							//runPinterest();
							$(".pinterest_galery").delay(100).stop().animate({ opacity:1}, {duration:100});
						}})
						

					},
					onBeforeScrollStart: function()
					{
						DragCursor.closed($imgGallery);
					}
	 			});

				if (currentGalleryIndex !=0 && gotoTarget==true)
				{
					if (gallerySlider)
					{
						gallerySlider.scrollToPage(currentGalleryIndex, 0, 0);
						document.querySelector('#img-gallery-controls > li.active').className = '';
						document.querySelector('#img-gallery-controls > li:nth-child('+(parseInt(currentGalleryIndex)+1)+')').className='active';
						
						temp_img = $("#img-gallery img").eq(parseInt(currentGalleryIndex)).attr("src");
						$(".pinterest_galery").stop().animate({ opacity:0}, {duration:100, complete:function(){
							
							$(".pinterest_galery").html("<script type='text/javascript' src='//assets.pinterest.com/js/pinit.js'></script><a href='http://pinterest.com/pin/create/button/?description=Satorisan - Live by the Walk&amp;url=" + getShareURL() + "&amp;media=" + temp_img + "' class='pin-it-button' count-layout='none'><img border='0' src='//assets.pinterest.com/images/PinExt.png' title='Pin It' /></a>");	
							//$(".pinterest_galery").html("<a href='http://pinterest.com/pin/create/button/?description=Satorisan - Live by the Walk&amp;url=" + getShareURL() + "&amp;media=" + temp_img + "' class='pin-it-button' count-layout='none'><img border='0' src='//assets.pinterest.com/images/PinExt.png' title='Pin It' /></a>");
							//runPinterest();
							$(".pinterest_galery").delay(100).stop().animate({ opacity:1}, {duration:100});
						}});
					}
				}
				else
				{
					$(".pinterest_galery").html("<script type='text/javascript' src='//assets.pinterest.com/js/pinit.js'></script><a href='http://pinterest.com/pin/create/button/?description=Satorisan - Live by the Walk&amp;url=" + getShareURL() + "&amp;media=" + $("#img-gallery img").eq(0).attr("src") + "' class='pin-it-button' count-layout='none'><img border='0' src='//assets.pinterest.com/images/PinExt.png' title='Pin It' /></a>");
					//$(".pinterest_galery").html("<a href='http://pinterest.com/pin/create/button/?description=Satorisan - Live by the Walk&amp;url=" + getShareURL() + "&amp;media=" + $("#img-gallery img").eq(0).attr("src") + "' class='pin-it-button' count-layout='none'><img border='0' src='//assets.pinterest.com/images/PinExt.png' title='Pin It' /></a>");
					//runPinterest();


					document.querySelector('#img-gallery-controls > li.active').className = '';
					document.querySelector('#img-gallery-controls > li:nth-child(1)').className='active';
				}
				
				
				
				$("#img-gallery-controls li").unbind(CLICK_EVENT).bind(CLICK_EVENT, self.galleryLoadImage);

				
				this.galleryResize();
			},

			/* ORIGINAL 06-02-2013*/
			galleryResize: function()
			{
				$("#img-gallery ul li img").each(function(index){

					var marginTopImage = 0;

					var originalWidth = $(this).attr("_width");
					var originalHeight = $(this).attr("_height");

					var finalWidth;
					var finalHeight;

					if ($window.width() > $window.height() * 1.3 )
					{
						
						$(this).css( {
							width : $window.width(),
							height : "auto"
						} );


						finalWidth = $window.width();
						finalHeight = finalWidth * originalHeight / originalWidth;

						$(this).css( {
							marginTop:($window.height()/2) - (finalHeight/2) -20
						} );

					}else{
						
						$(this).css( {
							height : $window.height()-40,
							width : "auto"	

						} );

						finalHeight = $window.height()-40;
						finalWidth = finalHeight * originalWidth / originalHeight;

						$(this).css( {
							marginLeft:($window.width()/2) - (finalWidth/2) - 20
						} );

					}
				});


				$("#img-gallery, #img-gallery ul li").css( {"overflow":"hidden", "height":$window.height()-80} );
				//$("#img-gallery, #img-gallery ul li").css( "width", $("#img-gallery ul li img").css( "width") );
				//$("#scroller").css( "width", $("#scroller ul li img").css("width").replace('px','')*4 );
				$("#img-gallery, #img-gallery ul li").css( "width", $body.width()+"px" );
				licount = $("#img-gallery #thelist li").length;
				$("#scroller").css( "width", ($body.width()*licount)+"px" );
			},
			
			galleryLoadImage:function(e){
				gallerySlider.scrollToPage($(e.target).attr("pos"), 0, 1150);
			},
			
			addToCart:function(e){
				if (e) e.preventDefault();
				
				//alert(id_size_product);
				self.hideFilters();
				
				if (user.SHIPPING_CODE == "RU")
				{
					//alert(SHIPPING_REGION);
					//alert(SHIPPING_REGION);
					//alert(user.SHIPPING_CODE);
					//alert(1);
					var theXOffset = theXOffset2 = 43 - 80 + ($window.width()/2  - $(".footer-holder").width()/2) + $(".title-price").width() + $(".block.size").width()/2;
				
					if (tooltipCart)
					{						
						tooltipCart.stop();
						setTimeout(function(){							
							tooltipCart = new Tooltip( { offsetX:32, offsetY:-18, target: ".block.add-to-cart", markup: DICTIONARY[CURRENT_LANGUAGE].unavailablearea, exitMode:"delay", exitTime:223500} );                             
						}
						,350);
					}
					else
					{						
						tooltipCart = new Tooltip( { offsetX:32, offsetY:-18, target: ".block.add-to-cart", markup: DICTIONARY[CURRENT_LANGUAGE].unavailablearea, exitMode:"delay", exitTime:223500} );                             
					}

					$(".tooltip").addClass("not-available");
				}
				else if ( 
					(((user.DETAIL_SIZE == -1 || user.DETAIL_SIZE == 0 || user.DETAIL_SIZE == undefined) && DATA_JSON.type == "Shoes") )
					|| (((user.DETAIL_SIZE == "" && user.DETAIL_SIZE != 0 )) && ( DATA_JSON.type == "T-shirt" || DATA_JSON.type == "Helmet" )) ) 
				{
					//var theXOffset = theXOffset2 = 43 + $(".title-price").offset().left + $(".title-price").width() + ($(".block.size").width()/2) +  80;
					var theXOffset = theXOffset2 = 43 - 80 + ($window.width()/2  - $(".footer-holder").width()/2) + $(".title-price").width() + $(".block.size").width()/2;
				

					if (tooltipCart)
					{
						tooltipCart.stop();
						setTimeout(function(){
							
							tooltipCart = new Tooltip( { offsetX:30, offsetY:-20, target: ".block.size", markup: DICTIONARY[CURRENT_LANGUAGE].selectsize, exitMode:"delay", exitTime:4500} );                             
						}
						,350);
					}
					else
					{
						
						tooltipCart = new Tooltip( { offsetX:30, offsetY:-20, target: ".block.size", markup: DICTIONARY[CURRENT_LANGUAGE].selectsize, exitMode:"delay", exitTime:4500} );                             
					}
				}
				else
				{
					
					if (self.checkStock())
					{
						function cartAddHandler()
						{
							var $sectionWrapper = $('.section-wrapper');
							$cartDialog = $
							('\
								<div id="cart-dialog" class="' + DATA_JSON.type + '">\
									<div class="thumb"></div>\
									<div class="name"></div>\
									<div class="added"></div>\
								</div>\
							');
							var $addToCartButtonParent = $addToCartBtn.parent();
							$cartDialog.css('right', $window.width() - ($addToCartButtonParent.offset().left + $addToCartButtonParent.width()));
							$cartDialog.width($addToCartButtonParent.width());
							$cartDialog.find('.thumb').append($productInfoPageWrapper.find(".info-image-holder img").clone());
							$cartDialog.find('.name').append(DATA_JSON.prod_title);
							$cartDialog.find('.added').text(DICTIONARY[CURRENT_LANGUAGE].added_to_cart);
							$cartDialog.css('opacity', 0);
							$sectionWrapper.append($cartDialog);
							$cartDialog.css('top', -$cartDialog.innerHeight());
							$cartDialog.css('opacity', 1);
							$cartDialog.animate({top: 0}, {duration: 500, specialEasing: {top: 'easeOutCubic'}});
							$cartDialog.delay(2000);
							$cartDialog.animate({top: -$cartDialog.innerHeight()}, {duration: 500, specialEasing: {top: 'easeInCubic'}, complete: function()
							{
								$cartDialog.remove();
							}});

							
							$backToListBtn.unbind(CLICK_EVENT).bind(CLICK_EVENT, function(e){
			 					e.preventDefault();
			 					
			 					user.COME_FROM_DETAIL = true;
			 					bus.publish( 'satorisan', 'history-goto', { url:"/shop" } );
			 					return false;
		 					});
							
						}
						$window.bind('cartAdd', cartAddHandler);
						function cartCompleteHandler()
						{
							$addToCartBtn.removeClass('adding');
							$window.unbind('cartAdd', cartAddHandler);
							$window.unbind('cartComplete', cartCompleteHandler);
							
							
							$backToListBtn.unbind(CLICK_EVENT).bind(CLICK_EVENT, function(e){
			 					e.preventDefault();
			 					
			 					user.COME_FROM_DETAIL = true;
			 					bus.publish( 'satorisan', 'history-goto', { url:"/shop" } );
			 					return false;
		 					});

						}
						$window.bind('cartComplete', cartCompleteHandler);
						$addToCartBtn.addClass('adding');
						
						if (DATA_JSON.type == "Gaiter")
						{
							
							bus.publish( 'satorisan', 'add-to-cart', { "id_product":DATA_JSON.product_id, quantity:user.DETAIL_QUANTITY } );		
						}
						else
						{
							bus.publish( 'satorisan', 'add-to-cart', { "id_product":id_size_product, quantity:user.DETAIL_QUANTITY } );
						}
						
						return false;			
					}
					else
					{
	
						//var theXOffset2 = (0-$(".align_right").offset().left)-140+$(".block.size").width()+$(".block.quantity").width()+$("#add-to-cart").width()/2 - (80);
						
						var theXOffset2;

						if (DATA_JSON.type == "Gaiter")
						{
							theXOffset2 = ( $window.width()/2  - $(".footer-holder").width()/2) + $(".title-price").width() + $(".block.quantity").width()/2;
						}
						else
						{
							theXOffset2 = ( $window.width()/2  - $(".footer-holder").width()/2) + $(".title-price").width() + $(".block.size").width() + $(".block.quantity").width()/2;
						}

						if (tooltipCart)
						{
							tooltipCart.stop();
							//alert(1);
							setTimeout(function(){
								
								tooltipCart = new Tooltip( { offsetX:35, offsetY:-20, target: ".block.quantity", markup: DICTIONARY[CURRENT_LANGUAGE].quantitynostock, exitMode:"delay", exitTime:4500} );                             
							}
							,350);
						}
						else
						{
							
							tooltipCart = new Tooltip( { offsetX:35, offsetY:-20, target: ".block.quantity", markup: DICTIONARY[CURRENT_LANGUAGE].quantitynostock, exitMode:"delay", exitTime:4500} );                             
						}
					}
				}
			},
			
			/*-------------------------------*/

			productToTop: function()
			{
				isImageTop = true;
				$("#img-gallery-controls").animate( {marginTop : -75}, {duration:300});
				$(".page-background").animate( {marginTop : -75}, {duration:300});
				$("#product-detail .page.page-3 .content").animate( {marginTop : -378}, {duration:300});

			},

			/*-------------------------------*/

			productToBottom: function(data)
			{
				isImageTop = false;
				$("#product-detail .page.page-3 .content").animate( {marginTop : -278}, {duration:300});
				$("#img-gallery-controls").animate( {marginTop : 0}, {duration:300});
				$(".page-background").animate( {marginTop : 0}, {duration:300, complete:function(){
					if (data) data.complete();
				}});
			},

			/*-------------------------------*/

			checkStock: function()
			{
				var sw = false;
				var stringSize = user.DETAIL_SIZE;	

				if (DATA_JSON.type != "Gaiter")
				{
					if (DATA_JSON.type != "Shoes")
					{
						stringSize = ATTRIBUTES_FILTER[4][user.DETAIL_SIZE+1].label;
					}					
					
					if (String(DATA_JSON.sizes).indexOf(stringSize) != -1)
					{
						var current_index;
						var sizes = DATA_JSON.sizes.split("-");
						var sizes_ids = DATA_JSON.sizes_ids.split("-");
						var sizes_quantities = DATA_JSON.sizes_quantities.split("-");
						
						for (var i=0;i<sizes.length;i++)
						{
							if (sizes [i] == stringSize)
							{
								current_index = i;
								break;
							}
						}
						
						if ( sizes_quantities[current_index] >= user.DETAIL_QUANTITY)
						{
							id_size_product = sizes_ids[current_index];					
							sw = true;
						}
						else
						{
							id_size_product_for_stock_alert = sizes_ids[current_index];
						}


					}
				}
				else
				{
					
					//alert( ">>>"+user.DETAIL_QUANTITY);
					if (DATA_JSON.quantity >= user.DETAIL_QUANTITY)
					{
						id_size_product = id_product;					
						sw = true;
					}
					else
					{
						id_size_product_for_stock_alert = sizes_ids[current_index];
					}
				}

				
				

				return sw;
			},

			relatedItemsInit: function()
			{
				self.accomodateRelatedItems();
			},

			startMouseDown: function(e)
            {
                startOffsetX = e.pageX;
                startOffsetY = e.pageY;
            },

            /*-------------------------------*/

            stopMouseDown: function(e)
            {
                endOffsetX = e.pageX;
                endOffsetY = e.pageY;
            },

			/*-------------------------------*/
			
            stop: function()
            {
				if (isActive==true)
				{
					id_product = -1;
					isActive = false;
					actualPage = 1; 

					if (sizeSelect)
					{
						sizeSelect.destroy();
					}

					if (quantitySelect)
					{
						quantitySelect.destroy();
					}

					if (gallerySlider)
					{
						gallerySlider.destroy(true);
						gallerySlider = null;
					}

					if ($productInfoBtn)
					{
						$productInfoBtn.unbind(CLICK_EVENT, self.showIntroductionPage);
						$productInfoPageCloseBtn.unbind(CLICK_EVENT, self.closeInfoPage);
						$seeGalleryBtn.unbind(CLICK_EVENT, self.pagerNext);
						$nextBtn.unbind(CLICK_EVENT, self.pagerNext);
						$prevBtn.unbind(CLICK_EVENT, self.pagerPrev);
						$blockSize.unbind(CLICK_EVENT, self.showSizeForm);
						$blockQuantity.unbind(CLICK_EVENT, self.showQuantityForm);				
						$addToCartBtn.unbind(CLICK_EVENT, self.addToCart);
						$relatedItem.unbind(CLICK_EVENT, self.goTorelatedItem);
						$("#img-gallery-controls li").unbind(CLICK_EVENT, self.galleryLoadImage);
						$section.unbind("swipeup");
 		                $section.unbind('swipedown');
					}
					
					$window.unbind("resize", self.resize);

	                DATA_JSON = undefined;
	                $body.removeClass(PAGE_BODY_SELECTOR);
	                bus.publish( 'satorisan', 'destroy-products-filter' );
            	}
            }
			
        }
    
});

Hydra.module.register( 'page-home', function( bus ){ 
        
        var MY_HOME_IMAGES;
        var PAGE_BODY_SELECTOR = "home";
        var DATA_JSON, timeline;
        var MARKUP_TEMPLATE;
        var direction=1;
        var MARKUP_SECTION="";
        var isFromClick=false;
        var $this = this, isActive = false;
        var IMAGE_BACK_DISTANCE = 1.5;
        var timeoutResume,currentPath,activeIndex,totalPhotos,currentIndex,$next,$back,$container,$imagesContainer,isStepComplete=false,isPreloading=false,listPreloaders=new Array(),isInit=true,appendOK=false, isResume=false,isWaitingForAppend=false;

        return {
            
            /*-------------------------------*/
            /* HOME */
            /*-------------------------------*/            

            init: function(){
                $this = this;
                bus.subscribe('satorisan', this);
            },
            
            /*-------------------------------*/

            oEventsCallbacks: {
                'append-page' : function (data) {                    
                    if (isActive==false)
                    {
                        if (data.content == "home")
                        {
                            isActive = true;
                            isInit = true;
                            bus.publish("satorisan", "ganalytics-track-path");
                            this.create();
                        }
                    }
                },

                'pause-page' : function()
                {
                   if (isActive)
                   {
                       if (timeoutResume) clearTimeout(timeoutResume);
                       isResume = true;
                       if (timeline) timeline.pause();
                   }
                },

                'resume-page' : function()
                {
                   if (isActive)
                   {
                        if (timeoutResume) clearTimeout(timeoutResume);
                        timeoutResume = setTimeout(function(){
                            isResume = false;
                            if (isWaitingForAppend)
                            {
                                $this.appendNext(true);
                            }
                            else
                            {
                                if(timeline) timeline.resume();
                            }
                        },350);
                   }
                },
                
                'destroy-page' : function()
                {
                    this.stop();
                }
            },

            /*-------------------------------*/

            create:function(){
                currentIndex = 0;
                activeIndex = 0;

                /*if (user.LAST_CAMPAIGN_DAY == 0)
                {
                    MY_HOME_IMAGES = new Array(new Object(HOME.images[1]), new Object(HOME.images[0]));
                }
                else
                {
                    MY_HOME_IMAGES = new Array(new Object(HOME.images[0]), new Object(HOME.images[1]));
                }*/

                MY_HOME_IMAGES = new Array(new Object(HOME.images[0]), new Object(HOME.images[1]), new Object(HOME.images[2]));

                user.LAST_CAMPAIGN_DAY = -1

                currentPath = MY_HOME_IMAGES[currentIndex].path;
                totalPhotos = MY_HOME_IMAGES.length;
                
                if (user.HEADER_AND_FOOTER_CREATED)
                {
                    bus.publish( 'satorisan', 'preloader-show', { black:true } );
                }
                else
                {
                    bus.publish( 'satorisan', 'preloader-show' );
                }
                
                

                $.preload([ MY_HOME_IMAGES[0].path ], {
                    
                    loaded:function(img, loaded, total){
                        bus.publish( 'satorisan', 'preloader-update', { rate:(loaded/total)*100 } );
                    },

                    loaded_all:function(){         
                    
                        listPreloaders[ currentPath ] = true;

                        bus.publish( 'satorisan', 'preloader-hide', {complete:function(){
                            var cookiesMarkup = "";
                            
                            if (QUESTION_COOKIES_DO == false || ACCEPT_COOKIES==false)
                            {
                                cookiesMarkup = "<div class='cookies-question'><div class='text-legend'>" + DICTIONARY[CURRENT_LANGUAGE].cookies_text + "  <span class='about-button'>" + DICTIONARY[CURRENT_LANGUAGE].about_cookies + "</span><span class='accept-button'>" + DICTIONARY[CURRENT_LANGUAGE].accept_cookies + "</span><span class='close-button'>X</span></div></div>";
                            }
                            
                            $content.append("<div class='section-wrapper new-section " + PAGE_BODY_SELECTOR + "'><div class='home-container'><div class='arrows'><a class='left iconos normal-link'><span>Prev</span></a><a  class='right iconos normal-link'><span>Next</span></a></div><div class='title'><div class='title-container'><div class='big'><div class='title-mask'>" + MY_HOME_IMAGES[currentIndex]["title_" + CURRENT_LANGUAGE] + "</div></div><div class='collection'><div class='body-mask'>" + MY_HOME_IMAGES[currentIndex]["body_" + CURRENT_LANGUAGE] + "</div><a class='see-collection home-item-button' href='" + MY_HOME_IMAGES[currentIndex].button["link_"+CURRENT_LANGUAGE] + "' target='" + MY_HOME_IMAGES[currentIndex].button.target + "' >" + MY_HOME_IMAGES[currentIndex].button["text_" + CURRENT_LANGUAGE] + "</a></div></div></div><div class='images-container'><div class='image-scale' style='width:"+$window.height()+";height:"+$window.height()+"px;position:absolute;'><img src='" + currentPath + "' /></div></div>"+cookiesMarkup+"</div></div>");

                            $container = $(".section-wrapper."+PAGE_BODY_SELECTOR);                    
                            $next = $container.find(".right");
                            $back = $container.find(".left");
                            $imagesContainer = $(".images-container");

                            if (QUESTION_COOKIES_DO == false)
                            {
                                setTimeout(function(){
                                    $(".cookies-question").show().animate({top:1},{duration:350});
                                },2000);
                            }

                            QUESTION_COOKIES_DO = true;
                            

                            //$(".cookies-question .about-button").bind("click", $this.aboutCookies);
                            $(".accept-button").bind("click", $this.acceptCookies);
                            $(".close-button").bind("click", $this.closeCookies);

                            $window.bind("resize", $this.resize);
                            currentPath = MY_HOME_IMAGES[currentIndex + 1].path;
                            $this.resize();                        

                            $back.bind(CLICK_EVENT, $this.gotoPrev);
                            $next.bind(CLICK_EVENT, $this.gotoNext)
                            
                            $back.css( { opacity:0 } );
                            $next.css( { opacity:0 } );

                            $container.bind('swipeleft', $this.gotoNext);
                            $container.bind('swiperight', $this.gotoPrev);


                            

                            $(".section-wrapper.home").addClass("phrase" + currentIndex);

                            if (CURRENT_FLOOR == null)
                            {
                                CURRENT_FLOOR = 0;
                                
                                $back.hide();                       
                                $next.hide();
                                
                                //$container.find(".title .container").css( {marginTop:172} );
                                //$container.find(".title .big").css( {marginTop:-120} );
                                //$container.find(".home-container .title").css({opacity:0});
                                $this.checkMenuCreated();

                                if (Modernizr.csstransforms && !$.browser.msie)
                                {                                  
                                      $container.css( { 
                                        '-webkit-transform': 'translate3D(0,'+$window.height()+'px,0)',
                                        '-moz-transform': 'translate3D(0,'+$window.height()+'px,0)',
                                        '-o-transform': 'translate3D(0,'+$window.height()+'px,0)',
                                        '-ms-transform': 'translate3D(0,'+$window.height()+'px,0)'
                                        } );
                                        var sw = true
                                        setTimeout(function(){
                                            
                                            $container.one(TRANSITION_END_EVENT, function(){
                                                if (sw==true)
                                                {
                                                    /*$back.css({marginLeft:-60}).show().animate({marginLeft:0}, 250);
                                                    $next.css({marginRight:-60}).show().animate({marginRight:0}, 250);*/
                                                    $back.show().animate( { opacity:1}, {duration:250} );
                                                    $next.show().animate( { opacity:1}, {duration:250} );
                                                    
                                                    $container.find(".home-container .title").css({opacity:0}).show();
                                                    $(".section-wrapper.home .title").animate( { opacity:1}, {duration:250, complete:function(){
                                                        $blocker.hide();
                                                        bus.publish( 'satorisan', 'history-check-callback' );
                                                        user.IS_IN_TRANSITION = false;
                                                    }});

                                                    $container.removeClass("transition-top")
                                                    timeline = new Timeline( {steps:totalPhotos, onStepCallback:$this.onStepCallback, onEndCallback:$this.onEndCallback, interruptCallback:$this.interruptCallback } );
                                                    $this.startPreloadingNext();
                                                    
                                                    timeline.goto(activeIndex);
                                                    bus.publish( 'satorisan', 'history-update' );

                                                    
                                                    bus.publish( 'satorisan', 'history-check-callback' );
                                                    user.IS_IN_TRANSITION = false;
                                                }

                                                sw = false;

                                            });
                                            
                                            $container.addClass("transition-top").css( { 
                                                '-webkit-transform': 'translate3D(0,0,0)',
                                                '-moz-transform': 'translate3D(0,0,0)',
                                                '-o-transform': 'translate3D(0,0,0)',
                                                '-ms-transform': 'translate3D(0,0,0)'
                                             });

                                        },250);
                                }
                                else
                                {

                                    $container.css( { top : $window.height()} ).animate( { top : 0}, { duration:650, complete:function(){                            
                                        
                                        $back.show().animate( { opacity:1}, {duration:250} );
                                        $next.show().animate( { opacity:1}, {duration:250} );
                                        $(".section-wrapper.home").addClass("phrase" + currentIndex);
                                        /*$container.find(".home-container .title").show();
                                        $(".section-wrapper.home .title .title-mask").css({marginTop:50}).animate( { marginTop: 0}, {duration:250} );
                                        $(".section-wrapper.home .body-mask").css({marginTop:-200}).animate( { marginTop: 0}, {duration:250, complete:function(){
                                            $blocker.hide();
                                            $container.find(".see-collection").animate({opacity:1}, {duration:250});

                                            bus.publish( 'satorisan', 'history-check-callback' );
                                            user.IS_IN_TRANSITION = false;

                                        }});*/
                                        $container.find(".home-container .title").show();
                                        $(".section-wrapper.home .title").animate( { opacity:1}, {duration:250, complete:function(){
                                            $blocker.hide();
                                            bus.publish( 'satorisan', 'history-check-callback' );
                                            user.IS_IN_TRANSITION = false;
                                        }});
                                        
                                        timeline = new Timeline( {steps:totalPhotos, onStepCallback:$this.onStepCallback, onEndCallback:$this.onEndCallback, interruptCallback:$this.interruptCallback } );
                                        $this.startPreloadingNext();        
                                        timeline.goto(activeIndex);
                                        bus.publish( 'satorisan', 'history-update' );
                                    } });  
                                }                            
                            }
                            else
                            {

                                CURRENT_FLOOR = 0;
                                $container.find(".title").css( { "display" : "block"} )                            
                                $container.find(".title-container").css( {top:0} );
                                $container.find(".home-container").css( {top:0} );
                                $container.find(".title .big").css( {marginTop:-4} );
                                $blocker.hide();
                                bus.publish( 'satorisan', 'transition-page', { type: "SLIDE_TOP", complete:function(){
                                    $blocker.hide();
                                    timeline = new Timeline( {steps:totalPhotos, onStepCallback:$this.onStepCallback, onEndCallback:$this.onEndCallback, interruptCallback:$this.interruptCallback } );    
                                    $this.startPreloadingNext();     
                                    timeline.goto(activeIndex); 

                                    bus.publish( 'satorisan', 'history-check-callback' );
                                    user.IS_IN_TRANSITION = false;

                                    $back.show().animate( { opacity:1}, {duration:250} );
                                    $next.show().animate( { opacity:1}, {duration:250} );

                                } } );
                            }

                        }} );

                }}); 
            },

            /*-------------------------------*/

            checkMenuCreated:function(){

                if (user.HEADER_AND_FOOTER_CREATED == false)
                {
                    setTimeout(function(){
                    Hydra.module.start("menu", 'menu_instance');   
                    },250);                        
                    Hydra.module.start("footer", 'footer_instance');   
                    user.HEADER_AND_FOOTER_CREATED = true;
                    $body.addClass(PAGE_BODY_SELECTOR);
                    bus.publish( 'satorisan', 'menu-change' );
                }   
            },

            /*-------------------------------*/

            aboutCookies:function(){
                //console.log(bus);
                bus.publish( "satorisan", "show-policies-cookies", {});
            },

            /*-------------------------------*/

            closeCookies:function(){
                $this.closeCookiesBar();
            },

            /*-------------------------------*/

            acceptCookies:function(){
                
                QUESTION_COOKIES_DO = true;
                ACCEPT_COOKIES = true;
                $.cookie("ACCEPT_COOKIES", true, { expires: 180, domain:OPENSHOP_DOMAIN, path:"/" } );
                $this.closeCookiesBar();
            },

            /*-------------------------------*/

            closeCookiesBar:function(){      
                $(".cookies-question").animate( {top:-70}, {duration:350, complete:function(){
                    $(".cookies-question").remove();
                }} )
            },

            /*-------------------------------*/

            startPreloadingNext:function()
            {
                if (!isResume)
                {
                    if (listPreloaders[currentPath])
                    {
                        isPreloading = false;
                    }
                    else
                    {
                        isPreloading = true;
                        $.preload([currentPath], {loaded_all:function(){
                            listPreloaders[ currentPath ] = true;
                            isPreloading = false;
                            if (appendOK)
                            {
                                bus.publish( "satorisan", "preloader-hide", {complete:function(){
                                    $blocker.show();
                                    $this.appendNext(true);    
                                }});
                                
                            }
                        }});
                    }
                }
            },

            /*-------------------------------*/

            checkNextPreloaded:function(){
                if (isResume==false)
                {
                    if (listPreloaders[currentPath])
                    {
                        $this.appendNext(true);
                    }
                    else
                    {
                        if (isInit)
                        {
                            bus.publish( "satorisan", "preloader-show", {mono:true});
                        }
                        else
                        {
                            bus.publish( "satorisan", "preloader-show");
                        }
                    }
                }
            },

            /*-------------------------------*/
            
            gotoPrev:function(e){
                
                e.preventDefault();
                appendOK = false;
                if (currentIndex == 0) 
                {
                    currentIndex = MY_HOME_IMAGES.length-1;
                }
                else
                {
                    currentIndex--;   
                }

                isFromClick = true;

                timeline.stopAnimation(0);

                direction = -1;
                
                $blocker.show();

                
                isStepComplete = true;
                currentPath = MY_HOME_IMAGES[currentIndex].path;
                appendOK = true;
                $this.startPreloadingNext();
                $this.checkNextPreloaded();

                return false;
            },

            /*-------------------------------*/
            
            gotoNext:function(e)
            {

                e.preventDefault();
                appendOK = false;
                if (currentIndex == MY_HOME_IMAGES.length-1) 
                {
                    currentIndex = 0;
                }
                else
                {
                    currentIndex++; 

                }

                timeline.stopAnimation(1);

                isFromClick = true;
                

                direction = 1;

                $blocker.show();
                
                appendOK = true;
                isStepComplete = true;
                currentPath = MY_HOME_IMAGES[currentIndex].path;
                
                $this.startPreloadingNext();
                $this.checkNextPreloaded();

                return false;
            },

            /*-------------------------------*/

            onStepCallback:function(index){
                
                if (listPreloaders[currentPath] && isResume==false)
                {
                    if (index < MY_HOME_IMAGES.length)
                    {
                        direction = 1;
                        currentIndex++;
                        
                        if (currentIndex>=MY_HOME_IMAGES.length)
                        {
                            currentIndex = 0;
                            direction = -1;
                        }

                        direction = 1

                        currentPath = MY_HOME_IMAGES[currentIndex].path;
                    }
                    else
                    {
                        direction = -1;
                        currentIndex=0;
                        currentPath = MY_HOME_IMAGES[currentIndex].path;   
                    }
                    
                    direction = 1

                    $this.appendNext(true);
                }
                else
                {
                    
                    bus.publish("satorisan", "preloader-show", {mono:true});
                    appendOK = true;
                    
                }
                
            },

            /*-------------------------------*/

            appendNext:function()
            {
                $blocker.show();
                isWaitingForAppend = false;
                
                if (isResume == false)
                {
                    isInit = false;
                    appendOK = false;

                    var time = 0;

                    if (isFromClick==false)
                    {

                    //if (activeIndex < currentIndex)
                    //{
                        time = 250;
                        timeline.stopAnimation(1);                    
                    /*}
                    else
                    {
                        timeline.stopAnimation(0);
                    }*/
                    }

                    isFromClick = false;

                    timeout = setTimeout(function()
                    {
                        if (isResume == false)
                        {
                            $this.hideCurrentText(function()
                            {
                                activeIndex = currentIndex;
                                isStepComplete = false;

                                var $lastImageScale = $(".image-scale");
                                var $newImageScale = $("<div class='image-scale'><img src='" + currentPath + "' /></div>");
                                $imagesContainer.append($newImageScale);

                                $this.resize();
                                
                                if (currentIndex < MY_HOME_IMAGES.length-1)
                                currentPath = MY_HOME_IMAGES[currentIndex+1].path;
                                else
                                currentPath = MY_HOME_IMAGES[0].path;

                                $newImageScale.css('left', $window.width() * direction);
                                $newImageScale.find('img').css('left', '-=' + $window.width() * .8 * direction);
                                setTimeout(function()
                                {
                                    $lastImageScale.animate({left: -$window.width() * direction}, {duration:700, specialEasing: {left: 'easeInOutCubic'}});
                                    $lastImageScale.find('img').animate({left: '+=' + $window.width() * .8 * direction}, {duration:700, specialEasing: {left: 'easeInOutCubic'}});
                                    $newImageScale.find('img').animate({left: '+=' + $window.width() * .8 * direction} , {duration:700, specialEasing: {left: 'easeInOutCubic'}});
                                    $newImageScale.animate( {left:0},{duration:700, specialEasing: {left: 'easeInOutCubic'}, complete:function()
                                    {
                                        $lastImageScale.remove();
                                        $newImageScale.unbind(MOUSE_DOWN).unbind(MOUSE_DOWN, function(e){e.preventDefault();return false;});
                                        $this.showCurrentText();
                                    }});
                                },100);

                                /*if (1==2)
                                //if (Modernizr.csstransforms && !$.browser.msie)
                                {
                                    if (direction==1)
                                    {


                                      $(".image-scale:last").css( { 
                                                '-webkit-transform': 'translate3D('+$window.width()+'px,0,0)',
                                                '-moz-transform': 'translate3D('+$window.width()+'px,0,0)',
                                                '-o-transform': 'translate3D('+$window.width()+'px,0,0)',
                                                '-ms-transform': 'translate3D('+$window.width()+'px,0,0)'
                                        } );

                                        

                                        

                                        setTimeout(function(){
                                            
                                            var sw = true;

                                            $(".image-scale:last").one(TRANSITION_END_EVENT, function(){
                                                if (sw == true)
                                                {
                                                    $(".image-scale:first").remove();
                                                    $(".image-scale").removeClass("transition-top");
                                                    $(".image-scale").unbind(MOUSE_DOWN).unbind(MOUSE_DOWN, function(e){e.preventDefault();return false;})
                                                    
                                                    $this.showCurrentText();


                                                }
                                                sw = false;
                                            });

                                            var backgroundPosLast = $(".image-scale:last").css('backgroundPosition').split(" ");
                                            var xPosLast = String(backgroundPosLast[0]).replace("px",""),
                                            yPosLast = String(backgroundPosLast[1]).replace("px","");

                                            var backgroundPosFirst = $(".image-scale:first").css('backgroundPosition').split(" ");
                                            var xPosFirst = String(backgroundPosFirst[0]).replace("px",""),
                                            yPosFirst = String(backgroundPosFirst[1]).replace("px","");

                                            $(".image-scale:last").css ( { 
                                                "background-position" :  (xPosLast + Math.round($(window).width()*0.2) ) + "px " + (yPosLast) + "px"
                                            } );

                                            $(".image-scale:first").css ( { 
                                                "background-position" :  (xPosFirst) + "px " + (yPosFirst) + "px"
                                            } );

                                            $(".image-scale:first").addClass("transition-top").css( { 
                                                '-webkit-transform': 'translate3D(' + (0-($window.width())) + 'px,0,0)',
                                                '-moz-transform': 'translate3D(' + (0-($window.width())) + 'px,0,0)',
                                                '-o-transform': 'translate3D(' + (0-($window.width())) + 'px,0,0)',
                                                '-ms-transform': 'translate3D(' + (0-($window.width())) + 'px,0,0)',
                                                "background-position" :  (xPosFirst+200)  + "px " + (yPosFirst) + "px"
                                            });



                                            $(".image-scale:last").addClass("transition-top").css( { 
                                                '-webkit-transform': 'translate3D(0,0,0)',
                                                '-moz-transform': 'translate3D(0,0,0)',
                                                '-o-transform': 'translate3D(0,0,0)',
                                                '-ms-transform': 'translate3D(0,0,0)',
                                                 "background-position" :  (xPosLast) + "px " + (yPosLast) + "px"
                                            });

                                        },100);
                                    }
                                    else
                                    {
                                        $(".image-scale:last").css( { 
                                                '-webkit-transform': 'translate3D('+(0-$window.width())+'px,0,0)',
                                                '-moz-transform': 'translate3D('+(0-$window.width())+'px,0,0)',
                                                '-o-transform': 'translate3D('+(0-$window.width())+'px,0,0)',
                                                '-ms-transform': 'translate3D('+(0-$window.width())+'px,0,0)'
                                        } );

                                        setTimeout(function(){
                                            var sw = true;
                                            $(".image-scale:last").one(TRANSITION_END_EVENT, function(){
                                                if (sw==true)
                                                {
                                                    $(".image-scale:first").remove();
                                                    $(".image-scale").unbind(MOUSE_DOWN).unbind(MOUSE_DOWN, function(e){e.preventDefault();return false;})
                                                    $this.showCurrentText();
                                                }
                                                sw = false;
                                            });

                                            $(".image-scale:first").addClass("transition-top").css( { 
                                                '-webkit-transform': 'translate3D(' + ($window.width()) + 'px,0,0)',
                                                '-moz-transform': 'translate3D(' + ($window.width()) + 'px,0,0)',
                                                '-o-transform': 'translate3D(' + ($window.width()) + 'px,0,0)',
                                                '-ms-transform': 'translate3D(' + ($window.width()) + 'px,0,0)'
                                            });

                                            $(".image-scale:last").addClass("transition-top").css( { 
                                                '-webkit-transform': 'translate3D(0,0,0)',
                                                '-moz-transform': 'translate3D(0,0,0)',
                                                '-o-transform': 'translate3D(0,0,0)',
                                                '-ms-transform': 'translate3D(0,0,0)',
                                            });

                                        },100);
                                    }
                                }
                                else
                                {
                                }*/

                            });
                        }
                        else
                        {
                            isWaitingForAppend = true;
                        }

                    },time);
                }
                else
                {
                    isWaitingForAppend = true;    
                }
                
            },

            /*-------------------------------*/

            hideCurrentText:function(_callback){
                bus.publish("satorisan", "preloader-hide", {complete:function(){
                    $blocker.show();    
                }});
                
                
                $(".section-wrapper.home .title").animate( { opacity:0 }, {duration:250, complete:_callback} );
                /*$(".section-wrapper.home .body-mask").animate( { marginTop: -140}, {duration:250});
                $(".section-wrapper.home .title-mask").animate( { marginTop: 200}, {duration:250, complete:function(){
                    $(".section-wrapper.home .collection").animate( {width:"0%"}, {duration:250, complete:_callback});
                } });*/
            },

            /*-------------------------------*/

            showCurrentText:function(){
                timeline.goto(activeIndex);

                //$(".section-wrapper.home .collection").animate( {width:"100%"}, {duration:250, complete:function(){

                    $(".section-wrapper.home .title-mask").html(MY_HOME_IMAGES[currentIndex]["title_" + CURRENT_LANGUAGE]);
                    $(".section-wrapper.home .body-mask").html(MY_HOME_IMAGES[currentIndex]["body_" + CURRENT_LANGUAGE]);
                    $(".section-wrapper.home .see-collection").html(MY_HOME_IMAGES[currentIndex].button["text_" + CURRENT_LANGUAGE]).attr("href", MY_HOME_IMAGES[currentIndex].button["link_" + CURRENT_LANGUAGE]).attr("target", MY_HOME_IMAGES[currentIndex].button.target);
                    $(".section-wrapper.home .see-collection").bind('click', function(){ alert(2) } );
                    
                    $(".section-wrapper").removeClass("phrase0");
                    $(".section-wrapper").removeClass("phrase1");
                    $(".section-wrapper").removeClass("phrase2");
                    $(".section-wrapper.home").addClass("phrase" + currentIndex);

                    /*$(".section-wrapper.home .title .title-mask").animate( { marginTop: 0}, {duration:250} );
                    $(".section-wrapper.home .body-mask").animate( { marginTop: 0}, {duration:250});*/

                    $(".section-wrapper.home .title").animate( { opacity:1 }, {duration:250} );

                    setTimeout(function(){
                        $blocker.hide();   
                    }, 350);

                    $this.startPreloadingNext();
                    bus.publish("satorisan", "history-update");
                //}});
            },



            /*-------------------------------*/

            resize: function()
            {
                var visibleAreaHeight = $window.height();
                var visibleAreaWidth = $window.width();

                var windRes = visibleAreaWidth / visibleAreaHeight;
                var imageRes = MY_HOME_IMAGES[activeIndex].width / MY_HOME_IMAGES[activeIndex].height;

                var width;
                var height;

                if (windRes > imageRes)
                {
                    width = visibleAreaWidth;
                    height = (MY_HOME_IMAGES[activeIndex].height * width) / MY_HOME_IMAGES[activeIndex].width;
                }
                else
                {
                    height = visibleAreaHeight;
                    width = (MY_HOME_IMAGES[activeIndex].width * height) / MY_HOME_IMAGES[activeIndex].height;
                }

                if (MY_HOME_IMAGES[activeIndex].resize == false && (width<=MY_HOME_IMAGES[activeIndex].width || height<=MY_HOME_IMAGES[activeIndex].height))
                {
                    width = MY_HOME_IMAGES[activeIndex].width;
                    height = MY_HOME_IMAGES[activeIndex].height;
                }


                var yPosition;
                var xPosition = Math.round(visibleAreaWidth/2 - width/2);

                if (MY_HOME_IMAGES[activeIndex].align == "top")
                {
                    yPosition = 0;
                }

                if (MY_HOME_IMAGES[activeIndex].align == "middle")
                {
                    yPosition = Math.round(visibleAreaHeight/2 - height/2);
                }

                if (MY_HOME_IMAGES[activeIndex].align == "bottom")
                {
                    yPosition = visibleAreaHeight - height;
                }

                if (Modernizr.touch)
                {
                    if (MY_HOME_IMAGES[activeIndex].ipadAlign)
                    {
                        if (MY_HOME_IMAGES[activeIndex].ipadAlign == "top")
                        yPosition = 0;

                        if (MY_HOME_IMAGES[activeIndex].ipadAlign == "middle")
                        yPosition = Math.round(visibleAreaHeight/2 - height/2);
                        
                        if (MY_HOME_IMAGES[activeIndex].ipadAlign == "bottom")
                        yPosition = visibleAreaHeight - height;
                    }
                }

                if (MY_HOME_IMAGES[activeIndex].offsetY)
                {
                    yPosition += MY_HOME_IMAGES[activeIndex].offsetY;
                }

                if (MY_HOME_IMAGES[activeIndex].offsetX)
                {
                    xPosition += MY_HOME_IMAGES[activeIndex].offsetX;
                }

                $(".image-scale:last").css (
                {
                    width: visibleAreaWidth,
                    height: visibleAreaHeight
                } );
                $(".image-scale:last img").css(
                {
                    width: width,
                    height: height,
                    left: 0,
                    top: yPosition
                });
            },

            /*-------------------------------*/
            
            stop:function(){
                if (isActive)
                {    
                    $container.unbind('swipeleft', $this.gotoNext);
                    $container.unbind('swiperight', $this.gotoPrev);

                    isStepComplete=false;
                    isPreloading=false;

                    isActive=false;
                    if (timeline)
                    {
                        timeline.destroy();
                        timeline = null;
                    }

                    //$(".cookies-question").animate({top:-70},{duration:350});

                    $window.unbind("resize", this.resize);
                    DATA_JSON = undefined;
                    $(".image-scale").stop();

                    $container.unbind('swiperight');
                    $container.unbind('swipeleft');

                    $back.unbind(CLICK_EVENT);
                    $next.unbind(CLICK_EVENT);

                }

                $body.removeClass(PAGE_BODY_SELECTOR);

            }
    
        }
    
});


Hydra.module.register( 'page-popup', function( bus ){ 
        
        var PAGE_BODY_SELECTOR = "iframe-popup";
        var $this,$iframes,myUrl="",$overlay,$wrapper,$close,myURL,currentClass,isActive=false;
        return {
            
            /*-------------------------------*/
            /* PAGE POPUP */
            /*-------------------------------*/            

            init: function(){
                $this = this;
                bus.subscribe('satorisan', this);
            },
            
            /*-------------------------------*/

            oEventsCallbacks: {                
                'append-page' : function (data) {  
                    
                    var session_string = "";               
                    
                    
                    $body.removeClass("cart");
                    $body.removeClass("account");

                    if (data.content == "popup")
                    {
                        
                        $body.addClass(data.bodyClass);
                        currentClass = data.bodyClass;
                        bus.publish( 'satorisan', 'menu-change' );
                        
                        var isPopUpOpen=false;
                        bus.publish( 'satorisan', 'pause-page' );
                        ;
                        bus.publish( 'satorisan', 'popup-open', { isCreated:function(value){
                            if(value==1) isPopUpOpen = value;
                        } } );
                        
                        var timeout = 0;

                        if (isPopUpOpen) timeout = 650;                        
                                    
                        
                        setTimeout(function(){
                            if (isActive==false)
                            {
                                myURL = data.url;
                                //console.log(data);
                                if (data.noSessionString)
                                {
                                    $content.append("<div class='popup " + PAGE_BODY_SELECTOR + "' style='display:none;'><div class='container'><div class='iframe-wrapper'><div class='iconos close-iframe' style='display:none;'><span></span></div><iframe src='" + INIT_FOLDER + data.url + "' id='iframe' name='iframe' class='iframe-popup-inside' ></iframe></div></div></div>");
                                }
                                else
                                {
                                    $content.append("<div class='popup " + PAGE_BODY_SELECTOR + "' style='display:none;'><div class='container'><div class='iframe-wrapper'><div class='iconos close-iframe' style='display:none;'><span></span></div><iframe src='" + INIT_FOLDER + data.url+MAGENTO_LANG_URL_VAR+getCodeLocale()+session_string+"' class='iframe-popup-inside' id='iframe' name='iframe' ></iframe></div></div></div>");    
                                }
                                $blocker.show();
                                myUrl = data.url;
                                $(".iframe-popup-inside").css( { opacity:0 } );
                                $this.create();
                                                     
                            }
                            else
                            {

                                $(".iframe-popup-inside").unbind("load").bind("load", function(){
                                    $(".iframe-popup-inside").animate( { opacity:1}, {duration:250});
                                    $(".iframe-popup-inside").unbind("load");
                                    bus.publish( 'satorisan', 'preloader-hide' )
                                    $blocker.hide();
                                });
                                $blocker.show();
                                $(".iframe-popup-inside").animate( { opacity:0}, {duration:250, complete:function(){
                                    bus.publish( 'satorisan', 'preloader-show', {mono:true} )
                                    $(".iframe-popup-inside").attr("src", INIT_FOLDER + data.url+MAGENTO_LANG_URL_VAR+getCodeLocale()+session_string);    
                                }} );
                                
                            }
                            
                            $this.removeMyAccountMenu();
                            if( data.bodyClass == "account"){
                                $this.createMyAccountMenu();
                            }
                        }, timeout);
                        
                        
                    }
                    
                },
                
                'transition-out' : function(data)
                {
                    if (isActive)
                    {
                        bus.publish("satorisan", "menu-change-go", { dataRight:"" });
                        bus.publish( 'satorisan', 'preloader-hide' );
                        $("#nav .cart").removeClass("open");
                        isActive = false;
                        $wrapper.animate( {top:0-$window.height()}, {duration:350, complete:function(){
                        
                            $(".popup."+PAGE_BODY_SELECTOR).remove();
                            $body.removeClass(PAGE_BODY_SELECTOR);
                            $body.removeClass(currentClass);                        
                            $window.unbind("resize", $this.resize);
                            $blocker.hide();
                            bus.publish( 'satorisan', 'resume-page' );
                            data.complete();
                            user.MISCELANEA_WINDOW_OPEN = false;
                        
                     }} );
                    }

                    $body.removeClass(PAGE_BODY_SELECTOR);
                },

                'overlay-show' : function(data)
                {
                    $(".general-background-overlay").css({opacity:0, "display":"block"}).animate( { opacity:1}, {duration:250, complete:function(){
                        if (data) data.complete();
                    }} );  
                },

                'overlay-hide' : function(data)
                {
                    $(".general-background-overlay").animate( { opacity:0}, {duration:250, complete:function(){

                         $(".general-background-overlay").css( { "display" : "none"} );
                         if (data) data.complete();
                    }} );    
                },

                'destroy-page' : function()
                {
                    this.stop();
                },

                'destroy-miscelanea-page' : function(data)
                {
                    if (isActive)
                    {
                        $this.quitPopup(data);
                    }
                },

                'close-popup-button' : function()
                {
                   $close.animate( {"right" : 3}, {duration:150} );   
                },

                'open-popup-button' : function()
                {
                   $close.stop().animate( {"right" : -58}, {duration:150} );   
                },

                'destroy-popup' : function()
                {
                    if (isActive)
                    {
                        $this.quitPopup({keepOverlay:false});
                    }
                },

                'account-hide-menu' : function()
                {
                    $("#account-menu").stop().animate( { opacity : 0}, {duration:550, complete:function(){
                        $(this).hide();
                    }} );
                },

                'account-show-menu' : function()
                {
                    $("#account-menu").show().stop().animate( { opacity : 1}, {duration:0} );
                }

            },

            /*-------------------------------*/
            
            create:function(){
                
                if (user.MISCELANEA_WINDOW_OPEN)
                {                   
                    bus.publish("satorisan", "destroy-miscelanea-page", {keepOverlay:true, complete:function(){
                        $(".popup").show();
                        isActive = true;
                        $body.addClass(PAGE_BODY_SELECTOR + " " + myURL);
                        
                        $iframes = $(".iframe-popup-inside");
                        $wrapper = $(".iframe-wrapper");
                        //$wrapper.hide();
                        $wrapper.css( { top:0-$window.height() } )
                        $close = $wrapper.find(".close-iframe");
                        $close.unbind(CLICK_EVENT, $this.quitPopup).bind(CLICK_EVENT, $this.quitPopup);
                        //$overlay.unbind(CLICK_EVENT, $this.quitPopup).bind(CLICK_EVENT, $this.quitPopup);
                        
                        $this.resize();
                        $window.unbind("resize", $this.resize).bind("resize", $this.resize);
                        $close.css( {"right" : 3, "display":"none"} );
                        
                        if (CURRENT_FLOOR==null)
                        {
                            
                            if (user.HEADER_AND_FOOTER_CREATED == false)
                            {
                                Hydra.module.start("menu", 'menu_instance');
                                Hydra.module.start("footer", 'footer_instance'); 
                                user.HEADER_AND_FOOTER_CREATED = true;
                                
                            }

                            delay = 250;
                        }

                        //$overlay.animate( { "opacity" : 1}, {duration:250, complete:function(){
                               $wrapper.animate( {top:0}, {duration:350, complete:function(){
                                    bus.publish( 'satorisan', 'preloader-show', {mono:true} )
                                    bus.publish( 'satorisan', 'pause-page' );
                                    $blocker.hide();
                                }} );
                        //    }} );

                        /*CURRENT_FLOOR = 2;*/
                        $iframes.load(function(){                    
                            bus.publish( 'satorisan', 'preloader-hide', {complete:function(){
                                $(".iframe-popup-inside").animate( { opacity:1 }, { duration:250, complete:function(){
                                    $close.stop().show().animate( {"right" : -57}, {duration:150} );
                                } } );
                                $blocker.hide();
                            }} );
                        });                
                        user.MISCELANEA_WINDOW_OPEN = true;
                    }});
                }
                else
                {
                    
                    $(".popup").show();
                    isActive = true;
                    $body.addClass(PAGE_BODY_SELECTOR + " " + myURL);
                    //$overlay = $(".overlay-popup");
                    $iframes = $(".iframe-popup-inside");
                    $wrapper = $(".iframe-wrapper");
                    //$wrapper.hide();
                    $wrapper.css( {top:0-$window.height() } )
                    $close = $wrapper.find(".close-iframe");
                    $close.unbind(CLICK_EVENT, $this.quitPopup).bind(CLICK_EVENT, $this.quitPopup);
                    //$overlay.unbind(CLICK_EVENT, $this.quitPopup).bind(CLICK_EVENT, $this.quitPopup);
                    //$overlay.css ({"opacity":0});
                    $this.resize();
                    $window.unbind("resize", $this.resize).bind("resize", $this.resize);
                    $close.css( {"right" : 3, "display":"none"} );
                    
                    if (CURRENT_FLOOR==null)
                    {
                        
                        if (user.HEADER_AND_FOOTER_CREATED == false)
                        {
                            Hydra.module.start("menu", 'menu_instance');
                            Hydra.module.start("footer", 'footer_instance'); 
                            user.HEADER_AND_FOOTER_CREATED = true;
                            if (myURL.indexOf("account")!=-1)
                            {
                                bus.publish("satorisan", "menu-change-go", { dataRight:"account" });    
                            }
                            bus.publish( 'satorisan', 'pause-page' );

                            if (myURL.indexOf("cart")!=-1)
                            {
                                bus.publish("satorisan", "menu-change-go", { dataRight:"cart" });    
                            }
                            
                        }

                        delay = 250;
                    }
                    /*CURRENT_FLOOR = 2;*/
                    $(".general-background-overlay").css({"opacity":"0", "display":"block"}).animate( { "opacity" : 1}, {duration:250, complete:function(){
                           
                           $wrapper.animate( {top:0}, {duration:350, complete:function(){
                                bus.publish( 'satorisan', 'preloader-show', {mono:true} )
                                
                                $blocker.hide();
                            }} );
                    }} );  

                    $iframes.load(function(){           
                        bus.publish( 'satorisan', 'preloader-hide', { complete:function(){
                            $(".iframe-popup-inside").animate( { opacity:1 }, { duration:250, complete:function(){
                                //console.log("POPUP ");
                                $close.stop().show().animate( {"right" : -57}, {duration:150} );    
                                $iframes.unbind("load");
                            } } );
                            $blocker.hide();
                        }} );
                    });

                    user.MISCELANEA_WINDOW_OPEN = true;
                }

                $(".general-background-overlay").unbind(CLICK_EVENT).bind(CLICK_EVENT, function(){$this.quitPopup();});

            },



            /*-------------------------------*/



            createMyAccountMenu:function() {
                
                links_prefix = INIT_FOLDER+user.SHIPPING_REGION;
                links_sufix = MAGENTO_LANG_URL_VAR+getCodeLocale();

                section_title = DICTIONARY[CURRENT_LANGUAGE].account_title;
                section_logout = DICTIONARY[CURRENT_LANGUAGE].account_logout;

                orders_title = DICTIONARY[CURRENT_LANGUAGE].account_orders_title;
                orders_link = links_prefix+"/sales/order/history/"+links_sufix;
                account_title = DICTIONARY[CURRENT_LANGUAGE].account_account_title;
                account_link = links_prefix+"/customer/account/edit/"+links_sufix;
                address_title = DICTIONARY[CURRENT_LANGUAGE].account_address_title;
                address_link = links_prefix+"/customer/address/"+links_sufix;
                tickets_title = DICTIONARY[CURRENT_LANGUAGE].account_tickets_title;
                tickets_link = links_prefix+"/helpdeskultimate/customer/"+links_sufix;

                markup_str =
                "<div id='account-menu-wrapper' > \
                <div id='account-menu' class='block block-account'> \
                    <div style='position:relative'> \
                        <div class='block-title'> \
                            <span class='icon_account'></span>"+section_title+"</div> \
                        <div id='myaccount_logout'> \
                            <span>"+section_logout+"</span> \
                        </div> \
                    </div> \
                    <div class='block-content'> \
                    <ul> \
                        <li class='current menu-link-3'> \
                            <a href='"+orders_link+"' target='iframe' class='normal-link' >"+
                                                                            orders_title+"</a> \
                        </li> \
                        <li class=' menu-link-4'> \
                            <a href='"+account_link+"' target='iframe' class='normal-link' >"+
                                                                            account_title+"</a> \
                        </li> \
                        <li class=' menu-link-5'> \
                            <a href='"+address_link+"' target='iframe' class='normal-link' >"+
                                                                            address_title+"</a> \
                        </li> \
                        <li class=' menu-link-7 last'> \
                            <a href='"+tickets_link+"' target='iframe' class='normal-link' >"+
                                                                            tickets_title+"</a> \
                        </li> \
                    </ul> \
                    </div> \
                </div> \
                </div>";

                $(".popup .iframe-wrapper").prepend(markup_str);

                $("#account-menu .block-content li a").bind( CLICK_EVENT, $this.changeAccountMenu );
                $("#myaccount_logout").bind("click", logout);
            },


            changeAccountMenu:function( e ){
                //console.log($(e.currentTarget).parent());
                $("#account-menu .block-content li").removeClass("current");
                $(e.currentTarget).parent().addClass("current");
            },

            
            /*-------------------------------*/


            removeMyAccountMenu:function(){
                $("#account-menu").remove()
            },


            
            /*-------------------------------*/



            quitPopup:function(data)
            {
                 if (data)
                 {
                     if (data.keepOverlay)
                     {

                     }
                     else
                     {
                        bus.publish("satorisan", "menu-change-go", { dataRight:"" });
                     }
                }
                else
                {
                    bus.publish("satorisan", "menu-change-go", { dataRight:"" });
                }
                 $body.removeClass("cart");
                 $body.removeClass("account");
                 bus.publish( 'satorisan', 'preloader-hide' );
                 $("#nav .cart").removeClass("open");
                 $wrapper.animate( {top:0-$window.height()}, {duration:350, complete:function(){
                    //$overlay.animate( { "opacity" : 0}, {duration:250, complete:function(){
                        $(".popup."+PAGE_BODY_SELECTOR).remove();
                        $body.removeClass(PAGE_BODY_SELECTOR);
                        $window.unbind("resize", $this.resize);
                        $blocker.hide();
                        isActive = false;
                        
                        if ((user.LAST_URL != "") || (String(user.LAST_URL).indexOf("/cart")!=-1) || (String(user.LAST_URL).indexOf("/account")!=-1) )
                        {
                            current_path = user.LAST_URL;
                            PATH_NAME = user.LAST_URL;
                            history.pushState("", 'New Satorisan URL: ' + user.LAST_URL, user.LAST_URL);
                        }
                        else
                        {
                            current_path = "/" + CURRENT_LANGUAGE + "/home";
                            PATH_NAME = "/" + CURRENT_LANGUAGE + "/home";
                            history.pushState("", 'New Satorisan URL: ' + INIT_FOLDER + CURRENT_LANGUAGE + "/home", INIT_FOLDER + CURRENT_LANGUAGE + "/home");    
                            bus.publish( 'satorisan', 'destroy-page' );
                            bus.publish( 'satorisan', 'append-page', { content: "home" } );                    
                        }

                        bus.publish( 'satorisan', 'popup-close' );
                        bus.publish( 'satorisan', 'menu-change' );
                        user.MISCELANEA_WINDOW_OPEN = false;

                        bus.publish( 'satorisan', 'resume-page' );

                        if (data)
                        {
                            if (data.keepOverlay)
                            {
                                if (data.complete)
                                {
                                    data.complete();   
                                }
                            }
                            else
                            {
                                $(".general-background-overlay").animate({"opacity":"0"}, {duration:250, complete:function(){
                                    $(".general-background-overlay").hide();
                                    if (data.complete)
                                    {
                                        data.complete();   
                                    }
                                }})
                            }
                            
                        }
                        else
                        {
                            $(".general-background-overlay").animate({"opacity":"0"}, {duration:250, complete:function(){
                                $(".general-background-overlay").hide();
                            }})
                        }




                    //}});
                 }} );
            },

            /*-------------------------------*/

            resize:function(){
                $iframes.css ( {height:$window.height()-85} );
                var toWidth = $window.width()-75;
                if (toWidth >= 1005)
                {
                    toWidth = 1005;
                }

                if (toWidth <= 1004)
                {
                    toWidth = 876;
                }

                var isiPad = navigator.userAgent.match(/iPad/i) != null;
                if (isiPad == true) {
                    toWidth = 900;
                }

                $wrapper.css ( { width:toWidth, marginLeft:(0-(toWidth/2)) - 1});

                //alert($(".iframe-wrapper").width());
            },

            /*-------------------------------*/

            stop:function(){
                if (isActive)
                {
                    bus.publish( 'satorisan', 'preloader-hide' );
                    $("#nav .cart").removeClass("open");
                    isActive = false;
                    $wrapper.animate( {top:0-$window.height()}, {duration:350, complete:function(){
                    //$overlay.animate( { "opacity" : 0}, {duration:250, complete:function(){
                        $(".popup."+PAGE_BODY_SELECTOR).remove();
                        $body.removeClass(PAGE_BODY_SELECTOR);
                        $window.unbind("resize", $this.resize);
                        $blocker.hide();
                        bus.publish( 'satorisan', 'resume-page' );
                        user.MISCELANEA_WINDOW_OPEN = false;


                    //}});
                 }} );
                }

                $body.removeClass(PAGE_BODY_SELECTOR);
               
            }

        }
    
});


Hydra.module.register( 'page-brand', function( bus ){ 
        
        var $this, menu, $container, isActive=false, currentIndex=0,iScrollObject, timeoutLoading, isImagesLoaded=false, isLoadingTime=false,PAGE_BODY_SELECTOR="brand";

        return {
            
            /*-------------------------------*/
            /* PAGE BRAND */
            /*-------------------------------*/            

            init: function(){
                $this = this;
                bus.subscribe('satorisan', this);
            },

            /*-------------------------------*/

            oEventsCallbacks: {

                'append-page' : function (data) {                    
                    if (isActive==false)
                    {
                        
                        if (data.content == "brand")
                        {
                            bus.publish("satorisan", "ganalytics-track-path");

                            isImagesLoaded=false;
                            isLoadingTime=false;
                            isActive=true;
                            $content.append(
                                "<div class='section-wrapper new-section "+PAGE_BODY_SELECTOR+"' > \
                                    <div class='text-container-wrapper' > \
                                        <div class='text-container-holder'> \
                                            <div class='text-container'> \
                                                <div class='title'>"
                                                    +BRAND.pages[currentIndex].title[CURRENT_LANGUAGE]+ 
                                                "</div> \
                                                <div class='body'>"
                                                    +BRAND.pages[currentIndex].body[CURRENT_LANGUAGE]+ 
                                                "</div> \
                                            </div> \
                                        </div> \
                                    </div> \
                                    <div id='brand-list-wrapper' style='display:none;'> \
                                        <div id='scroller'> \
                                            <ul id='thelist'></ul> \
                                        </div> \
                                    </div> \
                                    <div class='list-gallery'></div> \
                                </div>");
                            $container = $("." + PAGE_BODY_SELECTOR)
                            $this.create();

                        }
                    }
                },
                
                'transition-out' : function(data)
                {
                    if (isActive && data.type == "brand")
                    {
                        $window.unbind('techTimelineUpdate');
                        isActive = false;
                        $blocker.show();
                        $("#filter-quantity-widget").animate( {bottom:-55}, {duration:350, complete:function(){
                            menu.removeMenu();
                            menu = undefined;
                        }} );
                        $container.find(".text-container-holder").animate( { opacity:0 }, 
                                                { duration:350, easing: 'easeOutSine' } );
                        //$(".text-container").animate( { height:0 }, {duration:250} );
                        $(".list-gallery").animate( {opacity:0}, {duration:250} );
                        if (Modernizr.csstransforms)
                        {
                            setTimeout(function(){

                                $container.one(TRANSITION_END_EVENT, function(){
                                    $("#brand-list-wrapper").removeClass("animation");
                                    $body.removeClass(PAGE_BODY_SELECTOR);
                                    if (iScrollObject)
                                    {
                                        iScrollObject.destroy();
                                        iScrollObject = null;
                                    }
                                    data.complete();
                                });
                                $("#brand-list-wrapper li").css ( { "background-attachment" : "scroll" } );
                                $("#brand-list-wrapper").addClass("animation");
                                $("#brand-list-wrapper").css( { top:$window.height()/2, height:0 } );
                            }, 250);
                            
                        }
                        else
                        {
                            $("#brand-list-wrapper").animate( { top:0, height:$window.height()}, {duration:350, complete:function(){
                                $body.removeClass(PAGE_BODY_SELECTOR);
                                if (iScrollObject)
                                {
                                    iScrollObject.destroy();
                                    iScrollObject = null;
                                }
                                data.complete();
                            }} );
                        }
                        

                    }
                },

               

                'destroy-page' : function()
                {
                    if (isActive)
                    {
                        $this.stop();
                        
                    }

                }
            },

            /*-------------------------------*/

            create:function(){

               
                if (CURRENT_FLOOR == null)
                {
                    CURRENT_FLOOR = 1;
                    
                    if (user.HEADER_AND_FOOTER_CREATED == false)
                    {
                        Hydra.module.start("menu", 'menu_instance');
                        Hydra.module.start("footer", 'footer_instance'); 
                        user.HEADER_AND_FOOTER_CREATED = true;
                        bus.publish("satorisan", "menu-change-go", { data:"brand" });
                    }

                    bus.publish( 'satorisan', 'history-update' );
                    $this.startPreloading();
                }
                else
                {
                    if (CURRENT_FLOOR == 0)
                    {
                        bus.publish( 'satorisan', 'transition-page', { type: "SLIDE_BOTTOM", complete:$this.startPreloading } );
                        CURRENT_FLOOR = 1;
                    }
                    else
                    {
                        $this.startPreloading();   
                    }
                }

                $body.addClass(PAGE_BODY_SELECTOR);
                bus.publish( 'satorisan', 'menu-change' );
                
            },

            /*-------------------------------*/

            startPreloading:function()
            {
                $blocker.show();                
                bus.publish( 'satorisan', 'preloader-show', { header:"The Brand", footer:"", complete:function(){
                    timeoutLoading = setTimeout($this.timeoutLoadedComplete, BRAND.preload_time);
                    var filesToLoad = new Array();
                    for (var i=0; i<BRAND.pages.length;i++)
                    {
                        filesToLoad.push( BRAND.pages[i].image_path );
                    }

                    $.preload(filesToLoad, {
                        
                        loaded:function(img, loaded, total)
                        {
                            bus.publish( 'satorisan', 'preloader-update', {rate:30 + ((loaded/total)*80) });    
                        },

                        loaded_all:function(){
                            
                            isImagesLoaded = true;

                            if (isLoadingTime)
                            {
                                bus.publish( 'satorisan', 'preloader-hide', { complete:$this.appendSection});
                            }
                        }
                    });

                } } );
                
            },

            /*-------------------------------*/

            timeoutLoadedComplete:function(){
                
                isLoadingTime = true;

                if (isImagesLoaded)
                {
                    bus.publish( 'satorisan', 'preloader-hide', { complete:$this.appendSection});
                }
            },

            /*-------------------------------*/

            appendSection:function(){

                if (isActive)
                {
                    currentIndex=0;

                    for (var i=0; i<BRAND.pages.length;i++)
                    {
                        $container.find ( "#thelist" ).append("<div class='image-container' data-align='"+BRAND.pages[i].image_align+"' ><img src='" + BRAND.pages[i].image_path + "'/></div>");
                        $container.find ( ".list-gallery" ).append("<div class='list-gallery-nav'></div>");
                    }
                    $("#brand-list-wrapper").css( { "display":"block" });

                    $this.resize();
                    $window.unbind("resize", $this.resize).bind("resize", $this.resize);

                    $("#brand-list-wrapper").css( { top:$window.height()/2, height:"0%"} );
                    
                    if (Modernizr.csstransforms)
                    {
                        var swAnimate = false;
                        setTimeout(function(){

                            $container.one(TRANSITION_END_EVENT, function(){
    
                                if (swAnimate==false)
                                {
                                    swAnimate = true;
             
                                }
                                
                            });

                            $("#brand-list-wrapper").addClass("animation");
                            $("#brand-list-wrapper").css( { top:0, height:$window.height()} );
                        }, 250);
                        
                    }
                    else
                    {
                        $("#brand-list-wrapper").animate( { top:0, height:$window.height()}, 
                                    { duration:350, complete:$this.showText } );
                    }

                    $container.find(".text-container-holder").delay(1500).animate( { opacity:1 }, 
                                    { duration:500, easing: 'easeOutSine', 
                                        complete: function (){ $this.showText();
                                            if (menu)
                                            {
                                                menu.removeMenu();
                                                menu = undefined;
                                            } 
                                            menu = new TechTimeline();
                                            $("#filter-quantity-widget").css( {bottom:-47} );
                                            $("#filter-quantity-widget").animate( {bottom:25}, {duration:350} );
                                            bus.publish( 'satorisan', 'history-check-callback' );
                                            user.IS_IN_TRANSITION = false;

                                            
                    }  } );

                    $window.bind('techTimelineUpdate', function(e)
                    {
                        
                        $(".text-container").animate( { opacity:0 }, { duration:250, complete:function(){
                            var i = e.positionIndex;                        
                            iScrollObject.scrollToPage( i );
                        } } );
                    });
                }
            },

            /*-------------------------------*/

            showText:function(){
                if (isActive)
                {
                    $(".text-container").css( { opacity:0 } ).show().delay(300).animate( {opacity:1}, {duration:250} );
                    //$(".text-container").animate( { height:$(".text-container .title").height() + $(".text-container .body").height()}, {duration:250} );
                    $(".list-gallery .list-gallery-nav").eq(0).addClass("active");
                    $(".list-gallery .list-gallery-nav").unbind(CLICK_EVENT, $this.goToPage).bind(CLICK_EVENT, $this.goToPage)
                    //$(".list-gallery").css( { opacity:0 } ).show().animate( {opacity:1}, {duration:250} );
                }
            },

            /*-------------------------------*/

            goToPage:function(){
                var i = $(".list-gallery .list-gallery-nav").index(this);
                iScrollObject.scrollToPage( i );
                $this.menu.goOption(i);
            },

            /*-------------------------------*/

            changeText:function(index){
                if (isActive)
                {
                    currentIndex = index;
                    $(".text-container").removeClass("s0").removeClass("s1").removeClass("s2").addClass("s"+currentIndex);
                    $(".text-container .title").html(BRAND.pages[currentIndex].title[CURRENT_LANGUAGE]);
                    $(".text-container .body").html(BRAND.pages[currentIndex].body[CURRENT_LANGUAGE]);
                }
            },

            /*-------------------------------*/

            resize: function()
			{
                if (isActive)
                {
					
                    $("#scroller .image-container").each(function(index)
					{
						var $container = $(this);
						var $img = $container.children();
						var img = $img.get(0);
						
						var naturalWidth = img.naturalWidth ? img.naturalWidth : img.width;
						var naturalHeight = img.naturalHeight ? img.naturalHeight : img.height;
						
						var viewportWidth = $window.width();
						var viewportHeight = $window.height();
						
                        $container.css({width: viewportWidth, left: index * viewportWidth});
						
						var imageWidth;
						var imageHeight;

						if (naturalWidth / viewportWidth < naturalHeight / viewportHeight)
						{
                            imageWidth = viewportWidth + 15;
							imageHeight = naturalHeight / naturalWidth * viewportWidth;
						}
						else
						{
							imageHeight = viewportHeight;
							imageWidth = naturalWidth / naturalHeight * viewportHeight;
						}
                     

                        if( $container.attr("data-align") == "top" ){
                            temp_top = 0;
                        }else if( $container.attr("data-align") == "middle" ){
                            temp_top = (viewportHeight - imageHeight) / 2;
                        }
                        

						$img.css(
						{
							width: imageWidth,
							height: imageHeight,
							left: (viewportWidth - imageWidth) / 2,
							top: temp_top
						})
                    });
                    
                    $("#scroller").css( { width:$window.width() * BRAND.pages.length} );

                    if (iScrollObject)
                    {
                        iScrollObject.destroy();
                        iScrollObject = null;
                    }

                    //currentIndex = 0;
					
					var $brandListWrapper = $('#brand-list-wrapper');
					DragCursor.open($brandListWrapper, true);
                    iScrollObject =  new iScroll('brand-list-wrapper',
					{
                        snap: true,
                        momentum: false,
                        hScrollbar:false,
                        vScrollbar:false,
                        onScrollMove: function () {
							DragCursor.closed($brandListWrapper, true);
                            $(".text-container").stop().animate( { opacity:0}, {duration:150} );
                        },
                        onScrollEnd: function () {
							DragCursor.open($brandListWrapper, true);
                            $(".list-gallery .list-gallery-nav").removeClass("active");
                            $(".list-gallery .list-gallery-nav").eq(this.currPageX).addClass("active");
                            $this.changeText(this.currPageX);
                            $(".text-container").stop().animate( { opacity:1}, {duration:150} );
                            if (menu) menu.goOption(this.currPageX);
                        }
                    });

                    iScrollObject.scrollToPage( currentIndex, 0, 0 );

                    $(".text-container").removeClass("s0").removeClass("s1").removeClass("s2").addClass("s"+currentIndex);
                    $(".text-container .title").html(BRAND.pages[currentIndex].title[CURRENT_LANGUAGE]);
                    $(".text-container .body").html(BRAND.pages[currentIndex].body[CURRENT_LANGUAGE]);

                    $("#brand-list-wrapper").css( { height:$window.height()} );                

                    //$(".text-container").css( { top:($window.height()/2) - (($(".text-container .title").height() + $(".text-container .body").height())/2)-80  } )
                }
            },

            /*-------------------------------*/

            stop:function(){
                if (isActive)
                {
                    $window.unbind('techTimelineUpdate');
                    clearTimeout(timeoutLoading);
                    isActive = false;
                    if (iScrollObject)
                    {
                        iScrollObject.destroy();
                        iScrollObject = null;
                    }
                    $window.unbind("resize", $this.resize);
                    
                    $(".type-blog").unbind(CLICK_EVENT, $this.blogClick);

                    $("#live-list-wrapper").unbind(MOUSE_DOWN_EVENT);
                    $("#live-list-wrapper").unbind(MOUSE_UP_EVENT);



                }

                if (menu)
                { 
                    menu.destroy();
                    menu = undefined;
                }
                //console.log(menu);

                $body.removeClass(PAGE_BODY_SELECTOR);
            }

        
        }
    
});


Hydra.module.register( 'page-live', function( bus ){

        var isChrome = window.chrome;
        isChrome = false;

        function removeWhitespace($container)
        {
            var newHTML = $container.html().replace(/>\s+</g, "><");
            $container.html(newHTML);
        }

        function setHand()
        {
            DragCursor.open($liveContainer, true);
        }
        function unsetHand()
        {
            DragCursor.clear($liveContainer);
        }

        var ITEM_DEFINITION =
        '\
            <li data-url="http://www.download.com/">\
                <div class="transformable">\
                    <div class="texts">\
                        <time datetime="2013-04-03">3 April 2013</time>\
                        <h3>Lorem ipsum dolor sit amet</h3>\
                        <div class="description">\
                            <p>Lorem ipsum dolor sit amet</p>\
                        </div>\
                    </div>\
                </div>\
            </li>\
        ';
        
        var $this, isLoaded=false, isActive=false, isAlive=false, PAGE_BODY_SELECTOR = "cms-live", ITEM_TOTAL_WIDTH = 346, POPUP_WIDTH = 1005, NARROW_POPUP_WIDTH = 877, NARROW_POPUP_BREAK = POPUP_WIDTH + (57 + 1 + 5) *2, resizeHandler, $footerBar, $liveContainer, $liveMover, $onStartScreenItems;

        return {

            isMobile: function()
            {
                return
                (
                    navigator.userAgent.match(/Android/i)
                    ||
                    navigator.userAgent.match(/webOS/i)
                    ||
                    navigator.userAgent.match(/iPhone/i)
                    ||
                    navigator.userAgent.match(/iPad/i)
                    ||
                    navigator.userAgent.match(/iPod/i)
                    ||
                    navigator.userAgent.match(/BlackBerry/i)
                    ||
                    navigator.userAgent.match(/Windows Phone/i)
                )
            },
            
            /*-------------------------------*/
            /* PAGE LIVE */
            /*-------------------------------*/            

            init: function(){
                $this = this;
                bus.subscribe('satorisan', this);
            },
            
            /*-------------------------------*/

            urlChangeHandler:function(){  
                
            },

            /*-------------------------------*/

            oEventsCallbacks: {
                'append-page' : function (data) {
                    if (isActive==false)
                    {
                        if (data.content == "live")
                        {
                            isAlive = true;
                            isActive=true;
                            $content.append("<div class='section-wrapper new-section " + PAGE_BODY_SELECTOR + "'></div>");
                            $container = $("." + PAGE_BODY_SELECTOR);
                            bus.publish("satorisan", "ganalytics-track-path");
                            $this.create();
                        }
                    }
                },

                'transition-out' : function(data)
                {
                    if (isActive && data.type=="live")
                    {
                        $body.removeClass(PAGE_BODY_SELECTOR);
                        $footerBar.addClass('hidden');
                        $liveContainer.addClass('hidden');
                        setTimeout(function()
                        {
                            isActive = false;
                            data.complete();
                        }, 500)
                    }
                },

                'destroy-page' : function()
                {
                    $this.stop();
                }
            },

            /*-------------------------------*/

            create:function(){
                if (CURRENT_FLOOR == null)
                {
                    CURRENT_FLOOR = 1;
                    
                    if (user.HEADER_AND_FOOTER_CREATED == false)
                    {
                        Hydra.module.start("menu", 'menu_instance');
                        Hydra.module.start("footer", 'footer_instance'); 
                        user.HEADER_AND_FOOTER_CREATED = true;
                        bus.publish("satorisan", "menu-change-go", { data:"live" });
                    }

                    bus.publish( 'satorisan', 'history-update' );
                    $this.startPreloading();
                }
                else
                {
                    if (CURRENT_FLOOR == 0)
                    {
                        bus.publish( 'satorisan', 'transition-page', { type: "SLIDE_BOTTOM", complete:$this.startPreloading } );
                        CURRENT_FLOOR = 1;
                    }
                    else
                    {
                        $this.startPreloading();   
                    }
                }

                $body.addClass(PAGE_BODY_SELECTOR);
                bus.publish('satorisan', 'menu-change' );
            },

            /*-------------------------------*/

            startPreloading:function()
            {
                if (isAlive)
                {
                    $blocker.show();
                    
                    if (isLoaded==false)
                    {
                        isLoaded = true;
                        bus.publish( 'satorisan', 'preloader-show', { header:"SATORISAN LIVE", footer:"" } );
                        $this.preloadBlog();
                    }
                    else
                    {
                        setTimeout($this.appendPosts, 1000);
                    }
                }
                
            },

            /*-------------------------------*/

            preloadBlog:function()
            {
                if (isAlive)
                {
                   
                    $.ajax({
                        url: WEBSERVICES_PATH["blog"]+"?lg="+CURRENT_LANGUAGE,
                        success: function(data){
                            BLOG_DATA = $.parseJSON(data).posts;
                            bus.publish( 'satorisan', 'preloader-hide', {complete: $this.appendPosts} );
                        }
                    });
                }
            },

            stop:function()
            {
                if (isActive)
                {
                    isActive = false;
                }

                if (resizeHandler) $window.unbind('resize', resizeHandler);
                if ($liveContainer) $liveContainer.iOSScrollSatorisan('destroy');
                $body.removeClass(PAGE_BODY_SELECTOR);
            },


            appendPosts: function()
            {
                $blocker.hide();
                $footerBar = $(
                '\
                    <div class="footer-bar">\
                        <ul class="social-icons">\
                            <!--li class="instagram"><a href="http://www.instagram.com/" target="_blank">Instagram<span class="icon"><span class="over"></span></span></a></li-->\
                            <li class="pinterest"><a href="http://pinterest.com/mrsatorisan/" target="_blank">Pinterest<span class="icon"><span class="over"></span></span></a></li>\
                            <li class="twitter"><a href=" https://twitter.com/Satorisan" target="_blank">Twitter<span class="icon"><span class="over"></span></span></a></li>\
                            <li class="facebook"><a href="https://www.facebook.com/satorisan.en" target="_blank">Facebook<span class="icon"><span class="over"></span></span></a></li>\
                        </ul>\
                    </div>\
                ');
                if (CURRENT_LANGUAGE == 'es')
                {
                    $footerBar.find('.twitter a').attr('href', 'https://twitter.com/Satorisan_ES');
                    $footerBar.find('.facebook a').attr('href', 'https://www.facebook.com/satorisan.es');
                }
                removeWhitespace($footerBar.children('.social-icons'));
                $footerBar.addClass('hidden');
                $container.append($footerBar);

                $container.append(
                '\
                    <div class="satorisan-live-container hidden">\
                        <ul class="satorisan-live-mover closed"></ul>\
                    </div>\
                ');

                var months;
                if (CURRENT_LANGUAGE == 'en')
                {
                    months =
                    [
                        'January',
                        'February',
                        'March',
                        'April',
                        'May',
                        'June',
                        'July',
                        'August',
                        'September',
                        'October',
                        'November',
                        'December'
                    ];
                }
                else
                {
                    months =
                    [
                        'Enero',
                        'Febrero',
                        'Marzo',
                        'Abril',
                        'Mayo',
                        'Junio',
                        'Julio',
                        'Agosto',
                        'Septiembre',
                        'Octubre',
                        'Noviembre',
                        'Diciembre'
                    ];
                }
    
                $liveContainer = $('.satorisan-live-container');
                $liveMover = $liveContainer.find('.satorisan-live-mover');
                for (var i = 0; i < BLOG_DATA.length; i++)
                {
                    var item = BLOG_DATA[i];

                    var $item = $(ITEM_DEFINITION);
                    $item.attr('data-url', item.permalink);

                    var $time = $item.find('time');
                    $time.attr('datetime', item.date.split(' ').join('T'));

                    var dateSplit = item.date.split(' ')[0].split('-');
                    var year = dateSplit[0];
                    var month = Number(dateSplit[1]);
                    month = months[month - 1];
                    var day = dateSplit[2];
                    $time.html(day + ' ' + month + ' ' + year);

                    $item.find('h3').text(item.title);
                    $item.find('.description').html(item.description);
                    $item.find('.description').dotdotdot({watch: true});

                    var $texts = $item.find('.texts');
                    $texts.append('<div class="read-more">' + (CURRENT_LANGUAGE == 'en' ? 'Read more' : 'Ver más') + '</div>');

                    $liveMover.append($item);
                }

                if ($this.isMobile())
                $liveContainer.addClass('mobile');

                if (isChrome)
                $liveContainer.addClass('chrome');

                function updateIsChrome()
                {
                    isChrome = !isChrome;

                    if (isChrome)
                    $liveContainer.addClass('chrome');
                    else
                    $liveContainer.removeClass('chrome');
                }
                if (window.chrome)
                $window.keydown(function(e)
                {
                    if (e.keyCode == 67)
                    updateIsChrome();
                });

                var popupWidth;
                function setPopupWidth()
                {
                    popupWidth = $window.width() < NARROW_POPUP_BREAK ? NARROW_POPUP_WIDTH : POPUP_WIDTH;
                }
                setPopupWidth();

                var $items = $liveMover.children('li');
                var popupOpened = false;
                var launchTimeout;
                var launched;
                var createIframeTimeout;
                var iframeCreated;
                var iframeLoaded;
                var $iframe;
                var $openedItem;
                var openedIndex;
                var $closeButton;
                var openTimeout;
                var $iframePreloader = $('<div id="iframe-preloader" />').css({opacity: 0});;

                var dragging = false;
                $items.each(function(i)
                {
                    if (openTimeout) clearTimeout(openTimeout);
                    var $itemsButThis = $items.not(this);
                    var $item = $(this);
                    function openPopup()
                    {
                        if (popupOpened)
                        {
                            closePopup();
                            openTimeout = setTimeout(function()
                            {
                                openPopup();
                            }, iframeCreated ? 300 : 0);
                        }
                        else
                        {
                            popupOpened = true;
                            launched = false;
                            iframeCreated = false;
                            iframeLoaded = false;
                            $openedItem = $item;
                            openedIndex = i;

                            $popup = $('<div class="popup closed"><div class="close-button hidden"><div class="over"></div></div><div class="transformable"></div></div>')
                            var $transformable = $popup.children('.transformable');
                            $closeButton = $popup.children('.close-button');
                            $closeButton.bind('click', closePopup);
                            $closeButton.bind('touchend', function(e)
                            {
                                e.preventDefault();
                                closePopup();
                            });
                            $closeButton.css('visibility', 'hidden');
                            $item.after($popup);

                            scrollAbstract.scrollToOverflow = iOSScrollAbstract.IGNORE_SCROLL_TO_OVERFLOW;
                            $liveContainer.iOSScrollSatorisan('disable');
                            unsetHand();

                            $liveMover.removeClass('closed');

                            launchTimeout = setTimeout(function() // Wait one frame to let popup get its styles
                            {
                                launchTimeout = setTimeout(function() // Wait another on before changing them
                                {
                                    launched = true;
                                    
                                    if (Modernizr.csstransitions && !isChrome)
                                    {
                                        $item.addClass('opened');
                                        $popup.removeClass('closed');
                                        $popup.css('width', popupWidth);
                                    }
                                    else
                                    {
                                        $item.stop(true).animate({width: 0}, {duration: 500, specialEasing: {width: 'easeInOutCubic'}});
                                        $popup.stop(true).animate({width: popupWidth}, {duration: 500, specialEasing: {width: 'easeInOutCubic'}}).css('overflow', 'visible');;
                                        
                                    }
                                    $liveContainer.iOSScrollSatorisan('scrollTo', Math.round(i * ITEM_TOTAL_WIDTH - ($window.width() - popupWidth) / 2));

                                    createIframeTimeout = setTimeout(function()
                                    {
                                        iframeCreated = true;
                                        $closeButton.css('visibility', '');
                                        $closeButton.removeClass('hidden');
                                        $iframe = $('<iframe style="opacity: 0;" width="' + popupWidth + '" height="' + ($window.height() - 33 /* footer */ - 57 /* social-icons */ - 60 /* header */) + '" scrolling="no" src="' + $item.attr('data-url') + '"></iframe>')
                                        $transformable.append($iframe);
                                        $transformable.append($iframePreloader);
                                        $iframePreloader.stop(true).animate({opacity: .8}, {duration: 250, specialEasing: {opacity: 'easeInOutCubic'}});

                                        $iframe.bind('load', function()
                                        {
                                            iframeLoaded = true;
                                            bus.publish("satorisan", "preloader-hide", { mono: true, delay: 0 });
                                            $iframePreloader.stop(true).animate({opacity: 0}, {duration: 250, specialEasing: {opacity: 'easeInOutCubic'}});
                                            $iframe.stop(true).delay(250).animate({opacity: 1}, {duration: 500, specialEasing: {opacity: 'easeInOutCubic'}});
                                        })
                                    }, 1000);
                                }, 10);
                            }, 10);
                        }
                    }
                    $item.bind('click', function()
                    {
                        if (!dragging)
                        openPopup();
                    });
                    $item.bind('touchstart', function(e)
                    {
                        e.preventDefault();
                    });
                    $item.bind('touchend', function(e)
                    {
                        e.preventDefault();
                        if (!dragging)
                        openPopup();
                    });
                });
                function closePopup()
                {
                    var $closingPopup = $popup;
                    var $closingItem = $openedItem;
                    $liveContainer.iOSScrollSatorisan('enable');
                    setHand();
                    scrollAbstract.scrollToOverflow = iOSScrollAbstract.PREVENT_SCROLL_TO_OVERFLOW;
                    function animateClose()
                    {
                        if (Modernizr.csstransitions && !isChrome)
                        {
                            $closingItem.removeClass('opened');
                            $closingPopup.addClass('closed');
                            $closingPopup.css('width', 0);
                        }
                        else
                        {
                            $closingItem.stop(true).animate({width: ITEM_TOTAL_WIDTH }, {duration: 500, specialEasing: {width: 'easeInOutCubic'}});
                            $closingPopup.stop(true).animate({width: 0}, {duration: 500, specialEasing: {width: 'easeInOutCubic'}});
                        }

                        // Checks if closing popup is same as current before calling scrollTo to avoid overriding the scrollTo called by the new opening
                        if ($closingPopup == $popup)
                        $liveContainer.iOSScrollSatorisan('scrollTo', Math.round(openedIndex * ITEM_TOTAL_WIDTH - ($window.width() - ITEM_TOTAL_WIDTH) / 2));

                        setTimeout(function()
                        {
                            $closingPopup.remove();
                            delete $closingPopup;
                        }, 500);
                    }
                    if (popupOpened)
                    {
                        if (!launched)
                        {
                            clearTimeout(launchTimeout);
                        }
                        else
                        {
                            if (!iframeCreated)
                            {
                                clearTimeout(createIframeTimeout);
                            }
                            else
                            {
                                $liveMover.addClass('closed');
                                var $closingButton = $closeButton;
                                $closeButton.addClass('hidden');

                                if (!iframeLoaded)
                                {
                                    $iframe.unbind('load');
                                    $iframePreloader.stop(true).animate({opacity: 0}, {duration: 250, specialEasing: {opacity: 'easeInOutCubic'}});
                                }

                                $iframe.stop(true).animate({opacity: 0}, {specialEasing: 'easeInOutCubic', duration: 300, complete: function()
                                {
                                    $iframe.attr('src', '');
                                    $closingButton.css('visibility', 'hidden');
                                    animateClose();
                                }})
                            }
                        }
                    }

                    if (!iframeCreated)
                    animateClose();

                    popupOpened = false;
                }

                $liveMover.width(ITEM_TOTAL_WIDTH * $items.length + popupWidth);
                $liveContainer.iOSScrollSatorisan({additionalWidth: -popupWidth});
                var scrollAbstract = $liveContainer.iOSScrollSatorisan('getAbstract');
                scrollAbstract.acceleration = 2;
                scrollAbstract.easing = .15;
                $liveContainer.iOSScrollSatorisan('addListener', 'dragEffective', function()
                {
                    dragging = true;
                });
                $liveContainer.iOSScrollSatorisan('addListener', 'dragStop', function()
                {
                    setTimeout(function()
                    {
                        dragging = false;
                    }, 0)
                });

                function updateDescriptionHeights()
                {
                    $items.each(function()
                    {
                        var $item = $(this);
                        var $title = $item.find('h3');
                        var $description = $item.find('.description');
                        $description.css('max-height', $item.height() - $title.height() - 220);
                    })
                }
                updateDescriptionHeights();

                function _resizeHandler()
                {
                    setPopupWidth();

                    $liveContainer.iOSScrollSatorisan('updateDimensions', ITEM_TOTAL_WIDTH * $items.length, $liveContainer.width());
                    if (popupOpened)
                    {
                        $liveContainer.iOSScrollSatorisan('setTo', Math.round(openedIndex * ITEM_TOTAL_WIDTH - ($window.width() - popupWidth) / 2));
                        if (iframeCreated)
                        {
                            $popup.css('width', popupWidth);
                            $iframe.attr('width', popupWidth);
                            $iframe.attr('height', $window.height() - 33 /* footer */ - 57 /* social-icons */ - 60 /* header */);
                        }
                    }

                    updateDescriptionHeights();
                }
                resizeHandler = _resizeHandler;

                $window.resize(resizeHandler);

                var onStartScreenItemsCount = Math.ceil($window.width() / ITEM_TOTAL_WIDTH);
                $onStartScreenItems = $items.slice(0, onStartScreenItemsCount);
                $onStartScreenItems.css('position', 'relative');
                $onStartScreenItems.css('left', $window.width() + 'px');
                setTimeout($this.launch, 1);
            },

            launch: function()
            {
                $liveContainer.iOSScrollSatorisan('addListener', 'dragStart', function()
                {
                    DragCursor.closed($liveContainer, true);
                });
                $liveContainer.iOSScrollSatorisan('addListener', 'dragStop', function()
                {
                    DragCursor.open($liveContainer, true);
                });

                setHand();

                $footerBar.removeClass('hidden');
                $liveContainer.removeClass('hidden');

                $onStartScreenItems.each(function(i)
                {
                    $(this).delay(550 + i * 50).animate({left: 0}, {duration: 700, specialEasing: {left: 'easeInOutCubic'}});
                });
            }
        }
});


Hydra.module.register( 'page-live-by-the-walk', function( bus )
{ 

    var PAGE_BODY_SELECTOR = "live-by-the-walk",
        isInEnd=false,
        introTimeout,
        isActive=false,
        isAlive=false,
        isResume=false,
        INSTAGRAM_DATA,
        unique = Math.round(Math.random()*1000);

    return {
            
        /*-------------------------------*/
        /* PAGE LIVE BY THE WALK */
        /*-------------------------------*/            

        init: function(){
            $this = this;
            bus.subscribe('satorisan', this);
        },
        

        /*-------------------------------*/

            
        oEventsCallbacks: {
            'append-page' : function (data) {                    

                if (isActive == false)
                {
                    if (data.content == "live-by-the-walk")
                    {                            
                        isActive = true;
                        isAlive = true;
                        bus.publish("satorisan", "ganalytics-track-path");
                        this.create();
                    }
                }

            },
                
            'transition-out' : function(data) {
                
                if (isActive && data.type=="live-by-the-walk")
                {

                    if (introTimeout) clearTimeout(introTimeout);
                    if (timeInterval) clearInterval(timeInterval);

                    $(".grid-wrapper").animate( { opacity:0 }, {duration:1000, specialEasing: {opacity: 'easeInOutCubic'}});
                   
                    $(".section-wrapper.live-by-the-walk > div").animate( { opacity:0 }, { duration:1000, complete:function(){
                        
                        $body.removeClass(PAGE_BODY_SELECTOR);                       
                        setTimeout(function()
                        {
                            isActive = false;
                            data.complete();
                        }, 500);
                    }} );

                }
            },

            'destroy-page' : function(data)
            {
                if (isActive)
                {
                    if (introTimeout) clearTimeout(introTimeout);
                    if (timeInterval) clearInterval(timeInterval);
                    this.stop();
                    data.complete();
                }
            }

        },


        /*-------------------------------*/


        create: function()
        {

            $window.bind("resize", $this.resize);

            var markup = "<div class='section-wrapper new-section " + PAGE_BODY_SELECTOR + "'></div>"
            $content.append(markup);

            var $wrapper = $(".section-wrapper");

            if (CURRENT_FLOOR == null)
            {
                CURRENT_FLOOR = 1;
                    
                if (user.HEADER_AND_FOOTER_CREATED == false)
                {
                    Hydra.module.start("menu", 'menu_instance');
                    Hydra.module.start("footer", 'footer_instance'); 
                    user.HEADER_AND_FOOTER_CREATED = true;
                    bus.publish("satorisan", "menu-change-go", { data:"live-by-the-walk" });
                }

                LiveByTheWalkCreateGrid();
                bus.publish( 'satorisan', 'history-update' );
                    
            }
            else
            {
                if (CURRENT_FLOOR == 0)
                {
                    bus.publish( 'satorisan', 'transition-page', { type: "SLIDE_BOTTOM", complete: LiveByTheWalkCreateGrid } );
                    CURRENT_FLOOR = 1;
                }
                else
                {
                    LiveByTheWalkCreateGrid();
                }
            } 

            $body.addClass(PAGE_BODY_SELECTOR);
            bus.publish( 'satorisan', 'menu-change', { data:"live-by-the-walk" } );

            user.IS_IN_TRANSITION = false;

        },
            

        /*-------------------------------*/


        resize:function(){
               
            // Resize here


        },


        /*-------------------------------*/


        stop:function(){

            if (isActive)               
            {
                $window.unbind("resize", $this.resize);
                isActive = false;

                clearTimeout(introTimeout);
                clearInterval(timeInterval);

            }

            $body.removeClass(PAGE_BODY_SELECTOR);
        },


        /*-------------------------------*/

    }
    
});



/*-------------------------------*/


LiveByTheWalkCreateGrid = function(){  

    var is_loading_next_page = false;
    var all_pages_loaded = false;

    var server_down = false;
    var server_error_message = "Server is temporary down.<br/>Please try again later.";
    if (CURRENT_LANGUAGE=="es")
    {
        server_error_message = "El servidor se encuentra temporalmente fuera de servicio.<br/>Por favor intente nuevamente más tarde.";
    }

    // Init Preloader
    var headerText = "#LIVEBYTHEWALK";
    var footerText = "";

    if (CURRENT_LANGUAGE=="es")
    {
        headerText = "#LIVEBYTHEWALK";
        footerText = "";
        server_error_message
    }
    globalBus.publish( 'satorisan', 'preloader-show', { 
        header:"<div class='preloader-header-campaign'>"+headerText+"</div>", 
        footer:footerText
    });
    $blocker.show();

    // Init Section
    loadInstagramFeed();
    

    /*-------------------------------*/


    function loadInstagramFeed()
    {
        $.ajax({
                    url: WEBSERVICES_PATH["live-by-the-walk"]+"?l="+CURRENT_LANGUAGE,
                    cache: false,
                    success: function(data){
                        if (data.substring(0, 4) != "<div") {
                            INSTAGRAM_DATA = "<div class='error-message' >"+server_error_message+"</div>";
                            server_down = true;
                        }else{
                            INSTAGRAM_DATA = data;
                        }
                        globalBus.publish( 'satorisan', 'preloader-hide', { delay:0, complete: createInstagramGrid } );
                        
                    }
                });
    }


    /*-------------------------------*/


    function createInstagramGrid()
    {
        //console.log(INSTAGRAM_DATA);
        MARKUP_GRID = "<div id='live-by-the-walk' class='grid-wrapper' >";
        MARKUP_GRID +=   "<div class='grid' >";
        MARKUP_GRID +=      "<div class='gutter-sizer' ></div>";
        MARKUP_GRID +=      INSTAGRAM_DATA;
        MARKUP_GRID +=   "</div>";
        MARKUP_GRID +=   "<div class='preloader' ></div>";
        MARKUP_GRID +=   "<div class='error-message' ></div>";
        MARKUP_GRID += "</div>";

        $(".section-wrapper.live-by-the-walk").append( MARKUP_GRID );

        if(server_down == true){
            $("#live-by-the-walk > .preloader").hide();
        }                     

        instanceMasonry()

        $window.bind("resize", instagramGridResize);
        instagramGridResize();

        gridTransition();

        $("#live-by-the-walk .grid .instagram-feed-item").bind("click", function(){
            var win = window.open($(this).attr("data-url"), '_blank');
            //win.focus();
        });

        $("#live-by-the-walk .grid .instagram-feed-item").bind( "mouseenter mouseleave", function() {
            $( this ).toggleClass( "hover" );
            instagramGridResize()
        });

        $("#live-by-the-walk").scroll(function() {
           if( isScrollBottom() ) {
               loadNextPage();
           }
        });

        $("#live-by-the-walk .grid .instagram-item a.policies").bind("click", function(){
            $footer.find(".policies").click();
        });

        


    }

    /*-------------------------------*/

        
    function isScrollBottom() {
        var totalHeight = $("#live-by-the-walk")[0].scrollHeight;
        var scrollPosition = $("#live-by-the-walk").height() + $("#live-by-the-walk").scrollTop();
        //console.log(totalHeight +" == "+ scrollPosition);
        return (totalHeight <= scrollPosition);
    }

    
    /*-------------------------------*/


    function instanceMasonry(){
        // Instance Masonry
        $("#live-by-the-walk .grid").masonry({
            "gutter": ".gutter-sizer",
            itemSelector: '.instagram-item'
        });

    }


    /*-------------------------------*/


    function instagramGridResize(){

        $("#live-by-the-walk").height( $(window).height()-60-33+15 );

        $("#live-by-the-walk .grid").width ( $window.width()-114 );
        $(".instagram-item .holder").height( $(".instagram-item .holder").width() );
        $(".instagram-feed-item .holder-image").width( $(".instagram-item .holder").width() );
        $(".instagram-feed-item .overlay").width( $(".instagram-item .holder").width() );
        $(".instagram-item.stamp-1 .holder-image").width( $(".instagram-item .holder").width() );
        $(".instagram-item .holder-image").height( $(".instagram-item .holder-image").width() );
        $(".instagram-item .overlay").height( $(".instagram-item .holder-image").width() );

        //$(".instagram-item .holder-image .content").css( "top", $(".instagram-item .holder-image").width() );
        $(".instagram-item .holder-image .content").each(function(index){
            $(this).css( "top", $(".instagram-item .holder-image").height() - $(this).height() - 43 );
        });
        instanceMasonry();
    }

    /*-------------------------------*/


    function loadNextPage(){

        if( !is_loading_next_page && !all_pages_loaded ){
            is_loading_next_page = true;
            
            $.ajax({
                    url: WEBSERVICES_PATH["live-by-the-walk"]+"?l="+CURRENT_LANGUAGE+
                                                            "&max_tag_id="+
                                                            $( "#live-by-the-walk .grid > div" ).last().attr("data-next-max-tag-id")+
                                                            "&max_tag_id_2="+
                                                            $( "#live-by-the-walk .grid > div" ).last().attr("data-next-max-tag-id-2"),
                    cache: false,
                    success: function( data ){
                        //$( "#live-by-the-walk .grid" ).append(data);
                        if (data.substring(0, 4) != "<div") {
                            $("#live-by-the-walk > .error-message").html(server_error_message);
                            server_down = true;
                        }else{
                            var $new_items = $(data);
                            $( "#live-by-the-walk .grid" ).append( $new_items ).masonry( 'appended', $new_items );
                            $("#live-by-the-walk .grid .instagram-feed-item").unbind("click").bind("click", function(){
                                var win = window.open($(this).attr("data-url"), '_blank');
                                //win.focus();
                            });
                            $("#live-by-the-walk .grid .instagram-feed-item").unbind("mouseenter mouseleave").bind( "mouseenter mouseleave", function() {
                                $( this ).toggleClass( "hover" );
                                instagramGridResize()
                            });

                            instagramGridResize();
                            is_loading_next_page = false;

                            if( $( "#live-by-the-walk .grid > div" ).last().attr("data-next-max-tag-id") == "" && $( "#live-by-the-walk .grid > div" ).last().attr("data-next-max-tag-id-2") == "" ){
                                all_pages_loaded = true;
                                $("#live-by-the-walk > .preloader").hide();
                            }
                        }

                        if(server_down == true){
                            $("#live-by-the-walk > .preloader").hide();
                        }  
                        
                    }
                });

        }
    }



    /*-------------------------------*/


    function gridTransition()
    {

        $blocker.hide();

        if (Modernizr.csstransforms && !$.browser.msie)
        {
            $(".grid-wrapper").addClass("transition-top").css('top', 60);

            var completeDone = false;
            setTimeout(function ()
            {
                if (!completeDone)
                {
                    $(".grid-wrapper").removeClass("transition-top");
                }
                completeDone = true;
            }
            , 1100);

            $(".section-wrapper.live-by-the-walk > .container").addClass("transition-top").css(
            {
                zIndex: 1,
                top: -Math.round($window.height() * .25)
            });
        }
        else
        {


            if( $.browser.msie && $.browser.version.substring(0, 1) == "9" ){
                temp_top = 60;
            }else{
                temp_top = 0
            }
            
            $(".grid-wrapper").animate(
            { 
                top: temp_top
            },
            {
                duration: 750,
                complete: function()
                {
                    
                }
            });

             $(".section-wrapper.live-by-the-walk > .container").animate( { 
                top: (0-$window.height()*0.25)
             },
             {
                duration:750
             });
        }
    }
    

    /*-------------------------------*/


}




 

Hydra.module.register( 'page-stores', function( bus ){ 
        var currentZoom;
        var $this,
        PAGE_BODY_SELECTOR = "stores",
        $sectionHolder,
        sectionMode,
        $mapHolder,
        $listHolder,
        STORES_DATA, 
        isActive=false,
        $countrySelectionBtn,
        countrySelectionBar,
        countriesNavOpened,
        $citySelectionBtn,
        citySelectionBar,
        citiesNavOpened,
        listModeArray,
        countriesNavIScroll,
        citiesNavIScroll,
        activeCountry,
        activeCity,
        listModeScrollEnabled,
        $searchResults,
        startOffsetX,
        startOffsetY,
        endOffsetX,
        endOffsetY,
        currentAClick,
        touching = false,
        isScripAdded=false,
        isJSONLoaded=false,
        $locationResults,
        $mapControls;

        var map;
        var GMapsMarkerCluster;
        var markers;
        var toolTips;
        var detailBoxes;
        var actualDetailBox;
        
        // CONFIGS
        var map_initial_latitude = 50;
        var map_initial_longitude = -6;
        var map_initial_zoom = 4;
        var markerIcon = "/website/images/stores/store-icon.png";
        var markerIconRollOver = "/website/images/stores/store-icon-over.png";
        var markerClickZoomLevel = 19;
        var markerClusterInitialGridSize = 45;
        var markerClusterZoomedGridSize = 20;
        var markerClusterOptions = {    gridSize: markerClusterInitialGridSize,
                                        averageCenter:true, 
                                        minimumClusterSize:1,
                                        maxZoom:17,
                                        styles:
                                        [{
                                            url:'/website/images/stores/marker-icon.png',
                                            width: 70, height: 70,
                                            anchor: [0, 0],
                                            anchorIcon: [67, 35],
                                            textColor: '#FFFFFF',
                                            textSize: 12
                                        }]
                                    };
        var city_zoom_level = 11;
        var country_zoom_level = 6;
        var init_bounds_correction = 5;

        return {
            
            /*-------------------------------*/
            /* PAGE STORES */
            /*-------------------------------*/            

            init: function(){
                $this = this;
                bus.subscribe('satorisan', this);
            },
            
            /*-------------------------------*/

            oEventsCallbacks: {
                'append-page' : function (data) {                    
                    if (isActive==false)
                    {
                        if (data.content=="stores")
                        {
                            $content.append("<div class='section-wrapper new-section " + PAGE_BODY_SELECTOR + "'>" + TEMPLATE_STORES + "</div>");
                            bus.publish("satorisan", "ganalytics-track-path");
                            this.create();
                        }
                    }
                },

                'transition-out' : function(data)
                {
                    if (data.type=="stores")
                    {
                        $body.removeClass(PAGE_BODY_SELECTOR);
                        
                        // Remove Listeners
                        $this.removeListners();

                        // Animate OUT
                        $this.animateSectionOut(data);
                        
                    }
                },
                
                'destroy-page' : function(data)
                {
                    if (isActive)
                    {
                        this.stop();
                        data.complete();
                    }
                }
            },

            /*-------------------------------*/

            removeListners:function(){
                $window.unbind("resize", $this.resize);
                $countrySelectionBtn.unbind( CLICK_EVENT, $this.toggleCountriesNav );
                $citySelectionBtn.unbind( CLICK_EVENT, $this.toggleCitiesNav );
                $("#nav .my-location-selection .btn").unbind( MOUSE_ENTER, $this.mainBtnRollOver );
                $("#nav .my-location-selection .btn").unbind( MOUSE_LEAVE, $this.mainBtnRollOut );
                $("#nav .my-location-selection .btn").unbind( CLICK_EVENT, $this.userLocation );

                $("#nav .switch-view-selection .btn").unbind( CLICK_EVENT, $this.sectionModeToggle );
                $("#nav .switch-view-selection .btn").unbind( MOUSE_ENTER, $this.mainBtnRollOver );
                $("#nav .switch-view-selection .btn").unbind( MOUSE_LEAVE, $this.mainBtnRollOut );

                $("#nav .countries-bar .next").unbind( CLICK_EVENT, $this.countriesNavPrevNext );
                $("#nav .countries-bar .prev").unbind( CLICK_EVENT, $this.countriesNavPrevNext );
                $("#nav .cities-bar .next").unbind( CLICK_EVENT, $this.citiesNavPrevNext );
                $("#nav .cities-bar .prev").unbind( CLICK_EVENT, $this.citiesNavPrevNext );

                for( var i=0; i<STORES_DATA.countries.length; i++){
                    $("#country-btn-"+i).unbind(CLICK_EVENT, $this.changeCountry );
                }

                for( var i=0; i<STORES_DATA.cities.length; i++){
                    $("#city-btn-"+i).bind( CLICK_EVENT, $this.changeCity );
                }

                $("#list-view-wrapper div.city .stores .link a").unbind( CLICK_EVENT, $this.listBTnViewOnMap );
                $("#list-view-wrapper").unbind( CLICK_EVENT, $this.closeSubNavigations );

            },

            /*-------------------------------*/

            create:function(){
                
                if (CURRENT_FLOOR == null)
                {
                    CURRENT_FLOOR = 1;
                    if (user.HEADER_AND_FOOTER_CREATED == false)
                    {
                        Hydra.module.start("menu", 'menu_instance');
                        Hydra.module.start("footer", 'footer_instance'); 
                        user.HEADER_AND_FOOTER_CREATED = true;
                        bus.publish("satorisan", "menu-change-go", { data:"stores" });
                    }
                    bus.publish( 'satorisan', 'history-update' );
                    $this.preloadContent();   
                }
                else
                {
                    if (CURRENT_FLOOR == 0)
                    {
                        
                        bus.publish( 'satorisan', 'transition-page', { type: "SLIDE_BOTTOM", complete:$this.preloadContent } );
                        CURRENT_FLOOR = 1;
                    }
                    else
                    {
                        $this.preloadContent();   
                    }
                }

                $body.addClass(PAGE_BODY_SELECTOR);

            },

            /*-------------------------------*/

            preloadContent:function(){
                
                $blocker.show();
                if (CURRENT_LANGUAGE=="en")
                {
                    bus.publish( 'satorisan', 'preloader-show', { header:"Find a Store", footer:"" } );
                }
                else
                {
                    bus.publish( 'satorisan', 'preloader-show', { header:"Tiendas", footer:"" } );
                }
               
                if (isScripAdded==false)
                {
                    $.getScript('https://www.google.com/jsapi', function()
                    {
                        google.load('maps', '3', { other_params: 'sensor=false', callback: function()
                        {
                            $.getScript('/website/js/library/infobox_packed.js', function(){
                                isScripAdded = true;
                                if (isJSONLoaded==false)
                                {
                                    $.ajax({
                                      cache: true,
                                      url: WEBSERVICES_PATH["stores"]+"?lg="+getCodeLocale(),
                                      contentType: "application/x-www-form-urlencoded;charset=UTF-8",
                                      success: function(data_json) {
                                            STORES_DATA = $.parseJSON(data_json).data;
                                            isJSONLoaded = true;
                                            $this.preloadedComplete();
                                      }
                                    });
                                }
                            });
                        }});
                    });
                }
                else
                {
                    if (isJSONLoaded==false)
                    {
                        $.ajax({
                          cache: true,
                          url: WEBSERVICES_PATH["stores"]+"?lg="+getCodeLocale(),
                          contentType: "application/x-www-form-urlencoded;charset=UTF-8",
                          success: function(data_json) {
                                STORES_DATA = $.parseJSON(data_json).data;
                                isJSONLoaded = true;
                                $this.preloadedComplete();
                          }
                        });
                    }
                    else
                    {
                         $this.preloadedComplete();
                    }
                }

               

                
                
            },

            /*-------------------------------*/

            preloadedComplete:function(){
                
                $this.initSection();
            },



            /*-------------------------------*/
/*
            GetURLParameter:function(sParam){
                    var sPageURL = window.location.search.substring(1);
                    var sURLVariables = sPageURL.split('&');
                    for (var i = 0; i < sURLVariables.length; i++)
                    {
                        var sParameterName = sURLVariables[i].split('=');
                        if (sParameterName[0] == sParam)
                        {
                            return sParameterName[1];
                        }
                    }
            }​,
*/

            GetURLParameter:function(sParam){
                var sPageURL = window.location.search.substring(1);
                    var sURLVariables = sPageURL.split('&');
                    for (var i = 0; i < sURLVariables.length; i++)
                    {
                        var sParameterName = sURLVariables[i].split('=');
                        if (sParameterName[0] == sParam)
                        {
                            return sParameterName[1];
                        }
                    }
            },



            initSection:function(){
                // 
                markers = [];
                toolTips = [];
                detailBoxes = [];
                activeCountry = undefined;
                activeCity = undefined;
                sectionMode = "map";
                countriesNavOpened = false;
                citiesNavOpened = false;
                listModeScrollEnabled = false;

                // selectors
                $sectionHolder = $("#stores-wrapper");
                $countrySelectionBar = $("#nav .countries-bar");
                $countrySelectionBtn = $(".main-bar .country-selection");
                $citySelectionBar = $("#nav .cities-bar");
                $citySelectionBtn = $(".main-bar .city-selection");
                $mapHolder = $("#map-container");
                $listHolder = $("#list-view-wrapper");
                $searchResults = $("#search-results");
                $locationResults = $("#location-results");


                // -----------
                
                //sat = $this.GetURLParameter("saturation");
                //if( sat == undefined ){ sat = -10 }
                //light = $this.GetURLParameter("lightness");
                //if( light == undefined ){ light = -20 }
                // -----------

                // Init MAP
                map = new google.maps.Map(document.getElementById('map'), {
                    zoom: map_initial_zoom,
                    maxZoom:21,
                    disableDefaultUI: true,
                    center: new google.maps.LatLng( map_initial_latitude, map_initial_longitude ),
                    mapTypeId: google.maps.MapTypeId.ROADMAP, // ROADMAP, TERRAIN, SATELLITE, HYBRID
                    streetViewControl: false,
                    styles: [{
                                featureType: "all",
                                stylers: [
                                    { saturation: -50 },
                                    { lightness: 0 }
                                ]
                            }]
                });

                $mapControls = $(
                '\
                    <div id="map-controls">\
                        <a href="#" class="zoom-button in"><div class="icon"><div class="over"></div></div></a>\
                        <div class="bar-container">\
                            <div class="bar">\
                                <div class="highlighted"></div>\
                            </div>\
                        </div>\
                        <a href="#" class="zoom-button out"><div class="icon"><div class="over"></div></div></a>\
                    </div>\
                ');
                $('#map').before($mapControls);
                $mapControls.css('opacity', 0);

                $mapControls.find(".bar").bind(CLICK_EVENT, $this.clickZoomMapBar);


                var $zoomIn = $mapControls.find('.zoom-button.in');
                var $zoomOut = $mapControls.find('.zoom-button.out');
                var $highlighted = $mapControls.find('.highlighted');

                
                google.maps.event.addListener(map, 'zoom_changed', function() {
                    currentZoom = map.getZoom();
                    $highlighted.css('height', (currentZoom + 1) / 22 * 100 + '%');
                });

                $zoomIn.click(function(e)
                {
                    e.preventDefault();
                    if (currentZoom < 21)
                    map.setZoom(currentZoom + 1);
                });

                $zoomOut.click(function(e)
                {
                    e.preventDefault();
                    if (currentZoom > 0)                    
                    map.setZoom(currentZoom - 1);
                });

                
                $this.setMapInitialPositon();
                google.maps.event.addListener( map, 'zoom_changed', $this.GMapsZoomUpdate );
                google.maps.event.addListener( map, 'click', $this.closeSubNavigations );
                $("#location-results-wrapper").bind( CLICK_EVENT, $this.closeSubNavigations );
                             

                // Display Markers on Map
                $this.initMarkers();

                // Nav
                $this.createNav();

                // List View
                $this.initListView();

                // resize
                $window.unbind("resize", $this.resize).bind("resize", $this.resize);
                $this.resize();

                // Fire IN animation on Map loaded 
                google.maps.event.addListener( map, 'tilesloaded', $this.mapLoaded );   

                // ipad input fix
                $('body.ipad input').focus( function(){ ipadInputFix(0, 374); } );
                $('body.ipad input').focusout(ipadInputFix);
                $('body.ipad input').keydown( function(){ ipadInputFix(0, 374); } );

                if (Modernizr.touch)
                {
                    
                    $("#list-view-wrapper a").bind("touchstart", $this.touchstartHandler);
                }

            },



            touchstartHandler:function(e)
            {
                if (!touching)
                {
                    e.preventDefault();
                    currentAClick = $("#list-view-wrapper a").index($(this));    
                    startOffsetX = endOffsetX = e.originalEvent.touches[0].clientX;
                    startOffsetY = endOffsetY = e.originalEvent.touches[0].clientY;
                    $document.bind('touchmove', $this.touchmoveHandler);
                    $document.bind('touchend', $this.touchendHandler);
                    touching = true;
                }
            },
                    
                    
            touchmoveHandler:function (e)
            {
                e.preventDefault();
                endOffsetX = e.originalEvent.touches[0].clientX;
                endOffsetY = e.originalEvent.touches[0].clientY;
            },

            touchendHandler:function (e)
            {

                if (e.originalEvent.touches.length == 0)
                {                    
                    
                    $document.unbind('touchmove', $this.touchmoveHandler);
                    $document.unbind('touchend', $this.touchendHandler);
                    touching = false;
                    
                    if (Math.abs(startOffsetX - endOffsetX) < 5 && Math.abs(startOffsetY - endOffsetY) < 5)
                    {
                        
                        $this.listBTnViewOnMapAction( $("#list-view-wrapper a").eq(currentAClick).attr("store_id") );

                        $document.unbind('touchmove', $this.touchmoveHandler);
                        $document.unbind('touchend', $this.touchendHandler);
                       
                    }

                }
                 
            },


            clickZoomMapBar:function(e)
            {
                var y = e.pageY-146;
                var percent =  (100-(y*100)/$mapControls.find(".bar").height())/100;

                $mapControls.find(".highlighted").animate( { height:percent*$mapControls.find(".bar").height() }, { duration:250 } );
                currentZoom = Math.round((percent )*20);
              
                map.setZoom(currentZoom);
            },


            /*-------------------------------*/




            mapLoaded:function(){
                bus.publish("satorisan", "preloader-hide", { 
                                    complete: $this.animateSectionIn })
                bus.publish( 'satorisan', 'menu-change' );
            },



            /*-------------------------------*/



            animateSectionIn:function(){
                $("#map").delay(250).animate( { opacity:1 }, 
                                            { duration:800, easing:"easeOutSine", complete:function(){
                                                bus.publish( 'satorisan', 'history-check-callback' );
                                                user.IS_IN_TRANSITION = false;
                                            } } );

                $mapControls.stop(true).delay(1050).animate( { opacity:1 }, { duration:800, easing:"easeInOutCubic"});
                $("#stores-wrapper #nav").delay(200).animate( 
                                            { bottom:"28px"}, { duration:250 } );
            },



            /*-------------------------------*/



            animateSectionOut:function( data ){
                $this.closeSubNavigations();
                $("#stores-wrapper #nav").animate( { bottom:"-38px"}, { duration:250 } );
                
                if (sectionMode=="list")
                {
                    $("#list-view-wrapper").animate( 
                                        { opacity:0 }, { duration:800, complete:function(){
                                            $("#map").html("");
                                            data.complete();  
                                        } } );
                }
                
                if (sectionMode=="map")
                {

                    $("#map").delay(250).animate( 
                                    { opacity:0 }, { duration:800, 
                                                            complete: function(){
                                                                        $("#map").html("");
                                                                        data.complete();   
                                                            } } );
                }

                $mapControls.stop(true).animate( { opacity:0 }, { duration:800})
            },
                        


            /*-------------------------------*/



            initMarkers:function(){
                
                for ( var i = 0; i < STORES_DATA.markers.length; i++ ) {
                    
                    // Create Marker
                    var marker = new google.maps.Marker({
                      position: new google.maps.LatLng( STORES_DATA.markers[i].lat, STORES_DATA.markers[i].lon ),
                      icon: new google.maps.MarkerImage(markerIcon)
                    });
                    id = STORES_DATA.markers[i].id;
                    marker.set("id", id)
                    markers.push(marker);
                    
                    // Create Tooltip
                    var toolTipText = document.createElement("div");
                    toolTipText.className= "GMapTooltip";
                    toolTipText.innerHTML = "<h3>"+STORES_DATA.markers[i].title+"</h3><p>"+STORES_DATA.markers[i].dir+"<br/>"+STORES_DATA.markers[i].tel+"</p>";
                    
                    var toolTipArrow  = document.createElement("div");
                    toolTipArrow.className= "GMapTooltipArrow";
                    
                    var toolTipHolder = document.createElement("div");
                    
                    toolTipHolder.appendChild(toolTipText);
                    toolTipHolder.appendChild(toolTipArrow);
                    
                    var toolTipOptions = {
                            content: toolTipHolder,
                            closeBoxURL: "",
                            alignBottom:true,
                            pixelOffset: new google.maps.Size(-104, -70)
                    };
                    toolTips[marker.id] = new InfoBox(toolTipOptions);
                    
                    // Create Detail Box
                    detailBoxText = document.createElement("div");
                    detailBoxText.className = "GMapDetailBoxHolder";

                    if( STORES_DATA.markers[i].tel != "" ){ 
                        STORES_DATA.markers[i].tel = "Tel: " + STORES_DATA.markers[i].tel + "<br/>"; 
                    }

                    linkMap = "http://maps.google.com/maps?daddr="+encodeURI(STORES_DATA.markers[i].dir+", "+STORES_DATA.markers[i].city+" "+STORES_DATA.markers[i].code+", "+STORES_DATA.markers[i].state+", "+STORES_DATA.markers[i].country);

                    detailBoxText.innerHTML = "<div class='GMapDetailBox' >"+
                                                "<h3>"+STORES_DATA.markers[i].city+"</h3>"+
                                                "<div><span class='store-title' >"+STORES_DATA.markers[i].title+"</span><br/>"+STORES_DATA.markers[i].dir+"<br/>"+STORES_DATA.markers[i].tel+STORES_DATA.markers[i].code+" "+STORES_DATA.markers[i].city+"<br/>"+STORES_DATA.markers[i].state+", <span style='text-transform:uppercase;' >"+STORES_DATA.markers[i].country+"</span></div>"+
                                                "<div class='get-directions-btn' ><a link='http://maps.google.com/maps?daddr="+encodeURI(STORES_DATA.markers[i].dir+", "+STORES_DATA.markers[i].city+" "+STORES_DATA.markers[i].code+", "+STORES_DATA.markers[i].state+", "+STORES_DATA.markers[i].country)+"' onClick='window.open(\""+linkMap+"\", \"_blank\");' >"+DICTIONARY[CURRENT_LANGUAGE].get_directions+"</a></div>"
                                                +"</div>"
                                                ;
                    


                    var detailBoxOptions = {
                            content: detailBoxText,
                            closeBoxURL: "",
                            alignBottom:false,
                            pixelOffset: new google.maps.Size(-420, -240)
                    };
                    detailBoxes[marker.id] = new InfoBox(detailBoxOptions);
                    
                    // marker events      
                    google.maps.event.addListener(markers[i], "mouseover", function (e) {
                        this.setIcon(markerIconRollOver);
                        toolTips[this.id].open(map, this);
                    });
                    google.maps.event.addListener(markers[i], "mouseout", function (e) {
                        this.setIcon(markerIcon);
                        toolTips[this.id].close(map, this);
                    });
                    google.maps.event.addListener(markers[i], "click", function (e) {
                        $this.openStoreDetailBox(this);
                    });

                   
                       
                }

                GMapsMarkerCluster = new MarkerClusterer(map, markers, markerClusterOptions );


            },

           
            /*-------------------------------*/



            GMapsClearDetailBoxes:function(){
                if(actualDetailBox != undefined){
                    detailBoxes[actualDetailBox.id].close(map, this);
                }
            },



            /*-------------------------------*/



              
            GMapsChangeLatlong:function( lat, long, zoom ){
                map.panTo( new google.maps.LatLng( lat, long ) );
                map.setZoom( zoom );
            },



            /*-------------------------------*/


              
            GMapsZoomUpdate:function(){
                    
                GMapsActualZoom = map.getZoom();
                //alert(GMapsActualZoom)
                if( GMapsActualZoom != markerClickZoomLevel ){
                    $this.GMapsClearDetailBoxes();
                }
                    
                if( GMapsActualZoom >= 11 ){
                    GMapsMarkerCluster.setMinimumClusterSize(2)
                    GMapsMarkerCluster.setGridSize(markerClusterZoomedGridSize)
                }else{
                    GMapsMarkerCluster.setMinimumClusterSize(1)
                    GMapsMarkerCluster.setGridSize(markerClusterInitialGridSize)
                }

                if( GMapsActualZoom <= 10 ){
                    // clear city selection
                    if( $("#nav .city-selection").hasClass("selected") ){
                        $this.resetCitySelectionBtn();
                    }
                }

                if( GMapsActualZoom <= 4 ){
                    // clear country selection
                    if( $("#nav .country-selection").hasClass("selected") ){
                        $this.resetCountrySelectionBtn();
                    }
                }

            },



            /*-------------------------------*/


            createNav:function(){
                // texts
                $("#nav .country-selection .title").html(DICTIONARY[CURRENT_LANGUAGE].select_country);
                $("#nav .city-selection .title").html(DICTIONARY[CURRENT_LANGUAGE].select_city);
                $("#nav .my-location-selection .title").html(DICTIONARY[CURRENT_LANGUAGE].your_location);
                $("#location-results h2").html(DICTIONARY[CURRENT_LANGUAGE].your_location);
                $("#location-results .results").html(DICTIONARY[CURRENT_LANGUAGE].your_location_no_results);
                $("#nav .switch-view-selection .list-view .title").html(DICTIONARY[CURRENT_LANGUAGE].list_view);
                $("#nav .switch-view-selection .map-view .title").html(DICTIONARY[CURRENT_LANGUAGE].map_view);
                //$("#nav .search-selection .search-field").attr("value",DICTIONARY[CURRENT_LANGUAGE].search_location);
                $("#nav .search-selection .search-field").attr("placeholder",DICTIONARY[CURRENT_LANGUAGE].search_location);
                $("#search-results h2 .text").html(DICTIONARY[CURRENT_LANGUAGE].search_results);

                // Init search
                $this.initSearch();
                
                // Countries & Cities list
                $this.createCountriesList();
                $this.createCitiesList();

                // Your location
                //$locationResults.find(".close").bind( CLICK_EVENT, $this.hideLocationResults );

                // BTNs
                $countrySelectionBtn.bind( CLICK_EVENT, $this.toggleCountriesNav );
                $citySelectionBtn.bind( CLICK_EVENT, $this.toggleCitiesNav );
                $("#nav .my-location-selection .btn").bind( MOUSE_ENTER, $this.mainBtnRollOver );
                $("#nav .my-location-selection .btn").bind( MOUSE_LEAVE, $this.mainBtnRollOut );
                $("#nav .my-location-selection .btn").bind( CLICK_EVENT, $this.userLocation );

                $("#nav .switch-view-selection .btn").bind( CLICK_EVENT, $this.sectionModeToggle );
                $("#nav .switch-view-selection .btn").bind( MOUSE_ENTER, $this.mainBtnRollOver );
                $("#nav .switch-view-selection .btn").bind( MOUSE_LEAVE, $this.mainBtnRollOut );

                $("#nav .countries-bar .next").bind( CLICK_EVENT, $this.countriesNavPrevNext );
                $("#nav .countries-bar .prev").bind( CLICK_EVENT, $this.countriesNavPrevNext );
                $("#nav .cities-bar .next").bind( CLICK_EVENT, $this.citiesNavPrevNext );
                $("#nav .cities-bar .prev").bind( CLICK_EVENT, $this.citiesNavPrevNext );


                                
            },



            /*-------------------------------*/



            sectionModeToggle:function(e){

                $this.hideSearchResults();
                $this.hideLocationResults();
               // $("#nav .switch-view-selection .btn .title").css("visibility", "hidden");
                $("#nav .switch-view-selection .btn .title").hide();
                $this.closeSubNavigations();

                if(e != undefined){
                    $this.mainBtnRollOut(e);   
                }
                
                var BAR_HEIGHT = 86;

                if( sectionMode == "map" ){

                    // Switch to LIST view


                    if (Modernizr.csstransforms ){
                        $mapHolder.removeClass("transition-top").css(
                                { 'transform':'translateY(0)', 'top': '0'});
                        $listHolder.removeClass("transition-top").css(
                                { 'transform':'translateY('+($window.height()-BAR_HEIGHT)+'px)', 'top':'0' });
                        setTimeout(function(){
                            $mapHolder.addClass("transition-top").css({'transform':'translateY(-100%)'});
                            $listHolder.addClass("transition-top").css({'transform':'translateY(0)'});
                        },50);    
                    }else{
                        $mapHolder.animate({ top:"-100%"}, {duration:800} );
                        $listHolder.animate({ top:"0"}, {duration:800} );
                    }

                    $("#nav .main-bar").css("overflow","hidden");
                    $("#nav .list-view.btn").animate( 
                                        { marginTop:"-59px"}, {duration:800, easing:"easeOutSine"} );
                    $("#nav .map-view.btn").animate( 
                                        { marginTop:"0"}, {duration:800, easing:"easeOutSine",
                                                complete:function() {
                                                    //$("#nav .list-view.btn").css("visibility", "hidden");
                                                    $("#nav .list-view.btn").hide();
                                                    setTimeout(function(){
                                                        $("#nav .main-bar").delay(5000).css("overflow","");
                                                    },100);
                                        }} );
                    sectionMode = "list";
                    
                }else if(sectionMode == "list"){

                    // Switch to MAP view
                    $btnTitle.css( "top",0 );


                    if (Modernizr.csstransforms )
                    {
                        $mapHolder.removeClass("transition-top").css(
                                { 'transform':'translate3D('+($window.height()-BAR_HEIGHT)+')' });
                        $listHolder.removeClass("transition-top").css(
                                { 'transform':'translateY(0)' });
                        setTimeout(function(){
                            $mapHolder.addClass("transition-top").css({'transform':'translateY(0)'});
                            $listHolder.addClass("transition-top").css({'transform':'translateY('+($window.height()-BAR_HEIGHT)+'px)'});
                        },50);
                    }else{
                        $mapHolder.animate({ top:"0"}, {duration:800} );
                        $listHolder.animate({ top:"100%"}, {duration:800} );  
                    }
                    
                    $("#nav .main-bar").css("overflow","hidden");
                    //$("#nav .list-view.btn").css("visibility", "");
                    $("#nav .list-view.btn").show();
                    $("#nav .switch-view-selection .list-view.btn").animate( 
                                        { marginTop:""}, {duration:1000, easing:"easeOutSine"} );
                    $("#nav .switch-view-selection .map-view.btn").animate( 
                                        { marginTop:"59px"}, {duration:1000, easing:"easeOutSine",
                                                complete:function() {
                                                    $("#nav .main-bar").css("overflow","");
                                        }} );
                    
                    sectionMode = "map";
                
                }

            },



            /*-------------------------------*/



            toggleCountriesNav:function( force_action ){

                if( force_action == "close" ){
                     countriesNavOpened = true;
                }else if( force_action == "open" ){
                    countriesNavOpened = false;
                }

                if( countriesNavOpened ){
                    $countrySelectionBar.animate({ marginTop:"0px"}, {duration:250} );
                    $countrySelectionBtn.removeClass("active");
                    countriesNavOpened = false;

                }else{
                    $countrySelectionBar.animate({ marginTop:"-74px"}, {duration:250} );
                    $countrySelectionBtn.addClass("active");
                    countriesNavOpened = true;
                    $this.toggleCitiesNav("close");
                }
            },



            /*-------------------------------*/



            toggleCitiesNav:function( force_action ){

                if( activeCountry != undefined ){
                    if( force_action == "close" ){
                         citiesNavOpened = true;
                    }else if( force_action == "open" ){
                        citiesNavOpened = false;
                    }

                    if( citiesNavOpened ){
                        $citySelectionBar.animate({ marginTop:"0px"}, {duration:250} );
                        $citySelectionBtn.removeClass("active");
                        citiesNavOpened = false;

                    }else{
                        $citySelectionBar.animate({ marginTop:"-74px"}, {duration:250} );
                        $citySelectionBtn.addClass("active");
                        citiesNavOpened = true;
                        $this.toggleCountriesNav("close");
                    }    
                }

            },



            /*-------------------------------*/



            closeSubNavigations:function(param){
                $this.toggleCountriesNav( "close" )
                $this.toggleCitiesNav( "close" )
                if(param != 'dont-close-location'){
                    $this.hideLocationResults();    
                }
                  
            },



            /*-------------------------------*/



            mainBtnRollOver:function(e){
                $btn = $(e.currentTarget);
                $btnTitle = $btn.find(".title");
                $btnIcon = $btn.find(".icon");
                //$btnTitle.css("visibility","")
                $btnTitle.show();
                $btnTitle.animate( { top:"-31px" }, {duration:25, easing:"easeOutSine"} );
                $btn.addClass("hover");
            },




            /*-------------------------------*/


            
            mainBtnRollOut:function(e){
                $btn = $(e.currentTarget);
                $btnTitle = $btn.find(".title");
                $btnIcon = $btn.find(".icon");
                $btnTitle.animate({ top:"0"}, {duration:25, complete:function(){
                    $btnTitle.hide();
                }} );
                $btn.removeClass("hover");

            },



            /*-------------------------------*/



            countriesNavPrevNext:function(e){

                if( e.currentTarget.classList[0] == "prev"){
                    // PREV BTN
                    if( !$("#nav .countries-bar .prev").hasClass("disabled")  ){
                        destX = countriesNavIScroll.x + 200;
                        if( destX%200 != 0 ){
                            destX -= destX%200;
                        }
                        if(destX > 0 ){ 
                            destX = 0 
                            $("#nav .countries-bar .prev").addClass("disabled")
                        }
                        countriesNavIScroll.scrollTo( destX, 0, 200 );
                        $("#nav .countries-bar .prev").addClass("transition")
                    }
                    
                } else if( e.currentTarget.classList[0] == "next"){
                    // NEXT BTN
                    
                    if( !$("#nav .countries-bar .next").hasClass("disabled")  ){
                       
                        destX = countriesNavIScroll.x - 200;
                        
                        if(destX < countriesNavIScroll.maxScrollX ){ 
                            destX = countriesNavIScroll.maxScrollX;
                            
                            $("#nav .countries-bar .next").addClass("disabled");
                        }
                        countriesNavIScroll.scrollTo( destX, 0, 200 );
                        $("#nav .countries-bar .next").addClass("transition")
                        $("#nav .countries-bar .prev").removeClass("disabled");
                    }
                } 
                
            },



            /*-------------------------------*/




            countriesIScrollEnd:function(){
                if( countriesNavIScroll.x <= countriesNavIScroll.maxScrollX ){
                    $("#nav .countries-bar .next").addClass("disabled");
                }else{
                    $("#nav .countries-bar .next").removeClass("disabled");
                }  
                if( countriesNavIScroll.x == 0){
                    $("#nav .countries-bar .prev").addClass("disabled");
                }else{
                    $("#nav .countries-bar .prev").removeClass("disabled");
                }  
            },

            /*-------------------------------*/

            citiesNavPrevNext:function(e){
                if( e.currentTarget.classList[0] == "prev"){
                    if( !$("#nav .cities-bar .prev").hasClass("disabled")  ){
                        destX = citiesNavIScroll.x + 200;
                        if( destX%200 != 0 ){
                            destX -= destX%200;
                        }
                        if(destX > 0 ){ 
                            destX = 0 
                            $("#nav .cities-bar .prev").addClass("disabled")
                        }
                        citiesNavIScroll.scrollTo( destX, 0, 200 );
                        $("#nav .cities-bar .prev").addClass("transition")
                    }
                    
                } else if( e.currentTarget.classList[0] == "next"){
                    // NEXT BTN
                    if( !$("#nav .cities-bar .next").hasClass("disabled")  ){
                        destX = citiesNavIScroll.x - 200;
                        if(destX < citiesNavIScroll.maxScrollX ){ 
                            destX = citiesNavIScroll.maxScrollX;
                            $("#nav .cities-bar .next").addClass("disabled");
                        }
                        citiesNavIScroll.scrollTo( destX, 0, 200 );
                        $("#nav .cities-bar .next").addClass("transition")
                        $("#nav .cities-bar .prev").removeClass("disabled");
                    }
                }
            },



            /*-------------------------------*/




            citiesIScrollEnd:function(){
                if( citiesNavIScroll.x <= citiesNavIScroll.maxScrollX ){
                    $("#nav .cities-bar .next").addClass("disabled");
                }else{
                    $("#nav .cities-bar .next").removeClass("disabled");
                }  
                if( citiesNavIScroll.x == 0){
                    $("#nav .cities-bar .prev").addClass("disabled");
                }else{
                    $("#nav .cities-bar .prev").removeClass("disabled");
                }  
            },


            /*-------------------------------*/



            createCountriesList:function (){   

                // Create list of countries  
                html_str = "<ul>";
				
				STORES_DATA.countries.sort(function(a, b)
				{
					var nameA = a.name.toLowerCase();
					var nameB = b.name.toLowerCase();
					if (nameA < nameB)
					return -1;
					if (nameA > nameB)
					return 1;
					
					return 0;
				});
                for( var i=0; i<STORES_DATA.countries.length; i++){
                    html_str += 
                    "<li><a id='country-btn-"+i+"' safe_name='"+STORES_DATA.countries[i].country_code+"' >"+
                            STORES_DATA.countries[i].name + " (" + STORES_DATA.countries[i].stores_total + ")</a></li>";
                }
                html_str += "</ul>";
                
                $("#countries-holder .scroller").html(html_str);

                // assing button action
                for( var i=0; i<STORES_DATA.countries.length; i++){
                    $("#country-btn-"+i).bind(CLICK_EVENT, { lat: STORES_DATA.countries[i].lat, 
                                                             lon: STORES_DATA.countries[i].lon,
                                                             country_code: STORES_DATA.countries[i].country_code,
                                                             name: STORES_DATA.countries[i].name }, 
                                                                $this.changeCountry );
                }

                // scroller
				var $countriesHolder = $('#countries-holder');
				DragCursor.open($countriesHolder, true);
                countriesNavIScroll = new iScroll('countries-holder', {
                                                    snap: "li", momentum: true,
                                                    vScrollbar: false, hScrollbar: false,
                                                    onScrollMove: function () {
                                                        $('#countries-holder ul li a').addClass("dragging");
                                                    },
                                                    onScrollEnd: function () {
														DragCursor.open($countriesHolder, true);
                                                        $this.countriesIScrollEnd();
                                                        $('#countries-holder ul li a').removeClass("dragging");
                                                        $('#countries-holder ul li').removeClass("active");
                                                        $('#countries-holder ul li:nth-child(' + (this.currPageX+1) + ')').addClass('active');
               
                                                        //
                                                    },
                                                    onBeforeScrollStart: function (e) {
														DragCursor.closed($countriesHolder, true);
                                                        
                                                        if (e.target.tagName != 'A'){
                                                            e.preventDefault();
                                                        }
                                                    }                
                                                });
                
                //
                
            },



            /*-------------------------------*/


            

            createCitiesList:function (){

                // Create list of cities  
                html_str = "<ul>";
                for( var i=0; i<STORES_DATA.cities.length; i++){
                    html_str += 
                    "<li class='country-"+STORES_DATA.cities[i].country_code+"' >"+
                        "<a id='city-btn-"+i+"' safe_name='"+STORES_DATA.cities[i].safe_name+"'  >"+
                            STORES_DATA.cities[i].name + " (" + STORES_DATA.cities[i].stores_total + ")"+ 
                        "</a>"+
                    "</li>";
                }
                html_str += "</ul>";
                $("#cities-holder .scroller").html(html_str);

                // assing button action
                for( var i=0; i<STORES_DATA.cities.length; i++){
                    $("#city-btn-"+i).bind( CLICK_EVENT, { lat: STORES_DATA.cities[i].lat, 
                                                                lon: STORES_DATA.cities[i].lon,
                                                                country_code: STORES_DATA.cities[i].country_code,
                                                                name: STORES_DATA.cities[i].name },
                                                                $this.changeCity
                                                                //
                                                                );
                }

                // scroller
				var $citiesHolder = $('#cities-holder');
				DragCursor.open($citiesHolder, true);
                citiesNavIScroll = new iScroll('cities-holder', {
                                                    snap: "li", momentum: true,
                                                    vScrollbar: false, hScrollbar: false,
                                                    onScrollMove: function () {
                                                        $('#cities-holder ul li a').addClass("dragging");
                                                    },
                                                    onScrollEnd: function () {
														DragCursor.open($citiesHolder, true);
                                                        $this.citiesIScrollEnd();
                                                        $('#cities-holder ul li a').removeClass("dragging");
                                                    },
                                                    onBeforeScrollStart: function (e) {
														DragCursor.closed($citiesHolder, true);
                                                        if (e.target.tagName != 'A'){
                                                            e.preventDefault();
                                                        }
                                                    } 
                });
                $this.resizeNavScrollers();

            },



            /*-------------------------------*/



            resizeNavScrollers:function ( resize_country ){
                
                if( resize_country == false ){
                    // do nothing
                }else{
                    $("#countries-holder").width( $window.width()-120 ) 
                    $("#countries-holder .scroller").width( 200 * $("#countries-holder .scroller ul").children().length )
                    countriesNavIScroll.refresh();
                    countriesNavIScroll.scrollTo(0,0,0);
                }
                $("#cities-holder").width( $window.width()-120 )
                $("#cities-holder .scroller").width( 200 * $("#cities-holder .scroller ul li.visible").children().length );
                citiesNavIScroll.refresh();
                citiesNavIScroll.scrollTo(0,0,0);
            },



            /*-------------------------------*/



            changeCountry:function ( event ){
                
                if( event.currentTarget.className != "dragging" ){
                    
                    activeCountry = event.data.country_code;
                    $this.hideSearchResults();
                    $this.hideLocationResults();
                    //if( sectionMode == "map" ){

                        // MAP view

                        $("#stores-wrapper #nav #countries-holder ul li a").removeClass("active")
                        $(event.currentTarget).addClass("active")

                        if( event.data.country_code == "ES" ){
                            // fix to show canarias in spain view
                            zoom_level = 5;
                            event.data.lat -= 3;
                        }else if( event.data.country_code == "RU" ){
                            // fix to show canarias in spain view
                            zoom_level = 4;
                            //event.data.lat -= 3;
                        }else{
                            // default zoom for countries view
                            zoom_level = country_zoom_level;
                        }

                        
                        $("#nav .country-selection").addClass("selected")  
                        $("#nav .city-selection").removeClass("disabled")
                        $this.resetCitySelectionBtn();
                        $("#nav .country-selection .title").html(event.data.name);
                        $("#nav .city-selection .title").html();
                        $this.GMapsChangeLatlong( event.data.lat, event.data.lon, zoom_level );
                        $this.toggleCountriesNav("close");
                        
                        $citySelectionBar.find("li").hide()
                        $citySelectionBar.find("li").removeClass("visible");
                        $citySelectionBar.find("li.country-"+event.data.country_code).show();
                        $citySelectionBar.find("li.country-"+event.data.country_code).addClass("visible");
                        $this.resizeNavScrollers(false);

                    //}else{

                        // LIST view
                        country_class_name = $(event.currentTarget).attr("safe_name");
                        scrollTo = parseFloat( $(".column.country."+country_class_name).attr("offsetX") );
                        if( !isNaN(scrollTo) ) {
                            if( sectionMode == "map" ){
                                $listModeContainer.iOSScrollSatorisan( 'setTo', scrollTo );
                            }else{
                                $listModeContainer.iOSScrollSatorisan( 'scrollTo', scrollTo );    
                            }
                        }   

                    //}
                }

            },

            

            /*-------------------------------*/



            changeCity:function ( event ){

                if( event.currentTarget.className != "dragging" ){

                    activeCity = event.data.name;
                    $this.hideSearchResults();
                    $this.hideLocationResults();
                    //if( sectionMode == "map" ){

                        // MAP view
                        $("#stores-wrapper #nav #cities-holder ul li a").removeClass("active")
                        $(event.currentTarget).addClass("active")

                        
                        $("#nav .city-selection .title").html(event.data.name);
                        $("#nav .city-selection").addClass("selected")
                        $this.GMapsChangeLatlong( event.data.lat, event.data.lon, city_zoom_level );
                        
                        $this.toggleCitiesNav("close");
                        //$this.resizeNavScrollers();

                    //}else{

                        // LIST view
                        city_class_name = $(event.currentTarget).attr("safe_name");
                        scrollTo = parseFloat( $(".column.city."+city_class_name).attr("offsetX") );
                       
                        if( !isNaN(scrollTo) ) {
                            if( sectionMode == "map" ){
                                $listModeContainer.iOSScrollSatorisan( 'setTo', scrollTo );
                            }else{
                                $listModeContainer.iOSScrollSatorisan( 'scrollTo', scrollTo );    
                            }
                        }
                    //}
                }
            },


            /*-------------------------------*/



            resetCountrySelectionBtn:function(){
                
                $("#nav .country-selection .title").html(DICTIONARY[CURRENT_LANGUAGE].select_country);
                $("#nav .country-selection").removeClass("selected")    
            },


            /*-------------------------------*/



            resetCitySelectionBtn:function(){
                
                $("#nav .city-selection .title").html(DICTIONARY[CURRENT_LANGUAGE].select_city);
                $("#nav .city-selection").removeClass("selected")    
            },
                        



            /*-------------------------------*/




            openStoreDetailBox:function ( temp_marker ){
                temp_marker.setIcon(markerIcon);
                toolTips[temp_marker.id].close(map, temp_marker);
                $this.GMapsClearDetailBoxes();
                detailBoxes[temp_marker.id].open(map, temp_marker);
                actualDetailBox = temp_marker;
                map.panTo( temp_marker.getPosition() );
                map.setZoom( markerClickZoomLevel );
                map.panBy(-200,0)
                //$this.GMapsChangeLatlong( lat, lon, markerClickZoomLevel );
            },






            /*-------------------------------*/



            setMapInitialPositon:function(){
                
                // TO DO: check if user country is detected and has a shop, display the country
                user_country_has_stores = false;

                for( var i=0; i<STORES_DATA.countries.length; i++){
                    if(user.SHIPPING_CODE == STORES_DATA.countries[i].country_code){

                        if( STORES_DATA.countries[i].country_code == "ES" ){
                            // fix to show canarias in spain view
                            zoom_level = 5;
                            STORES_DATA.countries[i].lat -= 3;
                        }else{
                            // default zoom for countries view
                            zoom_level = country_zoom_level;
                        }

                        $this.GMapsChangeLatlong( STORES_DATA.countries[i].lat, 
                                                    STORES_DATA.countries[i].lon, zoom_level );
                        user_country_has_stores = true;
                        break;
                    }  
                }

                if( user_country_has_stores == false ){
                    //Center map to fit all markers
                    min_lat = parseFloat(STORES_DATA.bounds.min_lat); 
                    min_lon = parseFloat(STORES_DATA.bounds.min_lon);
                    max_lat = parseFloat(STORES_DATA.bounds.max_lat); 
                    max_lon = parseFloat(STORES_DATA.bounds.max_lon);

                    if( min_lat > 0 ){ min_lat += init_bounds_correction; }else{ min_lat += init_bounds_correction; }
                    if( min_lon > 0 ){ min_lon += init_bounds_correction; }else{ min_lon += init_bounds_correction; }
                    if( max_lat > 0 ){ max_lat -= init_bounds_correction; }else{ max_lat += init_bounds_correction; }
                    if( max_lon > 0 ){ max_lon -= init_bounds_correction; }else{ max_lon += init_bounds_correction; }

                    map.fitBounds( new google.maps.LatLngBounds( new google.maps.LatLng( min_lat, min_lon ) ,
                                                                    new google.maps.LatLng( max_lat, max_lon ) ));
                }

            },



            /*-------------------------------*/


            initListView:function(){

                // Create Anew Array formatted
                listModeArray = new Array();
                temp_markers = STORES_DATA.markers;
                for( var i = 0; i < temp_markers.length ; i++ ){
                    if(listModeArray[""+temp_markers[i].country_code+""] == undefined){
                        listModeArray[""+temp_markers[i].country_code+""] = new Array();
                    }
                    /*
                    if(listModeArray[""+temp_markers[i].country_code+""][""+temp_markers[i].city+""] == undefined){
                        listModeArray[""+temp_markers[i].country_code+""][""+temp_markers[i].city+""] = new Array();
                    }
                    listModeArray[""+temp_markers[i].country_code+""][""+temp_markers[i].city+""].push(temp_markers[i]);
                    */
                    if(listModeArray[""+temp_markers[i].country_code+""][""+temp_markers[i].state+""] == undefined){
                        listModeArray[""+temp_markers[i].country_code+""][""+temp_markers[i].state+""] = new Array();
                    }
                    listModeArray[""+temp_markers[i].country_code+""][""+temp_markers[i].state+""].push(temp_markers[i]);
                }

                $this.appendListView();

            },

            

            /*-------------------------------*/



            appendListView:function(){
                

                // Create HTML
                win_hei = $window.height();
                if( win_hei < 680 ){
                    rows_per_column = 1;
                } else if( win_hei < 820 ){
                    rows_per_column = 2;
                } else if( win_hei < 1000 ){
                    rows_per_column = 3;
                }else{
                    rows_per_column = 4;
                }
                
                html = "";
                for (i in listModeArray){
                    for( var x=0; x<STORES_DATA.countries.length ;x++ ){
                        if( STORES_DATA.countries[x].country_code == i ){
                            temp_country_data = STORES_DATA.countries[x];
                        }
                    }
                    html += "<div class='column country "+i+"' >";
                    if(temp_country_data.stores_total == 1){
                        country_title_sufix = DICTIONARY[CURRENT_LANGUAGE].store;
                    }else{
                        country_title_sufix = DICTIONARY[CURRENT_LANGUAGE].stores;
                    }
                    temp_country_data.name = temp_country_data.name.replace("Republic","Rep.");
                    temp_country_data.name = temp_country_data.name.replace("República","Rep."); 
                    html += "   <h1>"+temp_country_data.name+" <span>"+temp_country_data.stores_total+" "+country_title_sufix+"</span></h1>";
                    for (j in listModeArray[i]){
                        stores = listModeArray[i][j];
                        
                        html += "<div class='column city "+stores[0].state_safe_name+"' >";
                        html += "   <h2>"+j+" <span>("+stores.length+")</span></h2>";
                        for ( var n=0; n<stores.length; n++){
                            if( n == 0 || n == rows_per_column || n == rows_per_column*2 || n == rows_per_column*3
                                        || n == rows_per_column*4 || n == rows_per_column*5 || n == rows_per_column*6
                                        || n == rows_per_column*7 || n == rows_per_column*8 || n == rows_per_column*9
                                        || n == rows_per_column*10 || n == rows_per_column*11 || n == rows_per_column*12 ){
                                html += "<div class='column stores column' >";
                            }

                                store = stores[n];
                                html += "<div class='row store "+n+"' >";
                                html += "   <h3>"+store.title+"</h3>";
                                html += "   <p>"+store.dir+".<br/>"+
                                                store.tel+
                                                store.code+" "+store.city+".<br/>"+
                                                store.state+
                                                ", <span style='text-transform:uppercase;' >"+store.country+"</span>."+
                                            "</p>";
                                html += "   <div class='link' >"+
                                            "<span class='gmaps-icon' ></span>"+
                                            "<a lat='"+store.lat+"'' lon='"+store.lon+"' store_id='"+store.id+"' >"+
                                                DICTIONARY[CURRENT_LANGUAGE].view_on_map+"</a>"+
                                            "</div>";
                                html += "</div>";

                            if( n == stores.length-1 
                                    || n == rows_per_column-1 || n == rows_per_column*2-1 || n == rows_per_column*3-1
                                    || n == rows_per_column*4-1 || n == rows_per_column*5-1 || n == rows_per_column*6-1
                                    || n == rows_per_column*7-1 || n == rows_per_column*8-1 || n == rows_per_column*9-1
                                    || n == rows_per_column*10-1 || n == rows_per_column*11-1 || n == rows_per_column*12-1 ){
                                html += "</div>";
                            }
                        }
                        html += "</div>";
                    }
                    html += "</div>";
                }

                $("#list-view-wrapper .list").html(html)
                $("#list-view-wrapper .list").width( 300*$("#list-view-wrapper .list .column.stores").length );
                $("#list-view-wrapper").height( $window.height()-64 );
                
                // set columns offsetX for scroll
                $( "#list-view-wrapper .column.city, #list-view-wrapper .column.country" ).each(function( index ) {
                    $(this).attr("offsetX", $(this).position().left);
                });

                // scroll
                $listModeContainer = $('#list-view-wrapper');
                if( !listModeScrollEnabled ){
                    listModeScrollEnabled = true;
                    $listModeContainer.iOSScrollSatorisan();
				
					DragCursor.open($listModeContainer, true);
					$listModeContainer.iOSScrollSatorisan('addListener', 'dragStart', function()
					{
						DragCursor.closed($listModeContainer, true);
					});
					$listModeContainer.iOSScrollSatorisan('addListener', 'dragStop', function()
					{
						DragCursor.open($listModeContainer, true);
					});
					

                    $listModeContainer.iOSScrollSatorisan('onUpdate', function ( e ){
                        // Update country name on list mode
                        $("#list-view-wrapper .list .column.country").each( function(){
                            
                            if( e.position < $(this).attr("offsetx")){
                                // this is the country
                                if( $(this).prev().attr("class") == undefined ){
                                    tmp_country_code = "ES";
                                }else{
                                    tmp_country_code_arr = $(this).prev().attr("class").split(" ")
                                    tmp_country_code = tmp_country_code_arr[2];
                                }
                                $this.resetCitySelectionBtn();
                                for( var z=0; z<STORES_DATA.countries.length; z++){
                                    if( STORES_DATA.countries[z].country_code == tmp_country_code ){
                                        tmp_country_name = STORES_DATA.countries[z].name;
                                        tmp_country_lat = STORES_DATA.countries[z].lat;
                                        tmp_country_lon = STORES_DATA.countries[z].lon;
                                    }
                                }
                                $("#nav .country-selection .title").html(tmp_country_name);
                                $("#nav .city-selection .title").html();

                                // update map
                                if( tmp_country_code == "ES" ){
                                    // fix to show canarias in spain view
                                    zoom_level = 5;
                                    tmp_country_lat -= 3;
                                }else if( tmp_country_code == "RU" ){
                                    // fix to show canarias in spain view
                                    zoom_level = 4;
                                    //event.data.lat -= 3;
                                }else{
                                    // default zoom for countries view
                                    zoom_level = country_zoom_level;
                                }
                                $this.GMapsChangeLatlong( tmp_country_lat, tmp_country_lon, zoom_level );
                                map.panBy(1,0);
                                /*
                                $("#countries-holder ul li a").each( function(){
                                    if( $(this).attr("safe_name") == tmp_country_code ){
                                        console.log( "click btn"+tmp_country_code );
                                        $(this).click();  
                                    }
                                } )
                                */
                                //break;
                                return false;
                            }
                            
                      })
                    });
                }             

                $("#list-view-wrapper div.city .stores .link a").bind( CLICK_EVENT, $this.listBTnViewOnMap );
                $("#list-view-wrapper").bind( CLICK_EVENT, $this.closeSubNavigations );

                
            },


            /*-------------------------------*/


            listBTnViewOnMap:function (e){
                $this.listBTnViewOnMapAction($(e.currentTarget).attr("store_id"));
            },

            /*-------------------------------*/


            listBTnViewOnMapAction:function (store_id){
                for( var i=0; i<markers.length; i++ ){
                    if( markers[i].id == store_id ){
                        $this.openStoreDetailBox( markers[i] );
                        break;
                    }
                }
                $this.sectionModeToggle();
            },



            /*--------------------------------*/



            userLocation:function(){

                $this.hideSearchResults();
                $this.hideLocationResults();

                if(navigator.geolocation) {
                    
                    navigator.geolocation.getCurrentPosition(function(position) {
                        
                        user_latlon = position.coords.latitude+","+position.coords.longitude;
                        //user_latlon = "52.373922,4.885311"; // amsterdam, city has store
                        //user_latlon = "51.924155,4.481735"; // rotterdam, country has store
                        //user_latlon = "39.433807,-0.368729"; // valencia
                        //user_latlon = "41.385052,2.173233"; // bcn
                        //user_latlon = "40.416894,-3.703766"; // madri
                        temp_log = "";
                        bus.publish("satorisan", "preloader-show", {mono:true} );
                        $.ajax({
                          cache: true,
                          //type: 'GET',
                          crossDomain: true,
                          dataType: 'json',
                          /*url: "http://maps.googleapis.com/maps/api/geocode/json?address="+
                                    user_latlon+
                                    "&language="+CURRENT_LANGUAGE+"&sensor=true",*/
                          //url: "/gmapsproxy.php?search="+encodeURIComponent(user_latlon),
                          //url: "http://www.ingamana-lab.com/satorisan/gmapsproxy.php?search="+encodeURIComponent(user_latlon),
                          url: "http://www.ingamana.com/satorisan/gmapsproxy.php?search="+encodeURIComponent(user_latlon),
                          
                          success: function(data_json) {
                                
                                bus.publish("satorisan", "preloader-hide");
                                // get user city and country names
                                res = data_json.results[0].address_components;
                                user_city = "no-city";
                                user_country = "no-country";
                                for( var i=0; i<res.length; i++ ){
                                    if( res[i].types[0] == "locality" 
                                            && res[i].types[1] == "political" ){
                                        user_city = res[i].long_name; 
                                        temp_log += "user city: "+user_city+" /";
                                    }
                                    if( res[i].types[0] == "country" 
                                            && res[i].types[1] == "political" ){
                                        user_country = res[i].short_name;
                                        temp_log += "user country: "+user_country+" /";
                                    }
                                }

                                // check if user's city has an store
                                temp_markers = STORES_DATA.markers;
                                user_city_has_store = false;
                                for ( var i = 0; i < temp_markers.length; i++ ) {
                                    temp_markers[i].city_gmaps_name.search(user_city)
                                    if( temp_markers[i].city_gmaps_name.search(user_city) != -1 ){
                                        // this store is in the user's city, show city on map
                                        user_city_has_store = true;
                                        user_city_latlon = temp_markers[i].city_latlon.split(",");
                                        break;
                                    }
                                }

                                if( user_city_has_store ){
                                    // show city on map
                                    temp_log += "show city on map /";
                                    $this.GMapsChangeLatlong( user_city_latlon[0], user_city_latlon[1], city_zoom_level );

                                }else{
                                    user_country_has_store = false;
                                    for ( var i = 0; i < temp_markers.length; i++ ) {
                                        if( temp_markers[i].country_code == user_country ){
                                            // this store is in the user's country, show country on map
                                            user_country_has_store = true;
                                            user_country_latlon = temp_markers[i].country_latlon.split(",");
                                            break;
                                        }
                                    }
                                    if( user_country_has_store ){
                                        // show country on map
                                        $this.GMapsChangeLatlong( user_country_latlon[0], user_country_latlon[1], country_zoom_level );
                                        temp_log += "show country on map /";
                                    }else{
                                        // else show full map view and a messag
                                        $this.setMapInitialPositon()
                                        temp_log += "show full map: no stores detected /";
                                        $locationResults.find(".results").html(
                                            DICTIONARY[CURRENT_LANGUAGE].your_location_no_results);
                                        $this.showLocationResults();  
                                    }
                                }

                                $this.closeSubNavigations('dont-close-location');
                                if(sectionMode == "list"){
                                    $this.sectionModeToggle();
                                }

                          }
                        });
                        
                    }, function() { $this.handleNoGeolocation(true); });

                } else {
                    // Browser doesn't support Geolocation
                    $this.handleNoGeolocation(false);
                }
            },



            /*-------------------------------*/



            handleNoGeolocation:function(errorFlag) {
                if (errorFlag) {
                    content = DICTIONARY[CURRENT_LANGUAGE].your_location_error_service;
                } else {
                    content = DICTIONARY[CURRENT_LANGUAGE].your_location_error_browser;
                }
                $locationResults.find(".results").html(content);
                $this.showLocationResults();  
            },



            /*-------------------------------*/



            initSearch:function(){
                $("#nav .search-selection .search-field").focus(function() {
                    $(this).addClass("active");
                    $("#stores-wrapper #nav div.icon span.search").addClass("active");
                    $this.closeSubNavigations();
                });
                $("#nav .search-selection .search-field").focusout(function() {
                    $(this).removeClass("active");
                    $("#stores-wrapper #nav div.icon span.search").removeClass("active");
                });
                $("#nav .search-selection .search-field").keypress(function(event) {
                    if( event.which == 13){
                        $this.searchLocation();
                    }
                });
                $(".column.search-selection .icon span.search").bind( CLICK_EVENT, $this.searchLocation );
                
                $searchResults.find(".close").bind( CLICK_EVENT, $this.hideSearchResults );
            },



            /*-------------------------------*/



            searchLocation:function (){
                input = $(".column.search-selection input");
                if( input.attr("value") == "" ){
                    input.addClass("error")
                }else{
                    // search
                    $this.hideLocationResults();
                    bus.publish("satorisan", "preloader-show", {mono:true} );
                    $.ajax({
                            //type: 'GET',
                          cache: true,
                          crossDomain: true,
                          dataType: 'json',
                          url: "http://www.ingamana.com/satorisan/gmapsproxy.php?search="+
                                            encodeURIComponent(input.attr("value")),
                          /*url: "http://www.ingamana-lab.com/satorisan/gmapsproxy.php?search="+
                                            encodeURIComponent(input.attr("value")),*/
                          /*url: "/gmapsproxy.php?search="+
                                            encodeURIComponent(input.attr("value")),*/
                          /*url: "http://maps.googleapis.com/maps/api/geocode/json?address="+
                                    encodeURIComponent(input.attr("value"))+
                                    "&language="+CURRENT_LANGUAGE+"&sensor=true",*/
                          //contentType: "application/x-www-form-urlencoded;charset=UTF-8",
                          success: function(data_jason) {
                                bus.publish("satorisan", "preloader-hide");
                                html_str = "";
                                if(data_jason.results.length>8){
                                    total_res = 8;
                                }else{
                                    total_res = data_jason.results.length
                                }
                                for( var i=0; i<total_res; i++ ){
                                    res = data_jason.results[i];
                                    
                                    html_str += "<div class='result'>"+
                                                    "<a lat='"+res.geometry.location.lat+"' lon='"+res.geometry.location.lng+"' >"+
                                                    res.formatted_address+"</a>"+
                                                "</div>";
                                }
                                $searchResults.find(".results").html(html_str);

                                $( "#search-results .results .result a" ).each( function( index ) {
                                    $(this).bind( CLICK_EVENT, function(){ 
                                        $this.displaySearchResultsOnMap($(this).attr("lat"),$(this).attr("lon") ); 
                                    } );
                                     
                                });

                                $this.showSearchResults();
                                
                                $this.closeSubNavigations();
                                if(sectionMode == "list"){
                                    $this.sectionModeToggle();
                                }
                                
                          }
                    });
                }
            },

            /*-------------------------------*/

            hideSearchResults:function(){
                 $("#search-results-wrapper").hide();
            },


            showSearchResults:function(){
                //
                $searchResults.css("opacity",0);
                $("#search-results-wrapper").show();
                $searchResults.css("margin-top", ($window.height()-43-82)/2-$searchResults.outerHeight()/2 );
                $searchResults.css("opacity",1);
            },

            /*-------------------------------*/

            hideLocationResults:function(){
                $locationResults.hide();
            },


            showLocationResults:function(){
                $locationResults.css("margin-top", ($window.height()-43-82)/2-90 )
                $locationResults.show();
            },

            /*-------------------------------*/



            displaySearchResultsOnMap:function(lat, lon){

                $this.hideSearchResults();

                // find nearest store
                nearest_distance = 10000;
                nearest_store = STORES_DATA.markers[0];
                for ( var i = 0; i < STORES_DATA.markers.length; i++ ) {
                    store = STORES_DATA.markers[i];
                    
                    temp_distance = $this.CalculateDistance(lat, lon, store.lat, store.lon );
                    if( temp_distance < nearest_distance ){ 
                        nearest_distance = temp_distance;
                        nearest_store = store; 
                    }    
                }
           
                
                if( parseFloat(lon) < parseFloat(nearest_store.lon) ){
                    
                    min_lon = lon;
                    max_lon = nearest_store.lon;
                    min_lat = lat;
                    max_lat = nearest_store.lat;
                } else {
                    
                    min_lon = nearest_store.lon;
                    max_lon = lon;
                    min_lat = nearest_store.lat;
                    max_lat = lat;
                }
                
                $this.hideSearchResults();
                // set mapp position and zoom
                map.fitBounds( new google.maps.LatLngBounds( new google.maps.LatLng( min_lat, min_lon ) ,
                                                            new google.maps.LatLng( max_lat, max_lon ) ));
                $this.resetCitySelectionBtn();
                $this.resetCountrySelectionBtn();

            },


            CalculateDistance:function (lat1, lon1, lat2, lon2){
                var R = 6371; // earth's mean radius in km
                
                var dLat = (lat2-lat1) * (Math.PI / 180);
                var dLon = (lon2-lon1) * (Math.PI / 180);
                
                lat1 = lat1 * (Math.PI / 180), 
                lat2 = lat2 * (Math.PI / 180);

                var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1) * Math.cos(lat2) * 
                      Math.sin(dLon/2) * Math.sin(dLon/2);
                var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
                var d = R * c;
                return d;
            },


            /*-------------------------------*/



            resize:function(){
                
                // resize MAP height
                $sectionHolder.css( { height: $window.height()-146 } );
                $mapHolder.css( { height: $window.height()-146 } );
                
                // Resize LIST view
                $this.appendListView();
                
                // resize Navigation scrollers
                $this.resizeNavScrollers();
            },



            /*-------------------------------*/



            stop:function(){
                if (isActive)
                {
                    isActive = false;

                }
                $body.removeClass(PAGE_BODY_SELECTOR);

            }

        
        }

        
    
});
/*
function mapCLick(){
                   
    //alert(linkMap);
    console.log($(this));
   // window.open(linkMap,"_blank");
    return false;
                  
}*/

Hydra.module.register( 'policies', function( bus ){ 
        
        var $this, nice, currentType="", isClicking=false,isActive=false, keepOverlay=true, overlayAnimation = true, isAppendShipping = false;
        var currentPoliciesIndex;

        return {
            
            /*-------------------------------*/
            /* POLICIES */
            /*-------------------------------*/            

            init: function(){
                currentPoliciesIndex = 0;
                $this = this;
                $footer.find(".policies").bind(CLICK_EVENT, $this.createPolicie);
                $footer.find(".help").bind(CLICK_EVENT, $this.createHelp);
                /*$content.find(".header .header_desc a.normal-link").bind(CLICK_EVENT, $this.createShippingInfo);*/
                $window.bind("resize", $this.resize);
                bus.subscribe('satorisan', this);
                
                if ($(".cookies-question .about-button").length > 0)
                {
                    $(".cookies-question .about-button").bind(CLICK_EVENT, $this.createPolicie);
                }
            },


            /*-------------------------------*/

            createHelp:function(e)
            {
                e.preventDefault();

                if (currentType!="help")
                {
                    $footer.find(".help span").addClass("selected");
                    overlayAnimation = true;
                    bus.publish("satorisan", "ganalytics-track-event",{name:"HELP "+CURRENT_LANGUAGE.toUpperCase()});
                    if (user.MISCELANEA_WINDOW_OPEN && isActive == false)
                    {
                        bus.publish("satorisan", "menu-change-go", { dataRight:"" }); 
                        bus.publish("satorisan", "destroy-miscelanea-page", { keepOverlay:true, complete:function(animation){
                            keepOverlay = true;

                            if (CURRENT_LANGUAGE == "es")
                            {
                                $this.create(TEMPLATE_NEED_HELP_ES, "help");
                            }
                            else
                            {
                                $this.create(TEMPLATE_NEED_HELP_EN, "help");
                            }
                        }});
                    }
                    else
                    {
                        bus.publish("satorisan", "menu-change-go", { dataRight:"" });
                        keepOverlay = false;
                        if (CURRENT_LANGUAGE == "es")
                        {
                            $this.create(TEMPLATE_NEED_HELP_ES, "help");
                        }
                        else
                        {
                            $this.create(TEMPLATE_NEED_HELP_EN, "help");
                        }
                    }
                }


                
                return false;
            },

            /*-------------------------------*/

            createPolicie:function(e)
            {
                e.preventDefault();     

                //console.log(currentType);           
                var isCookiesTarget = false;
                var COOKIE_SCROLL_TOP_ES = 2820;
                var COOKIE_SCROLL_TOP_EN = 2975;
                if ($(this).attr("class")=="about-button")
                {
                    isCookiesTarget = true;
                }

                if (currentType!="policies")
                {
                    $footer.find(".policies").addClass("selected");

                    overlayAnimation = true;

                    bus.publish("satorisan", "ganalytics-track-event",{name:"POLICIES "+CURRENT_LANGUAGE.toUpperCase()});
                    if (user.MISCELANEA_WINDOW_OPEN && isActive == false)
                    {
                        bus.publish("satorisan", "menu-change-go", { dataRight:"" });
                        bus.publish("satorisan", "destroy-miscelanea-page", {keepOverlay:true, complete:function(animation){
                            
                            keepOverlay = true;

                            if (CURRENT_LANGUAGE == "es")
                            {
                                $this.create(TEMPLATE_POLICIES_ES, "policies");
                                if (isCookiesTarget)
                                {
                                    $(".help-layout .header-fixed a").eq(2).trigger(CLICK_EVENT);
                                    $(".help-layout").animate( {scrollTop:COOKIE_SCROLL_TOP_ES}, {duration:0});
                                }
                                
                               

                            }
                            else
                            {
                                $this.create(TEMPLATE_POLICIES_EN, "policies");   
                                if (isCookiesTarget)
                                {
                                    $(".help-layout .header-fixed a").eq(2).trigger(CLICK_EVENT);
                                    $(".help-layout").animate( {scrollTop:COOKIE_SCROLL_TOP_EN}, {duration:0});
                                }
                            }
                        }});
                    }
                    else
                    {
                        keepOverlay = false;
                        if (CURRENT_LANGUAGE == "es")
                        {
                            $this.create(TEMPLATE_POLICIES_ES, "policies");

                            if (isCookiesTarget)
                            {
                                $(".help-layout .header-fixed a").eq(2).trigger(CLICK_EVENT);
                                $(".help-layout").animate( {scrollTop:COOKIE_SCROLL_TOP_ES}, {duration:0});
                            }
                        }
                        else
                        {
                            $this.create(TEMPLATE_POLICIES_EN, "policies");   

                            if (isCookiesTarget)
                            {
                                $(".help-layout .header-fixed a").eq(2).trigger(CLICK_EVENT);
                                $(".help-layout").animate( {scrollTop:COOKIE_SCROLL_TOP_EN}, {duration:0});
                            }
                        }
                    }
                }                  

                return false;

            }, 

            /*-------------------------------*/

            createShippingInfo:function(e)
            {
                if (e) e.preventDefault();                

                bus.publish("satorisan", "ganalytics-track-event",{name:"SHIPPING INFO "+CURRENT_LANGUAGE.toUpperCase()});
                if (user.MISCELANEA_WINDOW_OPEN && isActive == false)
                {
                    bus.publish("satorisan", "destroy-miscelanea-page", {complete:function(){

                        keepOverlay = true;

                        if (CURRENT_LANGUAGE == "es")
                        {
                            $this.create(TEMPLATE_SHIPPING_INFO_ES, "shipping");
                        }
                        else
                        {
                            $this.create(TEMPLATE_SHIPPING_INFO_EN, "shipping");   
                        }
                    }});
                }
                else
                {
                    keepOverlay = false;
                    
                    if (CURRENT_LANGUAGE == "es")
                    {
                        $this.create(TEMPLATE_SHIPPING_INFO_ES, "shipping");
                    }
                    else
                    {
                        $this.create(TEMPLATE_SHIPPING_INFO_EN, "shipping");   
                    }
                }

                return false;

            },

            /*-------------------------------*/

            resize:function(){
                var toWidth = $window.width()-10;
                var padding = "";
                //console.log(toWidth);
                if (toWidth >= 1140) {
                    toWidth = 1006;
                    padding = "15px 56px 0 56px";
                }else if (toWidth <= 1139 && toWidth >= 950) {
                    toWidth = 876;
                    padding = "15px 199px 0px 54px";
                }

                

                $(".header-fixed").css({
                    width:790,
                    "margin-left":Math.round(($window.width()/2) - ((790)/2) -30)
                });

                var h=190;
                
                var isChrome = navigator.userAgent.match(/CriOS/i) != null;

                if (isiPad && isChrome)
                {
                    
                    h=270;
                }
                $(".help-layout").css( { 
                    height:$window.height()-h,
                    width:toWidth - 270 + 57,
                    "padding": padding,

                    
                } );


                $(".help-wrapper .fixbar").css({
                    height:$window.height(),
                });

                $(".changes-content").css({
                     height:$window.height()-149
                });

                $(".changes-content-wrapper").css({
                     height:$window.height()-149
                });

                $(".changes-content .shipping-info-popup-body").css({ 
                    height:$window.height()-220
                });

                $this.fixHelpLastSectionHeight();

                
            },


            /*-------------------------------*/

            
            fixHelpLastSectionHeight:function(){
                    
                    available_height = $window.height()-190-25; // 190 header & 25 footer
                    last_section_height = $overlay.find("#help_5").height();
                    if( available_height > last_section_height ){
                        $overlay.find("#help_5").height(available_height-50);
                    }
                    
            },


            /*-------------------------------*/

            oEventsCallbacks: {                
                'destroy-miscelanea-page' : function(data)
                {
                    if (isActive)
                    {
                        $this.stop(data);
                    }
                },

                'create-shipping-popup' : function (data)
                {  
                    $this.createShippingInfo();
                },

                'destroy-popup' : function (data)
                {  
                    if (isActive)
                    {
                        $this.stop(); 
                    }
                }
            },

            /*-------------------------------*/

            create:function(template, type){
                
                currentType = type;
                bus.publish( 'satorisan', 'pause-page' );

                if (isActive==false)
                {
                    
                    var MARKUP = "<div class='help-wrapper'>";
                    MARKUP += "<div class='help-layout-wrapper'><div class='fixbar' style='background:white; position:absolute; top:0; left: 30px;width: 955px; height:100px;'></div>";
                    MARKUP += "<div class='iconos close-help close-iframe'><span></span></div>";
                    MARKUP += "<div class='help-layout'><div class='cont'>";
                    
                    MARKUP += template;
                    
                    MARKUP += "</div></div>";
                    MARKUP += "</div>";
                    MARKUP += "</div>";

                    $overlay.append (MARKUP);

                    $overlay.find(".close-help").unbind(CLICK_EVENT, $this.destroy).bind(CLICK_EVENT, function(e){
                        $this.stop();
                        return false;
                    });
                    $this.resize();
                    
                    $this.createScoll();

                    $(".help-layout").getNiceScroll().hide();

                    $overlay.find(".help-layout .cont").css( { opacity:0} );
                    var overlayTimeout = 250;
                    if (overlayAnimation==false) overlayTimeout = 0;
                    bus.publish( 'satorisan', 'pause-page' );
                    if (keepOverlay)
                    {
                        $overlay.find(".help-layout-wrapper").animate( { height:"100%"}, {easing:"easeInOutSine", duration:250, complete:function(){
                            $overlay.find(".help-layout .cont").animate( { opacity:1}, {duration:250} );
                            //$this.createScoll();
                            $(".help-layout").getNiceScroll().show();
                        }}); 
                    }
                    else
                    {
                        bus.publish("satorisan", "overlay-show", {complete:function(){
                            $overlay.find(".help-layout-wrapper").animate( { height:"100%"}, {easing:"easeInOutSine", duration:250, complete:function(){
                                $overlay.find(".help-layout .cont").animate( { opacity:1}, {duration:250} );
                                //$this.createScoll();
                                $(".help-layout").getNiceScroll().show();
                            }});    
                        }});    
                    }

                    $this.fixHelpLastSectionHeight();

                    user.MISCELANEA_WINDOW_OPEN = true;
                    

                    isActive = true;
                }
                else
                {
                    $overlay.find(".help-layout .cont").animate( { opacity:0}, { duration:250, complete:function(){
                        $(".help-layout .cont").html(template);
                        $overlay.find(".help-layout .cont").animate( { opacity:1}, {duration:250});
                        if (type == "policies")
                        {
                            
                            $this.setInteractivityPolicies();
                        }
                        else
                        {
                            $this.setInteractivityHelp();
                        }

                        $this.createScoll();
                        $(".help-layout").getNiceScroll().show();

                        $(".header-fixed li").eq(0).addClass("active");

                        $(".help-layout").animate( {scrollTop:0}, {duration:0});

                    }} );    
                }
                
                bus.publish('satorisan', 'history-update');

                if (type == "policies")
                {
                    
                    $this.setInteractivityPolicies();
                }
                else
                {
                    $this.setInteractivityHelp();
                }

                $(".general-background-overlay").unbind(CLICK_EVENT).bind(CLICK_EVENT, $this.stop);
                
                $(".header-fixed li").eq(0).addClass("active");

                $(".help-layout").animate( {scrollTop:0}, {duration:0});

                if (CURRENT_LANGUAGE == "es")
                {
                    $(".help-layout a#changes-content-button").bind(CLICK_EVENT, function(e){
                        e.preventDefault();
                        $this.appendShipping(TEMPLATE_SHIPPING_INFO_ES, "shipping");
                        return false;
                    });
                }
                else
                {
                   $(".help-layout a#changes-content-button").bind(CLICK_EVENT, function(e){
                        e.preventDefault();
                        $this.appendShipping(TEMPLATE_SHIPPING_INFO_EN, "shipping");
                        return false;
                    });
                }

                $(".changes-content .back-to-help a").bind(CLICK_EVENT, function(e){
                        e.preventDefault();
                        $this.closeShipping();
                        return false;
                });

            },

            /*-------------------------------*/

            appendShipping:function(template, type)
            {
                $(".help-layout").getNiceScroll().hide();
                $(".changes-content .shipping-info-popup-body").getNiceScroll().show();

                if (isAppendShipping != true){
                    $(".changes-content .changes-content-wrapper").append(template);
                    isAppendShipping = true;
                }

                $(".changes-content").css({"display":"block", height:$window.height()-149});
                $(".changes-content .shipping-info-popup-body").css({"display":"block", height:$window.height()-219});
                $(".changes-content-wrapper").css("display","block");

                $(".changes-content").animate({"opacity":"1"},{duration:550, complete:function(){
                     $(".changes-content-wrapper").animate({"opacity":"1"}, 550);
                }});

                if(isiPad){
                    // apply ipad nice-scroll margins
                    $(".changes-content .shipping-info-popup-body").niceScroll(
                        {cursorcolor:"#999", cursorwidth:"8px", 
                            railpadding:{top:0,right:0,left:26,bottom:0},
                            railoffset:{top:0,left:0} }
                    );
                }else{
                    // apply normal nice-scroll
                    $(".changes-content .shipping-info-popup-body").niceScroll(
                        {cursorcolor:"#999", cursorwidth:"8px", 
                            railpadding:{top:0,right:0,left:10,bottom:0},
                            railoffset:{top:0,left:83} }
                    );
                }
                 
                
            },

            /*-------------------------------*/

            closeShipping:function(template, type)
            {
                $(".changes-content-wrapper").animate({"opacity":"0"},{duration:550, complete:function(){
                    $(".changes-content").animate({"opacity":"0"},{duration:550, complete:function(){
                        $(".changes-content .shipping-info-popup-body").getNiceScroll().hide();
                        $(".help-layout").getNiceScroll().show();
                        $(".changes-content").css("display","none");
                        $(".changes-content-wrapper").css("display","none");
                    }});
                 }});
               
                
            },

            /*-------------------------------*/

            createScoll:function()
            {


                if (nice)
                {
                    nice.show();
                    nice.resize();
                    $(".help-layout").getNiceScroll().resize();
                }
                else
                {

                    nice = $(".help-layout").niceScroll({cursorcolor:"#999", cursorwidth:"8px", railpadding:{top:0,right:0,left:0,bottom:0},railoffset:{top:0,left:-15} });
                    nice.show();
                }

                $(".help-layout").niceScroll({cursorcolor:"#999", cursorwidth:"8px", railpadding:{top:0,right:0,left:0,bottom:0},railoffset:{top:0,left:-15} });

            },

            /*-------------------------------*/

            setInteractivityPolicies:function(){
                $(".help-layout .header-fixed a").unbind(CLICK_EVENT).bind(CLICK_EVENT, $this.gotoPoliciesTarget);
                nice.resize();
                //$(".help-layout").unbind("scroll", $this.renderPoliciesScroll).bind("scroll", $this.renderPoliciesScroll);
            },

            /*-------------------------------*/

            gotoPoliciesTarget:function(e){
                e.preventDefault();
                var index = $(".help-layout .header-fixed a").index(this);
                if( currentPoliciesIndex != index ){
                    $(".header-fixed li").removeClass("active");
                    $(".header-fixed li").eq(index).addClass("active");

                    $("#policies #pol_"+currentPoliciesIndex).animate( {opacity:0}, 
                        { duration:150, complete: function(){ $(this).css("display", "none") } } );
                    $("#policies #pol_"+index).css("display","block")
                    $("#policies #pol_"+index).delay(150).animate( {opacity:1}, {duration:350} );
                    $(".help-layout").delay(150).animate( {scrollTop:0}, {duration:350} );
                    currentPoliciesIndex = index;
                }
                
                $this.createScoll();

                return false;
                
            },

            /*-------------------------------*/

            renderPoliciesScroll:function(){
                
                if (isClicking==false)
                {
                    var i = 0;

                    $(".help-layout .region").each(function(index){
                        if ( ($(".help-layout").scrollTop() > ($(".help-layout .region").eq(index).offset().top - $(".help-layout .region").eq(0).offset().top))
                            && ($(".help-layout").scrollTop() <= (($(".help-layout .region").eq(index).offset().top - $(".help-layout .region").eq(0).offset().top + $(".help-layout .region").eq(index).height()))))
                        {
                            i = index;
                        }
                    });

                    if (i)
                    {
                        $(".header-fixed li").removeClass("active");
                        $(".header-fixed li").eq(i).addClass("active");
                    }

                }

            },

            /*-------------------------------*/

            setInteractivityHelp:function(){
                $(".help_menu a").unbind(CLICK_EVENT, $this.gotoHelpSection).bind(CLICK_EVENT, $this.gotoHelpSection);
                $(".block a.back-to-top-need-help").unbind(CLICK_EVENT).bind(CLICK_EVENT, $this.gotoTopHelp);
            },

            /*-------------------------------*/

            gotoTopHelp:function(e)
            {
                e.preventDefault();
               // alert(1);
                $(".help-layout").animate( {scrollTop:0}, {duration:250});

                return false;
            },


            /*-------------------------------*/

            gotoHelpSection:function(e)
            {
                //console.log("1")
                e.preventDefault();
                //console.log("2")
                var index = $(".help_menu a").index(this);
               
                //$(".help-layout").animate( {scrollTop:$("#need_help .block").eq(index).offset().top-$("#need_help .block").eq(0).offset().top + $("#need_help .block").eq(index).height()}, {duration:250});
                scrollTo = $("#need_help .block").eq(index).offset().top
                        -
                        $("#need_help .block").eq(index).offset().top 
                        + 
                        $("#need_help .block").eq(index).height();
                        //console.log(scrollTo)
                        scrollTo = $("#need_help .block").eq(index).offset().top-$("#need_help").offset().top
                $(".help-layout").animate( { scrollTop: scrollTo}, {duration:250});

                
                return false;
            },

            /*-------------------------------*/

            stop:function(data)
            {
                if (isActive)
                {
                    $footer.find(".policies").removeClass("selected");
                    $footer.find(".help span").removeClass("selected");

                    if (data)
                    {
                        if (data.keepOverlay)
                        {

                        }
                        else
                        {
                            bus.publish("satorisan", "menu-change-go", { dataRight:"" });
                        }
                    }

                    $window.unbind("resize", $this.resize);
                    $(".help-layout .header-fixed a").unbind(CLICK_EVENT, $this.gotoPoliciesTarget);
                    $(".help-layout").unbind("scroll", $this.renderPoliciesScroll);


                    $overlay.find(".help-layout .cont").animate( { opacity:0}, {duration:250, complete:function(){

                        $overlay.find(".help-layout-wrapper").animate( { height:0}, {easing:"easeInOutSine",duration:250, complete:function(){
                            
                                $overlay.find(".help-wrapper").remove();
                                user.MISCELANEA_WINDOW_OPEN = false;
                                bus.publish( 'satorisan', 'resume-page' );

                                if (data)
                                {
                                    if (data.keepOverlay)
                                    {
                                        currentType = "";
                                        if (data.complete) data.complete();    
                                    }
                                    else
                                    {
                                        bus.publish( 'satorisan', 'overlay-hide', {complete:function(){
                                            currentType = "";
                                            if (data.complete) data.complete();    
                                        }} );
                                    }

                                }
                                else
                                {
                                    currentType = "";
                                    bus.publish( 'satorisan', 'overlay-hide' );
                                }
                            
                        }} );    

                    }} );
                    isActive = false;

                    $(".help-layout").getNiceScroll().hide();
                    $(".changes-content .shipping-info-popup-body").getNiceScroll().hide();
                }
            }

        
        }
    
});


Hydra.module.register( 'page-404', function( bus ){ 
        
        var $this, $container, isActive=false, PAGE_BODY_SELECTOR="page404", pageNotFound;

        return {
            
            /*-------------------------------*/
            /* PAGE BRAND */
            /*-------------------------------*/            

            init: function(){
                $this = this;
                bus.subscribe('satorisan', this);
            },

            /*-------------------------------*/

            oEventsCallbacks: {

                'append-page' : function (data) {                    
                    if (isActive==false)
                    {
                        if (data.content == "404Page")
                        {
                             bus.publish("satorisan", "ganalytics-track-event",{name:"PAGE NOT FOUND"});
                            if ( CURRENT_LANGUAGE == "zh_cn" ) {
                            	textNotFound = "Oh my god, 您的步伐太超前了! <br />您访问的资源，我们没找到";
                                textNotFoundButton = "报告错误 ";
                            } else if ( CURRENT_LANGUAGE == "es" ) {
                                textNotFound = "Ooops, it seems you’ve walked too far! <br />The page you’re looking for cannot be found";
                                textNotFoundButton = "Please report any broken links to ";
                            } else if ( CURRENT_LANGUAGE == "en" ) {
                                textNotFound = "Ooops!, page not found";
                                textNotFoundButton = "Go to Home ";
                            }

                            isActive=true;
                            pageNotFound = "";
                            pageNotFound += "<div class='section-wrapper new-section " + PAGE_BODY_SELECTOR + "'>";
                                pageNotFound += "<div class='center clearfix'>";
                                    pageNotFound += "<div id='page-no-result'>"+ textNotFound +"</div>";
                                    pageNotFound += "<div id='page-no-result_img404'>404</div>";
                                pageNotFound += "</div>";
                                pageNotFound += "<div id='page-no-result-button'>"+ textNotFoundButton +"<a title='hello@satorisan.com' href='mailto:hello@satorisan.com'>hello@satorisan.com</a></div>";
                            pageNotFound += "</div>";
                            $content.append(pageNotFound);
                          
                            $container = $("." + PAGE_BODY_SELECTOR)
                            $this.create();

                        }
                    }
                },
                
                'transition-out' : function(data)
                {
                    if (isActive && data.type=="404Page")
                    {
                        isActive = false;
                        data.complete();
                    }
                },

               

                'destroy-page' : function()
                {
                    isActive = false;
                    $this.stop();
                }
            },

            /*-------------------------------*/

            create:function(){
                
                

                if (CURRENT_FLOOR == null)
                {
                    CURRENT_FLOOR = 1;
                    
                    if (user.HEADER_AND_FOOTER_CREATED == false)
                    {
                        Hydra.module.start("menu", 'menu_instance');
                        Hydra.module.start("footer", 'footer_instance'); 
                        user.HEADER_AND_FOOTER_CREATED = true;
                    }


                }
                else
                {
                    if (CURRENT_FLOOR == 0)
                    {
                        bus.publish( 'satorisan', 'transition-page', { type: "SLIDE_BOTTOM", complete:$this.startPreloading } );
                        CURRENT_FLOOR = 1;
                    }
                }

                $body.addClass(PAGE_BODY_SELECTOR);
                bus.publish( 'satorisan', 'menu-change' );
                
            },

            /*-------------------------------*/

            stop:function(){
                if (isActive)
                {
                    clearTimeout(timeoutLoading);
                    isActive = false;
                    if (iScrollObject)
                    {
                        iScrollObject.destroy();
                        iScrollObject = null;
                    }
                    
                    $(".type-blog").unbind(CLICK_EVENT, $this.blogClick);

                    $("#live-list-wrapper").unbind(MOUSE_DOWN_EVENT);
                    $("#live-list-wrapper").unbind(MOUSE_UP_EVENT);

                }

                $body.removeClass(PAGE_BODY_SELECTOR);
            }

        
        }
    
});


Hydra.module.register( 'stock-alert', function( bus ){ 
        
        var  $this,
        page_data,
        isActive=false, 
        overlayAnimation=true,
        id_size_product,
        product_name,
        selected_size,
        size_chart;

        return {
            
            /*-------------------------------*/
            /* out of stock */
            /*-------------------------------*/            

            init: function(){
                bus.subscribe('satorisan', this);
                $this = this;
            },
            
            /*-------------------------------*/

            clickShare:function(){
                
                if (isActive==false)
                {

                    
                }
                
            },

            /*-------------------------------*/

            oEventsCallbacks: {
                'append-page' : function (data) {                    
                    //alert("apeeds")
                    if (isActive==false && data.content == "stock-alert" )
                    {
                        $this.page_data = data

                        bus.publish("satorisan", "ganalytics-track-event",{
                                            name:"STOCK ALERT "+CURRENT_LANGUAGE.toUpperCase()});
                        bus.publish( 'satorisan', 'pause-page' );
                        
                        if (user.MISCELANEA_WINDOW_OPEN)
                        {
                            bus.publish("satorisan", "menu-change-go", { dataRight:"" });
                            bus.publish("satorisan", "destroy-miscelanea-page", {keepOverlay:true, complete:function(animation){
                                $this.create();   
                            }});
                        }
                        else
                        {
                            bus.publish("satorisan", "overlay-show", {complete:function(animation){
                                $this.create();   
                            }});   
                            
                        }
                    }
                },
                
                'destroy-miscelanea-page' : function(data)
                {
                    if (isActive)
                    {
                        $this.stop(data);
                    }
                },

                'destroy-popup' : function (data)
                {  
                    if (isActive)
                    {
                        $this.stop(); 
                    }
                }
            },

            /*-------------------------------*/

            create:function(){

                id_size_product = $this.page_data.id_size_product;
                product_name = $this.page_data.product_name;
                selected_size = $this.page_data.size;
                size_chart = $this.page_data.size_chart;
                
                stock_alert_push = DICTIONARY[CURRENT_LANGUAGE].stock_alert_push;
                stock_alert_push = stock_alert_push.replace( "%product_name%", product_name);
                stock_alert_push = stock_alert_push.replace( "%product_size%", selected_size);
                stock_alert_push = stock_alert_push.replace( "%size_chart%", size_chart);

                var MARKUP = "\
                <div class='stock-alert-wrapper clearfix'>\
                    <div class='stock-alert-layout-wrapper'>\
                        <div class='iconos close-stock-alert close-iframe'><span></span></div>\
                        <div class='stock-alert-layout'>\
                            <div class='stock-alert-title'>"+DICTIONARY[CURRENT_LANGUAGE].stock_alert_title+"</div>\
                            <div class='stock-alert-push'>"+stock_alert_push+"</div>\
                            <div class='stock-alert-form'>\
                                <input type='text' class='your-name' id='stock-alert-input-name' placeholder='"+DICTIONARY[CURRENT_LANGUAGE].stock_alert_name+"' >\
                                <input type='text' class='your-email' id='stock-alert-input-email' placeholder='"+DICTIONARY[CURRENT_LANGUAGE].stock_alert_email+"'>\
                                <button class='button' type='button' value='"+DICTIONARY[CURRENT_LANGUAGE].stock_alert_send+"' id='stock-alert-submit' >"+DICTIONARY[CURRENT_LANGUAGE].stock_alert_send+"</button>\
                                <div class='stock-loading-holder' ><div class='stock-loading' ><div><div>\
                            </div>\
                        </div>\
                        </div>\
                    </div>";

                $overlay.append (MARKUP);

                $("#stock-alert-submit").unbind(CLICK_EVENT).bind(CLICK_EVENT, $this.submitStockAlert);

                $overlay.find(".close-stock-alert").unbind(CLICK_EVENT, $this.destroy).bind(CLICK_EVENT, function(e){
                    $this.stop();
                    return false;
                });
                
                
                $overlay.find(".stock-alert-layout-wrapper").animate( { height:400}, {easing:"easeInOutSine",duration:250, complete:function(){
                     
                }} );
                    
                user.MISCELANEA_WINDOW_OPEN = true;                

                isActive = true;
               
                $(".general-background-overlay").unbind(CLICK_EVENT).bind(CLICK_EVENT, function(){
                    $this.stop();
                });

                $blocker.hide();
            },


            /*-------------------------------*/


            submitStockAlert:function(){

                // validate fields
                name_field = $("#stock-alert-input-name");
                email_field = $("#stock-alert-input-email");
                
                name_field.removeClass("validation-failed");
                email_field.removeClass("validation-failed");

                isValidEmail = $this.validateEmail(email_field.val());

                has_errors = false;
                if( name_field.val() == "" ){
                    name_field.addClass("validation-failed");
                    has_errors = true;
                }
                if( !$this.validateEmail( email_field.val() ) ){
                    email_field.addClass("validation-failed");
                    has_errors = true;
                }


                
                if( !has_errors ){
                    // show preloader
                    $(".stock-loading-holder .stock-loading").addClass("visible");
                    
                    // submit values  
                    $.ajax({
                        type: "POST",
                        data: { action: "add", productId: id_size_product, size: selected_size, 
                                    mail:email_field.val(), name:name_field.val() },
                        cache: false,
                        url: WEBSERVICES_PATH["stock-alert"],
                        contentType: "application/x-www-form-urlencoded;charset=UTF-8",
                        success: $this.submitStockAlertResponse
                    });  
                }
            },


            submitStockAlertResponse:function(data){
                // hide preloader
                $(".stock-loading-holder .stock-loading").removeClass("visible");

                // show message
                //console.log(data)
                $(".stock-alert-form").html("<div class='response'>"+DICTIONARY[CURRENT_LANGUAGE].stock_alert_success+"</div>");
            },


            validateEmail:function(mail)   
            {  
             if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(mail))  
              {  
                return (true)  
              }  
                return (false)  
            },


            /*-------------------------------*/


            stop:function(data)
            {               
                if (data)
                {
                    if (data.keepOverlay)
                    {

                    }
                    else
                    {
                        bus.publish("satorisan", "menu-change-go", { dataRight:"" });
                    }
                }
                $overlay.find(".stock-alert-layout-wrapper").animate( { height:0}, {easing:"easeInOutSine",duration:250, complete:function(){
                    
                        $overlay.find(".stock-alert-wrapper").remove();
                        bus.publish( 'satorisan', 'resume-page' );
                        user.MISCELANEA_WINDOW_OPEN = false;
                        isActive = false;
                        if (data)
                        {
                            if (data.complete) data.complete(false);
                        }
                        else
                        {
                            bus.publish( 'satorisan', 'overlay-hide' );
                        }
                    
                }} );   

            }

        
        }
    
});


var Interface;

(function($)
{
	Interface = function(){

		this.gotoURL = function(_url)
		{
			
            if( user.LAST_URL.indexOf(_url) == -1)
            {
            	globalBus.publish( 'satorisan', 'history-goto', { url: _url } );
            }
            else
            {
            	globalBus.publish("satorisan", "destroy-popup");
            }

		}

		this.destroyPopup = function(_url)
		{
            globalBus.publish( 'satorisan', 'destroy-popup' );

		}

		this.closePopUpButton = function()
		{
			globalBus.publish( 'satorisan', 'close-popup-button' );
		}

		this.openPopUpButton = function()
		{
			globalBus.publish( 'satorisan', 'open-popup-button' );
		}

		this.accountHideMenu = function()
		{
			globalBus.publish( 'satorisan', 'account-hide-menu' );
		}

		this.accountShowMenu = function()
		{
			globalBus.publish( 'satorisan', 'account-show-menu' );
		}
		this.ganalyticsTrackEvent = function(data)
		{
			globalBus.publish( 'satorisan', 'ganalytics-track-event', data );
		}

	}
})(jQuery)
var PageTitle;

(function($)
{
	PageTitle = function(){

		this.setTitle = function(_url)
		{
            //console.log(_url)
            title = "Live By The Walk";

            if( _url == "campaign" ){
            	if( CURRENT_LANGUAGE == "es" ){
            		title = "Campaña";
            	}else{
            		title = "Campaign";
            	}
            }

            if( _url == "shop" ){
            	if( CURRENT_LANGUAGE == "es" ){
            		title = "Shop";
            	}else{
            		title = "Shop";
            	}
            }

            if( _url == "stores" ){
            	if( CURRENT_LANGUAGE == "es" ){
            		title = "Tiendas";
            	}else{
            		title = "Stores";
            	}
            }

            if( _url == "tech" ){
            	if( CURRENT_LANGUAGE == "es" ){
            		title = "Tech";
            	}else{
            		title = "Tech";
            	}
            }

            if( _url == "satorisan-live" || _url.indexOf("satorisan-live/") != -1 ){
            	if( CURRENT_LANGUAGE == "es" ){
            		title = "Satorisan Live";
            	}else{
            		title = "Satorisan Live";
            	}
            }

            if( _url == "brand" ){
            	if( CURRENT_LANGUAGE == "es" ){
            		title = "The Brand";
            	}else{
            		title = "The Brand";
            	}
            }

            if( _url == "account" ){
            	if( CURRENT_LANGUAGE == "es" ){
            		title = "Mi Cuenta";
            	}else{
            		title = "My Account";
            	}
            }
            
            if( _url.indexOf("product/") != -1 ){
            	new_url = _url.split("/");
            	title = new_url[1];
            	title = title.substr(0,1).toUpperCase()+title.substr(1);
            	//str.substr(2,3) 
            }

            if( _url == "cart" ){
            	if( CURRENT_LANGUAGE == "es" ){
            		title = "Shopping Cart";
            	}else{
            		title = "Shopping Cart";
            	}
            }

            document.title = "Satorisan - "+title;
		}

	}
})(jQuery)
var PATH_NAME = location.pathname;
var globalBus;
Hydra.module.register( 'load', function( bus ){ 
        var CACHE = new Array();
        var currentType="";

        return {
            
            /*-------------------------------*/
            /* LOAD */
            /*-------------------------------*/            
            init: function(){
                globalBus = bus;
                bus.subscribe('satorisan', this);
                var isPopUp = false;

                var isCreated = false;

                setTimeout(function() {

                var sw = true;							// 是否切换语言
                PATH_NAME = location.pathname;
                $("#nav .cart").removeClass("open");
                $("#nav .account").removeClass("open");
                $("#nav .language").removeClass("open");
                
                var page = location.pathname == "/" ? "home.html" : location.pathname;
                PageTitle.setTitle(OPENSHOP_NAME);
                
                if (page.indexOf("home") !=-1 && currentType != "home") {
                    currentType = "home";
                    bus.publish( 'satorisan', 'destroy-page' );
                    bus.publish( 'satorisan', 'append-page', { content: "home" } );                    
                    bus.publish("satorisan", "menu-change-go", { data:currentType });
                } else if (page == "shop" && currentType != "shop") {
                    currentType = "shop";
                    bus.publish( 'satorisan', 'destroy-page' );
                    bus.publish( 'satorisan', 'append-page', { content: "products-list" } );                    
                    bus.publish("satorisan", "menu-change-go", { data:currentType });
                } else if (PATH_NAME.indexOf("product/") !=-1 && currentType != "detail") {
                    currentType = "detail";
                    bus.publish( 'satorisan', 'destroy-page' );
                    bus.publish( 'satorisan', 'append-page', { content: "product-detail" } ); 
                    bus.publish("satorisan", "menu-change-go", { data:currentType });
                } else if (PATH_NAME.indexOf("cart") !=-1) {
                    isPopUp = true;
                    $("#nav .cart").addClass("open");
                    bus.publish( 'satorisan', 'append-page', { content: "popup", bodyClass:"cart", url:user.SHIPPING_REGION+"/checkout/cart" } );   
                    bus.publish("satorisan", "menu-change-go", { dataRight:"cart" });
                } else if (PATH_NAME.indexOf("account") !=-1) {
                    isPopUp = true;
                    $("#nav .account").addClass("open");
                    bus.publish( 'satorisan', 'append-page', { content: "popup", bodyClass:"account", url: +"member/i.jhtml" } );   
                    bus.publish("satorisan", "menu-change-go", { dataRight:"account" });
                } else if (PATH_NAME.indexOf("satori-heart-ss14") !=-1) {
                    currentType = "satori-heart-ss14";
                    bus.publish( 'satorisan', 'destroy-page' );
                    bus.publish( 'satorisan', 'append-page', { content: "satori-heart-ss14" } );
                    bus.publish("satorisan", "menu-change-go", { data:currentType });
                } else if (PATH_NAME.indexOf("campaign-ss14") !=-1) {
                    currentType = "campaign-ss14";
                    bus.publish( 'satorisan', 'destroy-page' );
                    bus.publish( 'satorisan', 'append-page', { content: "campaign-ss14" } );                    
                    bus.publish("satorisan", "menu-change-go", { data:currentType });
                } else if (PATH_NAME.indexOf("campaign-fw13") !=-1) {
                    currentType = "campaign-fw13";
                    bus.publish( 'satorisan', 'destroy-page' );
                    bus.publish( 'satorisan', 'append-page', { content: "campaign-fw13" } );                    
                    bus.publish("satorisan", "menu-change-go", { data:currentType });
                } else if (PATH_NAME.indexOf("campaign-ss13") !=-1) {
                    currentType = "campaign-ss13";
                    bus.publish( 'satorisan', 'destroy-page' );
                    bus.publish( 'satorisan', 'append-page', { content: "campaign-ss13" } );                    
                    bus.publish("satorisan", "menu-change-go", { data:currentType });
                } else if (PATH_NAME.indexOf("satorisan-live") !=-1) {
                    currentType = "live";
                    bus.publish( 'satorisan', 'destroy-page' );
                    bus.publish( 'satorisan', 'append-page', { content: "live" } );                    
                    bus.publish("satorisan", "menu-change-go", { data:currentType });
                } else if (PATH_NAME.indexOf("payment-success") !=-1) {
                    url_params = getURLParameters();
                    if( url_params.store == "international/" ||
                        url_params.store == "spain/" ||
                        url_params.store == "europe/" ){
                        store_param = url_params.store;
                    }else{
                        store_param = "";
                    }
                    isPopUp = true;
                    currentType = "payment-success"
                    $("#nav .account").addClass("open");
                    bus.publish( 'satorisan', 'append-page', { content: "popup", bodyClass:"account", url:store_param+"checkout/onepage/success" } );   
                    bus.publish("satorisan", "menu-change-go", { dataRight:"account" });
                } else if (PATH_NAME.indexOf("tech") !=-1) {
                    currentType = "tech";
                    bus.publish( 'satorisan', 'destroy-page' );
                    bus.publish( 'satorisan', 'append-page', { content: "tech" } );                    
                    bus.publish("satorisan", "menu-change-go", { data:currentType });
                } else if (PATH_NAME.indexOf("stores") !=-1) {
                    currentType = "stores";
                    bus.publish( 'satorisan', 'destroy-page' );
                    bus.publish( 'satorisan', 'append-page', { content: "stores" } );                    
                    bus.publish("satorisan", "menu-change-go", { data:currentType });
                } else if (PATH_NAME.indexOf("brand") !=-1) {
                    currentType = "brand";
                    bus.publish( 'satorisan', 'destroy-page' );
                    bus.publish( 'satorisan', 'append-page', { content: "brand" } );                    
                    bus.publish("satorisan", "menu-change-go", { data:currentType });
                } else if (PATH_NAME.indexOf("reset-password") !=-1) {
                    isPopUp = true;
                    $("#nav .cart").addClass("open");
                    bus.publish( 'satorisan', 'append-page', { content: "popup", noSessionString:true, bodyClass:"account", url:user.SHIPPING_REGION + "/customer/account/resetpassword/" + location.search } );   
                    bus.publish("satorisan", "menu-change-go", { dataRight:"account" });
                } else if (PATH_NAME.indexOf("live-by-the-walk") !=-1){
                    currentType = "live-by-the-walk";
                    bus.publish( 'satorisan', 'destroy-page' );
                    bus.publish( 'satorisan', 'append-page', { content: "live-by-the-walk" } );                    
                    bus.publish("satorisan", "menu-change-go", { data:currentType });
                } else {
                	currentType = "404Page"
                    bus.publish( 'satorisan', 'append-page', { content: "404Page" } ); 
                }

            },350);
            },
            
            /*-------------------------------*/

            oEventsCallbacks: {
                'load-page' : function (data) {
                    this.load(data);
                }
            },

            /*-------------------------------*/

            load: function(data){
                var isPopUp = false;
                
                $("#nav .cart").removeClass("open");
                $("#nav .account").removeClass("open");
                
                PageTitle.setTitle(OPENSHOP_NAME);
                
                if ( data.url == "/shop" || data.url == "/shop#benirras" )
                {
                    
                    if (currentType != "shop")
                    {
                        
                        if (currentType == "home") 
                        {
                            
                            currentType = "shop";
                            bus.publish("satorisan", "menu-change-go", { data:currentType });
                            bus.publish( 'satorisan', 'destroy-page' );
                            bus.publish( 'satorisan', 'append-page', { content: "products-list" } );                        
                        }
                        else
                        {
                            
                            $blocker.show();
                            bus.publish("satorisan", "menu-change-go", { data:"products-list" });
                            user.IS_IN_TRANSITION = true;
                            bus.publish( 'satorisan', 'transition-out', {type:currentType, complete:function(){
                                if (currentType != "shop")
                                {
                                    $(".section-wrapper").eq(0).remove();

                                        currentType = "shop";                                                    
                                        bus.publish( 'satorisan', 'append-page', { content: "products-list" } );
                                        //user.IS_IN_TRANSITION = false;
                                }
                            }} );
                        }
                    }
                    else
                    {
                       
                        isPopUp = false;
                        currentType = "shop";
                        bus.publish( 'satorisan', 'revive-page' );
                    }
                    
                }
                else
                {
                    if (data.url.indexOf("/product/") !=-1)
                    {

                        if (currentType == "home") 
                        {
                            
                            currentType = "detail";
                            bus.publish("satorisan", "menu-change-go", { data:currentType });
                            bus.publish( 'satorisan', 'destroy-page' );
                            bus.publish( 'satorisan', 'append-page', { content: "product-detail" } );                        

                        }
                        else
                        {
                            $blocker.show();
                            user.IS_IN_TRANSITION = true;
                            bus.publish( 'satorisan', 'transition-out', {type:currentType, complete:function(){
                                if (currentType!="detail") $(".section-wrapper").eq(0).remove();
   
                                currentType = "detail";
                                bus.publish("satorisan", "menu-change-go", { data:currentType });
                                bus.publish( 'satorisan', 'append-page', { content: "product-detail" } );
                                //user.IS_IN_TRANSITION = false;
      
                            }} );
                        }
                    }
                    else
                    {
                        if (data.url.indexOf("/home") !=-1)
                        {
                            if (currentType!="home")
                            {
                                bus.publish("satorisan", "menu-change-go", { data:"home" });
                                user.IS_IN_TRANSITION = true;
                                bus.publish( 'satorisan', 'transition-out', {type:currentType, complete:function(){
                                    currentType = "home";
                                    bus.publish( 'satorisan', 'append-page', { content: "home" } );     
                                    //user.IS_IN_TRANSITION = false;
                                }} );
                                
                            }
                            else
                            {
                                bus.publish( 'satorisan', 'revive-page' );
                            }
                        }   
                        else
                        {
                            if (data.url.indexOf("/cart") !=-1)
                            {
                                isPopUp = true;
                                $("#nav .cart").addClass("open");
                                bus.publish("satorisan", "menu-change-go", { dataRight:"cart" });
                                //bus.publish( 'satorisan', 'preloader-show' );
                                bus.publish( 'satorisan', 'append-page', { content: "popup", bodyClass:"cart", url:""+user.SHIPPING_REGION+"/checkout/cart" } ); 
                            }
                            else
                            {
                                if (data.url.indexOf("/account") !=-1)
                                {
                                    isPopUp = true;
                                    bus.publish("satorisan", "menu-change-go", { dataRight:"account" });
                                    $("#nav .account").addClass("open");
                                    bus.publish( 'satorisan', 'append-page', { content: "popup", bodyClass:"account",  bodyClass:"account",url: "member/i.jhtml" } ); 
                                }
                                else
                                {
                                    if (data.url.indexOf("/satori-heart-ss14") != -1)
                                    {
                                        if (currentType != "satori-heart-ss14")
                                        {
                                            if (currentType == "home") 
                                            {
                                                currentType = "satori-heart-ss14";
                                                bus.publish("satorisan", "menu-change-go", { data: currentType });
                                                bus.publish( 'satorisan', 'destroy-page' );
                                                bus.publish( 'satorisan', 'append-page', { content: "satori-heart-ss14" } );
                                            }
                                            else
                                            {                                            
                                                $blocker.show();
                                                bus.publish("satorisan", "menu-change-go", { data:"satori-heart-ss14" });
                                                user.IS_IN_TRANSITION = true;
                                                bus.publish( 'satorisan', 'transition-out', {type:currentType, complete:function()
                                                {
                                                    $(".section-wrapper").eq(0).remove();
                                                    currentType = "satori-heart-ss14";
                                                    bus.publish( 'satorisan', 'append-page', { content: "satori-heart-ss14" } );
                                                    //user.IS_IN_TRANSITION = false;
                                                    //$blocker.hide();
                                                }} );
                                            }
                                        }
                                        else
                                        {
                                            bus.publish( 'satorisan', 'revive-page' );
                                        }
                                    }
                                    else if (data.url.indexOf("/campaign-ss14") != -1)
                                    {
                                        if (currentType != "campaign-ss14")
                                        {
                                            if (currentType == "home") 
                                            {
                                                
                                                currentType = "campaign-ss14";
                                                bus.publish("satorisan", "menu-change-go", { data:currentType });
                                                bus.publish( 'satorisan', 'destroy-page' );
                                                bus.publish( 'satorisan', 'append-page', { content: "campaign-ss14" } );                        
                                            }
                                            else
                                            {                                            
                                                $blocker.show();
                                                bus.publish("satorisan", "menu-change-go", { data:"campaign-ss14" });
                                                user.IS_IN_TRANSITION = true;
                                                bus.publish( 'satorisan', 'transition-out', {type:currentType, complete:function(){
                                                    $(".section-wrapper").eq(0).remove();
                                                    currentType = "campaign-ss14";
                                                    bus.publish( 'satorisan', 'append-page', { content: "campaign-ss14" } );
                                                    //user.IS_IN_TRANSITION = false;
                                                    //$blocker.hide();
                                                }} );
                                            }
                                        }
                                        else
                                        {
                                            bus.publish( 'satorisan', 'revive-page' );
                                        }
                                    }
                                    else if (data.url.indexOf("/campaign-fw13") !=-1)
                                    {
                                        if (currentType != "campaign-fw13")
                                        {
                                            if (currentType == "home") 
                                            {
                                                
                                                currentType = "campaign-fw13";
                                                bus.publish("satorisan", "menu-change-go", { data:currentType });
                                                bus.publish( 'satorisan', 'destroy-page' );
                                                bus.publish( 'satorisan', 'append-page', { content: "campaign-fw13" } );                        
                                            }
                                            else
                                            {                                            
                                                $blocker.show();
                                                bus.publish("satorisan", "menu-change-go", { data:"campaign-fw13" });
                                                user.IS_IN_TRANSITION = true;
                                                bus.publish( 'satorisan', 'transition-out', {type:currentType, complete:function(){
                                                    $(".section-wrapper").eq(0).remove();
                                                    currentType = "campaign-fw13";
                                                    bus.publish( 'satorisan', 'append-page', { content: "campaign-fw13" } );
                                                    //user.IS_IN_TRANSITION = false;
                                                    //$blocker.hide();
                                                }} );
                                            }
                                        }
                                        else
                                        {
                                            bus.publish( 'satorisan', 'revive-page' );
                                        }

                                    }
                                    else
                                    {
                                         if (data.url.indexOf("/campaign-ss13") !=-1)
                                        {
                                            if (currentType != "campaign-ss13")
                                            {
                                                if (currentType == "home") 
                                                {
                                                    
                                                    currentType = "campaign-ss13";
                                                    bus.publish("satorisan", "menu-change-go", { data:currentType });
                                                    bus.publish( 'satorisan', 'destroy-page' );
                                                    bus.publish( 'satorisan', 'append-page', { content: "campaign-ss13" } );                        
                                                }
                                                else
                                                {                                            
                                                    $blocker.show();
                                                    bus.publish("satorisan", "menu-change-go", { data:"campaign-ss13" });
                                                    user.IS_IN_TRANSITION = true;
                                                    bus.publish( 'satorisan', 'transition-out', {type:currentType, complete:function(){
                                                        $(".section-wrapper").eq(0).remove();
                                                        currentType = "campaign-ss13";
                                                        bus.publish( 'satorisan', 'append-page', { content: "campaign-ss13" } );
                                                        //user.IS_IN_TRANSITION = false;
                                                        //$blocker.hide();
                                                    }} );
                                                }
                                            }
                                            else
                                            {
                                                bus.publish( 'satorisan', 'revive-page' );
                                            }

                                        }
                                        else
                                        {

                                            if (data.url.indexOf("/satorisan-live") !=-1)
                                            {
                                                if (currentType != "live")
                                                {
                                                    if (currentType == "home") 
                                                    {
                                                        currentType = "live";
                                                        bus.publish("satorisan", "menu-change-go", { data:currentType });
                                                        bus.publish( 'satorisan', 'destroy-page' );
                                                        bus.publish( 'satorisan', 'append-page', { content: "live" } );                        
                                                    }
                                                    else
                                                    {                                            
                                                        $blocker.show();
                                                        bus.publish("satorisan", "menu-change-go", { data:"live" });
                                                        user.IS_IN_TRANSITION = true;
                                                        bus.publish( 'satorisan', 'transition-out', {type:currentType, complete:function(){
                                                            $(".section-wrapper").eq(0).remove();
                                                            currentType = "live";
                                                            bus.publish( 'satorisan', 'append-page', { content: "live" } );
                                                            //user.IS_IN_TRANSITION = false;
                                                            //$blocker.hide();
                                                        }} );
                                                    }
                                                }else{
                                                    isPopUp = true;
                                                    bus.publish( 'satorisan', 'revive-page' );
                                                }

                                            }
                                            else
                                            {

                                                
                                                if (data.url.indexOf("payment-success") !=-1)
                                                {
                                                    if (currentType != "payment-success")
                                                    {
                                                        url_params = getURLParameters();
                                                        if( url_params.store == "international/" ||
                                                            url_params.store == "spain/" ||
                                                            url_params.store == "europe/" ){
                                                            store_param = url_params.store;
                                                        }else{
                                                            store_param = "";
                                                        }
                                                        isPopUp = true;
                                                        bus.publish("satorisan", "menu-change-go", { dataRight:"account" });
                                                        $("#nav .account").addClass("open");
                                                        bus.publish( 'satorisan', 'append-page', { content: "popup", bodyClass:"account",  bodyClass:"account",url:store_param+"checkout/onepage/success" } ); 
                                                    }

                                                }
                                                else
                                                {
                                                    
                                                    if (data.url.indexOf("tech") !=-1)
                                                    {
                                                        if (currentType != "tech")
                                                        {
                                                            if (currentType == "home") 
                                                            {
                                                                
                                                                currentType = "tech";
                                                                bus.publish("satorisan", "menu-change-go", { data:currentType });
                                                                bus.publish( 'satorisan', 'destroy-page' );
                                                                bus.publish( 'satorisan', 'append-page', { content: "tech" } );                        
                                                            }
                                                            else
                                                            {                                            
                                                                $blocker.show();
                                                                bus.publish("satorisan", "menu-change-go", { data:"tech" });
                                                                user.IS_IN_TRANSITION = true;
                                                                bus.publish( 'satorisan', 'transition-out', {type:currentType, complete:function(){
                                                                    $(".section-wrapper").eq(0).remove();
                                                                    currentType = "tech";
                                                                    bus.publish( 'satorisan', 'append-page', { content: "tech" } );
                                                                    //user.IS_IN_TRANSITION = false;
                                                                    //$blocker.hide();
                                                                }} );
                                                            }
                                                        }
                                                        else
                                                        {
                                                            bus.publish( 'satorisan', 'revive-page' );
                                                        }
                                                    }
                                                    else
                                                    {
                                                        if (data.url.indexOf("stores") !=-1)
                                                        {
                                                            if (currentType != "stores")
                                                            {
                                                                if (currentType == "home") 
                                                                {
                                                                    
                                                                    currentType = "stores";
                                                                    bus.publish("satorisan", "menu-change-go", { data:currentType });
                                                                    bus.publish( 'satorisan', 'destroy-page' );
                                                                    bus.publish( 'satorisan', 'append-page', { content: "stores" } );                        
                                                                }
                                                                else
                                                                {                                            
                                                                    $blocker.show();
                                                                    bus.publish("satorisan", "menu-change-go", { data:"stores" });
                                                                    user.IS_IN_TRANSITION = true;
                                                                    bus.publish( 'satorisan', 'transition-out', {type:currentType, complete:function(){
                                                                        $(".section-wrapper").eq(0).remove();
                                                                        currentType = "stores";
                                                                        bus.publish( 'satorisan', 'append-page', { content: "stores" } );
                                                                        //user.IS_IN_TRANSITION = false;
                                                                        //$blocker.hide();
                                                                    }} );
                                                                }
                                                            }
                                                            else
                                                            {
                                                                bus.publish( 'satorisan', 'revive-page' );
                                                            }
                                                        }
                                                        else
                                                        {
                                                            if (data.url.indexOf("brand") !=-1)
                                                            {
                                                                if (currentType != "brand")
                                                                {
                                                                    if (currentType == "home") 
                                                                    {
                                                                        currentType = "brand";
                                                                        bus.publish("satorisan", "menu-change-go", { data:currentType });
                                                                        bus.publish( 'satorisan', 'destroy-page' );
                                                                        bus.publish( 'satorisan', 'append-page', { content: "brand" } );                        
                                                                    }
                                                                    else
                                                                    {                                            
                                                                        
                                                                        $blocker.show();
                                                                        bus.publish("satorisan", "menu-change-go", { data:"brand" });
                                                                        user.IS_IN_TRANSITION = true;
                                                                        bus.publish( 'satorisan', 'transition-out', {type:currentType, complete:function(){
                                                                            
                                                                            $(".section-wrapper").eq(0).remove();
                                                                            currentType = "brand";
                                                                            bus.publish( 'satorisan', 'append-page', { content: "brand" } );
                                                                            //user.IS_IN_TRANSITION = false;
                                                                            //$blocker.hide();
                                                                        }} );
                                                                    }
                                                                }
                                                                else
                                                                {
                                                                    bus.publish( 'satorisan', 'revive-page' );
                                                                }
                                                            }
                                                            else
                                                            {
                                                                
                                                                if (data.url.indexOf("live-by-the-walk") !=-1)
                                                                {
                                                                    
                                                                    if (currentType != "live-by-the-walk")
                                                                    {
                                                                        
                                                                        if (currentType == "home") 
                                                                        {
                                                                            currentType = "live-by-the-walk";
                                                                            bus.publish("satorisan", "menu-change-go", { data:currentType });
                                                                            bus.publish( 'satorisan', 'destroy-page' );
                                                                            bus.publish( 'satorisan', 'append-page', { content: "live-by-the-walk" } );                        
                                                                        }
                                                                        else
                                                                        {                                            
                                                                            $blocker.show();
                                                                            bus.publish("satorisan", "menu-change-go", { data:"live-by-the-walk" });
                                                                            user.IS_IN_TRANSITION = true;
                                                                            bus.publish( 'satorisan', 'transition-out', {type:currentType, complete:function(){
                                                                                $(".section-wrapper").eq(0).remove();
                                                                                currentType = "live-by-the-walk";
                                                                                bus.publish( 'satorisan', 'append-page', { content: currentType } );
                                                                                //user.IS_IN_TRANSITION = false;
                                                                                //$blocker.hide();
                                                                            }} );
                                                                        }
                                                                    }
                                                                    else
                                                                    {
                                                                        bus.publish( 'satorisan', 'revive-page' );
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }

                                                    
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }    
                    }                                    
                }

                if (isPopUp == false)
                {
                    bus.publish("satorisan", "destroy-popup");
                    bus.publish("satorisan", "overlay-hide");
                    $("#nav .account").removeClass("open");
                    $("#nav .cart").removeClass("open");
                    $body.removeClass("cart");
                    $body.removeClass("account");
                    bus.publish("satorisan", "menu-change");
                }

                user.LAST_CAMPAIGN_DAY = -1;
            }

            /*-------------------------------*/

        
        }
    
});


var current_path = "";

Hydra.module.register( 'history', function( bus ){ 
        
        var $this,isFirst = true;

        return {
            
            /*-------------------------------*/
            /* HISTORY */
            /*-------------------------------*/            

            init: function(){
                $this = this;
                bus.subscribe('satorisan', this);
                $this.update();
                if (Modernizr.hashchange && Modernizr.history) this.configure();                
            },
            
            /*-------------------------------*/

            configure: function()
            {
                window.addEventListener('popstate', $this.urlChangeHandler);
                this.update();
            },

            /*-------------------------------*/

            oEventsCallbacks: {
                'history-update' : function () {
                    $this.update();
                },
                'history-goto' : function (data) {
                    //console.log(data);
                    $this.goTo(data);
                },
                'history-check-callback' : function()
                {
                    $this.checkCallback();
                }
            },
            
            /*-------------------------------*/

            checkCallback:function()
            {
                if (user.NEXT_SECTION_TO_LOAD!="")
                {
                    bus.publish( 'satorisan', 'url-changed'  );
                        
                    var pathname = user.NEXT_SECTION_TO_LOAD;

                    user.NEXT_SECTION_TO_LOAD = "";

                    if ( pathname != INIT_FOLDER )
                    {                        
                        for ( var i=0; i<LANGUAGES.length; i++)
                        {
                            pathname = String(pathname).replace("/"+LANGUAGES[i]+"/", "");
                        }
                        current_path =  pathname;
                        
                        bus.publish( 'satorisan', 'load-page', { url: "/"+pathname } );
                    }
                }
            },

            /*-------------------------------*/

            urlChangeHandler: function()
            {
                //console.log("URL CHANGED");
                if (isFirst && 1==2)
                {
                    console.log("URL CHANGED>0");
                    isFirst = false;
                }
                else
                {
                    //console.log("URL CHANGED>1");
                    if (user.IS_IN_TRANSITION == false)
                    {
                        //console.log("URL CHANGED>2");    
                        bus.publish( 'satorisan', 'url-changed'  );
                        
                        var pathname = location.pathname;
                        //console.log("pathname>"+pathname);
                        //console.log("INIT_FOLDER>"+INIT_FOLDER);
                        if ( pathname != INIT_FOLDER )
                        {                        
                            
                            for ( var i=0; i<LANGUAGES.length; i++)
                            {
                                pathname = String(pathname).replace("/"+LANGUAGES[i]+"/", "");
                            }
                            
                            current_path =  pathname;

                            bus.publish( 'satorisan', 'load-page', { url: "/"+pathname } );
                        }
                    }
                    else
                    {
                       // console.log("URL CHANGED>3");    
                        user.NEXT_SECTION_TO_LOAD = location.pathname;
                    }
                }

            },

            /*-------------------------------*/

            update: function(){                
                $body.find("a").not(".normal-link").not(".selectboxit-option-anchor").unbind("click").bind("click", $this.gotoLink);
                $body.find("a.inactive").unbind("click").bind("click", function(e){e.preventDefault();return false;});

            },

            /*-------------------------------*/

            gotoLink: function(e)
            {                
                // fix for homepage images links to open in _blank
                if( $(e.currentTarget).hasClass("see-collection") 
                            && $(e.currentTarget).hasClass("home-item-button")
                             && $(e.currentTarget).attr("target") == "_blank" ){
                    return;
                }

                if (e.button == 0)
				{
					
                    
                    e.preventDefault();

					if (current_path != CURRENT_LANGUAGE + $(this).attr("href"))
					{
						user.LAST_URL = document.location.pathname;
						current_path = CURRENT_LANGUAGE +$(this).attr("href");

					   
						if (Modernizr.history)
						{
							history.pushState("", 'New Satorisan URL: ' + INIT_FOLDER + current_path, INIT_FOLDER + current_path);
							bus.publish( 'satorisan', 'load-page', { url: $(this).attr("href") } );
						}
						else
						{
							document.location = INIT_FOLDER + current_path;
						}

					}

					
					return false;
				}
				else if (e.button == 1)
				{
					e.preventDefault();
					
					var url = INIT_FOLDER + CURRENT_LANGUAGE +$(this).attr("href");
					window.open(url,'_blank');
				}
            },
            
            /*-------------------------------*/

            goTo: function(data)
            {
                
                if (current_path != CURRENT_LANGUAGE + data.url)
                {
                    current_path = CURRENT_LANGUAGE + data.url;
                    if (Modernizr.history)
                    {
                        history.pushState("", 'New Satorisan URL: ' + INIT_FOLDER + current_path, INIT_FOLDER + current_path);
                        
                        if (data.dontProccessLoad)
                        {

                        }
                        else
                        {
                            
                            bus.publish( 'satorisan', 'load-page', { url: data.url } );
                        }
                    }
                    else
                    {
                        document.location = INIT_FOLDER + current_path;
                    }
                }

            }

            /*-------------------------------*/

        
        }
    
});



var Environment;
var MOUSE_DOWN = "mousedown";
var CLICK_EVENT = "click";
var MOUSE_UP_EVENT = "mouseup";
var MOUSE_DOWN_EVENT = "mousedown";
var MOUSE_ENTER = "mouseenter";
var MOUSE_LEAVE = "mouseleave";
var MOUSE_MOVE = "mousemove";
var CURRENT_FLOOR = null;
var TRANSITION_END_EVENT = "transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd";

var IS_TABLET = navigator.userAgent.match(/iPad/i) != null;

(function($)
{
	
	/*------------------------------*/
	
	Environment = function(){
		
		if (Modernizr.touch)
		{
			CLICK_EVENT = "mousedown";
		}

	}

	/*------------------------------*/



})
(jQuery)

var Session;

(function($)
{
	Session = function(){
		
		this.LAST_URL = "";

		this.SIZE_SYSTEM = "EUR";
		this.SIZE = 0;
		this.COLLECTION = "";
		this.TYPE_PRODUCT = "FOOTWEAR";
		this.COLOR = "";
		this.PRICE_RATE_MIN = 0;
		this.PRICE_RATE_MAX = 0;

		this.SIZE_TOOLTIP_SHOWED = false;
		this.SIZE_SMALL_SHOWED = false;				
		this.COLOR_TOOLTIP_SHOWED = false;
		this.QUANTITY_TOOLTIP_SHOWED = false;
		this.PRICE_TOOLTIP_SHOWED = false;

		this.DETAIL_QUANTITY = 0;
		this.DETAIL_SIZE = 0;

		this.HEADER_AND_FOOTER_CREATED = false;

		this.SHIPPING_CODE = "ES";
		this.SHIPPING_REGION = "spain";
		this.SHIPPING_NAME = "España (Península y Baleares) y Portugal";

		this.COME_FROM_CAMPAIGN_DAY = -1;
		this.COME_FROM_CAMPAIGN_HOTSPOT = -1;

		this.LAST_CAMPAIGN_DAY = -1;

		this.MISCELANEA_WINDOW_OPEN = false;

		this.IS_IN_SIZE_FILTER = false;

		this.COME_FROM_DETAIL = false;

		this.IS_IN_TRANSITION = false;
		this.NEXT_SECTION_TO_LOAD = "";

		this.PRODUCT_CLICK="";



		if (CURRENT_LANGUAGE == "en")
		{
			this.COLLECTION = "NEW COLLECTION";
		}
		else
		{
			this.COLLECTION = "COLECCIÓN NUEVA";
		}

		if ($.cookie("SHIPPING_REGION"))
		{
			this.SHIPPING_REGION = $.cookie("SHIPPING_REGION");
		}
		/*else
		{
			$.cookie("SHIPPING_REGION", this.SHIPPING_REGION, {domain:OPENSHOP_DOMAIN, path:"/"});
		}*/

		$("body").removeClass("store-international");
		$("body").removeClass("store-spain");
		$("body").removeClass("store-europe");
		$("body").addClass("store-" + this.SHIPPING_REGION);


		if ($.cookie("SHIPPING_CODE"))
		{
			this.SHIPPING_CODE = $.cookie("SHIPPING_CODE");
		}
		/*else
		{
			$.cookie("SHIPPING_CODE", this.SHIPPING_CODE, {domain:OPENSHOP_DOMAIN, path:"/"});
		}*/

		if ($.cookie("SHIPPING_NAME"))
		{
			this.SHIPPING_NAME = $.cookie("SHIPPING_NAME");
		}
		/*else
		{
			$.cookie("SHIPPING_NAME", this.SHIPPING_NAME, {domain:OPENSHOP_DOMAIN, path:"/"})
		}*/

		/**********************************/

		this.updateLogin = function(status, region)
		{

			if (status == 1)
			{
				$("#header .right-section a.account").addClass("login");
			}
			else
			{
				$("#header .right-section a.account").removeClass("login");
			}

			if (region)
			{
				$("body").removeClass("store-international");
				$("body").removeClass("store-spain");
				$("body").removeClass("store-europe");
				$("body").addClass("store-" + region);
			}

			globalBus.publish("satorisan", "history-update");
		}

		/**********************************/
		
		this.updateCart = function(CART_QUANTITY)
		{

			var $cart = $("header .right-section .option-0 a");
            $cart.html(CART_QUANTITY);
            $cart.addClass("active");
            $cart.removeClass("inactive");
            if (CART_QUANTITY==0)
            {
              $cart.removeClass("active");
              $cart.addClass("inactive");
            }

            globalBus.publish("satorisan", "history-update");
		}


		/**********************************/

	}

})
(jQuery)
Hydra.module.register( 'responsive', function( bus ){ 

    var $this;

    return {
            
            /*-------------------------------*/

            init: function(){

                $this = this; 
                
                if ($.browser.msie==undefined)
                {
                    
                    // IPAD
                    enquire.register("only screen and (orientation:portrait) and (min-device-width:768px) and (max-device-width:1024px)", {
                        match : function() {
                           if (Modernizr.touch) $this.dispatch('tablet-portrait');
                        }
                     }).listen();
                    
                    enquire.register("only screen and (orientation:landscape) and (min-device-width:768px) and (max-device-width:1024px)", {
                        match : function() {
                            if (Modernizr.touch) $this.dispatch('tablet-landscape');
                        }
                     }).listen();
                    
                    // GALAXY
                    enquire.register("only screen and (orientation:portrait) and (min-device-width:1280px) and (max-device-width:800px)", {
                        match : function() {
                           if (Modernizr.touch) $this.dispatch('tablet-portrait');
                        }
                     }).listen();
                    
                    enquire.register("only screen and (orientation:landscape) and (min-device-width:800px) and (max-device-width:1280px)", {
                        match : function() {
                            if (Modernizr.touch) $this.dispatch('tablet-landscape');
                        }
                     }).listen();
                    
                    // PLAYBOOK
                    enquire.register("only screen and (orientation:portrait) and (min-device-width:1024px) and (max-device-width:600px)", {
                        match : function() {
                           if (Modernizr.touch) $this.dispatch('tablet-portrait');
                        }
                     }).listen();

                    enquire.register("only screen and (orientation:landscape) and (min-device-width:600px) and (max-device-width:1204px)", {
                        match : function() {
                            if (Modernizr.touch) $this.dispatch('tablet-landscape');
                        }
                     }).listen();
                }

            },

            /*-------------------------------*/

            dispatch:function(type){
                bus.publish( 'satorisan', type );
            }

            /*-------------------------------*/

        
        }
    
});


Hydra.module.register( 'transition', function( bus ){ 
        
        /*-------------------------------*/
        /* TRANSITION */
        /*-------------------------------*/

        var $this, $new, $last, completeCallback;

        return {
            
            init: function(){
                $this = this;
                bus.subscribe('satorisan', this);
            },
			

            /*-------------------------------*/

            oEventsCallbacks: {
                'transition-page' : function (data) {
                    $this.doTransition(data);
                }
            },

            /*-------------------------------*/

            doTransition: function(data){
                completeCallback = data.complete;
                if ($body.find(".section-wrapper").length == 2)
                {
                    
                    $last = $body.find(".section-wrapper").eq(0);
                    $new = $body.find(".section-wrapper").eq(1);                
                    
                    $new.attr("id", "newsection");
                    $last.attr("id", "lastsection");

                    switch(data.type)
                    {
                        case "SLIDE_RIGHT":
                          this.slideRight();
                          break;       

                        case "SLIDE_TOP":
                          this.slideTop();
                          break;       

                        case "SLIDE_BOTTOM":
                          this.slideBottom();
                          break;       

                        case "OPACITY":
                          this.opacity();
                          break;         

                        default:
                          this.slideRight();
                    }
                }
                else
                {
                    //$blocker.hide();
                    $body.find(".section-wrapper").css({opacity : 0}).animate({opacity:1}, {duration:TRANSITION_TIME, easing:TRANSITION_EASE, complete:this.complete});
                }
            },

            /*-------------------------------*/

            opacity: function()
            {
                $new.css({"opacity":0}).animate({"opacity" : 1}, {duration:TRANSITION_TIME, easing:TRANSITION_EASE});

                $last.animate({"opacity" : 1}, {duration:TRANSITION_TIME, easing:TRANSITION_EASE, complete:this.complete});
            },

            /*-------------------------------*/

            slideRight: function()
            {
                //$body.css ( {"overflow-x" : "hidden"} );
                $new.css( { "left" : $window.width() } )
                .animate({"left" : 0}, {duration:TRANSITION_TIME, easing:TRANSITION_EASE});

                $last.animate({"left" : 0-$window.width()}, {duration:TRANSITION_TIME, easing:TRANSITION_EASE, complete:this.complete});
            },

            /*-------------------------------*/

            slideTop: function()
            {
                $blocker.show();

                
                if (1==2)
                //if (Modernizr.csstransforms && !$.browser.msie)
                {

                    
                    $new.css( { 
                            '-webkit-transform': 'translate3D(0,'+(0-$window.height())+'px,0)',
                            '-moz-transform': 'translate3D(0,'+(0-$window.height())+'px,0)',
                            'transform': 'translate3D(0,'+(0-$window.height())+'px,0)',
                            "z-index" : 2 } );

                    /*setTimeout(function(){
                        $new.one(TRANSITION_END_EVENT, function(){
                            $new.removeClass("transition-top");
                            $this.complete();
                        });

                        $new.addClass("transition-top").css( { 
                            '-webkit-transform': 'translate3D(0, 0,0)',
                            '-moz-transform': 'translate3D(0, 0,0)',
                            '-o-transform': 'translate3D(0, 0,0)',
                            '-ms-transform': 'translate3D(0, 0,0)'
                         });

                        $last.addClass("transition-top").css( { 
                            "z-index" : 1,
                            '-webkit-transform': 'translate3D(0, ' + $window.height()/1.25 + 'px,0)',
                            '-moz-transform': 'translate3D(0, ' + $window.height()/1.25 + 'px,0)',
                            '-o-transform': 'translate3D(0, ' + $window.height()/1.25 + 'px,0)',
                            '-ms-transform': 'translate3D(0, ' + $window.height()/1.25 + 'px,0)'
                         });

                    

                    },250);*/
                   
                }
                else
                {
                    $new.css( { "opacity" : 0, "z-index" : 2 } )
                    .animate({"opacity" : 1}, {duration:950, easing:"easeInOutSine"});
                    $last.animate({"opacity" : 0, "z-index" : 1}, {duration:950, easing:"easeInOutSine", complete:$this.complete});
                }
            },
               

            /*-------------------------------*/

            slideBottom: function()
            {
                $blocker.show();
                
                if (Modernizr.csstransforms && !$.browser.msie)
                {
                    
                    $new.css({ "z-index":2 });
                    $new.transition({ y: $window.height() },0);
                    $new.transition({ y: 0 }, 850, 'ease');
                    
                    $last.css({"z-index":1});
                    $last.transition({ y: 0-$window.height() }, 950, 'ease', function(){
                        setTimeout($this.complete, 100);   
                    });

                }
                else
                {
                    $new.css( { "opacity" : 0, "z-index" : 2 } );
                    $new.animate({"opacity" : "1"}, {duration:950, easing:"easeInOutSine"});
                    $last.animate({"opacity" : 0, "z-index" : 1}, {duration:950, easing:"easeInOutSine", complete:this.complete});
                }
                
                
            },

            /*-------------------------------*/

            complete: function(){
                if ($new)
                {
                    $new.css( {  '-webkit-transform': 'none' } );
                    $new.removeClass("transition-top");
                }
                if ($last) $last.remove();
                bus.publish( 'satorisan', 'history-update' );
                //$body.css ( { "overflow-x" : "initial", "overflow-y" : "initial" } );
                bus.publish( 'satorisan', 'menu-change' );
                if(completeCallback) completeCallback();

            }

            /*-------------------------------*/
        
        }
    
});


Hydra.module.register( 'layout', function( bus ){ 
    var $this,
        isCreate,
        changeFace,
        isChange = true,
		interval;
    return {
            
            /*-------------------------------*/
            /* LAYOUT */
            /*-------------------------------*/

            init: function(){
                
                this.append();
                $this = this;
                isCreate = 0;
                $(window).bind("resize", this.resize);
                if ($window.width() <=960){
                    $this.createMonkey();
                }            
            },
			

            /*-------------------------------*/

            resize: function(){
                $html.css( { "overflow-y" : "hidden" } );
                
                if ($window.width()<=960 )
                {
                    
                    if ( isCreate == 0 ){
                        $this.createMonkey();
                        isCreate = 1;
                    }
                    clearTimeout(changeFace);
                        changeFace = setTimeout(function(){
                            
                            $("#monkey-wrapper #monkey-head img").attr("src","/website/images/monkey/monkey-head.png");
                    },500);
                    
                }
                else if ($window.width()>961)
                {
                    $this.removeMonkey();
                    isCreate = 0;
                }
                
            },

			/*-------------------------------*/

            createMonkey: function(){

                 var monkeyResize= "";

                    monkeyResize += "<div id='monkey-wrapper'>";
                    monkeyResize += "<div id='monkey-wrapper-container'>";
                        monkeyResize += "<div id='monkey-logo' ></div>";
                        monkeyResize += "<div id='monkey-text'>";
                            monkeyResize += "<h3>Hey, hey! Having fun?</h3>";
                            monkeyResize += "<p>Come on my friend, let me breath!<br>";
                            monkeyResize += "please, be kind and resize your browser!</p>";
                            //monkeyResize += "<h5>or go to the <a href='/?force_mobile=true'>mobile site</a></h5>";
                        monkeyResize += "</div>";
                        monkeyResize += "<div id='monkey-body'>";
                            
                            monkeyResize += "<div id='monkey-hand-left'></div>";
                            monkeyResize += "<div id='monkey-hand-left-shadow'></div>";
                            monkeyResize += "<div id='monkey-hand-left-grow'></div>";
                            monkeyResize += "<div id='monkey-hand-right-grow'></div>";
                            monkeyResize += "<div id='monkey-hand-right'></div>";
                            monkeyResize += "<div id='monkey-hand-right-shadow'></div>";
                            monkeyResize += "<div id='monkey-head'></div>";
                            monkeyResize += "<div id='monkey-body-bottom'></div>";
                            monkeyResize += "<div id='monkey-light'></div>";
                            monkeyResize += "<div id='monkey-hash'>#livebythewalk</div>";

                    monkeyResize += "</div>";
                    monkeyResize += "</div>";
                       
                     
                    monkeyResize += "</div>";

                    $overlay.append(monkeyResize);
                    isCreate = 1;

                    $overlay.find("#monkey-logo").css( { opacity : 0} );
                    $overlay.find("#monkey-text").css( { opacity : 0} );
                    $overlay.find("#monkey-body").css( { opacity : 0} );

                    $overlay.find("#monkey-wrapper").css( { opacity : 0} ).animate( { opacity : 1 }, { duration:250, complete:function(){

                        $overlay.find("#monkey-logo").animate( { opacity : 1}, {duration:150} );
                        $overlay.find("#monkey-text").delay(300).animate( { opacity : 1}, {duration:250} );
                        $overlay.find("#monkey-body").delay(450).animate( { opacity : 1}, {duration:250} );

                    }} );
                    
                    interval = setInterval(this.changeMonkey,1000);
              //  }
            },

            /*-------------------------------*/

            changeMonkey: function(){

                if (isChange){
                   
                    $("#monkey-wrapper #monkey-head").removeClass("normal");
                    $("#monkey-wrapper #monkey-head").addClass("change");
                    isChange = false;
                }else{

                  
                    $("#monkey-wrapper #monkey-head").addClass("normal");
                    $("#monkey-wrapper #monkey-head").removeClass("change");
                    isChange = true;
                }
            },

            /*-------------------------------*/

            removeMonkey: function(count){
                
                $overlay.find("#monkey-logo").animate( { opacity : 0}, {duration:150} );
                $overlay.find("#monkey-text").delay(300).animate( { opacity : 0}, {duration:250} );
                $overlay.find("#monkey-body").delay(450).animate( { opacity : 0}, {duration:250, complete:function(){

                    $overlay.find("#monkey-wrapper").animate( { opacity : 0 }, {duration:250, complete:function(){
                        $overlay.find("#monkey-wrapper").remove();        
                    } } );
					
					clearInterval(interval);
                }} ); 

            },

            /*-------------------------------*/

            append: function(){            	

            	var markup = "";
                
                markup += "<div id='wrapper' class='lg-" + CURRENT_LANGUAGE + "'>";
                markup += "<div id='blocker'></div>";
                markup += "<div id='overlay'><div class='general-background-overlay'></div></div>";
                markup += "<header id='header'><div class='container'></div></header>";
                markup += "<div id='content'></div>";
                markup += "<footer id='footer'></footer>";
                markup += "<div id='preload-fonts-block'><div class='proxima_nova_light'>x</div><div class='proxima_nova_regular'>x</div><div class='proxima_nova_bold'>x</div><div class='proxima_nova_semibold'>x</div></div>";
                markup += "</div>";

                $body.append(markup);
                
            	$header = $("header");
            	$footer = $("footer");
                $content = $("#content");				
                $overlay = $("#overlay");
                $blocker = $("#blocker");

            }

            /*-------------------------------*/

        
        }
    
});


Hydra.module.register( 'menu', function( bus ){ 

    var $this, $barLeft, $barRight, currentLeft="", currentRight="", isCreated = false;

    var SELECTORS_LEFT = new Array();
    //SELECTORS_LEFT ["satori-heart-ss14"] = 1;
    SELECTORS_LEFT ["catalog"] = 1;
    SELECTORS_LEFT ["shop"] = 1;
    SELECTORS_LEFT ["detail"] = 1;
    SELECTORS_LEFT ["product-detail"] = 1;
    SELECTORS_LEFT ["products-list"] = 1;
    SELECTORS_LEFT ["stores"] = 2;
    //SELECTORS_LEFT ["tech"] = 4;
    //SELECTORS_LEFT ["cms-live"] = 5;
    SELECTORS_LEFT ["live-by-the-walk"] = 3;
    SELECTORS_LEFT ["brand"] = 4;
    

    var SELECTORS_RIGHT = new Array();
    SELECTORS_RIGHT ["cart"] = 0;
    SELECTORS_RIGHT ["account"] = 1;
    SELECTORS_RIGHT ["language"] = 2;

    return {
            
            /*-------------------------------*/
            /* NAVIGATION MENU */
            /*-------------------------------*/

            init: function(){
                if (isCreated==false)
                {
                    $this = this;   
                    bus.subscribe('satorisan', this);

                    this.append();
                    isCreated = true;
                }
            },
			
            oEventsCallbacks: {
                'menu-change' : function () {                    
                    //$this.changeBarPosition(false);
                },

                'menu-change-go' : function (option) {                    
                    $this.changeTo(option);
                }
            },

			/*-------------------------------*/

            append: function(){
            	
                var markupLeft = "<nav id='nav' class='left-section'><div class='selected-bar'></div><ul>";
            	
                
                for ( var i=0; i < MENU_HEADER_OPTIONS.groupLeft[CURRENT_LANGUAGE].length; i++)
            	{
					
					markupLeft += "<li class='option-" + i + "'><a class='option-" + i + " " + checkExist(MENU_HEADER_OPTIONS.groupLeft[CURRENT_LANGUAGE][i].cStyle) + "' href='/" + MENU_HEADER_OPTIONS.groupLeft[CURRENT_LANGUAGE][i].url + "'>" + MENU_HEADER_OPTIONS.groupLeft[CURRENT_LANGUAGE][i].title + "</a></li>";
            		
            	}
            	
                markupLeft += "</ul></nav>";

                var markupRight = "<nav id='nav' class='right-section'><div class='selected-bar'></div><ul>"
                
                
                for ( var i=0; i < MENU_HEADER_OPTIONS.groupRight[CURRENT_LANGUAGE].length; i++)
                {
                    
                    if( i == 2 ){
                        markupRight += "<li class='option-" + i + "'><a class='option-" + i + " " + checkExist(MENU_HEADER_OPTIONS.groupRight[CURRENT_LANGUAGE][i].cStyle) + "' >" + MENU_HEADER_OPTIONS.groupRight[CURRENT_LANGUAGE][i].title + "</a></li>";
                    }else{
                        markupRight += "<li class='option-" + i + "'><a class='option-" + i + " " + checkExist(MENU_HEADER_OPTIONS.groupRight[CURRENT_LANGUAGE][i].cStyle) + "' href='/" + MENU_HEADER_OPTIONS.groupRight[CURRENT_LANGUAGE][i].url + "'>" + MENU_HEADER_OPTIONS.groupRight[CURRENT_LANGUAGE][i].title + "</a></li>";
                    }
                    
                    
                }
                
                markupRight += "</ul></nav>";                
                
            	$header.find(".container").append (markupLeft + markupRight);

                $("#header").animate({opacity:1}, 350, function(){
                    $this.resize();
                });

                $('#nav.left-section li:first-child,#nav.left-section li:last-child').css({'border':'0'});
                
                bus.publish( 'satorisan', 'set-cart' );
                
                Hydra.module.start("language-switcher", "language-switcher" + '_instance');   

                $barLeft = $(".selected-bar").eq(0);
                $barRight = $(".selected-bar").eq(1);

				$barLeft.css('opacity', 0);
				
                $barRight.css({
                        "width":$header.find(".right-section li.option-"+0).width(),
                        left:$header.find(".right-section").offset().left
                    });

                //$this.changeBarPosition(true);

                $window.bind("resize", $this.resize)                
                
                if (ISLOGGIN==1)
                {
                    $header.find(".right-section li.option-1 a").addClass("login");
                }

                setTimeout(function(){$this.resize()},250);

                bus.publish( 'satorisan', 'history-update' );
                
            },

            /*-------------------------------*/

            resize:function(){
                $this.changeTo({data:currentLeft, dataRight:currentRight});                
            },

            /*-------------------------------*/

            changeTo:function(option)
            {
                
               
                if (option.data)
                {
                    currentLeft = ""; 
                    var to = option.data
                    
                    var time = 550;

                    // LEFT
                    var hasLeft = false;
                    var leftIndex = 0;
                    var i = 0;

                    for (var name in SELECTORS_LEFT)
                    {
                        if (name == to)
                        {
                            hasLeft = true;
                            leftIndex = SELECTORS_LEFT[name];
                            currentLeft = name;
                        }
                        i++;
                    }

                    if ( $barLeft.css("opacity") == 0 )
                    {
                        $barLeft.css({
                            "width":$header.find(".left-section li.option-"+leftIndex).width()+2,
                            left:$header.find(".left-section li.option-"+leftIndex).offset().left
                        });
                    }

                    if (leftIndex==0)
                    {
                        $barLeft.animate({"opacity" : 0}, {duration:time});
                    }
                    else
                    {
                        $barLeft.stop().animate({
                            "width":$header.find(".left-section li.option-"+leftIndex).width()+2,
                            "opacity" : 1, 
                            left:$header.find(".left-section li.option-"+leftIndex).offset().left
                        }, {duration:time, ease:"easeInSine"});
                    }
                }


                 // RIGHT
                var hasRight = false;
                var rightIndex = -1;
                var i = 0;
                var toRight=0;
                if (option.dataRight)
                {
                    toRight = option.dataRight;
                    currentRight = ""; 
                }

                if (option.dataRight=="") currentRight = ""; 

                for (var name in SELECTORS_RIGHT)
                {                    
                    if (name == toRight)
                    {
                        hasRight = true;
                        rightIndex = SELECTORS_RIGHT[name];
                        currentRight = name;
                    }
                    i++;
                }

                if (rightIndex==-1)
                {
                    $barRight.animate({"opacity" : 0}, {duration:time});
                }
                else
                {
                    var offset = 0;
                    
                    if (rightIndex == 0)
                    {
                        offset = 1;
                    }

                    if (rightIndex == 1)
                    {
                        offset = 2;
                    }

                    if (rightIndex == 2)
                    {
                        offset = -3;
                    }


                    if ( $barRight.css("opacity") == 0 )
                    {
                        $barRight.css({
                            "width":$header.find(".right-section li.option-"+rightIndex).width(),
                            left:$header.find(".right-section").offset().left + (rightIndex*$header.find(".right-section li").width()) + offset
                        });                        
                    }


                    $barRight.stop().animate({
                        "width":$header.find(".right-section li.option-"+rightIndex).width(),
                        "opacity" : 1, 
                        left:$header.find(".right-section").offset().left + (rightIndex*$header.find(".right-section li").width()) + offset
                    }, {duration:time, ease:"easeInSine"});

                }



            },

            /*-------------------------------


            changeBarPosition:function(isFirst){          

                var time = 550;

                if (isFirst==true) time = 0;

  
                var hasLeft = false;
                var leftIndex = 0;
                var i = 0;
                for (var name in SELECTORS_LEFT)
                {
                    if ($body.hasClass(name))
                    {
                        hasLeft = true;
                        leftIndex = SELECTORS_LEFT[name];
                    }
                    i++;
                }

                if ( $barLeft.css("opacity") == 0 )
                {
                    $barLeft.css({
                        "width":$header.find(".left-section li.option-"+leftIndex).width()+2,
                        left:$header.find(".left-section li.option-"+leftIndex).offset().left
                    });
                }

                if (leftIndex==0)
                {
                    $barLeft.animate({"opacity" : 0}, {duration:time});
                }
                else
                {
                    $barLeft.animate({
                        "width":$header.find(".left-section li.option-"+leftIndex).width()+2,
                        "opacity" : 1, 
                        left:$header.find(".left-section li.option-"+leftIndex).offset().left
                    }, {duration:time, ease:"easeInSine"});
                }


       
                var hasRight = false;
                var rightIndex = -1;
                var i = 0;
                for (var name in SELECTORS_RIGHT)
                {
                    
                    if ($body.hasClass(name))
                    {
                        hasRight = true;
                        rightIndex = SELECTORS_RIGHT[name];
                    }
                    i++;
                }
                
                if (rightIndex==-1)
                {
                    $barRight.animate({"opacity" : 0}, {duration:time});
                }
                else
                {
                    var offset = 0;
                    
                    if (rightIndex == 0)
                    {
                        offset = 1;
                    }

                    if (rightIndex == 1)
                    {
                        offset = 2;
                    }

                    if ( $barRight.css("opacity") == 0 )
                    {
                        $barRight.css({
                            "width":$header.find(".right-section li.option-"+rightIndex).width(),
                            left:$header.find(".right-section").offset().left + (rightIndex*$header.find(".right-section li").width()) + offset
                        });                        
                    }

                    $barRight.animate({
                        "width":$header.find(".right-section li.option-"+rightIndex).width(),
                        "opacity" : 1, 
                        left:$header.find(".right-section").offset().left + (rightIndex*$header.find(".right-section li").width()) + offset
                    }, {duration:time, ease:"easeInSine"});
                }


            }

            -------------------------------*/

        
        }
    
});


Hydra.module.register( 'footer', function( bus ){ 

    var isCreated = false;

    return {
            
            /*-------------------------------*/
            /* FOOTER */
            /*-------------------------------*/

            init: function(){
                if (isCreated == false)
                {
                    this.append();
                    isCreated = true;
                }
            },
			
			/*-------------------------------*/

            append: function(){
            	//alert('true');

                //$('.group-right li:last-child').css('padding-right':'15px'});
                //$('.group-right li:first-child').css(border:0 none});
                //$('.group-left li:last-child').css(border-left:1px solid #4d4d4d,margin:0);

            	var markupGroupLeft = "<ul class='group-left'>";
                var markupGroupRight = "<ul class='group-right'>";
            	

                for ( var i=0; i < FOOTER_TEXTS [CURRENT_LANGUAGE].groupLeft.length; i++)
            	{
					if (FOOTER_TEXTS [CURRENT_LANGUAGE].groupLeft[i].url)
                    {
                        markupGroupLeft += "<li><span class='" + checkExist(FOOTER_TEXTS [CURRENT_LANGUAGE].groupLeft[i].cStyle) + "'>" +FOOTER_TEXTS [CURRENT_LANGUAGE].groupLeft[i].text + "</span></li>";
                    }
                    else
                    {
                        markupGroupLeft += "<li><span class='" + checkExist(FOOTER_TEXTS [CURRENT_LANGUAGE].groupLeft[i].cStyle) + "'>" +FOOTER_TEXTS [CURRENT_LANGUAGE].groupLeft[i].text + "</span></li>";
                    }        	
            	}

                markupGroupLeft += "</ul>";


                for ( var i=0; i < FOOTER_TEXTS [CURRENT_LANGUAGE].groupRight.length; i++)
                {
                    if (FOOTER_TEXTS [CURRENT_LANGUAGE].groupRight[i].url)
                    {
                        markupGroupRight += "<li class='" + checkExist(FOOTER_TEXTS [CURRENT_LANGUAGE].groupRight[i].cStyle) + "'><span>" +FOOTER_TEXTS [CURRENT_LANGUAGE].groupRight[i].text + "</span></li>";
                    }
                    else
                    {
                        markupGroupRight += "<li class='" + checkExist(FOOTER_TEXTS [CURRENT_LANGUAGE].groupRight[i].cStyle) + "'><span>" +FOOTER_TEXTS [CURRENT_LANGUAGE].groupRight[i].text + "</span></li>";
                    }           
                }                
            	
                markupGroupRight += "</ul>";
                

            	$footer.append ("<div class='footer-container'><div class='footer_center'>" + markupGroupLeft + markupGroupRight + "</div></div>");
                $footer.css( { bottom:-16 } ).animate({bottom:0}, 350);

                Hydra.module.start("follow", 'follow_instance');   
                Hydra.module.start("policies", 'policies_instance');   
                Hydra.module.start("contact", 'contact_instance');   

            }

            /*-------------------------------*/

        
        }
    
});


Hydra.module.register( 'follow', function( bus ){ 
        
        var  $this,isActive=false, overlayAnimation=true;

        return {
            
            /*-------------------------------*/
            /* FOLLOW */
            /*-------------------------------*/            

            init: function(){
                bus.subscribe('satorisan', this);
                $this = this;
                $footer.find(".share").bind(CLICK_EVENT, $this.clickShare);
            },
            
            /*-------------------------------*/

            clickShare:function(e){
                e.preventDefault();
                
                if (isActive==false)
                {

                    bus.publish("satorisan", "ganalytics-track-event",{name:"FOLLOW "+CURRENT_LANGUAGE.toUpperCase()});
                    bus.publish( 'satorisan', 'pause-page' );
                    if (user.MISCELANEA_WINDOW_OPEN)
                    {
                        bus.publish("satorisan", "menu-change-go", { dataRight:"" });
                        bus.publish("satorisan", "destroy-miscelanea-page", {keepOverlay:true, complete:function(animation){
                            $this.create();   
                        }});
                    }
                    else
                    {
                        bus.publish("satorisan", "overlay-show", {complete:function(animation){
                            $this.create();   
                        }});   
                        
                    }
                }
                
            },

            /*-------------------------------*/

            oEventsCallbacks: {
                'append-page' : function (data) {                    

                },
                
                'destroy-miscelanea-page' : function(data)
                {
                    if (isActive)
                    {
                        $this.stop(data);
                    }
                },

                'destroy-popup' : function (data)
                {  
                    if (isActive)
                    {
                        $this.stop(); 
                    }
                }
            },

            /*-------------------------------*/

            create:function(e){
                $footer.find(".share span").addClass("selected");
                var MARKUP = "<div class='follow-wrapper clearfix'>";
                MARKUP += "<div class='follow-layout-wrapper'>";
                MARKUP += "<div class='iconos close-follow close-iframe'><span></span></div>";
                MARKUP += "<div class='follow-layout'>";
                MARKUP += "<div class='follow-title'><span class='icon_social'></span>" + DICTIONARY[CURRENT_LANGUAGE].followtitle + "</div>";
                MARKUP += "<div class='follow-push'>" + DICTIONARY[CURRENT_LANGUAGE].followpush + "</div>";
                MARKUP += "<ul class='follow-content clearfix'>";
                MARKUP += "<li class='twitter-icon'><a href='http://www.twitter.com/" + TWITTER_ACCOUNT[CURRENT_LANGUAGE] + "' target='_blank'><span class='icon_twitter'></span><h6>Twitter</h6></a></li>";
                MARKUP += "<li class='facebook-icon'><a href='http://www.facebook.com/" + FACEBOOK_ACCOUNT[CURRENT_LANGUAGE] + "' target='_blank'><span class='icon_facebook'></span><h6>Facebook</h6></a></li>";
                MARKUP += "<li class='pinterest-icon'><a href='" + PINTEREST_ACCOUNT + "' target='_blank'><span class='icon_pinterest'></span><h6>Instagram</h6></a></li>";
                MARKUP += "<li class='youtube-icon'><a href='http://www.youtube.com/"+ YOUTUBE_ACCOUNT +"' target='_blank'><span class='icon_youtube'></span><h6>YouTube</h6></a></li>";
                MARKUP += "</ul>";
                MARKUP += "</div>";
                MARKUP += "</div>";
                MARKUP += "</div>";
                MARKUP += "</div>";

                $overlay.append (MARKUP);


                $overlay.find(".close-follow").unbind(CLICK_EVENT, $this.destroy).bind(CLICK_EVENT, function(e){
                    $this.stop();
                    return false;
                });
                
                
                $overlay.find(".follow-layout-wrapper").animate( { height:283}, {easing:"easeInOutSine",duration:250, complete:function(){
                     
                }} );
                    
                user.MISCELANEA_WINDOW_OPEN = true;                

                isActive = true;
               
                $(".general-background-overlay").unbind(CLICK_EVENT).bind(CLICK_EVENT, function(){
                    $this.stop();
                });

                $blocker.hide();
            },

            /*-------------------------------*/

            stop:function(data)
            {               
                if (data)
                {
                    if (data.keepOverlay)
                    {

                    }
                    else
                    {
                        bus.publish("satorisan", "menu-change-go", { dataRight:"" });
                    }
                }
                $footer.find(".share span").removeClass("selected");
                $overlay.find(".follow-layout-wrapper").animate( { height:0}, {easing:"easeInOutSine",duration:250, complete:function(){
                    
                        $overlay.find(".follow-wrapper").remove();
                        bus.publish( 'satorisan', 'resume-page' );
                        user.MISCELANEA_WINDOW_OPEN = false;
                        isActive = false;
                        if (data)
                        {
                            if (data.complete) data.complete(false);
                        }
                        else
                        {
                            bus.publish( 'satorisan', 'overlay-hide' );
                        }
                    
                }} );   

            }

        
        }
    
});


Hydra.module.register( 'contact', function( bus ){ 
        
        var  $this,isActive=false, overlayAnimation=true;

        return {
            
            /*-------------------------------*/
            /* FOLLOW */
            /*-------------------------------*/            

            init: function(){

                bus.subscribe('satorisan', this);
                $this = this;
                $footer.find(".contact").bind(CLICK_EVENT, $this.clickContact);
                //alert($footer.find(".contact").length);
            },
            
            /*-------------------------------*/

            clickContact:function(e){
                //alert(2);
                e.preventDefault();
                
                if (isActive==false)
                {

                    bus.publish("satorisan", "ganalytics-track-event",{name:"CONTACT "+CURRENT_LANGUAGE.toUpperCase()});

                    if (user.MISCELANEA_WINDOW_OPEN)
                    {
                        bus.publish("satorisan", "menu-change-go", { dataRight:"" });
                        bus.publish("satorisan", "destroy-miscelanea-page", {keepOverlay:true, complete:function(animation){
                            if (CURRENT_LANGUAGE == "es")
                            {
                                $this.create(TEMPLATE_CONTACT_ES, "contact");
                            }
                            else
                            {
                                $this.create(TEMPLATE_CONTACT_EN, "contact");   
                            }  
                        }});
                    }
                    else
                    {
                        bus.publish("satorisan", "overlay-show", {complete:function(animation){
                            if (CURRENT_LANGUAGE == "es")
                            {
                                $this.create(TEMPLATE_CONTACT_ES);
                            }
                            else
                            {
                                $this.create(TEMPLATE_CONTACT_EN);   
                            } 
                        }});   
                        
                    }


               
                }
                
            },

            /*-------------------------------*/

            oEventsCallbacks: {
                'append-page' : function (data) {                    

                },
                
                'destroy-miscelanea-page' : function(data)
                {
                    if (isActive)
                    {
                        $this.stop(data);
                    }
                },

                'destroy-popup' : function (data)
                {  
                    if (isActive)
                    {
                        $this.stop(); 
                    }
                }
            },

            /*-------------------------------*/

            create:function(template){
                $footer.find(".contact span").addClass("selected");
                var MARKUP = "<div class='contact-wrapper clearfix'>";
                MARKUP += "<div class='contact-layout-wrapper'>";
                MARKUP += "<div class='iconos close-contact close-iframe'><span></span></div>";
                MARKUP += "<div class='contact-layout'>";
                MARKUP += template;
                MARKUP += "</div>";
                MARKUP += "</div>";
                MARKUP += "</div>";

                $overlay.append (MARKUP);


                

                bus.publish( 'satorisan', 'pause-page' );

                $overlay.find(".close-contact").unbind(CLICK_EVENT, $this.destroy).bind(CLICK_EVENT, function(e){
                    $this.stop();
                    return false;
                });
                
                $overlay.find(".contact-layout-wrapper").animate( { height:356}, {easing:"easeInOutSine",duration:250} );    
                user.MISCELANEA_WINDOW_OPEN = true;                

                isActive = true;

                $(".general-background-overlay").unbind(CLICK_EVENT).bind(CLICK_EVENT, function(){
                    $this.stop();
                });

                $blocker.hide();
            },

            /*-------------------------------*/

            stop:function(data)
            {               
                if (data)
                {
                    if (data.keepOverlay)
                    {

                    }
                    else
                    {
                        bus.publish("satorisan", "menu-change-go", { dataRight:"" });
                    }
                }
                $footer.find(".contact span").removeClass("selected");
                $overlay.find(".contact-layout-wrapper").animate( { height:0}, {easing:"easeInOutSine",duration:250, complete:function(){
                    
                        $overlay.find(".contact-wrapper").remove();
                        bus.publish( 'satorisan', 'resume-page' );
                        user.MISCELANEA_WINDOW_OPEN = false;
                        isActive = false;
                        if (data)
                        {
                            if (data.complete) data.complete(false);
                        }
                        else
                        {
                            bus.publish( 'satorisan', 'overlay-hide' );
                        }
                    
                }} );   

            }

        
        }
    
});


var SatorisanGrid = {};
(function($)
{
	var NORMAL_OPACITY = .8;

	var TILES_MIN_SIZE = 134;
	var TILES_MAX_SIZE = 175;
	var MIN_ROWS = 3;

	var SHOW_DELAY = 30;
	var SHOW_DURATION = 300;

	var HIDE_DELAY = 30;
	var HIDE_DURATION = 300;

	var TOUR_DE_FRANCE_EFFECT_RATIO = .8;

	var MIN_DISTANCE = 1;

	var MOVER_WIDTH = 2000000; // Max value that doesn't break IE
	//var ACCOMODATE_SCROLL_EVERY = 5000;

	var PREFERRED_ROWS_COUNT = 6;

	var FIX_RENDERING_ISSUES = BrowserDetect.browser != 'Firefox';

	var $window = $(window);

	var closeCallback;

	var gridWidth;
	var gridHeight;
	var lastHeight;

	var originalItems = [];
	var originalItems2 = [];

	var sortedGroups = [];

	var tilesPerPage = 0;

	var tilesSize;
	var rows;
	var columns;

	var $grid;
	var $gridMover;

	var offsetedZero;

	var elementsMatrix = [];
	var firstFilledColumn = NaN;
	var lastFilledColumn = NaN;
	var matrixZeroOffset = 0;

	var currentColumnIndex;
	var lastColumnIndex;

	var dragging = false;

	var abstract;

	var $gridContent;
	var $contentControls;
	var $nextButton;
	var $previousButton;
	var $closeButton;
	var $contentItems;

	function calculateSize(height)
	{
		rows = PREFERRED_ROWS_COUNT;

		if (height / rows < TILES_MIN_SIZE)
		{
			rows = Math.floor(height / TILES_MIN_SIZE);
		}
		else if (height / rows > TILES_MAX_SIZE)
		{
			rows = Math.ceil(height / TILES_MAX_SIZE);
		}

		if (rows < MIN_ROWS) rows = MIN_ROWS;

		tilesSize = height / rows;
	}

	function createPages(width)
	{
		columns = Math.ceil(width / tilesSize);
		var necessaryTilesCount = rows * columns * 2;
		var pagesCount = Math.ceil((Math.ceil(necessaryTilesCount / tilesPerPage * 2) * 2.5) / 2) * 2;

		for (var i = 0; i < pagesCount; i++)
		{
			var newGroup = [];
			var newGroup2 = [];
			for (var j = 0; j < originalItems.length; j++)
			{
				var newItem = createNewItem(originalItems[j], i % 2);
				if (i % 2 == 0 || !(newItem.$element.hasClass('item-10') && newItem.$element.hasClass('item-13')))
				newGroup.push(newItem);
			}
			for (var j = 0; j < originalItems2.length; j++)
			{
				var newItem = createNewItem(originalItems2[j], i % 2);
				if (i % 2 == 0 || !(newItem.$element.hasClass('item-10') && newItem.$element.hasClass('item-13')))
				newGroup2.push(newItem);
			}
			sortedGroups.push(newGroup);
			sortedGroups.push(newGroup2);
		}
	}

	var selectedItem;
	function updateOver(item)
	{
		if (item.dim) item.$image.css({opacity: NORMAL_OPACITY + (1 - NORMAL_OPACITY) * item.over.ratio});
		item.$border.css({boxShadow: 'inset 0 0 0 ' + 9 * item.over.ratio + 'px ' + item.color});
	}
	function updateOpened(item)
	{
		if (item.opened.ratio < 1)
		{
			item.$border.css({boxShadow: 'inset 0 0 0 ' + (9 + (item.$element.height()/2 - 9) * item.opened.ratio) + 'px ' + item.color});
		}
		else
		{
			item.$border.css({boxShadow: '', backgroundColor: item.color});
		}
	}
	function selectItem(item)
	{
		if (selectedItem) deselectItem(selectedItem);
		selectedItem = item;
		function stepFunction()
		{
			updateOver(item);
		}
		item.$over.stop(true).animate({ratio: 1}, {duration: 300, specialEasing: {ratio: 'easeOutCubic'}, step: stepFunction, complete: stepFunction});
	}
	function deselectItem(item)
	{
		function stepFunction()
		{
			updateOver(item);
		}
		item.$over.stop(true).animate({ratio: 0}, {duration: 300, specialEasing: {ratio: 'easeOutCubic'}, step: stepFunction, complete: stepFunction});
	}

	function createNewItem(originalItem, evenGroup)
	{
		var item = new Item(originalItem.$element.clone());
		item.$mover = $('<div class="mover"/>')
		item.$mover.append(item.$element.children());
		item.$element.append(item.$mover);
		item.$image = item.$element.find('img').css('opacity', NORMAL_OPACITY);
		item.$border = $('<div class="border" />');
		item.$element.find('.mover').prepend(item.$border);
		item.over = {ratio: 0};
		item.$over = $(item.over);
		item.opened = {ratio: 0, done: false};
		item.$opened = $(item.opened);
		item.preloaderColor = evenGroup ? 'white' : 'green';
		item.dim = item.$element.attr('do-not-dim') != '';
		if (!item.dim) item.$element.find('img').css('opacity', 1);
		item.isCloseItem = item.$element.attr('is-close-item') == '';
		item.interactive = item.$element.attr('non-interactive') != '';
		item.color = evenGroup && !item.isCloseItem ? '#7FC940' : 'white';

		if (item.interactive)
		{
			
			item.$element.bind('mouseenter', function(e)
			{
				lastSelectionDoneByKeyboard = false;
				selectItem(item);
			});
			item.$image.bind('mousedown', function(e)
			{
				e.preventDefault();
			});
			function actionHandler(e)
			{
				e.preventDefault();

				if (!dragging)
				{
					if (!item.isCloseItem)
					openItem(item);
					else
					closeCallback();
				}
			}
			item.$element.bind('click', actionHandler);
			item.$element.bind('touchend', actionHandler);
		}

		item.$element.css(
		{
			width: item.columns * tilesSize,
			height: item.rows * tilesSize
		})
		$gridMover.append(item.$element);
		return item;
	}

	var prepositionedItems = [];

	function prepositionElements(group, group2)
	{

		addColumns(columns);

		prepositionedItems = [];

		for (var i = 0; i < group.length; i++)
		{
			if (group[i].$element.hasClass('item-10') || group[i].$element.hasClass('item-13'))
			{
				prepositionedItems.push(group[i]);
			}
		}

		for (var i = 0; i < group2.length; i++)
		{
			if (group2[i].$element.hasClass('item-10') || group2[i].$element.hasClass('item-13'))
			{
				prepositionedItems.push(group2[i]);
			}
		}


		for (var i = 0; i < prepositionedItems.length; i++)
		{
			var item = prepositionedItems[i];
			var maxXIndex = columns - 1 - item.columns;
			var maxYIndex = rows - item.rows;

			var placed = false;
			while (!placed)
			{
				var xIndex = Math.floor((maxXIndex + 1) * Math.random());
				var yIndex = Math.floor((maxYIndex + 1) * Math.random());

				placed = placeItemIfPossible(xIndex, yIndex, item);
			}
		}
	}

	function initialSort()
	{
		var groupsAtLeft = [];
		var groupsAtRight = [];

		var visiblePages = Math.round(columns * rows / tilesPerPage);

		for (var i = 0; i < sortedGroups.length; i++)
		{
			var atLeft = (i < (sortedGroups.length - visiblePages) / 2);

			if (atLeft)
			groupsAtLeft.push(sortedGroups[i]);
			else
			groupsAtRight.push(sortedGroups[i]);
		}

		prepositionElements(groupsAtRight[0], groupsAtRight[1]);

		for (var i = 0; i < groupsAtRight.length; i++)
		{
			addGroup(groupsAtRight[i]);
		}

		for (var i = groupsAtLeft.length - 1; i >= 0; i--)
		{
			addGroup(groupsAtLeft[i], true);
		}

		prepositionedItems = [];

		sortedGroups = groupsAtLeft.concat(groupsAtRight);


		offsetedZero = MOVER_WIDTH / 2;
		positionGroups(sortedGroups);
		$grid.iOSScrollSatorisan('setTo', Math.round(offsetedZero));
		setcurrentColumnIndex(offsetedZero);
		lastColumnIndex = currentColumnIndex;
	}

	function showItems(rightToLeft, random, delay, duration)
	{
		delay = delay ? delay : SHOW_DELAY;
		duration = duration ? duration : SHOW_DURATION;
		var minColumnToHide = Math.floor((abstract.currentPosition - offsetedZero) / tilesSize) + matrixZeroOffset;
		var maxColumnToHide = Math.floor((abstract.currentPosition + gridWidth - offsetedZero) / tilesSize) + matrixZeroOffset;
		var itemsToHide = [];
		for (var i = minColumnToHide; i <= maxColumnToHide; i++)
		{
			for (var j = 0; j < rows; j++)
			{
				var item = getItemOnCell(i, j);
				if (itemsToHide.indexOf(item) == -1)
				{
					itemsToHide.push(item);
					if (random)
					item.$element.stop(true).delay(delay * (Math.random() * (maxColumnToHide - minColumnToHide))).animate({opacity: 1}, {duration: duration, specialEasing: {opacity: 'easeInOutCubic'}});
					else
					{
						if (!rightToLeft)
						item.$element.stop(true).delay(delay * (i - minColumnToHide)).animate({opacity: 1}, {duration: duration, specialEasing: {opacity: 'easeInOutCubic'}});
						else
						item.$element.stop(true).delay(delay * (maxColumnToHide - i)).animate({opacity: 1}, {duration: duration, specialEasing: {opacity: 'easeInOutCubic'}});
					}
				}
			}
		}
	}

	function addGroup(_group, atLeft)
	{
		var group = _group.slice();
		while (group.length)
		{
			var index = Math.floor(group.length * Math.random());
			var item = group[index];

			if (prepositionedItems.indexOf(item) == -1)
			{
				if (!atLeft)
				addItem(item);
				else 
				addItemAtLeft(item);
			}

			group.splice(index, 1);
		}
	}

	function addColumns(count, atLeft)
	{
		for (var i = 0; i < count; i++)
		{
			var newColumn = [];
			for (var j = 0; j < rows; j++)
			{
				newColumn.push('empty');
			}
			if (!atLeft)
			elementsMatrix.push(newColumn);
			else
			{
				elementsMatrix.unshift(newColumn);
			}
		}
		if (atLeft)
		{
			firstFilledColumn += count;
			lastFilledColumn += count;
			matrixZeroOffset += count;
		}

	}

	function checkPlaceability(columnIndex, rowIndex, item)
	{
		for (var i = columnIndex; i < columnIndex + item.columns; i++)
		{
			var column = elementsMatrix[i];
			for (var j = rowIndex; j < rowIndex + item.rows; j++)
			{
				if (column[j] != 'empty')
				return false;
			}
		}
		return (!(checkNextToItself(columnIndex, rowIndex, item)) && !checkGroupAdjacency(columnIndex, rowIndex, item));
	}

	function checkNextToItself(columnIndex, rowIndex, item)
	{
		var minDistance = MIN_DISTANCE;
		if (!isNaN(item.minDistance)) minDistance = item.minDistance;

		var minColumn = columnIndex - minDistance;
		var maxColumn = columnIndex + item.columns - 1 + minDistance;
		if (minColumn < 0) minColumn = 0;

		if (maxColumn > elementsMatrix.length - 1) maxColumn = elementsMatrix.length - 1;

		var minRow = rowIndex - minDistance;
		var maxRow = rowIndex + item.rows - 1 + minDistance;
		if (minRow < 0) minRow = 0;
		if (maxRow > rows - 1) maxRow = rows - 1;

		for (var i = minColumn; i <= maxColumn; i++)
		{
			for (var j = minRow; j <= maxRow; j++)
			{
				if
				(
					i < columnIndex
					||
					i > columnIndex + item.columns - 1
					||
					j < rowIndex
					||
					j > rowIndex + item.rows - 1
				)
				{
					var foundItem = getItemOnCell(i, j);
					if (foundItem)
					{
						if (item.$element.attr('class') == foundItem.$element.attr('class'))
						return true;
					}
				}
			}
		}
		return false;
	}

	function checkGroupAdjacency(columnIndex, rowIndex, item)
	{
		if (!item.avoidGroup)
		{
			return false;
		}
		else
		{
			var minColumn = columnIndex - 1;
			if (minColumn < 0) minColumn = 0;

			var maxColumn = columnIndex + item.columns - 1 + 1;
			if (maxColumn > elementsMatrix.length - 1) maxColumn = elementsMatrix.length - 1;

			var minRow = rowIndex - 1;
			if (minRow < 0) minRow = 0;

			var maxRow = rowIndex + item.rows - 1 + 1;
			if (maxRow > rows - 1) maxRow = rows - 1;

			for (var i = minColumn; i <= maxColumn; i++)
			{
				for (var j = minRow; j <= maxRow; j++)
				{
					if
					(
						i < columnIndex
						||
						i > columnIndex + item.columns - 1
						||
						j < rowIndex
						||
						j > rowIndex + item.rows - 1
					)
					{
						var foundItem = getItemOnCell(i, j);
						if (foundItem)
						{
							if (item.avoidGroup == foundItem.avoidGroup)
							return true;
						}
					}
				}
			}
			return false;
		}
	}

	function getItemOnCell(column, row)
	{
		if (column >= elementsMatrix.length || column < 0 || row < 0 ||  row > rows)
		return null;
		else
		{
			var startCell = elementsMatrix[column][row];
			if (startCell == 'empty')
			{
				return null;
			}
			else if (typeof startCell != 'string' && !(startCell instanceof String))
			{
				return startCell;
			}
			else
			{
				var elementFound = false;
				var distance = 0;
				while (true)
				{
					distance++;

					var startColumn = column - distance;
					if (startColumn < 0) startColumn = 0;

					var startRow = row - distance;
					if (startRow < 0) startRow = 0;

					for (var i = startColumn; i <= column; i++)
					{
						var col = elementsMatrix[i];
						for (var j = startRow; j <= row; j++)
						{
							var cell = col[j];
							if (typeof cell != 'string' && !(cell instanceof String))
							{
								if (i + cell.columns - 1 >= column && j + cell.rows - 1 >= row)
								return (cell);
							}
						}
					}
				}
			}
		}
	}

	function placeItemIfPossible(columnIndex, rowIndex, item, atLeft)
	{
		var actualColumn;
		var actualRow;
		if (!atLeft)
		{
			actualColumn = columnIndex;
			actualRow = rowIndex;
		}
		else
		{
			actualColumn = columnIndex - (item.columns - 1);
			actualRow = rowIndex;
		}

		var placeable = checkPlaceability(actualColumn, actualRow, item);

		if (placeable)
		placeItem(actualColumn, actualRow, item);

		return placeable;
	}

	function placeItem(columnIndex, rowIndex, item)
	{
		for (var i = columnIndex; i < columnIndex + item.columns; i++)
		{
			var column = elementsMatrix[i];
			for (var j = rowIndex; j < rowIndex + item.rows; j++)
			{
				column[j] = 'inUse';
			}
		}
		elementsMatrix[columnIndex][rowIndex] = item;
		item.indexX = columnIndex - matrixZeroOffset;
		item.indexY = rowIndex;
	}

	function addItem(item)
	{
		var tryingColumn = isNaN(lastFilledColumn) ? 0 : lastFilledColumn + 1;

		var placed = false;
		while (!placed)
		{
			if (tryingColumn + item.columns > elementsMatrix.length)
			{
				addColumns(tryingColumn + item.columns - elementsMatrix.length);
			}

			var maxPossibleRowIndex = rows - 1 - (item.rows - 1);
			var possibleRowIndexes = [];
			for (var j = 0; j <= maxPossibleRowIndex; j++)
			{
				possibleRowIndexes.push(j);
			}

			while (!placed && possibleRowIndexes.length > 0)
			{
				var tryingRowIndex = Math.floor(possibleRowIndexes.length * Math.random());
				var tryingRow = possibleRowIndexes[tryingRowIndex];
				possibleRowIndexes.splice(tryingRowIndex, 1);

				placed = placeItemIfPossible(tryingColumn, tryingRow, item);
			}

			if (!placed)
			{
				tryingColumn++;
			}
		}

		if (isNaN(lastFilledColumn))
		setInitialFilledColumns();

		if (!isNaN(lastFilledColumn))
		{
			var foundNotFilledColumn = false;
			var checkingFilledColumn = lastFilledColumn + 1;
			while (!foundNotFilledColumn && checkingFilledColumn < elementsMatrix.length)
			{
				foundNotFilledColumn = !checkColumnFilled(checkingFilledColumn);
				checkingFilledColumn++;
			}
			lastFilledColumn = foundNotFilledColumn ? checkingFilledColumn - 2 : checkingFilledColumn - 1;
		}
	}
	function setInitialFilledColumns()
	{
		var foundFilledColumn = false;
		var foundEmptyColumnAfter = false;
		var checkingColumnIndex = 0;
		while (!foundEmptyColumnAfter && checkingColumnIndex < elementsMatrix.length)
		{
			if (!foundFilledColumn)
			{
				if (checkColumnFilled(checkingColumnIndex))
				{
					firstFilledColumn = checkingColumnIndex;
					foundFilledColumn = true;
				}
			}
			else
			{
				if (checkColumnFilled(checkingColumnIndex))
				{
					lastFilledColumn = checkingColumnIndex;
					foundEmptyColumnAfter = true;
				}	
			}
			checkingColumnIndex++;
		}
		if (foundFilledColumn && !foundEmptyColumnAfter)
		lastFilledColumn = firstFilledColumn;
	}

	function addItemAtLeft(item)
	{
		var tryingColumn = isNaN(firstFilledColumn) ? 0 : firstFilledColumn - 1;

		var placed = false;
		while (!placed)
		{
			if (tryingColumn - (item.columns - 1) < 0)
			{
				var difference = -(tryingColumn - (item.columns - 1));
				addColumns(difference, true);
				tryingColumn += difference;
			}

			var maxPossibleRowIndex = rows - 1 - (item.rows - 1);
			var possibleRowIndexes = [];
			for (var j = 0; j <= maxPossibleRowIndex; j++)
			{
				possibleRowIndexes.push(j);
			}

			while (!placed && possibleRowIndexes.length > 0)
			{
				var tryingRowIndex = Math.floor(possibleRowIndexes.length * Math.random());
				var tryingRow = possibleRowIndexes[tryingRowIndex];
				possibleRowIndexes.splice(tryingRowIndex, 1);

				placed = placeItemIfPossible(tryingColumn, tryingRow, item, true);
			}

			if (!placed)
			{
				tryingColumn--;
			}
		}

		if (isNaN(firstFilledColumn))
		setInitialFilledColumns();

		if (!isNaN(firstFilledColumn))
		{
			var foundNotFilledColumn = false;
			var checkingFilledColumn = firstFilledColumn - 1;

			while (!foundNotFilledColumn && checkingFilledColumn >= 0)
			{
				foundNotFilledColumn = !checkColumnFilled(checkingFilledColumn);
				checkingFilledColumn--;
			}
			firstFilledColumn = foundNotFilledColumn ? checkingFilledColumn + 2 : checkingFilledColumn + 1;
		}
	}

	function positionGroups(groups)
	{
		for (var i = 0; i < groups.length; i++)
		{
			positionGroup(groups[i]);
		}
	}

	function positionGroup(group)
	{
		for (var i = 0; i < group.length; i++)
		{
			positionItem(group[i]);
		}
	}

	function positionItem(item)
	{
		if (!FIX_RENDERING_ISSUES)
		{
			item.$element.css(
			{
				left: offsetedZero + item.indexX * tilesSize,
				top: item.indexY * tilesSize
			});
		}
		else
		{
			item.$element.css(
			{
				left: Math.floor(offsetedZero + item.indexX * tilesSize),
				top: Math.floor(item.indexY * tilesSize),
				width: Math.ceil(offsetedZero + item.indexX * tilesSize + item.columns * tilesSize) - Math.floor(offsetedZero + item.indexX * tilesSize),
				height: Math.ceil(item.indexY * tilesSize + item.rows * tilesSize) - Math.floor(item.indexY * tilesSize)
			})
		}
	}

	function updateGroups()
	{
		if (currentColumnIndex != lastColumnIndex)
		{
			var difference = currentColumnIndex - lastColumnIndex;
			if (difference > 0)
			{
				var neededColumn = Math.round(currentColumnIndex + columns * 1.5);

				while(matrixZeroOffset + neededColumn > lastFilledColumn)
				addAnItem();
			}
			else
			{
				var neededColumn = Math.round(currentColumnIndex - columns * 1.5);

				while(matrixZeroOffset + neededColumn < firstFilledColumn)
				addAnItem(true);
			}

			lastColumnIndex = currentColumnIndex;
		}
	}

	var movingGroupLeft;
	var movingGroupRight;
	var movingGroup = false;
	function addAnItem(atLeft)
	{
		if (!movingGroup)
		{
			if (!atLeft)
			{
				movingGroupLeft = sortedGroups.shift();
				movingGroupRight = [];
			}
			else
			{
				movingGroupRight = sortedGroups.pop();
				movingGroupLeft = [];
			}
			movingGroup = true;
		}

		if (!atLeft)
		{
			var index = Math.floor(movingGroupLeft.length * Math.random());
			var item = movingGroupLeft[index];
			movingGroupLeft.splice(index, 1);
			movingGroupRight.push(item);
			removeItem(item, true);
			addItem(item);
			positionItem(item);

			if (movingGroupLeft.length == 0)
			{
				movingGroup = false;
				sortedGroups.push(movingGroupRight);
				cleanMatrix();
			}
		}
		else
		{
			var index = Math.floor(movingGroupRight.length * Math.random());
			var item = movingGroupRight[index];
			movingGroupRight.splice(index, 1);
			movingGroupLeft.push(item);
			removeItem(item);
			addItemAtLeft(item);
			positionItem(item);

			if (movingGroupRight.length == 0)
			{
				movingGroup = false;
				sortedGroups.unshift(movingGroupLeft);
				cleanMatrix();
			}
		}
	}

	function removeGroup(group, fromLeft)
	{
		if (fromLeft)
		{
			for (var i = 0; i < group.length; i++)
			{
				removeItem(group[i], true);
			}
		}
		else
		{
			for (var i = 0; i < group.length; i++)
			{
				removeItem(group[i], false);
			}
		}
		cleanMatrix();
	}

	function removeColumns(count, atLeft)
	{
		if (!atLeft)
		elementsMatrix = elementsMatrix.slice(0, elementsMatrix.length - count);
		else
		{
			elementsMatrix = elementsMatrix.slice(count, elementsMatrix.length);
			firstFilledColumn -= count;
			lastFilledColumn -= count;
			matrixZeroOffset -= count;
		}
	}

	function removeItem(item, fromLast)
	{
		var indexX = item.indexX + matrixZeroOffset;
		if (fromLast)
		{
			if (!isNaN(firstFilledColumn) && indexX + item.columns - 1 >= firstFilledColumn)
			firstFilledColumn = indexX + item.columns;
		}
		else
		{
			if (!isNaN(lastFilledColumn) && indexX <= lastFilledColumn)
			lastFilledColumn = indexX - 1;
		}

		for (var i = 0; i < item.columns; i++)
		{
			var column = elementsMatrix[indexX + i];
			for (var j = 0; j < item.rows; j++)
			{
				column[item.indexY + j] = 'empty';
			}
		}
	}

	function cleanMatrix()
	{
		var checkingColumnIndex = -1;
		var columnsToRemove = -1;
		var nonEmptyColumnFound = false;
		while (!nonEmptyColumnFound)
		{
			checkingColumnIndex++;
			columnsToRemove++;

			if (!checkColumnEmpty(checkingColumnIndex))
			nonEmptyColumnFound = true;
		}

		if (columnsToRemove > 0)
		removeColumns(columnsToRemove, true);

		checkingColumnIndex = elementsMatrix.length;
		columnsToRemove = -1;
		nonEmptyColumnFound = false;
		while (!nonEmptyColumnFound)
		{
			checkingColumnIndex--;
			columnsToRemove++;

			if (!checkColumnEmpty(checkingColumnIndex))
			nonEmptyColumnFound = true;
		}

		if (columnsToRemove > 0)
		removeColumns(columnsToRemove, false);
	}

	function checkColumnEmpty(index)
	{
		var column = elementsMatrix[index];

		for (var i = 0; i < column.length; i++)
		{
			if (column[i] != 'empty')
			return false;
		}

		return true;
	}

	function checkColumnFilled(index)
	{
		var column = elementsMatrix[index];

		for (var i = 0; i < column.length; i++)
		{
			if (column[i] == 'empty')
			return false;
		}

		return true;
	}

	function setcurrentColumnIndex(scrollPosition)
	{
		var onScreenCenter = scrollPosition - offsetedZero + gridWidth / 2;
		currentColumnIndex = Math.floor(onScreenCenter / tilesSize);
	}

	var $imagesToLoad;
	var pendingLoads;
	var imagesLoadedCallback;
	SatorisanGrid.onLoaded = function(callback)
	{
		imagesLoadedCallback = callback;
		$imagesToLoad = $('#grid img');
		$imagesToLoad = $imagesToLoad.add('<img src="/website/images/campaign/grid/arrow.png" />');
		$imagesToLoad = $imagesToLoad.add('<img src="/website/images/campaign/grid/mono_preloader_green.gif" />');
		$imagesToLoad = $imagesToLoad.add('<img src="/website/images/campaign/grid/mono_preloader_white.gif" />');
		pendingLoads = $imagesToLoad.length;
		$imagesToLoad.each(function()
		{
			onImageLoad(this, imageLoadHandler);
		});
	}

	function imageLoadHandler()
	{
		pendingLoads--;
		if (pendingLoads == 0)
		imagesLoadedCallback();
	}

	SatorisanGrid.init = function(_width, _height, _closeCallback)
	{
	

		closeCallback = _closeCallback;

		gridWidth = _width;
		gridHeight = _height;

		lastHeight = gridHeight;

		$grid = $('#grid');
		$gridMover = $('#grid-mover');
		$gridMover.css(
		{
			width: MOVER_WIDTH
		});
		$grid.iOSScrollSatorisan({roundValue: BrowserDetect.browser == 'Safari'});

		abstract = $grid.iOSScrollSatorisan('getAbstract');

		var $originalItems = $gridMover.children('.item');
		$originalItems.each(function(i)
		{
			var $item = $(this);
			var newItem = new Item($item);

			if (originalItems.length == originalItems2.length)
			{
				if (Math.round(Math.random()))
				originalItems.push(newItem);
				else
				originalItems2.push(newItem);
			}
			else
			{
				if (originalItems.length < originalItems2.length)
				originalItems.push(newItem);
				else
				originalItems2.push(newItem);
			}


			tilesPerPage += newItem.tilesCount;
			$item.remove();
		})
		$gridMover.html('');

		createGrid();
		hideItems(null, false, true);
		if (!idGridDetail)
		showItems();

		$grid.iOSScrollSatorisan('onUpdate', scrollUpdateHandler);

		$grid.iOSScrollSatorisan('addListener', 'dragEffective', function()
		{
			dragging = true;
		});
		$grid.iOSScrollSatorisan('addListener', 'dragStop', function()
		{
			setTimeout(function()
			{
				dragging = false;
			}, 0)
		});

		$window.bind('keydown', keydownHandler);

		$gridContent = $('#grid-content');
		$contentControls = $gridContent.children('.button');
		$nextButton = $contentControls.filter('.next');
		$previousButton = $contentControls.filter('.previous');
		$closeButton = $contentControls.filter('.close');
		$nextButton.append('<span/>');
		$previousButton.append('<span/>');
		$closeButton.append('<span style="left: 1px !important; top: 10px !important;" />');
		$nextButton.click(nextContent);
		$previousButton.click(previousContent);
		$closeButton.click(closeContent);
		$contentControls.addClass('hidden');
		$contentItems = $gridContent.children('.item');
		$contentItems.each(function()
		{
			var $item = $(this);
			var $offsetter = $('<div class="offsetter"/>')
			$offsetter.append($item.children());
			$item.append($offsetter);
		})
		var $hotspotItems = $contentItems.find('.hotspot');
		$hotspotItems.each(function()
		{
			var $hotspot = $(this);
			var $content = $('<div class="content closed" />');
			var $arrow = $('<div class="arrow" />');
			$content.append($arrow);
			$content.append($hotspot.children());
			$hotspot.append($content);
			var $marker = $('<div class="marker" />');
			$hotspot.append($marker);

			var $viewMore = $('<a class="view-more">'+DICTIONARY[CURRENT_LANGUAGE].view_more+'</a>')
			$viewMore.attr('href', $hotspot.attr('data-link'));
			$content.append($viewMore);
			$content.click(function(e)
			{
				e.preventDefault();
				campaignDirectAccessPath = $viewMore.attr('href');
				//globalBus.publish( 'satorisan', 'history-goto', { url: '/product/valbone'} );
				globalBus.publish( 'satorisan', 'history-goto', { url: $viewMore.attr('href') } );
				idGridDetail = $hotspot.parent().parent().parent().attr("class").split('item-')[1];
				//window.location.href = $viewMore.attr('href');
			});
			$hotspot.click(function(){});
			$hotspot.mouseenter(function()
			{
				$content.removeClass('closed');
			});
			$hotspot.mouseleave(function()
			{
				$content.addClass('closed');
			});
		})

		if (idGridDetail)
		{
			detailOpened = true;

			$grid.iOSScrollSatorisan('disable');

			$openedItemContent = $contentItems.filter('.item-' + idGridDetail);
			$openedItemOffsetter = $openedItemContent.children('.offsetter');
			itemIndex = $contentItems.index($openedItemContent);

			createContentImage();

			setContentDimensions();

			$openedItemContent.css(
			{
				display: 'block'
			});

			$gridContent.css(
			{
				display: 'block'
			})

			setHotspotsDirection();
			$window.resize(updateContent);

			setTimeout(contentShownHandler, 1000);

			idGridDetail = null;
		}
	}

	function checkIfOnScreen(item)
	{
		var left = item.$element.offset().left;
		return (left + item.$element.width() > 0 && left < gridWidth);
	}

	var pointedIndexX;
	var pointedIndexY;
	var lastSelectionDoneByKeyboard = false;
	var accomodating = false;
	var accomodatingTimeout;
	function keydownHandler(e)
	{
		if (!detailOpened)
		{
			if (lastSelectionDoneByKeyboard && (e.keyCode == 32 || e.keyCode == 13))
			{
				e.preventDefault();
				openItem(selectedItem);
			}
			else if (e.keyCode >= 37 && e.keyCode <= 40)
			{
				var item;
				if (selectedItem && (checkIfOnScreen(selectedItem) || accomodating))
				{
					if (!lastSelectionDoneByKeyboard)
					{
						pointedIndexX = selectedItem.indexX;
						pointedIndexY = selectedItem.indexY;
						lastSelectionDoneByKeyboard = true;
					}

					var foundDifferentItem = false;
					var tryingColumn = pointedIndexX;
					var tryingRow = pointedIndexY;
					var limitReached = false;
					switch (e.keyCode)
					{
						case 38: // up
							while(!foundDifferentItem && !limitReached)
							{
								tryingRow--;
								if (tryingRow < 0)
								{
									limitReached = true;
									tryingRow = 0;
								}
								else
								{
									item = getItemOnCell(tryingColumn + matrixZeroOffset, tryingRow);
									foundDifferentItem = (item != selectedItem && item.$element.attr('non-interactive') !== '');
								}
							}
							break;
						case 39: // right
							while(!foundDifferentItem && !limitReached)
							{
								tryingColumn++;
								item = getItemOnCell(tryingColumn + matrixZeroOffset, tryingRow);
								foundDifferentItem = (item != selectedItem && item.$element.attr('non-interactive') !== '');
							}
							break;
						case 40: // down
							while(!foundDifferentItem && !limitReached)
							{
								tryingRow++;
								if (tryingRow >= rows)
								{
									limitReached = true;
									tryingRow = rows - 1;
								}
								else
								{
									item = getItemOnCell(tryingColumn + matrixZeroOffset, tryingRow);
									foundDifferentItem = (item != selectedItem && item.$element.attr('non-interactive') !== '');
								}
							}
							break;
						case 37: // left
							while(!foundDifferentItem && !limitReached)
							{
								tryingColumn--;
								item = getItemOnCell(tryingColumn + matrixZeroOffset, tryingRow);
								foundDifferentItem = (item != selectedItem && item.$element.attr('non-interactive') !== '');
							}
							break;
					}

					pointedIndexY = tryingRow;
					if (item)
					{
						pointedIndexX = tryingColumn;
						if (foundDifferentItem)
						{
							selectItem(item);
						}
					}

					var newSelecteItemLeft = selectedItem.$element.offset().left;
					if (newSelecteItemLeft < 0)
					{
						var destination = abstract.currentPosition - gridWidth + newSelecteItemLeft + selectedItem.$element.width() + tilesSize / 2;
						if (FIX_RENDERING_ISSUES) destination = Math.round(destination);
						$grid.iOSScrollSatorisan('scrollTo', destination);
						accomodating = true;
						clearTimeout(accomodatingTimeout);
						accomodatingTimeout = setTimeout(function()
						{
							accomodating = false;
						}, 500)
					}
					else if (newSelecteItemLeft + selectedItem.$element.width() > gridWidth)
					{
						var destination = abstract.currentPosition + newSelecteItemLeft - tilesSize / 2;
						if (FIX_RENDERING_ISSUES) destination = Math.round(destination);
						$grid.iOSScrollSatorisan('scrollTo', destination);
						accomodating = true;
						clearTimeout(accomodatingTimeout);
						accomodatingTimeout = setTimeout(function()
						{
							accomodating = false;
						}, 500)
					}
				}
				else
				{
					pointedIndexX = Math.floor((abstract.currentPosition - offsetedZero + gridWidth / 2 ) / tilesSize);
					pointedIndexY = Math.floor(gridHeight / 2 / tilesSize);
					lastSelectionDoneByKeyboard = true;
					
					item = getItemOnCell(pointedIndexX + matrixZeroOffset, pointedIndexY);
					selectItem(item);
				}
			}
		}
		else
		{
			switch (e.keyCode)
			{
				case 39: // right
					nextContent();
					break;
				case 37: // left
					previousContent();
					break;
				case 27: // Escape
					closeContent();
					break;
				default:
					//console.log(e.keyCode);
					break;
			}
		}
	}

	var done = false;

	function scrollUpdateHandler(e)
	{
		/*var virtualScrollValue = e.position - offsetedZero;
		
		if (!done && Math.abs(virtualScrollValue) >= ACCOMODATE_SCROLL_EVERY)
		{
			done = true;
			var way = virtualScrollValue / Math.abs(virtualScrollValue);
			var tilesToEliminate = Math.floor(ACCOMODATE_SCROLL_EVERY / tilesSize);
			var pixelsToEliminate = tilesToEliminate * tilesSize;
			
			matrixZeroOffset += tilesToEliminate * way;
			for (var i = 0; i < sortedGroups.length; i++)
			{
				var group = sortedGroups[i];
				for (var j = 0; j < group.length; j++)
				{
					var item = group[j];
					item.indexX -= tilesToEliminate * way;
					
					item.$element.css({left: Number(item.$element.css('left').split('px').join('')) - pixelsToEliminate * way + 'px'});
				}
			}
			
			$grid.iOSScrollSatorisan('setTo', e.position - pixelsToEliminate * way);
		}*/
		setcurrentColumnIndex(e.position);
		updateGroups();
	}

	function createGrid()
	{
		calculateSize(gridHeight);
		createPages(gridWidth);
		initialSort();
	}

	function clearGrid()
	{
		for (var i = 0; i < sortedGroups.length; i++)
		{
			var group = sortedGroups[i];
			for (var j = 0; j < group.length; j++)
			{
				group[j].$element.remove();
			}
		}
		
		sortedGroups = [];
		elementsMatrix = [];
		firstFilledColumn = NaN;
		lastFilledColumn = NaN;
		matrixZeroOffset = 0;
	}

	var resizing = false;
	var resizeTimeout;
	SatorisanGrid.updateDimensions = function(_width, _height)
	{
		gridWidth = _width;
		gridHeight = _height;

		if (lastHeight != gridHeight)
		{
			if (!detailOpened)
			{
				if (!resizing)
				{
					resizing = true;
					var totalHideDuration = hideItems(false);
					resizeTimeout = setTimeout(function()
					{
						replaceGrid();
						hideItems(null, false, true);
						showItems();
						resizing = false;
					},
					totalHideDuration + 100);
				}
			}
			else
			{
				if (resizing)
				clearTimeout(resizeTimeout);

				replaceGrid();
				hideItems(null, false, true);
			}
			lastHeight = gridHeight;
		}
	}

	SatorisanGrid.destroy = function()
	{
		if ($grid)
		{
			$window.unbind('resize', updateContent);

			$contentItems = null;

			$contentControls = null;

			$gridContent = null;

			$window.unbind('keydown', keydownHandler);

			sortedGroups = [];

			originalItems = [];
			originalItems2 = [];

			prepositionedItems = [];

			$grid.iOSScrollSatorisan('destroy');

			$grid = null;
			$gridMover = null;

			elementsMatrix = [];

			tilesPerPage = 0;
			firstFilledColumn = NaN;
			lastFilledColumn = NaN;
			matrixZeroOffset = 0;
		}

		$imagesToLoad.each(function()
		{
			onImageLoad_Remove(this, imageLoadHandler);
		});
	}

	function replaceGrid()
	{
		$grid.iOSScrollSatorisan('onUpdate', null);
		clearGrid();
		calculateSize(lastHeight);
		createGrid();
		$grid.iOSScrollSatorisan('onUpdate', scrollUpdateHandler);
	}

	function hideItems(rightToLeft, random, immediate, delay, duration)
	{
		delay = delay ? delay : HIDE_DELAY;
		duration = duration ? duration : HIDE_DURATION;
		var minColumnToHide = Math.floor((abstract.currentPosition - offsetedZero) / tilesSize) + matrixZeroOffset;
		var maxColumnToHide = Math.floor((abstract.currentPosition + gridWidth - offsetedZero) / tilesSize) + matrixZeroOffset;
		var itemsToHide = [];
		for (var i = minColumnToHide; i <= maxColumnToHide; i++)
		{
			for (var j = 0; j < rows; j++)
			{
				var item = getItemOnCell(i, j);
				if (itemsToHide.indexOf(item) == -1)
				{
					itemsToHide.push(item);
					if (immediate)
					item.$element.css({opacity: 0});
					else
					{
						if (random)
						item.$element.stop(true).delay(delay * (Math.random() * (maxColumnToHide - minColumnToHide))).animate({opacity: 0}, {duration: duration, specialEasing: {opacity: 'easeInOutCubic'}});
						else
						{
							if (!rightToLeft)
							item.$element.stop(true).delay(delay * (i - minColumnToHide)).animate({opacity: 0}, {duration: duration, specialEasing: {opacity: 'easeInOutCubic'}});
							else
							item.$element.stop(true).delay(delay * (maxColumnToHide - i)).animate({opacity: 0}, {duration: duration, specialEasing: {opacity: 'easeInOutCubic'}});
						}
					}
				}
			}
		}
		return ((maxColumnToHide - minColumnToHide + 1) * delay + duration);
	}

	var detailOpened = false;
	var itemIndex;
	var openedItem;
	var $lastItemContent;
	var $openedItemContent;
	var $openedItemOffsetter;
	var $lastItemContentImage;
	var $openedItemContentImage;

	var lastReplaceWay;

	function openItem(item)
	{
		if (!detailOpened)
		{
			detailOpened = true;

			openedItem = item;

			showItemPreloader(item);

			$grid.iOSScrollSatorisan('disable');

			var itemNumber = item.$element.attr('class').split('item-')[1].split(' ')[0];
			$openedItemContent = $contentItems.filter('.item-' + itemNumber);
			$openedItemOffsetter = $openedItemContent.children('.offsetter');
			itemIndex = $contentItems.index($openedItemContent);

			createContentImage();

			onImageLoad($openedItemContentImage[0], showContent);
		}
	}

	function createContentImage()
	{
		$openedItemContentImage = $openedItemOffsetter.find('.bg-image');
		if (!$openedItemContentImage.length)
		{
			$openedItemContentImage = $('<img class="bg-image" src="' + $openedItemContent.attr('data-image') + '" />');
			$openedItemOffsetter.append($openedItemContentImage);

			var $shoes = $openedItemOffsetter.find('.hotspot .shoe');
			$shoes.each(function()
			{
				var $shoe = $(this);
				var $image = $('<img/>');
				$image.attr('src', $shoe.attr('data-src'));
				$shoe.append($image);
			})
		}
	}

	function showItemPreloader(item)
	{
		item.$preloader = $('<div class="preloader" />');
		item.$preloader.addClass(item.preloaderColor).css(
		{
			left: item.$element.width() - 1,
			width: item.$element.width() + 2
		});
		item.$mover.after(item.$preloader);
		item.$mover.animate({left: -item.$element.width()}, {duration: 350, specialEasing: {left: 'easeInOutCubic'}});
		item.$preloader.animate({left: -1}, {duration: 350, specialEasing: {left: 'easeInOutCubic'}});
	}

	function setContentDimensions()
	{
		var image = $openedItemContentImage[0];

		var naturalWidth = image.naturalWidth;
		var naturalHeight = image.naturalHeight;

		var xScale = gridWidth / naturalWidth;
		var yScale = gridHeight / naturalHeight;
		var scale = xScale > yScale ? xScale : yScale;

		var imageWidth = naturalWidth * scale;
		var imageHeight = naturalHeight * scale;

		$openedItemContentImage.css(
		{
			width: imageWidth,
			height: imageHeight,
			left: 0
		});

		$openedItemContent.css(
		{
			width: gridWidth,
			height: gridHeight
		});

		if ($openedItemContent.attr('data-align-top') !== undefined) {
		    $openedItemOffsetter.css(
			{
				width: imageWidth,
				height: imageHeight,
				left: (gridWidth - imageWidth) / 2,
				top: "-"+$openedItemContent.attr('data-align-top')+"%"
			});

		} else if ($openedItemContent.attr('data-align-bottom') !== undefined) {
		    $openedItemOffsetter.css(
			{
				width: imageWidth,
				height: imageHeight,
				left: (gridWidth - imageWidth) / 2,
				bottom: "-"+$openedItemContent.attr('data-align-bottom')+"%"
			});

		} else {
		    $openedItemOffsetter.css(
			{
				width: imageWidth,
				height: imageHeight,
				left: (gridWidth - imageWidth) / 2,
				top: (gridHeight - imageHeight) / 2
			});

		}

		$gridContent.css(
		{
			width: gridWidth,
			height: gridHeight
		});
	}

	function showContent()
	{
		setContentDimensions();

		$openedItemContentImage.css(
		{
			left: -gridWidth * TOUR_DE_FRANCE_EFFECT_RATIO
		});

		$openedItemContent.css(
		{
			display: 'block',
			left: gridWidth
		});

		$gridContent.css(
		{
			display: 'block'
		})

		var hideTime = hideItems(true, true, false, 50, 500);
		setTimeout(function()
		{
			setHotspotsDirection();
			$window.resize(updateContent);
			$openedItemContent.stop(true).animate({left: 0}, {duration: 700, specialEasing: {left: 'easeInOutCubic'}, complete: contentShownHandler});
			$openedItemContentImage.stop(true).animate({left: 0}, {duration: 700, specialEasing: {left: 'easeInOutCubic'}});
		}, hideTime);
	}
	function updateContent()
	{
		setContentDimensions();
		setHotspotsDirection();
	}

	function contentShownHandler()
	{
		showHotspots();
		showContentControls();
		resetOpenedItem();
	}

	function resetOpenedItem()
	{
		openedItem.$mover.css('left', 0);
		openedItem.$preloader.remove();
	}

	function setHotspotsDirection()
	{
		$openedItemContent.find('.hotspot').each(function()
		{
			var $hotspot = $(this);
			var $content = $hotspot.find('.content');
			var hotspotTop = $hotspot.offset().top;
			if (hotspotTop < 300)
			$content.addClass('down');
			else
			$content.removeClass('down');
		})
	}

	function showHotspots()
	{
		$openedItemContent.find('.hotspots').stop(true).animate({opacity: 1}, {duration: 300, specialEasing: {opacity: 'easeInOutCubic'}});
	}

	function hideHotspots($content)
	{
		$content.find('.hotspots').stop(true).animate({opacity: 0}, {duration: 300, specialEasing: {opacity: 'easeInOutCubic'}});
	}

	var showControlsTimeout;
	function showContentControls()
	{
		$closeButton.removeClass('hidden');
		showControlsTimeout = setTimeout(function()
		{
			$nextButton.removeClass('hidden');
			$previousButton.removeClass('hidden');
		}, 300);
	}

	function hideContentControls()
	{
		clearTimeout(showControlsTimeout);
		$contentControls.addClass('hidden');
	}

	var replacingContent = false;
	function nextContent()
	{
		if (!replacingContent)
		{
			replacingContent = true;

			$lastItemContent = $openedItemContent;
			$lastItemContentImage = $openedItemContentImage;

			showContentPreloader();

			lastReplaceWay = 1;
			itemIndex += lastReplaceWay;

			if (itemIndex >= $contentItems.length)
			itemIndex = 0;

			$openedItemContent = $contentItems.eq(itemIndex);
			$openedItemOffsetter = $openedItemContent.children('.offsetter');

			createContentImage();
			onImageLoad($openedItemContentImage[0], replaceContent);
		}
	}

	function previousContent()
	{
		if (!replacingContent)
		{
			replacingContent = true;

			$lastItemContent = $openedItemContent;
			$lastItemContentImage = $openedItemContentImage;
			
			showContentPreloader();

			lastReplaceWay = -1;
			itemIndex += lastReplaceWay;

			if (itemIndex < 0)
			itemIndex = $contentItems.length - 1;

			$openedItemContent = $contentItems.eq(itemIndex);
			$openedItemOffsetter = $openedItemContent.children('.offsetter');

			createContentImage();
			onImageLoad($openedItemContentImage[0], replaceContent);
		}
	}


	var replaceContentTimeout;
	function replaceContent()
	{
		hideHotspots($lastItemContent);

		hideContentPreloader();

		setContentDimensions();

		$openedItemContent.css(
		{
			display: 'block',
			left: gridWidth * lastReplaceWay
		});

		$openedItemContentImage.css(
		{
			left: -TOUR_DE_FRANCE_EFFECT_RATIO * gridWidth * lastReplaceWay
		})

		setHotspotsDirection();

		replaceContentTimeout = setTimeout(function()
		{
			$lastItemContent.stop(true).animate({left: -gridWidth * lastReplaceWay}, {duration: 700, specialEasing: {left: 'easeInOutCubic'}});
			$lastItemContentImage.stop(true).animate({left: TOUR_DE_FRANCE_EFFECT_RATIO * gridWidth * lastReplaceWay}, {duration: 700, specialEasing: {left: 'easeInOutCubic'}});
			$openedItemContent.stop(true).animate({left: 0}, {duration: 700, specialEasing: {left: 'easeInOutCubic'}, complete: itemReplacedHandler});
			$openedItemContentImage.stop(true).animate({left: 0}, {duration: 700, specialEasing: {left: 'easeInOutCubic'}});
		}, 310);
	}

	function itemReplacedHandler()
	{
		replacingContent = false;
		showHotspots();
	}

	function showContentPreloader()
	{
		globalBus.publish( 'satorisan', 'preloader-show', { mono:true, delay: 200 } );
	}

	function hideContentPreloader()
	{
		globalBus.publish( 'satorisan', 'preloader-hide');
	}

	function closeContent()
	{
		hideHotspots($openedItemContent);
		hideContentControls();
		$window.unbind('resize', updateContent);
		$openedItemContent.stop(true).delay(310).animate({left: gridWidth}, {duration: 700, specialEasing: {left: 'easeInOutCubic'}, complete: contentClosedHandler});
		$openedItemContentImage.stop(true).delay(310).animate({left: -TOUR_DE_FRANCE_EFFECT_RATIO * gridWidth}, {duration: 700, specialEasing: {left: 'easeInOutCubic'}});
	}

	function contentClosedHandler()
	{
		$gridContent.css(
		{
			display: 'none'
		})
		$openedItemContent.css(
		{
			display: 'none'
		})
		showItems(false, true, 50, 500);
		$grid.iOSScrollSatorisan('enable');
		detailOpened = false;
	}

	// OriginalItem
	function Item($item)
	{
		this.rows = Number($item.attr('data-rows'));
		this.columns = Number($item.attr('data-cols'));
		this.tilesCount = this.rows * this.columns;

		this.indexX = NaN;
		this.indexY = NaN;

		this.minDistance = Number($item.attr('data-min-distance'));
		this.avoidGroup = $item.attr('avoid-group');

		this.$element = $item;
	}
}
)(jQuery);
Hydra.module.register( 'preloader', function( bus ){ 
        
        /*-------------------------------*/
        /* PRELOADER */
        /*-------------------------------*/

		var MIN_TIME_SHOW = 2000;
        var $preloader,$total,$loaded,$this,DELAY_GENERIC=10000,isActive=false;
		var showTime, timeoutStart;
				

        return {
            
            init: function(){
                $this = this;
                bus.subscribe('satorisan', this);
                this.append();
            },
			
			/*-------------------------------*/

            append: function(){            	
            	var markup = "<div id='preloader'><div class='preloader-header'><div class='preloader-header-container'></div></div><div class='preloader-line-loaded'></div><div class='preloader-line-total'></div><div class='preloader-footer'><div class='preloader-footer-container'></div></div></div>"; 
                $overlay.append(markup);
                $preloader = $("#preloader");
                $loaded = $preloader.find(".preloader-line-loaded");
                $total = $preloader.find(".preloader-line-total");

                $window.bind("resize", $this.resize);
            },

            /*-------------------------------*/

            oEventsCallbacks: {
                'preloader-show' : function (data)
				{
					var d=0;
                    if (data)
                    {
                        if (data.delay) d = data.delay;
                    }

                    timeoutStart = setTimeout(function(){
                        showTime = (new Date()).getTime();
                        isActive = true;   
                        $blocker.show();
                        $loaded.css({opacity:1});
                        $total.css({opacity:1});
                        $this.show(data);
                    },d);
                },

                'preloader-update' : function (data) { 
                    this.update(data);
                },

                'preloader-hide' : function (data) {
                    clearTimeout(timeoutStart);

                    isActive = false;
                    var d = data;
                    
                    var loadedDelay = 250;
                    

                    
                    if ( $loaded.width() == $window.width()) loadedDelay = 0;

                    $loaded.stop();
                    
					var delay = 0;
					var currentTime = (new Date()).getTime();
					var timeDifference = currentTime - showTime;
					if (timeDifference < MIN_TIME_SHOW)
					delay = MIN_TIME_SHOW - timeDifference;
					
                    var duration = 350;

                    if (d)
                    {
                        if (d.delay) delay = d.delay;
                        if (d.mono)
                        {
                            loadedDelay = 0;
                            duration = 0;
                        }
                    }

					$loaded.delay(delay).animate ( {width:"100%"}, {duration:loadedDelay, complete:function(){
						$preloader.find(".preloader-header .preloader-header-container").stop().animate( {top:110}, {duration:duration} );
						$preloader.find(".preloader-footer .preloader-footer-container").stop().animate( {marginTop:-110}, {duration:duration, complete:function(){
							$loaded.animate({opacity:0}, {duration:250});
                            $total.animate({opacity:0}, {duration:250, complete:function(){
                                $preloader.stop().animate( {opacity:0}, {duration:250, complete:function(){
    								$preloader.hide();
    								$blocker.hide();                                     
    								if (d){
                                     if (d.complete) d.complete();   
                                    }
    							}} );
                            }});
						}} );
					}}); 
                }
            },

            /*-------------------------------*/

            update:function(data)
            {
                if (isActive)
                {
                    $loaded.stop().animate ( {width:data.rate+"%"}, {duration:250, complete:function(){
                        $loaded.animate( {width:"100%"}, {duration:100000} )
                    }});
                }
            },

            /*-------------------------------*/

            show: function(data){
                
                if (data)
                {
                    if (data.mono)
                    {
                        $preloader.addClass("mono");
                    }
                    else
                    {
                        $preloader.removeClass("mono");
                    }
                }
                else
                {
                    $preloader.removeClass("mono");
                }

                $preloader.find(".preloader-header .preloader-header-container").html("");
                $preloader.find(".preloader-footer .preloader-footer-container").html("");
                $preloader.find(".preloader-header").removeClass("white-logo");
                $preloader.find(".preloader-header").removeClass("black-logo");
                if (data)
                {
                    if (data.header == null || data.header == "")
                    {
                        if (data.black)
                        {
                            $preloader.find(".preloader-header").addClass("black-logo");
                        }
                        else
                        {
                            $preloader.find(".preloader-header").addClass("white-logo");
                        }

                    }
                    else
                    {
                        if (data.header)
                        {
                            if (typeof data.header == "object")
                            {
                                $preloader.find(".preloader-header .preloader-header-container").append(data.header);
                            }
                            else
                            {
                                $preloader.find(".preloader-header .preloader-header-container").html(data.header);
                            }
                            //$preloader.find(".preloader-header .preloader-header-container").html(data.header);
                            $preloader.find(".preloader-header .preloader-header-container").css( { top : 110}).animate( {top:0}, {duration:250} );
                        }
                        if (data.footer)
                        {
                            $preloader.find(".preloader-footer .preloader-footer-container").html(data.footer);
                            $preloader.find(".preloader-footer .preloader-footer-container").css( { marginTop : -110}).animate( {marginTop:0}, {duration:250} );
                        }
                    }
                }
                else
                {
                    $preloader.find(".preloader-header").addClass("white-logo");
                }
                $blocker.show();
                $loaded.stop();
                $loaded.css( {width:0});
                $total.css( {width:0}).animate({width:"100%"}, {duration:150});
                $loaded.animate( {width:"100%"}, {duration:100000} )
                $preloader.stop().css( {opacity:0} ).show().animate( {opacity:1}, {duration:150, complete:function(){
                    if (data)
                    {
                        if (data.complete) data.complete();
                    }
                }} );

                $this.resize();
            },

            /*-------------------------------*/

            hide: function(){
                
                $preloader.hide();
            },

            /*-------------------------------*/

            resize: function()
            {
                $preloader.css( { marginTop : 0-($preloader.height()/2)} );
            }

            /*-------------------------------*/

        
        }
    
});



var SelectOptions;

(function($)
{

	SelectOptions = function(_config)
	{
		
		this.config = _config;
		this.selectedContainer = $(this.config.selectedSelector);
		this.prev =  $(this.config.arrowsSelector).find(".prev");
		this.next =  $(this.config.arrowsSelector).find(".next");
		this.current = 0;
		$this = this;


		/*----------------------------------------*/

		this.init = function()
		{
			this.selectedContainer.html( "<div class='mask' style='position:relative;overflow:hidden;height:11px;width:auto;'><div class='select-option' style='position: absolute;top: 0;right: 30px;'>" + this.config.options[0] + "</div></div>" );
			this.prev.bind(CLICK_EVENT, $this.prevOption);
			this.next.bind(CLICK_EVENT, $this.nextOption);

		}

		/*----------------------------------------*/

		this.prevOption = function(e)
		{
			e.preventDefault();
			
			if ($this.current > 0)
			{
				$this.current--;
			}
			else
			{
				$this.current = $this.config.options.length-1;	
			}

			$this.selectedContainer.find(".mask").append("<div class='select-option' style='position: absolute;top: -11px;right: 30px;'>" + $this.config.options[$this.current] + "</div>");
			$this.selectedContainer.find(".select-option").each(function(){
				$(this).animate( {top:$(this).position().top + 11}, 150);
			});

			setTimeout(function(){
				$this.selectedContainer.find(".select-option").eq(0).remove();
			}, 150);

			$this.config.changeCallback($this.config.options[$this.current]);

			return false;
		}

		/*----------------------------------------*/

		this.nextOption = function(e)
		{
			e.preventDefault();
			
			if ($this.current < $this.config.options.length-1)
			{
				$this.current++;
			}	
			else
			{
				$this.current = 0;
			}

			$this.selectedContainer.find(".mask").append("<div class='select-option' style='position: absolute;top: 11px;right: 30px;'>" + $this.config.options[$this.current] + "</div>");
			$this.selectedContainer.find(".select-option").each(function(){
				$(this).animate( {top:$(this).position().top - 11}, 150);
			});

			$this.config.changeCallback($this.config.options[$this.current]);

			setTimeout(function(){
				$this.selectedContainer.find(".select-option").eq(0).remove();
			}, 150);

			return false;
		}

		/*----------------------------------------*/

		this.init();

		/*----------------------------------------*/
	}

	


})
(jQuery)

var Timeline;

(function($)
{

	var steps,$container,$played,$selector,current,stepWidth,onStepCallback,onEndCallback,interruptCallback,isMouseUpBlocked=false,isMouseDownSelector=false,isInProgress=false,last=0, isResume=false,currentState,currentDirection,timer,newDelay;

	Timeline = function(config)
	{
		
		var $this;	
		steps = config.steps;
		
		current = 0;

		/*----------------------------------------*/

		this.append = function()
		{
			$this = this;
			$this.onStepCallback = config.onStepCallback;
			$this.onEndCallback = config.onEndCallback;
			$this.interruptCallback = config.interruptCallback;
			if ($('.timeline-widget').length > 0) $('.timeline-widget').remove();
			$(".section-wrapper.home").append("<div class='timeline-widget'><div class='line'><div class='overlay-green'></div><div class='black'></div></div></div>");
			$container = $('.timeline-widget');
			
			//$selector = $container.find(".timeline-selector-item");
			
			var linesMarkup = "<div class='lines'>";
			var left = 0;
			for ( var i=0;i<steps;i++)
			{
				var first = "";
				if (i==0) first = "first";
				linesMarkup += "<div class='step " + first + "' style='position:absolute;left:"+left+"px;width:" + Math.floor($window.width()/steps) + "px;'><div class='played'></div></div>";
				left+=Math.floor($window.width()/steps);
			}		

			linesMarkup += "</div>";
			
			$container.append(linesMarkup);
			$window.bind("resize", $this.resize);
			$this.resize();
			
			$played = $container.find(".played");

			$played.css ( {width:0, "opacity" : 0 } );

			//$this.createDrag();

			this.nextStep();

			$container.animate ({bottom:93}, {duration:250});
		},

		/*----------------------------------------*/

		this.pause = function()
		{
			isResume = true;
			var diff = new Date().getTime() - timer;
			newDelay = HOME.stepTime - diff;			
			$played.stop();
		}

		/*----------------------------------------*/

		this.resume = function()
		{
			isResume = false;

			/*if (currentState=="stop")
			{
				$this.stopAnimationResume(currentDirection);
			}
			else
			{
				$this.gotoResume(current);
			}*/

			$this.gotoResume(current);
		}

		/*----------------------------------------*/

		this.positionNextTransition = function(){
			$played.stop().animate( { opacity:0}, {duration:250});
		}

		/*----------------------------------------*/

		this.nextStep = function(){
			$played.stop().eq(current).css({"opacity" : 1}).animate( { width:stepWidth}, {duration:HOME.stepTime, complete:$this.nextStepComplete} );			
		}

		/*----------------------------------------*/

		this.nextStepComplete = function(){
			if (isResume == false)
			{
				if ( current == steps - 1 )
				{
					//$played.css ( { width:0 } );
					//$selector.stop().animate( {left:-19}, {duration:100} );
					//$played.stop().animate( {width:0}, {duration:100} );
					current=0;
					$this.onStepCallback(current);
				}
				else
				{
					current++;
					$this.onStepCallback(current);	
				}
			}
		}

		/*----------------------------------------*/

		this.renderBackground = function(){
			if (isMouseDownSelector)
			{
				//$played.css ( { width:$selector.position().left+15 } );
			}
		}
		
		
		/*----------------------------------------*/

		this.createDrag = function()
		{
			//$selector.draggable({ axis: "x", left:0, containment:".timeline-drag-area" });
		},
	
		/*----------------------------------------*/

		this.resize = function()
		{
			stepWidth = Math.floor($window.width()/steps);
			var leftPos = 0;
			$(".step").each(function(index){
				$(this).css( {
					width:stepWidth,
					left:leftPos
				} );
				leftPos+=stepWidth;
			});
			
		}

		/*----------------------------------------*/

		this.stopAnimation = function(direction)
		{
			currentDirection = direction;
			currentState = "stop";

			if (isResume==false)
			{
				if (isInProgress==false)
				{
					
					if (direction==1)
					{
						$played.stop().animate( { width:0, marginLeft:stepWidth}, {duration:250, complete:function(){
							$played.hide();
						}});
					}
					else
					{
						$played.stop().animate( { width:0 }, {duration:250, complete:function(){
							$played.hide();
						}});	
					}
				}
				else
				{
					if (direction==1)
					{
						$played.stop().animate( { width:stepWidth}, {duration:250, complete:function(){
							$played.stop().animate( { marginLeft:stepWidth, width:0 }, {duration:250, complete:function(){
								$played.hide();
							}});
						}});
					}
					else
					{
						$played.stop().animate( { width:0}, {duration:250, complete:function(){
							$played.hide();
						}});
					}
				}
			}
		}

		/*----------------------------------------*/

		this.stopAnimationResume = function(direction)
		{
			currentDirection = direction;
			currentState = "stop";

			if (isResume==false)
			{
				if (isInProgress==false)
				{
					
					if (direction==1)
					{
						$played.stop().animate( { width:0, marginLeft:stepWidth}, {duration:250, complete:function(){
							$played.hide();
						}});
					}
					else
					{
						$played.stop().animate( { width:0 }, {duration:250, complete:function(){
							$played.hide();
						}});	
					}
				}
				else
				{
					if (direction==1)
					{
						$played.stop().animate( { width:stepWidth}, {duration:250, complete:function(){
							$played.stop().animate( { marginLeft:stepWidth, width:0 }, {duration:250, complete:function(){
								$played.hide();
							}});
						}});
					}
					else
					{
						$played.stop().animate( { width:0}, {duration:250, complete:function(){
							$played.hide();
						}});
					}
				}
			}
		}

		/*----------------------------------------*/

		this.goto = function(index)
		{
			
			currentState = "go";
			if (isResume==false)
			{
				timer = new Date().getTime(), time = 0, elapsed = '0.0';
				isInProgress = true;
				$played.css( { marginLeft:0 } );
				current = index;
				last = current;
				$played.stop().animate( { opacity:0}, {duration:250});
				$played.hide();
				$played.eq(current).show();
				$played.eq(current).stop().css({"opacity" : 1, width:0}).animate( { width:stepWidth}, {duration:HOME.stepTime, complete:function(){
					isInProgress = false;
					
					$this.nextStepComplete();
				}} );	
			}
		}

		/*----------------------------------------*/

		this.gotoResume = function(index)
		{
			var sw = false;
			$played.stop().animate( { width:stepWidth}, {duration:newDelay, complete:function(){
					if (sw==false)
					{
						isInProgress = false;
						$this.nextStepComplete();
						sw = true;
					}
			}} );

		}

		/*----------------------------------------*/

		this.destroy = function()
		{
			$window.unbind("resize", $this.resize);
			$this = null;
			//$selector.stop();
			$played.stop();
			/*$selector.unbind(MOUSE_DOWN, this.mouseDownEvent);
			$selector.unbind(MOUSE_UP_EVENT, this.mouseUpEvent);
			$(document).unbind(MOUSE_UP_EVENT, this.mouseUpEvent);
			$(document).unbind(MOUSE_MOVE, this.renderBackground);*/
			$('.timeline-widget').remove();
		}

		this.append();

		/*----------------------------------------*/
	}

	


})
(jQuery)
Hydra.module.register( 'language-switcher', function( bus ){ 
        
        /*----------------------------------------*/
        /* LANGUAGE SWITCHER */
        /*----------------------------------------*/

        var $button,$menu,$switcher,$this,languageToChange, regionToChange, isActive=false;

        return {

            /*----------------------------------------*/

            init: function(){
                bus.subscribe('satorisan', this);
                $this = this;
                $button = $("a.language");
                $button.bind (CLICK_EVENT, this.clickButton);
                this.appendSelectors();
            },

            /*-------------------------------*/

            oEventsCallbacks: {

                'destroy-miscelanea-page' : function(data)
                {
                    if (isActive)
                    {
                        $this.destroySection(data);
                    }
                },

                'destroy-popup' : function ()
                {  
                    if (isActive)
                    {
                        $this.destroySection();
                    }
                }
                   
            },            

            /*----------------------------------------*/

            appendSelectors: function()
            {
                var satirisanRegion = user.SHIPPING_REGION;

                if (satirisanRegion == "spain")
                {
                    satirisanRegion = "Satorisan Spain";
                }

                if (satirisanRegion == "international")
                {
                    satirisanRegion = "Satorisan International";
                }

                if (satirisanRegion == "europe")
                {
                    satirisanRegion = "Satorisan Europe";
                }

                var MARKUP = "<div id='switcher-language-container'><div class='language-layout'><div class='iconos close-iframe close-language' style='right:0 !important;'><span></span></div><div class='language-layout-wrapper'><div class='languate-title'><span class='icon_global'></span>" + DICTIONARY[CURRENT_LANGUAGE].languagetitle + "</div><div class='languate-push'>" + DICTIONARY[CURRENT_LANGUAGE].languagepush1 + "<b>" + user.SHIPPING_NAME + "</b>" + DICTIONARY[CURRENT_LANGUAGE].languagepush2 + "<b>" + satirisanRegion + "</b><br />" + DICTIONARY[CURRENT_LANGUAGE].languagepush3 + "</div><div id='shipping-selector'></div><div id='language-selector'></div><br style='clear:both'><div class='remember'><input type='checkbox' name='remember' id='remember' value='1'><label for='remember'><span></span>" + DICTIONARY[CURRENT_LANGUAGE].remembersettings + "</label></div><div id='validate-language' class='button'>" + DICTIONARY[CURRENT_LANGUAGE].validate + "</div><br style='clear:both'></div></div>";
                $overlay.append(MARKUP);

                $overlay.find("#validate-language").bind(CLICK_EVENT, this.validate);

                $switcher = $('#switcher-language-container');

                $overlay.find(".close-language").bind(CLICK_EVENT, this.destroySection);                
                
                var shippingSelectorMarkup = "<select name='shipping' class='shipping-select'>";
                var spain1Selected="";
                var spain2Selected="";

                if (user.SHIPPING_CODE == "ES") spain1Selected = "selected";
                if (user.SHIPPING_CODE == "ES_CCM") spain2Selected = "selected";

                shippingSelectorMarkup += "<option region='" + countriesShipping[0][0]._region + "' value='" + countriesShipping[0][0]._cid + "' "+spain1Selected+">" + countriesShipping[0][0]._cname + "</option>";
                shippingSelectorMarkup += "<option region='" + countriesShipping[0][1]._region + "' value='" + countriesShipping[0][1]._cid + "' "+spain2Selected+">" + countriesShipping[0][1]._cname + "</option>";
                shippingSelectorMarkup += "<optgroup label='_____________________'></optgroup>";
                
                for (var i=2; i<countriesShipping[0].length; i++)
                {
                    var codeSelected = "";
                    if (user.SHIPPING_NAME == countriesShipping[0][i]._cname) codeSelected = "selected";
                    shippingSelectorMarkup += "<option region='" + countriesShipping[0][i]._region + "' value='" + countriesShipping[0][i]._cid + "' "+codeSelected+">" + countriesShipping[0][i]._cname + "</option>";
                }

                shippingSelectorMarkup += "</select>";

                var languageSelectorMarkup = "<select name='language' class='language-select'>";
                var esSelected = "";
                var enSelected = "";
                if (CURRENT_LANGUAGE == "es") esSelected = "selected";
                if (CURRENT_LANGUAGE == "en") enSelected = "selected";
                languageSelectorMarkup += "<option value='es' " + esSelected + ">Español</option>";
                languageSelectorMarkup += "<option value='en' " + enSelected + ">English</option>";    
                languageSelectorMarkup += "</select>";
                
                $switcher.find("#language-selector").append(languageSelectorMarkup);
                $switcher.find(".language-select").bind("change", this.changeLanguage);
              
                //$switcher.find("#logout").bind("click", this.logout);
                

                $switcher.find("#shipping-selector").append(shippingSelectorMarkup);
                $switcher.find(".shipping-select").bind("change", this.changeShipping);

                $switcher.hide();

                if(!$("body").hasClass("ipad") )
				{
					$(".shipping-select, .language-select").selectBoxIt(
							{ hideEffectSpeed:200, showEffectSpeed:200, 
								showEffect:"fadeIn", hideEffect:"fadeOut" } );
					$(".shipping-select").bind({
										"open": function() {
											$(document).unbind('touchmove');
										},
										"close": function() {
											$(document).bind('touchmove', function(e){
												e.preventDefault();
											});
										}
					});
				}
                //$(".language-select").selectBoxIt(
                  //      { "native": true } ).data("selectBoxIt");
                //var selectBox = $("select").selectBoxIt({"native": true}).data("selectBoxIt");
                
            },

            /*----------------------------------------*/

            logout:function()
            {
                $.ajax({
                  cache: true,
                  url: WEBSERVICES_PATH["logout"],
                  contentType: "application/x-www-form-urlencoded;charset=UTF-8",
                  success: function(data_json) {
                    document.location = location.pathname;
                  }
                });
            },

            /*----------------------------------------*/

            validate:function(){           
                CURRENT_LANGUAGE = $(".language-select").val();
                
                user.SHIPPING_CODE = $('#shipping-selector option:selected').val();
                user.SHIPPING_REGION = $('#shipping-selector option:selected').attr('region');
                user.SHIPPING_NAME = $('#shipping-selector option:selected').text();

                $.cookie("SHIPPING_CODE", user.SHIPPING_CODE, {domain:OPENSHOP_DOMAIN, path:"/"});
                $.cookie("SHIPPING_REGION", user.SHIPPING_REGION, {domain:OPENSHOP_DOMAIN, path:"/"});
                $.cookie("SHIPPING_NAME", user.SHIPPING_NAME, {domain:OPENSHOP_DOMAIN, path:"/"});
               
                
                document.location = "/" + CURRENT_LANGUAGE + "/home";
            },

            /*----------------------------------------*/

            changeLanguage:function()
            {
                regionToChange = $(this).val(); 
                /*var path = location.pathname;
                var newPath = "";
                if (CURRENT_LANGUAGE == "es"){
                    newPath = path.replace("/es/", "/en/");
                }
                else
                {
                    newPath = path.replace("/en/", "/es/");   
                }                


                document.location = newPath;*/

            },

            /*----------------------------------------*/

            changeShipping:function()
            {
                regionToChange = $(this).val();
                
                /*user.SHIPPING_CODE = $(this).val();
                user.SHIPPING_REGION = $('#shipping-selector option:selected').attr('region');
                user.SHIPPING_NAME = $('#shipping-selector option:selected').text();

                $.cookie("SHIPPING_CODE", user.SHIPPING_CODE, {domain:OPENSHOP_DOMAIN, path:"/"});
                $.cookie("SHIPPING_REGION", user.SHIPPING_REGION, {domain:OPENSHOP_DOMAIN, path:"/"});
                $.cookie("SHIPPING_NAME", user.SHIPPING_NAME, {domain:OPENSHOP_DOMAIN, path:"/"});
                
                document.location = "/" + CURRENT_LANGUAGE + "/home";*/
            },

            /*----------------------------------------*/

            clickButton: function(e)
            {
                e.preventDefault();
                if (isActive==false)
                {
                    bus.publish( 'satorisan', 'pause-page' );
                    if (user.MISCELANEA_WINDOW_OPEN)
                    {
                        
                        bus.publish("satorisan", "destroy-miscelanea-page", { keepOverlay:true, complete:function(){
                            bus.publish("satorisan", "menu-change-go", { dataRight:"language" });
                            $switcher.show();
                            
                                $switcher.find(".language-layout").animate( {height:325}, {easing:"easeInOutSine", duration:250, complete:function(){
                                    $(".language-layout").css( { "overflow" : "visible"} );
                                    bus.publish( 'satorisan', 'pause-page' );
                                }});
                            
                            isActive = true;       
                            user.MISCELANEA_WINDOW_OPEN = true;
                            $button.addClass("open");
                        }});
                    }
                    else
                    {
                        bus.publish("satorisan", "menu-change-go", { dataRight:"language" });
                        $switcher.show();
                            bus.publish("satorisan", "overlay-show", {complete:function(){
                                $switcher.find(".language-layout").animate( {height:325}, {easing:"easeInOutSine", duration:250, complete:function(){
                                    $(".language-layout").css( { "overflow" : "visible"} );
                                    bus.publish( 'satorisan', 'pause-page' );
                                }});
                            }})
                        
                        isActive = true;
                        user.MISCELANEA_WINDOW_OPEN = true;
                        $button.addClass("open");
                    }

                    $(".general-background-overlay").unbind(CLICK_EVENT).bind(CLICK_EVENT, $this.destroySection);
                }


                return false;
            },

            /*----------------------------------------*/

            destroySection:function(data){
                if (isActive)
                {
                    isActive = false;
                    if (data)
                    {
                        if (data.keepOverlay)
                        {

                        }
                        else
                        {
                            bus.publish("satorisan", "menu-change-go", { dataRight:"" });
                        }
                    }
                    
                    $switcher.find(".language-layout").css('overflow', 'hidden').animate( {height:0}, {easing:"easeInOutSine", duration:250, complete:function(){
						if (data)
                        {
                            if (data.keepOverlay)
                            {
                                $switcher.hide();
                                
                                user.MISCELANEA_WINDOW_OPEN = false;
                                
                                $button.removeClass("open");
                                if (data.complete) data.complete();
                            }
                            else
                            {
                                user.MISCELANEA_WINDOW_OPEN = false;
                                bus.publish("satorisan", "overlay-hide", {complete:function(){
									bus.publish( 'satorisan', 'resume-page' );
									if (data.complete) data.complete();   
                                }});
                            }
                        }
                        else
                        {
                            user.MISCELANEA_WINDOW_OPEN = false;
                            bus.publish("satorisan", "overlay-hide");
                        }
                            
                        
                    }});
                }
            }


            /*----------------------------------------*/

        }
    
});


var closeOpenedFilter;

Hydra.module.register( 'products-filter', function(bus)
{
        /*-------------------------------*/
        /* PRODUCTS FILTER */
        /*-------------------------------*/
        var $wrapper;
        var filterResults = {type: "", color: "", size: "", prize: ""};
        var $options;

        var currentFilter;
 
        var self;

        var optionsType;
        var tooltip;
        var tooltips = new Array();

        var $container;

        var isActive;

        var currentFilterType;

        var lastClickTime;

        return {

            init: function()
            {
                self = this; 
                bus.subscribe('satorisan', this);
            },
			
            /*-------------------------------*/

            oEventsCallbacks:
            {
                'append-products-filter': function()
                {
                    currentFilter = null;
                    this.append();
                    isActive = true;
                },
                
                'destroy-products-filter': function()
                {
                    this.stop();
                },

                'close-products-filter-open': function()
                {
                    this.closeOpened();
                }
            },

			/*-------------------------------*/

            append: function()
            {
                closeOpenedFilter = self.closeOpened;

                optionsType = ATTRIBUTES_FILTER[2];

                var MARKUP =
                "\
                    <div id='products-filter'>\
                        <div class='products-filter-wrapper'>\
                            <div id='type-selection' class='filter-field'>\
                                <div class='pin-selected'></div>\
                                <div class='categoria-text-over'>" + DICTIONARY[CURRENT_LANGUAGE].selectcategory + "</div>\
                                <div class='selected'>" + user.TYPE_PRODUCT + "</div>\
                                <div class='widget-selector'>\
                                    <div class='prev'></div>\
                                </div>\
                            </div>\
                            <div id='model-selection' class='filter-field'>\
                                <div class='pin-selected'></div>\
                                <div class='title'>" + DICTIONARY[CURRENT_LANGUAGE].model + "</div>\
                                <div class='selected gray'><%default_value%></div>\
                                <div class='widget-selector'>\
                                    <div class='prev'></div>\
                                </div>\
                            </div>\
                            <div id='color-selection' class='filter-field'>\
                                <div class='pin-selected'></div>\
                                <div class='title'><%color%></div>\
                                <div class='selected gray'><%default_value%></div>\
                                <div class='widget-selector'>\
                                    <div class='prev'></div>\
                                </div>\
                            </div>\
                            <div id='size-selection' class='filter-field'>\
                                <div class='pin-selected'></div>\
                                <div class='title'><%size%></div>\
                                <div class='selected gray'><%default_value%></div>\
                                <div class='widget-selector'>\
                                    <div class='prev'></div>\
                                </div>\
                            </div>\
                            <div id='prize-selection' class='filter-field'>\
                                <div class='pin-selected'></div>\
                                <div class='title'><%prize%></div>\
                                <div class='selected gray'><%default_value%></div>\
                                <div class='widget-selector'>\
                                    <div class='prev'></div>\
                                </div>\
                                <div class='line-item-right'></div>\
                            </div>\
                        </div>\
                    </div>\
                ";

                $footer.append(renderEJS(MARKUP, FILTER_TEXT[CURRENT_LANGUAGE]));
                $options = $(".filter-field");
				
				var $buttons = $footer.find('.products-filter-wrapper').children();
                $buttons.bind('tapone', this.filterOptionClick);

                $wrapper = $("#products-list-wrapper");

                $container = $("#products-filter");
                $container.css({bottom: -44}).animate({bottom: 28}, {duration:350, easing:"easeOutCubic"});

                $(".product-list .hover").unbind(MOUSE_ENTER, self.showTooltip).bind(MOUSE_ENTER, self.showTooltip);


                setTimeout(function()
                {
                    var tooltip1 = new Tooltip({offsetX: - $("#products-filter .products-filter-wrapper").width() / 2 + $("#type-selection").width() / 2 + 37, offsetY: 0, target: "#products-filter .products-filter-wrapper", markup: DICTIONARY[CURRENT_LANGUAGE].filtersBalloon, exitMode: "delay", exitTime: 10000});
                }, 1000);
            },

            /*-------------------------------*/

            itemsUp: function()
            {
				if ($.support.transition)
				{
					$wrapper.transition({top: '-33px', duration: 350});
				}
				else
				{
					$wrapper.animate({top: '-33px'}, {duration: 350});
				}
            },
            
            /*-------------------------------*/

            itemsDown: function()
            {
				if ($.support.transition)
				{
					$wrapper.transition({top: 0, duration: 350});
				}
				else
				{
					$wrapper.animate({top: 0}, {duration: 350});
				}
            },

            /*-------------------------------*/

            filterOptionClick: function()
            {
                var clickTime = (new Date()).getTime();

                var $clickedFilter = $(this);
                    
                var typeOption = $clickedFilter.attr("id");

                if
                (
                    (
                        clickTime - lastClickTime > 0
                        ||
                        !lastClickTime
                    )
                    &&
                    !$clickedFilter.hasClass('disabled')
                )
                {
                    lastClickTime = clickTime;

                    $(".filter-field").removeClass("active");

                    var openNewFilterFunction;

                    switch(typeOption)
                    {  
                        case "type-selection":
                            openNewFilterFunction = function()
                            {
                                currentFilter = new FilterItemsType(FILTER_TYPES_PRODUCTS[CURRENT_LANGUAGE], self.changeData, false);
                            }
                            break;

                        case "model-selection":
                            openNewFilterFunction = function()
                            {
                                currentFilter = new FilterModel(self.changeData);
                            }
                            break;

                        case "color-selection":
                            openNewFilterFunction = function()
                            {
                                currentFilter = new FilterColor(self.changeData);
                            };
                            break;

                        case "size-selection":
                            openNewFilterFunction = function()
                            {
                                currentFilter = new FilterSize(self.changeData);
                            }
                            break;

                        case "prize-selection":
                            openNewFilterFunction = function()
                            {
                                currentFilter = new FilterPrice(self.changeData);
                            };
                            break;
                    }

                    if (currentFilter)
                    {
                        if (currentFilterType == typeOption)
                        {
                            self.closeOpened();
                        }
                        else
                        {
                            if (currentFilterType == 'model-selection')
                            ProductsListPage.goToProducts();

                            currentFilter.destroy(function()
                            {
                                currentFilter = null;

                                setTimeout(function()
                                {
                                    openNewFilterFunction();
                                    $clickedFilter.addClass("active");
                                    currentFilterType = typeOption;

                                    if (currentFilterType == 'model-selection')
                                    ProductsListPage.goToModels();
                                }
                                , 20);
                            });
                        }
                    }
                    else
                    {
                        openNewFilterFunction();
                        $clickedFilter.addClass("active");
                        currentFilterType = typeOption;

                        if (currentFilterType == 'model-selection')
                        ProductsListPage.goToModels();
                        else
                        self.itemsUp();
                    }
                }
            },

            /*-------------------------------*/

            changeData: function()
            {
                if (user.TYPE_PRODUCT)
                {
                    $("#type-selection .selected").html(user.TYPE_PRODUCT);

                    self.animateFilter();

                    if (user.TYPE_PRODUCT == "ACCESORIES" || user.TYPE_PRODUCT == "ACCESORIOS")
                    {
                        $("#size-selection").addClass('disabled');
                        $("#model-selection").addClass('disabled');
                    }
                    else
                    {
                        $("#size-selection").removeClass('disabled');
                        $("#model-selection").removeClass('disabled');
                    }
                }

                if (user.SIZE)
                {
                    var finalSize = user.SIZE;
                    
                    if (user.SIZE_SYSTEM == "USA")
                    {
                        for (var i=0;i<FILTER_SIZE_UNITS["EUR"].length;i++)
                        {
                            if (finalSize == FILTER_SIZE_UNITS["EUR"][i])
                            {
                                finalSize = FILTER_SIZE_UNITS["USA"][i]
                            }
                        }
                    }

                    $("#size-selection .selected").removeClass("gray").html(user.SIZE_SYSTEM + " " + finalSize);                    
                }
                else
                {
                    $("#size-selection .selected").addClass("gray").html( DICTIONARY[CURRENT_LANGUAGE].all );
                }

                if (user.COLOR)
                {
                    $("#color-selection .selected").html( "<div class='color-block' style='background-color:"+FILTER_COLORS_HEX[user.COLOR-1]+"'></div>" );   
                }
                else
                {
                    $("#color-selection .selected").html( DICTIONARY[CURRENT_LANGUAGE].all );   
                }


                if (user.PRICE_RATE_MIN != FILTER_PRICES_MIN || user.PRICE_RATE_MAX != FILTER_PRICES_MAX)
                {
                    $("#prize-selection .selected").removeClass("gray").html( user.PRICE_RATE_MIN + "€-" + user.PRICE_RATE_MAX+"€" );      
                }
                else
                {
                   $("#prize-selection .selected").addClass("gray").html( DICTIONARY[CURRENT_LANGUAGE].all );      
                }

                bus.publish( 'satorisan', 'filter-products', filterResults );
            },

            /*-------------------------------*/

            showTooltip: function(e)
            {
                var index = $(".product-list .hover").index($(this));
                var $item = $(".product-list:eq("+index+")");

                if ($item.hasClass("inactive"))
                {
                    if (tooltips[index]==null)
                    {
                        var bottomMode = false;

                        if (Number($item.attr("row")) == 0)
                        bottomMode = true;

                        var template = $item.hasClass("inactive-all-sizes") ? DICTIONARY[CURRENT_LANGUAGE].outofstock_allSizes : DICTIONARY[CURRENT_LANGUAGE].outofstock;

                        var text = template.replace( "%product_id%", $item.attr("productId") )
                        tooltips[index] = new Tooltip( { bottomMode:bottomMode, enterMode:true, offsetY:50, offsetX:30, target: ".product-list .hover:eq("+index+")", markup: text, onComplete: function()
                        {
                            tooltips[index] = null;
                        }});
                                   
                    }
                    else
                    {
                        tooltips[index].reactive();
                    }
                    $("#stock-alert-btn").unbind().bind(CLICK_EVENT, self.stockAlertPopup)
                }
            },

            stockAlertPopup: function(e)
            {
                product_id = $(e.currentTarget).attr("productId");
                product_name = $(".product-list.product-id-"+product_id+" > span > .product-name").html();
                bus.publish( 'satorisan', 'append-page',
                {
                    content: "stock-alert",
                    id_size_product: product_id,
                    product_name: product_name,
                    size: user.SIZE,
                    size_chart: user.SIZE_SYSTEM
                });
            },

            /*-------------------------------*/

            closeOpened: function()
            {
                if (currentFilter)
                {
                    $(".filter-field").removeClass("active");
                    self.animateFilter();

                    if (currentFilterType != 'model-selection')
                    self.itemsDown();
                    else
                    ProductsListPage.goToProducts();

                    currentFilter.destroy();
                    currentFilter = null;
                    currentFilterType = null;
                }
            },

            /*-------------------------------*/

            animateFilter:function()
            {
                $("#type-selection .categoria-text-over").stop().animate({ left:  0 },{duration:200, complete:function(){
                    $("#type-selection .selected").css("display","block");
                    $("#type-selection .categoria-text-over").stop().animate({ opacity:0 },{ duration:250 } ); 
                    $("#type-selection .selected").stop().animate({ opacity:1 },{ duration:250 } ); 
                }});
            },

            /*-------------------------------*/

            stop: function(){
                if (isActive)
                {
                    if (currentFilter)
                    {
                        currentFilter.destroy(function(){});
                    }
                    $options.unbind(CLICK_EVENT, self.filterOptionClick);
                    $container.animate( {bottom:-44}, {duration:250, complete:function(){
                        $("#products-filter").remove();
                        isActive = false;    
                    }} );
                }
            }
            /*-------------------------------*/
        }
});

var FilterSize;

(function($)
{

	var $container;
    var $selector;

    var toolip1;
    var toolip2;
    var toolip3;

    var $dragArea;

    var STEPS = 13;
    var AREA_WIDTH_TOTAL = 1040;
    
    var callbackFunction;

    var currentSelection = 0;
    var options;
    var $options;

    var startInactive = false;

    var currentIndexSystem = 0;

    var isMouseDownSelector = false;

    var NUMBERS;
    var NUMBERS_INDEX;

    var timeoutTooltips;

	FilterSize = function(_callback, _isDetail, _activeSizes, _isLooseSize, _startInactive)
	{
		var indexSelected = 0;
		var $this;	
		this.systemSelector;
		callbackFunction = _callback;
		var isDetail=false;
		var activeSizes,isLooseSize;
		if (_isDetail) isDetail = true;
		
		if (_activeSizes) activeSizes = _activeSizes;
		if (_isLooseSize) isLooseSize = _isLooseSize;
		
		if (_startInactive == true)
		{startInactive = true; }
		else
		{startInactive = false;}



		/*----------------------------------------*/

		this.append = function()
		{
			$this = this;
			currentSelection = 0;
			user.IS_IN_SIZE_FILTER = true;

			var allText = DICTIONARY[CURRENT_LANGUAGE].all;

			if (isDetail)
			{
			//	allText = "";
				if (user.SIZE != 0)
				{
					user.DETAIL_SIZE = user.SIZE;
					currentSelection = user.DETAIL_SIZE;
				} 
				
				NUMBERS = activeSizes.split("-");
				NUMBERS_INDEX = new Array();

				for (var i=0; i<NUMBERS.length;i++)
				{
					for (var j=0; j<FILTER_SIZE_UNITS ["EUR"].length;j++)
					{
						if (NUMBERS[i] == FILTER_SIZE_UNITS ["EUR"][j])
						{
							NUMBERS_INDEX.push(j);
						}
					}	
				}
			}
			else
			{
				if (user.SIZE != 0)
				{
					currentSelection = 	user.SIZE;
				}
			}

			var MARKUP = "<div id='filter-size-widget' class='filter-widget'><div class='products-filter-final clearfix'><div class='products-filter-wrapper clearfix'>";
	        MARKUP += "<div class='filter-size-drag-area'><div class='filter-size-selector'><div class='cursor'></div><div class='background'></div><div class='green-line'></div></div></div>";
	        MARKUP += "<div class='option-value'><div class='green-background'></div><div class='line' style='background:#acacac'></div><div class='label'>" + allText + "</div></div>";
	        MARKUP += "</div></div><div class='size-system-wrapper'></div><div class='middle-line'></div></div>";

			if ( $("#product-detail").length>0 )
			{
				$("#product-detail").append(MARKUP);
			}

			if ( $(".section-wrapper.catalog").length>0 )
			{
				$footer.append(MARKUP);
			}

			$container = $("#filter-size-widget");

			if (!isDetail)
			{
				for (var i=0; i<FILTER_SIZE_UNITS[user.SIZE_SYSTEM].length; i++)
				{
					if (FILTER_SIZE_UNITS[user.SIZE_SYSTEM][i] != "")
					{
						$container.find(".products-filter-wrapper").append( "<div class='option-value'><div class='green-background'></div><div class='line' style='background:#acacac'></div><div class='label'>" + FILTER_SIZE_UNITS[user.SIZE_SYSTEM][i] + "</div></div>" );
					}
				}
			}
			else
			{
				
				for (var i=0; i<NUMBERS.length-1; i++)
				{
					$container.find(".products-filter-wrapper").append( "<div class='option-value' style='width:" + (87.9/(NUMBERS.length)) + "%;'><div class='green-background'></div><div class='line' style='background:#acacac'></div><div class='label'>" + FILTER_SIZE_UNITS[user.SIZE_SYSTEM][NUMBERS_INDEX [i] ] + "</div></div>" );					
				}

				$container.find(".products-filter-wrapper .option-value").css( { width:(87.9/(NUMBERS.length)) + "%" } );
			}

			var x = 1;
			if (isDetail) x = 0;

			$(".products-filter-wrapper:eq("+x+")").append("<div class='system-filter'><div class='system-filter-inside'>"+user.SIZE_SYSTEM+"</div></div>");

			$selector = $(".filter-size-selector");
			DragCursor.open($selector);

			$dragArea = $(".filter-size-drag-area");

			this.setValues();
			this.createDrag();			

			$selector.bind(MOUSE_DOWN, this.mouseDownEvent);
			$selector.bind(MOUSE_UP_EVENT, this.mouseUpEvent);
			$(document).bind(MOUSE_UP_EVENT, this.mouseUpEvent);

			var toY
			if (isDetail == false)
			{
				toY = 79;
			}
			else
			{
				toY = 79;
			}

			$container.css( { bottom:-15 } ).animate({ bottom:toY}, {duration:250, complete:function(){
				if ( user.SIZE_TOOLTIP_SHOWED == false )
				{
					timeoutTooltips = setTimeout(function(){
						user.SIZE_TOOLTIP_SHOWED = true;
						$this.showTooltip();
					},500);					
				}


				if (isLooseSize==1 && currentSelection!=0 && user.SIZE_SMALL_SHOWED == false)
				{
					user.SIZE_SMALL_SHOWED = true;
					
					var markupTooltip = renderEJS (FILTER_SIZE_SMALL_SIZE_TEXT[CURRENT_LANGUAGE], { next_size:FILTER_SIZE_UNITS[user.SIZE_SYSTEM][indexSelected-1] });
					clearTimeout(timeoutTooltips);

					if (toolip1)
					{
						toolip1.stop();
						setTimeout(function(){
							toolip3 = new Tooltip( {  offsetX:35, offsetY: -15, className:"small-size", target: ".filter-size-selector", markup:markupTooltip, dialogCallback:function(result){
								$this.gotToSmaller(result);
							}});
						},550);
					}
					else
					{
						toolip3 = new Tooltip( {  offsetX:35,  offsetY: -15, className:"small-size", target: ".filter-size-selector", markup:markupTooltip, dialogCallback:function(result){
							$this.gotToSmaller(result);
						}});			
					}
				}

			}});

			$options = $(".option-value");
			$options.bind (MOUSE_DOWN, this.gotoOption);
			
			if (currentSelection !=0 && currentSelection !=-1)
			{
				$(".option-value").each(function(index){

					if (isDetail == false)
					{
						if (currentSelection == FILTER_SIZE_UNITS["EUR"][index])
						{
							$(this).addClass("active");
							$selector.css( {left : (index  * $options.width() ) } );
						}
					}
					else
					{
						if (currentSelection == FILTER_SIZE_UNITS["EUR"][NUMBERS_INDEX[index]])
						{							
							indexSelected = index;
							$(".option-value").eq(index+1).addClass("active");
							
							if (startInactive == true){
								$(".option-value").eq(index+1).addClass("inactive");
							}
							
							$selector.css( {left : ( (index+1)  * $options.width() ) } );
						}
					}

				});	

				//callbackFunction(  );
			}
			else
			{
				$(".option-value").eq(0).addClass("active");
			}			

			/*$(".filter-size-selector .cursor").css( { marginLeft : ($(".option-value").width()/2) - (17) } );*/

			$(".system-filter").bind(CLICK_EVENT, this.changeSystem);

			$window.unbind("resize", $this.resize).bind("resize", $this.resize);
		}

		/*----------------------------------------*/	

		this.resize = function()
		{
			$this.setValues();
			var indexTo = 0;

			$selector.css( {left : (currentSelection * $options.width() ) + 2 } );
		},

		/*----------------------------------------*/	

		this.setValues = function()
		{
			$dragArea.css ({ "left" : 20 });
			$(".option-value").css( { width : (87.9/$(".option-value").length)+"%"} );
			$dragArea.css( { width : $(".option-value").width() * $(".option-value").length } );
			AREA_WIDTH_TOTAL = $dragArea.width();
			
			$(".filter-size-selector").css( { width : $(".option-value").width()} );
			
			
		}

		/*----------------------------------------*/	

		this.createDrag = function()
		{
			$selector.draggable({ axis: "x", left:0, containment:".filter-size-drag-area" });
		}

		/*----------------------------------------*/

		this.mouseDownEvent = function(e)
		{
			isMouseDownSelector	= true;
			DragCursor.closed($body);
		}

		/*----------------------------------------*/

		this.gotoOption = function(e)
		{
			if (toolip3) toolip3.stop();

			clearTimeout(timeoutTooltips);
			var index = $(".option-value").index($(this));
			if (index == 0)
			{
				if (isDetail)
				{
					user.DETAIL_SIZE = 0;
					user.SIZE = 0;
				}
				else
				{
					user.SIZE = 0;
				}
				currentSelection = 0;
			}
			else
			{
				if (isDetail)
				{
					user.DETAIL_SIZE = FILTER_SIZE_UNITS["EUR"][NUMBERS_INDEX[index-1]];
					user.SIZE = user.DETAIL_SIZE;
				}
				else
				{
					user.SIZE = FILTER_SIZE_UNITS["EUR"][index];
				}
				currentSelection = user.SIZE;
				
			}
					
			$selector.animate( {left : (index * $options.width() ) + 2 }, {duration:300, complete:function(){

				if(user.SIZE_SMALL_SHOWED==false)
				{
					
					var markupTooltip = renderEJS (FILTER_SIZE_SMALL_SIZE_TEXT[CURRENT_LANGUAGE], { next_size:FILTER_SIZE_UNITS[user.SIZE_SYSTEM][index-1] });
					clearTimeout(timeoutTooltips);

					if (isLooseSize==1 && index<$(".option-value").length-1)
					{
						user.SIZE_SMALL_SHOWED = true;

						if (toolip1)
						{
							toolip1.stop();
							


							setTimeout(function(){
								toolip3 = new Tooltip( {  offsetX:35, offsetY: -15, className:"small-size", target: ".filter-size-selector", markup:markupTooltip, dialogCallback:function(result){
									$this.gotToSmaller(result);
								}});
							},550);
						}
						else
						{
							toolip3 = new Tooltip( {  offsetX:35,  offsetY: -15, className:"small-size", target: ".filter-size-selector", markup:markupTooltip, dialogCallback:function(result){
								$this.gotToSmaller(result);
							}});			
						}
					}
					else
					{
						if (toolip1) toolip1.stop();
						callbackFunction(  );
					}

				}
				else
				{
					if (toolip1) toolip1.stop();
					callbackFunction(  );
				}

			} });

			
			$options.removeClass("active");
			$options.eq(index).addClass("active");	
			
			
		}

		/*----------------------------------------*/

		this.changeSystem = function()
		{

			if (currentIndexSystem < (FILTER_SIZE_UNITS.length-1))
			{
				currentIndexSystem++;
			}
			else
			{
				currentIndexSystem=0;
			}

			var systemText = getAttrByIndex(FILTER_SIZE_UNITS, currentIndexSystem);
			$(".system-filter-inside").html(systemText);
			
			if (user.SIZE_SYSTEM != systemText)
			{
				user.SIZE_SYSTEM = systemText;
				callbackFunction();
			}

			user.SIZE_SYSTEM = systemText;
			var sw = false;
			
			$container.find(".option-value .label").not(":first").animate( { "opacity" : 0 }, {duration:250, complete:function(){
				
				if (sw == false)
				{					
					$container.find(".option-value .label").each(function(index){
						if (index>0)
						{
							if (isDetail == false)
							{
								$(this).html( FILTER_SIZE_UNITS[systemText][index] );	
							}
							else
							{
								$(this).html( FILTER_SIZE_UNITS[systemText][NUMBERS_INDEX[index-1]] );	
							}
						}
					});

					$container.find(".option-value .label").animate( { "opacity" : 1 }, {duration:250});
				}

				sw = true;

			}} );

			
			
		}

		/*----------------------------------------*/
		var isMouseUpBlocked = false;

		this.mouseUpEvent = function(e)
		{
			if (isMouseUpBlocked==false && isMouseDownSelector==true)
			{
				if (toolip3) toolip3.stop();
				
				isMouseUpBlocked = true;

				e.preventDefault();

				var step = (AREA_WIDTH_TOTAL/STEPS);
				var currentX = $selector.position().left;

				var min = 9999;
				var target;
				var point = 0;

				for (var i=0 ; i<$(".option-value").length; i++)
				{
					if ( Math.abs (currentX - point) < min)
					{
						min = Math.abs (currentX - point);
						target = i;
					}

					point += ($dragArea.width()/$(".option-value").length);
				}

				var lastDetailSize;
				var lastSize;

				if (isDetail)
				{
					lastDetailSize = user.DETAIL_SIZE;
				}
				else
				{
					lastSize = user.SIZE;
				}
					
				if (target == 0)
				{
					if (isDetail)
					{
						user.DETAIL_SIZE = 0;
						user.SIZE = 0;
					}
					else
					{
						user.SIZE = 0;
					}
					currentSelection = 0;
				}
				else
				{
					if (isDetail)
					{
						user.DETAIL_SIZE = FILTER_SIZE_UNITS["EUR"][NUMBERS_INDEX[target-1]];
						user.SIZE = user.DETAIL_SIZE;
					}
					else
					{
						user.SIZE = FILTER_SIZE_UNITS["EUR"][target];
					}
					currentSelection = user.SIZE;
				}

				$selector.animate( {left : (target * $(".option-value").width() ) + 2 }, {duration:250, complete:function(){
					
					isMouseUpBlocked = false;						
					
					if(user.SIZE_SMALL_SHOWED==false)
					{
						
						var markupTooltip = renderEJS (FILTER_SIZE_SMALL_SIZE_TEXT[CURRENT_LANGUAGE], { next_size:FILTER_SIZE_UNITS[user.SIZE_SYSTEM][currentSelection-1] });
						clearTimeout(timeoutTooltips);
						
						//if (isLooseSize==1 && currentSelection>1)
						if (isLooseSize==1 && target < $(".option-value").length-1)
						{
							user.SIZE_SMALL_SHOWED = true;
							if (toolip1)
							{
								toolip1.stop();
								setTimeout(function(){
									toolip3 = new Tooltip( {  offsetX:45, offsetY: -15, className:"small-size", target: ".filter-size-selector", markup:markupTooltip, dialogCallback:function(result){
										$this.gotToSmaller(result);
									}});
								},350);
							}
							else
							{
								toolip3 = new Tooltip( {   offsetX:45, offsetY: -15, className:"small-size", target: ".filter-size-selector", markup:markupTooltip, dialogCallback:function(result){
									$this.gotToSmaller(result);
								}});			
							}
						}
						else
						{
							if (isDetail)
							{
								if (lastDetailSize != user.DETAIL_SIZE)
								{
									callbackFunction();
								}
							}
							else
							{
								if (lastSize != user.SIZE)
								{
									callbackFunction();
								}
							}
							
						}
					}
					else
					{	
						if (isDetail)
						{
							if (lastDetailSize != user.DETAIL_SIZE)
							{
								callbackFunction();
							}
						}
						else
						{
							if (lastSize != user.SIZE)
							{
								callbackFunction();
							}
						}
					}

				}});

				$options.removeClass("active");
				$options.eq(target).addClass("active");		

				DragCursor.clear($body);
				setTimeout(function() { $body.css('cursor', ''); }, 0);		
				
			}

			isMouseDownSelector = false;
			
		}
		
		/*----------------------------------------*/

		this.activeSizes = function()
		{
			$(".option-value").removeClass("inactive");
		}

		/*----------------------------------------*/

		this.inactiveSize = function()
		{
			$(".option-value").removeClass("inactive");
			$(".option-value").each(function(index){
				if (isDetail)
				{
					if (user.DETAIL_SIZE == FILTER_SIZE_UNITS["EUR"][NUMBERS_INDEX[index]])
					{
						$(".option-value").eq(index+1).addClass("inactive");
					}
				}
				else
				{
					if (user.SIZE == FILTER_SIZE_UNITS["EUR"][index])
					{
						$(this).addClass("inactive");
						
					}
				}
			});	
		}

		/*----------------------------------------*/

		this.gotToSmaller = function(result)
		{
			if(result)
			{
				user.DETAIL_SIZE++;
				user.SIZE = user.DETAIL_SIZE;
				currentSelection = user.SIZE;
				
				var i;
				$(".option-value").removeClass("active");
				$(".option-value").each(function(index){
					if (user.DETAIL_SIZE == FILTER_SIZE_UNITS["EUR"][NUMBERS_INDEX[index]])
					{
						i = index+1;
						$(".option-value").eq(i).addClass("active");
					}
				});	
				
				$selector.animate( {left : (i * $options.width() ) }, {duration:300, complete:function(){
					callbackFunction( {size:user.DETAIL_SIZE} );					
				} });
			}
			else
			{

				callbackFunction( {size:user.DETAIL_SIZE} );
			}
		}


		/*----------------------------------------*/

		this.showTooltip = function()
		{
			toolip1 = new Tooltip( { offsetY:20, offsetX:(0-$(".products-filter-wrapper").offset().left) + $(".option-value").width()/2 - ($(".option-value").width()/4) + 5, target: ".filter-size-selector", markup: FILTER_SIZE_TOOLTIP_HELP[CURRENT_LANGUAGE], exitMode:"delay", exitTime:4500} );			
			toolip2 = new Tooltip( { offsetX:40, offsetY:0,  target: ".system-filter", markup: FILTER_SIZE_SYSTEM_TOOLTIP_HELP[CURRENT_LANGUAGE], exitMode:"delay", exitTime:4500} );			
		}

		/*----------------------------------------*/

		this.destroy = function(_callback)
		{
			user.IS_IN_SIZE_FILTER = false;

			if (toolip1) toolip1.stop();
			if (toolip2) toolip2.stop();
			if (toolip3) toolip3.stop();
			$window.unbind("resize", $this.resize);
			$selector.unbind(MOUSE_UP_EVENT, this.mouseUpEvent);
			$(document).unbind(MOUSE_UP_EVENT, this.mouseUpEvent);
			$container.animate({ bottom:-15}, {duration:250, complete:function(){
				$container.remove();
				if (_callback) _callback();	
			}});
		}

		this.append();

		/*----------------------------------------*/
	}

	


})
(jQuery)

var FilterSizeAccesorie;

(function($)
{

	var $container;
    var $selector;

    var toolip1;
    var toolip2;
    var toolip3;

    var $dragArea;

    var STEPS = 13;
    var AREA_WIDTH_TOTAL = 1040;
    
    var callbackFunction;

    var currentSelection;
    var options;
    var $options;

    var currentIndexSystem = 0;

    var isMouseDownSelector = false;

    var timeoutTooltips;
    var currentType;

	FilterSizeAccesorie = function(_callback, _activeSizes, _currentType)
	{
		
		var $this;	
		callbackFunction = _callback;
		currentType = _currentType;
		var isDetail=false;
		var activeSizes;
		var TOTAL_OPTIONS;

		if (_activeSizes) activeSizes = _activeSizes;
		
		/*----------------------------------------*/

		this.append = function()
		{
			$this = this;
			
			var MARKUP = "<div id='filter-size-accesories-widget' class='filter-widget'><div class='products-filter-final clearfix'><div class='products-filter-wrapper clearfix'>";
	        MARKUP += "<div class='filter-size-accesories-drag-area'><div class='filter-size-selector'><div class='cursor'></div><div class='background'></div><div class='green-line'></div></div></div>";
	        MARKUP += "</div></div><div class='middle-line'></div></div>";

	        if(currentType == "Helmet")
	        {
				TOTAL_OPTIONS = ATTRIBUTES_FILTER[4].length;
	        }

			if(currentType == "T-shirt")
	        {
				TOTAL_OPTIONS = ATTRIBUTES_FILTER[4].length;
	        }

			currentSelection = user.DETAIL_SIZE;			
			
			
			if ( $("#product-detail").length>0 )
			{
				$("#product-detail").append(MARKUP);
			}

			if ( $(".section-wrapper.catalog").length>0 )
			{
				$footer.append(MARKUP);
			}

			$container = $("#filter-size-accesories-widget");
			
			for (var i=1; i < TOTAL_OPTIONS; i++)
			{
				$container.find(".products-filter-wrapper").append( "<div class='option-value' style='width:" + (100/(TOTAL_OPTIONS-1)) + "%;'><div class='green-background'></div><div class='line' style='background:#acacac'></div><div class='label'>" + ATTRIBUTES_FILTER[4][i].label + "</div></div>" );
			}

			var x = 0;

			$selector = $(".filter-size-selector");
			DragCursor.open($selector);

			$dragArea = $(".filter-size-accesories-drag-area");

			$options = $(".option-value");
			$options.bind (MOUSE_DOWN, this.gotoOption);

			this.setValues();
			this.createDrag();			

			$selector.bind(MOUSE_DOWN, this.mouseDownEvent);
			$selector.bind(MOUSE_UP_EVENT, this.mouseUpEvent);
			$(document).bind(MOUSE_UP_EVENT, this.mouseUpEvent);

			var toY = 79;

			$container.css( { bottom:-15} ).animate({ bottom:toY}, {duration:250, complete:function(){
				if ( user.SIZE_TOOLTIP_SHOWED == false )
				{
					timeoutTooltips = setTimeout(function(){
						user.SIZE_TOOLTIP_SHOWED = true;
						$this.showTooltip();
					},500);					
				}
			}});

			
			if (currentSelection !=0 && currentSelection !=-1)
			{
				$selector.css( {left : ( (currentSelection  * $options.width())   ) } );	
				$(".option-value").eq(currentSelection).addClass("active");
			}
			else
			{
				$(".option-value").eq(0).addClass("active");	
			}
		}

		/*----------------------------------------*/	

		this.setValues = function()
		{
			//$dragArea.css ({ "position" : "absolute", "left" : $options.width()/2 - 60, "width" : $(".products-filter-wrapper").width() - $options.width() });
			$dragArea.css ({ "position" : "absolute", "left" : $options.width()/2 - 60, "width" : $options.length * $options.width() - 75 });
		}

		/*----------------------------------------*/	

		this.createDrag = function()
		{
			$selector.draggable({ axis: "x", left:0, containment:".filter-size-accesories-drag-area" });
		}

		/*----------------------------------------*/

		this.mouseDownEvent = function(e)
		{
			isMouseDownSelector	= true;
			DragCursor.closed($body);
		}

		/*----------------------------------------*/

		this.gotoOption = function(e)
		{
			
			clearTimeout(timeoutTooltips);
			var index = $(".option-value").index($(this));

			user.DETAIL_SIZE = index;			

			$selector.animate( {left : (index * $options.width()) }, {duration:300, complete:function(){
				$this.checkSize();
				callbackFunction();

			} });
			
			$options.removeClass("active");
			$options.eq(index).addClass("active");			
		}

		/*----------------------------------------*/
		var isMouseUpBlocked = false;

		this.mouseUpEvent = function(e)
		{
			if (isMouseUpBlocked==false && isMouseDownSelector==true)
			{
				
				isMouseUpBlocked = true;

				e.preventDefault();

				var currentX = $selector.position().left;				

				var min = 9999;
				var target;
				var point = 0;

				for (var i=0 ; i<TOTAL_OPTIONS; i++)
				{
					if ( Math.abs (currentX - point) < min )
					{
						min = Math.abs (currentX - point)
						target = i;
					}

					point += $options.width();
				}
				
				currentSelection = target;

				$selector.animate( {left : (target * $options.width())  }, {duration:250, complete:function(){
					
					user.DETAIL_SIZE = currentSelection;

					isMouseUpBlocked = false;						
					$this.checkSize();
					callbackFunction(  );			
				}});

				$options.removeClass("active");
				$options.eq(currentSelection).addClass("active");	

				DragCursor.clear($body);
				setTimeout(function() { $body.css('cursor', ''); }, 0);			
			}

			isMouseDownSelector = false;

		}
		
		/*----------------------------------------*/

		this.checkSize = function()
		{
			
		}

		/*----------------------------------------*/

		this.activeSizes = function()
		{
			$(".option-value").removeClass("inactive");
		}

		/*----------------------------------------*/

		this.inactiveSize = function()
		{
			$(".option-value").removeClass("inactive");				
			$container.find(".option-value").eq(user.DETAIL_SIZE).addClass("inactive");
		}

		/*----------------------------------------*/

		this.showTooltip = function()
		{
			toolip1 = new Tooltip( { offsetX:(0-$(".products-filter-wrapper").offset().left) + $(".option-value").width()/2 - ($(".option-value").width()/2) - 5, offsetY:10, target: ".filter-size-selector", markup: FILTER_SIZE_TOOLTIP_HELP[CURRENT_LANGUAGE], exitMode:"delay", exitTime:4500} );			
		}

		/*----------------------------------------*/

		this.destroy = function(_callback)
		{
			if (toolip1) toolip1.stop();
			
			$selector.unbind(MOUSE_UP_EVENT, this.mouseUpEvent);
			$(document).unbind(MOUSE_UP_EVENT, this.mouseUpEvent);
			$container.animate({ bottom:-15}, {duration:250, complete:function(){
				$container.remove();
				if (_callback) _callback();	
			}});
		}

		this.append();

		/*----------------------------------------*/
	}

	


})
(jQuery)

var FilterQuantity;

(function($)
{

	var $container;
    var $selector;

    var toolip1;
    var toolip2;
    var toolip3;

    var STEPS = 6;
    var AREA_WIDTH_TOTAL = 1032;
    
    var callbackFunction;

    var currentSelection;
    var options;
    var $options;

    var currentIndexSystem = 0;

    var isMouseDownSelector = false;

    var timeoutTooltips;

	FilterQuantity = function(_callback)
	{
		
		var $this;	
		this.systemSelector;
		callbackFunction = _callback;
		var isDetail=false;
		var activeSizes,isLooseSize;



		/*----------------------------------------*/

		this.append = function()
		{
			$this = this;
			
			var MARKUP = "<div id='filter-quantity-widget' class='filter-widget'><div class='products-filter-final clearfix'><div class='products-filter-wrapper clearfix'>";
	        MARKUP += "<div class='filter-quantity-drag-area'><div class='filter-quantity-selector'><div class='cursor'></div><div class='background'></div><div class='green-line'></div></div></div>";
	        MARKUP += "</div></div><div class='size-system-wrapper'></div><div class='middle-line'></div></div>";

			currentSelection = user.DETAIL_QUANTITY;

			$("#product-detail").append(MARKUP);
			$container = $("#filter-quantity-widget");

			for (var i=0; i<FILTER_QUANTITY_TOTAL; i++)
			{
				$container.find(".products-filter-wrapper").append( "<div class='option-value'><div class='green-background'></div><div class='line' style='background:#acacac'></div><div class='label'>" + (i+1) + "</div></div>" );
			}

			var x = 1;
			if (isDetail) x = 0;


			$selector = $(".filter-quantity-selector");
			DragCursor.open($selector);

			$selector.draggable({ axis: "x", left:0, containment:".filter-quantity-drag-area" });

			$selector.bind(MOUSE_DOWN, this.mouseDownEvent);
			$selector.bind(MOUSE_UP_EVENT, this.mouseUpEvent);
			$(document).bind(MOUSE_UP_EVENT, this.mouseUpEvent);


			$container.css( { bottom:-15} ).animate({ bottom:79}, {duration:250, complete:function(){
				if ( user.QUANTITY_TOOLTIP_SHOWED == false )
				{
					timeoutTooltips = setTimeout(function(){
						user.QUANTITY_TOOLTIP_SHOWED = true;
						$this.showTooltip();
					},500);					
				}
			}});

			$options = $(".option-value");
			$options.bind (MOUSE_DOWN, this.gotoOption);

			$container.find(".products-filter-wrapper .option-value").eq(currentSelection-1).addClass("active");
			$selector.css( {left : ((user.DETAIL_QUANTITY-1) * $options.width() ) } );		

			$window.unbind("resize", this.resize).bind ("resize", this.resize);
			$this.resize();
		}

		/*----------------------------------------*/

		this.resize = function()
		{
			$(".option-value").css ( { width: (100 / FILTER_QUANTITY_TOTAL)+"%"  } );
			$(".filter-quantity-drag-area").css ( { width:( ($(".option-value").length) * $(".option-value").width() ) + "px"} );

			$(".filter-quantity-selector").css ( { width:$options.width()} );
			$selector.css( {left : ((user.DETAIL_QUANTITY-1) * $options.width() ) } );		
		},

		/*----------------------------------------*/

		this.mouseDownEvent = function(e)
		{
			isMouseDownSelector	= true;
			DragCursor.closed($body);
		}

		/*----------------------------------------*/

		this.gotoOption = function(e)
		{
			clearTimeout(timeoutTooltips);
			if (toolip1) toolip1.stop();
			var index = $(".option-value").index($(this));
			currentSelection = index;
			$selector.animate( {left : (index * $options.width() - 2 ) }, {duration:300, complete:function(){
				callbackFunction(  );
			} });
			user.DETAIL_QUANTITY = index + 1;
			$options.removeClass("active");
			$options.eq(index).addClass("active");			

			if (toolip1) toolip1.stop();

		}

		/*----------------------------------------*/
		var isMouseUpBlocked = false;

		this.mouseUpEvent = function(e)
		{
			if (isMouseUpBlocked==false && isMouseDownSelector==true)
			{
				clearTimeout(timeoutTooltips);
				if (toolip1) toolip1.stop();
				isMouseUpBlocked = true;

				e.preventDefault();

				var step = FILTER_QUANTITY_TOTAL;
				var currentX = $selector.position().left;

				var min = 9999;
				var target;
				var point = 0;

				for (var i=0 ; i<FILTER_QUANTITY_TOTAL; i++)
				{
					if ( Math.abs (currentX - point) < min)
					{
						min = Math.abs (currentX - point)
						target = i;
					}

					point += $options.width();
				}

				currentSelection = target;

				$selector.animate( {left : (target * $options.width())-2 }, {duration:250, complete:function(){
					
					user.DETAIL_QUANTITY = target + 1;
					isMouseUpBlocked = false;		
					callbackFunction(  );				

				}});

				$options.removeClass("active");
				$options.eq(currentSelection).addClass("active");		

				DragCursor.clear($body);
				setTimeout(function() { $body.css('cursor', ''); }, 0);		
			}

			isMouseDownSelector = false;

		}
		


		/*----------------------------------------*/

		this.showTooltip = function()
		{
			toolip1 = new Tooltip( { offsetX:(0-$(".products-filter-wrapper").offset().left) + $(".option-value").width()/2 - 115, offsetY:15, target: ".filter-quantity-selector", markup: DICTIONARY[CURRENT_LANGUAGE].dragselectquantity, exitMode:"delay", exitTime:1000} );			
		}

		/*----------------------------------------*/

		this.destroy = function(_callback)
		{
			if (toolip1) toolip1.stop();
			$selector.unbind(MOUSE_UP_EVENT, this.mouseUpEvent);
			$(document).unbind(MOUSE_UP_EVENT, this.mouseUpEvent);
			$container.animate({ bottom:-15}, {duration:250, complete:function(){
				$container.remove();
				if(_callback) _callback();	
			}});
			$window.unbind("resize", $this.resize);
		}

		this.append();

		/*----------------------------------------*/
	}

	


})
(jQuery)

var FilterColor;

(function($)
{

	var $container;
    var $selector;

    var toolip1;

    var STEPS,AREA_WIDTH_TOTAL;
    
    var callbackFunction;

    var currentSelection;
    var options;
    var $options;

    var currentIndexSystem = 0;

    var activeUpdateMask = false;

    var isMouseDownSelector = false;


	FilterColor = function(_callback)
	{
		
		var $this;	
		this.systemSelector;
		callbackFunction = _callback;

		/*----------------------------------------*/

		this.append = function()
		{
			$this = this;

			var divAllColors="";
			var divAllColorsMask="";
			var maskColors = "<div class='mask-colors'><div class='mask-colors-wrapper'>";

			for (var i = 0; i < FILTER_COLORS_HEX.length; i++)
			{
				divAllColors += "<div class='line' style='background-color:" + FILTER_COLORS_HEX[i] + "'></div>";
				divAllColorsMask += "<div class='line' style='height:29px !important; background-color:" + FILTER_COLORS_HEX[i] + "'></div>";
			}			

			maskColors += "<div class='mask-step'>" + divAllColorsMask + "</div>";

			var MARKUP = "<div id='filter-color-widget' class='filter-widget'><div class='products-filter-final clearfix'><div class='products-filter-wrapper clearfix'>";
	        MARKUP += "<div class='filter-color-drag-area'><div class='filter-color-selector'><div class='cursor'></div><div class='background'></div></div></div>";
	        MARKUP += "<div class='option-value'><div class='selector-drag'></div><div class='allcolors-selected color-background'></div><div class='allcolors line'>" + divAllColors + "</div><div class='label'>" + DICTIONARY[CURRENT_LANGUAGE].allcolors + "</div></div>";
	        MARKUP += "</div></div><div class='middle-line'></div></div>";

			currentSelection = user.COLOR;

			$footer.append(MARKUP);

			$container = $("#filter-color-widget");

			for (var i=0; i<FILTER_COLORS_HEX.length; i++)
			{				
				$container.find(".products-filter-wrapper").append( "<div class='option-value'><div class='color-background' style='' ></div><div class='line' style='background-color:"+FILTER_COLORS_HEX[i]+"'></div><div class='selector-drag'></div><div class='label'>" + ATTRIBUTES_FILTER[3][i+1].label + "</div></div>" );
				maskColors += "<div class='mask-step' style='background-color:"+FILTER_COLORS_HEX[i]+"' ></div>";
			}

			maskColors += "</div></div>";

			$("#filter-color-widget .products-filter-wrapper").append(maskColors);

			this.setValues();

			$selector = $(".filter-color-selector");
			DragCursor.open($selector);

			$this.createDrag();

			$selector.bind(MOUSE_DOWN, this.mouseDownEvent);
			$selector.bind(MOUSE_UP_EVENT, this.mouseUpEvent);
			$(document).bind(MOUSE_UP_EVENT, this.mouseUpEvent);

			$(document).unbind("mousemove").bind("mousemove", this.updateMask);

			$container.css( { bottom:-15} ).animate({ bottom:79}, {duration:250, complete:function(){
				if ( user.COLOR_TOOLTIP_SHOWED == false )
				{
					setTimeout(function(){
						user.COLOR_TOOLTIP_SHOWED = true;
						$this.showTooltip();
					},500)
					
				}
			}});

	
			$selector.css({left: (currentSelection * (AREA_WIDTH_TOTAL / STEPS) ) } );

			$options = $(".option-value");
			$options.bind (MOUSE_DOWN, this.gotoOption);

			activeUpdateMask = true;
			$this.updateMask();
			activeUpdateMask = false;

			$options.eq(currentSelection).addClass("active");

			$window.unbind("resize", $this.resize).bind("resize", $this.resize);

		},

		/*----------------------------------------*/

		this.resize = function()
		{
			$this.setValues();
			$selector.css( { left : (user.COLOR * ((AREA_WIDTH_TOTAL)/STEPS)) - 2 } );
			$this.updateMask();
		},

		/*----------------------------------------*/

		this.updateMask = function()
		{
			if (activeUpdateMask)
			{
				var selPos = $selector.position().left;
				if (selPos == 0) selPos = -2;
				var toLeft =selPos+2;
				var marginLeft = (0-(selPos+2));

				var maskWidth = $window.width();

				if (maskWidth>1200) maskWidth = 1200;
				if (maskWidth<960) maskWidth = 960;


				$(".mask-colors").css({
						"left":toLeft
				});

				$(".mask-colors .mask-colors-wrapper").css({
						"margin-left":marginLeft,
						"width":maskWidth

				});
			}
		},

		/*----------------------------------------*/

		this.setValues = function()
		{
			STEPS = $(".option-value").length - 1;
			AREA_WIDTH_TOTAL = $(".products-filter-wrapper").width() - $(".option-value").width();
			$("#filter-color-widget .filter-color-drag-area").css( { width: AREA_WIDTH_TOTAL +  (($(".option-value").width()) ) } );
		}

		/*----------------------------------------*/

		this.mouseDownEvent = function(e)
		{
			isMouseDownSelector	= true;
			activeUpdateMask = true;
			
			DragCursor.closed($body);
		}	


		/*----------------------------------------*/
		var isMouseUpBlocked = false;

		this.mouseUpEvent = function(e)
		{
			if (isMouseUpBlocked==false  && isMouseDownSelector==true)
			{
				isMouseUpBlocked = true;

				if (e) e.preventDefault();

				var step = (AREA_WIDTH_TOTAL/STEPS);
				var currentX = $selector.position().left;

				var min = 9999;
				var target;
				var point = 0;

				for (var i=0 ; i<STEPS+1; i++)
				{
					if ( Math.abs (currentX - point) < min)
					{
						min = Math.abs (currentX - point)
						target = i;
					}

					point += (AREA_WIDTH_TOTAL/STEPS);
				}

				currentSelection = target;
				activeUpdateMask = true;
				$selector.animate( {step:$this.updateMask, left : (target * ((AREA_WIDTH_TOTAL)/STEPS)) - 2 }, {duration:250, complete:function(){					
					if (user.COLOR != target)
					{
						user.COLOR = target;
						callbackFunction();
					}
					user.COLOR = target;
					isMouseUpBlocked = false;						
					$this.updateMask();

				}} );

				$options.removeClass("active");
				$options.eq(currentSelection).addClass("active");

				DragCursor.clear($body);
				setTimeout(function() { $body.css('cursor', ''); }, 0);
			}

		},

		/*----------------------------------------*/

		this.createDrag = function()
		{
			this.setValues();
			$selector.draggable({ axis: "x", left:0, containment:".filter-color-drag-area" });
		},

		/*----------------------------------------*/

		this.gotoOption = function(e)
		{
			var index = $(".option-value").index($(this));
			var lastColor = user.COLOR;
			user.COLOR = index;
			activeUpdateMask = true;
			$selector.animate( {step:$this.updateMask, left : (index * ((AREA_WIDTH_TOTAL)/STEPS)) - 2 }, {duration:300, complete:function(){
				if (lastColor!=index)
				{
					callbackFunction();
				}

				$this.updateMask();

			} });

			$options.removeClass("active");
			$options.eq(index).addClass("active");			

			if (toolip1) toolip1.stop();
			isMouseDownSelector = false;
		}		
		
		/*----------------------------------------*/

		this.showTooltip = function()
		{
			toolip1 = new Tooltip( { offsetX:(0-$(".products-filter-wrapper").offset().left) + $(".option-value").width()/2 - 20, offsetY:20, target: ".filter-color-selector", markup: DICTIONARY[CURRENT_LANGUAGE].dragfiltercolor, exitMode:"delay", exitTime:1000} );			
		}

		/*----------------------------------------*/

		this.destroy = function(_callback)
		{
			if (toolip1) {toolip1.stop();}

			$selector.unbind(MOUSE_UP_EVENT, this.mouseUpEvent);
			$(document).unbind(MOUSE_UP_EVENT, this.mouseUpEvent);
			
			$window.unbind("resize", $this.resize);
			
			$container.animate({ bottom:-15}, {duration:250, complete:function(){
				$container.remove();
				if(_callback) _callback();	
			}});
		}

		this.append();

		/*----------------------------------------*/
	}

	


})
(jQuery)

var FilterPrice;

(function($)
{

	var $container;
    var $selector1,$selector2,$backgroundSelected,$dragArea,currentSelectorActive,dragLeft,minValue,maxValue,sum,isFirst = true;

    var toolip1;
    var toolip2;

    var STEPS = 9;
    var AREA_WIDTH_TOTAL = 1140;
    
    var callbackFunction;

    var currentSelection;
    var options;
    var $options,optionWidth;

    var currentIndexSystem = 0;

    var isMouseDownSelector = false;

	FilterPrice = function(_callback)
	{
		isFirst = true;
		var $this;	
		this.systemSelector;
		callbackFunction = _callback;

		/*----------------------------------------*/

		this.append = function()
		{
			$this = this;
			


			var MARKUP = "<div id='filter-price-widget' class='filter-widget'><div class='products-filter-final clearfix'><div class='products-filter-wrapper clearfix'>";
	        MARKUP += "<div class='area-active-price'></div>";
	        MARKUP += "<div class='filter-price-drag-area-1' style='backgeround:red;height:10px'></div><div class='filter-price-selector-1'><div class='cursor'></div><div class='background'></div></div>";
	        MARKUP += "<div class='filter-price-drag-area-2' style='backgeround:red;height:10px'></div><div class='filter-price-selector-2'><div class='cursor'></div><div class='background'></div></div>";
	        MARKUP += "</div></div><div class='middle-line'></div></div>";

			currentSelection = user.COLOR;

			

			$footer.append(MARKUP);
			$container = $("#filter-price-widget");

			$dragArea = $(".filter-price-drag-area");
			

			sum = 20;
			var currentPrice = FILTER_PRICES_MIN;
			for (var i=0; i<=FILTER_PRICES_STEPS; i++)
			{
				$container.find(".products-filter-wrapper").append( "<div class='option-value' ><div class='line'>-</div><div class='label'>" + currentPrice + "€</div></div>" );
				currentPrice+=sum;
			}

			$selector1 = $(".filter-price-selector-1");
			$selector2 = $(".filter-price-selector-2");
			$selector2.css ({ left : 500})
			
			DragCursor.open($selector1);
			DragCursor.open($selector2);
			

			$selector1.bind(MOUSE_DOWN, this.mouseDownEvent1);
			$selector1.bind(MOUSE_UP_EVENT, this.mouseUpEvent1);
			$selector2.bind(MOUSE_DOWN, this.mouseDownEvent2);
			$selector2.bind(MOUSE_UP_EVENT, this.mouseUpEvent2);
			
			$(document).bind(MOUSE_UP_EVENT, this.mouseUpEvent);

			$backgroundSelected = $(".area-active-price");
			$(document).bind(MOUSE_MOVE, this.renderBackgroundSelected);
			$options = $(".option-value");
			
			this.setValues();
			this.createDrag();			


			if ( user.PRICE_RATE_MIN == 0 && user.PRICE_RATE_MAX == 0)
			{
				minValue = 0;
				maxValue = $options.length;
				$selector2.css( { "left" : $options.width()*maxValue} );
				
			}
			else
			{
				currentPrice = FILTER_PRICES_MIN;
				for (var i=0; i<=FILTER_PRICES_STEPS; i++)
				{
					if (currentPrice == user.PRICE_RATE_MIN)
					{
						minValue = i;
					}

					if (currentPrice == user.PRICE_RATE_MAX)
					{
						maxValue = i;
					}

					currentPrice+=sum;
				}

				$selector1.css( { "left" : $options.width()*minValue} );
				$selector2.css( { "left" : $options.width()*(maxValue)} );
			}

			$options.eq(minValue).addClass("active");			
			$options.eq(maxValue).addClass("active");			

			$container.css( { bottom:-15} ).animate({ bottom:79}, {duration:250, complete:function(){
				if ( user.PRICE_TOOLTIP_SHOWED == false )
				{
					setTimeout(function(){
						user.PRICE_TOOLTIP_SHOWED = true;
						$this.showTooltip();
					},500)
					
				}
			}});

			$(".filter-price-selector-1 .cursor,.filter-price-selector-2 .cursor").css ( {marginLeft:32} );

			
			this.renderBackgroundSelected();

			$window.unbind("resize", $this.resize).bind("resize", $this.resize);
		}

		/*----------------------------------------*/

		this.resize = function()
		{
			$this.setValues();

			if ( user.PRICE_RATE_MIN ==0 && user.PRICE_RATE_MAX ==0)
			{
				minValue = 0;
				maxValue = $options.length-1;
				$selector2.css( { "left" : $options.width()*maxValue} );
				
			}
			else
			{
				currentPrice = FILTER_PRICES_MIN;
				for (var i=0; i<=FILTER_PRICES_STEPS; i++)
				{
					if (currentPrice == user.PRICE_RATE_MIN)
					{
						minValue = i;
					}

					if (currentPrice == user.PRICE_RATE_MAX)
					{
						maxValue = i;
					}

					currentPrice+=sum;
				}

				$selector1.css( { "left" : $options.width()*minValue} );
				$selector2.css( { "left" : $options.width()*maxValue} );
			}
			

			$this.renderBackgroundSelected();
			$this.createDrag();
			$this.resetDrag();
		},

		/*----------------------------------------*/

		this.setValues = function()
		{

			AREA_WIDTH_TOTAL = $(".products-filter-wrapper").width();
			STEPS = $options.length;
			optionWidth = $(".option-value").width();
			dragLeft = $(".filter-price-drag-area-1").position().left;	
			

		}

		/*----------------------------------------*/

		this.createDrag = function()
		{
			//$dragArea.css ( { "width" : $(".products-filter-wrapper").width() + 4 } );
			

			if (isFirst == false)
			{
				$selector1.draggable( "destroy" );
				$selector2.draggable( "destroy" );
			}
			else
			{
				isFirst = false;
			}

			$selector1.draggable({ axis: "x", left:0, containment:".filter-price-drag-area-1" });			
			$selector2.draggable({ axis: "x", left:0, containment:".filter-price-drag-area-2" });

			$this.resetDrag();
		}

		/*----------------------------------------*/

		this.resetDrag = function()
		{
			$(".filter-price-drag-area-1").css( { left:0, width:$(".filter-price-selector-2").position().left });
			$(".filter-price-drag-area-2").css( { left: $selector1.position().left + $(".option-value").width(), width:AREA_WIDTH_TOTAL - ($(".filter-price-selector-1").position().left + $(".option-value").width()) });
		},

		/*----------------------------------------*/

		this.renderBackgroundSelected = function()
		{
			var leftBackground = ($selector1.position().left < $selector2.position().left) ? $selector1.position().left : $selector2.position().left;
			leftBackground += dragLeft + 50;
			var rightBackground = ($selector1.position().left > $selector2.position().left) ? $selector1.position().left : $selector2.position().left;
			rightBackground += optionWidth / 2;
			$backgroundSelected.css( { left:leftBackground, width : (rightBackground-leftBackground) });
		}

		/*----------------------------------------*/

		this.mouseDownEvent1 = function(e)
		{
			isMouseDownSelector = true;
			currentSelectorActive = 1;
			DragCursor.closed($body);
		}

	/*----------------------------------------*/

		this.mouseDownEvent2 = function(e)
		{
			isMouseDownSelector = true;
			currentSelectorActive = 2;
			DragCursor.closed($body);
		}

		/*----------------------------------------*/
		
		this.mouseUpEvent1 = function(e)
		{
			
			e.preventDefault();			
			currentSelectorActive = 1;
			$this.mouseUpEvent();
		}

		/*----------------------------------------*/
		
		this.mouseUpEvent2 = function(e)
		{
			
			e.preventDefault();
			currentSelectorActive = 2;
			$this.mouseUpEvent();
		}		

		/*----------------------------------------*/

		var isMouseUpBlocked = false;

		this.mouseUpEvent = function()
		{
			
			if (isMouseUpBlocked==false  && isMouseDownSelector==true)
			{
				
				isMouseUpBlocked = true;				

				var step = (AREA_WIDTH_TOTAL/STEPS);
				var currentX;
				
				if (currentSelectorActive==1)
				{
					currentX = $selector1.position().left;
				}

				if (currentSelectorActive==2)
				{
					currentX = $selector2.position().left;
				}				

				var min = 9999;
				var target;
				var point = 0;

				for (var i=0 ; i<STEPS; i++)
				{
					if ( Math.abs (currentX - point) < min)
					{
						min = Math.abs (currentX - point)
						target = i;
					}

					point += optionWidth;
				}

				currentSelection = target;

				var $toTarget;

				if (currentSelectorActive==1)
				{
					$toTarget = $selector1;
					minValue = target;
				}

				if (currentSelectorActive==2)
				{
					$toTarget = $selector2;
					maxValue = target;
				}

				var targetX = target * optionWidth;

				if ($toTarget)
				{
					$toTarget.animate( { left : targetX + 1 }, {duration:250, step:this.renderBackgroundSelected, complete:function(){					
						$options.removeClass("active");
						$options.eq(minValue).addClass("active");			
						$options.eq(maxValue).addClass("active");			

						if ( user.PRICE_RATE_MIN != FILTER_PRICES_MIN + (minValue*sum)
							|| user.PRICE_RATE_MAX != FILTER_PRICES_MIN + (maxValue*sum) )
						{
							user.PRICE_RATE_MIN = FILTER_PRICES_MIN + (minValue*sum);
							user.PRICE_RATE_MAX = FILTER_PRICES_MIN + (maxValue*sum);	
							callbackFunction();
						}					
						
						$this.resetDrag();

						isMouseUpBlocked = false;							

					}} );
				}
			
				DragCursor.clear($body);
				setTimeout(function() { $body.css('cursor', ''); }, 0);

				isMouseDownSelector = false;

			}

		}

		/*----------------------------------------*/

		this.showTooltip = function()
		{
			toolip1 = new Tooltip( { offsetX:(0-$(".products-filter-wrapper").offset().left) + $(".option-value").width()/2 - 20, offsetY:22, target: ".filter-price-selector-1", markup: DICTIONARY[CURRENT_LANGUAGE].dragfilterprice, exitMode:"delay", exitTime:4500} );			
			toolip2 = new Tooltip( { offsetX:30, offsetY:22, target: ".filter-price-selector-2", markup: DICTIONARY[CURRENT_LANGUAGE].dragfilterprice, exitMode:"delay", exitTime:4500} );			
		}

		/*----------------------------------------*/

		this.destroy = function(_callback)
		{
			$window.unbind("resize", $this.resize);
			$(document).unbind(MOUSE_MOVE, this.renderBackgroundSelected);			
			$selector1.unbind(MOUSE_DOWN, this.mouseDownEvent);
			$selector2.unbind(MOUSE_DOWN, this.mouseDownEvent);
			$selector1.unbind(MOUSE_UP_EVENT, this.mouseUpEvent1);
			$selector2.unbind(MOUSE_UP_EVENT, this.mouseUpEvent2);
			$(document).unbind(MOUSE_UP_EVENT, this.mouseUpEvent);

			if (toolip1) toolip1.stop();
			if (toolip2) toolip2.stop();

			$container.animate({ bottom:-15}, {duration:250, complete:function(){
				$container.remove();
				if (_callback) _callback();	
			}});
		}

		this.append();

		/*----------------------------------------*/
	}

	


})
(jQuery)

var FilterItems;

(function($)
{

	var $container;

    var toolip1;
    var toolip2;
    var toolip3;

    var STEPS = 6;
    var AREA_WIDTH_TOTAL = 1032;
    
    var callbackFunction;

    var currentSelection;
    var options;
    var $options;

    var currentIndexSystem = 0;

    var isMouseDownSelector = false;

    var timeoutTooltips;

	FilterItems = function(_items,_callback, _addDefault)
	{
		
		var $this;	
		callbackFunction = _callback;
		var items=_items,addDefault;

		if (_addDefault) addDefault = _addDefault;

		/*----------------------------------------*/

		this.append = function()
		{
			$this = this;
			
			var MARKUP = "<div id='filter-items-widget' class='filter-widget'><div class='products-filter-wrapper'><div class='filter-items-type-wrapper-collection'></div></div></div>";

			currentSelection = user.COLLECTION;
			$footer.append(MARKUP);
			$container = $("#filter-items-widget");
			
			

			for (var i=1; i<items.length; i++)
			{
				if (i==(items.length-1))
				{
					$container.find(".filter-items-type-wrapper-collection").append( "<div class='option-value'><div class='line-item-left'></div>" + (items[i].label) + "</div>" );
				}
				else
				{
					$container.find(".filter-items-type-wrapper-collection").append( "<div class='option-value'><div class='line-item-left'></div>" + (items[i].label) + "</div>" );
				}
			}

			if (addDefault)$container.find(".filter-items-type-wrapper-collection").append( "<div class='option-value'><div class='line-item-left'></div>" + DICTIONARY[CURRENT_LANGUAGE].allproducts + "<div class='line-item-right'></div></div>" );

			if (user.COLLECTION!="")
			{
				$container.find(".option-value:contains(" + user.COLLECTION + ")").addClass("active");	
			}
			else
			{
				$container.find(".option-value:eq(0)").addClass("active");	
			}

			$options = $(".option-value");
			$options.bind (MOUSE_DOWN, this.clickItem);

			$container.css({ bottom:27 }).animate({bottom:79 }, {duration:250});

		}


		/*----------------------------------------*/

		this.callbackParent = function()
		{
			callbackFunction();
		}

		/*----------------------------------------*/

		this.clickItem = function(e)
		{
			if (user.COLLECTION != $(this).text())
			{
				globalBus.publish( 'satorisan', 'close-products-filter-open' );
				user.COLLECTION = $(this).text();	
				$this.callbackParent();
			}
		
			user.COLLECTION = $(this).text();	
			$options.removeClass("active");
			$(this).addClass("active");
			
		}

		/*----------------------------------------*/


		this.destroy = function(_callback)
		{
			$container.animate({ bottom:0}, {duration:250, complete:function(){
				$container.remove();
				if (_callback) _callback();	
			}});
		}

		this.append();

		/*----------------------------------------*/
	}

	


})
(jQuery)

var FilterItemsType;

(function($)
{

	var $container;

    var toolip1;
    var toolip2;
    var toolip3;

    var STEPS = 6;
    var AREA_WIDTH_TOTAL = 1032;
    
    var callbackFunction;

    var currentSelection;
    var options;
    var $options;

    var currentIndexSystem = 0;

    var isMouseDownSelector = false;

    var timeoutTooltips;

	FilterItemsType = function(_items,_callback)
	{
		var self;
		var $self;

		var $filterButton = $('#type-selection');

		callbackFunction = _callback;
		var items=_items,addDefault;


		/*----------------------------------------*/

		this.append = function()
		{
			self = this;
			
			var MARKUP = "<div id='filter-items-widget' class='filter-widget'><div class='products-filter-wrapper'><div class='filter-items-type-wrapper'></div></div></div>";

			currentSelection = user.TYPE_PRODUCT;
			$footer.append(MARKUP);
			$container = $("#filter-items-widget");

			for (var i=0; i<items.length; i++)
			{
				
				if (i == items.length - 1)
				{
					$container.find(".filter-items-type-wrapper").append( "<div class='option-value'><div class='line-item-left'></div><div class='text-container'>" + (items[i]) + "</div><div class='line-item-right'></div></div>" );
				}
				else
				{
					$container.find(".filter-items-type-wrapper").append( "<div class='option-value'><div class='line-item-left'></div><div class='text-container'>" + (items[i]) + "</div></div>" );
				}
			}
			
			if (user.TYPE_PRODUCT)
			{
				$container.find(".option-value:contains(" + user.TYPE_PRODUCT + ")").addClass("active");	
			}

			$options = $(".option-value");
			$options.bind (MOUSE_DOWN, this.clickItem);

			$container.css({ bottom:27 }).animate({bottom:79}, {duration:250});

		}


		/*----------------------------------------*/

		this.callbackParent = function()
		{
			callbackFunction();
		}

		/*----------------------------------------*/

		this.clickItem = function(e)
		{
			var $clickedOption = $(this);

			user.SIZE = 0;
			user.DETAIL_SIZE = 0;
			user.COLOR = "";
			user.PRICE_RATE_MIN = FILTER_PRICES_MIN;
			user.PRICE_RATE_MAX = FILTER_PRICES_MAX
			
			if ($clickedOption.text() != user.TYPE_PRODUCT)
			{
				globalBus.publish( 'satorisan', 'close-products-filter-open' );
			}
			
			if (user.TYPE_PRODUCT != $clickedOption.text())
			{			
				user.TYPE_PRODUCT = $clickedOption.text();
				self.callbackParent();
			}

			user.TYPE_PRODUCT = $clickedOption.text();	
			$options.removeClass("active");
			$clickedOption.addClass("active");
		}

		/*----------------------------------------*/


		this.destroy = function(_callback)
		{
			$container.animate({bottom: 0}, {duration: 250, complete: function()
			{
				$container.remove();
				if (_callback) _callback();	
			}});

			$("#type-selection .categoria-text-over").stop().animate({left: 0},{duration: 200, complete: function()
            {
                $("#type-selection .categoria-text-over").stop().animate({opacity: 0}, {duration: 200, complete: function()
                {
                    $("#type-selection .categoria-text-over").css("display","none");
                    $("#type-selection .selected").css("display","block");
                    $("#type-selection .selected").stop().animate({opacity: 1}, {duration: 200});
                }});
            }});
		}

		/*----------------------------------------*/

		this.append();

	    $filterButton.find(".selected").stop().animate({opacity: 0},{duration: 200, complete: function()
	    {
	        $filterButton.find(".selected").css("display","none");
	        $filterButton.find(".categoria-text-over").css("display","block");  
	        $filterButton.find(".categoria-text-over").stop().animate({opacity: 1},{duration: 200, complete: function()
	        {
	            $filterButton.find(".categoria-text-over").stop().animate({ left:  $filterButton.width()/2 - $filterButton.find(".categoria-text-over").width()/2 - 15 },{duration:200});
	        }});
	    }});
	}
})
(jQuery);
var FilterModel;

(function($)
{
	var $container;
    
    var callbackFunction;
    var $modelName;

    var ignoreAll = false;

	FilterModel = function(_callback)
	{
		var self;

		var currentModelName;
		var $buttonSelected;

		callbackFunction = _callback;
		
		/*----------------------------------------*/

		this.append = function()
		{
			self = this;

			ignoreAll = true;
			setTimeout(function()
			{
				ignoreAll = false;
			}, 1000);

			var MARKUP =
			"\
				<div id='filter-model-widget' class='filter-widget'>\
					<div class='products-filter-wrapper'>\
        				<div class='filter-model-wrapper'>\
        					<div class='option-value model-name no-model'>\
        						<div class='line-item-left'></div>\
        						<div class='text-container'>" + DICTIONARY[CURRENT_LANGUAGE].model + "</div>\
        					</div>\
        					<div class='option-value all'>\
        						<div class='line-item-left'></div>\
        						<div class='text-container'>" + DICTIONARY[CURRENT_LANGUAGE].all + "</div>\
        						<div class='line-item-right'></div>\
        					</div>\
        				</div>\
        			</div>\
	        	</div>\
	        ";

			$container = $(MARKUP);
			$footer.append($container);

			$buttonSelected = $('#model-selection .selected');

			$modelName = $container.find('.model-name');
			$modelName.bind('tapone', function()
			{
				if (user.MODEL_ID)
				{
					callbackFunction();
					closeOpenedFilter();
				}
			});
			$container.find('.all').bind('tapone', function()
			{
				if (!ignoreAll)
				{
					user.MODEL_ID = null;
					user.MODEL_NAME = null;

					$buttonSelected.text(DICTIONARY[CURRENT_LANGUAGE].all);
					$buttonSelected.addClass('gray');

					callbackFunction();
					closeOpenedFilter();
				}
			});

			$container.css({bottom: -15}).animate({bottom: 79}, {duration: 250});

			if (user.MODEL_NAME)
			{
				currentModelName = user.MODEL_NAME;
				$modelName.find('.text-container').text(user.MODEL_NAME);
				$modelName.removeClass('no-model');
			}
			else
			{
				currentModelName = null;
			}                

			var $modelItems = $('.model-list');
			$modelItems.bind('tapone', self.modelClicked);
			$modelItems.bind('mouseenter', modelEnter);
			$modelItems.bind('mouseleave', modelLeave);
		}

		/*----------------------------------------*/

		function modelEnter(e)
		{
			var newName = PRODUCTS_FAMILIES[$(e.currentTarget).attr('model')].title[CURRENT_LANGUAGE];
			if (newName != currentModelName)
			{
				currentModelName = newName;
				changeModelName();
			}
		}

		var modelNameTimeout;
		function changeModelName()
		{
			clearTimeout(modelNameTimeout);

			modelNameTimeout = setTimeout(function()
			{
				var $hidingNames = $modelName.find('.text-container');
				var $newName;

				if (currentModelName)
				{
					$newName = $('<div class="text-container">' + currentModelName + '</div>').css('opacity', 0);
					$modelName.removeClass('no-model');
				}
				else
				{
					$newName = $('<div class="text-container">' + DICTIONARY[CURRENT_LANGUAGE].model + '</div>').css('opacity', 0);
					$modelName.addClass('no-model');
				}

				$hidingNames.stop(true).animate({opacity: 0}, {duration: 200, specialEasing: {opacity: 'easeInOutCubic'}, complete: function()
				{
					$hidingNames.remove();

					$modelName.append($newName);
					$newName.animate({opacity: 1}, {duration: 200, specialEasing: {opacity: 'easeInOutCubic'}});
				}});
			}
			, 200);
		}

		function modelLeave(e)
		{
			if (currentModelName == PRODUCTS_FAMILIES[$(e.currentTarget).attr('model')].title[CURRENT_LANGUAGE])
			{
				if (currentModelName != user.MODEL_NAME)
				{
					currentModelName = user.MODEL_NAME;
					changeModelName();
				}
			}
		}

		/*----------------------------------------*/

		this.modelClicked = function(e)
		{
			var $model = $(e.currentTarget);
			var newModel = $model.attr('model');

			user.MODEL_ID = newModel;
			user.MODEL_NAME = PRODUCTS_FAMILIES[newModel].title[CURRENT_LANGUAGE];

			$buttonSelected.text(user.MODEL_NAME);
			$buttonSelected.removeClass('gray');

			callbackFunction();
			closeOpenedFilter();
		}

		/*----------------------------------------*/

		this.destroy = function(_callback)
		{
			$container.animate({bottom: -15}, {duration: 250, complete: function()
			{
				$container.remove();
				if (_callback) _callback();
			}});
		}

		this.append();

		/*----------------------------------------*/
	}

	


})
(jQuery)
var TechTimeline;

(function($)
{

	var $container;
    var $selector;

    var toolip1;
    var toolip2;
    var toolip3;

    var STEPS = 3;
    var AREA_WIDTH_TOTAL = 516;
    
    var callbackFunction;

    var currentSelection;
    var options;
    var $options;

    var currentIndexSystem = 0;

    var isMouseDownSelector = false;

    var timeoutTooltips;

	TechTimeline = function(_callback)
	{
		
		var $this;	
		this.systemSelector;
		callbackFunction = _callback;
		var isDetail=false;
		var activeSizes,isLooseSize;



		/*----------------------------------------*/

		this.append = function()
		{
			$this = this;
			
			var MARKUP = "<div id='filter-quantity-widget' class='filter-widget'><div class='products-filter-final clearfix'><div class='products-filter-wrapper clearfix'>";
	        MARKUP += "<div class='filter-quantity-drag-area' style='width:auto !important;'><div class='filter-quantity-selector'><div class='cursor' style=''></div></div></div>";
	        MARKUP += "</div></div><div class='size-system-wrapper'></div><div class='middle-line'></div></div>";

	        var CONFIG_TECH;

			if ( $(".section-wrapper.tech").length != 0 )
			{
				CONFIG_TECH = TECH_TIMELINE;
				$(".section-wrapper.tech").append(MARKUP);	
			}
			
			if ( $(".section-wrapper.brand").length != 0 )
			{
				CONFIG_TECH = BRAND_TIMELINE;
				$(".section-wrapper.brand").append(MARKUP);	
			}

			$container = $("#filter-quantity-widget");

			for (var i=0; i< CONFIG_TECH[CURRENT_LANGUAGE].length; i++)
			{
				if (i==1)
				{
					$container.find(".products-filter-wrapper").append( "<div class='option-value option-value-"+i+"' style='width:"+(100/CONFIG_TECH[CURRENT_LANGUAGE].length)+"% !important;'><div class='circle-tech'></div><div class='green-background'></div><div class='green-background-left'></div><div class='line' style=''></div><div class='label'>" + CONFIG_TECH[ CURRENT_LANGUAGE ][i] + "</div></div>" );	
				}
				else
				{
					$container.find(".products-filter-wrapper").append( "<div class='option-value option-value-"+i+"' style='width:"+(100/CONFIG_TECH[CURRENT_LANGUAGE].length)+"% !important;'><div class='circle-tech'></div><div class='green-background'></div><div class='line' style=''></div><div class='label'>" + CONFIG_TECH[ CURRENT_LANGUAGE ][i] + "</div></div>" );	
				}
				
			}

			var x = 1;
			if (isDetail) x = 0;

			currentSelection = 0;

			$selector = $(".filter-quantity-selector");
			//DragCursor.open($selector);
			$this.createDrag();
			

			$selector.bind(MOUSE_DOWN, this.mouseDownEvent);
			$selector.bind(MOUSE_UP_EVENT, this.mouseUpEvent);
			$(document).bind(MOUSE_UP_EVENT, this.mouseUpEvent);

			$options = $(".option-value");
			$options.eq(0).addClass("active");
			$options.bind (MOUSE_DOWN, this.gotoOption);

			//$container.find(".products-filter-wrapper .option-value").eq(currentSelection-1).addClass("active");
			//$selector.css( {left : ((currentSelection-1) * $options.width() ) } );		
			$(".filter-quantity-selector").css( { width:(100/CONFIG_TECH[CURRENT_LANGUAGE].length)+"%"} );

			$window.unbind("resize", $this.resize).bind("resize", $this.resize);
		}

		/*----------------------------------------*/

		this.createDrag = function()
		{
			//$selector.draggable({ axis: "x", left:0, containment:".filter-quantity-drag-area" });	
		}

		/*----------------------------------------*/

		this.resize = function()
		{
			$this.createDrag();
			$selector.animate( {left: (currentSelection * $options.width())-2 }, {duration: 250});
		}

		/*----------------------------------------*/

		this.goOption = function(_index)
		{
			
			clearTimeout(timeoutTooltips);
			if (toolip1) toolip1.stop();
			var index = _index;
			currentSelection = index;
			var event = $.Event('techTimelineUpdate');
			event.positionIndex = currentSelection;
			//$window.trigger(event);
			$selector.animate( {left : (index * $options.width() - 2 ) }, {duration:300});
			user.DETAIL_QUANTITY = index + 1;
			$options.removeClass("active");
			$options.eq(index).addClass("active");



			if (toolip1) toolip1.stop();
		}

		/*----------------------------------------*/

		this.mouseDownEvent = function(e)
		{
			isMouseDownSelector	= true;
			//DragCursor.closed($body);
		}

		/*----------------------------------------*/

		this.gotoOption = function(e)
		{
			clearTimeout(timeoutTooltips);
			if (toolip1) toolip1.stop();
			var index = $(".option-value").index($(this));
			currentSelection = index;
			var event = $.Event('techTimelineUpdate');
			event.positionIndex = currentSelection;
			$window.trigger(event);
			$selector.animate( {left : (index * $options.width() - 2 ) }, {duration:300, complete:function(){
				if (callbackFunction) callbackFunction(  );
			} });
			user.DETAIL_QUANTITY = index + 1;
			$options.removeClass("active");
			$options.eq(index).addClass("active");



			if (toolip1) toolip1.stop();
		}

		/*----------------------------------------*/
		var isMouseUpBlocked = false;

		this.mouseUpEvent = function(e)
		{
			if (isMouseUpBlocked==false && isMouseDownSelector==true)
			{
				
				clearTimeout(timeoutTooltips);
				if (toolip1) toolip1.stop();
				isMouseUpBlocked = true;

				e.preventDefault();

				var step = FILTER_QUANTITY_TOTAL;
				var currentX = $selector.position().left;

				var min = 9999;
				var target;
				var point = 0;

				for (var i=0 ; i<FILTER_QUANTITY_TOTAL; i++)
				{
					if ( Math.abs (currentX - point) < min)
					{
						min = Math.abs (currentX - point)
						target = i;
					}

					point += $options.width();
				}

				currentSelection = target;
				
				var event = $.Event('techTimelineUpdate');
				event.positionIndex = currentSelection;
				$window.trigger(event);

				$selector.animate( {left: (target * $options.width())-2 }, {duration: 250, complete: function()
				{
					
					isMouseUpBlocked = false;
					if (callbackFunction) callbackFunction(  );				

				}});

				$options.removeClass("active");
				$options.eq(currentSelection).addClass("active");
				
				
				//DragCursor.clear($body);
				setTimeout(function() { $body.css('cursor', ''); }, 0);
			}

			isMouseDownSelector = false;

		}
		


		/*----------------------------------------*/

		this.showTooltip = function()
		{
			//toolip1 = new Tooltip( { target: ".filter-quantity-selector", markup: DICTIONARY[CURRENT_LANGUAGE].dragselectquantity, exitMode:"delay", exitTime:1000} );			
		}

		/*----------------------------------------*/

		this.removeMenu = function(){
			$window.unbind("resize", $this.resize);
			$selector.unbind(MOUSE_UP_EVENT, this.mouseUpEvent);
			$(document).unbind(MOUSE_UP_EVENT, this.mouseUpEvent);
			$container.remove();
		}

		this.destroy = function(_callback)
		{
			$window.unbind("resize", $this.resize);
			$selector.unbind(MOUSE_UP_EVENT, this.mouseUpEvent);
			$(document).unbind(MOUSE_UP_EVENT, this.mouseUpEvent);
			$container.animate({ bottom:-15}, {duration:250, complete:function(){
				
				$container.remove();
				if(_callback) _callback();	
			}});
		}

		this.append();

		/*----------------------------------------*/
	}

	


})
(jQuery)

var Fullvideo;

var VideoFlashReadyCallback, VideoFlashOnEnd;

(function($)
{

	var SWF_PATH = "/website/swf/videoplayer.swf"

	Fullvideo = function(_config)
	{
		var $video,
		$this,	
		videoResolution,
		unique = new Date().getTime(),
		isOk=false,
		isWating=false,
		config = _config;


		/*----------------------------------------*/

		this.append = function()
		{
			$this = this;
			videoResolution = config.videoWidth / config.videoHeight;

			var pathOgg = String(config.path).replace(".mp4", ".ogv");
			var pathWebm = String(config.path).replace(".mp4", ".webm");

			
			var loop="true";

			if (config.loop)
			{
				loop = config.loop;
			}

			if ($this.isFlash()==false)
			{
				var HTML5_MARKUP = "<div class='full-video-container' style='pointer-events: none;'  > \
						<div class='video-overlay-1'></div> \
						<video src='" + config.path + "' id='fullvideo-" + unique + "' autoplay='true' style='z-index: 20;position: absolute;top: 0;left: 0; '  > \
						</video> \
					</div>";

	
				
				$(config.selector).append(HTML5_MARKUP);


				document.getElementById('fullvideo-' + unique).play();	
				document.getElementById('fullvideo-' + unique).addEventListener("canplay", function () {
				    //document.getElementById('fullvideo-' + unique).removeEventListener("canplay");
				    if (config.canplay && isOk==false)
				    {
				    	isOk = true;
				    	config.canplay();
				    }
				    //$video.show();
				    

				}, false);	

				setTimeout(function(){
					document.getElementById('fullvideo-' + unique).pause(); //block play so it buffers before playing
				}, 1);

				document.getElementById('fullvideo-' + unique).addEventListener("ended", VideoFlashOnEnd);
			
				document.getElementById('fullvideo-' + unique).load();


				$video = $( '#fullvideo-' + unique );
				$video.show();
				
				$this.resize();


			}
			else
			{
				//alert ("Crea video flash");
				isWating = true;
				//classid='clsid:d27cdb6e-ae6d-11cf-96b8-444553540000'
				
				//style='z-index:0;position:relative;margin-top:43px;'
				$(config.selector).append(
					"<div class='full-video-container'> \
						<div class='video-overlay-1'></div> \
						<div id='fullvideo-" + unique + "'></div> \
					</div>");

				var params = {wmode: "transparent"};						
				
				swfobject.embedSWF(SWF_PATH+"?pathvideo="+config.path, 'fullvideo-' + unique, "100", "100", "9.0.0", "", {}, params);


				/*$(config.selector).append(
					"<div class='full-video-container'> \
						<div class='video-overlay-1'></div> \
						<object align='middle' id='container-fullvideo-" + unique + "' style='z-index:0;position:relative;margin-top:43px;' wmode='transparent'> \
					    <param wmode='transparent' name='movie' value='"+SWF_PATH+"?pathvideo="+config.path+"'/> \
					    <param name='wmode' value='transparent'/> \
					    <!--[if !IE]>--> \
					    <object wmode='transparent' type='application/x-shockwave-flash'  data='"+SWF_PATH+"?pathvideo="+config.path+"' id='fullvideo-" + unique + "' style='z-index:0;position:relative;margin-top:43px;' wmode='transparent' > \
					        <param name='movie' value='"+SWF_PATH+"?pathvideo="+config.path+"'/> \
					         \
					    <!--<![endif]--> \
					        <a href='http://www.adobe.com/go/getflash'> \
					            <img src='http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif' alt='Get Adobe Flash player'/> \
					        </a> \
					    <!--[if !IE]>--> \
					    </object> \
					    <!--<![endif]--> \
					</object> \
					</div>");*/
				$video = $( '#fullvideo-' + unique );
				
			}

			isOk=false;
			
			$window.bind("resize", $this.resize);
			
		}


       /*-------------------------------*/

        this.removeControls=function()
        {
            $video.prop("controls", false);
        }

        /*-------------------------------*/

        this.addControls=function()
        {
            //alert(document.getElementById('fullvideo-' + unique));
           $video.prop("controls", true);
            
        }


		/*----------------------------------------*/

		this.muted = function()
		{
			if ($this.isFlash())
			{
				var flashObj = document.getElementById('fullvideo-' + unique);
				if (flashObj) flashObj.muted();

				var flashObj2 = document.getElementById('container-fullvideo-' + unique);
				if (flashObj2) flashObj2.muted();
			}
			else
			{
				//document.getElementById('fullvideo-' + unique).muted=true;
				$("video").get(0).muted=true;
				
			}
		}

		/*----------------------------------------*/

		this.audio = function()
		{
			if ($this.isFlash())
			{
				var flashObj = document.getElementById('fullvideo-' + unique);
				if (flashObj) flashObj.audio();

				var flashObj2 = document.getElementById('container-fullvideo-' + unique);
				if (flashObj2) flashObj2.audio();
			}
			else
			{
				$("video").get(0).muted=false;
				
			}
		}

		/*----------------------------------------*/

		this.isFlash = function()
		{
			
			if ($.browser.mozilla || $.browser.msie)
			{
				
				return true;
			}
			else
			{
				
				return false;	
			}

		}

		/*----------------------------------------*/

		this.play = function()		
		{
			if ($this.isFlash()==false)
			{
				$video[0].play();
			}
			else
			{
				var flashObj = document.getElementById('fullvideo-' + unique);
				if (flashObj)
				{
					flashObj.resumeVideo();
				}
				else
				{

					var flashObj2 = document.getElementById('container-fullvideo-' + unique);
					if (flashObj2) flashObj2.resumeVideo();
				}

			}
		}

		/*----------------------------------------*/

		this.pause = function()
		{
			if ($this.isFlash()==false)
			{
				$video[0].pause();
			}
			else
			{
				var flashObj = document.getElementById('fullvideo-' + unique);
				if (flashObj){
				 	flashObj.pauseVideo();
				}
				else
				{

				var flashObj2 = document.getElementById('container-fullvideo-' + unique);
				if (flashObj2) flashObj2.pauseVideo();
				}
			}
		}

		/*----------------------------------------*/

		this.resume = function()
		{
			if ($this.isFlash()==false)
			{
				$video[0].play();
			}
			else
			{
				var flashObj = document.getElementById('fullvideo-' + unique);
				if (flashObj) flashObj.resumeVideo();

				var flashObj2 = document.getElementById('container-fullvideo-' + unique);
				if (flashObj2) flashObj2.resumeVideo();
			}
		}

		/*----------------------------------------*/

		this.restartVideo = function()
		{
			if ($this.isFlash()==false)
			{
				$video[0].currentTime=0;
				$video[0].play();
			}
			else
			{
				var flashObj = document.getElementById('fullvideo-' + unique);
				if (flashObj) flashObj.restartVideo();

				var flashObj2 = document.getElementById('container-fullvideo-' + unique);
				if (flashObj2) flashObj2.restartVideo();
			}
		}

		/*----------------------------------------*/

		this.stop = function()
		{
			$(".full-video-container").remove();
		}


		/*----------------------------------------*/

		this.resize = function()
		{
			
			var screenResolution = $window.width() / $window.height();
			
			if ($this.isFlash()==false)
			{
				if (screenResolution > videoResolution)
				{
					//alert("1")
					$video.css ( { width:$window.width(), height:Math.round((config.videoHeight*$window.width())/config.videoWidth), top:$window.height()-33-$video.height()} );
				}
				else
				{
					
					if( isiPad ){
						temp_height = 660;
						
					}else{
						temp_height = $window.height()-2;
					}
					if( isiPad && $video.height() == 150 ){
						temp_video_height = 0;
					}else{
						temp_video_height = $video.height();
					}
					$video.css ( { height:temp_height, width:Math.round((config.videoWidth*temp_height)/config.videoHeight), 
																						top:$window.height()-33-temp_video_height} );
				}
			}
			else
			{

				if ($('#container-fullvideo-' + unique).length > 0)
				{
					$('#container-fullvideo-' + unique).attr ( "width", $window.width() );
					$('#container-fullvideo-' + unique).attr ( "height", $window.height() );
				}

				$video.find("object").attr ( "width", $window.width() );
				$video.find("object").attr ( "height", $window.height() );

				$video.attr ( "width", $window.width() );
				$video.attr ( "height", $window.height() );

				var flashObj = document.getElementById('fullvideo-' + unique);
				if (flashObj)
				{
					if (flashObj.resizeVideo) flashObj.resizeVideo( $window.width(), $window.height());
				}
				else
				{

					var flashObj2 = document.getElementById('container-fullvideo-' + unique);
					if (flashObj2)
					{
						if (flashObj2.resizeVideo) flashObj2.resizeVideo( $window.width(), $window.height());
					}
				}
			}

			$(".video-overlay-1").css( { height:$this.videoHeight() } );

		}

		this.videoHeight = function()
		{
			if ($this.isFlash()==false)
			{
				return $("video").height()+100;
			}
			else
			{
				return $window.height();
			}
		}

		this.getVideoTime = function()
		{
			
			var t = 0;

			if ($this.isFlash() == false)
			{
				t = document.getElementById('fullvideo-' + unique).currentTime;
			}
			else
			{

				var flashObj = document.getElementById('fullvideo-' + unique);
				
				if (flashObj)
				{
					t = flashObj.getTime();
				}
				else
				{

					var flashObj2 = document.getElementById('container-fullvideo-' + unique);
					if (flashObj2)
					{
						t = flashObj2.getTime();
					}
				}

			}

			return t;

		}

		VideoFlashOnEnd = function(){
		
			if (config.onend) config.onend();
		}

		VideoFlashReadyCallback = function()
		{
			
			if (isWating)
			{
				
				//$this.resize();
				config.canplay();
				isWating = false;
			}
		}

		/*----------------------------------------*/

		this.destroy = function()
		{
			$window.unbind("resize", $this.resize)
			//document.getElementById("fullvideo-" + unique).removeEventListener("canplay");
			$(".full-video-container").remove();
		}

		this.append();

		/*----------------------------------------*/
	}

	


})
(jQuery)
Hydra.module.register( 'block-ipad-portrait', function( bus ){ 

    var $this,isCreated = false,leftMonkey,startMonkey;

    return {
            


            init: function(){
                $this = this;
                bus.subscribe('satorisan', this);
            },

            oEventsCallbacks: {
                
                'tablet-portrait' : function () {                    
                    $this.create();
                },

                'tablet-landscape' : function () {                    
                    $this.destroyAlert();
                },
                

            },
			
			/*-------------------------------*/

            create: function(){
            	if (isCreated == false)
                {
                    $blocker.show();
                    isCreated = true;
                    if ($(".screen-error").length>0) $(".screen-error").remove();
                    //$overlay.append("<div class='screen-error'><div class='screen-error-box'><div class='screen-error-text'>" + DICTIONARY[CURRENT_LANGUAGE].screenerror + "</div></div><div class='screen-error-overlay'></div></div>");                    
                    $overlay.append("<div class='screen-error'> \
                                        <div class='screen-error-box'> \
                                            <div class='monkey-rotate'>  \
                                                <div class='monkey-rotate-wrapper'> \
                                                    <div class='monkey-rotate-logo'>Satorisan Logo</div> \
                                                    <div class='monkey-rotate-image'>Monkey Rotate Ipad</div> \
                                                    <div class='monkey-rotate-text'> \
                                                        Hey walker! if you want to explore the Satorisan site,<br> \
                                                        please, <span>rotate your tablet landscape view.</span> \
                                                    </div> \
                                                    <div class='monkey-rotate-hash'>#livebythewalk</div> \
                                                </div> \
                                            </div>\
                                            <div class='screen-error-overlay'></div>\
                                        </div>\
                                    </div>");                    
                    $(".screen-error-box").stop().css( { "opacity" : 0 } );

                    $(".screen-error-overlay").stop().css( { "opacity" : 0 } ).animate(  { "opacity" : 1 }, {duration:350, complete:function(){
                        $(".screen-error-box").animate( { "opacity" : 1 }, {duration:350} );
                    }} );

                    $(".monkey-rotate").stop().css( { "opacity" : 0 } );
                    $(".monkey-rotate").animate( { "opacity" : 1 }, {duration:600} );

                    startMonkey = setInterval(function(){
                        $this.changeMonkey();
                    },1000);
                    
                }
            	

            },

            /*-------------------------------*/

            destroyAlert: function(){
                if (isCreated==true)
                {
                    $blocker.hide();
                    
                    $(".screen-error-box").stop().animate( { "opacity" : 0 }, {duration:350, complete:function(){
                        $(".screen-error-overlay").stop().animate( {"opacity":0}, {duration:350, complete:function(){
                            $(".screen-error").remove();
                        }} );
                    }} );

                    isCreated = false;

                }
                

            },

            /*-------------------------------*/

            changeMonkey: function(){
                
                if (leftMonkey){
                    $(".monkey-rotate-image").addClass("left");
                    $(".monkey-rotate-image").removeClass("right");
                    leftMonkey = false;
                }else if(leftMonkey != true){
                    $(".monkey-rotate-image").removeClass("left");
                    $(".monkey-rotate-image").addClass("right");
                    leftMonkey = true;
                }                

            } 

            /*-------------------------------*/
        
        }
    
});


Hydra.module.register( 'cart-button', function( bus ){ 
        
        var $container;
        var tooltip;

        return {
            
            /*-------------------------------*/
            /* CART BUTTON */
            /*-------------------------------*/            

            init: function(){
                bus.subscribe('satorisan', this);
                $container = $("header .right-section a.cart");
                $container.html(CART_QUANTITY);
                $container.addClass("active");
                $container.removeClass("inactive");
                if (CART_QUANTITY==0)
                {
                  $container.removeClass("active");
                  $container.addClass("inactive");
                }
                bus.publish( 'satorisan', 'history-update' );
            },

            /*-------------------------------*/

            oEventsCallbacks: {
                'add-to-cart' : function ( data ) { 
                    this.update(data);
                },

                'shipping-country-update' : function (  )
                {

                  this.updateQuantity();
                },

                'set-cart' : function (  )
                {

                  this.setCart();
                }
            },            

            /*-------------------------------*/
            
            setCart:function(){
                $container = $("header .right-section a.cart");
                $container.html(CART_QUANTITY);
                $container.addClass("active");
                $container.removeClass("inactive");
                if (CART_QUANTITY==0)
                {
                  $container.removeClass("active");
                  $container.addClass("inactive");
                }
                bus.publish( 'satorisan', 'history-update' );
            },

            /*-------------------------------*/

            updateQuantity:function(){

                $.ajax({
                    cache: true,
                    type: "GET",
                    data: { store:user.SHIPPING_REGION },
                    url: WEBSERVICES_PATH["update-cart"],
                    contentType: "application/x-www-form-urlencoded;charset=UTF-8",
                    success: function(_data) {
                        user.updateCart($.parseJSON(_data).cartcount);
                    }
                  });
            },

            /*-------------------------------*/

            update:function(data){
                 $.ajax({
                  cache: true,
                  type: "GET",
                  data: { id:data.id_product, qty:data.quantity, size:data.size, store:user.SHIPPING_REGION, store_id:getCodeLocale() },
                  url: WEBSERVICES_PATH["add-to-cart"],
                  contentType: "application/x-www-form-urlencoded;charset=UTF-8",
                  success: function(_data) {
                    
                    
                    var data = $.parseJSON (_data);

                    if (data.success == "1")
                    {
                      CART_QUANTITY = data.cartcount;
                      $container.html(CART_QUANTITY);
                      $container.addClass("active");
                      $container.removeClass("inactive");
					            $window.trigger('cartAdd');
                      if (CART_QUANTITY==0)
                      {
                        $container.removeClass("active");
                        $container.addClass("inactive");
                      }
                    }
                    else
                    {
                        tooltip = new Tooltip( { offsetX:250, offsetY:-10, target: "#add-to-cart", markup: DICTIONARY[CURRENT_LANGUAGE].addtocartnostock, exitMode:"delay", exitTime:1000} );                             
                    }
					         
                    bus.publish( 'satorisan', 'history-update' );
                    $window.trigger('cartComplete');
                    
                  }
                });
            }

            /*-------------------------------*/

        
        }
    
});


var ANALYTICS_ID = 'UA-38603141-1';
var TEST_MODE = false;
var _gaq = _gaq || [];
_gaq.push(['_setAccount', ANALYTICS_ID]);
_gaq.push(['_trackPageview']);

(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();  

Hydra.module.register( 'ganalytics', function( bus ){ 
        
        var $this,isFirst = true;

         
        

        return {
            
            /*-------------------------------*/
            /* GOOGLE ANALYTICS */
            /*-------------------------------*/            

            init: function(){
                $this = this;                     
                bus.subscribe('satorisan', this);              
            },

            /*-------------------------------*/

            oEventsCallbacks: {
                'ganalytics-track-path' : function () {
                    $this.track( { path:location.pathname} );
                },

                'ganalytics-track-event' : function (data) {
                    $this.track(data);
                }
            },
            
            /*-------------------------------*/

            track: function(data)
            {
                if (data.path)
                {
                    //console.log(_gaq);
                    //console.log("TRACK PATH> " + data.path);     
                    _gaq.push(['_trackPageview', data.path]);
                }

                if (data.name)
                {
                    //console.log(_gaq);
                    //console.log("TRACK EVENT> " + data.name);     
                    _gaq.push(['_trackPageview', data.name]);
                }
               

            }

            /*-------------------------------*/

        
        }
    
});

/**
 * 
 */
(function($) {
	$.getParameter = function(name) {
		var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
		var r = window.location.search.substr(1).match(reg);
		if (r != null)
			return unescape(r[2]);
		return null;
	}
})(jQuery);

var $html,$body,$header,$footer,$window,$document,$content,$overlay,$blocker,user,environment,iframeInterface,PageTitle,isiPad,ACCEPT_COOKIES=true,QUESTION_COOKIES_DO=true,CAMPAIGN_LAST_RANDOM;

(function($)
{

	/*----------------------------------------*/

	function init(){
		
		if ($.browser.msie)
		{
			var version = Number($.browser.version.split('.')[0]);
			if (version == 9) document.onselectstart = function() { return false; }
		}
 		
		if (navigator.userAgent.match(/CriOS/i) != null) $("body").addClass("ioschrome");

		$.cookie("ACCEPT_COOKIES", true, { expires: 180, domain:OPENSHOP_DOMAIN, path:"/" } );
		
 		if ($.cookie("ACCEPT_COOKIES"))
 		{
 			ACCEPT_COOKIES = true;
 			QUESTION_COOKIES_DO = true;
 		}

 		if ($.cookie("CAMPAIGN_LAST_RANDOM"))
 		{
 			CAMPAIGN_LAST_RANDOM = Number($.cookie("CAMPAIGN_LAST_RANDOM"));
 		}
        
		$("body").css( {"opacity" : 0} );
		checkLanguage();
		$("body").addClass("language-en");
		$(document).bind('touchmove', function(e)
		{
		    e.preventDefault();
		});
		
        $.ajax({
          cache: true,
          url: WEBSERVICES_PATH["filter-attributes"] + "?lg=" + CURRENT_LANGUAGE,
          contentType: "application/x-www-form-urlencoded;charset=UTF-8",
          dataType: "text",
          success: function(data)
          {
            ATTRIBUTES_FILTER = $.parseJSON(data);
            
			user = new Session();
			environment = Environment();
			iframeInterface = new Interface();
			PageTitle = new PageTitle();
			
			var country = "";
	        for (var i = 0; i< countriesShipping[0].length;i++){

	            if (countriesShipping[0][i]._cid == user.SHIPPING_CODE)
	            {
	                country = countriesShipping[0][i]._cname;
	            }
	             
	        }
//		         console.log(country);
	        if (country != ""){
	        	user.SHIPPING_NAME = country;
	        	$.cookie("SHIPPING_NAME", country, {domain:OPENSHOP_DOMAIN, path:"/"});
	        }

			$html = $("html");
			$body = $("body");
	        $window = $(window);
			$document = $(document);
			
			Hydra.setDebug(DEBUG_MODE);

			if (Modernizr.touch)
			{
				$body.addClass("touch");
			}
			else
			{
				$body.addClass("no-touch");
			}
			var darkBG = "bg-dark.png";
			isiPad = navigator.userAgent.match(/iPad/i) != null;
			if (isiPad == true) {
				website_bg = "website/images/bg_ipad.jpg";
				darkBG = "bg-dark_ipad.jpg";
				$body.addClass("ipad");	 
			}else{
				website_bg = "assets/new/images/bg.png";
			}

			$.preload([
				INIT_FOLDER+"assets/new/images/sprite.png",
				INIT_FOLDER+"assets/new/images/"+darkBG,
				INIT_FOLDER+"assets/new/images/section_name_" + CURRENT_LANGUAGE + ".png",
				INIT_FOLDER+"assets/new/images/openHandCursorArrows.png",
				INIT_FOLDER+"assets/new/images/sprite-campaign_en.png",
				INIT_FOLDER+"assets/new/images/closedHandCursorArrows.png",
				INIT_FOLDER+website_bg,
				INIT_FOLDER+"assets/new/images/mono_preloader.gif"
				], {loaded_all:function() {

						for ( var i=0; i<HYDRA_MODULES.length; i++ )
						{
							Hydra.module.start(HYDRA_MODULES[i], HYDRA_MODULES[i] + '_instance');	
						}	

						$body.css( { "display" : "block"} );

						$body.animate( { "opacity" : 1}, {duration:1000} );
						
			}});
          }
        });
	}

	/*----------------------------------------*/

	function checkLanguage()
	{
		var pathname = location.pathname;
		
		if (pathname == INIT_FOLDER)
		{
			
			if ( $.cookie('openshop_language') )
			{
				CURRENT_LANGUAGE = $.cookie('openshop_language');
			}
			else
			{
				CURRENT_LANGUAGE = "zh_cn";	
			}
		}
		else
		{
			for ( var i=0; i < LANGUAGES.length; i++)
            {
                if (pathname.indexOf("/" + LANGUAGES[i]) != -1)
                {
                	CURRENT_LANGUAGE = LANGUAGES[i];
                	$.cookie('openshop_language', CURRENT_LANGUAGE, {domain:OPENSHOP_DOMAIN, path:"/"})
                }
            }
		}
	}

	/*----------------------------------------*/

	$(document).ready(init);

})
(jQuery)