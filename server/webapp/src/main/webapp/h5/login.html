<!DOCTYPE HTML>
<html lang="en">
	<head>
		<title>Moby-elite</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black" />
		<link rel="stylesheet" type="text/css" href="/assets/h5/css/style.css" media="screen" />
		<!--[if lt IE 9]>
			<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
	</head>
	
	<body>
	<div id="wrapper">
		<!--Header Starts-->
		<header>
	               <ul class="navigation">
	               
	                   <li>
	                   	<a href="/h5/index.html">
	                   		<span class="nav_icon home"></span>首页
	                   	</a>
	                   </li>
	                   
	                   <li class="dropdown">
	                   	<a href="#">
	                   		<span class="nav_icon about"></span>
	                   		产品列表
	                   	</a>
	                       <!--Submenu-->
	                       <ul id="submenu">
	                           <li> <a href="/h5/category.html?cat_id=1">衣服（男士）</a></li>
	                           <li> <a href="/h5/category.html?cat_id=2">衣服（女士）</a></li>
	                           <li> <a href="/h5/category.html?cat_id=3">鞋子（男士）</a></li>
	                           <li> <a href="/h5/category.html?cat_id=4">鞋子（女士）</a></li>
	                           <li> <a href="/h5/category.html?cat_id=5">包包（男士）</a></li>
	                           <li> <a href="/h5/category.html?cat_id=6">包包（女士）</a></li>
	                           <li> <a href="/h5/category.html?cat_id=7">化妆品（男士）</a></li>
	                           <li> <a href="/h5/category.html?cat_id=8">化妆品（女士）</a></li>
	                           <li> <a href="/h5/category.html?cat_id=9">其他（男士）</a></li>
	                           <li> <a href="/h5/category.html?cat_id=10">其他（女士）</a></li>
	                       </ul>
	                  	</li>
	                  
	                   <li>
	                   	<a href="blog.html">
	                       	<span class="nav_icon blog"></span> 关于我们
	                      	</a>
	                   </li>
	                       
	                   <li class="dropdown active">
	                   	<a href="#"><span class="nav_icon contact"></span>我的定制</a>
	                   	<ul id="submenu">
	                   		<li> <a href="/h5/login.html">登录</a></li>
	                   		<li> <a href="/h5/i/i.html">我的定制</a></li>
	                   		<li> <a href="/h5/logout.html">登出</a></li>
	                   	</ul>
	                   </li>
	                       
	                   <li class="nav_search">
	                   	<a href="#"></a>
	                   </li>
	               </ul>
	               <!--Search starts-->
			<div id="search">
				<form class="search" action="about.html">
					<fieldset class=" ">
						<input type="text" placeholder="search" class="text ">
						<input type="submit" value="search" class="submit">
					</fieldset>
				</form>
			</div>
			<!--Search ends-->
	        <ul class="share">
	        	<li class="twitter"><a href="#"></a></li>
	            <li class="facebook"><a href="#"></a></li>
	            <li class="rss"><a href="#"></a></li>
	        </ul>
	        <a href="#" title="Back to Home page" id="logo"><img  alt="" src="/assets/h5/images/logo.png" /></a>
        </header>
		
		<!--Header Ends-->
		<!--Section Starts-->
		<section id="main">
			<!--Comments Starts-->
			<div class="block_module comment_form">
				<h2>登录-LOGIN</h2>
				<form id="login-form" method="post">
					<ul id="moby_form">
						<li>
							<input type="text" name="user_name" id="user_name" placeholder="请输入用户名或email" required="required" />
						</li>
						<li>
							<input type="password" name="password" id="password" placeholder="请输入密码" required="required" />
						</li>
						<li>
							<input type="submit" id="login-button" name="login-button" value="登录" />
						</li>
					</ul>
				</form>
				<div id="sendingMessage" class="statusMessage">
					<p>登录中. 请稍等...</p>
				</div>
				<div id="successMessage" class="statusMessage">
					<p>登录成功.</p>
				</div>
				<div id="failureMessage" class="statusMessage">
					<p>登录失败，请重试.</p>
				</div>
				<div id="incompleteMessage" class="statusMessage">
					<p>请填写用户名和密码.</p>
				</div>
			</div>
			<!--Comments Ends-->
		</section>
		<!--Section Ends-->
		<!--Footer Starts-->
		<footer>
			<ul class="footer_nav">
				<li><a href="/h5/index.html">Home</a></li>
				<li><a href="/h5/about.html">About</a></li>
				<li><a href="/h5/blog.html">Blog</a></li>
				<li><a href="/h5/contact.html">Contact</a></li>
			</ul>
			<span class="copyright">Copyright © 2012 Moby-elite. All
				Rights Reserved.</span>
		</footer>
		<!--Footer Ends-->
	</div>
</body>

	<!-- JQuery -->
	<script src="/assets/h5/js/jquery.min.js"></script>

	<!-- JQueryUI -->
	<script src="/assets/h5/js/jquery-ui-1.8.16.custom.min.js"></script>
	<script src="/assets/h5/js/jquery.serializeobject.js"></script>
	<!-- Script Controls -->
	<script src="/assets/h5/js/site.js"></script>
	<script src="/assets/h5/js/openshopjssdk.js"></script>
	<script src="/assets/h5/js/jsbridge-init.js"></script>
	
	<script type="text/javascript" src="/assets/h5/js/jsbn.js"></script>
	<script type="text/javascript" src="/assets/h5/js/prng4.js"></script>
	<script type="text/javascript" src="/assets/h5/js/rng.js"></script>
	<script type="text/javascript" src="/assets/h5/js/rsa.js"></script>
	<script type="text/javascript" src="/assets/h5/js/base64.js"></script>

	<script type="text/javascript">

		var messageDelay = 2000;  // How long to display status messages (in milliseconds)

		// Init the form once the document is ready
		$( init );


		// Initialize the form
		
		function init() {
		
		  // Hide the form initially.
		  // Make submitForm() the form's submit handler.
		  // Position the form so it sits in the centre of the browser window.
		  $('#login-form').submit( submitForm ).addClass( 'positioned' );
		
		  // When the "Send us an email" link is clicked:
		  // 1. Fade the content out
		  // 2. Display the form
		  // 3. Move focus to the first field
		  // 4. Prevent the link being followed
		
		  $('a[href="#login-form"]').click( function() {
		    $('#content').fadeTo( 'slow', .2 );
		    $('#login-form').fadeIn( 'slow', function() {
		      $('#user_name').focus();
		    } )
		
		    return false;
		  } );
		  
		  // When the "Escape" key is pressed, close the form
		  $('#login-form').keydown( function( event ) {
		    if ( event.which == 27 ) {
		      $('#login-form').fadeOut();
		      $('#content').fadeTo( 'slow', 1 );
		    }
		  } );
		
		}
		
		// Submit the form via Ajax
		
		function submitForm() {
		  var loginForm = $(this);
		
		  // Are all the fields filled in?
		
		  var userName = $('#user_name').val();
		  var password = $('#password').val();
		  if ( !userName || !password ) {
		
		    // No; display a warning message and return to the form
		    $('#incompleteMessage').fadeIn().delay(messageDelay).fadeOut();
		    loginForm.fadeOut().delay(messageDelay).fadeIn();
		
		  } else {
		
		    // Yes; submit the form to the PHP script via Ajax
		
		    $('#login-button').fadeIn();
		   
		    /*
		    $.ajax( {
		      url: loginForm.attr( 'action' ) + "?ajax=true",
		      type: loginForm.attr( 'method' ),
		      data: loginForm.serialize(),
		      success: submitFinished
		    } );
		    */
		    
		    window.jsbridge.callHandler('callApi', 
				'com.openteach.openshop.server.security.publick.alloc',
				'0.0.1',
				{},
				function(response) {
					console.log('com.openteach.openshop.server.security.publick.alloc', response);
					if(response.succeed) {
						var rsaKey = new RSAKey();
						rsaKey.setPublic(b64tohex(response.data.modulus), b64tohex(response.data.exponent));
						var enPassword = hex2b64(rsaKey.encrypt(password));
						
						window.jsbridge.callHandler('callApi', 
							'com.openteach.openshop.server.user.login',
							'0.0.1',
							{'user_name': userName, 'enPassword': enPassword},
							function(response) {
								console.log('Got response from com.openteach.openshop.server.user.login', response);
								if(response.succeed) {
									window.location.href = '/h5/i/i.html';
								} else {
									$('#failureMessage').html(response.errorMsg);
									$('#failureMessage').fadeIn().delay(messageDelay).fadeOut();
									$('#login-form').delay(messageDelay+500).fadeIn();
								}
							});
					} else {
						$('#failureMessage').fadeIn().delay(messageDelay).fadeOut();
						$('#login-form').delay(messageDelay+500).fadeIn();
					}
			});
		  }
		
		  // Prevent the default form submission occurring
		  return false;
		}
		
		
		// Handle the Ajax response
		
		function submitFinished( response ) {
		  response = $.trim( response );
		  $('#sendingMessage').fadeOut();
		
		  if ( response == "success" ) {
		
		    // Form submitted successfully:
		    // 1. Display the success message
		    // 2. Clear the form fields
		    // 3. Fade the content back in
		
		    $('#successMessage').fadeIn().delay(messageDelay).fadeOut();
		    $('#senderName').val( "" );
		    $('#senderEmail').val( "" );
		    $('#message').val( "" );
		
		    $('#content').delay(messageDelay+500).fadeTo( 'slow', 1 );
		
		  } else {
		    // Form submission failed: Display the failure message,
		    // then redisplay the form
		    $('#failureMessage').fadeIn().delay(messageDelay).fadeOut();
		    $('#contactForm').delay(messageDelay+500).fadeIn();
		  }
		}
		
	</script>
</html>
</html>